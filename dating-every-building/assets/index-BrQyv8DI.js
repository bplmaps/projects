(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))h(m);new MutationObserver(m=>{for(const v of m)if(v.type==="childList")for(const f of v.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&h(f)}).observe(document,{childList:!0,subtree:!0});function o(m){const v={};return m.integrity&&(v.integrity=m.integrity),m.referrerPolicy&&(v.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?v.credentials="include":m.crossOrigin==="anonymous"?v.credentials="omit":v.credentials="same-origin",v}function h(m){if(m.ep)return;m.ep=!0;const v=o(m);fetch(m.href,v)}})();const U1=!1;var Wy=Array.isArray,ik=Array.prototype.indexOf,Hy=Array.from,cy=Object.defineProperty,lu=Object.getOwnPropertyDescriptor,V1=Object.getOwnPropertyDescriptors,nk=Object.prototype,ak=Array.prototype,Xy=Object.getPrototypeOf,Uv=Object.isExtensible;function ok(i){return typeof i=="function"}const Jc=()=>{};function sk(i){return i()}function uy(i){for(var r=0;r<i.length;r++)i[r]()}function q1(){var i,r,o=new Promise((h,m)=>{i=h,r=m});return{promise:o,resolve:i,reject:r}}const gn=2,Ky=4,Lf=8,Rs=16,Vo=32,Nl=64,Yy=128,sa=256,ff=512,$i=1024,Un=2048,qo=4096,Ca=8192,Ul=16384,Df=32768,wp=65536,Vv=1<<17,lk=1<<18,Tu=1<<19,G1=1<<20,hy=1<<21,Ff=1<<22,Pl=1<<23,Ml=Symbol("$state"),ck=Symbol("legacy props"),uk=Symbol(""),Yh=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function hk(i){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function pk(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function dk(i){throw new Error("https://svelte.dev/e/effect_in_teardown")}function fk(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function mk(i){throw new Error("https://svelte.dev/e/effect_orphan")}function gk(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function yk(i){throw new Error("https://svelte.dev/e/props_invalid_value")}function _k(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function vk(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function bk(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function xk(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const wk=1,Tk=2,Sk=16,kk=1,Ck=2,Pk=4,Mk=8,Ak=16,Ek=4,Z1=1,Ik=2,Oi=Symbol(),zk="http://www.w3.org/1999/xhtml";function Rk(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}let Lk=!1;function W1(i){return i===this.v}function Dk(i,r){return i!=i?r==r:i!==r||i!==null&&typeof i=="object"||typeof i=="function"}function H1(i){return!Dk(i,this.v)}let Su=!1,Fk=!1;function jk(){Su=!0}let Br=null;function yu(i){Br=i}function Vl(i,r=!1,o){Br={p:Br,c:null,e:null,s:i,x:null,l:Su&&!r?{s:null,u:null,$:[]}:null}}function ql(i){var r=Br,o=r.e;if(o!==null){r.e=null;for(var h of o)lx(h)}return Br=r.p,{}}function Tp(){return!Su||Br!==null&&Br.l===null}let nu=[];function Ok(){var i=nu;nu=[],uy(i)}function Fl(i){if(nu.length===0){var r=nu;queueMicrotask(()=>{r===nu&&Ok()})}nu.push(i)}const Bk=new WeakMap;function X1(i){var r=Xt;if(r===null)return Qt.f|=Pl,i;if((r.f&Df)===0){if((r.f&Yy)===0)throw!r.parent&&i instanceof Error&&K1(i),i;r.b.error(i)}else _u(i,r)}function _u(i,r){for(;r!==null;){if((r.f&Yy)!==0)try{r.b.error(i);return}catch(o){i=o}r=r.parent}throw i instanceof Error&&K1(i),i}function K1(i){const r=Bk.get(i);r&&(cy(i,"message",{value:r.message}),cy(i,"stack",{value:r.stack}))}const qd=new Set;let Pi=null,py=new Set,Cs=[],Jy=null,dy=!1;class ra{current=new Map;#i=new Map;#r=new Set;#p=0;#a=null;#l=[];#n=[];#t=[];#e=[];#o=[];#c=[];skipped_effects=new Set;process(r){Cs=[];var o=ra.apply(this);for(const v of r)this.#u(v);if(this.#p===0){this.#h();var h=this.#n,m=this.#t;this.#n=[],this.#t=[],this.#e=[],Pi=null,qv(h),qv(m),this.#a?.resolve()}else this.#s(this.#n),this.#s(this.#t),this.#s(this.#e);o();for(const v of this.#l)vu(v);this.#l=[]}#u(r){r.f^=$i;for(var o=r.first;o!==null;){var h=o.f,m=(h&(Vo|Nl))!==0,v=m&&(h&$i)!==0,f=v||(h&Ca)!==0||this.skipped_effects.has(o);if(!f&&o.fn!==null){m?o.f^=$i:(h&Ky)!==0?this.#t.push(o):(h&$i)===0&&((h&Ff)!==0&&o.b?.is_pending()?this.#l.push(o):Pp(o)&&((o.f&Rs)!==0&&this.#e.push(o),vu(o)));var l=o.first;if(l!==null){o=l;continue}}var C=o.parent;for(o=o.next;o===null&&C!==null;)o=C.next,C=C.parent}}#s(r){for(const o of r)((o.f&Un)!==0?this.#o:this.#c).push(o),Ji(o,$i);r.length=0}capture(r,o){this.#i.has(r)||this.#i.set(r,o),this.current.set(r,r.v)}activate(){Pi=this}deactivate(){Pi=null}flush(){if(Cs.length>0){if(this.activate(),$k(),Pi!==null&&Pi!==this)return}else this.#p===0&&this.#h();this.deactivate();for(const r of py)if(py.delete(r),r(),Pi!==null)break}#h(){for(const r of this.#r)r();if(this.#r.clear(),qd.size>1){this.#i.clear();let r=!0;for(const o of qd){if(o===this){r=!1;continue}for(const[h,m]of this.current){if(o.current.has(h))if(r)o.current.set(h,m);else continue;Y1(h)}if(Cs.length>0){Pi=o;const h=ra.apply(o);for(const m of Cs)o.#u(m);Cs=[],h()}}Pi=null}qd.delete(this)}increment(){this.#p+=1}decrement(){this.#p-=1;for(const r of this.#o)Ji(r,Un),jl(r);for(const r of this.#c)Ji(r,qo),jl(r);this.flush()}add_callback(r){this.#r.add(r)}settled(){return(this.#a??=q1()).promise}static ensure(){if(Pi===null){const r=Pi=new ra;qd.add(Pi),ra.enqueue(()=>{Pi===r&&r.flush()})}return Pi}static enqueue(r){Fl(r)}static apply(r){return Jc}}function $k(){var i=uu;dy=!0;try{var r=0;for(Zv(!0);Cs.length>0;){var o=ra.ensure();if(r++>1e3){var h,m;Nk()}o.process(Cs),As.clear()}}finally{dy=!1,Zv(i),Jy=null}}function Nk(){try{gk()}catch(i){_u(i,Jy)}}let Sl=null;function qv(i){var r=i.length;if(r!==0){for(var o=0;o<r;){var h=i[o++];if((h.f&(Ul|Ca))===0&&Pp(h)&&(Sl=[],vu(h),h.deps===null&&h.first===null&&h.nodes_start===null&&(h.teardown===null&&h.ac===null?px(h):h.fn=null),Sl?.length>0)){As.clear();for(const m of Sl)vu(m);Sl=[]}}Sl=null}}function Y1(i){if(i.reactions!==null)for(const r of i.reactions){const o=r.f;(o&gn)!==0?Y1(r):(o&(Ff|Rs))!==0&&(Ji(r,Un),jl(r))}}function jl(i){for(var r=Jy=i;r.parent!==null;){r=r.parent;var o=r.f;if(dy&&r===Xt&&(o&Rs)!==0)return;if((o&(Nl|Vo))!==0){if((o&$i)===0)return;r.f^=$i}}Cs.push(r)}function Uk(i){let r=0,o=Ol(0),h;return()=>{e5()&&(Je(o),Of(()=>(r===0&&(h=jr(()=>i(()=>Jh(o)))),r+=1,()=>{Fl(()=>{r-=1,r===0&&(h?.(),h=void 0,Jh(o))})})))}}var Vk=wp|Tu|Yy;function qk(i,r,o){new Gk(i,r,o)}class Gk{parent;#i=!1;#r;#p=null;#a;#l;#n;#t=null;#e=null;#o=null;#c=null;#u=0;#s=0;#h=!1;#d=null;#y=()=>{this.#d&&sp(this.#d,this.#u)};#_=Uk(()=>(this.#d=Ol(this.#u),()=>{this.#d=null}));constructor(r,o,h){this.#r=r,this.#a=o,this.#l=h,this.parent=Xt.b,this.#i=!!this.#a.pending,this.#n=t0(()=>{Xt.b=this;{try{this.#t=xa(()=>h(this.#r))}catch(m){this.error(m)}this.#s>0?this.#m():this.#i=!1}},Vk)}#v(){try{this.#t=xa(()=>this.#l(this.#r))}catch(r){this.error(r)}this.#i=!1}#b(){const r=this.#a.pending;r&&(this.#e=xa(()=>r(this.#r)),ra.enqueue(()=>{this.#t=this.#f(()=>(ra.ensure(),xa(()=>this.#l(this.#r)))),this.#s>0?this.#m():(cu(this.#e,()=>{this.#e=null}),this.#i=!1)}))}is_pending(){return this.#i||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!this.#a.pending}#f(r){var o=Xt,h=Qt,m=Br;ao(this.#n),mn(this.#n),yu(this.#n.ctx);try{return r()}catch(v){return X1(v),null}finally{ao(o),mn(h),yu(m)}}#m(){const r=this.#a.pending;this.#t!==null&&(this.#c=document.createDocumentFragment(),Zk(this.#t,this.#c)),this.#e===null&&(this.#e=xa(()=>r(this.#r)))}#g(r){if(!this.has_pending_snippet()){this.parent&&this.parent.#g(r);return}this.#s+=r,this.#s===0&&(this.#i=!1,this.#e&&cu(this.#e,()=>{this.#e=null}),this.#c&&(this.#r.before(this.#c),this.#c=null),Fl(()=>{ra.ensure().flush()}))}update_pending_count(r){this.#g(r),this.#u+=r,py.add(this.#y)}get_effect_pending(){return this.#_(),Je(this.#d)}error(r){var o=this.#a.onerror;let h=this.#a.failed;if(this.#h||!o&&!h)throw r;this.#t&&(la(this.#t),this.#t=null),this.#e&&(la(this.#e),this.#e=null),this.#o&&(la(this.#o),this.#o=null);var m=!1,v=!1;const f=()=>{if(m){Rk();return}m=!0,v&&xk(),ra.ensure(),this.#u=0,this.#o!==null&&cu(this.#o,()=>{this.#o=null}),this.#i=this.has_pending_snippet(),this.#t=this.#f(()=>(this.#h=!1,xa(()=>this.#l(this.#r)))),this.#s>0?this.#m():this.#i=!1};var l=Qt;try{mn(null),v=!0,o?.(r,f),v=!1}catch(C){_u(C,this.#n&&this.#n.parent)}finally{mn(l)}h&&Fl(()=>{this.#o=this.#f(()=>{this.#h=!0;try{return xa(()=>{h(this.#r,()=>r,()=>f)})}catch(C){return _u(C,this.#n.parent),null}finally{this.#h=!1}})})}}function Zk(i,r){for(var o=i.nodes_start,h=i.nodes_end;o!==null;){var m=o===h?null:kp(o);r.append(o),o=m}}function Wk(i,r,o){const h=Tp()?jf:Qy;if(r.length===0){o(i.map(h));return}var m=Pi,v=Xt,f=Hk();Promise.all(r.map(l=>Xk(l))).then(l=>{f();try{o([...i.map(h),...l])}catch(C){(v.f&Ul)===0&&_u(C,v)}m?.deactivate(),J1()}).catch(l=>{_u(l,v)})}function Hk(){var i=Xt,r=Qt,o=Br,h=Pi;return function(){ao(i),mn(r),yu(o),h?.activate()}}function J1(){ao(null),mn(null),yu(null)}function jf(i){var r=gn|Un,o=Qt!==null&&(Qt.f&gn)!==0?Qt:null;return Xt===null||o!==null&&(o.f&sa)!==0?r|=sa:Xt.f|=Tu,{ctx:Br,deps:null,effects:null,equals:W1,f:r,fn:i,reactions:null,rv:0,v:Oi,wv:0,parent:o??Xt,ac:null}}function Xk(i,r){let o=Xt;o===null&&pk();var h=o.b,m=void 0,v=Ol(Oi),f=!Qt,l=new Map;return n5(()=>{var C=q1();m=C.promise;try{Promise.resolve(i()).then(C.resolve,C.reject)}catch(G){C.reject(G)}var M=Pi,R=h.is_pending();f&&(h.update_pending_count(1),R||(M.increment(),l.get(M)?.reject(Yh),l.set(M,C)));const j=(G,B=void 0)=>{R||M.activate(),B?B!==Yh&&(v.f|=Pl,sp(v,B)):((v.f&Pl)!==0&&(v.f^=Pl),sp(v,G)),f&&(h.update_pending_count(-1),R||M.decrement()),J1()};C.promise.then(j,G=>j(null,G||"unknown"))}),sx(()=>{for(const C of l.values())C.reject(Yh)}),new Promise(C=>{function M(R){function j(){R===m?C(v):M(m)}R.then(j,j)}M(m)})}function Qy(i){const r=jf(i);return r.equals=H1,r}function Q1(i){var r=i.effects;if(r!==null){i.effects=null;for(var o=0;o<r.length;o+=1)la(r[o])}}function Kk(i){for(var r=i.parent;r!==null;){if((r.f&gn)===0)return r;r=r.parent}return null}function e0(i){var r,o=Xt;ao(Kk(i));try{Q1(i),r=_x(i)}finally{ao(o)}return r}function ex(i){var r=e0(i);if(i.equals(r)||(i.v=r,i.wv=gx()),!Gl){var o=(Ps||(i.f&sa)!==0)&&i.deps!==null?qo:$i;Ji(i,o)}}const As=new Map;function Ol(i,r){var o={f:0,v:i,reactions:null,equals:W1,rv:0,wv:0};return o}function Ki(i,r){const o=Ol(i);return s5(o),o}function tf(i,r=!1,o=!0){const h=Ol(i);return r||(h.equals=H1),Su&&o&&Br!==null&&Br.l!==null&&(Br.l.s??=[]).push(h),h}function ti(i,r,o=!1){Qt!==null&&(!wa||(Qt.f&Vv)!==0)&&Tp()&&(Qt.f&(gn|Rs|Ff|Vv))!==0&&!jo?.includes(i)&&bk();let h=o?kl(r):r;return sp(i,h)}function sp(i,r){if(!i.equals(r)){var o=i.v;Gl?As.set(i,r):As.set(i,o),i.v=r;var h=ra.ensure();h.capture(i,o),(i.f&gn)!==0&&((i.f&Un)!==0&&e0(i),Ji(i,(i.f&sa)===0?$i:qo)),i.wv=gx(),tx(i,Un),Tp()&&Xt!==null&&(Xt.f&$i)!==0&&(Xt.f&(Vo|Nl))===0&&(Qn===null?l5([i]):Qn.push(i))}return r}function Jh(i){ti(i,i.v+1)}function tx(i,r){var o=i.reactions;if(o!==null)for(var h=Tp(),m=o.length,v=0;v<m;v++){var f=o[v],l=f.f;if(!(!h&&f===Xt)){var C=(l&Un)===0;C&&Ji(f,r),(l&gn)!==0?tx(f,qo):C&&((l&Rs)!==0&&Sl!==null&&Sl.push(f),jl(f))}}}function kl(i){if(typeof i!="object"||i===null||Ml in i)return i;const r=Xy(i);if(r!==nk&&r!==ak)return i;var o=new Map,h=Wy(i),m=Ki(0),v=Al,f=l=>{if(Al===v)return l();var C=Qt,M=Al;mn(null),Hv(v);var R=l();return mn(C),Hv(M),R};return h&&o.set("length",Ki(i.length)),new Proxy(i,{defineProperty(l,C,M){(!("value"in M)||M.configurable===!1||M.enumerable===!1||M.writable===!1)&&_k();var R=o.get(C);return R===void 0?R=f(()=>{var j=Ki(M.value);return o.set(C,j),j}):ti(R,M.value,!0),!0},deleteProperty(l,C){var M=o.get(C);if(M===void 0){if(C in l){const R=f(()=>Ki(Oi));o.set(C,R),Jh(m)}}else ti(M,Oi),Jh(m);return!0},get(l,C,M){if(C===Ml)return i;var R=o.get(C),j=C in l;if(R===void 0&&(!j||lu(l,C)?.writable)&&(R=f(()=>{var B=kl(j?l[C]:Oi),J=Ki(B);return J}),o.set(C,R)),R!==void 0){var G=Je(R);return G===Oi?void 0:G}return Reflect.get(l,C,M)},getOwnPropertyDescriptor(l,C){var M=Reflect.getOwnPropertyDescriptor(l,C);if(M&&"value"in M){var R=o.get(C);R&&(M.value=Je(R))}else if(M===void 0){var j=o.get(C),G=j?.v;if(j!==void 0&&G!==Oi)return{enumerable:!0,configurable:!0,value:G,writable:!0}}return M},has(l,C){if(C===Ml)return!0;var M=o.get(C),R=M!==void 0&&M.v!==Oi||Reflect.has(l,C);if(M!==void 0||Xt!==null&&(!R||lu(l,C)?.writable)){M===void 0&&(M=f(()=>{var G=R?kl(l[C]):Oi,B=Ki(G);return B}),o.set(C,M));var j=Je(M);if(j===Oi)return!1}return R},set(l,C,M,R){var j=o.get(C),G=C in l;if(h&&C==="length")for(var B=M;B<j.v;B+=1){var J=o.get(B+"");J!==void 0?ti(J,Oi):B in l&&(J=f(()=>Ki(Oi)),o.set(B+"",J))}if(j===void 0)(!G||lu(l,C)?.writable)&&(j=f(()=>Ki(void 0)),ti(j,kl(M)),o.set(C,j));else{G=j.v!==Oi;var le=f(()=>kl(M));ti(j,le)}var we=Reflect.getOwnPropertyDescriptor(l,C);if(we?.set&&we.set.call(R,M),!G){if(h&&typeof C=="string"){var pe=o.get("length"),xe=Number(C);Number.isInteger(xe)&&xe>=pe.v&&ti(pe,xe+1)}Jh(m)}return!0},ownKeys(l){Je(m);var C=Reflect.ownKeys(l).filter(j=>{var G=o.get(j);return G===void 0||G.v!==Oi});for(var[M,R]of o)R.v!==Oi&&!(M in l)&&C.push(M);return C},setPrototypeOf(){vk()}})}var Gv,rx,ix,nx;function Yk(){if(Gv===void 0){Gv=window,rx=/Firefox/.test(navigator.userAgent);var i=Element.prototype,r=Node.prototype,o=Text.prototype;ix=lu(r,"firstChild").get,nx=lu(r,"nextSibling").get,Uv(i)&&(i.__click=void 0,i.__className=void 0,i.__attributes=null,i.__style=void 0,i.__e=void 0),Uv(o)&&(o.__t=void 0)}}function Sp(i=""){return document.createTextNode(i)}function zo(i){return ix.call(i)}function kp(i){return nx.call(i)}function ir(i,r){return zo(i)}function fy(i,r=!1){{var o=zo(i);return o instanceof Comment&&o.data===""?kp(o):o}}function ln(i,r=1,o=!1){let h=i;for(;r--;)h=kp(h);return h}function Jk(i){i.textContent=""}function ax(){return!1}function Cp(i){var r=Qt,o=Xt;mn(null),ao(null);try{return i()}finally{mn(r),ao(o)}}function ox(i){Xt===null&&Qt===null&&mk(),Qt!==null&&(Qt.f&sa)!==0&&Xt===null&&fk(),Gl&&dk()}function Qk(i,r){var o=r.last;o===null?r.last=r.first=i:(o.next=i,i.prev=o,r.last=i)}function oo(i,r,o,h=!0){var m=Xt;m!==null&&(m.f&Ca)!==0&&(i|=Ca);var v={ctx:Br,deps:null,nodes_start:null,nodes_end:null,f:i|Un,first:null,fn:r,last:null,next:null,parent:m,b:m&&m.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(o)try{vu(v),v.f|=Df}catch(C){throw la(v),C}else r!==null&&jl(v);if(h){var f=v;if(o&&f.deps===null&&f.teardown===null&&f.nodes_start===null&&f.first===f.last&&(f.f&Tu)===0&&(f=f.first),f!==null&&(f.parent=m,m!==null&&Qk(f,m),Qt!==null&&(Qt.f&gn)!==0&&(i&Nl)===0)){var l=Qt;(l.effects??=[]).push(f)}}return v}function e5(){return Qt!==null&&!wa}function sx(i){const r=oo(Lf,null,!1);return Ji(r,$i),r.teardown=i,r}function mf(i){ox();var r=Xt.f,o=!Qt&&(r&Vo)!==0&&(r&Df)===0;if(o){var h=Br;(h.e??=[]).push(i)}else return lx(i)}function lx(i){return oo(Ky|G1,i,!1)}function t5(i){return ox(),oo(Lf|G1,i,!0)}function r5(i){ra.ensure();const r=oo(Nl|Tu,i,!0);return(o={})=>new Promise(h=>{o.outro?cu(r,()=>{la(r),h(void 0)}):(la(r),h(void 0))})}function cx(i){return oo(Ky,i,!1)}function Sg(i,r){var o=Br,h={effect:null,ran:!1,deps:i};o.l.$.push(h),h.effect=Of(()=>{i(),!h.ran&&(h.ran=!0,jr(r))})}function i5(){var i=Br;Of(()=>{for(var r of i.l.$){r.deps();var o=r.effect;(o.f&$i)!==0&&Ji(o,qo),Pp(o)&&vu(o),r.ran=!1}})}function n5(i){return oo(Ff|Tu,i,!0)}function Of(i,r=0){return oo(Lf|r,i,!0)}function Fo(i,r=[],o=[]){Wk(r,o,h=>{oo(Lf,()=>i(...h.map(Je)),!0)})}function t0(i,r=0){var o=oo(Rs|r,i,!0);return o}function xa(i,r=!0){return oo(Vo|Tu,i,!0,r)}function ux(i){var r=i.teardown;if(r!==null){const o=Gl,h=Qt;Wv(!0),mn(null);try{r.call(null)}finally{Wv(o),mn(h)}}}function hx(i,r=!1){var o=i.first;for(i.first=i.last=null;o!==null;){const m=o.ac;m!==null&&Cp(()=>{m.abort(Yh)});var h=o.next;(o.f&Nl)!==0?o.parent=null:la(o,r),o=h}}function a5(i){for(var r=i.first;r!==null;){var o=r.next;(r.f&Vo)===0&&la(r),r=o}}function la(i,r=!0){var o=!1;(r||(i.f&lk)!==0)&&i.nodes_start!==null&&i.nodes_end!==null&&(o5(i.nodes_start,i.nodes_end),o=!0),hx(i,r&&!o),gf(i,0),Ji(i,Ul);var h=i.transitions;if(h!==null)for(const v of h)v.stop();ux(i);var m=i.parent;m!==null&&m.first!==null&&px(i),i.next=i.prev=i.teardown=i.ctx=i.deps=i.fn=i.nodes_start=i.nodes_end=i.ac=null}function o5(i,r){for(;i!==null;){var o=i===r?null:kp(i);i.remove(),i=o}}function px(i){var r=i.parent,o=i.prev,h=i.next;o!==null&&(o.next=h),h!==null&&(h.prev=o),r!==null&&(r.first===i&&(r.first=h),r.last===i&&(r.last=o))}function cu(i,r){var o=[];r0(i,o,!0),dx(o,()=>{la(i),r&&r()})}function dx(i,r){var o=i.length;if(o>0){var h=()=>--o||r();for(var m of i)m.out(h)}else r()}function r0(i,r,o){if((i.f&Ca)===0){if(i.f^=Ca,i.transitions!==null)for(const f of i.transitions)(f.is_global||o)&&r.push(f);for(var h=i.first;h!==null;){var m=h.next,v=(h.f&wp)!==0||(h.f&Vo)!==0;r0(h,r,v?o:!1),h=m}}}function i0(i){fx(i,!0)}function fx(i,r){if((i.f&Ca)!==0){i.f^=Ca,(i.f&$i)===0&&(Ji(i,Un),jl(i));for(var o=i.first;o!==null;){var h=o.next,m=(o.f&wp)!==0||(o.f&Vo)!==0;fx(o,m?r:!1),o=h}if(i.transitions!==null)for(const v of i.transitions)(v.is_global||r)&&v.in()}}let uu=!1;function Zv(i){uu=i}let Gl=!1;function Wv(i){Gl=i}let Qt=null,wa=!1;function mn(i){Qt=i}let Xt=null;function ao(i){Xt=i}let jo=null;function s5(i){Qt!==null&&(jo===null?jo=[i]:jo.push(i))}let sn=null,Fn=0,Qn=null;function l5(i){Qn=i}let mx=1,lp=0,Al=lp;function Hv(i){Al=i}let Ps=!1;function gx(){return++mx}function Pp(i){var r=i.f;if((r&Un)!==0)return!0;if((r&qo)!==0){var o=i.deps,h=(r&sa)!==0;if(o!==null){var m,v,f=(r&ff)!==0,l=h&&Xt!==null&&!Ps,C=o.length;if((f||l)&&(Xt===null||(Xt.f&Ul)===0)){var M=i,R=M.parent;for(m=0;m<C;m++)v=o[m],(f||!v?.reactions?.includes(M))&&(v.reactions??=[]).push(M);f&&(M.f^=ff),l&&R!==null&&(R.f&sa)===0&&(M.f^=sa)}for(m=0;m<C;m++)if(v=o[m],Pp(v)&&ex(v),v.wv>i.wv)return!0}(!h||Xt!==null&&!Ps)&&Ji(i,$i)}return!1}function yx(i,r,o=!0){var h=i.reactions;if(h!==null&&!jo?.includes(i))for(var m=0;m<h.length;m++){var v=h[m];(v.f&gn)!==0?yx(v,r,!1):r===v&&(o?Ji(v,Un):(v.f&$i)!==0&&Ji(v,qo),jl(v))}}function _x(i){var r=sn,o=Fn,h=Qn,m=Qt,v=Ps,f=jo,l=Br,C=wa,M=Al,R=i.f;sn=null,Fn=0,Qn=null,Ps=(R&sa)!==0&&(wa||!uu||Qt===null),Qt=(R&(Vo|Nl))===0?i:null,jo=null,yu(i.ctx),wa=!1,Al=++lp,i.ac!==null&&(Cp(()=>{i.ac.abort(Yh)}),i.ac=null);try{i.f|=hy;var j=i.fn,G=j(),B=i.deps;if(sn!==null){var J;if(gf(i,Fn),B!==null&&Fn>0)for(B.length=Fn+sn.length,J=0;J<sn.length;J++)B[Fn+J]=sn[J];else i.deps=B=sn;if(!Ps||(R&gn)!==0&&i.reactions!==null)for(J=Fn;J<B.length;J++)(B[J].reactions??=[]).push(i)}else B!==null&&Fn<B.length&&(gf(i,Fn),B.length=Fn);if(Tp()&&Qn!==null&&!wa&&B!==null&&(i.f&(gn|qo|Un))===0)for(J=0;J<Qn.length;J++)yx(Qn[J],i);return m!==null&&m!==i&&(lp++,Qn!==null&&(h===null?h=Qn:h.push(...Qn))),(i.f&Pl)!==0&&(i.f^=Pl),G}catch(le){return X1(le)}finally{i.f^=hy,sn=r,Fn=o,Qn=h,Qt=m,Ps=v,jo=f,yu(l),wa=C,Al=M}}function c5(i,r){let o=r.reactions;if(o!==null){var h=ik.call(o,i);if(h!==-1){var m=o.length-1;m===0?o=r.reactions=null:(o[h]=o[m],o.pop())}}o===null&&(r.f&gn)!==0&&(sn===null||!sn.includes(r))&&(Ji(r,qo),(r.f&(sa|ff))===0&&(r.f^=ff),Q1(r),gf(r,0))}function gf(i,r){var o=i.deps;if(o!==null)for(var h=r;h<o.length;h++)c5(i,o[h])}function vu(i){var r=i.f;if((r&Ul)===0){Ji(i,$i);var o=Xt,h=uu;Xt=i,uu=!0;try{(r&Rs)!==0?a5(i):hx(i),ux(i);var m=_x(i);i.teardown=typeof m=="function"?m:null,i.wv=mx;var v;U1&&Fk&&(i.f&Un)!==0&&i.deps}finally{uu=h,Xt=o}}}function Je(i){var r=i.f,o=(r&gn)!==0;if(Qt!==null&&!wa){var h=Xt!==null&&(Xt.f&Ul)!==0;if(!h&&!jo?.includes(i)){var m=Qt.deps;if((Qt.f&hy)!==0)i.rv<lp&&(i.rv=lp,sn===null&&m!==null&&m[Fn]===i?Fn++:sn===null?sn=[i]:(!Ps||!sn.includes(i))&&sn.push(i));else{(Qt.deps??=[]).push(i);var v=i.reactions;v===null?i.reactions=[Qt]:v.includes(Qt)||v.push(Qt)}}}else if(o&&i.deps===null&&i.effects===null){var f=i,l=f.parent;l!==null&&(l.f&sa)===0&&(f.f^=sa)}if(Gl){if(As.has(i))return As.get(i);if(o){f=i;var C=f.v;return((f.f&$i)===0&&f.reactions!==null||vx(f))&&(C=e0(f)),As.set(f,C),C}}else o&&(f=i,Pp(f)&&ex(f));if((i.f&Pl)!==0)throw i.v;return i.v}function vx(i){if(i.v===Oi)return!0;if(i.deps===null)return!1;for(const r of i.deps)if(As.has(r)||(r.f&gn)!==0&&vx(r))return!0;return!1}function jr(i){var r=wa;try{return wa=!0,i()}finally{wa=r}}const u5=-7169;function Ji(i,r){i.f=i.f&u5|r}function Ss(i){if(!(typeof i!="object"||!i||i instanceof EventTarget)){if(Ml in i)my(i);else if(!Array.isArray(i))for(let r in i){const o=i[r];typeof o=="object"&&o&&Ml in o&&my(o)}}}function my(i,r=new Set){if(typeof i=="object"&&i!==null&&!(i instanceof EventTarget)&&!r.has(i)){r.add(i),i instanceof Date&&i.getTime();for(let h in i)try{my(i[h],r)}catch{}const o=Xy(i);if(o!==Object.prototype&&o!==Array.prototype&&o!==Map.prototype&&o!==Set.prototype&&o!==Date.prototype){const h=V1(o);for(let m in h){const v=h[m].get;if(v)try{v.call(i)}catch{}}}}}const h5=["touchstart","touchmove"];function p5(i){return h5.includes(i)}const bx=new Set,gy=new Set;function d5(i,r,o,h={}){function m(v){if(h.capture||Uh.call(r,v),!v.cancelBubble)return Cp(()=>o?.call(this,v))}return i.startsWith("pointer")||i.startsWith("touch")||i==="wheel"?Fl(()=>{r.addEventListener(i,m,h)}):r.addEventListener(i,m,h),m}function f5(i,r,o,h,m){var v={capture:h,passive:m},f=d5(i,r,o,v);(r===document.body||r===window||r===document||r instanceof HTMLMediaElement)&&sx(()=>{r.removeEventListener(i,f,v)})}function xx(i){for(var r=0;r<i.length;r++)bx.add(i[r]);for(var o of gy)o(i)}let Xv=null;function Uh(i){var r=this,o=r.ownerDocument,h=i.type,m=i.composedPath?.()||[],v=m[0]||i.target;Xv=i;var f=0,l=Xv===i&&i.__root;if(l){var C=m.indexOf(l);if(C!==-1&&(r===document||r===window)){i.__root=r;return}var M=m.indexOf(r);if(M===-1)return;C<=M&&(f=C)}if(v=m[f]||i.target,v!==r){cy(i,"currentTarget",{configurable:!0,get(){return v||o}});var R=Qt,j=Xt;mn(null),ao(null);try{for(var G,B=[];v!==null;){var J=v.assignedSlot||v.parentNode||v.host||null;try{var le=v["__"+h];if(le!=null&&(!v.disabled||i.target===v))if(Wy(le)){var[we,...pe]=le;we.apply(v,[i,...pe])}else le.call(v,i)}catch(xe){G?B.push(xe):G=xe}if(i.cancelBubble||J===r||J===null)break;v=J}if(G){for(let xe of B)queueMicrotask(()=>{throw xe});throw G}}finally{i.__root=r,delete i.currentTarget,mn(R),ao(j)}}}function wx(i){var r=document.createElement("template");return r.innerHTML=i.replaceAll("<!>","<!---->"),r.content}function cp(i,r){var o=Xt;o.nodes_start===null&&(o.nodes_start=i,o.nodes_end=r)}function Ma(i,r){var o=(r&Z1)!==0,h=(r&Ik)!==0,m,v=!i.startsWith("<!>");return()=>{m===void 0&&(m=wx(v?i:"<!>"+i),o||(m=zo(m)));var f=h||rx?document.importNode(m,!0):m.cloneNode(!0);if(o){var l=zo(f),C=f.lastChild;cp(l,C)}else cp(f,f);return f}}function m5(i,r,o="svg"){var h=!i.startsWith("<!>"),m=(r&Z1)!==0,v=`<${o}>${h?i:"<!>"+i}</${o}>`,f;return()=>{if(!f){var l=wx(v),C=zo(l);if(m)for(f=document.createDocumentFragment();zo(C);)f.appendChild(zo(C));else f=zo(C)}var M=f.cloneNode(!0);if(m){var R=zo(M),j=M.lastChild;cp(R,j)}else cp(M,M);return M}}function Bf(i,r){return m5(i,r,"svg")}function g5(){var i=document.createDocumentFragment(),r=document.createComment(""),o=Sp();return i.append(r,o),cp(r,o),i}function Yi(i,r){i!==null&&i.before(r)}let yy=!0;function yf(i,r){var o=r==null?"":typeof r=="object"?r+"":r;o!==(i.__t??=i.nodeValue)&&(i.__t=o,i.nodeValue=o+"")}function y5(i,r){return _5(i,r)}const Hc=new Map;function _5(i,{target:r,anchor:o,props:h={},events:m,context:v,intro:f=!0}){Yk();var l=new Set,C=j=>{for(var G=0;G<j.length;G++){var B=j[G];if(!l.has(B)){l.add(B);var J=p5(B);r.addEventListener(B,Uh,{passive:J});var le=Hc.get(B);le===void 0?(document.addEventListener(B,Uh,{passive:J}),Hc.set(B,1)):Hc.set(B,le+1)}}};C(Hy(bx)),gy.add(C);var M=void 0,R=r5(()=>{var j=o??r.appendChild(Sp());return qk(j,{pending:()=>{}},G=>{if(v){Vl({});var B=Br;B.c=v}m&&(h.$$events=m),yy=f,M=i(G,h)||{},yy=!0,v&&ql()}),()=>{for(var G of l){r.removeEventListener(G,Uh);var B=Hc.get(G);--B===0?(document.removeEventListener(G,Uh),Hc.delete(G)):Hc.set(G,B)}gy.delete(C),j!==o&&j.parentNode?.removeChild(j)}});return v5.set(M,R),M}let v5=new WeakMap;function Es(i,r,o=!1){var h=i,m=null,v=null,f=Oi,l=o?wp:0,C=!1;const M=(B,J=!0)=>{C=!0,G(J,B)};var R=null;function j(){R!==null&&(R.lastChild.remove(),h.before(R),R=null);var B=f?m:v,J=f?v:m;B&&i0(B),J&&cu(J,()=>{f?v=null:m=null})}const G=(B,J)=>{if(f!==(f=B)){var le=ax(),we=h;if(le&&(R=document.createDocumentFragment(),R.append(we=Sp())),f?m??=J&&xa(()=>J(we)):v??=J&&xa(()=>J(we)),le){var pe=Pi,xe=f?m:v,de=f?v:m;xe&&pe.skipped_effects.delete(xe),de&&pe.skipped_effects.add(de),pe.add_callback(j)}else j()}};t0(()=>{C=!1,r(M),C||G(null,null)},l)}function Tx(i,r){return r}function b5(i,r,o){for(var h=i.items,m=[],v=r.length,f=0;f<v;f++)r0(r[f].e,m,!0);var l=v>0&&m.length===0&&o!==null;if(l){var C=o.parentNode;Jk(C),C.append(o),h.clear(),Ja(i,r[0].prev,r[v-1].next)}dx(m,()=>{for(var M=0;M<v;M++){var R=r[M];l||(h.delete(R.k),Ja(i,R.prev,R.next)),la(R.e,!l)}})}function Sx(i,r,o,h,m,v=null){var f=i,l={flags:r,items:new Map,first:null};{var C=i;f=C.appendChild(Sp())}var M=null,R=!1,j=new Map,G=Qy(()=>{var we=o();return Wy(we)?we:we==null?[]:Hy(we)}),B,J;function le(){x5(J,B,l,j,f,m,r,h,o),v!==null&&(B.length===0?M?i0(M):M=xa(()=>v(f)):M!==null&&cu(M,()=>{M=null}))}t0(()=>{J??=Xt,B=Je(G);var we=B.length;if(!(R&&we===0)){R=we===0;var pe,xe,de,he;if(ax()){var fe=new Set,Ae=Pi;for(xe=0;xe<we;xe+=1){de=B[xe],he=h(de,xe);var Fe=l.items.get(he)??j.get(he);Fe?kx(Fe,de,xe):(pe=Cx(null,l,null,null,de,he,xe,m,r,o,!0),j.set(he,pe)),fe.add(he)}for(const[He,rt]of l.items)fe.has(He)||Ae.skipped_effects.add(rt.e);Ae.add_callback(le)}else le();Je(G)}})}function x5(i,r,o,h,m,v,f,l,C){var M=r.length,R=o.items,j=o.first,G=j,B,J=null,le=[],we=[],pe,xe,de,he;for(he=0;he<M;he+=1){if(pe=r[he],xe=l(pe,he),de=R.get(xe),de===void 0){var fe=h.get(xe);if(fe!==void 0){h.delete(xe),R.set(xe,fe);var Ae=J?J.next:G;Ja(o,J,fe),Ja(o,fe,Ae),kg(fe,Ae,m),J=fe}else{var Fe=G?G.e.nodes_start:m;J=Cx(Fe,o,J,J===null?o.first:J.next,pe,xe,he,v,f,C)}R.set(xe,J),le=[],we=[],G=J.next;continue}if(kx(de,pe,he),(de.e.f&Ca)!==0&&i0(de.e),de!==G){if(B!==void 0&&B.has(de)){if(le.length<we.length){var He=we[0],rt;J=He.prev;var et=le[0],It=le[le.length-1];for(rt=0;rt<le.length;rt+=1)kg(le[rt],He,m);for(rt=0;rt<we.length;rt+=1)B.delete(we[rt]);Ja(o,et.prev,It.next),Ja(o,J,et),Ja(o,It,He),G=He,J=It,he-=1,le=[],we=[]}else B.delete(de),kg(de,G,m),Ja(o,de.prev,de.next),Ja(o,de,J===null?o.first:J.next),Ja(o,J,de),J=de;continue}for(le=[],we=[];G!==null&&G.k!==xe;)(G.e.f&Ca)===0&&(B??=new Set).add(G),we.push(G),G=G.next;if(G===null)continue;de=G}le.push(de),J=de,G=de.next}if(G!==null||B!==void 0){for(var bt=B===void 0?[]:Hy(B);G!==null;)(G.e.f&Ca)===0&&bt.push(G),G=G.next;var er=bt.length;if(er>0){var dr=M===0?m:null;b5(o,bt,dr)}}i.first=o.first&&o.first.e,i.last=J&&J.e;for(var Lr of h.values())la(Lr.e);h.clear()}function kx(i,r,o,h){sp(i.v,r),i.i=o}function Cx(i,r,o,h,m,v,f,l,C,M,R){var j=(C&wk)!==0,G=(C&Sk)===0,B=j?G?tf(m,!1,!1):Ol(m):m,J=(C&Tk)===0?f:Ol(f),le={i:J,v:B,k:v,a:null,e:null,prev:o,next:h};try{if(i===null){var we=document.createDocumentFragment();we.append(i=Sp())}return le.e=xa(()=>l(i,B,J,M),Lk),le.e.prev=o&&o.e,le.e.next=h&&h.e,o===null?R||(r.first=le):(o.next=le,o.e.next=le.e),h!==null&&(h.prev=le,h.e.prev=le.e),le}finally{}}function kg(i,r,o){for(var h=i.next?i.next.e.nodes_start:o,m=r?r.e.nodes_start:o,v=i.e.nodes_start;v!==null&&v!==h;){var f=kp(v);m.before(v),v=f}}function Ja(i,r,o){r===null?i.first=o:(r.next=o,r.e.next=o&&o.e),o!==null&&(o.prev=r,o.e.prev=r&&r.e)}const Kv=[...` 	
\r\fÂ \v\uFEFF`];function w5(i,r,o){var h=i==null?"":""+i;if(r&&(h=h?h+" "+r:r),o){for(var m in o)if(o[m])h=h?h+" "+m:m;else if(h.length)for(var v=m.length,f=0;(f=h.indexOf(m,f))>=0;){var l=f+v;(f===0||Kv.includes(h[f-1]))&&(l===h.length||Kv.includes(h[l]))?h=(f===0?"":h.substring(0,f))+h.substring(l+1):f=l}}return h===""?null:h}function T5(i,r){return i==null?null:String(i)}function $f(i,r,o,h,m,v){var f=i.__className;if(f!==o||f===void 0){var l=w5(o,h,v);l==null?i.removeAttribute("class"):r?i.className=l:i.setAttribute("class",l),i.__className=o}else if(v&&m!==v)for(var C in v){var M=!!v[C];(m==null||M!==!!m[C])&&i.classList.toggle(C,M)}return v}function n0(i,r,o,h){var m=i.__style;if(m!==r){var v=T5(r);v==null?i.removeAttribute("style"):i.style.cssText=v,i.__style=r}return h}const S5=Symbol("is custom element"),k5=Symbol("is html");function yi(i,r,o,h){var m=C5(i);m[r]!==(m[r]=o)&&(r==="loading"&&(i[uk]=o),o==null?i.removeAttribute(r):typeof o!="string"&&P5(i).includes(r)?i[r]=o:i.setAttribute(r,o))}function C5(i){return i.__attributes??={[S5]:i.nodeName.includes("-"),[k5]:i.namespaceURI===zk}}var Yv=new Map;function P5(i){var r=i.getAttribute("is")||i.nodeName,o=Yv.get(r);if(o)return o;Yv.set(r,o=[]);for(var h,m=i,v=Element.prototype;v!==m;){h=V1(m);for(var f in h)h[f].set&&o.push(f);m=Xy(m)}return o}const M5=()=>performance.now(),Ro={tick:i=>requestAnimationFrame(i),now:()=>M5(),tasks:new Set};function Px(){const i=Ro.now();Ro.tasks.forEach(r=>{r.c(i)||(Ro.tasks.delete(r),r.f())}),Ro.tasks.size!==0&&Ro.tick(Px)}function A5(i){let r;return Ro.tasks.size===0&&Ro.tick(Px),{promise:new Promise(o=>{Ro.tasks.add(r={c:i,f:o})}),abort(){Ro.tasks.delete(r)}}}function Gd(i,r){Cp(()=>{i.dispatchEvent(new CustomEvent(r))})}function E5(i){if(i==="float")return"cssFloat";if(i==="offset")return"cssOffset";if(i.startsWith("--"))return i;const r=i.split("-");return r.length===1?r[0]:r[0]+r.slice(1).map(o=>o[0].toUpperCase()+o.slice(1)).join("")}function Jv(i){const r={},o=i.split(";");for(const h of o){const[m,v]=h.split(":");if(!m||v===void 0)break;const f=E5(m.trim());r[f]=v.trim()}return r}const I5=i=>i;function z5(i,r,o,h){var m=(i&Ek)!==0,v="both",f,l=r.inert,C=r.style.overflow,M,R;function j(){return Cp(()=>f??=o()(r,h?.()??{},{direction:v}))}var G={is_global:m,in(){r.inert=l,Gd(r,"introstart"),M=_y(r,j(),R,1,()=>{Gd(r,"introend"),M?.abort(),M=f=void 0,r.style.overflow=C})},out(we){r.inert=!0,Gd(r,"outrostart"),R=_y(r,j(),M,0,()=>{Gd(r,"outroend"),we?.()})},stop:()=>{M?.abort(),R?.abort()}},B=Xt;if((B.transitions??=[]).push(G),yy){var J=m;if(!J){for(var le=B.parent;le&&(le.f&wp)!==0;)for(;(le=le.parent)&&(le.f&Rs)===0;);J=!le||(le.f&Df)!==0}J&&cx(()=>{jr(()=>G.in())})}}function _y(i,r,o,h,m){var v=h===1;if(ok(r)){var f,l=!1;return Fl(()=>{if(!l){var we=r({direction:v?"in":"out"});f=_y(i,we,o,h,m)}}),{abort:()=>{l=!0,f?.abort()},deactivate:()=>f.deactivate(),reset:()=>f.reset(),t:()=>f.t()}}if(o?.deactivate(),!r?.duration)return m(),{abort:Jc,deactivate:Jc,reset:Jc,t:()=>h};const{delay:C=0,css:M,tick:R,easing:j=I5}=r;var G=[];if(v&&o===void 0&&(R&&R(0,1),M)){var B=Jv(M(0,1));G.push(B,B)}var J=()=>1-h,le=i.animate(G,{duration:C,fill:"forwards"});return le.onfinish=()=>{le.cancel();var we=o?.t()??1-h;o?.abort();var pe=h-we,xe=r.duration*Math.abs(pe),de=[];if(xe>0){var he=!1;if(M)for(var fe=Math.ceil(xe/16.666666666666668),Ae=0;Ae<=fe;Ae+=1){var Fe=we+pe*j(Ae/fe),He=Jv(M(Fe,1-Fe));de.push(He),he||=He.overflow==="hidden"}he&&(i.style.overflow="hidden"),J=()=>{var rt=le.currentTime;return we+pe*j(rt/xe)},R&&A5(()=>{if(le.playState!=="running")return!1;var rt=J();return R(rt,1-rt),!0})}le=i.animate(de,{duration:xe,fill:"forwards"}),le.onfinish=()=>{J=()=>h,R?.(h,1-h),m()}},{abort:()=>{le&&(le.cancel(),le.effect=null,le.onfinish=Jc)},deactivate:()=>{m=Jc},reset:()=>{h===0&&R?.(1,0)},t:()=>J()}}function Qv(i,r){return i===r||i?.[Ml]===r}function Mx(i={},r,o,h){return cx(()=>{var m,v;return Of(()=>{m=v,v=[],jr(()=>{i!==o(...v)&&(r(i,...v),m&&Qv(o(...m),i)&&r(null,...m))})}),()=>{Fl(()=>{v&&Qv(o(...v),i)&&r(null,...v)})}}),i}function R5(i=!1){const r=Br,o=r.l.u;if(!o)return;let h=()=>Ss(r.s);if(i){let m=0,v={};const f=jf(()=>{let l=!1;const C=r.s;for(const M in C)C[M]!==v[M]&&(v[M]=C[M],l=!0);return l&&m++,m});h=()=>Je(f)}o.b.length&&t5(()=>{eb(r,h),uy(o.b)}),mf(()=>{const m=jr(()=>o.m.map(sk));return()=>{for(const v of m)typeof v=="function"&&v()}}),o.a.length&&mf(()=>{eb(r,h),uy(o.a)})}function eb(i,r){if(i.l.s)for(const o of i.l.s)Je(o);r()}let Zd=!1;function L5(i){var r=Zd;try{return Zd=!1,[i(),Zd]}finally{Zd=r}}function Zr(i,r,o,h){var m=!Su||(o&Ck)!==0,v=(o&Mk)!==0,f=(o&Ak)!==0,l=h,C=!0,M=()=>(C&&(C=!1,l=f?jr(h):h),l),R;if(v){var j=Ml in i||ck in i;R=lu(i,r)?.set??(j&&r in i?de=>i[r]=de:void 0)}var G,B=!1;v?[G,B]=L5(()=>i[r]):G=i[r],G===void 0&&h!==void 0&&(G=M(),R&&(m&&yk(),R(G)));var J;if(m?J=()=>{var de=i[r];return de===void 0?M():(C=!0,de)}:J=()=>{var de=i[r];return de!==void 0&&(l=void 0),de===void 0?l:de},m&&(o&Pk)===0)return J;if(R){var le=i.$$legacy;return(function(de,he){return arguments.length>0?((!m||!he||le||B)&&R(he?J():de),de):J()})}var we=!1,pe=((o&kk)!==0?jf:Qy)(()=>(we=!1,J()));v&&Je(pe);var xe=Xt;return(function(de,he){if(arguments.length>0){const fe=he?Je(pe):m&&v?kl(de):de;return ti(pe,fe),we=!0,l!==void 0&&(l=fe),de}return Gl&&we||(xe.f&Ul)!==0?pe.v:Je(pe)})}function a0(i){Br===null&&hk(),Su&&Br.l!==null?D5(Br).m.push(i):mf(()=>{const r=jr(i);if(typeof r=="function")return r})}function D5(i){var r=i.l;return r.u??={a:[],b:[],m:[]}}const F5="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(F5);function Ax(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var rf={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.6.2/LICENSE.txt
 */var j5=rf.exports,tb;function O5(){return tb||(tb=1,(function(i,r){(function(o,h){i.exports=h()})(j5,(function(){var o={},h={};function m(f,l,C){if(h[f]=C,f==="index"){var M="var sharedModule = {}; ("+h.shared+")(sharedModule); ("+h.worker+")(sharedModule);",R={};return h.shared(R),h.index(o,R),typeof window<"u"&&o.setWorkerUrl(window.URL.createObjectURL(new Blob([M],{type:"text/javascript"}))),o}}m("shared",["exports"],(function(f){function l(a,t,n,c){return new(n||(n=Promise))((function(p,_){function b(P){try{T(c.next(P))}catch(E){_(E)}}function w(P){try{T(c.throw(P))}catch(E){_(E)}}function T(P){var E;P.done?p(P.value):(E=P.value,E instanceof n?E:new n((function(z){z(E)}))).then(b,w)}T((c=c.apply(a,t||[])).next())}))}function C(a,t){this.x=a,this.y=t}function M(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var R,j;typeof SuppressedError=="function"&&SuppressedError,C.prototype={clone(){return new C(this.x,this.y)},add(a){return this.clone()._add(a)},sub(a){return this.clone()._sub(a)},multByPoint(a){return this.clone()._multByPoint(a)},divByPoint(a){return this.clone()._divByPoint(a)},mult(a){return this.clone()._mult(a)},div(a){return this.clone()._div(a)},rotate(a){return this.clone()._rotate(a)},rotateAround(a,t){return this.clone()._rotateAround(a,t)},matMult(a){return this.clone()._matMult(a)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(a){return this.x===a.x&&this.y===a.y},dist(a){return Math.sqrt(this.distSqr(a))},distSqr(a){const t=a.x-this.x,n=a.y-this.y;return t*t+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith(a){return this.angleWithSep(a.x,a.y)},angleWithSep(a,t){return Math.atan2(this.x*t-this.y*a,this.x*a+this.y*t)},_matMult(a){const t=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=t,this},_add(a){return this.x+=a.x,this.y+=a.y,this},_sub(a){return this.x-=a.x,this.y-=a.y,this},_mult(a){return this.x*=a,this.y*=a,this},_div(a){return this.x/=a,this.y/=a,this},_multByPoint(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint(a){return this.x/=a.x,this.y/=a.y,this},_unit(){return this._div(this.mag()),this},_perp(){const a=this.y;return this.y=this.x,this.x=-a,this},_rotate(a){const t=Math.cos(a),n=Math.sin(a),c=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=c,this},_rotateAround(a,t){const n=Math.cos(a),c=Math.sin(a),p=t.y+c*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-c*(this.y-t.y),this.y=p,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:C},C.convert=function(a){if(a instanceof C)return a;if(Array.isArray(a))return new C(+a[0],+a[1]);if(a.x!==void 0&&a.y!==void 0)return new C(+a.x,+a.y);throw new Error("Expected [x, y] or {x, y} point format")};var G=(function(){if(j)return R;function a(t,n,c,p){this.cx=3*t,this.bx=3*(c-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(p-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=c,this.p2y=p}return j=1,R=a,a.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,n){if(n===void 0&&(n=1e-6),t<0)return 0;if(t>1)return 1;for(var c=t,p=0;p<8;p++){var _=this.sampleCurveX(c)-t;if(Math.abs(_)<n)return c;var b=this.sampleCurveDerivativeX(c);if(Math.abs(b)<1e-6)break;c-=_/b}var w=0,T=1;for(c=t,p=0;p<20&&(_=this.sampleCurveX(c),!(Math.abs(_-t)<n));p++)t>_?w=c:T=c,c=.5*(T-w)+w;return c},solve:function(t,n){return this.sampleCurveY(this.solveCurveX(t,n))}},R})(),B=M(G);let J,le;function we(){return J==null&&(J=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),J}function pe(){if(le==null&&(le=!1,we())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let c=0;c<25;c++){const p=4*c;t.fillStyle=`rgb(${p},${p+1},${p+2})`,t.fillRect(c%5,Math.floor(c/5),1,1)}const n=t.getImageData(0,0,5,5).data;for(let c=0;c<100;c++)if(c%4!=3&&n[c]!==c){le=!0;break}}}return le||!1}var xe=1e-6,de=typeof Float32Array<"u"?Float32Array:Array;function he(){var a=new de(9);return de!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function fe(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Ae(){var a=new de(3);return de!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function Fe(a){return Math.hypot(a[0],a[1],a[2])}function He(a,t,n){var c=new de(3);return c[0]=a,c[1]=t,c[2]=n,c}function rt(a,t,n){return a[0]=t[0]+n[0],a[1]=t[1]+n[1],a[2]=t[2]+n[2],a}function et(a,t,n){return a[0]=t[0]*n,a[1]=t[1]*n,a[2]=t[2]*n,a}function It(a,t,n){var c=t[0],p=t[1],_=t[2],b=n[0],w=n[1],T=n[2];return a[0]=p*T-_*w,a[1]=_*b-c*T,a[2]=c*w-p*b,a}Math.hypot||(Math.hypot=function(){for(var a=0,t=arguments.length;t--;)a+=arguments[t]*arguments[t];return Math.sqrt(a)});var bt,er=Fe;function dr(a,t,n){var c=t[0],p=t[1],_=t[2],b=t[3];return a[0]=n[0]*c+n[4]*p+n[8]*_+n[12]*b,a[1]=n[1]*c+n[5]*p+n[9]*_+n[13]*b,a[2]=n[2]*c+n[6]*p+n[10]*_+n[14]*b,a[3]=n[3]*c+n[7]*p+n[11]*_+n[15]*b,a}function Lr(){var a=new de(4);return de!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function hi(a,t,n,c){var p=.5*Math.PI/180;t*=p,n*=p,c*=p;var _=Math.sin(t),b=Math.cos(t),w=Math.sin(n),T=Math.cos(n),P=Math.sin(c),E=Math.cos(c);return a[0]=_*T*E-b*w*P,a[1]=b*w*E+_*T*P,a[2]=b*T*P-_*w*E,a[3]=b*T*E+_*w*P,a}function bi(){var a=new de(2);return de!=Float32Array&&(a[0]=0,a[1]=0),a}function fr(a,t){var n=new de(2);return n[0]=a,n[1]=t,n}Ae(),bt=new de(4),de!=Float32Array&&(bt[0]=0,bt[1]=0,bt[2]=0,bt[3]=0),Ae(),He(1,0,0),He(0,1,0),Lr(),Lr(),he(),bi();const At=8192;function Qe(a,t,n){return t*(At/(a.tileSize*Math.pow(2,n-a.tileID.overscaledZ)))}function lt(a,t){return(a%t+t)%t}function xt(a,t,n){return a*(1-n)+t*n}function gt(a){if(a<=0)return 0;if(a>=1)return 1;const t=a*a,n=t*a;return 4*(a<.5?n:3*(a-t)+n-.75)}function yt(a,t,n,c){const p=new B(a,t,n,c);return _=>p.solve(_)}const Kt=yt(.25,.1,.25,1);function Et(a,t,n){return Math.min(n,Math.max(t,a))}function br(a,t,n){const c=n-t,p=((a-t)%c+c)%c+t;return p===t?n:p}function nr(a,...t){for(const n of t)for(const c in n)a[c]=n[c];return a}let Mr=1;function xi(a,t,n){const c={};for(const p in a)c[p]=t.call(this,a[p],p,a);return c}function Tr(a,t,n){const c={};for(const p in a)t.call(this,a[p],p,a)&&(c[p]=a[p]);return c}function gr(a){return Array.isArray(a)?a.map(gr):typeof a=="object"&&a?xi(a,gr):a}const Yt={};function ar(a){Yt[a]||(typeof console<"u"&&console.warn(a),Yt[a]=!0)}function Hr(a,t,n){return(n.y-a.y)*(t.x-a.x)>(t.y-a.y)*(n.x-a.x)}function qi(a){return typeof WorkerGlobalScope<"u"&&a!==void 0&&a instanceof WorkerGlobalScope}let so=null;function qn(a){return typeof ImageBitmap<"u"&&a instanceof ImageBitmap}const Gn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Zo(a,t,n,c,p){return l(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const _=new VideoFrame(a,{timestamp:0});try{const b=_?.format;if(!b||!b.startsWith("BGR")&&!b.startsWith("RGB"))throw new Error(`Unrecognized format ${b}`);const w=b.startsWith("BGR"),T=new Uint8ClampedArray(c*p*4);if(yield _.copyTo(T,(function(P,E,z,F,$){const N=4*Math.max(-E,0),q=(Math.max(0,z)-z)*F*4+N,H=4*F,Q=Math.max(0,E),me=Math.max(0,z);return{rect:{x:Q,y:me,width:Math.min(P.width,E+F)-Q,height:Math.min(P.height,z+$)-me},layout:[{offset:q,stride:H}]}})(a,t,n,c,p)),w)for(let P=0;P<T.length;P+=4){const E=T[P];T[P]=T[P+2],T[P+2]=E}return T}finally{_.close()}}))}let Ia,za;function Ra(a,t,n,c){return a.addEventListener(t,n,c),{unsubscribe:()=>{a.removeEventListener(t,n,c)}}}function lo(a){return a*Math.PI/180}function La(a){return a/Math.PI*180}const Da={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Fa={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Wo="AbortError";function ge(){return new Error(Wo)}const V={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Z(a){return V.REGISTERED_PROTOCOLS[a.substring(0,a.indexOf("://"))]}const W="global-dispatcher";class ie extends Error{constructor(t,n,c,p){super(`AJAXError: ${n} (${t}): ${c}`),this.status=t,this.statusText=n,this.url=c,this.body=p}}const ue=()=>qi(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,ye=function(a,t){if(/:\/\//.test(a.url)&&!/^https?:|^file:/.test(a.url)){const c=Z(a.url);if(c)return c(a,t);if(qi(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:a,targetMapId:W},t)}if(!(/^file:/.test(n=a.url)||/^file:/.test(ue())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(c,p){return l(this,void 0,void 0,(function*(){const _=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,cache:c.cache,referrer:ue(),signal:p.signal});let b,w;c.type!=="json"||_.headers.has("Accept")||_.headers.set("Accept","application/json");try{b=yield fetch(_)}catch(P){throw new ie(0,P.message,c.url,new Blob)}if(!b.ok){const P=yield b.blob();throw new ie(b.status,b.statusText,c.url,P)}w=c.type==="arrayBuffer"||c.type==="image"?b.arrayBuffer():c.type==="json"?b.json():b.text();const T=yield w;if(p.signal.aborted)throw ge();return{data:T,cacheControl:b.headers.get("Cache-Control"),expires:b.headers.get("Expires")}}))})(a,t);if(qi(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:a,mustQueue:!0,targetMapId:W},t)}var n;return(function(c,p){return new Promise(((_,b)=>{var w;const T=new XMLHttpRequest;T.open(c.method||"GET",c.url,!0),c.type!=="arrayBuffer"&&c.type!=="image"||(T.responseType="arraybuffer");for(const P in c.headers)T.setRequestHeader(P,c.headers[P]);c.type==="json"&&(T.responseType="text",!((w=c.headers)===null||w===void 0)&&w.Accept||T.setRequestHeader("Accept","application/json")),T.withCredentials=c.credentials==="include",T.onerror=()=>{b(new Error(T.statusText))},T.onload=()=>{if(!p.signal.aborted)if((T.status>=200&&T.status<300||T.status===0)&&T.response!==null){let P=T.response;if(c.type==="json")try{P=JSON.parse(T.response)}catch(E){return void b(E)}_({data:P,cacheControl:T.getResponseHeader("Cache-Control"),expires:T.getResponseHeader("Expires")})}else{const P=new Blob([T.response],{type:T.getResponseHeader("Content-Type")});b(new ie(T.status,T.statusText,c.url,P))}},p.signal.addEventListener("abort",(()=>{T.abort(),b(ge())})),T.send(c.body)}))})(a,t)};function Ce(a){if(!a||a.indexOf("://")<=0||a.indexOf("data:image/")===0||a.indexOf("blob:")===0)return!0;const t=new URL(a),n=window.location;return t.protocol===n.protocol&&t.host===n.host}function ve(a,t,n){n[a]&&n[a].indexOf(t)!==-1||(n[a]=n[a]||[],n[a].push(t))}function Ie(a,t,n){if(n&&n[a]){const c=n[a].indexOf(t);c!==-1&&n[a].splice(c,1)}}class je{constructor(t,n={}){nr(this,n),this.type=t}}class Re extends je{constructor(t,n={}){super("error",nr({error:t},n))}}class at{on(t,n){return this._listeners=this._listeners||{},ve(t,n,this._listeners),{unsubscribe:()=>{this.off(t,n)}}}off(t,n){return Ie(t,n,this._listeners),Ie(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},ve(t,n,this._oneTimeListeners),this):new Promise((c=>this.once(t,c)))}fire(t,n){typeof t=="string"&&(t=new je(t,n||{}));const c=t.type;if(this.listens(c)){t.target=this;const p=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const w of p)w.call(this,t);const _=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const w of _)Ie(c,w,this._oneTimeListeners),w.call(this,t);const b=this._eventedParent;b&&(nr(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(t))}else t instanceof Re&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var be={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const vt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function zt(a,t){const n={};for(const c in a)c!=="ref"&&(n[c]=a[c]);return vt.forEach((c=>{c in t&&(n[c]=t[c])})),n}function ct(a,t){if(Array.isArray(a)){if(!Array.isArray(t)||a.length!==t.length)return!1;for(let n=0;n<a.length;n++)if(!ct(a[n],t[n]))return!1;return!0}if(typeof a=="object"&&a!==null&&t!==null){if(typeof t!="object"||Object.keys(a).length!==Object.keys(t).length)return!1;for(const n in a)if(!ct(a[n],t[n]))return!1;return!0}return a===t}function St(a,t){a.push(t)}function mr(a,t,n){St(n,{command:"addSource",args:[a,t[a]]})}function Xr(a,t,n){St(t,{command:"removeSource",args:[a]}),n[a]=!0}function Kr(a,t,n,c){Xr(a,n,c),mr(a,t,n)}function Dr(a,t,n){let c;for(c in a[n])if(Object.prototype.hasOwnProperty.call(a[n],c)&&c!=="data"&&!ct(a[n][c],t[n][c]))return!1;for(c in t[n])if(Object.prototype.hasOwnProperty.call(t[n],c)&&c!=="data"&&!ct(a[n][c],t[n][c]))return!1;return!0}function jt(a,t,n,c,p,_){a=a||{},t=t||{};for(const b in a)Object.prototype.hasOwnProperty.call(a,b)&&(ct(a[b],t[b])||n.push({command:_,args:[c,b,t[b],p]}));for(const b in t)Object.prototype.hasOwnProperty.call(t,b)&&!Object.prototype.hasOwnProperty.call(a,b)&&(ct(a[b],t[b])||n.push({command:_,args:[c,b,t[b],p]}))}function Zt(a){return a.id}function $r(a,t){return a[t.id]=t,a}class Be{constructor(t,n,c,p){this.message=(t?`${t}: `:"")+c,p&&(this.identifier=p),n!=null&&n.__line__&&(this.line=n.__line__)}}function wi(a,...t){for(const n of t)for(const c in n)a[c]=n[c];return a}class Sr extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}class ja{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[c,p]of n)this.bindings[c]=p}concat(t){return new ja(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Ho={kind:"null"},We={kind:"number"},Rt={kind:"string"},Mt={kind:"boolean"},pi={kind:"color"},co={kind:"projectionDefinition"},Oa={kind:"object"},Ct={kind:"value"},Wl={kind:"collator"},Ba={kind:"formatted"},Hl={kind:"padding"},Zn={kind:"colorArray"},Xo={kind:"numberArray"},Ar={kind:"resolvedImage"},Xl={kind:"variableAnchorOffsetCollection"};function Gi(a,t){return{kind:"array",itemType:a,N:t}}function ur(a){if(a.kind==="array"){const t=ur(a.itemType);return typeof a.N=="number"?`array<${t}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${t}>`}return a.kind}const Lp=[Ho,We,Rt,Mt,pi,co,Ba,Oa,Gi(Ct),Hl,Xo,Zn,Ar,Xl];function Ds(a,t){if(t.kind==="error")return null;if(a.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Ds(a.itemType,t.itemType))&&(typeof a.N!="number"||a.N===t.N))return null}else{if(a.kind===t.kind)return null;if(a.kind==="value"){for(const n of Lp)if(!Ds(n,t))return null}}return`Expected ${ur(a)} but found ${ur(t)} instead.`}function Iu(a,t){return t.some((n=>n.kind===a.kind))}function $a(a,t){return t.some((n=>n==="null"?a===null:n==="array"?Array.isArray(a):n==="object"?a&&!Array.isArray(a)&&typeof a=="object":n===typeof a))}function Na(a,t){return a.kind==="array"&&t.kind==="array"?a.itemType.kind===t.itemType.kind&&typeof a.N=="number":a.kind===t.kind}const zu=.96422,Dp=.82521,Fp=4/29,Ko=6/29,jp=3*Ko*Ko,um=Ko*Ko*Ko,hm=Math.PI/180,pm=180/Math.PI;function Ru(a){return(a%=360)<0&&(a+=360),a}function Yo([a,t,n,c]){let p,_;const b=Du((.2225045*(a=Lu(a))+.7168786*(t=Lu(t))+.0606169*(n=Lu(n)))/1);a===t&&t===n?p=_=b:(p=Du((.4360747*a+.3850649*t+.1430804*n)/zu),_=Du((.0139322*a+.0971045*t+.7141733*n)/Dp));const w=116*b-16;return[w<0?0:w,500*(p-b),200*(b-_),c]}function Lu(a){return a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Du(a){return a>um?Math.pow(a,1/3):a/jp+Fp}function Jo([a,t,n,c]){let p=(a+16)/116,_=isNaN(t)?p:p+t/500,b=isNaN(n)?p:p-n/200;return p=1*ju(p),_=zu*ju(_),b=Dp*ju(b),[Fu(3.1338561*_-1.6168667*p-.4906146*b),Fu(-.9787684*_+1.9161415*p+.033454*b),Fu(.0719453*_-.2289914*p+1.4052427*b),c]}function Fu(a){return(a=a<=.00304?12.92*a:1.055*Math.pow(a,1/2.4)-.055)<0?0:a>1?1:a}function ju(a){return a>Ko?a*a*a:jp*(a-Fp)}const dm=Object.hasOwn||function(a,t){return Object.prototype.hasOwnProperty.call(a,t)};function Qo(a,t){return dm(a,t)?a[t]:void 0}function Fs(a){return parseInt(a.padEnd(2,a),16)/255}function vn(a,t){return Lt(t?a/100:a,0,1)}function Lt(a,t,n){return Math.min(Math.max(t,a),n)}function uo(a){return!a.some(Number.isNaN)}const Ua={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function ca(a,t,n){return a+n*(t-a)}function ho(a,t,n){return a.map(((c,p)=>ca(c,t[p],n)))}class Dt{constructor(t,n,c,p=1,_=!0){this.r=t,this.g=n,this.b=c,this.a=p,_||(this.r*=p,this.g*=p,this.b*=p,p||this.overwriteGetter("rgb",[t,n,c,p]))}static parse(t){if(t instanceof Dt)return t;if(typeof t!="string")return;const n=(function(c){if((c=c.toLowerCase().trim())==="transparent")return[0,0,0,0];const p=Qo(Ua,c);if(p){const[b,w,T]=p;return[b/255,w/255,T/255,1]}if(c.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(c)){const b=c.length<6?1:2;let w=1;return[Fs(c.slice(w,w+=b)),Fs(c.slice(w,w+=b)),Fs(c.slice(w,w+=b)),Fs(c.slice(w,w+b)||"ff")]}if(c.startsWith("rgb")){const b=c.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){const[w,T,P,E,z,F,$,N,q,H,Q,me]=b,ae=[E||" ",$||" ",H].join("");if(ae==="  "||ae==="  /"||ae===",,"||ae===",,,"){const se=[P,F,q].join(""),ke=se==="%%%"?100:se===""?255:0;if(ke){const Ee=[Lt(+T/ke,0,1),Lt(+z/ke,0,1),Lt(+N/ke,0,1),Q?vn(+Q,me):1];if(uo(Ee))return Ee}}return}}const _=c.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[b,w,T,P,E,z,F,$,N]=_,q=[T||" ",E||" ",F].join("");if(q==="  "||q==="  /"||q===",,"||q===",,,"){const H=[+w,Lt(+P,0,100),Lt(+z,0,100),$?vn(+$,N):1];if(uo(H))return(function([Q,me,ae,se]){function ke(Ee){const De=(Ee+Q/30)%12,Ze=me*Math.min(ae,1-ae);return ae-Ze*Math.max(-1,Math.min(De-3,9-De,1))}return Q=Ru(Q),me/=100,ae/=100,[ke(0),ke(8),ke(4),se]})(H)}}})(t);return n?new Dt(...n,!1):void 0}get rgb(){const{r:t,g:n,b:c,a:p}=this,_=p||1/0;return this.overwriteGetter("rgb",[t/_,n/_,c/_,p])}get hcl(){return this.overwriteGetter("hcl",(function(t){const[n,c,p,_]=Yo(t),b=Math.sqrt(c*c+p*p);return[Math.round(1e4*b)?Ru(Math.atan2(p,c)*pm):NaN,b,n,_]})(this.rgb))}get lab(){return this.overwriteGetter("lab",Yo(this.rgb))}overwriteGetter(t,n){return Object.defineProperty(this,t,{value:n}),n}toString(){const[t,n,c,p]=this.rgb;return`rgba(${[t,n,c].map((_=>Math.round(255*_))).join(",")},${p})`}static interpolate(t,n,c,p="rgb"){switch(p){case"rgb":{const[_,b,w,T]=ho(t.rgb,n.rgb,c);return new Dt(_,b,w,T,!1)}case"hcl":{const[_,b,w,T]=t.hcl,[P,E,z,F]=n.hcl;let $,N;if(isNaN(_)||isNaN(P))isNaN(_)?isNaN(P)?$=NaN:($=P,w!==1&&w!==0||(N=E)):($=_,z!==1&&z!==0||(N=b));else{let ae=P-_;P>_&&ae>180?ae-=360:P<_&&_-P>180&&(ae+=360),$=_+c*ae}const[q,H,Q,me]=(function([ae,se,ke,Ee]){return ae=isNaN(ae)?0:ae*hm,Jo([ke,Math.cos(ae)*se,Math.sin(ae)*se,Ee])})([$,N??ca(b,E,c),ca(w,z,c),ca(T,F,c)]);return new Dt(q,H,Q,me,!1)}case"lab":{const[_,b,w,T]=Jo(ho(t.lab,n.lab,c));return new Dt(_,b,w,T,!1)}}}}Dt.black=new Dt(0,0,0,1),Dt.white=new Dt(1,1,1,1),Dt.transparent=new Dt(0,0,0,0),Dt.red=new Dt(1,0,0,1);class po{constructor(t,n,c){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Kl=["bottom","center","top"];class Yl{constructor(t,n,c,p,_,b){this.text=t,this.image=n,this.scale=c,this.fontStack=p,this.textColor=_,this.verticalAlign=b}}class Ei{constructor(t){this.sections=t}static fromString(t){return new Ei([new Yl(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((t=>t.text.length!==0||t.image&&t.image.name.length!==0))}static factory(t){return t instanceof Ei?t:Ei.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map((t=>t.text)).join("")}}class ri{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof ri)return t;if(typeof t=="number")return new ri([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const n of t)if(typeof n!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new ri(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,c){return new ri(ho(t.values,n.values,c))}}class Ii{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Ii)return t;if(typeof t=="number")return new Ii([t]);if(Array.isArray(t)){for(const n of t)if(typeof n!="number")return;return new Ii(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,c){return new Ii(ho(t.values,n.values,c))}}class Nr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Nr)return t;if(typeof t=="string"){const c=Dt.parse(t);return c?new Nr([c]):void 0}if(!Array.isArray(t))return;const n=[];for(const c of t){if(typeof c!="string")return;const p=Dt.parse(c);if(!p)return;n.push(p)}return new Nr(n)}toString(){return JSON.stringify(this.values)}static interpolate(t,n,c,p="rgb"){const _=[];if(t.values.length!=n.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${n.values.length}), cannot interpolate.`);for(let b=0;b<t.values.length;b++)_.push(Dt.interpolate(t.values[b],n.values[b],c,p));return new Nr(_)}}class hr extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}const Op=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class zi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof zi)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let n=0;n<t.length;n+=2){const c=t[n],p=t[n+1];if(typeof c!="string"||!Op.has(c)||!Array.isArray(p)||p.length!==2||typeof p[0]!="number"||typeof p[1]!="number")return}return new zi(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,c){const p=t.values,_=n.values;if(p.length!==_.length)throw new hr(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${n.toString()}`);const b=[];for(let w=0;w<p.length;w+=2){if(p[w]!==_[w])throw new hr(`Cannot interpolate values containing mismatched anchors. from[${w}]: ${p[w]}, to[${w}]: ${_[w]}`);b.push(p[w]);const[T,P]=p[w+1],[E,z]=_[w+1];b.push([ca(T,E,c),ca(P,z,c)])}return new zi(b)}}class Qi{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Qi({name:t,available:!1}):null}}class Ti{constructor(t,n,c){this.from=t,this.to=n,this.transition=c}static interpolate(t,n,c){return new Ti(t,n,c)}static parse(t){return t instanceof Ti?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new Ti(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new Ti(t.from,t.to,t.transition):typeof t=="string"?new Ti(t,t,1):void 0}}function yr(a,t,n,c){return typeof a=="number"&&a>=0&&a<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[a,t,n,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[a,t,n,c]:[a,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function fo(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof Ti||a instanceof Dt||a instanceof po||a instanceof Ei||a instanceof ri||a instanceof Ii||a instanceof Nr||a instanceof zi||a instanceof Qi)return!0;if(Array.isArray(a)){for(const t of a)if(!fo(t))return!1;return!0}if(typeof a=="object"){for(const t in a)if(!fo(a[t]))return!1;return!0}return!1}function ft(a){if(a===null)return Ho;if(typeof a=="string")return Rt;if(typeof a=="boolean")return Mt;if(typeof a=="number")return We;if(a instanceof Dt)return pi;if(a instanceof Ti)return co;if(a instanceof po)return Wl;if(a instanceof Ei)return Ba;if(a instanceof ri)return Hl;if(a instanceof Ii)return Xo;if(a instanceof Nr)return Zn;if(a instanceof zi)return Xl;if(a instanceof Qi)return Ar;if(Array.isArray(a)){const t=a.length;let n;for(const c of a){const p=ft(c);if(n){if(n===p)continue;n=Ct;break}n=p}return Gi(n||Ct,t)}return Oa}function wt(a){const t=typeof a;return a===null?"":t==="string"||t==="number"||t==="boolean"?String(a):a instanceof Dt||a instanceof Ti||a instanceof Ei||a instanceof ri||a instanceof Ii||a instanceof Nr||a instanceof zi||a instanceof Qi?a.toString():JSON.stringify(a)}class ua{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(t.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!fo(t[1]))return n.error("invalid value");const c=t[1];let p=ft(c);const _=n.expectedType;return p.kind!=="array"||p.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(p=_),new ua(p,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Wt={string:Rt,number:We,boolean:Mt,object:Oa};class en{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let c,p=1;const _=t[0];if(_==="array"){let w,T;if(t.length>2){const P=t[1];if(typeof P!="string"||!(P in Wt)||P==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);w=Wt[P],p++}else w=Ct;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);T=t[2],p++}c=Gi(w,T)}else{if(!Wt[_])throw new Error(`Types doesn't contain name = ${_}`);c=Wt[_]}const b=[];for(;p<t.length;p++){const w=n.parse(t[p],p,Ct);if(!w)return null;b.push(w)}return new en(c,b)}evaluate(t){for(let n=0;n<this.args.length;n++){const c=this.args[n].evaluate(t);if(!Ds(this.type,ft(c)))return c;if(n===this.args.length-1)throw new hr(`Expected value to be of type ${ur(this.type)}, but found ${ur(ft(c))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const Wn={"to-boolean":Mt,"to-color":pi,"to-number":We,"to-string":Rt};class Hn{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const c=t[0];if(!Wn[c])throw new Error(`Can't parse ${c} as it is not part of the known types`);if((c==="to-boolean"||c==="to-string")&&t.length!==2)return n.error("Expected one argument.");const p=Wn[c],_=[];for(let b=1;b<t.length;b++){const w=n.parse(t[b],b,Ct);if(!w)return null;_.push(w)}return new Hn(p,_)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let n,c;for(const p of this.args){if(n=p.evaluate(t),c=null,n instanceof Dt)return n;if(typeof n=="string"){const _=t.parseColor(n);if(_)return _}else if(Array.isArray(n)&&(c=n.length<3||n.length>4?`Invalid rgba value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:yr(n[0],n[1],n[2],n[3]),!c))return new Dt(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new hr(c||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const c of this.args){n=c.evaluate(t);const p=ri.parse(n);if(p)return p}throw new hr(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"numberArray":{let n;for(const c of this.args){n=c.evaluate(t);const p=Ii.parse(n);if(p)return p}throw new hr(`Could not parse numberArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"colorArray":{let n;for(const c of this.args){n=c.evaluate(t);const p=Nr.parse(n);if(p)return p}throw new hr(`Could not parse colorArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const c of this.args){n=c.evaluate(t);const p=zi.parse(n);if(p)return p}throw new hr(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const c of this.args){if(n=c.evaluate(t),n===null)return 0;const p=Number(n);if(!isNaN(p))return p}throw new hr(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return Ei.fromString(wt(this.args[0].evaluate(t)));case"resolvedImage":return Qi.fromString(wt(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return wt(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const Jl=["Unknown","Point","LineString","Polygon"];class Ou{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Jl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let n=this._parseColorCache.get(t);return n||(n=Dt.parse(t),this._parseColorCache.set(t,n)),n}}class es{constructor(t,n,c=[],p,_=new ja,b=[]){this.registry=t,this.path=c,this.key=c.map((w=>`[${w}]`)).join(""),this.scope=_,this.errors=b,this.expectedType=p,this._isConstant=n}parse(t,n,c,p,_={}){return n?this.concat(n,c,p)._parse(t,_):this._parse(t,_)}_parse(t,n){function c(p,_,b){return b==="assert"?new en(_,[p]):b==="coerce"?new Hn(_,[p]):p}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=t[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const _=this.registry[p];if(_){let b=_.parse(t,this);if(!b)return null;if(this.expectedType){const w=this.expectedType,T=b.type;if(w.kind!=="string"&&w.kind!=="number"&&w.kind!=="boolean"&&w.kind!=="object"&&w.kind!=="array"||T.kind!=="value"){if(w.kind==="projectionDefinition"&&["string","array"].includes(T.kind)||["color","formatted","resolvedImage"].includes(w.kind)&&["value","string"].includes(T.kind)||["padding","numberArray"].includes(w.kind)&&["value","number","array"].includes(T.kind)||w.kind==="colorArray"&&["value","string","array"].includes(T.kind)||w.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(T.kind))b=c(b,w,n.typeAnnotation||"coerce");else if(this.checkSubtype(w,T))return null}else b=c(b,w,n.typeAnnotation||"assert")}if(!(b instanceof ua)&&b.type.kind!=="resolvedImage"&&this._isConstant(b)){const w=new Ou;try{b=new ua(b.type,b.evaluate(w))}catch(T){return this.error(T.message),null}}return b}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,c){const p=typeof t=="number"?this.path.concat(t):this.path,_=c?this.scope.concat(c):this.scope;return new es(this.registry,this._isConstant,p,n||null,_,this.errors)}error(t,...n){const c=`${this.key}${n.map((p=>`[${p}]`)).join("")}`;this.errors.push(new Sr(c,t))}checkSubtype(t,n){const c=Ds(t,n);return c&&this.error(c),c}}class js{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const c=[];for(let _=1;_<t.length-1;_+=2){const b=t[_];if(typeof b!="string")return n.error(`Expected string, but found ${typeof b} instead.`,_);if(/[^a-zA-Z0-9_]/.test(b))return n.error("Variable names must contain only alphanumeric characters or '_'.",_);const w=n.parse(t[_+1],_+1);if(!w)return null;c.push([b,w])}const p=n.parse(t[t.length-1],t.length-1,n.expectedType,c);return p?new js(c,p):null}outputDefined(){return this.result.outputDefined()}}class Ql{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const c=t[1];return n.scope.has(c)?new Ql(c,n.scope.get(c)):n.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class ec{constructor(t,n,c){this.type=t,this.index=n,this.input=c}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=n.parse(t[1],1,We),p=n.parse(t[2],2,Gi(n.expectedType||Ct));return c&&p?new ec(p.type.itemType,c,p):null}evaluate(t){const n=this.index.evaluate(t),c=this.input.evaluate(t);if(n<0)throw new hr(`Array index out of bounds: ${n} < 0.`);if(n>=c.length)throw new hr(`Array index out of bounds: ${n} > ${c.length-1}.`);if(n!==Math.floor(n))throw new hr(`Array index must be an integer, but found ${n} instead.`);return c[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class tc{constructor(t,n){this.type=Mt,this.needle=t,this.haystack=n}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=n.parse(t[1],1,Ct),p=n.parse(t[2],2,Ct);return c&&p?Iu(c.type,[Mt,Rt,We,Ho,Ct])?new tc(c,p):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${ur(c.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(!c)return!1;if(!$a(n,["boolean","string","number","null"]))throw new hr(`Expected first argument to be of type boolean, string, number or null, but found ${ur(ft(n))} instead.`);if(!$a(c,["string","array"]))throw new hr(`Expected second argument to be of type array or string, but found ${ur(ft(c))} instead.`);return c.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class bn{constructor(t,n,c){this.type=We,this.needle=t,this.haystack=n,this.fromIndex=c}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=n.parse(t[1],1,Ct),p=n.parse(t[2],2,Ct);if(!c||!p)return null;if(!Iu(c.type,[Mt,Rt,We,Ho,Ct]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${ur(c.type)} instead`);if(t.length===4){const _=n.parse(t[3],3,We);return _?new bn(c,p,_):null}return new bn(c,p)}evaluate(t){const n=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(!$a(n,["boolean","string","number","null"]))throw new hr(`Expected first argument to be of type boolean, string, number or null, but found ${ur(ft(n))} instead.`);let p;if(this.fromIndex&&(p=this.fromIndex.evaluate(t)),$a(c,["string"])){const _=c.indexOf(n,p);return _===-1?-1:[...c.slice(0,_)].length}if($a(c,["array"]))return c.indexOf(n,p);throw new hr(`Expected second argument to be of type array or string, but found ${ur(ft(c))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class ii{constructor(t,n,c,p,_,b){this.inputType=t,this.type=n,this.input=c,this.cases=p,this.outputs=_,this.otherwise=b}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let c,p;n.expectedType&&n.expectedType.kind!=="value"&&(p=n.expectedType);const _={},b=[];for(let P=2;P<t.length-1;P+=2){let E=t[P];const z=t[P+1];Array.isArray(E)||(E=[E]);const F=n.concat(P);if(E.length===0)return F.error("Expected at least one branch label.");for(const N of E){if(typeof N!="number"&&typeof N!="string")return F.error("Branch labels must be numbers or strings.");if(typeof N=="number"&&Math.abs(N)>Number.MAX_SAFE_INTEGER)return F.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof N=="number"&&Math.floor(N)!==N)return F.error("Numeric branch labels must be integer values.");if(c){if(F.checkSubtype(c,ft(N)))return null}else c=ft(N);if(_[String(N)]!==void 0)return F.error("Branch labels must be unique.");_[String(N)]=b.length}const $=n.parse(z,P,p);if(!$)return null;p=p||$.type,b.push($)}const w=n.parse(t[1],1,Ct);if(!w)return null;const T=n.parse(t[t.length-1],t.length-1,p);return T?w.type.kind!=="value"&&n.concat(1).checkSubtype(c,w.type)?null:new ii(c,p,w,_,b,T):null}evaluate(t){const n=this.input.evaluate(t);return(ft(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}}class ts{constructor(t,n,c){this.type=t,this.branches=n,this.otherwise=c}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);const p=[];for(let b=1;b<t.length-1;b+=2){const w=n.parse(t[b],b,Mt);if(!w)return null;const T=n.parse(t[b+1],b+1,c);if(!T)return null;p.push([w,T]),c=c||T.type}const _=n.parse(t[t.length-1],t.length-1,c);if(!_)return null;if(!c)throw new Error("Can't infer output type");return new ts(c,p,_)}evaluate(t){for(const[n,c]of this.branches)if(n.evaluate(t))return c.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,c]of this.branches)t(n),t(c);t(this.otherwise)}outputDefined(){return this.branches.every((([t,n])=>n.outputDefined()))&&this.otherwise.outputDefined()}}class Os{constructor(t,n,c,p){this.type=t,this.input=n,this.beginIndex=c,this.endIndex=p}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=n.parse(t[1],1,Ct),p=n.parse(t[2],2,We);if(!c||!p)return null;if(!Iu(c.type,[Gi(Ct),Rt,Ct]))return n.error(`Expected first argument to be of type array or string, but found ${ur(c.type)} instead`);if(t.length===4){const _=n.parse(t[3],3,We);return _?new Os(c.type,c,p,_):null}return new Os(c.type,c,p)}evaluate(t){const n=this.input.evaluate(t),c=this.beginIndex.evaluate(t);let p;if(this.endIndex&&(p=this.endIndex.evaluate(t)),$a(n,["string"]))return[...n].slice(c,p).join("");if($a(n,["array"]))return n.slice(c,p);throw new hr(`Expected first argument to be of type array or string, but found ${ur(ft(n))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function mo(a,t){const n=a.length-1;let c,p,_=0,b=n,w=0;for(;_<=b;)if(w=Math.floor((_+b)/2),c=a[w],p=a[w+1],c<=t){if(w===n||t<p)return w;_=w+1}else{if(!(c>t))throw new hr("Input is not a number.");b=w-1}return 0}class Er{constructor(t,n,c){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[p,_]of c)this.labels.push(p),this.outputs.push(_)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const c=n.parse(t[1],1,We);if(!c)return null;const p=[];let _=null;n.expectedType&&n.expectedType.kind!=="value"&&(_=n.expectedType);for(let b=1;b<t.length;b+=2){const w=b===1?-1/0:t[b],T=t[b+1],P=b,E=b+1;if(typeof w!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(p.length&&p[p.length-1][0]>=w)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const z=n.parse(T,E,_);if(!z)return null;_=_||z.type,p.push([w,z])}return new Er(_,c,p)}evaluate(t){const n=this.labels,c=this.outputs;if(n.length===1)return c[0].evaluate(t);const p=this.input.evaluate(t);if(p<=n[0])return c[0].evaluate(t);const _=n.length;return p>=n[_-1]?c[_-1].evaluate(t):c[mo(n,p)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function Bp(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var Bs,Bu,fm=(function(){if(Bu)return Bs;function a(t,n,c,p){this.cx=3*t,this.bx=3*(c-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(p-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=c,this.p2y=p}return Bu=1,Bs=a,a.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,n){if(n===void 0&&(n=1e-6),t<0)return 0;if(t>1)return 1;for(var c=t,p=0;p<8;p++){var _=this.sampleCurveX(c)-t;if(Math.abs(_)<n)return c;var b=this.sampleCurveDerivativeX(c);if(Math.abs(b)<1e-6)break;c-=_/b}var w=0,T=1;for(c=t,p=0;p<20&&(_=this.sampleCurveX(c),!(Math.abs(_-t)<n));p++)t>_?w=c:T=c,c=.5*(T-w)+w;return c},solve:function(t,n){return this.sampleCurveY(this.solveCurveX(t,n))}},Bs})(),rs=Bp(fm);class di{constructor(t,n,c,p,_){this.type=t,this.operator=n,this.interpolation=c,this.input=p,this.labels=[],this.outputs=[];for(const[b,w]of _)this.labels.push(b),this.outputs.push(w)}static interpolationFactor(t,n,c,p){let _=0;if(t.name==="exponential")_=$s(n,t.base,c,p);else if(t.name==="linear")_=$s(n,1,c,p);else if(t.name==="cubic-bezier"){const b=t.controlPoints;_=new rs(b[0],b[1],b[2],b[3]).solve($s(n,1,c,p))}return _}static parse(t,n){let[c,p,_,...b]=t;if(!Array.isArray(p)||p.length===0)return n.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const P=p[1];if(typeof P!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:P}}else{if(p[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const P=p.slice(1);if(P.length!==4||P.some((E=>typeof E!="number"||E<0||E>1)))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:P}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(_=n.parse(_,2,We),!_)return null;const w=[];let T=null;c!=="interpolate-hcl"&&c!=="interpolate-lab"||n.expectedType==Zn?n.expectedType&&n.expectedType.kind!=="value"&&(T=n.expectedType):T=pi;for(let P=0;P<b.length;P+=2){const E=b[P],z=b[P+1],F=P+3,$=P+4;if(typeof E!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(w.length&&w[w.length-1][0]>=E)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',F);const N=n.parse(z,$,T);if(!N)return null;T=T||N.type,w.push([E,N])}return Na(T,We)||Na(T,co)||Na(T,pi)||Na(T,Hl)||Na(T,Xo)||Na(T,Zn)||Na(T,Xl)||Na(T,Gi(We))?new di(T,c,p,_,w):n.error(`Type ${ur(T)} is not interpolatable.`)}evaluate(t){const n=this.labels,c=this.outputs;if(n.length===1)return c[0].evaluate(t);const p=this.input.evaluate(t);if(p<=n[0])return c[0].evaluate(t);const _=n.length;if(p>=n[_-1])return c[_-1].evaluate(t);const b=mo(n,p),w=di.interpolationFactor(this.interpolation,p,n[b],n[b+1]),T=c[b].evaluate(t),P=c[b+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return ca(T,P,w);case"color":return Dt.interpolate(T,P,w);case"padding":return ri.interpolate(T,P,w);case"colorArray":return Nr.interpolate(T,P,w);case"numberArray":return Ii.interpolate(T,P,w);case"variableAnchorOffsetCollection":return zi.interpolate(T,P,w);case"array":return ho(T,P,w);case"projectionDefinition":return Ti.interpolate(T,P,w)}case"interpolate-hcl":switch(this.type.kind){case"color":return Dt.interpolate(T,P,w,"hcl");case"colorArray":return Nr.interpolate(T,P,w,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Dt.interpolate(T,P,w,"lab");case"colorArray":return Nr.interpolate(T,P,w,"lab")}}}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function $s(a,t,n,c){const p=c-n,_=a-n;return p===0?0:t===1?_/p:(Math.pow(t,_)-1)/(Math.pow(t,p)-1)}const Xn={color:Dt.interpolate,number:ca,padding:ri.interpolate,numberArray:Ii.interpolate,colorArray:Nr.interpolate,variableAnchorOffsetCollection:zi.interpolate,array:ho};class Ns{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let c=null;const p=n.expectedType;p&&p.kind!=="value"&&(c=p);const _=[];for(const w of t.slice(1)){const T=n.parse(w,1+_.length,c,void 0,{typeAnnotation:"omit"});if(!T)return null;c=c||T.type,_.push(T)}if(!c)throw new Error("No output type");const b=p&&_.some((w=>Ds(p,w.type)));return new Ns(b?Ct:c,_)}evaluate(t){let n,c=null,p=0;for(const _ of this.args)if(p++,c=_.evaluate(t),c&&c instanceof Qi&&!c.available&&(n||(n=c.name),c=null,p===this.args.length&&(c=n)),c!==null)break;return c}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}function Us(a,t){return a==="=="||a==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Vs(a,t,n,c){return c.compare(t,n)===0}function Si(a,t,n){const c=a!=="=="&&a!=="!=";return class Ex{constructor(_,b,w){this.type=Mt,this.lhs=_,this.rhs=b,this.collator=w,this.hasUntypedArgument=_.type.kind==="value"||b.type.kind==="value"}static parse(_,b){if(_.length!==3&&_.length!==4)return b.error("Expected two or three arguments.");const w=_[0];let T=b.parse(_[1],1,Ct);if(!T)return null;if(!Us(w,T.type))return b.concat(1).error(`"${w}" comparisons are not supported for type '${ur(T.type)}'.`);let P=b.parse(_[2],2,Ct);if(!P)return null;if(!Us(w,P.type))return b.concat(2).error(`"${w}" comparisons are not supported for type '${ur(P.type)}'.`);if(T.type.kind!==P.type.kind&&T.type.kind!=="value"&&P.type.kind!=="value")return b.error(`Cannot compare types '${ur(T.type)}' and '${ur(P.type)}'.`);c&&(T.type.kind==="value"&&P.type.kind!=="value"?T=new en(P.type,[T]):T.type.kind!=="value"&&P.type.kind==="value"&&(P=new en(T.type,[P])));let E=null;if(_.length===4){if(T.type.kind!=="string"&&P.type.kind!=="string"&&T.type.kind!=="value"&&P.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(E=b.parse(_[3],3,Wl),!E)return null}return new Ex(T,P,E)}evaluate(_){const b=this.lhs.evaluate(_),w=this.rhs.evaluate(_);if(c&&this.hasUntypedArgument){const T=ft(b),P=ft(w);if(T.kind!==P.kind||T.kind!=="string"&&T.kind!=="number")throw new hr(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${T.kind}, ${P.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const T=ft(b),P=ft(w);if(T.kind!=="string"||P.kind!=="string")return t(_,b,w)}return this.collator?n(_,b,w,this.collator.evaluate(_)):t(_,b,w)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}}}const $p=Si("==",(function(a,t,n){return t===n}),Vs),rc=Si("!=",(function(a,t,n){return t!==n}),(function(a,t,n,c){return!Vs(0,t,n,c)})),mm=Si("<",(function(a,t,n){return t<n}),(function(a,t,n,c){return c.compare(t,n)<0})),$u=Si(">",(function(a,t,n){return t>n}),(function(a,t,n,c){return c.compare(t,n)>0})),gm=Si("<=",(function(a,t,n){return t<=n}),(function(a,t,n,c){return c.compare(t,n)<=0})),ym=Si(">=",(function(a,t,n){return t>=n}),(function(a,t,n,c){return c.compare(t,n)>=0}));class ic{constructor(t,n,c){this.type=Wl,this.locale=c,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(t.length!==2)return n.error("Expected one argument.");const c=t[1];if(typeof c!="object"||Array.isArray(c))return n.error("Collator options argument must be an object.");const p=n.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,Mt);if(!p)return null;const _=n.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,Mt);if(!_)return null;let b=null;return c.locale&&(b=n.parse(c.locale,1,Rt),!b)?null:new ic(p,_,b)}evaluate(t){return new po(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Nu{constructor(t,n,c,p,_){this.type=Rt,this.number=t,this.locale=n,this.currency=c,this.minFractionDigits=p,this.maxFractionDigits=_}static parse(t,n){if(t.length!==3)return n.error("Expected two arguments.");const c=n.parse(t[1],1,We);if(!c)return null;const p=t[2];if(typeof p!="object"||Array.isArray(p))return n.error("NumberFormat options argument must be an object.");let _=null;if(p.locale&&(_=n.parse(p.locale,1,Rt),!_))return null;let b=null;if(p.currency&&(b=n.parse(p.currency,1,Rt),!b))return null;let w=null;if(p["min-fraction-digits"]&&(w=n.parse(p["min-fraction-digits"],1,We),!w))return null;let T=null;return p["max-fraction-digits"]&&(T=n.parse(p["max-fraction-digits"],1,We),!T)?null:new Nu(c,_,b,w,T)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class go{constructor(t){this.type=Ba,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const c=t[1];if(!Array.isArray(c)&&typeof c=="object")return n.error("First argument must be an image or text section.");const p=[];let _=!1;for(let b=1;b<=t.length-1;++b){const w=t[b];if(_&&typeof w=="object"&&!Array.isArray(w)){_=!1;let T=null;if(w["font-scale"]&&(T=n.parse(w["font-scale"],1,We),!T))return null;let P=null;if(w["text-font"]&&(P=n.parse(w["text-font"],1,Gi(Rt)),!P))return null;let E=null;if(w["text-color"]&&(E=n.parse(w["text-color"],1,pi),!E))return null;let z=null;if(w["vertical-align"]){if(typeof w["vertical-align"]=="string"&&!Kl.includes(w["vertical-align"]))return n.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${w["vertical-align"]}' instead.`);if(z=n.parse(w["vertical-align"],1,Rt),!z)return null}const F=p[p.length-1];F.scale=T,F.font=P,F.textColor=E,F.verticalAlign=z}else{const T=n.parse(t[b],1,Ct);if(!T)return null;const P=T.type.kind;if(P!=="string"&&P!=="value"&&P!=="null"&&P!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,p.push({content:T,scale:null,font:null,textColor:null,verticalAlign:null})}}return new go(p)}evaluate(t){return new Ei(this.sections.map((n=>{const c=n.content.evaluate(t);return ft(c)===Ar?new Yl("",c,null,null,null,n.verticalAlign?n.verticalAlign.evaluate(t):null):new Yl(wt(c),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null,n.verticalAlign?n.verticalAlign.evaluate(t):null)})))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor),n.verticalAlign&&t(n.verticalAlign)}outputDefined(){return!1}}class Uu{constructor(t){this.type=Ar,this.input=t}static parse(t,n){if(t.length!==2)return n.error("Expected two arguments.");const c=n.parse(t[1],1,Rt);return c?new Uu(c):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),c=Qi.fromString(n);return c&&t.availableImages&&(c.available=t.availableImages.indexOf(n)>-1),c}eachChild(t){t(this.input)}outputDefined(){return!1}}class nc{constructor(t){this.type=We,this.input=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const c=n.parse(t[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${ur(c.type)} instead.`):new nc(c):null}evaluate(t){const n=this.input.evaluate(t);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new hr(`Expected value to be of type string or array, but found ${ur(ft(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const xn=8192;function _m(a,t){const n=(180+a[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,p=Math.pow(2,t.z);return[Math.round(n*p*xn),Math.round(c*p*xn)]}function ac(a,t){const n=Math.pow(2,t.z);return[(p=(a[0]/xn+t.x)/n,360*p-180),(c=(a[1]/xn+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90)];var c,p}function qs(a,t){a[0]=Math.min(a[0],t[0]),a[1]=Math.min(a[1],t[1]),a[2]=Math.max(a[2],t[0]),a[3]=Math.max(a[3],t[1])}function Gs(a,t){return!(a[0]<=t[0]||a[2]>=t[2]||a[1]<=t[1]||a[3]>=t[3])}function vm(a,t,n){const c=a[0]-t[0],p=a[1]-t[1],_=a[0]-n[0],b=a[1]-n[1];return c*b-_*p==0&&c*_<=0&&p*b<=0}function oc(a,t,n,c){return(p=[c[0]-n[0],c[1]-n[1]])[0]*(_=[t[0]-a[0],t[1]-a[1]])[1]-p[1]*_[0]!=0&&!(!Up(a,t,n,c)||!Up(n,c,a,t));var p,_}function bm(a,t,n){for(const c of n)for(let p=0;p<c.length-1;++p)if(oc(a,t,c[p],c[p+1]))return!0;return!1}function yo(a,t,n=!1){let c=!1;for(const w of t)for(let T=0;T<w.length-1;T++){if(vm(a,w[T],w[T+1]))return n;(_=w[T])[1]>(p=a)[1]!=(b=w[T+1])[1]>p[1]&&p[0]<(b[0]-_[0])*(p[1]-_[1])/(b[1]-_[1])+_[0]&&(c=!c)}var p,_,b;return c}function Np(a,t){for(const n of t)if(yo(a,n))return!0;return!1}function Vu(a,t){for(const n of a)if(!yo(n,t))return!1;for(let n=0;n<a.length-1;++n)if(bm(a[n],a[n+1],t))return!1;return!0}function xm(a,t){for(const n of t)if(Vu(a,n))return!0;return!1}function Up(a,t,n,c){const p=c[0]-n[0],_=c[1]-n[1],b=(a[0]-n[0])*_-p*(a[1]-n[1]),w=(t[0]-n[0])*_-p*(t[1]-n[1]);return b>0&&w<0||b<0&&w>0}function qu(a,t,n){const c=[];for(let p=0;p<a.length;p++){const _=[];for(let b=0;b<a[p].length;b++){const w=_m(a[p][b],n);qs(t,w),_.push(w)}c.push(_)}return c}function Vp(a,t,n){const c=[];for(let p=0;p<a.length;p++){const _=qu(a[p],t,n);c.push(_)}return c}function sc(a,t,n,c){if(a[0]<n[0]||a[0]>n[2]){const p=.5*c;let _=a[0]-n[0]>p?-c:n[0]-a[0]>p?c:0;_===0&&(_=a[0]-n[2]>p?-c:n[2]-a[0]>p?c:0),a[0]+=_}qs(t,a)}function qp(a,t,n,c){const p=Math.pow(2,c.z)*xn,_=[c.x*xn,c.y*xn],b=[];for(const w of a)for(const T of w){const P=[T.x+_[0],T.y+_[1]];sc(P,t,n,p),b.push(P)}return b}function Gp(a,t,n,c){const p=Math.pow(2,c.z)*xn,_=[c.x*xn,c.y*xn],b=[];for(const T of a){const P=[];for(const E of T){const z=[E.x+_[0],E.y+_[1]];qs(t,z),P.push(z)}b.push(P)}if(t[2]-t[0]<=p/2){(w=t)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const T of b)for(const P of T)sc(P,t,n,p)}var w;return b}class _o{constructor(t,n){this.type=Mt,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(fo(t[1])){const c=t[1];if(c.type==="FeatureCollection"){const p=[];for(const _ of c.features){const{type:b,coordinates:w}=_.geometry;b==="Polygon"&&p.push(w),b==="MultiPolygon"&&p.push(...w)}if(p.length)return new _o(c,{type:"MultiPolygon",coordinates:p})}else if(c.type==="Feature"){const p=c.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new _o(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new _o(c,c)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(n,c){const p=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],b=n.canonicalID();if(c.type==="Polygon"){const w=qu(c.coordinates,_,b),T=qp(n.geometry(),p,_,b);if(!Gs(p,_))return!1;for(const P of T)if(!yo(P,w))return!1}if(c.type==="MultiPolygon"){const w=Vp(c.coordinates,_,b),T=qp(n.geometry(),p,_,b);if(!Gs(p,_))return!1;for(const P of T)if(!Np(P,w))return!1}return!0})(t,this.geometries);if(t.geometryType()==="LineString")return(function(n,c){const p=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],b=n.canonicalID();if(c.type==="Polygon"){const w=qu(c.coordinates,_,b),T=Gp(n.geometry(),p,_,b);if(!Gs(p,_))return!1;for(const P of T)if(!Vu(P,w))return!1}if(c.type==="MultiPolygon"){const w=Vp(c.coordinates,_,b),T=Gp(n.geometry(),p,_,b);if(!Gs(p,_))return!1;for(const P of T)if(!xm(P,w))return!1}return!0})(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Gu=class{constructor(a=[],t=(n,c)=>n<c?-1:n>c?1:0){if(this.data=a,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(a){this.data.push(a),this._up(this.length++)}pop(){if(this.length===0)return;const a=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:t,compare:n}=this,c=t[a];for(;a>0;){const p=a-1>>1,_=t[p];if(n(c,_)>=0)break;t[a]=_,a=p}t[a]=c}_down(a){const{data:t,compare:n}=this,c=this.length>>1,p=t[a];for(;a<c;){let _=1+(a<<1);const b=_+1;if(b<this.length&&n(t[b],t[_])<0&&(_=b),n(t[_],p)>=0)break;t[a]=t[_],a=_}t[a]=p}};function Zu(a,t,n=0,c=a.length-1,p=wm){for(;c>n;){if(c-n>600){const T=c-n+1,P=t-n+1,E=Math.log(T),z=.5*Math.exp(2*E/3),F=.5*Math.sqrt(E*z*(T-z)/T)*(P-T/2<0?-1:1);Zu(a,t,Math.max(n,Math.floor(t-P*z/T+F)),Math.min(c,Math.floor(t+(T-P)*z/T+F)),p)}const _=a[t];let b=n,w=c;for(Zs(a,n,t),p(a[c],_)>0&&Zs(a,n,c);b<w;){for(Zs(a,b,w),b++,w--;p(a[b],_)<0;)b++;for(;p(a[w],_)>0;)w--}p(a[n],_)===0?Zs(a,n,w):(w++,Zs(a,w,c)),w<=t&&(n=w+1),t<=w&&(c=w-1)}}function Zs(a,t,n){const c=a[t];a[t]=a[n],a[n]=c}function wm(a,t){return a<t?-1:a>t?1:0}function Ws(a,t){if(a.length<=1)return[a];const n=[];let c,p;for(const _ of a){const b=Tm(_);b!==0&&(_.area=Math.abs(b),p===void 0&&(p=b<0),p===b<0?(c&&n.push(c),c=[_]):c.push(_))}if(c&&n.push(c),t>1)for(let _=0;_<n.length;_++)n[_].length<=t||(Zu(n[_],t,1,n[_].length-1,Zp),n[_]=n[_].slice(0,t));return n}function Zp(a,t){return t.area-a.area}function Tm(a){let t=0;for(let n,c,p=0,_=a.length,b=_-1;p<_;b=p++)n=a[p],c=a[b],t+=(c.x-n.x)*(n.y+c.y);return t}const Wp=1/298.257223563,Hp=Wp*(2-Wp),Wu=Math.PI/180;class Hu{constructor(t){const n=6378.137*Wu*1e3,c=Math.cos(t*Wu),p=1/(1-Hp*(1-c*c)),_=Math.sqrt(p);this.kx=n*_*c,this.ky=n*_*p*(1-Hp)}distance(t,n){const c=this.wrap(t[0]-n[0])*this.kx,p=(t[1]-n[1])*this.ky;return Math.sqrt(c*c+p*p)}pointOnLine(t,n){let c,p,_,b,w=1/0;for(let T=0;T<t.length-1;T++){let P=t[T][0],E=t[T][1],z=this.wrap(t[T+1][0]-P)*this.kx,F=(t[T+1][1]-E)*this.ky,$=0;z===0&&F===0||($=(this.wrap(n[0]-P)*this.kx*z+(n[1]-E)*this.ky*F)/(z*z+F*F),$>1?(P=t[T+1][0],E=t[T+1][1]):$>0&&(P+=z/this.kx*$,E+=F/this.ky*$)),z=this.wrap(n[0]-P)*this.kx,F=(n[1]-E)*this.ky;const N=z*z+F*F;N<w&&(w=N,c=P,p=E,_=T,b=$)}return{point:[c,p],index:_,t:Math.max(0,Math.min(1,b))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Xp(a,t){return t[0]-a[0]}function lc(a){return a[1]-a[0]+1}function ha(a,t){return a[1]>=a[0]&&a[1]<t}function Jt(a,t){if(a[0]>a[1])return[null,null];const n=lc(a);if(t){if(n===2)return[a,null];const p=Math.floor(n/2);return[[a[0],a[0]+p],[a[0]+p,a[1]]]}if(n===1)return[a,null];const c=Math.floor(n/2)-1;return[[a[0],a[0]+c],[a[0]+c+1,a[1]]]}function Xu(a,t){if(!ha(t,a.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let c=t[0];c<=t[1];++c)qs(n,a[c]);return n}function Ku(a){const t=[1/0,1/0,-1/0,-1/0];for(const n of a)for(const c of n)qs(t,c);return t}function Kp(a){return a[0]!==-1/0&&a[1]!==-1/0&&a[2]!==1/0&&a[3]!==1/0}function Yu(a,t,n){if(!Kp(a)||!Kp(t))return NaN;let c=0,p=0;return a[2]<t[0]&&(c=t[0]-a[2]),a[0]>t[2]&&(c=a[0]-t[2]),a[1]>t[3]&&(p=a[1]-t[3]),a[3]<t[1]&&(p=t[1]-a[3]),n.distance([0,0],[c,p])}function vo(a,t,n){const c=n.pointOnLine(t,a);return n.distance(a,c.point)}function Ju(a,t,n,c,p){const _=Math.min(vo(a,[n,c],p),vo(t,[n,c],p)),b=Math.min(vo(n,[a,t],p),vo(c,[a,t],p));return Math.min(_,b)}function Sm(a,t,n,c,p){if(!ha(t,a.length)||!ha(c,n.length))return 1/0;let _=1/0;for(let b=t[0];b<t[1];++b){const w=a[b],T=a[b+1];for(let P=c[0];P<c[1];++P){const E=n[P],z=n[P+1];if(oc(w,T,E,z))return 0;_=Math.min(_,Ju(w,T,E,z,p))}}return _}function km(a,t,n,c,p){if(!ha(t,a.length)||!ha(c,n.length))return NaN;let _=1/0;for(let b=t[0];b<=t[1];++b)for(let w=c[0];w<=c[1];++w)if(_=Math.min(_,p.distance(a[b],n[w])),_===0)return _;return _}function Cm(a,t,n){if(yo(a,t,!0))return 0;let c=1/0;for(const p of t){const _=p[0],b=p[p.length-1];if(_!==b&&(c=Math.min(c,vo(a,[b,_],n)),c===0))return c;const w=n.pointOnLine(p,a);if(c=Math.min(c,n.distance(a,w.point)),c===0)return c}return c}function Pm(a,t,n,c){if(!ha(t,a.length))return NaN;for(let _=t[0];_<=t[1];++_)if(yo(a[_],n,!0))return 0;let p=1/0;for(let _=t[0];_<t[1];++_){const b=a[_],w=a[_+1];for(const T of n)for(let P=0,E=T.length,z=E-1;P<E;z=P++){const F=T[z],$=T[P];if(oc(b,w,F,$))return 0;p=Math.min(p,Ju(b,w,F,$,c))}}return p}function Yp(a,t){for(const n of a)for(const c of n)if(yo(c,t,!0))return!0;return!1}function Mm(a,t,n,c=1/0){const p=Ku(a),_=Ku(t);if(c!==1/0&&Yu(p,_,n)>=c)return c;if(Gs(p,_)){if(Yp(a,t))return 0}else if(Yp(t,a))return 0;let b=1/0;for(const w of a)for(let T=0,P=w.length,E=P-1;T<P;E=T++){const z=w[E],F=w[T];for(const $ of t)for(let N=0,q=$.length,H=q-1;N<q;H=N++){const Q=$[H],me=$[N];if(oc(z,F,Q,me))return 0;b=Math.min(b,Ju(z,F,Q,me,n))}}return b}function Jp(a,t,n,c,p,_){if(!_)return;const b=Yu(Xu(c,_),p,n);b<t&&a.push([b,_,[0,0]])}function cc(a,t,n,c,p,_,b){if(!_||!b)return;const w=Yu(Xu(c,_),Xu(p,b),n);w<t&&a.push([w,_,b])}function uc(a,t,n,c,p=1/0){let _=Math.min(c.distance(a[0],n[0][0]),p);if(_===0)return _;const b=new Gu([[0,[0,a.length-1],[0,0]]],Xp),w=Ku(n);for(;b.length>0;){const T=b.pop();if(T[0]>=_)continue;const P=T[1],E=t?50:100;if(lc(P)<=E){if(!ha(P,a.length))return NaN;if(t){const z=Pm(a,P,n,c);if(isNaN(z)||z===0)return z;_=Math.min(_,z)}else for(let z=P[0];z<=P[1];++z){const F=Cm(a[z],n,c);if(_=Math.min(_,F),_===0)return 0}}else{const z=Jt(P,t);Jp(b,_,c,a,w,z[0]),Jp(b,_,c,a,w,z[1])}}return _}function hc(a,t,n,c,p,_=1/0){let b=Math.min(_,p.distance(a[0],n[0]));if(b===0)return b;const w=new Gu([[0,[0,a.length-1],[0,n.length-1]]],Xp);for(;w.length>0;){const T=w.pop();if(T[0]>=b)continue;const P=T[1],E=T[2],z=t?50:100,F=c?50:100;if(lc(P)<=z&&lc(E)<=F){if(!ha(P,a.length)&&ha(E,n.length))return NaN;let $;if(t&&c)$=Sm(a,P,n,E,p),b=Math.min(b,$);else if(t&&!c){const N=a.slice(P[0],P[1]+1);for(let q=E[0];q<=E[1];++q)if($=vo(n[q],N,p),b=Math.min(b,$),b===0)return b}else if(!t&&c){const N=n.slice(E[0],E[1]+1);for(let q=P[0];q<=P[1];++q)if($=vo(a[q],N,p),b=Math.min(b,$),b===0)return b}else $=km(a,P,n,E,p),b=Math.min(b,$)}else{const $=Jt(P,t),N=Jt(E,c);cc(w,b,p,a,n,$[0],N[0]),cc(w,b,p,a,n,$[0],N[1]),cc(w,b,p,a,n,$[1],N[0]),cc(w,b,p,a,n,$[1],N[1])}}return b}function Qu(a){return a.type==="MultiPolygon"?a.coordinates.map((t=>({type:"Polygon",coordinates:t}))):a.type==="MultiLineString"?a.coordinates.map((t=>({type:"LineString",coordinates:t}))):a.type==="MultiPoint"?a.coordinates.map((t=>({type:"Point",coordinates:t}))):[a]}class bo{constructor(t,n){this.type=We,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(fo(t[1])){const c=t[1];if(c.type==="FeatureCollection")return new bo(c,c.features.map((p=>Qu(p.geometry))).flat());if(c.type==="Feature")return new bo(c,Qu(c.geometry));if("type"in c&&"coordinates"in c)return new bo(c,Qu(c))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(n,c){const p=n.geometry(),_=p.flat().map((T=>ac([T.x,T.y],n.canonical)));if(p.length===0)return NaN;const b=new Hu(_[0][1]);let w=1/0;for(const T of c){switch(T.type){case"Point":w=Math.min(w,hc(_,!1,[T.coordinates],!1,b,w));break;case"LineString":w=Math.min(w,hc(_,!1,T.coordinates,!0,b,w));break;case"Polygon":w=Math.min(w,uc(_,!1,T.coordinates,b,w))}if(w===0)return w}return w})(t,this.geometries);if(t.geometryType()==="LineString")return(function(n,c){const p=n.geometry(),_=p.flat().map((T=>ac([T.x,T.y],n.canonical)));if(p.length===0)return NaN;const b=new Hu(_[0][1]);let w=1/0;for(const T of c){switch(T.type){case"Point":w=Math.min(w,hc(_,!0,[T.coordinates],!1,b,w));break;case"LineString":w=Math.min(w,hc(_,!0,T.coordinates,!0,b,w));break;case"Polygon":w=Math.min(w,uc(_,!0,T.coordinates,b,w))}if(w===0)return w}return w})(t,this.geometries);if(t.geometryType()==="Polygon")return(function(n,c){const p=n.geometry();if(p.length===0||p[0].length===0)return NaN;const _=Ws(p,0).map((T=>T.map((P=>P.map((E=>ac([E.x,E.y],n.canonical))))))),b=new Hu(_[0][0][0][1]);let w=1/0;for(const T of c)for(const P of _){switch(T.type){case"Point":w=Math.min(w,uc([T.coordinates],!1,P,b,w));break;case"LineString":w=Math.min(w,uc(T.coordinates,!0,P,b,w));break;case"Polygon":w=Math.min(w,Mm(P,T.coordinates,b,w))}if(w===0)return w}return w})(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class Hs{constructor(t){this.type=Ct,this.key=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const c=t[1];return c==null?n.error("Global state property must be defined."):typeof c!="string"?n.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new Hs(c)}evaluate(t){var n;const c=(n=t.globals)===null||n===void 0?void 0:n.globalState;return c&&Object.keys(c).length!==0?Qo(c,this.key):null}eachChild(){}outputDefined(){return!1}}const is={"==":$p,"!=":rc,">":$u,"<":mm,">=":ym,"<=":gm,array:en,at:ec,boolean:en,case:ts,coalesce:Ns,collator:ic,format:go,image:Uu,in:tc,"index-of":bn,interpolate:di,"interpolate-hcl":di,"interpolate-lab":di,length:nc,let:js,literal:ua,match:ii,number:en,"number-format":Nu,object:en,slice:Os,step:Er,string:en,"to-boolean":Hn,"to-color":Hn,"to-number":Hn,"to-string":Hn,var:Ql,within:_o,distance:bo,"global-state":Hs};class un{constructor(t,n,c,p){this.name=t,this.type=n,this._evaluate=c,this.args=p}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,n){const c=t[0],p=un.definitions[c];if(!p)return n.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(p)?p[0]:p.type,b=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,w=b.filter((([P])=>!Array.isArray(P)||P.length===t.length-1));let T=null;for(const[P,E]of w){T=new es(n.registry,pc,n.path,null,n.scope);const z=[];let F=!1;for(let $=1;$<t.length;$++){const N=t[$],q=Array.isArray(P)?P[$-1]:P.type,H=T.parse(N,1+z.length,q);if(!H){F=!0;break}z.push(H)}if(!F)if(Array.isArray(P)&&P.length!==z.length)T.error(`Expected ${P.length} arguments, but found ${z.length} instead.`);else{for(let $=0;$<z.length;$++){const N=Array.isArray(P)?P[$]:P.type,q=z[$];T.concat($+1).checkSubtype(N,q.type)}if(T.errors.length===0)return new un(c,_,E,z)}}if(w.length===1)n.errors.push(...T.errors);else{const P=(w.length?w:b).map((([z])=>{return F=z,Array.isArray(F)?`(${F.map(ur).join(", ")})`:`(${ur(F.type)}...)`;var F})).join(" | "),E=[];for(let z=1;z<t.length;z++){const F=n.parse(t[z],1+E.length);if(!F)return null;E.push(ur(F.type))}n.error(`Expected arguments of type ${P}, but found (${E.join(", ")}) instead.`)}return null}static register(t,n){un.definitions=n;for(const c in n)t[c]=un}}function Qp(a,[t,n,c,p]){t=t.evaluate(a),n=n.evaluate(a),c=c.evaluate(a);const _=p?p.evaluate(a):1,b=yr(t,n,c,_);if(b)throw new hr(b);return new Dt(t/255,n/255,c/255,_,!1)}function ed(a,t){return a in t}function eh(a,t){const n=t[a];return n===void 0?null:n}function xo(a){return{type:a}}function pc(a){if(a instanceof Ql)return pc(a.boundExpression);if(a instanceof un&&a.name==="error"||a instanceof ic||a instanceof _o||a instanceof bo||a instanceof Hs)return!1;const t=a instanceof Hn||a instanceof en;let n=!0;return a.eachChild((c=>{n=t?n&&pc(c):n&&c instanceof ua})),!!n&&dc(a)&&fc(a,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function dc(a){if(a instanceof un&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof _o||a instanceof bo)return!1;let t=!0;return a.eachChild((n=>{t&&!dc(n)&&(t=!1)})),t}function Xs(a){if(a instanceof un&&a.name==="feature-state")return!1;let t=!0;return a.eachChild((n=>{t&&!Xs(n)&&(t=!1)})),t}function fc(a,t){if(a instanceof un&&t.indexOf(a.name)>=0)return!1;let n=!0;return a.eachChild((c=>{n&&!fc(c,t)&&(n=!1)})),n}function td(a){return{result:"success",value:a}}function ns(a){return{result:"error",value:a}}function Va(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function rd(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function th(a){return!!a.expression&&a.expression.interpolated}function Ot(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function Ks(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)&&ft(a)===Oa}function Am(a){return a}function id(a,t){const n=a.stops&&typeof a.stops[0][0]=="object",c=n||!(n||a.property!==void 0),p=a.type||(th(t)?"exponential":"interval"),_=(function(E){switch(E.type){case"color":return Dt.parse;case"padding":return ri.parse;case"numberArray":return Ii.parse;case"colorArray":return Nr.parse;default:return null}})(t);if(_&&((a=wi({},a)).stops&&(a.stops=a.stops.map((E=>[E[0],_(E[1])]))),a.default=_(a.default?a.default:t.default)),a.colorSpace&&(b=a.colorSpace)!=="rgb"&&b!=="hcl"&&b!=="lab")throw new Error(`Unknown color space: "${a.colorSpace}"`);var b;const w=(function(E){switch(E){case"exponential":return ad;case"interval":return Em;case"categorical":return nd;case"identity":return Im;default:throw new Error(`Unknown function type "${E}"`)}})(p);let T,P;if(p==="categorical"){T=Object.create(null);for(const E of a.stops)T[E[0]]=E[1];P=typeof a.stops[0][0]}if(n){const E={},z=[];for(let N=0;N<a.stops.length;N++){const q=a.stops[N],H=q[0].zoom;E[H]===void 0&&(E[H]={zoom:H,type:a.type,property:a.property,default:a.default,stops:[]},z.push(H)),E[H].stops.push([q[0].value,q[1]])}const F=[];for(const N of z)F.push([E[N].zoom,id(E[N],t)]);const $={name:"linear"};return{kind:"composite",interpolationType:$,interpolationFactor:di.interpolationFactor.bind(void 0,$),zoomStops:F.map((N=>N[0])),evaluate:({zoom:N},q)=>ad({stops:F,base:a.base},t,N).evaluate(N,q)}}if(c){const E=p==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:di.interpolationFactor.bind(void 0,E),zoomStops:a.stops.map((z=>z[0])),evaluate:({zoom:z})=>w(a,t,z,T,P)}}return{kind:"source",evaluate(E,z){const F=z&&z.properties?z.properties[a.property]:void 0;return F===void 0?qa(a.default,t.default):w(a,t,F,T,P)}}}function qa(a,t,n){return a!==void 0?a:t!==void 0?t:n!==void 0?n:void 0}function nd(a,t,n,c,p){return qa(typeof n===p?c[n]:void 0,a.default,t.default)}function Em(a,t,n){if(Ot(n)!=="number")return qa(a.default,t.default);const c=a.stops.length;if(c===1||n<=a.stops[0][0])return a.stops[0][1];if(n>=a.stops[c-1][0])return a.stops[c-1][1];const p=mo(a.stops.map((_=>_[0])),n);return a.stops[p][1]}function ad(a,t,n){const c=a.base!==void 0?a.base:1;if(Ot(n)!=="number")return qa(a.default,t.default);const p=a.stops.length;if(p===1||n<=a.stops[0][0])return a.stops[0][1];if(n>=a.stops[p-1][0])return a.stops[p-1][1];const _=mo(a.stops.map((E=>E[0])),n),b=(function(E,z,F,$){const N=$-F,q=E-F;return N===0?0:z===1?q/N:(Math.pow(z,q)-1)/(Math.pow(z,N)-1)})(n,c,a.stops[_][0],a.stops[_+1][0]),w=a.stops[_][1],T=a.stops[_+1][1],P=Xn[t.type]||Am;return typeof w.evaluate=="function"?{evaluate(...E){const z=w.evaluate.apply(void 0,E),F=T.evaluate.apply(void 0,E);if(z!==void 0&&F!==void 0)return P(z,F,b,a.colorSpace)}}:P(w,T,b,a.colorSpace)}function Im(a,t,n){switch(t.type){case"color":n=Dt.parse(n);break;case"formatted":n=Ei.fromString(n.toString());break;case"resolvedImage":n=Qi.fromString(n.toString());break;case"padding":n=ri.parse(n);break;case"colorArray":n=Nr.parse(n);break;case"numberArray":n=Ii.parse(n);break;default:Ot(n)===t.type||t.type==="enum"&&t.values[n]||(n=void 0)}return qa(n,a.default,t.default)}un.register(is,{error:[{kind:"error"},[Rt],(a,[t])=>{throw new hr(t.evaluate(a))}],typeof:[Rt,[Ct],(a,[t])=>ur(ft(t.evaluate(a)))],"to-rgba":[Gi(We,4),[pi],(a,[t])=>{const[n,c,p,_]=t.evaluate(a).rgb;return[255*n,255*c,255*p,_]}],rgb:[pi,[We,We,We],Qp],rgba:[pi,[We,We,We,We],Qp],has:{type:Mt,overloads:[[[Rt],(a,[t])=>ed(t.evaluate(a),a.properties())],[[Rt,Oa],(a,[t,n])=>ed(t.evaluate(a),n.evaluate(a))]]},get:{type:Ct,overloads:[[[Rt],(a,[t])=>eh(t.evaluate(a),a.properties())],[[Rt,Oa],(a,[t,n])=>eh(t.evaluate(a),n.evaluate(a))]]},"feature-state":[Ct,[Rt],(a,[t])=>eh(t.evaluate(a),a.featureState||{})],properties:[Oa,[],a=>a.properties()],"geometry-type":[Rt,[],a=>a.geometryType()],id:[Ct,[],a=>a.id()],zoom:[We,[],a=>a.globals.zoom],"heatmap-density":[We,[],a=>a.globals.heatmapDensity||0],elevation:[We,[],a=>a.globals.elevation||0],"line-progress":[We,[],a=>a.globals.lineProgress||0],accumulated:[Ct,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[We,xo(We),(a,t)=>{let n=0;for(const c of t)n+=c.evaluate(a);return n}],"*":[We,xo(We),(a,t)=>{let n=1;for(const c of t)n*=c.evaluate(a);return n}],"-":{type:We,overloads:[[[We,We],(a,[t,n])=>t.evaluate(a)-n.evaluate(a)],[[We],(a,[t])=>-t.evaluate(a)]]},"/":[We,[We,We],(a,[t,n])=>t.evaluate(a)/n.evaluate(a)],"%":[We,[We,We],(a,[t,n])=>t.evaluate(a)%n.evaluate(a)],ln2:[We,[],()=>Math.LN2],pi:[We,[],()=>Math.PI],e:[We,[],()=>Math.E],"^":[We,[We,We],(a,[t,n])=>Math.pow(t.evaluate(a),n.evaluate(a))],sqrt:[We,[We],(a,[t])=>Math.sqrt(t.evaluate(a))],log10:[We,[We],(a,[t])=>Math.log(t.evaluate(a))/Math.LN10],ln:[We,[We],(a,[t])=>Math.log(t.evaluate(a))],log2:[We,[We],(a,[t])=>Math.log(t.evaluate(a))/Math.LN2],sin:[We,[We],(a,[t])=>Math.sin(t.evaluate(a))],cos:[We,[We],(a,[t])=>Math.cos(t.evaluate(a))],tan:[We,[We],(a,[t])=>Math.tan(t.evaluate(a))],asin:[We,[We],(a,[t])=>Math.asin(t.evaluate(a))],acos:[We,[We],(a,[t])=>Math.acos(t.evaluate(a))],atan:[We,[We],(a,[t])=>Math.atan(t.evaluate(a))],min:[We,xo(We),(a,t)=>Math.min(...t.map((n=>n.evaluate(a))))],max:[We,xo(We),(a,t)=>Math.max(...t.map((n=>n.evaluate(a))))],abs:[We,[We],(a,[t])=>Math.abs(t.evaluate(a))],round:[We,[We],(a,[t])=>{const n=t.evaluate(a);return n<0?-Math.round(-n):Math.round(n)}],floor:[We,[We],(a,[t])=>Math.floor(t.evaluate(a))],ceil:[We,[We],(a,[t])=>Math.ceil(t.evaluate(a))],"filter-==":[Mt,[Rt,Ct],(a,[t,n])=>a.properties()[t.value]===n.value],"filter-id-==":[Mt,[Ct],(a,[t])=>a.id()===t.value],"filter-type-==":[Mt,[Rt],(a,[t])=>a.geometryType()===t.value],"filter-<":[Mt,[Rt,Ct],(a,[t,n])=>{const c=a.properties()[t.value],p=n.value;return typeof c==typeof p&&c<p}],"filter-id-<":[Mt,[Ct],(a,[t])=>{const n=a.id(),c=t.value;return typeof n==typeof c&&n<c}],"filter->":[Mt,[Rt,Ct],(a,[t,n])=>{const c=a.properties()[t.value],p=n.value;return typeof c==typeof p&&c>p}],"filter-id->":[Mt,[Ct],(a,[t])=>{const n=a.id(),c=t.value;return typeof n==typeof c&&n>c}],"filter-<=":[Mt,[Rt,Ct],(a,[t,n])=>{const c=a.properties()[t.value],p=n.value;return typeof c==typeof p&&c<=p}],"filter-id-<=":[Mt,[Ct],(a,[t])=>{const n=a.id(),c=t.value;return typeof n==typeof c&&n<=c}],"filter->=":[Mt,[Rt,Ct],(a,[t,n])=>{const c=a.properties()[t.value],p=n.value;return typeof c==typeof p&&c>=p}],"filter-id->=":[Mt,[Ct],(a,[t])=>{const n=a.id(),c=t.value;return typeof n==typeof c&&n>=c}],"filter-has":[Mt,[Ct],(a,[t])=>t.value in a.properties()],"filter-has-id":[Mt,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[Mt,[Gi(Rt)],(a,[t])=>t.value.indexOf(a.geometryType())>=0],"filter-id-in":[Mt,[Gi(Ct)],(a,[t])=>t.value.indexOf(a.id())>=0],"filter-in-small":[Mt,[Rt,Gi(Ct)],(a,[t,n])=>n.value.indexOf(a.properties()[t.value])>=0],"filter-in-large":[Mt,[Rt,Gi(Ct)],(a,[t,n])=>(function(c,p,_,b){for(;_<=b;){const w=_+b>>1;if(p[w]===c)return!0;p[w]>c?b=w-1:_=w+1}return!1})(a.properties()[t.value],n.value,0,n.value.length-1)],all:{type:Mt,overloads:[[[Mt,Mt],(a,[t,n])=>t.evaluate(a)&&n.evaluate(a)],[xo(Mt),(a,t)=>{for(const n of t)if(!n.evaluate(a))return!1;return!0}]]},any:{type:Mt,overloads:[[[Mt,Mt],(a,[t,n])=>t.evaluate(a)||n.evaluate(a)],[xo(Mt),(a,t)=>{for(const n of t)if(n.evaluate(a))return!0;return!1}]]},"!":[Mt,[Mt],(a,[t])=>!t.evaluate(a)],"is-supported-script":[Mt,[Rt],(a,[t])=>{const n=a.globals&&a.globals.isSupportedScript;return!n||n(t.evaluate(a))}],upcase:[Rt,[Rt],(a,[t])=>t.evaluate(a).toUpperCase()],downcase:[Rt,[Rt],(a,[t])=>t.evaluate(a).toLowerCase()],concat:[Rt,xo(Ct),(a,t)=>t.map((n=>wt(n.evaluate(a)))).join("")],"resolved-locale":[Rt,[Wl],(a,[t])=>t.evaluate(a).resolvedLocale()]});class rh{constructor(t,n){this.expression=t,this._warningHistory={},this._evaluator=new Ou,this._defaultValue=n?(function(c){if(c.type==="color"&&Ks(c.default))return new Dt(0,0,0,0);switch(c.type){case"color":return Dt.parse(c.default)||null;case"padding":return ri.parse(c.default)||null;case"numberArray":return Ii.parse(c.default)||null;case"colorArray":return Nr.parse(c.default)||null;case"variableAnchorOffsetCollection":return zi.parse(c.default)||null;case"projectionDefinition":return Ti.parse(c.default)||null;default:return c.default===void 0?null:c.default}})(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(t,n,c,p,_,b){return this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=c,this._evaluator.canonical=p,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)}evaluate(t,n,c,p,_,b){this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=c||null,this._evaluator.canonical=p,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=b||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new hr(`Expected value to be one of ${Object.keys(this._enumValues).map((T=>JSON.stringify(T))).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function mc(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in is}function Ys(a,t){const n=new es(is,pc,[],t?(function(p){const _={color:pi,string:Rt,number:We,enum:Rt,boolean:Mt,formatted:Ba,padding:Hl,numberArray:Xo,colorArray:Zn,projectionDefinition:co,resolvedImage:Ar,variableAnchorOffsetCollection:Xl};return p.type==="array"?Gi(_[p.value]||Ct,p.length):_[p.type]})(t):void 0),c=n.parse(a,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?td(new rh(c,t)):ns(n.errors)}class Js{constructor(t,n){this.kind=t,this._styleExpression=n,this.isStateDependent=t!=="constant"&&!Xs(n.expression),this.globalStateRefs=tl(n.expression)}evaluateWithoutErrorHandling(t,n,c,p,_,b){return this._styleExpression.evaluateWithoutErrorHandling(t,n,c,p,_,b)}evaluate(t,n,c,p,_,b){return this._styleExpression.evaluate(t,n,c,p,_,b)}}class ih{constructor(t,n,c,p){this.kind=t,this.zoomStops=c,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!Xs(n.expression),this.globalStateRefs=tl(n.expression),this.interpolationType=p}evaluateWithoutErrorHandling(t,n,c,p,_,b){return this._styleExpression.evaluateWithoutErrorHandling(t,n,c,p,_,b)}evaluate(t,n,c,p,_,b){return this._styleExpression.evaluate(t,n,c,p,_,b)}interpolationFactor(t,n,c){return this.interpolationType?di.interpolationFactor(this.interpolationType,t,n,c):0}}function od(a,t){const n=Ys(a,t);if(n.result==="error")return n;const c=n.value.expression,p=dc(c);if(!p&&!Va(t))return ns([new Sr("","data expressions not supported")]);const _=fc(c,["zoom"]);if(!_&&!rd(t))return ns([new Sr("","zoom expressions not supported")]);const b=el(c);return b||_?b instanceof Sr?ns([b]):b instanceof di&&!th(t)?ns([new Sr("",'"interpolate" expressions cannot be used with this property')]):td(b?new ih(p?"camera":"composite",n.value,b.labels,b instanceof di?b.interpolation:void 0):new Js(p?"constant":"source",n.value)):ns([new Sr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Qs{constructor(t,n){this._parameters=t,this._specification=n,wi(this,id(this._parameters,this._specification))}static deserialize(t){return new Qs(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function el(a){let t=null;if(a instanceof js)t=el(a.result);else if(a instanceof Ns){for(const n of a.args)if(t=el(n),t)break}else(a instanceof Er||a instanceof di)&&a.input instanceof un&&a.input.name==="zoom"&&(t=a);return t instanceof Sr||a.eachChild((n=>{const c=el(n);c instanceof Sr?t=c:!t&&c?t=new Sr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&c&&t!==c&&(t=new Sr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function tl(a,t=new Set){return a instanceof Hs&&t.add(a.key),a.eachChild((n=>{tl(n,t)})),t}function gc(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const t of a.slice(1))if(!gc(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const nh={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function wo(a){if(a==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};gc(a)||(a=To(a));const t=Ys(a,nh);if(t.result==="error")throw new Error(t.value.map((n=>`${n.key}: ${n.message}`)).join(", "));return{filter:(n,c,p)=>t.value.evaluate(n,c,{},p),needGeometry:yc(a),getGlobalStateRefs:()=>tl(t.value.expression)}}function ah(a,t){return a<t?-1:a>t?1:0}function yc(a){if(!Array.isArray(a))return!1;if(a[0]==="within"||a[0]==="distance")return!0;for(let t=1;t<a.length;t++)if(yc(a[t]))return!0;return!1}function To(a){if(!a)return!0;const t=a[0];return a.length<=1?t!=="any":t==="=="?oh(a[1],a[2],"=="):t==="!="?_c(oh(a[1],a[2],"==")):t==="<"||t===">"||t==="<="||t===">="?oh(a[1],a[2],t):t==="any"?(n=a.slice(1),["any"].concat(n.map(To))):t==="all"?["all"].concat(a.slice(1).map(To)):t==="none"?["all"].concat(a.slice(1).map(To).map(_c)):t==="in"?sd(a[1],a.slice(2)):t==="!in"?_c(sd(a[1],a.slice(2))):t==="has"?ld(a[1]):t!=="!has"||_c(ld(a[1]));var n}function oh(a,t,n){switch(a){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,a,t]}}function sd(a,t){if(t.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((n=>typeof n!=typeof t[0]))?["filter-in-large",a,["literal",t.sort(ah)]]:["filter-in-small",a,["literal",t]]}}function ld(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function _c(a){return["!",a]}function sh(a){const t=typeof a;if(t==="number"||t==="boolean"||t==="string"||a==null)return JSON.stringify(a);if(Array.isArray(a)){let p="[";for(const _ of a)p+=`${sh(_)},`;return`${p}]`}const n=Object.keys(a).sort();let c="{";for(let p=0;p<n.length;p++)c+=`${JSON.stringify(n[p])}:${sh(a[n[p]])},`;return`${c}}`}function zm(a){let t="";for(const n of vt)t+=`/${sh(a[n])}`;return t}function lh(a){const t=a.value;return t?[new Be(a.key,t,"constants have been deprecated as of v8")]:[]}function kr(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Kn(a){if(Array.isArray(a))return a.map(Kn);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const t={};for(const n in a)t[n]=Kn(a[n]);return t}return kr(a)}function hn(a){const t=a.key,n=a.value,c=a.valueSpec||{},p=a.objectElementValidators||{},_=a.style,b=a.styleSpec,w=a.validateSpec;let T=[];const P=Ot(n);if(P!=="object")return[new Be(t,n,`object expected, ${P} found`)];for(const E in n){const z=E.split(".")[0],F=Qo(c,z)||c["*"];let $;if(Qo(p,z))$=p[z];else if(Qo(c,z))$=w;else if(p["*"])$=p["*"];else{if(!c["*"]){T.push(new Be(t,n[E],`unknown property "${E}"`));continue}$=w}T=T.concat($({key:(t&&`${t}.`)+E,value:n[E],valueSpec:F,style:_,styleSpec:b,object:n,objectKey:E,validateSpec:w},n))}for(const E in c)p[E]||c[E].required&&c[E].default===void 0&&n[E]===void 0&&T.push(new Be(t,n,`missing required property "${E}"`));return T}function vc(a){const t=a.value,n=a.valueSpec,c=a.style,p=a.styleSpec,_=a.key,b=a.arrayElementValidator||a.validateSpec;if(Ot(t)!=="array")return[new Be(_,t,`array expected, ${Ot(t)} found`)];if(n.length&&t.length!==n.length)return[new Be(_,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new Be(_,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let w={type:n.value,values:n.values};p.$version<7&&(w.function=n.function),Ot(n.value)==="object"&&(w=n.value);let T=[];for(let P=0;P<t.length;P++)T=T.concat(b({array:t,arrayIndex:P,value:t[P],valueSpec:w,validateSpec:a.validateSpec,style:c,styleSpec:p,key:`${_}[${P}]`}));return T}function rl(a){const t=a.key,n=a.value,c=a.valueSpec;let p=Ot(n);return p==="number"&&n!=n&&(p="NaN"),p!=="number"?[new Be(t,n,`number expected, ${p} found`)]:"minimum"in c&&n<c.minimum?[new Be(t,n,`${n} is less than the minimum value ${c.minimum}`)]:"maximum"in c&&n>c.maximum?[new Be(t,n,`${n} is greater than the maximum value ${c.maximum}`)]:[]}function cd(a){const t=a.valueSpec,n=kr(a.value.type);let c,p,_,b={};const w=n!=="categorical"&&a.value.property===void 0,T=!w,P=Ot(a.value.stops)==="array"&&Ot(a.value.stops[0])==="array"&&Ot(a.value.stops[0][0])==="object",E=hn({key:a.key,value:a.value,valueSpec:a.styleSpec.function,validateSpec:a.validateSpec,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function($){if(n==="identity")return[new Be($.key,$.value,'identity function may not have a "stops" property')];let N=[];const q=$.value;return N=N.concat(vc({key:$.key,value:q,valueSpec:$.valueSpec,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec,arrayElementValidator:z})),Ot(q)==="array"&&q.length===0&&N.push(new Be($.key,q,"array must have at least one stop")),N},default:function($){return $.validateSpec({key:$.key,value:$.value,valueSpec:t,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec})}}});return n==="identity"&&w&&E.push(new Be(a.key,a.value,'missing required property "property"')),n==="identity"||a.value.stops||E.push(new Be(a.key,a.value,'missing required property "stops"')),n==="exponential"&&a.valueSpec.expression&&!th(a.valueSpec)&&E.push(new Be(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(T&&!Va(a.valueSpec)?E.push(new Be(a.key,a.value,"property functions not supported")):w&&!rd(a.valueSpec)&&E.push(new Be(a.key,a.value,"zoom functions not supported"))),n!=="categorical"&&!P||a.value.property!==void 0||E.push(new Be(a.key,a.value,'"property" property is required')),E;function z($){let N=[];const q=$.value,H=$.key;if(Ot(q)!=="array")return[new Be(H,q,`array expected, ${Ot(q)} found`)];if(q.length!==2)return[new Be(H,q,`array length 2 expected, length ${q.length} found`)];if(P){if(Ot(q[0])!=="object")return[new Be(H,q,`object expected, ${Ot(q[0])} found`)];if(q[0].zoom===void 0)return[new Be(H,q,"object stop key must have zoom")];if(q[0].value===void 0)return[new Be(H,q,"object stop key must have value")];if(_&&_>kr(q[0].zoom))return[new Be(H,q[0].zoom,"stop zoom values must appear in ascending order")];kr(q[0].zoom)!==_&&(_=kr(q[0].zoom),p=void 0,b={}),N=N.concat(hn({key:`${H}[0]`,value:q[0],valueSpec:{zoom:{}},validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec,objectElementValidators:{zoom:rl,value:F}}))}else N=N.concat(F({key:`${H}[0]`,value:q[0],validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec},q));return mc(Kn(q[1]))?N.concat([new Be(`${H}[1]`,q[1],"expressions are not allowed in function stops.")]):N.concat($.validateSpec({key:`${H}[1]`,value:q[1],valueSpec:t,validateSpec:$.validateSpec,style:$.style,styleSpec:$.styleSpec}))}function F($,N){const q=Ot($.value),H=kr($.value),Q=$.value!==null?$.value:N;if(c){if(q!==c)return[new Be($.key,Q,`${q} stop domain type must match previous stop domain type ${c}`)]}else c=q;if(q!=="number"&&q!=="string"&&q!=="boolean")return[new Be($.key,Q,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&n!=="categorical"){let me=`number expected, ${q} found`;return Va(t)&&n===void 0&&(me+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Be($.key,Q,me)]}return n!=="categorical"||q!=="number"||isFinite(H)&&Math.floor(H)===H?n!=="categorical"&&q==="number"&&p!==void 0&&H<p?[new Be($.key,Q,"stop domain values must appear in ascending order")]:(p=H,n==="categorical"&&H in b?[new Be($.key,Q,"stop domain values must be unique")]:(b[H]=!0,[])):[new Be($.key,Q,`integer expected, found ${H}`)]}}function So(a){const t=(a.expressionContext==="property"?od:Ys)(Kn(a.value),a.valueSpec);if(t.result==="error")return t.value.map((c=>new Be(`${a.key}${c.key}`,a.value,c.message)));const n=t.value.expression||t.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!n.outputDefined())return[new Be(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!Xs(n))return[new Be(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!Xs(n))return[new Be(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!fc(n,["zoom","feature-state"]))return[new Be(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!dc(n))return[new Be(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function bc(a){const t=a.key,n=a.value,c=Ot(n);return c!=="string"?[new Be(t,n,`color expected, ${c} found`)]:Dt.parse(String(n))?[]:[new Be(t,n,`color expected, "${n}" found`)]}function pa(a){const t=a.key,n=a.value,c=a.valueSpec,p=[];return Array.isArray(c.values)?c.values.indexOf(kr(n))===-1&&p.push(new Be(t,n,`expected one of [${c.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(c.values).indexOf(kr(n))===-1&&p.push(new Be(t,n,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(n)} found`)),p}function ch(a){return gc(Kn(a.value))?So(wi({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):ud(a)}function ud(a){const t=a.value,n=a.key;if(Ot(t)!=="array")return[new Be(n,t,`array expected, ${Ot(t)} found`)];const c=a.styleSpec;let p,_=[];if(t.length<1)return[new Be(n,t,"filter array must have at least 1 element")];switch(_=_.concat(pa({key:`${n}[0]`,value:t[0],valueSpec:c.filter_operator,style:a.style,styleSpec:a.styleSpec})),kr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&kr(t[1])==="$type"&&_.push(new Be(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&_.push(new Be(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(p=Ot(t[1]),p!=="string"&&_.push(new Be(`${n}[1]`,t[1],`string expected, ${p} found`)));for(let b=2;b<t.length;b++)p=Ot(t[b]),kr(t[1])==="$type"?_=_.concat(pa({key:`${n}[${b}]`,value:t[b],valueSpec:c.geometry_type,style:a.style,styleSpec:a.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&_.push(new Be(`${n}[${b}]`,t[b],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let b=1;b<t.length;b++)_=_.concat(ud({key:`${n}[${b}]`,value:t[b],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":p=Ot(t[1]),t.length!==2?_.push(new Be(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):p!=="string"&&_.push(new Be(`${n}[1]`,t[1],`string expected, ${p} found`))}return _}function hd(a,t){const n=a.key,c=a.validateSpec,p=a.style,_=a.styleSpec,b=a.value,w=a.objectKey,T=_[`${t}_${a.layerType}`];if(!T)return[];const P=w.match(/^(.*)-transition$/);if(t==="paint"&&P&&T[P[1]]&&T[P[1]].transition)return c({key:n,value:b,valueSpec:_.transition,style:p,styleSpec:_});const E=a.valueSpec||T[w];if(!E)return[new Be(n,b,`unknown property "${w}"`)];let z;if(Ot(b)==="string"&&Va(E)&&!E.tokens&&(z=/^{([^}]+)}$/.exec(b)))return[new Be(n,b,`"${w}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(z[1])} }\`.`)];const F=[];return a.layerType==="symbol"&&(w==="text-field"&&p&&!p.glyphs&&F.push(new Be(n,b,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&Ks(Kn(b))&&kr(b.type)==="identity"&&F.push(new Be(n,b,'"text-font" does not support identity functions'))),F.concat(c({key:a.key,value:b,valueSpec:E,style:p,styleSpec:_,expressionContext:"property",propertyType:t,propertyKey:w}))}function pd(a){return hd(a,"paint")}function dd(a){return hd(a,"layout")}function fd(a){let t=[];const n=a.value,c=a.key,p=a.style,_=a.styleSpec;if(Ot(n)!=="object")return[new Be(c,n,`object expected, ${Ot(n)} found`)];n.type||n.ref||t.push(new Be(c,n,'either "type" or "ref" is required'));let b=kr(n.type);const w=kr(n.ref);if(n.id){const T=kr(n.id);for(let P=0;P<a.arrayIndex;P++){const E=p.layers[P];kr(E.id)===T&&t.push(new Be(c,n.id,`duplicate layer id "${n.id}", previously used at line ${E.id.__line__}`))}}if("ref"in n){let T;["type","source","source-layer","filter","layout"].forEach((P=>{P in n&&t.push(new Be(c,n[P],`"${P}" is prohibited for ref layers`))})),p.layers.forEach((P=>{kr(P.id)===w&&(T=P)})),T?T.ref?t.push(new Be(c,n.ref,"ref cannot reference another ref layer")):b=kr(T.type):t.push(new Be(c,n.ref,`ref layer "${w}" not found`))}else if(b!=="background")if(n.source){const T=p.sources&&p.sources[n.source],P=T&&kr(T.type);T?P==="vector"&&b==="raster"?t.push(new Be(c,n.source,`layer "${n.id}" requires a raster source`)):P!=="raster-dem"&&b==="hillshade"||P!=="raster-dem"&&b==="color-relief"?t.push(new Be(c,n.source,`layer "${n.id}" requires a raster-dem source`)):P==="raster"&&b!=="raster"?t.push(new Be(c,n.source,`layer "${n.id}" requires a vector source`)):P!=="vector"||n["source-layer"]?P==="raster-dem"&&b!=="hillshade"&&b!=="color-relief"?t.push(new Be(c,n.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):b!=="line"||!n.paint||!n.paint["line-gradient"]||P==="geojson"&&T.lineMetrics||t.push(new Be(c,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Be(c,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new Be(c,n.source,`source "${n.source}" not found`))}else t.push(new Be(c,n,'missing required property "source"'));return t=t.concat(hn({key:c,value:n,valueSpec:_.layer,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,objectElementValidators:{"*":()=>[],type:()=>a.validateSpec({key:`${c}.type`,value:n.type,valueSpec:_.layer.type,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,object:n,objectKey:"type"}),filter:ch,layout:T=>hn({layer:n,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":P=>dd(wi({layerType:b},P))}}),paint:T=>hn({layer:n,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":P=>pd(wi({layerType:b},P))}})}})),t}function wn(a){const t=a.value,n=a.key,c=Ot(t);return c!=="string"?[new Be(n,t,`string expected, ${c} found`)]:[]}const as={promoteId:function({key:a,value:t}){if(Ot(t)==="string")return wn({key:a,value:t});{const n=[];for(const c in t)n.push(...wn({key:`${a}.${c}`,value:t[c]}));return n}}};function Zi(a){const t=a.value,n=a.key,c=a.styleSpec,p=a.style,_=a.validateSpec;if(!t.type)return[new Be(n,t,'"type" is required')];const b=kr(t.type);let w;switch(b){case"vector":case"raster":return w=hn({key:n,value:t,valueSpec:c[`source_${b.replace("-","_")}`],style:a.style,styleSpec:c,objectElementValidators:as,validateSpec:_}),w;case"raster-dem":return w=(function(T){var P;const E=(P=T.sourceName)!==null&&P!==void 0?P:"",z=T.value,F=T.styleSpec,$=F.source_raster_dem,N=T.style;let q=[];const H=Ot(z);if(z===void 0)return q;if(H!=="object")return q.push(new Be("source_raster_dem",z,`object expected, ${H} found`)),q;const Q=kr(z.encoding)==="custom",me=["redFactor","greenFactor","blueFactor","baseShift"],ae=T.value.encoding?`"${T.value.encoding}"`:"Default";for(const se in z)!Q&&me.includes(se)?q.push(new Be(se,z[se],`In "${E}": "${se}" is only valid when "encoding" is set to "custom". ${ae} encoding found`)):$[se]?q=q.concat(T.validateSpec({key:se,value:z[se],valueSpec:$[se],validateSpec:T.validateSpec,style:N,styleSpec:F})):q.push(new Be(se,z[se],`unknown property "${se}"`));return q})({sourceName:n,value:t,style:a.style,styleSpec:c,validateSpec:_}),w;case"geojson":if(w=hn({key:n,value:t,valueSpec:c.source_geojson,style:p,styleSpec:c,validateSpec:_,objectElementValidators:as}),t.cluster)for(const T in t.clusterProperties){const[P,E]=t.clusterProperties[T],z=typeof P=="string"?[P,["accumulated"],["get",T]]:P;w.push(...So({key:`${n}.${T}.map`,value:E,expressionContext:"cluster-map"})),w.push(...So({key:`${n}.${T}.reduce`,value:z,expressionContext:"cluster-reduce"}))}return w;case"video":return hn({key:n,value:t,valueSpec:c.source_video,style:p,validateSpec:_,styleSpec:c});case"image":return hn({key:n,value:t,valueSpec:c.source_image,style:p,validateSpec:_,styleSpec:c});case"canvas":return[new Be(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return pa({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function os(a){const t=a.value,n=a.styleSpec,c=n.light,p=a.style;let _=[];const b=Ot(t);if(t===void 0)return _;if(b!=="object")return _=_.concat([new Be("light",t,`object expected, ${b} found`)]),_;for(const w in t){const T=w.match(/^(.*)-transition$/);_=_.concat(T&&c[T[1]]&&c[T[1]].transition?a.validateSpec({key:w,value:t[w],valueSpec:n.transition,validateSpec:a.validateSpec,style:p,styleSpec:n}):c[w]?a.validateSpec({key:w,value:t[w],valueSpec:c[w],validateSpec:a.validateSpec,style:p,styleSpec:n}):[new Be(w,t[w],`unknown property "${w}"`)])}return _}function uh(a){const t=a.value,n=a.styleSpec,c=n.sky,p=a.style,_=Ot(t);if(t===void 0)return[];if(_!=="object")return[new Be("sky",t,`object expected, ${_} found`)];let b=[];for(const w in t)b=b.concat(c[w]?a.validateSpec({key:w,value:t[w],valueSpec:c[w],style:p,styleSpec:n}):[new Be(w,t[w],`unknown property "${w}"`)]);return b}function md(a){const t=a.value,n=a.styleSpec,c=n.terrain,p=a.style;let _=[];const b=Ot(t);if(t===void 0)return _;if(b!=="object")return _=_.concat([new Be("terrain",t,`object expected, ${b} found`)]),_;for(const w in t)_=_.concat(c[w]?a.validateSpec({key:w,value:t[w],valueSpec:c[w],validateSpec:a.validateSpec,style:p,styleSpec:n}):[new Be(w,t[w],`unknown property "${w}"`)]);return _}function gd(a){let t=[];const n=a.value,c=a.key;if(Array.isArray(n)){const p=[],_=[];for(const b in n)n[b].id&&p.includes(n[b].id)&&t.push(new Be(c,n,`all the sprites' ids must be unique, but ${n[b].id} is duplicated`)),p.push(n[b].id),n[b].url&&_.includes(n[b].url)&&t.push(new Be(c,n,`all the sprites' URLs must be unique, but ${n[b].url} is duplicated`)),_.push(n[b].url),t=t.concat(hn({key:`${c}[${b}]`,value:n[b],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:a.validateSpec}));return t}return wn({key:c,value:n})}function ss(a){return t=a.value,t&&t.constructor===Object?[]:[new Be(a.key,a.value,`object expected, ${Ot(a.value)} found`)];var t}const hh={"*":()=>[],array:vc,boolean:function(a){const t=a.value,n=a.key,c=Ot(t);return c!=="boolean"?[new Be(n,t,`boolean expected, ${c} found`)]:[]},number:rl,color:bc,constants:lh,enum:pa,filter:ch,function:cd,layer:fd,object:hn,source:Zi,light:os,sky:uh,terrain:md,projection:function(a){const t=a.value,n=a.styleSpec,c=n.projection,p=a.style,_=Ot(t);if(t===void 0)return[];if(_!=="object")return[new Be("projection",t,`object expected, ${_} found`)];let b=[];for(const w in t)b=b.concat(c[w]?a.validateSpec({key:w,value:t[w],valueSpec:c[w],style:p,styleSpec:n}):[new Be(w,t[w],`unknown property "${w}"`)]);return b},projectionDefinition:function(a){const t=a.key;let n=a.value;n=n instanceof String?n.valueOf():n;const c=Ot(n);return c!=="array"||(function(p){return Array.isArray(p)&&p.length===3&&typeof p[0]=="string"&&typeof p[1]=="string"&&typeof p[2]=="number"})(n)||(function(p){return!!["interpolate","step","literal"].includes(p[0])})(n)?["array","string"].includes(c)?[]:[new Be(t,n,`projection expected, invalid type "${c}" found`)]:[new Be(t,n,`projection expected, invalid array ${JSON.stringify(n)} found`)]},string:wn,formatted:function(a){return wn(a).length===0?[]:So(a)},resolvedImage:function(a){return wn(a).length===0?[]:So(a)},padding:function(a){const t=a.key,n=a.value;if(Ot(n)==="array"){if(n.length<1||n.length>4)return[new Be(t,n,`padding requires 1 to 4 values; ${n.length} values found`)];const c={type:"number"};let p=[];for(let _=0;_<n.length;_++)p=p.concat(a.validateSpec({key:`${t}[${_}]`,value:n[_],validateSpec:a.validateSpec,valueSpec:c}));return p}return rl({key:t,value:n,valueSpec:{}})},numberArray:function(a){const t=a.key,n=a.value;if(Ot(n)==="array"){const c={type:"number"};if(n.length<1)return[new Be(t,n,"array length at least 1 expected, length 0 found")];let p=[];for(let _=0;_<n.length;_++)p=p.concat(a.validateSpec({key:`${t}[${_}]`,value:n[_],validateSpec:a.validateSpec,valueSpec:c}));return p}return rl({key:t,value:n,valueSpec:{}})},colorArray:function(a){const t=a.key,n=a.value;if(Ot(n)==="array"){if(n.length<1)return[new Be(t,n,"array length at least 1 expected, length 0 found")];let c=[];for(let p=0;p<n.length;p++)c=c.concat(bc({key:`${t}[${p}]`,value:n[p]}));return c}return bc({key:t,value:n})},variableAnchorOffsetCollection:function(a){const t=a.key,n=a.value,c=Ot(n),p=a.styleSpec;if(c!=="array"||n.length<1||n.length%2!=0)return[new Be(t,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let _=[];for(let b=0;b<n.length;b+=2)_=_.concat(pa({key:`${t}[${b}]`,value:n[b],valueSpec:p.layout_symbol["text-anchor"]})),_=_.concat(vc({key:`${t}[${b+1}]`,value:n[b+1],valueSpec:{length:2,value:"number"},validateSpec:a.validateSpec,style:a.style,styleSpec:p}));return _},sprite:gd,state:ss};function ls(a){const t=a.value,n=a.valueSpec,c=a.styleSpec;return a.validateSpec=ls,n.expression&&Ks(kr(t))?cd(a):n.expression&&mc(Kn(t))?So(a):n.type&&hh[n.type]?hh[n.type](a):hn(wi({},a,{valueSpec:n.type?c[n.type]:n}))}function yd(a){const t=a.value,n=a.key,c=wn(a);return c.length||(t.indexOf("{fontstack}")===-1&&c.push(new Be(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&c.push(new Be(n,t,'"glyphs" url must include a "{range}" token'))),c}function Wi(a,t=be){let n=[];return n=n.concat(ls({key:"",value:a,valueSpec:t.$root,styleSpec:t,style:a,validateSpec:ls,objectElementValidators:{glyphs:yd,"*":()=>[]}})),a.constants&&(n=n.concat(lh({key:"constants",value:a.constants}))),cs(n)}function Tn(a){return function(t){return a({...t,validateSpec:ls})}}function cs(a){return[].concat(a).sort(((t,n)=>t.line-n.line))}function Sn(a){return function(...t){return cs(a.apply(this,t))}}Wi.source=Sn(Tn(Zi)),Wi.sprite=Sn(Tn(gd)),Wi.glyphs=Sn(Tn(yd)),Wi.light=Sn(Tn(os)),Wi.sky=Sn(Tn(uh)),Wi.terrain=Sn(Tn(md)),Wi.state=Sn(Tn(ss)),Wi.layer=Sn(Tn(fd)),Wi.filter=Sn(Tn(ch)),Wi.paintProperty=Sn(Tn(pd)),Wi.layoutProperty=Sn(Tn(dd));const us=Wi,Rm=us.light,il=us.sky,Lm=us.paintProperty,Dm=us.layoutProperty;function nl(a,t){let n=!1;if(t&&t.length)for(const c of t)a.fire(new Re(new Error(c.message))),n=!0;return n}class al{constructor(t,n,c){const p=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const b=new Int32Array(this.arrayBuffer);t=b[0],this.d=(n=b[1])+2*(c=b[2]);for(let T=0;T<this.d*this.d;T++){const P=b[3+T],E=b[3+T+1];p.push(P===E?null:b.subarray(P,E))}const w=b[3+p.length+1];this.keys=b.subarray(b[3+p.length],w),this.bboxes=b.subarray(w),this.insert=this._insertReadonly}else{this.d=n+2*c;for(let b=0;b<this.d*this.d;b++)p.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=t,this.padding=c,this.scale=n/t,this.uid=0;const _=c/n*t;this.min=-_,this.max=t+_}insert(t,n,c,p,_){this._forEachCell(n,c,p,_,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(n),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(_)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,n,c,p,_,b){this.cells[_].push(b)}query(t,n,c,p,_){const b=this.min,w=this.max;if(t<=b&&n<=b&&w<=c&&w<=p&&!_)return Array.prototype.slice.call(this.keys);{const T=[];return this._forEachCell(t,n,c,p,this._queryCell,T,{},_),T}}_queryCell(t,n,c,p,_,b,w,T){const P=this.cells[_];if(P!==null){const E=this.keys,z=this.bboxes;for(let F=0;F<P.length;F++){const $=P[F];if(w[$]===void 0){const N=4*$;(T?T(z[N+0],z[N+1],z[N+2],z[N+3]):t<=z[N+2]&&n<=z[N+3]&&c>=z[N+0]&&p>=z[N+1])?(w[$]=!0,b.push(E[$])):w[$]=!1}}}}_forEachCell(t,n,c,p,_,b,w,T){const P=this._convertToCellCoord(t),E=this._convertToCellCoord(n),z=this._convertToCellCoord(c),F=this._convertToCellCoord(p);for(let $=P;$<=z;$++)for(let N=E;N<=F;N++){const q=this.d*N+$;if((!T||T(this._convertFromCellCoord($),this._convertFromCellCoord(N),this._convertFromCellCoord($+1),this._convertFromCellCoord(N+1)))&&_.call(this,t,n,c,p,q,b,w,T))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,n=3+this.cells.length+1+1;let c=0;for(let b=0;b<this.cells.length;b++)c+=this.cells[b].length;const p=new Int32Array(n+c+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;let _=n;for(let b=0;b<t.length;b++){const w=t[b];p[3+b]=_,p.set(w,_),_+=w.length}return p[3+t.length]=_,p.set(this.keys,_),_+=this.keys.length,p[3+t.length+1]=_,p.set(this.bboxes,_),_+=this.bboxes.length,p.buffer}static serialize(t,n){const c=t.toArrayBuffer();return n&&n.push(c),{buffer:c}}static deserialize(t){return new al(t.buffer)}}const kn={};function Ye(a,t,n={}){if(kn[a])throw new Error(`${a} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:a,writeable:!1}),kn[a]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}Ye("Object",Object),Ye("Set",Set),Ye("TransferableGridIndex",al),Ye("Color",Dt),Ye("Error",Error),Ye("AJAXError",ie),Ye("ResolvedImage",Qi),Ye("StylePropertyFunction",Qs),Ye("StyleExpression",rh,{omit:["_evaluator"]}),Ye("ZoomDependentExpression",ih),Ye("ZoomConstantExpression",Js),Ye("CompoundExpression",un,{omit:["_evaluate"]});for(const a in is)is[a]._classRegistryKey||Ye(`Expression_${a}`,is[a]);function ph(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function xc(a){return a.$name||a.constructor._classRegistryKey}function dh(a){return!(function(t){if(t===null||typeof t!="object")return!1;const n=xc(t);return!(!n||n==="Object")})(a)&&(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob||a instanceof Error||ph(a)||qn(a)||ArrayBuffer.isView(a)||a instanceof ImageData)}function hs(a,t){if(dh(a))return(ph(a)||qn(a))&&t&&t.push(a),ArrayBuffer.isView(a)&&t&&t.push(a.buffer),a instanceof ImageData&&t&&t.push(a.data.buffer),a;if(Array.isArray(a)){const _=[];for(const b of a)_.push(hs(b,t));return _}if(typeof a!="object")throw new Error("can't serialize object of type "+typeof a);const n=xc(a);if(!n)throw new Error(`can't serialize object of unregistered class ${a.constructor.name}`);if(!kn[n])throw new Error(`${n} is not registered.`);const{klass:c}=kn[n],p=c.serialize?c.serialize(a,t):{};if(c.serialize){if(t&&p===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const _ in a){if(!a.hasOwnProperty(_)||kn[n].omit.indexOf(_)>=0)continue;const b=a[_];p[_]=kn[n].shallow.indexOf(_)>=0?b:hs(b,t)}a instanceof Error&&(p.message=a.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(p.$name=n),p}function ko(a){if(dh(a))return a;if(Array.isArray(a))return a.map(ko);if(typeof a!="object")throw new Error("can't deserialize object of type "+typeof a);const t=xc(a)||"Object";if(!kn[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:n}=kn[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(a);const c=Object.create(n.prototype);for(const p of Object.keys(a)){if(p==="$name")continue;const _=a[p];c[p]=kn[t].shallow.indexOf(p)>=0?_:ko(_)}return c}class wc{constructor(){this.first=!0}update(t,n){const c=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=n),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=c,!0))}}const Ut={"Latin-1 Supplement":a=>a>=128&&a<=255,"Hangul Jamo":a=>a>=4352&&a<=4607,Khmer:a=>a>=6016&&a<=6143,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Kanbun:a=>a>=12688&&a<=12703,"CJK Strokes":a=>a>=12736&&a<=12783,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Hangul Syllables":a=>a>=44032&&a<=55215,"Private Use Area":a=>a>=57344&&a<=63743,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519};function Tc(a){for(const t of a)if(mh(t.charCodeAt(0)))return!0;return!1}function Fm(a){for(const t of a)if(!_d(t.charCodeAt(0)))return!1;return!0}function Sc(a){const t=a.map((n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}})).filter((n=>n));return new RegExp(t.join("|"),"u")}const jm=Sc(["Arab","Dupl","Mong","Ougr","Syrc"]);function _d(a){return!jm.test(String.fromCodePoint(a))}const fh=Sc(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function mh(a){return!(a!==746&&a!==747&&(a<4352||!(Ut["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Ut["CJK Compatibility"](a)||Ut["CJK Strokes"](a)||!(!Ut["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||Ut["Enclosed CJK Letters and Months"](a)||Ut["Ideographic Description Characters"](a)||Ut.Kanbun(a)||Ut.Katakana(a)&&a!==12540||!(!Ut["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!Ut["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Ut["Vertical Forms"](a)||Ut["Yijing Hexagram Symbols"](a)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(a))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(a))||fh.test(String.fromCodePoint(a)))))}function vd(a){return!(mh(a)||(function(t){return!!(Ut["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Ut["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Ut["Letterlike Symbols"](t)||Ut["Number Forms"](t)||Ut["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Ut["Control Pictures"](t)&&t!==9251||Ut["Optical Character Recognition"](t)||Ut["Enclosed Alphanumerics"](t)||Ut["Geometric Shapes"](t)||Ut["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Ut["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Ut["CJK Symbols and Punctuation"](t)||Ut.Katakana(t)||Ut["Private Use Area"](t)||Ut["CJK Compatibility Forms"](t)||Ut["Small Form Variants"](t)||Ut["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)})(a))}const bd=Sc(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function gh(a){return bd.test(String.fromCodePoint(a))}function xd(a,t){return!(!t&&gh(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Ut.Khmer(a))}function wd(a){for(const t of a)if(gh(t.charCodeAt(0)))return!0;return!1}const Cn=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(a){this.pluginStatus=a.pluginStatus,this.pluginURL=a.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(a){if(Cn.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=a.applyArabicShaping,this.processBidirectionalText=a.processBidirectionalText,this.processStyledBidirectionalText=a.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(a,t){return l(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(a.pluginStatus!=="loading")return this.setState(a),a;const n=a.pluginURL,c=new Promise((_=>{this.loadScriptResolve=_}));t(n);const p=new Promise((_=>setTimeout((()=>_()),this.TIMEOUT)));if(yield Promise.race([c,p]),this.isParsed()){const _={pluginStatus:"loaded",pluginURL:n};return this.setState(_),_}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${n}`)}))}};class vr{constructor(t,n){this.zoom=t,n?(this.now=n.now||0,this.fadeDuration=n.fadeDuration||0,this.zoomHistory=n.zoomHistory||new wc,this.transition=n.transition||{},this.globalState=n.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new wc,this.transition={},this.globalState={})}isSupportedScript(t){return(function(n,c){for(const p of n)if(!xd(p.charCodeAt(0),c))return!1;return!0})(t,Cn.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,n=t-Math.floor(t),c=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*n}}}class ps{constructor(t,n){this.property=t,this.value=n,this.expression=(function(c,p){if(Ks(c))return new Qs(c,p);if(mc(c)){const _=od(c,p);if(_.result==="error")throw new Error(_.value.map((b=>`${b.key}: ${b.message}`)).join(", "));return _.value}{let _=c;return p.type==="color"&&typeof c=="string"?_=Dt.parse(c):p.type!=="padding"||typeof c!="number"&&!Array.isArray(c)?p.type!=="numberArray"||typeof c!="number"&&!Array.isArray(c)?p.type!=="colorArray"||typeof c!="string"&&!Array.isArray(c)?p.type==="variableAnchorOffsetCollection"&&Array.isArray(c)?_=zi.parse(c):p.type==="projectionDefinition"&&typeof c=="string"&&(_=Ti.parse(c)):_=Nr.parse(c):_=Ii.parse(c):_=ri.parse(c),{globalStateRefs:new Set,kind:"constant",evaluate:()=>_}}})(n===void 0?t.specification.default:n,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(t,n,c){return this.property.possiblyEvaluate(this,t,n,c)}}class yh{constructor(t){this.property=t,this.value=new ps(t,void 0)}transitioned(t,n){return new _h(this.property,this.value,n,nr({},t.transition,this.transition),t.now)}untransitioned(){return new _h(this.property,this.value,null,{},0)}}class Td{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return gr(this._values[t].value.value)}setValue(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new yh(this._values[t].property)),this._values[t].value=new ps(this._values[t].property,n===null?void 0:gr(n))}getTransition(t){return gr(this._values[t].transition)}setTransition(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new yh(this._values[t].property)),this._values[t].transition=gr(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const c=this.getValue(n);c!==void 0&&(t[n]=c);const p=this.getTransition(n);p!==void 0&&(t[`${n}-transition`]=p)}return t}transitioned(t,n){const c=new vh(this._properties);for(const p of Object.keys(this._values))c._values[p]=this._values[p].transitioned(t,n._values[p]);return c}untransitioned(){const t=new vh(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class _h{constructor(t,n,c,p,_){this.property=t,this.value=n,this.begin=_+p.delay||0,this.end=this.begin+p.duration||0,t.specification.transition&&(p.delay||p.duration)&&(this.prior=c)}possiblyEvaluate(t,n,c){const p=t.now||0,_=this.value.possiblyEvaluate(t,n,c),b=this.prior;if(b){if(p>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(p<this.begin)return b.possiblyEvaluate(t,n,c);{const w=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(t,n,c),_,gt(w))}}return _}}class vh{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,c){const p=new kc(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].possiblyEvaluate(t,n,c);return p}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Sd{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return gr(this._values[t].value)}setValue(t,n){this._values[t]=new ps(this._values[t].property,n===null?void 0:gr(n))}serialize(){const t={};for(const n of Object.keys(this._values)){const c=this.getValue(n);c!==void 0&&(t[n]=c)}return t}possiblyEvaluate(t,n,c){const p=new kc(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].possiblyEvaluate(t,n,c);return p}}class Yn{constructor(t,n,c){this.property=t,this.value=n,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,n,c,p){return this.property.evaluate(this.value,this.parameters,t,n,c,p)}}class kc{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class ot{constructor(t){this.specification=t}possiblyEvaluate(t,n){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(n)}interpolate(t,n,c){const p=Xn[this.specification.type];return p?p(t,n,c):t}}class dt{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,c,p){return new Yn(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(n,null,{},c,p)}:t.expression,n)}interpolate(t,n,c){if(t.value.kind!=="constant"||n.value.kind!=="constant")return t;if(t.value.value===void 0||n.value.value===void 0)return new Yn(this,{kind:"constant",value:void 0},t.parameters);const p=Xn[this.specification.type];if(p){const _=p(t.value.value,n.value.value,c);return new Yn(this,{kind:"constant",value:_},t.parameters)}return t}evaluate(t,n,c,p,_,b){return t.kind==="constant"?t.value:t.evaluate(n,c,p,_,b)}}class Cc extends dt{possiblyEvaluate(t,n,c,p){if(t.value===void 0)return new Yn(this,{kind:"constant",value:void 0},n);if(t.expression.kind==="constant"){const _=t.expression.evaluate(n,null,{},c,p),b=t.property.specification.type==="resolvedImage"&&typeof _!="string"?_.name:_,w=this._calculate(b,b,b,n);return new Yn(this,{kind:"constant",value:w},n)}if(t.expression.kind==="camera"){const _=this._calculate(t.expression.evaluate({zoom:n.zoom-1}),t.expression.evaluate({zoom:n.zoom}),t.expression.evaluate({zoom:n.zoom+1}),n);return new Yn(this,{kind:"constant",value:_},n)}return new Yn(this,t.expression,n)}evaluate(t,n,c,p,_,b){if(t.kind==="source"){const w=t.evaluate(n,c,p,_,b);return this._calculate(w,w,w,n)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(n.zoom)-1},c,p),t.evaluate({zoom:Math.floor(n.zoom)},c,p),t.evaluate({zoom:Math.floor(n.zoom)+1},c,p),n):t.value}_calculate(t,n,c,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:c,to:n}}interpolate(t){return t}}class Ga{constructor(t){this.specification=t}possiblyEvaluate(t,n,c,p){if(t.value!==void 0){if(t.expression.kind==="constant"){const _=t.expression.evaluate(n,null,{},c,p);return this._calculate(_,_,_,n)}return this._calculate(t.expression.evaluate(new vr(Math.floor(n.zoom-1),n)),t.expression.evaluate(new vr(Math.floor(n.zoom),n)),t.expression.evaluate(new vr(Math.floor(n.zoom+1),n)),n)}}_calculate(t,n,c,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:c,to:n}}interpolate(t){return t}}class Pc{constructor(t){this.specification=t}possiblyEvaluate(t,n,c,p){return!!t.expression.evaluate(n,null,{},c,p)}interpolate(){return!1}}class Ri{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in t){const c=t[n];c.specification.overridable&&this.overridableProperties.push(n);const p=this.defaultPropertyValues[n]=new ps(c,void 0),_=this.defaultTransitionablePropertyValues[n]=new yh(c);this.defaultTransitioningPropertyValues[n]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=p.possiblyEvaluate({})}}}Ye("DataDrivenProperty",dt),Ye("DataConstantProperty",ot),Ye("CrossFadedDataDrivenProperty",Cc),Ye("CrossFadedProperty",Ga),Ye("ColorRampProperty",Pc);const kd="-transition";class pn extends at{constructor(t,n){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter,this._featureFilter=wo(t.filter)),n.layout&&(this._unevaluatedLayout=new Sd(n.layout)),n.paint)){this._transitionablePaint=new Td(n.paint);for(const c in t.paint)this.setPaintProperty(c,t.paint[c],{validate:!1});for(const c in t.layout)this.setLayoutProperty(c,t.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new kc(n.paint)}}setFilter(t){this.filter=t,this._featureFilter=wo(t)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}getLayoutAffectingGlobalStateRefs(){const t=new Set;if(this._unevaluatedLayout)for(const n in this._unevaluatedLayout._values){const c=this._unevaluatedLayout._values[n];for(const p of c.getGlobalStateRefs())t.add(p)}for(const n of this._featureFilter.getGlobalStateRefs())t.add(n);return t}setLayoutProperty(t,n,c={}){n!=null&&this._validate(Dm,`layers.${this.id}.layout.${t}`,t,n,c)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,n):this.visibility=n)}getPaintProperty(t){return t.endsWith(kd)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,c={}){if(n!=null&&this._validate(Lm,`layers.${this.id}.paint.${t}`,t,n,c))return!1;if(t.endsWith(kd))return this._transitionablePaint.setTransition(t.slice(0,-11),n||void 0),!1;{const p=this._transitionablePaint._values[t],_=p.property.specification["property-type"]==="cross-faded-data-driven",b=p.value.isDataDriven(),w=p.value;this._transitionablePaint.setValue(t,n),this._handleSpecialPaintPropertyUpdate(t);const T=this._transitionablePaint._values[t].value;return T.isDataDriven()||b||_||this._handleOverridablePaintPropertyUpdate(t,w,T)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,n,c){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Tr(t,((n,c)=>!(n===void 0||c==="layout"&&!Object.keys(n).length||c==="paint"&&!Object.keys(n).length)))}_validate(t,n,c,p,_={}){return(!_||_.validate!==!1)&&nl(this,t.call(us,{key:n,layerType:this.type,objectKey:c,value:p,styleSpec:be,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof Yn&&Va(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const Om={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ol{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class sr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ir(a,t=1){let n=0,c=0;return{members:a.map((p=>{const _=Om[p.type].BYTES_PER_ELEMENT,b=n=Mc(n,Math.max(t,_)),w=p.components||1;return c=Math.max(c,_),n+=_*w,{name:p.name,type:p.type,components:w,offset:b}})),size:Mc(n,Math.max(c,t)),alignment:t}}function Mc(a,t){return Math.ceil(a/t)*t}class ds extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const c=this.length;return this.resize(c+1),this.emplace(c,t,n)}emplace(t,n,c){const p=2*t;return this.int16[p+0]=n,this.int16[p+1]=c,t}}ds.prototype.bytesPerElement=4,Ye("StructArrayLayout2i4",ds);class fs extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,n,c)}emplace(t,n,c,p){const _=3*t;return this.int16[_+0]=n,this.int16[_+1]=c,this.int16[_+2]=p,t}}fs.prototype.bytesPerElement=6,Ye("StructArrayLayout3i6",fs);class bh extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,c,p){const _=this.length;return this.resize(_+1),this.emplace(_,t,n,c,p)}emplace(t,n,c,p,_){const b=4*t;return this.int16[b+0]=n,this.int16[b+1]=c,this.int16[b+2]=p,this.int16[b+3]=_,t}}bh.prototype.bytesPerElement=8,Ye("StructArrayLayout4i8",bh);class ms extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,c,p,_,b){const w=this.length;return this.resize(w+1),this.emplace(w,t,n,c,p,_,b)}emplace(t,n,c,p,_,b,w){const T=6*t;return this.int16[T+0]=n,this.int16[T+1]=c,this.int16[T+2]=p,this.int16[T+3]=_,this.int16[T+4]=b,this.int16[T+5]=w,t}}ms.prototype.bytesPerElement=12,Ye("StructArrayLayout2i4i12",ms);class Co extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,c,p,_,b){const w=this.length;return this.resize(w+1),this.emplace(w,t,n,c,p,_,b)}emplace(t,n,c,p,_,b,w){const T=4*t,P=8*t;return this.int16[T+0]=n,this.int16[T+1]=c,this.uint8[P+4]=p,this.uint8[P+5]=_,this.uint8[P+6]=b,this.uint8[P+7]=w,t}}Co.prototype.bytesPerElement=8,Ye("StructArrayLayout2i4ub8",Co);class sl extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const c=this.length;return this.resize(c+1),this.emplace(c,t,n)}emplace(t,n,c){const p=2*t;return this.float32[p+0]=n,this.float32[p+1]=c,t}}sl.prototype.bytesPerElement=8,Ye("StructArrayLayout2f8",sl);class Ac extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,c,p,_,b,w,T,P,E){const z=this.length;return this.resize(z+1),this.emplace(z,t,n,c,p,_,b,w,T,P,E)}emplace(t,n,c,p,_,b,w,T,P,E,z){const F=10*t;return this.uint16[F+0]=n,this.uint16[F+1]=c,this.uint16[F+2]=p,this.uint16[F+3]=_,this.uint16[F+4]=b,this.uint16[F+5]=w,this.uint16[F+6]=T,this.uint16[F+7]=P,this.uint16[F+8]=E,this.uint16[F+9]=z,t}}Ac.prototype.bytesPerElement=20,Ye("StructArrayLayout10ui20",Ac);class Po extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,c,p,_,b,w,T,P,E,z,F){const $=this.length;return this.resize($+1),this.emplace($,t,n,c,p,_,b,w,T,P,E,z,F)}emplace(t,n,c,p,_,b,w,T,P,E,z,F,$){const N=12*t;return this.int16[N+0]=n,this.int16[N+1]=c,this.int16[N+2]=p,this.int16[N+3]=_,this.uint16[N+4]=b,this.uint16[N+5]=w,this.uint16[N+6]=T,this.uint16[N+7]=P,this.int16[N+8]=E,this.int16[N+9]=z,this.int16[N+10]=F,this.int16[N+11]=$,t}}Po.prototype.bytesPerElement=24,Ye("StructArrayLayout4i4ui4i24",Po);class xh extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,n,c)}emplace(t,n,c,p){const _=3*t;return this.float32[_+0]=n,this.float32[_+1]=c,this.float32[_+2]=p,t}}xh.prototype.bytesPerElement=12,Ye("StructArrayLayout3f12",xh);class wh extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}wh.prototype.bytesPerElement=4,Ye("StructArrayLayout1ul4",wh);class Ec extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,c,p,_,b,w,T,P){const E=this.length;return this.resize(E+1),this.emplace(E,t,n,c,p,_,b,w,T,P)}emplace(t,n,c,p,_,b,w,T,P,E){const z=10*t,F=5*t;return this.int16[z+0]=n,this.int16[z+1]=c,this.int16[z+2]=p,this.int16[z+3]=_,this.int16[z+4]=b,this.int16[z+5]=w,this.uint32[F+3]=T,this.uint16[z+8]=P,this.uint16[z+9]=E,t}}Ec.prototype.bytesPerElement=20,Ye("StructArrayLayout6i1ul2ui20",Ec);class Th extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,c,p,_,b){const w=this.length;return this.resize(w+1),this.emplace(w,t,n,c,p,_,b)}emplace(t,n,c,p,_,b,w){const T=6*t;return this.int16[T+0]=n,this.int16[T+1]=c,this.int16[T+2]=p,this.int16[T+3]=_,this.int16[T+4]=b,this.int16[T+5]=w,t}}Th.prototype.bytesPerElement=12,Ye("StructArrayLayout2i2i2i12",Th);class g extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,c,p,_){const b=this.length;return this.resize(b+1),this.emplace(b,t,n,c,p,_)}emplace(t,n,c,p,_,b){const w=4*t,T=8*t;return this.float32[w+0]=n,this.float32[w+1]=c,this.float32[w+2]=p,this.int16[T+6]=_,this.int16[T+7]=b,t}}g.prototype.bytesPerElement=16,Ye("StructArrayLayout2f1f2i16",g);class e extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,c,p,_,b){const w=this.length;return this.resize(w+1),this.emplace(w,t,n,c,p,_,b)}emplace(t,n,c,p,_,b,w){const T=16*t,P=4*t,E=8*t;return this.uint8[T+0]=n,this.uint8[T+1]=c,this.float32[P+1]=p,this.float32[P+2]=_,this.int16[E+6]=b,this.int16[E+7]=w,t}}e.prototype.bytesPerElement=16,Ye("StructArrayLayout2ub2f2i16",e);class s extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,n,c)}emplace(t,n,c,p){const _=3*t;return this.uint16[_+0]=n,this.uint16[_+1]=c,this.uint16[_+2]=p,t}}s.prototype.bytesPerElement=6,Ye("StructArrayLayout3ui6",s);class u extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,c,p,_,b,w,T,P,E,z,F,$,N,q,H,Q){const me=this.length;return this.resize(me+1),this.emplace(me,t,n,c,p,_,b,w,T,P,E,z,F,$,N,q,H,Q)}emplace(t,n,c,p,_,b,w,T,P,E,z,F,$,N,q,H,Q,me){const ae=24*t,se=12*t,ke=48*t;return this.int16[ae+0]=n,this.int16[ae+1]=c,this.uint16[ae+2]=p,this.uint16[ae+3]=_,this.uint32[se+2]=b,this.uint32[se+3]=w,this.uint32[se+4]=T,this.uint16[ae+10]=P,this.uint16[ae+11]=E,this.uint16[ae+12]=z,this.float32[se+7]=F,this.float32[se+8]=$,this.uint8[ke+36]=N,this.uint8[ke+37]=q,this.uint8[ke+38]=H,this.uint32[se+10]=Q,this.int16[ae+22]=me,t}}u.prototype.bytesPerElement=48,Ye("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",u);class d extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,c,p,_,b,w,T,P,E,z,F,$,N,q,H,Q,me,ae,se,ke,Ee,De,Ze,$e,qe,st,Ue){const Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,t,n,c,p,_,b,w,T,P,E,z,F,$,N,q,H,Q,me,ae,se,ke,Ee,De,Ze,$e,qe,st,Ue)}emplace(t,n,c,p,_,b,w,T,P,E,z,F,$,N,q,H,Q,me,ae,se,ke,Ee,De,Ze,$e,qe,st,Ue,Ge){const ze=32*t,mt=16*t;return this.int16[ze+0]=n,this.int16[ze+1]=c,this.int16[ze+2]=p,this.int16[ze+3]=_,this.int16[ze+4]=b,this.int16[ze+5]=w,this.int16[ze+6]=T,this.int16[ze+7]=P,this.uint16[ze+8]=E,this.uint16[ze+9]=z,this.uint16[ze+10]=F,this.uint16[ze+11]=$,this.uint16[ze+12]=N,this.uint16[ze+13]=q,this.uint16[ze+14]=H,this.uint16[ze+15]=Q,this.uint16[ze+16]=me,this.uint16[ze+17]=ae,this.uint16[ze+18]=se,this.uint16[ze+19]=ke,this.uint16[ze+20]=Ee,this.uint16[ze+21]=De,this.uint16[ze+22]=Ze,this.uint32[mt+12]=$e,this.float32[mt+13]=qe,this.float32[mt+14]=st,this.uint16[ze+30]=Ue,this.uint16[ze+31]=Ge,t}}d.prototype.bytesPerElement=64,Ye("StructArrayLayout8i15ui1ul2f2ui64",d);class y extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}y.prototype.bytesPerElement=4,Ye("StructArrayLayout1f4",y);class x extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,n,c)}emplace(t,n,c,p){const _=3*t;return this.uint16[6*t+0]=n,this.float32[_+1]=c,this.float32[_+2]=p,t}}x.prototype.bytesPerElement=12,Ye("StructArrayLayout1ui2f12",x);class S extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,c){const p=this.length;return this.resize(p+1),this.emplace(p,t,n,c)}emplace(t,n,c,p){const _=4*t;return this.uint32[2*t+0]=n,this.uint16[_+2]=c,this.uint16[_+3]=p,t}}S.prototype.bytesPerElement=8,Ye("StructArrayLayout1ul2ui8",S);class k extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const c=this.length;return this.resize(c+1),this.emplace(c,t,n)}emplace(t,n,c){const p=2*t;return this.uint16[p+0]=n,this.uint16[p+1]=c,t}}k.prototype.bytesPerElement=4,Ye("StructArrayLayout2ui4",k);class A extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}A.prototype.bytesPerElement=2,Ye("StructArrayLayout1ui2",A);class I extends sr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,c,p){const _=this.length;return this.resize(_+1),this.emplace(_,t,n,c,p)}emplace(t,n,c,p,_){const b=4*t;return this.float32[b+0]=n,this.float32[b+1]=c,this.float32[b+2]=p,this.float32[b+3]=_,t}}I.prototype.bytesPerElement=16,Ye("StructArrayLayout4f16",I);class D extends ol{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new C(this.anchorPointX,this.anchorPointY)}}D.prototype.size=20;class L extends Ec{get(t){return new D(this,t)}}Ye("CollisionBoxArray",L);class O extends ol{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}O.prototype.size=48;class U extends u{get(t){return new O(this,t)}}Ye("PlacedSymbolArray",U);class K extends ol{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}K.prototype.size=64;class X extends d{get(t){return new K(this,t)}}Ye("SymbolInstanceArray",X);class Y extends y{getoffsetX(t){return this.float32[1*t+0]}}Ye("GlyphOffsetArray",Y);class ee extends fs{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Ye("SymbolLineVertexArray",ee);class ne extends ol{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ne.prototype.size=12;class te extends x{get(t){return new ne(this,t)}}Ye("TextAnchorOffsetArray",te);class oe extends ol{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}oe.prototype.size=8;class ce extends S{get(t){return new oe(this,t)}}Ye("FeatureIndexArray",ce);class re extends ds{}class _e extends ds{}class Me extends ds{}class Te extends ms{}class Se extends Co{}class Pe extends sl{}class Oe extends Ac{}class Ne extends Po{}class Le extends xh{}class it extends wh{}class Pt extends Th{}class tr extends e{}class lr extends s{}class or extends k{}const xr=Ir([{name:"a_pos",components:2,type:"Int16"}],4),{members:Cr}=xr;class kt{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,n,c,p){const _=this.segments[this.segments.length-1];return t>kt.MAX_VERTEX_ARRAY_LENGTH&&ar(`Max vertices per segment is ${kt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${kt.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!_||_.vertexLength+t>kt.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==p?this.createNewSegment(n,c,p):_}createNewSegment(t,n,c){const p={vertexOffset:t.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0,vaos:{}};return c!==void 0&&(p.sortKey=c),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(p),p}getOrCreateLatestSegment(t,n,c){return this.prepareSegment(0,t,n,c)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,c,p){return new kt([{vertexOffset:t,primitiveOffset:n,vertexLength:c,primitiveLength:p,vaos:{},sortKey:0}])}}function cr(a,t){return 256*(a=Et(Math.floor(a),0,255))+Et(Math.floor(t),0,255)}kt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ye("SegmentVector",kt);const Ur=Ir([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Yr,ni,Li,Pn={exports:{}},Za={exports:{}},Wa={exports:{}},gs=(function(){if(Li)return Pn.exports;Li=1;var a=(Yr||(Yr=1,Za.exports=function(n,c){var p,_,b,w,T,P,E,z;for(_=n.length-(p=3&n.length),b=c,T=3432918353,P=461845907,z=0;z<_;)E=255&n.charCodeAt(z)|(255&n.charCodeAt(++z))<<8|(255&n.charCodeAt(++z))<<16|(255&n.charCodeAt(++z))<<24,++z,b=27492+(65535&(w=5*(65535&(b=(b^=E=(65535&(E=(E=(65535&E)*T+(((E>>>16)*T&65535)<<16)&4294967295)<<15|E>>>17))*P+(((E>>>16)*P&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(E=0,p){case 3:E^=(255&n.charCodeAt(z+2))<<16;case 2:E^=(255&n.charCodeAt(z+1))<<8;case 1:b^=E=(65535&(E=(E=(65535&(E^=255&n.charCodeAt(z)))*T+(((E>>>16)*T&65535)<<16)&4294967295)<<15|E>>>17))*P+(((E>>>16)*P&65535)<<16)&4294967295}return b^=n.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}),Za.exports),t=(ni||(ni=1,Wa.exports=function(n,c){for(var p,_=n.length,b=c^_,w=0;_>=4;)p=1540483477*(65535&(p=255&n.charCodeAt(w)|(255&n.charCodeAt(++w))<<8|(255&n.charCodeAt(++w))<<16|(255&n.charCodeAt(++w))<<24))+((1540483477*(p>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),_-=4,++w;switch(_){case 3:b^=(255&n.charCodeAt(w+2))<<16;case 2:b^=(255&n.charCodeAt(w+1))<<8;case 1:b=1540483477*(65535&(b^=255&n.charCodeAt(w)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}),Wa.exports);return Pn.exports=a,Pn.exports.murmur3=a,Pn.exports.murmur2=t,Pn.exports})(),ys=M(gs);class Mo{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,n,c,p){this.ids.push(Ao(t)),this.positions.push(n,c,p)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=Ao(t);let c=0,p=this.ids.length-1;for(;c<p;){const b=c+p>>1;this.ids[b]>=n?p=b:c=b+1}const _=[];for(;this.ids[c]===n;)_.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return _}static serialize(t,n){const c=new Float64Array(t.ids),p=new Uint32Array(t.positions);return Hi(c,p,0,c.length-1),n&&n.push(c.buffer,p.buffer),{ids:c,positions:p}}static deserialize(t){const n=new Mo;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}function Ao(a){const t=+a;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:ys(String(a))}function Hi(a,t,n,c){for(;n<c;){const p=a[n+c>>1];let _=n-1,b=c+1;for(;;){do _++;while(a[_]<p);do b--;while(a[b]>p);if(_>=b)break;Mn(a,_,b),Mn(t,3*_,3*b),Mn(t,3*_+1,3*b+1),Mn(t,3*_+2,3*b+2)}b-n<c-b?(Hi(a,t,n,b),n=b+1):(Hi(a,t,b+1,c),c=b)}}function Mn(a,t,n){const c=a[t];a[t]=a[n],a[n]=c}Ye("FeaturePositionMap",Mo);class Di{constructor(t,n){this.gl=t.gl,this.location=n}}class Ha extends Di{constructor(t,n){super(t,n),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Vr extends Di{constructor(t,n){super(t,n),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Jr extends Di{constructor(t,n){super(t,n),this.current=Dt.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const dn=new Float32Array(16);function qr(a){return[cr(255*a.r,255*a.g),cr(255*a.b,255*a.a)]}class ll{constructor(t,n,c){this.value=t,this.uniformNames=n.map((p=>`u_${p}`)),this.type=c}setUniform(t,n,c){t.set(c.constantOr(this.value))}getBinding(t,n,c){return this.type==="color"?new Jr(t,n):new Ha(t,n)}}class _s{constructor(t,n){this.uniformNames=n.map((c=>`u_${c}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=t.tlbr}setUniform(t,n,c,p){const _=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;_&&t.set(_)}getBinding(t,n,c){return c.substr(0,9)==="u_pattern"?new Vr(t,n):new Ha(t,n)}}class da{constructor(t,n,c,p){this.expression=t,this.type=c,this.maxValue=0,this.paintVertexAttributes=n.map((_=>({name:`a_${_}`,type:"Float32",components:c==="color"?2:1,offset:0}))),this.paintVertexArray=new p}populatePaintArray(t,n,c,p,_){const b=this.paintVertexArray.length,w=this.expression.evaluate(new vr(0),n,{},p,[],_);this.paintVertexArray.resize(t),this._setPaintValue(b,t,w)}updatePaintArray(t,n,c,p){const _=this.expression.evaluate({zoom:0},c,p);this._setPaintValue(t,n,_)}_setPaintValue(t,n,c){if(this.type==="color"){const p=qr(c);for(let _=t;_<n;_++)this.paintVertexArray.emplace(_,p[0],p[1])}else{for(let p=t;p<n;p++)this.paintVertexArray.emplace(p,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class An{constructor(t,n,c,p,_,b){this.expression=t,this.uniformNames=n.map((w=>`u_${w}_t`)),this.type=c,this.useIntegerZoom=p,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=n.map((w=>({name:`a_${w}`,type:"Float32",components:c==="color"?4:2,offset:0}))),this.paintVertexArray=new b}populatePaintArray(t,n,c,p,_){const b=this.expression.evaluate(new vr(this.zoom),n,{},p,[],_),w=this.expression.evaluate(new vr(this.zoom+1),n,{},p,[],_),T=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(T,t,b,w)}updatePaintArray(t,n,c,p){const _=this.expression.evaluate({zoom:this.zoom},c,p),b=this.expression.evaluate({zoom:this.zoom+1},c,p);this._setPaintValue(t,n,_,b)}_setPaintValue(t,n,c,p){if(this.type==="color"){const _=qr(c),b=qr(p);for(let w=t;w<n;w++)this.paintVertexArray.emplace(w,_[0],_[1],b[0],b[1])}else{for(let _=t;_<n;_++)this.paintVertexArray.emplace(_,c,p);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(p))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n){const c=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,p=Et(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);t.set(p)}getBinding(t,n,c){return new Ha(t,n)}}class Xa{constructor(t,n,c,p,_,b){this.expression=t,this.type=n,this.useIntegerZoom=c,this.zoom=p,this.layerId=b,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(t,n,c){const p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(p,t,n.patterns&&n.patterns[this.layerId],c)}updatePaintArray(t,n,c,p,_){this._setPaintValues(t,n,c.patterns&&c.patterns[this.layerId],_)}_setPaintValues(t,n,c,p){if(!p||!c)return;const{min:_,mid:b,max:w}=c,T=p[_],P=p[b],E=p[w];if(T&&P&&E)for(let z=t;z<n;z++)this.zoomInPaintVertexArray.emplace(z,P.tl[0],P.tl[1],P.br[0],P.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],P.pixelRatio,T.pixelRatio),this.zoomOutPaintVertexArray.emplace(z,P.tl[0],P.tl[1],P.br[0],P.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],P.pixelRatio,E.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Ur.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Ur.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Cd{constructor(t,n,c){this.binders={},this._buffers=[];const p=[];for(const _ in t.paint._values){if(!c(_))continue;const b=t.paint.get(_);if(!(b instanceof Yn&&Va(b.property.specification)))continue;const w=Pd(_,t.type),T=b.value,P=b.property.specification.type,E=b.property.useIntegerZoom,z=b.property.specification["property-type"],F=z==="cross-faded"||z==="cross-faded-data-driven";if(T.kind==="constant")this.binders[_]=F?new _s(T.value,w):new ll(T.value,w,P),p.push(`/u_${_}`);else if(T.kind==="source"||F){const $=Sh(_,P,"source");this.binders[_]=F?new Xa(T,P,E,n,$,t.id):new da(T,w,P,$),p.push(`/a_${_}`)}else{const $=Sh(_,P,"composite");this.binders[_]=new An(T,w,P,E,n,$),p.push(`/z_${_}`)}}this.cacheKey=p.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof da||n instanceof An?n.maxValue:0}populatePaintArrays(t,n,c,p,_){for(const b in this.binders){const w=this.binders[b];(w instanceof da||w instanceof An||w instanceof Xa)&&w.populatePaintArray(t,n,c,p,_)}}setConstantPatternPositions(t,n){for(const c in this.binders){const p=this.binders[c];p instanceof _s&&p.setConstantPatternPositions(t,n)}}updatePaintArrays(t,n,c,p,_){let b=!1;for(const w in t){const T=n.getPositions(w);for(const P of T){const E=c.feature(P.index);for(const z in this.binders){const F=this.binders[z];if((F instanceof da||F instanceof An||F instanceof Xa)&&F.expression.isStateDependent===!0){const $=p.paint.get(z);F.expression=$.value,F.updatePaintArray(P.start,P.end,E,t[w],_),b=!0}}}}return b}defines(){const t=[];for(const n in this.binders){const c=this.binders[n];(c instanceof ll||c instanceof _s)&&t.push(...c.uniformNames.map((p=>`#define HAS_UNIFORM_${p}`)))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const c=this.binders[n];if(c instanceof da||c instanceof An)for(let p=0;p<c.paintVertexAttributes.length;p++)t.push(c.paintVertexAttributes[p].name);else if(c instanceof Xa)for(let p=0;p<Ur.members.length;p++)t.push(Ur.members[p].name)}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const c=this.binders[n];if(c instanceof ll||c instanceof _s||c instanceof An)for(const p of c.uniformNames)t.push(p)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,n){const c=[];for(const p in this.binders){const _=this.binders[p];if(_ instanceof ll||_ instanceof _s||_ instanceof An){for(const b of _.uniformNames)if(n[b]){const w=_.getBinding(t,n[b],b);c.push({name:b,property:p,binding:w})}}}return c}setUniforms(t,n,c,p){for(const{name:_,property:b,binding:w}of n)this.binders[b].setUniform(w,p,c.get(b),_)}updatePaintBuffers(t){this._buffers=[];for(const n in this.binders){const c=this.binders[n];if(t&&c instanceof Xa){const p=t.fromScale===2?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(c instanceof da||c instanceof An)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}}upload(t){for(const n in this.binders){const c=this.binders[n];(c instanceof da||c instanceof An||c instanceof Xa)&&c.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof da||n instanceof An||n instanceof Xa)&&n.destroy()}}}class tn{constructor(t,n,c=()=>!0){this.programConfigurations={};for(const p of t)this.programConfigurations[p.id]=new Cd(p,n,c);this.needsUpload=!1,this._featureMap=new Mo,this._bufferOffset=0}populatePaintArrays(t,n,c,p,_,b){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(t,n,p,_,b);n.id!==void 0&&this._featureMap.add(n.id,c,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,c,p){for(const _ of c)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(t,this._featureMap,n,_,p)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Pd(a,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(`${t}-`,"").replace(/-/g,"_")]}function Sh(a,t,n){const c={color:{source:sl,composite:I},number:{source:y,composite:sl}},p=(function(_){return{"line-pattern":{source:Oe,composite:Oe},"fill-pattern":{source:Oe,composite:Oe},"fill-extrusion-pattern":{source:Oe,composite:Oe}}[_]})(a);return p&&p[n]||c[t][n]}Ye("ConstantBinder",ll),Ye("CrossFadedConstantBinder",_s),Ye("SourceExpressionBinder",da),Ye("CrossFadedCompositeBinder",Xa),Ye("CompositeExpressionBinder",An),Ye("ProgramConfiguration",Cd,{omit:["_buffers"]}),Ye("ProgramConfigurationSet",tn);const Ic=Math.pow(2,14)-1,zc=-Ic-1;function Ka(a){const t=At/a.extent,n=a.loadGeometry();for(let c=0;c<n.length;c++){const p=n[c];for(let _=0;_<p.length;_++){const b=p[_],w=Math.round(b.x*t),T=Math.round(b.y*t);b.x=Et(w,zc,Ic),b.y=Et(T,zc,Ic),(w<b.x||w>b.x+1||T<b.y||T>b.y+1)&&ar("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function fa(a,t){return{type:a.type,id:a.id,properties:a.properties,geometry:t?Ka(a):[]}}const l_=-32768;function cT(a,t,n,c,p){a.emplaceBack(l_+8*t+c,l_+8*n+p)}class Bm{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new _e,this.indexArray=new lr,this.segments=new kt,this.programConfigurations=new tn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,c){const p=this.layers[0],_=[];let b=null,w=!1,T=p.type==="heatmap";if(p.type==="circle"){const E=p;b=E.layout.get("circle-sort-key"),w=!b.isConstant(),T=T||E.paint.get("circle-pitch-alignment")==="map"}const P=T?n.subdivisionGranularity.circle:1;for(const{feature:E,id:z,index:F,sourceLayerIndex:$}of t){const N=this.layers[0]._featureFilter.needGeometry,q=fa(E,N);if(!this.layers[0]._featureFilter.filter(new vr(this.zoom,{globalState:this.globalState}),q,c))continue;const H=w?b.evaluate(q,{},c):void 0,Q={id:z,properties:E.properties,type:E.type,sourceLayerIndex:$,index:F,geometry:N?q.geometry:Ka(E),patterns:{},sortKey:H};_.push(Q)}w&&_.sort(((E,z)=>E.sortKey-z.sortKey));for(const E of _){const{geometry:z,index:F,sourceLayerIndex:$}=E,N=t[F].feature;this.addFeature(E,z,F,c,P),n.featureIndex.insert(N,z,F,$,this.index)}}update(t,n,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Cr),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,c,p,_=1){let b;switch(_){case 1:b=[0,7];break;case 3:b=[0,2,5,7];break;case 5:b=[0,1,3,4,6,7];break;case 7:b=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${_}; valid values are 1, 3, 5, 7.`)}const w=b.length;for(const T of n)for(const P of T){const E=P.x,z=P.y;if(E<0||E>=At||z<0||z>=At)continue;const F=this.segments.prepareSegment(w*w,this.layoutVertexArray,this.indexArray,t.sortKey),$=F.vertexLength;for(let N=0;N<w;N++)for(let q=0;q<w;q++)cT(this.layoutVertexArray,E,z,b[q],b[N]);for(let N=0;N<w-1;N++)for(let q=0;q<w-1;q++){const H=$+N*w+q,Q=$+(N+1)*w+q;this.indexArray.emplaceBack(H,Q+1,H+1),this.indexArray.emplaceBack(H,Q,Q+1)}F.vertexLength+=w*w,F.primitiveLength+=(w-1)*(w-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,{},p)}}function c_(a,t){for(let n=0;n<a.length;n++)if(Rc(t,a[n]))return!0;for(let n=0;n<t.length;n++)if(Rc(a,t[n]))return!0;return!!$m(a,t)}function uT(a,t,n){return!!Rc(a,t)||!!Nm(t,a,n)}function u_(a,t){if(a.length===1)return p_(t,a[0]);for(let n=0;n<t.length;n++){const c=t[n];for(let p=0;p<c.length;p++)if(Rc(a,c[p]))return!0}for(let n=0;n<a.length;n++)if(p_(t,a[n]))return!0;for(let n=0;n<t.length;n++)if($m(a,t[n]))return!0;return!1}function hT(a,t,n){if(a.length>1){if($m(a,t))return!0;for(let c=0;c<t.length;c++)if(Nm(t[c],a,n))return!0}for(let c=0;c<a.length;c++)if(Nm(a[c],t,n))return!0;return!1}function $m(a,t){if(a.length===0||t.length===0)return!1;for(let n=0;n<a.length-1;n++){const c=a[n],p=a[n+1];for(let _=0;_<t.length-1;_++)if(pT(c,p,t[_],t[_+1]))return!0}return!1}function pT(a,t,n,c){return Hr(a,n,c)!==Hr(t,n,c)&&Hr(a,t,n)!==Hr(a,t,c)}function Nm(a,t,n){const c=n*n;if(t.length===1)return a.distSqr(t[0])<c;for(let p=1;p<t.length;p++)if(h_(a,t[p-1],t[p])<c)return!0;return!1}function h_(a,t,n){const c=t.distSqr(n);if(c===0)return a.distSqr(t);const p=((a.x-t.x)*(n.x-t.x)+(a.y-t.y)*(n.y-t.y))/c;return a.distSqr(p<0?t:p>1?n:n.sub(t)._mult(p)._add(t))}function p_(a,t){let n,c,p,_=!1;for(let b=0;b<a.length;b++){n=a[b];for(let w=0,T=n.length-1;w<n.length;T=w++)c=n[w],p=n[T],c.y>t.y!=p.y>t.y&&t.x<(p.x-c.x)*(t.y-c.y)/(p.y-c.y)+c.x&&(_=!_)}return _}function Rc(a,t){let n=!1;for(let c=0,p=a.length-1;c<a.length;p=c++){const _=a[c],b=a[p];_.y>t.y!=b.y>t.y&&t.x<(b.x-_.x)*(t.y-_.y)/(b.y-_.y)+_.x&&(n=!n)}return n}function dT(a,t,n){const c=n[0],p=n[2];if(a.x<c.x&&t.x<c.x||a.x>p.x&&t.x>p.x||a.y<c.y&&t.y<c.y||a.y>p.y&&t.y>p.y)return!1;const _=Hr(a,t,n[0]);return _!==Hr(a,t,n[1])||_!==Hr(a,t,n[2])||_!==Hr(a,t,n[3])}function kh(a,t,n){const c=t.paint.get(a).value;return c.kind==="constant"?c.value:n.programConfigurations.get(t.id).getMaxValue(a)}function Md(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Ad(a,t,n,c,p){if(!t[0]&&!t[1])return a;const _=C.convert(t)._mult(p);n==="viewport"&&_._rotate(-c);const b=[];for(let w=0;w<a.length;w++)b.push(a[w].sub(_));return b}let d_,f_;Ye("CircleBucket",Bm,{omit:["layers"]});var fT={get paint(){return f_=f_||new Ri({"circle-radius":new dt(be.paint_circle["circle-radius"]),"circle-color":new dt(be.paint_circle["circle-color"]),"circle-blur":new dt(be.paint_circle["circle-blur"]),"circle-opacity":new dt(be.paint_circle["circle-opacity"]),"circle-translate":new ot(be.paint_circle["circle-translate"]),"circle-translate-anchor":new ot(be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ot(be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ot(be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new dt(be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new dt(be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new dt(be.paint_circle["circle-stroke-opacity"])})},get layout(){return d_=d_||new Ri({"circle-sort-key":new dt(be.layout_circle["circle-sort-key"])})}};class mT extends pn{constructor(t){super(t,fT)}createBucket(t){return new Bm(t)}queryRadius(t){const n=t;return kh("circle-radius",this,n)+kh("circle-stroke-width",this,n)+Md(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:c,geometry:p,transform:_,pixelsToTileUnits:b,unwrappedTileID:w,getElevation:T}){const P=Ad(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-_.bearingInRadians,b),E=this.paint.get("circle-radius").evaluate(n,c)+this.paint.get("circle-stroke-width").evaluate(n,c),z=this.paint.get("circle-pitch-alignment")==="map",F=z?P:(function(N,q,H,Q){return N.map((me=>m_(me,q,H,Q)))})(P,_,w,T),$=z?E*b:E;for(const N of p)for(const q of N){const H=z?q:m_(q,_,w,T);let Q=$;const me=_.projectTileCoordinates(q.x,q.y,w,T).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Q*=me/_.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Q*=_.cameraToCenterDistance/me),uT(F,H,Q))return!0}return!1}}function m_(a,t,n,c){const p=t.projectTileCoordinates(a.x,a.y,n,c).point;return new C((.5*p.x+.5)*t.width,(.5*-p.y+.5)*t.height)}class g_ extends Bm{}let y_;Ye("HeatmapBucket",g_,{omit:["layers"]});var gT={get paint(){return y_=y_||new Ri({"heatmap-radius":new dt(be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new dt(be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ot(be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Pc(be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ot(be.paint_heatmap["heatmap-opacity"])})}};function Um(a,{width:t,height:n},c,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==t*n*c)throw new RangeError(`mismatched image size. expected: ${p.length} but got: ${t*n*c}`)}else p=new Uint8Array(t*n*c);return a.width=t,a.height=n,a.data=p,a}function __(a,{width:t,height:n},c){if(t===a.width&&n===a.height)return;const p=Um({},{width:t,height:n},c);Vm(a,p,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,t),height:Math.min(a.height,n)},c),a.width=t,a.height=n,a.data=p.data}function Vm(a,t,n,c,p,_){if(p.width===0||p.height===0)return t;if(p.width>a.width||p.height>a.height||n.x>a.width-p.width||n.y>a.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>t.width||p.height>t.height||c.x>t.width-p.width||c.y>t.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const b=a.data,w=t.data;if(b===w)throw new Error("srcData equals dstData, so image is already copied");for(let T=0;T<p.height;T++){const P=((n.y+T)*a.width+n.x)*_,E=((c.y+T)*t.width+c.x)*_;for(let z=0;z<p.width*_;z++)w[E+z]=b[P+z]}return t}class Ch{constructor(t,n){Um(this,t,1,n)}resize(t){__(this,t,1)}clone(){return new Ch({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,c,p,_){Vm(t,n,c,p,_,1)}}class rn{constructor(t,n){Um(this,t,4,n)}resize(t){__(this,t,4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new rn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,c,p,_){Vm(t,n,c,p,_,4)}setPixel(t,n,c){const p=4*(t*this.width+n);this.data[p+0]=Math.round(255*c.r/c.a),this.data[p+1]=Math.round(255*c.g/c.a),this.data[p+2]=Math.round(255*c.b/c.a),this.data[p+3]=Math.round(255*c.a)}}function v_(a){const t={},n=a.resolution||256,c=a.clips?a.clips.length:1,p=a.image||new rn({width:n,height:c});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const _=(b,w,T)=>{t[a.evaluationKey]=T;const P=a.expression.evaluate(t);p.setPixel(b/4/n,w/4,P)};if(a.clips)for(let b=0,w=0;b<c;++b,w+=4*n)for(let T=0,P=0;T<n;T++,P+=4){const E=T/(n-1),{start:z,end:F}=a.clips[b];_(w,P,z*(1-E)+F*E)}else for(let b=0,w=0;b<n;b++,w+=4)_(0,w,b/(n-1));return p}Ye("AlphaImage",Ch),Ye("RGBAImage",rn);const qm="big-fb";class yT extends pn{createBucket(t){return new g_(t)}constructor(t){super(t,gT),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=v_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(qm)&&this.heatmapFbos.delete(qm)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let b_;var _T={get paint(){return b_=b_||new Ri({"hillshade-illumination-direction":new ot(be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new ot(be.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new ot(be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ot(be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ot(be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ot(be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ot(be.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new ot(be.paint_hillshade["hillshade-method"])})}};class vT extends pn{constructor(t){super(t,_T),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,n=this.paint.get("hillshade-illumination-altitude").values,c=this.paint.get("hillshade-highlight-color").values,p=this.paint.get("hillshade-shadow-color").values;const _=Math.max(t.length,n.length,c.length,p.length);t=t.concat(Array(_-t.length).fill(t.at(-1))),n=n.concat(Array(_-n.length).fill(n.at(-1))),c=c.concat(Array(_-c.length).fill(c.at(-1))),p=p.concat(Array(_-p.length).fill(p.at(-1)));const b=n.map(lo);return{directionRadians:t.map(lo),altitudeRadians:b,shadowColor:p,highlightColor:c}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let x_;var bT={get paint(){return x_=x_||new Ri({"color-relief-opacity":new ot(be["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Pc(be["paint_color-relief"]["color-relief-color"])})}};class Gm{constructor(t,n,c,p){this.context=t,this.format=c,this.texture=t.gl.createTexture(),this.update(n,p)}update(t,n,c){const{width:p,height:_}=t,b=!(this.size&&this.size[0]===p&&this.size[1]===_||c),{context:w}=this,{gl:T}=w;if(this.useMipmap=!!(n&&n.useMipmap),T.bindTexture(T.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!n||n.premultiply!==!1)),b)this.size=[p,_],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||qn(t)?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,t):T.texImage2D(T.TEXTURE_2D,0,this.format,p,_,0,this.format,T.UNSIGNED_BYTE,t.data);else{const{x:P,y:E}=c||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||qn(t)?T.texSubImage2D(T.TEXTURE_2D,0,P,E,T.RGBA,T.UNSIGNED_BYTE,t):T.texSubImage2D(T.TEXTURE_2D,0,P,E,p,_,T.RGBA,T.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&T.generateMipmap(T.TEXTURE_2D),w.pixelStoreUnpackFlipY.setDefault(),w.pixelStoreUnpack.setDefault(),w.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,n,c){const{context:p}=this,{gl:_}=p;_.bindTexture(_.TEXTURE_2D,this.texture),c!==_.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(c=_.LINEAR),t!==this.filter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,t),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,c||t),this.filter=t),n!==this.wrap&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,n),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class w_{constructor(t,n,c,p=1,_=1,b=1,w=0){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(c&&!["mapbox","terrarium","custom"].includes(c))return void ar(`"${c}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const T=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),c){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=p,this.greenFactor=_,this.blueFactor=b,this.baseShift=w;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let P=0;P<T;P++)this.data[this._idx(-1,P)]=this.data[this._idx(0,P)],this.data[this._idx(T,P)]=this.data[this._idx(T-1,P)],this.data[this._idx(P,-1)]=this.data[this._idx(P,0)],this.data[this._idx(P,T)]=this.data[this._idx(P,T-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(T,-1)]=this.data[this._idx(T-1,0)],this.data[this._idx(-1,T)]=this.data[this._idx(0,T-1)],this.data[this._idx(T,T)]=this.data[this._idx(T-1,T-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let P=0;P<T;P++)for(let E=0;E<T;E++){const z=this.get(P,E);z>this.max&&(this.max=z),z<this.min&&(this.min=z)}}get(t,n){const c=new Uint8Array(this.data.buffer),p=4*this._idx(t,n);return this.unpack(c[p],c[p+1],c[p+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}unpack(t,n,c){return t*this.redFactor+n*this.greenFactor+c*this.blueFactor-this.baseShift}pack(t){return T_(t,this.getUnpackVector())}getPixels(){return new rn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,n,c){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let p=n*this.dim,_=n*this.dim+this.dim,b=c*this.dim,w=c*this.dim+this.dim;switch(n){case-1:p=_-1;break;case 1:_=p+1}switch(c){case-1:b=w-1;break;case 1:w=b+1}const T=-n*this.dim,P=-c*this.dim;for(let E=b;E<w;E++)for(let z=p;z<_;z++)this.data[this._idx(z,E)]=t.data[this._idx(z+T,E+P)]}}function T_(a,t){const n=t[0],c=t[1],p=t[2],_=t[3],b=Math.min(n,c,p),w=Math.round((a+_)/b);return{r:Math.floor(w*b/n)%256,g:Math.floor(w*b/c)%256,b:Math.floor(w*b/p)%256}}Ye("DEMData",w_);class xT extends pn{constructor(t){super(t,bT)}_createColorRamp(t){const n={elevationStops:[],colorStops:[]},c=this._transitionablePaint._values["color-relief-color"].value.expression;if(c instanceof Js&&c._styleExpression.expression instanceof di){this.colorRampExpression=c;const b=c._styleExpression.expression;n.elevationStops=b.labels,n.colorStops=[];for(const w of n.elevationStops)n.colorStops.push(b.evaluate({globals:{elevation:w}}))}if(n.elevationStops.length<1&&(n.elevationStops=[0],n.colorStops=[Dt.transparent]),n.elevationStops.length<2&&(n.elevationStops.push(n.elevationStops[0]+1),n.colorStops.push(n.colorStops[0])),n.elevationStops.length<=t)return n;const p={elevationStops:[],colorStops:[]},_=(n.elevationStops.length-1)/(t-1);for(let b=0;b<n.elevationStops.length-.5;b+=_)p.elevationStops.push(n.elevationStops[Math.round(b)]),p.colorStops.push(n.colorStops[Math.round(b)]);return ar(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),p}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(t,n,c){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const p=this._createColorRamp(n),_=new rn({width:p.colorStops.length,height:1}),b=new rn({width:p.colorStops.length,height:1});for(let w=0;w<p.elevationStops.length;w++){const T=T_(p.elevationStops[w],c);b.setPixel(0,w,new Dt(T.r/255,T.g/255,T.b/255,1)),_.setPixel(0,w,p.colorStops[w])}return this.colorRampTextures={elevationTexture:new Gm(t,b,t.gl.RGBA),colorTexture:new Gm(t,_,t.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const wT=Ir([{name:"a_pos",components:2,type:"Int16"}],4),{members:TT}=wT;function Zm(a,t,n){const c=n.patternDependencies;let p=!1;for(const _ of t){const b=_.paint.get(`${a}-pattern`);b.isConstant()||(p=!0);const w=b.constantOr(null);w&&(p=!0,c[w.to]=!0,c[w.from]=!0)}return p}function Wm(a,t,n,c,p){const _=p.patternDependencies;for(const b of t){const w=b.paint.get(`${a}-pattern`).value;if(w.kind!=="constant"){let T=w.evaluate({zoom:c-1},n,{},p.availableImages),P=w.evaluate({zoom:c},n,{},p.availableImages),E=w.evaluate({zoom:c+1},n,{},p.availableImages);T=T&&T.name?T.name:T,P=P&&P.name?P.name:P,E=E&&E.name?E.name:E,_[T]=!0,_[P]=!0,_[E]=!0,n.patterns[b.id]={min:T,mid:P,max:E}}}return n}function S_(a,t,n,c,p){let _;if(p===(function(b,w,T,P){let E=0;for(let z=w,F=T-P;z<T;z+=P)E+=(b[F]-b[z])*(b[z+1]+b[F+1]),F=z;return E})(a,t,n,c)>0)for(let b=t;b<n;b+=c)_=M_(b/c|0,a[b],a[b+1],_);else for(let b=n-c;b>=t;b-=c)_=M_(b/c|0,a[b],a[b+1],_);return _&&Lc(_,_.next)&&(Eh(_),_=_.next),_}function cl(a,t){if(!a)return a;t||(t=a);let n,c=a;do if(n=!1,c.steiner||!Lc(c,c.next)&&Fr(c.prev,c,c.next)!==0)c=c.next;else{if(Eh(c),c=t=c.prev,c===c.next)break;n=!0}while(n||c!==t);return t}function Ph(a,t,n,c,p,_,b){if(!a)return;!b&&_&&(function(T,P,E,z){let F=T;do F.z===0&&(F.z=Hm(F.x,F.y,P,E,z)),F.prevZ=F.prev,F.nextZ=F.next,F=F.next;while(F!==T);F.prevZ.nextZ=null,F.prevZ=null,(function($){let N,q=1;do{let H,Q=$;$=null;let me=null;for(N=0;Q;){N++;let ae=Q,se=0;for(let Ee=0;Ee<q&&(se++,ae=ae.nextZ,ae);Ee++);let ke=q;for(;se>0||ke>0&&ae;)se!==0&&(ke===0||!ae||Q.z<=ae.z)?(H=Q,Q=Q.nextZ,se--):(H=ae,ae=ae.nextZ,ke--),me?me.nextZ=H:$=H,H.prevZ=me,me=H;Q=ae}me.nextZ=null,q*=2}while(N>1)})(F)})(a,c,p,_);let w=a;for(;a.prev!==a.next;){const T=a.prev,P=a.next;if(_?kT(a,c,p,_):ST(a))t.push(T.i,a.i,P.i),Eh(a),a=P.next,w=P.next;else if((a=P)===w){b?b===1?Ph(a=CT(cl(a),t),t,n,c,p,_,2):b===2&&PT(a,t,n,c,p,_):Ph(cl(a),t,n,c,p,_,1);break}}}function ST(a){const t=a.prev,n=a,c=a.next;if(Fr(t,n,c)>=0)return!1;const p=t.x,_=n.x,b=c.x,w=t.y,T=n.y,P=c.y,E=Math.min(p,_,b),z=Math.min(w,T,P),F=Math.max(p,_,b),$=Math.max(w,T,P);let N=c.next;for(;N!==t;){if(N.x>=E&&N.x<=F&&N.y>=z&&N.y<=$&&Mh(p,w,_,T,b,P,N.x,N.y)&&Fr(N.prev,N,N.next)>=0)return!1;N=N.next}return!0}function kT(a,t,n,c){const p=a.prev,_=a,b=a.next;if(Fr(p,_,b)>=0)return!1;const w=p.x,T=_.x,P=b.x,E=p.y,z=_.y,F=b.y,$=Math.min(w,T,P),N=Math.min(E,z,F),q=Math.max(w,T,P),H=Math.max(E,z,F),Q=Hm($,N,t,n,c),me=Hm(q,H,t,n,c);let ae=a.prevZ,se=a.nextZ;for(;ae&&ae.z>=Q&&se&&se.z<=me;){if(ae.x>=$&&ae.x<=q&&ae.y>=N&&ae.y<=H&&ae!==p&&ae!==b&&Mh(w,E,T,z,P,F,ae.x,ae.y)&&Fr(ae.prev,ae,ae.next)>=0||(ae=ae.prevZ,se.x>=$&&se.x<=q&&se.y>=N&&se.y<=H&&se!==p&&se!==b&&Mh(w,E,T,z,P,F,se.x,se.y)&&Fr(se.prev,se,se.next)>=0))return!1;se=se.nextZ}for(;ae&&ae.z>=Q;){if(ae.x>=$&&ae.x<=q&&ae.y>=N&&ae.y<=H&&ae!==p&&ae!==b&&Mh(w,E,T,z,P,F,ae.x,ae.y)&&Fr(ae.prev,ae,ae.next)>=0)return!1;ae=ae.prevZ}for(;se&&se.z<=me;){if(se.x>=$&&se.x<=q&&se.y>=N&&se.y<=H&&se!==p&&se!==b&&Mh(w,E,T,z,P,F,se.x,se.y)&&Fr(se.prev,se,se.next)>=0)return!1;se=se.nextZ}return!0}function CT(a,t){let n=a;do{const c=n.prev,p=n.next.next;!Lc(c,p)&&C_(c,n,n.next,p)&&Ah(c,p)&&Ah(p,c)&&(t.push(c.i,n.i,p.i),Eh(n),Eh(n.next),n=a=p),n=n.next}while(n!==a);return cl(n)}function PT(a,t,n,c,p,_){let b=a;do{let w=b.next.next;for(;w!==b.prev;){if(b.i!==w.i&&zT(b,w)){let T=P_(b,w);return b=cl(b,b.next),T=cl(T,T.next),Ph(b,t,n,c,p,_,0),void Ph(T,t,n,c,p,_,0)}w=w.next}b=b.next}while(b!==a)}function MT(a,t){let n=a.x-t.x;return n===0&&(n=a.y-t.y,n===0)&&(n=(a.next.y-a.y)/(a.next.x-a.x)-(t.next.y-t.y)/(t.next.x-t.x)),n}function AT(a,t){const n=(function(p,_){let b=_;const w=p.x,T=p.y;let P,E=-1/0;if(Lc(p,b))return b;do{if(Lc(p,b.next))return b.next;if(T<=b.y&&T>=b.next.y&&b.next.y!==b.y){const q=b.x+(T-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(q<=w&&q>E&&(E=q,P=b.x<b.next.x?b:b.next,q===w))return P}b=b.next}while(b!==_);if(!P)return null;const z=P,F=P.x,$=P.y;let N=1/0;b=P;do{if(w>=b.x&&b.x>=F&&w!==b.x&&k_(T<$?w:E,T,F,$,T<$?E:w,T,b.x,b.y)){const q=Math.abs(T-b.y)/(w-b.x);Ah(b,p)&&(q<N||q===N&&(b.x>P.x||b.x===P.x&&ET(P,b)))&&(P=b,N=q)}b=b.next}while(b!==z);return P})(a,t);if(!n)return t;const c=P_(n,a);return cl(c,c.next),cl(n,n.next)}function ET(a,t){return Fr(a.prev,a,t.prev)<0&&Fr(t.next,a,a.next)<0}function Hm(a,t,n,c,p){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-n)*p|0)|a<<8))|a<<4))|a<<2))|a<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-c)*p|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function IT(a){let t=a,n=a;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==a);return n}function k_(a,t,n,c,p,_,b,w){return(p-b)*(t-w)>=(a-b)*(_-w)&&(a-b)*(c-w)>=(n-b)*(t-w)&&(n-b)*(_-w)>=(p-b)*(c-w)}function Mh(a,t,n,c,p,_,b,w){return!(a===b&&t===w)&&k_(a,t,n,c,p,_,b,w)}function zT(a,t){return a.next.i!==t.i&&a.prev.i!==t.i&&!(function(n,c){let p=n;do{if(p.i!==n.i&&p.next.i!==n.i&&p.i!==c.i&&p.next.i!==c.i&&C_(p,p.next,n,c))return!0;p=p.next}while(p!==n);return!1})(a,t)&&(Ah(a,t)&&Ah(t,a)&&(function(n,c){let p=n,_=!1;const b=(n.x+c.x)/2,w=(n.y+c.y)/2;do p.y>w!=p.next.y>w&&p.next.y!==p.y&&b<(p.next.x-p.x)*(w-p.y)/(p.next.y-p.y)+p.x&&(_=!_),p=p.next;while(p!==n);return _})(a,t)&&(Fr(a.prev,a,t.prev)||Fr(a,t.prev,t))||Lc(a,t)&&Fr(a.prev,a,a.next)>0&&Fr(t.prev,t,t.next)>0)}function Fr(a,t,n){return(t.y-a.y)*(n.x-t.x)-(t.x-a.x)*(n.y-t.y)}function Lc(a,t){return a.x===t.x&&a.y===t.y}function C_(a,t,n,c){const p=Id(Fr(a,t,n)),_=Id(Fr(a,t,c)),b=Id(Fr(n,c,a)),w=Id(Fr(n,c,t));return p!==_&&b!==w||!(p!==0||!Ed(a,n,t))||!(_!==0||!Ed(a,c,t))||!(b!==0||!Ed(n,a,c))||!(w!==0||!Ed(n,t,c))}function Ed(a,t,n){return t.x<=Math.max(a.x,n.x)&&t.x>=Math.min(a.x,n.x)&&t.y<=Math.max(a.y,n.y)&&t.y>=Math.min(a.y,n.y)}function Id(a){return a>0?1:a<0?-1:0}function Ah(a,t){return Fr(a.prev,a,a.next)<0?Fr(a,t,a.next)>=0&&Fr(a,a.prev,t)>=0:Fr(a,t,a.prev)<0||Fr(a,a.next,t)<0}function P_(a,t){const n=Xm(a.i,a.x,a.y),c=Xm(t.i,t.x,t.y),p=a.next,_=t.prev;return a.next=t,t.prev=a,n.next=p,p.prev=n,c.next=n,n.prev=c,_.next=c,c.prev=_,c}function M_(a,t,n,c){const p=Xm(a,t,n);return c?(p.next=c.next,p.prev=c,c.next.prev=p,c.next=p):(p.prev=p,p.next=p),p}function Eh(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Xm(a,t,n){return{i:a,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Dc{constructor(t,n){if(n>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=n}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class zd{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}zd.noSubdivision=new zd({fill:new Dc(0,0),line:new Dc(0,0),tile:new Dc(0,0),stencil:new Dc(0,0),circle:1}),Ye("SubdivisionGranularityExpression",Dc),Ye("SubdivisionGranularitySetting",zd);const Fc=-32768,Ih=32767;class RT{constructor(t,n){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=At/t,this._canonical=n}_getKey(t,n){return(t+=32768)<<16|n+32768}_vertexToIndex(t,n){if(t<-32768||n<-32768||t>32767||n>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const c=0|Math.round(t),p=0|Math.round(n),_=this._getKey(c,p);if(this._vertexDictionary.has(_))return this._vertexDictionary.get(_);const b=this._vertexBuffer.length/2;return this._vertexDictionary.set(_,b),this._vertexBuffer.push(c,p),b}_subdivideTrianglesScanline(t){if(this._granularity<2)return(function(p,_){const b=[];for(let w=0;w<_.length;w+=3){const T=_[w],P=_[w+1],E=_[w+2],z=p[2*T],F=p[2*T+1];(p[2*P]-z)*(p[2*E+1]-F)-(p[2*P+1]-F)*(p[2*E]-z)>0?(b.push(T),b.push(E),b.push(P)):(b.push(T),b.push(P),b.push(E))}return b})(this._vertexBuffer,t);const n=[],c=t.length;for(let p=0;p<c;p+=3){const _=[t[p+0],t[p+1],t[p+2]],b=[this._vertexBuffer[2*t[p+0]+0],this._vertexBuffer[2*t[p+0]+1],this._vertexBuffer[2*t[p+1]+0],this._vertexBuffer[2*t[p+1]+1],this._vertexBuffer[2*t[p+2]+0],this._vertexBuffer[2*t[p+2]+1]];let w=1/0,T=1/0,P=-1/0,E=-1/0;for(let q=0;q<3;q++){const H=b[2*q],Q=b[2*q+1];w=Math.min(w,H),P=Math.max(P,H),T=Math.min(T,Q),E=Math.max(E,Q)}if(w===P||T===E)continue;const z=Math.floor(w/this._granularityCellSize),F=Math.ceil(P/this._granularityCellSize),$=Math.floor(T/this._granularityCellSize),N=Math.ceil(E/this._granularityCellSize);if(z!==F||$!==N)for(let q=$;q<N;q++){const H=this._scanlineGenerateVertexRingForCellRow(q,b,_);LT(this._vertexBuffer,H,n)}else n.push(..._)}return n}_scanlineGenerateVertexRingForCellRow(t,n,c){const p=t*this._granularityCellSize,_=p+this._granularityCellSize,b=[];for(let w=0;w<3;w++){const T=n[2*w],P=n[2*w+1],E=n[2*(w+1)%6],z=n[(2*(w+1)+1)%6],F=n[2*(w+2)%6],$=n[(2*(w+2)+1)%6],N=E-T,q=z-P,H=N===0,Q=q===0,me=(p-P)/q,ae=(_-P)/q,se=Math.min(me,ae),ke=Math.max(me,ae);if(!Q&&(se>=1||ke<=0)||Q&&(P<p||P>_)){z>=p&&z<=_&&b.push(c[(w+1)%3]);continue}!Q&&se>0&&b.push(this._vertexToIndex(T+N*se,P+q*se));const Ee=T+N*Math.max(se,0),De=T+N*Math.min(ke,1);H||this._generateIntraEdgeVertices(b,T,P,E,z,Ee,De),!Q&&ke<1&&b.push(this._vertexToIndex(T+N*ke,P+q*ke)),(Q||z>=p&&z<=_)&&b.push(c[(w+1)%3]),!Q&&(z<=p||z>=_)&&this._generateInterEdgeVertices(b,T,P,E,z,F,$,De,p,_)}return b}_generateIntraEdgeVertices(t,n,c,p,_,b,w){const T=p-n,P=_-c,E=P===0,z=E?Math.min(n,p):Math.min(b,w),F=E?Math.max(n,p):Math.max(b,w),$=Math.floor(z/this._granularityCellSize)+1,N=Math.ceil(F/this._granularityCellSize)-1;if(E?n<p:b<w)for(let q=$;q<=N;q++){const H=q*this._granularityCellSize;t.push(this._vertexToIndex(H,c+P*(H-n)/T))}else for(let q=N;q>=$;q--){const H=q*this._granularityCellSize;t.push(this._vertexToIndex(H,c+P*(H-n)/T))}}_generateInterEdgeVertices(t,n,c,p,_,b,w,T,P,E){const z=_-c,F=b-p,$=w-_,N=(P-_)/$,q=(E-_)/$,H=Math.min(N,q),Q=Math.max(N,q),me=p+F*H;let ae=Math.floor(Math.min(me,T)/this._granularityCellSize)+1,se=Math.ceil(Math.max(me,T)/this._granularityCellSize)-1,ke=T<me;const Ee=$===0;if(Ee&&(w===P||w===E))return;if(Ee||H>=1||Q<=0){const Ze=c-w,$e=b+(n-b)*Math.min((P-w)/Ze,(E-w)/Ze);ae=Math.floor(Math.min($e,T)/this._granularityCellSize)+1,se=Math.ceil(Math.max($e,T)/this._granularityCellSize)-1,ke=T<$e}const De=z>0?E:P;if(ke)for(let Ze=ae;Ze<=se;Ze++)t.push(this._vertexToIndex(Ze*this._granularityCellSize,De));else for(let Ze=se;Ze>=ae;Ze--)t.push(this._vertexToIndex(Ze*this._granularityCellSize,De))}_generateOutline(t){const n=[];for(const c of t){const p=ul(c,this._granularity,!0),_=this._pointArrayToIndices(p),b=[];for(let w=1;w<_.length;w++)b.push(_[w-1]),b.push(_[w]);n.push(b)}return n}_handlePoles(t){let n=!1,c=!1;this._canonical&&(this._canonical.y===0&&(n=!0),this._canonical.y===(1<<this._canonical.z)-1&&(c=!0)),(n||c)&&this._fillPoles(t,n,c)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let n=0;n<t.length;n+=2){const c=t[n+1];c===Fc&&(t[n+1]=-32767),c===Ih&&(t[n+1]=32766)}}_generatePoleQuad(t,n,c,p,_,b){p>_!=(b===Fc)?(t.push(n),t.push(c),t.push(this._vertexToIndex(p,b)),t.push(c),t.push(this._vertexToIndex(_,b)),t.push(this._vertexToIndex(p,b))):(t.push(c),t.push(n),t.push(this._vertexToIndex(p,b)),t.push(this._vertexToIndex(_,b)),t.push(c),t.push(this._vertexToIndex(p,b)))}_fillPoles(t,n,c){const p=this._vertexBuffer,_=At,b=t.length;for(let w=2;w<b;w+=3){const T=t[w-2],P=t[w-1],E=t[w],z=p[2*T],F=p[2*T+1],$=p[2*P],N=p[2*P+1],q=p[2*E],H=p[2*E+1];n&&(F===0&&N===0&&this._generatePoleQuad(t,T,P,z,$,Fc),N===0&&H===0&&this._generatePoleQuad(t,P,E,$,q,Fc),H===0&&F===0&&this._generatePoleQuad(t,E,T,q,z,Fc)),c&&(F===_&&N===_&&this._generatePoleQuad(t,T,P,z,$,Ih),N===_&&H===_&&this._generatePoleQuad(t,P,E,$,q,Ih),H===_&&F===_&&this._generatePoleQuad(t,E,T,q,z,Ih))}}_initializeVertices(t){for(let n=0;n<t.length;n+=2)this._vertexToIndex(t[n],t[n+1])}subdividePolygonInternal(t,n){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:c,holeIndices:p}=(function(w){const T=[],P=[];for(const E of w)if(E.length!==0){E!==w[0]&&T.push(P.length/2);for(let z=0;z<E.length;z++)P.push(E[z].x),P.push(E[z].y)}return{flattened:P,holeIndices:T}})(t);let _;this._initializeVertices(c);try{const w=(function(P,E,z=2){const F=E&&E.length,$=F?E[0]*z:P.length;let N=S_(P,0,$,z,!0);const q=[];if(!N||N.next===N.prev)return q;let H,Q,me;if(F&&(N=(function(ae,se,ke,Ee){const De=[];for(let Ze=0,$e=se.length;Ze<$e;Ze++){const qe=S_(ae,se[Ze]*Ee,Ze<$e-1?se[Ze+1]*Ee:ae.length,Ee,!1);qe===qe.next&&(qe.steiner=!0),De.push(IT(qe))}De.sort(MT);for(let Ze=0;Ze<De.length;Ze++)ke=AT(De[Ze],ke);return ke})(P,E,N,z)),P.length>80*z){H=P[0],Q=P[1];let ae=H,se=Q;for(let ke=z;ke<$;ke+=z){const Ee=P[ke],De=P[ke+1];Ee<H&&(H=Ee),De<Q&&(Q=De),Ee>ae&&(ae=Ee),De>se&&(se=De)}me=Math.max(ae-H,se-Q),me=me!==0?32767/me:0}return Ph(N,q,z,H,Q,me,0),q})(c,p),T=this._convertIndices(c,w);_=this._subdivideTrianglesScanline(T)}catch(w){console.error(w)}let b=[];return n&&(b=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(_),{verticesFlattened:this._vertexBuffer,indicesTriangles:_,indicesLineList:b}}_convertIndices(t,n){const c=[];for(let p=0;p<n.length;p++)c.push(this._vertexToIndex(t[2*n[p]],t[2*n[p]+1]));return c}_pointArrayToIndices(t){const n=[];for(let c=0;c<t.length;c++){const p=t[c];n.push(this._vertexToIndex(p.x,p.y))}return n}}function A_(a,t,n,c=!0){return new RT(n,t).subdividePolygonInternal(a,c)}function ul(a,t,n=!1){if(!a||a.length<1)return[];if(a.length<2)return[];const c=a[0],p=a[a.length-1],_=n&&(c.x!==p.x||c.y!==p.y);if(t<2)return _?[...a,a[0]]:[...a];const b=Math.floor(At/t),w=[];w.push(new C(a[0].x,a[0].y));const T=a.length,P=_?T:T-1;for(let E=0;E<P;E++){const z=a[E],F=E<T-1?a[E+1]:a[0],$=z.x,N=z.y,q=F.x,H=F.y,Q=$!==q,me=N!==H;if(!Q&&!me)continue;const ae=q-$,se=H-N,ke=Math.abs(ae),Ee=Math.abs(se);let De=$,Ze=N;for(;;){const qe=ae>0?(Math.floor(De/b)+1)*b:(Math.ceil(De/b)-1)*b,st=se>0?(Math.floor(Ze/b)+1)*b:(Math.ceil(Ze/b)-1)*b,Ue=Math.abs(De-qe),Ge=Math.abs(Ze-st),ze=Math.abs(De-q),mt=Math.abs(Ze-H),_t=Q?Ue/ke:Number.POSITIVE_INFINITY,ut=me?Ge/Ee:Number.POSITIVE_INFINITY;if((ze<=Ue||!Q)&&(mt<=Ge||!me))break;if(_t<ut&&Q||!me){De=qe,Ze+=se*_t;const nt=new C(De,Math.round(Ze));w[w.length-1].x===nt.x&&w[w.length-1].y===nt.y||w.push(nt)}else{De+=ae*ut,Ze=st;const nt=new C(Math.round(De),Ze);w[w.length-1].x===nt.x&&w[w.length-1].y===nt.y||w.push(nt)}}const $e=new C(q,H);w[w.length-1].x===$e.x&&w[w.length-1].y===$e.y||w.push($e)}return w}function LT(a,t,n){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let c=0,p=a[2*t[0]];for(let T=1;T<t.length;T++){const P=a[2*t[T]];P<p&&(p=P,c=T)}const _=t.length;let b=c,w=(b+1)%_;for(;;){const T=b-1>=0?b-1:_-1,P=(w+1)%_,E=a[2*t[T]],z=a[2*t[P]],F=a[2*t[b]],$=a[2*t[b]+1],N=a[2*t[w]+1];let q=!1;if(E<z)q=!0;else if(E>z)q=!1;else{const H=N-$,Q=-(a[2*t[w]]-F),me=$<N?1:-1;((E-F)*H+(a[2*t[T]+1]-$)*Q)*me>((z-F)*H+(a[2*t[P]+1]-$)*Q)*me&&(q=!0)}if(q){const H=t[T],Q=t[b],me=t[w];H!==Q&&H!==me&&Q!==me&&n.push(me,Q,H),b--,b<0&&(b=_-1)}else{const H=t[P],Q=t[b],me=t[w];H!==Q&&H!==me&&Q!==me&&n.push(me,Q,H),w++,w>=_&&(w=0)}if(T===P)break}}function E_(a,t,n,c,p,_,b,w,T){const P=p.length/2,E=b&&w&&T;if(P<kt.MAX_VERTEX_ARRAY_LENGTH){const z=t.prepareSegment(P,n,c),F=z.vertexLength;for(let q=0;q<_.length;q+=3)c.emplaceBack(F+_[q],F+_[q+1],F+_[q+2]);let $,N;z.vertexLength+=P,z.primitiveLength+=_.length/3,E&&(N=b.prepareSegment(P,n,w),$=N.vertexLength,N.vertexLength+=P);for(let q=0;q<p.length;q+=2)a(p[q],p[q+1]);if(E)for(let q=0;q<T.length;q++){const H=T[q];for(let Q=1;Q<H.length;Q+=2)w.emplaceBack($+H[Q-1],$+H[Q]);N.primitiveLength+=H.length/2}}else(function(z,F,$,N,q,H){const Q=[];for(let Ee=0;Ee<N.length/2;Ee++)Q.push(-1);const me={count:0};let ae=0,se=z.getOrCreateLatestSegment(F,$),ke=se.vertexLength;for(let Ee=2;Ee<q.length;Ee+=3){const De=q[Ee-2],Ze=q[Ee-1],$e=q[Ee];let qe=Q[De]<ae,st=Q[Ze]<ae,Ue=Q[$e]<ae;se.vertexLength+((qe?1:0)+(st?1:0)+(Ue?1:0))>kt.MAX_VERTEX_ARRAY_LENGTH&&(se=z.createNewSegment(F,$),ae=me.count,qe=!0,st=!0,Ue=!0,ke=0);const Ge=zh(Q,N,H,me,De,qe,se),ze=zh(Q,N,H,me,Ze,st,se),mt=zh(Q,N,H,me,$e,Ue,se);$.emplaceBack(ke+Ge-ae,ke+ze-ae,ke+mt-ae),se.primitiveLength++}})(t,n,c,p,_,a),E&&(function(z,F,$,N,q,H){const Q=[];for(let Ee=0;Ee<N.length/2;Ee++)Q.push(-1);const me={count:0};let ae=0,se=z.getOrCreateLatestSegment(F,$),ke=se.vertexLength;for(let Ee=0;Ee<q.length;Ee++){const De=q[Ee];for(let Ze=1;Ze<q[Ee].length;Ze+=2){const $e=De[Ze-1],qe=De[Ze];let st=Q[$e]<ae,Ue=Q[qe]<ae;se.vertexLength+((st?1:0)+(Ue?1:0))>kt.MAX_VERTEX_ARRAY_LENGTH&&(se=z.createNewSegment(F,$),ae=me.count,st=!0,Ue=!0,ke=0);const Ge=zh(Q,N,H,me,$e,st,se),ze=zh(Q,N,H,me,qe,Ue,se);$.emplaceBack(ke+Ge-ae,ke+ze-ae),se.primitiveLength++}}})(b,n,w,p,T,a),t.forceNewSegmentOnNextPrepare(),b?.forceNewSegmentOnNextPrepare()}function zh(a,t,n,c,p,_,b){if(_){const w=c.count;return n(t[2*p],t[2*p+1]),a[p]=c.count,c.count++,b.vertexLength++,w}return a[p]}class Km{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Me,this.indexArray=new lr,this.indexArray2=new or,this.programConfigurations=new tn(t.layers,t.zoom),this.segments=new kt,this.segments2=new kt,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,c){this.hasPattern=Zm("fill",this.layers,n);const p=this.layers[0].layout.get("fill-sort-key"),_=!p.isConstant(),b=[];for(const{feature:w,id:T,index:P,sourceLayerIndex:E}of t){const z=this.layers[0]._featureFilter.needGeometry,F=fa(w,z);if(!this.layers[0]._featureFilter.filter(new vr(this.zoom,{globalState:this.globalState}),F,c))continue;const $=_?p.evaluate(F,{},c,n.availableImages):void 0,N={id:T,properties:w.properties,type:w.type,sourceLayerIndex:E,index:P,geometry:z?F.geometry:Ka(w),patterns:{},sortKey:$};b.push(N)}_&&b.sort(((w,T)=>w.sortKey-T.sortKey));for(const w of b){const{geometry:T,index:P,sourceLayerIndex:E}=w;if(this.hasPattern){const z=Wm("fill",this.layers,w,this.zoom,n);this.patternFeatures.push(z)}else this.addFeature(w,T,P,c,{},n.subdivisionGranularity);n.featureIndex.insert(t[P].feature,T,P,E,this.index)}}update(t,n,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,c)}addFeatures(t,n,c){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,n,c,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,TT),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,c,p,_,b){for(const w of Ws(n,500)){const T=A_(w,p,b.fill.getGranularityForZoomLevel(p.z)),P=this.layoutVertexArray;E_(((E,z)=>{P.emplaceBack(E,z)}),this.segments,this.layoutVertexArray,this.indexArray,T.verticesFlattened,T.indicesTriangles,this.segments2,this.indexArray2,T.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,_,p)}}let I_,z_;Ye("FillBucket",Km,{omit:["layers","patternFeatures"]});var DT={get paint(){return z_=z_||new Ri({"fill-antialias":new ot(be.paint_fill["fill-antialias"]),"fill-opacity":new dt(be.paint_fill["fill-opacity"]),"fill-color":new dt(be.paint_fill["fill-color"]),"fill-outline-color":new dt(be.paint_fill["fill-outline-color"]),"fill-translate":new ot(be.paint_fill["fill-translate"]),"fill-translate-anchor":new ot(be.paint_fill["fill-translate-anchor"]),"fill-pattern":new Cc(be.paint_fill["fill-pattern"])})},get layout(){return I_=I_||new Ri({"fill-sort-key":new dt(be.layout_fill["fill-sort-key"])})}};class FT extends pn{constructor(t){super(t,DT)}recalculate(t,n){super.recalculate(t,n);const c=this.paint._values["fill-outline-color"];c.value.kind==="constant"&&c.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Km(t)}queryRadius(){return Md(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:n,transform:c,pixelsToTileUnits:p}){return u_(Ad(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-c.bearingInRadians,p),n)}isTileClipped(){return!0}}const jT=Ir([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),OT=Ir([{name:"a_centroid",components:2,type:"Int16"}],4),{members:BT}=jT;class jc{constructor(t,n,c,p,_){this.properties={},this.extent=c,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=p,this._values=_,t.readFields($T,this,n)}loadGeometry(){const t=this._pbf;t.pos=this._geometry;const n=t.readVarint()+t.pos,c=[];let p,_=1,b=0,w=0,T=0;for(;t.pos<n;){if(b<=0){const P=t.readVarint();_=7&P,b=P>>3}if(b--,_===1||_===2)w+=t.readSVarint(),T+=t.readSVarint(),_===1&&(p&&c.push(p),p=[]),p&&p.push(new C(w,T));else{if(_!==7)throw new Error(`unknown command ${_}`);p&&p.push(p[0].clone())}}return p&&c.push(p),c}bbox(){const t=this._pbf;t.pos=this._geometry;const n=t.readVarint()+t.pos;let c=1,p=0,_=0,b=0,w=1/0,T=-1/0,P=1/0,E=-1/0;for(;t.pos<n;){if(p<=0){const z=t.readVarint();c=7&z,p=z>>3}if(p--,c===1||c===2)_+=t.readSVarint(),b+=t.readSVarint(),_<w&&(w=_),_>T&&(T=_),b<P&&(P=b),b>E&&(E=b);else if(c!==7)throw new Error(`unknown command ${c}`)}return[w,P,T,E]}toGeoJSON(t,n,c){const p=this.extent*Math.pow(2,c),_=this.extent*t,b=this.extent*n,w=this.loadGeometry();function T(F){return[360*(F.x+_)/p-180,360/Math.PI*Math.atan(Math.exp((1-2*(F.y+b)/p)*Math.PI))-90]}function P(F){return F.map(T)}let E;if(this.type===1){const F=[];for(const N of w)F.push(N[0]);const $=P(F);E=F.length===1?{type:"Point",coordinates:$[0]}:{type:"MultiPoint",coordinates:$}}else if(this.type===2){const F=w.map(P);E=F.length===1?{type:"LineString",coordinates:F[0]}:{type:"MultiLineString",coordinates:F}}else{if(this.type!==3)throw new Error("unknown feature type");{const F=(function(N){const q=N.length;if(q<=1)return[N];const H=[];let Q,me;for(let ae=0;ae<q;ae++){const se=NT(N[ae]);se!==0&&(me===void 0&&(me=se<0),me===se<0?(Q&&H.push(Q),Q=[N[ae]]):Q&&Q.push(N[ae]))}return Q&&H.push(Q),H})(w),$=[];for(const N of F)$.push(N.map(P));E=$.length===1?{type:"Polygon",coordinates:$[0]}:{type:"MultiPolygon",coordinates:$}}}const z={type:"Feature",geometry:E,properties:this.properties};return this.id!=null&&(z.id=this.id),z}}function $T(a,t,n){a===1?t.id=n.readVarint():a===2?(function(c,p){const _=c.readVarint()+c.pos;for(;c.pos<_;){const b=p._keys[c.readVarint()],w=p._values[c.readVarint()];p.properties[b]=w}})(n,t):a===3?t.type=n.readVarint():a===4&&(t._geometry=n.pos)}function NT(a){let t=0;for(let n,c,p=0,_=a.length,b=_-1;p<_;b=p++)n=a[p],c=a[b],t+=(c.x-n.x)*(n.y+c.y);return t}jc.types=["Unknown","Point","LineString","Polygon"];class R_{constructor(t,n){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(UT,this,n),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];const n=this._pbf.readVarint()+this._pbf.pos;return new jc(this._pbf,n,this.extent,this._keys,this._values)}}function UT(a,t,n){a===15?t.version=n.readVarint():a===1?t.name=n.readString():a===5?t.extent=n.readVarint():a===2?t._features.push(n.pos):a===3?t._keys.push(n.readString()):a===4&&t._values.push((function(c){let p=null;const _=c.readVarint()+c.pos;for(;c.pos<_;){const b=c.readVarint()>>3;p=b===1?c.readString():b===2?c.readFloat():b===3?c.readDouble():b===4?c.readVarint64():b===5?c.readVarint():b===6?c.readSVarint():b===7?c.readBoolean():null}if(p==null)throw new Error("unknown feature value");return p})(n))}class L_{constructor(t,n){this.layers=t.readFields(VT,{},n)}}function VT(a,t,n){if(a===3){const c=new R_(n,n.readVarint()+n.pos);c.length&&(t[c.name]=c)}}const Ym=Math.pow(2,13);function Rh(a,t,n,c,p,_,b,w){a.emplaceBack(t,n,2*Math.floor(c*Ym)+b,p*Ym*2,_*Ym*2,Math.round(w))}class Jm{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Te,this.centroidVertexArray=new re,this.indexArray=new lr,this.programConfigurations=new tn(t.layers,t.zoom),this.segments=new kt,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,c){this.features=[],this.hasPattern=Zm("fill-extrusion",this.layers,n);for(const{feature:p,id:_,index:b,sourceLayerIndex:w}of t){const T=this.layers[0]._featureFilter.needGeometry,P=fa(p,T);if(!this.layers[0]._featureFilter.filter(new vr(this.zoom,{globalState:this.globalState}),P,c))continue;const E={id:_,sourceLayerIndex:w,index:b,geometry:T?P.geometry:Ka(p),properties:p.properties,type:p.type,patterns:{}};this.hasPattern?this.features.push(Wm("fill-extrusion",this.layers,E,this.zoom,n)):this.addFeature(E,E.geometry,b,c,{},n.subdivisionGranularity),n.featureIndex.insert(p,E.geometry,b,w,this.index,!0)}}addFeatures(t,n,c){for(const p of this.features){const{geometry:_}=p;this.addFeature(p,_,p.index,n,c,t.subdivisionGranularity)}}update(t,n,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,c)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,BT),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,OT.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,n,c,p,_,b){for(const w of Ws(n,500)){const T={x:0,y:0,sampleCount:0},P=this.layoutVertexArray.length;this.processPolygon(T,p,t,w,b);const E=this.layoutVertexArray.length-P,z=Math.floor(T.x/T.sampleCount),F=Math.floor(T.y/T.sampleCount);for(let $=0;$<E;$++)this.centroidVertexArray.emplaceBack(z,F)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,_,p)}processPolygon(t,n,c,p,_){if(p.length<1||D_(p[0]))return;for(const z of p)z.length!==0&&qT(t,z);const b={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},w=_.fill.getGranularityForZoomLevel(n.z),T=jc.types[c.type]==="Polygon";for(const z of p){if(z.length===0||D_(z))continue;const F=ul(z,w,T);this._generateSideFaces(F,b)}if(!T)return;const P=A_(p,n,w,!1),E=this.layoutVertexArray;E_(((z,F)=>{Rh(E,z,F,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,P.verticesFlattened,P.indicesTriangles)}_generateSideFaces(t,n){let c=0;for(let p=1;p<t.length;p++){const _=t[p],b=t[p-1];if(GT(_,b))continue;n.segment.vertexLength+4>kt.MAX_VERTEX_ARRAY_LENGTH&&(n.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const w=_.sub(b)._perp()._unit(),T=b.dist(_);c+T>32768&&(c=0),Rh(this.layoutVertexArray,_.x,_.y,w.x,w.y,0,0,c),Rh(this.layoutVertexArray,_.x,_.y,w.x,w.y,0,1,c),c+=T,Rh(this.layoutVertexArray,b.x,b.y,w.x,w.y,0,0,c),Rh(this.layoutVertexArray,b.x,b.y,w.x,w.y,0,1,c);const P=n.segment.vertexLength;this.indexArray.emplaceBack(P,P+2,P+1),this.indexArray.emplaceBack(P+1,P+2,P+3),n.segment.vertexLength+=4,n.segment.primitiveLength+=2}}}function qT(a,t){for(let n=0;n<t.length;n++){const c=t[n];n===t.length-1&&t[0].x===c.x&&t[0].y===c.y||(a.x+=c.x,a.y+=c.y,a.sampleCount++)}}function GT(a,t){return a.x===t.x&&(a.x<0||a.x>At)||a.y===t.y&&(a.y<0||a.y>At)}function D_(a){return a.every((t=>t.x<0))||a.every((t=>t.x>At))||a.every((t=>t.y<0))||a.every((t=>t.y>At))}let F_;Ye("FillExtrusionBucket",Jm,{omit:["layers","features"]});var ZT={get paint(){return F_=F_||new Ri({"fill-extrusion-opacity":new ot(be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new dt(be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ot(be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ot(be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Cc(be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new dt(be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new dt(be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ot(be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class WT extends pn{constructor(t){super(t,ZT)}createBucket(t){return new Jm(t)}queryRadius(){return Md(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:c,geometry:p,transform:_,pixelsToTileUnits:b,pixelPosMatrix:w}){const T=Ad(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-_.bearingInRadians,b),P=this.paint.get("fill-extrusion-height").evaluate(n,c),E=this.paint.get("fill-extrusion-base").evaluate(n,c),z=(function($,N){const q=[];for(const H of $){const Q=[H.x,H.y,0,1];dr(Q,Q,N),q.push(new C(Q[0]/Q[3],Q[1]/Q[3]))}return q})(T,w),F=(function($,N,q,H){const Q=[],me=[],ae=H[8]*N,se=H[9]*N,ke=H[10]*N,Ee=H[11]*N,De=H[8]*q,Ze=H[9]*q,$e=H[10]*q,qe=H[11]*q;for(const st of $){const Ue=[],Ge=[];for(const ze of st){const mt=ze.x,_t=ze.y,ut=H[0]*mt+H[4]*_t+H[12],nt=H[1]*mt+H[5]*_t+H[13],Vt=H[2]*mt+H[6]*_t+H[14],Pr=H[3]*mt+H[7]*_t+H[15],Qr=Vt+ke,Ci=Pr+Ee,In=ut+De,nn=nt+Ze,fi=Vt+$e,wr=Pr+qe,oi=new C((ut+ae)/Ci,(nt+se)/Ci);oi.z=Qr/Ci,Ue.push(oi);const mi=new C(In/wr,nn/wr);mi.z=fi/wr,Ge.push(mi)}Q.push(Ue),me.push(Ge)}return[Q,me]})(p,E,P,w);return(function($,N,q){let H=1/0;u_(q,N)&&(H=j_(q,N[0]));for(let Q=0;Q<N.length;Q++){const me=N[Q],ae=$[Q];for(let se=0;se<me.length-1;se++){const ke=me[se],Ee=[ke,me[se+1],ae[se+1],ae[se],ke];c_(q,Ee)&&(H=Math.min(H,j_(q,Ee)))}}return H!==1/0&&H})(F[0],F[1],z)}}function Lh(a,t){return a.x*t.x+a.y*t.y}function j_(a,t){if(a.length===1){let n=0;const c=t[n++];let p;for(;!p||c.equals(p);)if(p=t[n++],!p)return 1/0;for(;n<t.length;n++){const _=t[n],b=a[0],w=p.sub(c),T=_.sub(c),P=b.sub(c),E=Lh(w,w),z=Lh(w,T),F=Lh(T,T),$=Lh(P,w),N=Lh(P,T),q=E*F-z*z,H=(F*$-z*N)/q,Q=(E*N-z*$)/q,me=c.z*(1-H-Q)+p.z*H+_.z*Q;if(isFinite(me))return me}return 1/0}{let n=1/0;for(const c of t)n=Math.min(n,c.z);return n}}const HT=Ir([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:XT}=HT,KT=Ir([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:YT}=KT,JT=Math.cos(Math.PI/180*37.5),O_=Math.pow(2,14)/.5;class Qm{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((n=>{this.gradients[n.id]={}})),this.layoutVertexArray=new Se,this.layoutVertexArray2=new Pe,this.indexArray=new lr,this.programConfigurations=new tn(t.layers,t.zoom),this.segments=new kt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,c){this.hasPattern=Zm("line",this.layers,n);const p=this.layers[0].layout.get("line-sort-key"),_=!p.isConstant(),b=[];for(const{feature:w,id:T,index:P,sourceLayerIndex:E}of t){const z=this.layers[0]._featureFilter.needGeometry,F=fa(w,z);if(!this.layers[0]._featureFilter.filter(new vr(this.zoom,{globalState:this.globalState}),F,c))continue;const $=_?p.evaluate(F,{},c):void 0,N={id:T,properties:w.properties,type:w.type,sourceLayerIndex:E,index:P,geometry:z?F.geometry:Ka(w),patterns:{},sortKey:$};b.push(N)}_&&b.sort(((w,T)=>w.sortKey-T.sortKey));for(const w of b){const{geometry:T,index:P,sourceLayerIndex:E}=w;if(this.hasPattern){const z=Wm("line",this.layers,w,this.zoom,n);this.patternFeatures.push(z)}else this.addFeature(w,T,P,c,{},n.subdivisionGranularity);n.featureIndex.insert(t[P].feature,T,P,E,this.index)}}update(t,n,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,c)}addFeatures(t,n,c){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,n,c,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,YT)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,XT),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,c,p,_,b){const w=this.layers[0].layout,T=w.get("line-join").evaluate(t,{}),P=w.get("line-cap"),E=w.get("line-miter-limit"),z=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const F of n)this.addLine(F,t,T,P,E,z,p,b);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,_,p)}addLine(t,n,c,p,_,b,w,T){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=ul(t,w?T.line.getGranularityForZoomLevel(w.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ae=0;ae<t.length-1;ae++)this.totalDistance+=t[ae].dist(t[ae+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const P=jc.types[n.type]==="Polygon";let E=t.length;for(;E>=2&&t[E-1].equals(t[E-2]);)E--;let z=0;for(;z<E-1&&t[z].equals(t[z+1]);)z++;if(E<(P?3:2))return;c==="bevel"&&(_=1.05);const F=this.overscaling<=16?122880/(512*this.overscaling):0,$=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let N,q,H,Q,me;this.e1=this.e2=-1,P&&(N=t[E-2],me=t[z].sub(N)._unit()._perp());for(let ae=z;ae<E;ae++){if(H=ae===E-1?P?t[z+1]:void 0:t[ae+1],H&&t[ae].equals(H))continue;me&&(Q=me),N&&(q=N),N=t[ae],me=H?H.sub(N)._unit()._perp():Q,Q=Q||me;let se=Q.add(me);se.x===0&&se.y===0||se._unit();const ke=Q.x*me.x+Q.y*me.y,Ee=se.x*me.x+se.y*me.y,De=Ee!==0?1/Ee:1/0,Ze=2*Math.sqrt(2-2*Ee),$e=Ee<JT&&q&&H,qe=Q.x*me.y-Q.y*me.x>0;if($e&&ae>z){const Ge=N.dist(q);if(Ge>2*F){const ze=N.sub(N.sub(q)._mult(F/Ge)._round());this.updateDistance(q,ze),this.addCurrentVertex(ze,Q,0,0,$),q=ze}}const st=q&&H;let Ue=st?c:P?"butt":p;if(st&&Ue==="round"&&(De<b?Ue="miter":De<=2&&(Ue="fakeround")),Ue==="miter"&&De>_&&(Ue="bevel"),Ue==="bevel"&&(De>2&&(Ue="flipbevel"),De<_&&(Ue="miter")),q&&this.updateDistance(q,N),Ue==="miter")se._mult(De),this.addCurrentVertex(N,se,0,0,$);else if(Ue==="flipbevel"){if(De>100)se=me.mult(-1);else{const Ge=De*Q.add(me).mag()/Q.sub(me).mag();se._perp()._mult(Ge*(qe?-1:1))}this.addCurrentVertex(N,se,0,0,$),this.addCurrentVertex(N,se.mult(-1),0,0,$)}else if(Ue==="bevel"||Ue==="fakeround"){const Ge=-Math.sqrt(De*De-1),ze=qe?Ge:0,mt=qe?0:Ge;if(q&&this.addCurrentVertex(N,Q,ze,mt,$),Ue==="fakeround"){const _t=Math.round(180*Ze/Math.PI/20);for(let ut=1;ut<_t;ut++){let nt=ut/_t;if(nt!==.5){const Pr=nt-.5;nt+=nt*Pr*(nt-1)*((1.0904+ke*(ke*(3.55645-1.43519*ke)-3.2452))*Pr*Pr+(.848013+ke*(.215638*ke-1.06021)))}const Vt=me.sub(Q)._mult(nt)._add(Q)._unit()._mult(qe?-1:1);this.addHalfVertex(N,Vt.x,Vt.y,!1,qe,0,$)}}H&&this.addCurrentVertex(N,me,-ze,-mt,$)}else if(Ue==="butt")this.addCurrentVertex(N,se,0,0,$);else if(Ue==="square"){const Ge=q?1:-1;this.addCurrentVertex(N,se,Ge,Ge,$)}else Ue==="round"&&(q&&(this.addCurrentVertex(N,Q,0,0,$),this.addCurrentVertex(N,Q,1,1,$,!0)),H&&(this.addCurrentVertex(N,me,-1,-1,$,!0),this.addCurrentVertex(N,me,0,0,$)));if($e&&ae<E-1){const Ge=N.dist(H);if(Ge>2*F){const ze=N.add(H.sub(N)._mult(F/Ge)._round());this.updateDistance(N,ze),this.addCurrentVertex(ze,me,0,0,$),N=ze}}}}addCurrentVertex(t,n,c,p,_,b=!1){const w=n.y*p-n.x,T=-n.y-n.x*p;this.addHalfVertex(t,n.x+n.y*c,n.y-n.x*c,b,!1,c,_),this.addHalfVertex(t,w,T,b,!0,-p,_),this.distance>O_/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,n,c,p,_,b))}addHalfVertex({x:t,y:n},c,p,_,b,w,T){const P=.5*(this.lineClips?this.scaledDistance*(O_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(_?1:0),(n<<1)+(b?1:0),Math.round(63*c)+128,Math.round(63*p)+128,1+(w===0?0:w<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const E=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,E,this.e2),T.primitiveLength++),b?this.e2=E:this.e1=E}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}}let B_,$_;Ye("LineBucket",Qm,{omit:["layers","patternFeatures"]});var N_={get paint(){return $_=$_||new Ri({"line-opacity":new dt(be.paint_line["line-opacity"]),"line-color":new dt(be.paint_line["line-color"]),"line-translate":new ot(be.paint_line["line-translate"]),"line-translate-anchor":new ot(be.paint_line["line-translate-anchor"]),"line-width":new dt(be.paint_line["line-width"]),"line-gap-width":new dt(be.paint_line["line-gap-width"]),"line-offset":new dt(be.paint_line["line-offset"]),"line-blur":new dt(be.paint_line["line-blur"]),"line-dasharray":new Ga(be.paint_line["line-dasharray"]),"line-pattern":new Cc(be.paint_line["line-pattern"]),"line-gradient":new Pc(be.paint_line["line-gradient"])})},get layout(){return B_=B_||new Ri({"line-cap":new ot(be.layout_line["line-cap"]),"line-join":new dt(be.layout_line["line-join"]),"line-miter-limit":new ot(be.layout_line["line-miter-limit"]),"line-round-limit":new ot(be.layout_line["line-round-limit"]),"line-sort-key":new dt(be.layout_line["line-sort-key"])})}};class QT extends dt{possiblyEvaluate(t,n){return n=new vr(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(t,n)}evaluate(t,n,c,p){return n=nr({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(t,n,c,p)}}let Rd;class eS extends pn{constructor(t){super(t,N_),this.gradientVersion=0,Rd||(Rd=new QT(N_.paint.properties["line-width"].specification),Rd.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!(function(c){return c._styleExpression!==void 0})(n)&&n._styleExpression.expression instanceof Er,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,n){super.recalculate(t,n),this.paint._values["line-floorwidth"]=Rd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Qm(t)}queryRadius(t){const n=t,c=U_(kh("line-width",this,n),kh("line-gap-width",this,n)),p=kh("line-offset",this,n);return c/2+Math.abs(p)+Md(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:c,geometry:p,transform:_,pixelsToTileUnits:b}){const w=Ad(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-_.bearingInRadians,b),T=b/2*U_(this.paint.get("line-width").evaluate(n,c),this.paint.get("line-gap-width").evaluate(n,c)),P=this.paint.get("line-offset").evaluate(n,c);return P&&(p=(function(E,z){const F=[];for(let $=0;$<E.length;$++){const N=E[$],q=[];for(let H=0;H<N.length;H++){const Q=N[H-1],me=N[H],ae=N[H+1],se=H===0?new C(0,0):me.sub(Q)._unit()._perp(),ke=H===N.length-1?new C(0,0):ae.sub(me)._unit()._perp(),Ee=se._add(ke)._unit(),De=Ee.x*ke.x+Ee.y*ke.y;De!==0&&Ee._mult(1/De),q.push(Ee._mult(z)._add(me))}F.push(q)}return F})(p,P*b)),(function(E,z,F){for(let $=0;$<z.length;$++){const N=z[$];if(E.length>=3){for(let q=0;q<N.length;q++)if(Rc(E,N[q]))return!0}if(hT(E,N,F))return!0}return!1})(w,p,T)}isTileClipped(){return!0}}function U_(a,t){return t>0?t+2*a:a}const tS=Ir([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),rS=Ir([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ir([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const iS=Ir([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Ir([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const V_=Ir([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),nS=Ir([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function aS(a,t,n){return a.sections.forEach((c=>{c.text=(function(p,_,b){const w=_.layout.get("text-transform").evaluate(b,{});return w==="uppercase"?p=p.toLocaleUpperCase():w==="lowercase"&&(p=p.toLocaleLowerCase()),Cn.applyArabicShaping&&(p=Cn.applyArabicShaping(p)),p})(c.text,t,n)})),a}Ir([{name:"triangle",components:3,type:"Uint16"}]),Ir([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ir([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Ir([{type:"Float32",name:"offsetX"}]),Ir([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Ir([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Dh={"!":"ï¸","#":"ï¼",$:"ï¼","%":"ï¼","&":"ï¼","(":"ï¸µ",")":"ï¸¶","*":"ï¼","+":"ï¼",",":"ï¸","-":"ï¸²",".":"ã»","/":"ï¼",":":"ï¸",";":"ï¸","<":"ï¸¿","=":"ï¼",">":"ï¹","?":"ï¸","@":"ï¼ ","[":"ï¹","\\":"ï¼¼","]":"ï¹","^":"ï¼¾",_:"ï¸³","`":"ï½","{":"ï¸·","|":"â","}":"ï¸¸","~":"ï½","Â¢":"ï¿ ","Â£":"ï¿¡","Â¥":"ï¿¥","Â¦":"ï¿¤","Â¬":"ï¿¢","Â¯":"ï¿£","â":"ï¸²","â":"ï¸±","â":"ï¹","â":"ï¹","â":"ï¹","â":"ï¹","â¦":"ï¸","â§":"ã»","â©":"ï¿¦","ã":"ï¸","ã":"ï¸","ã":"ï¸¿","ã":"ï¹","ã":"ï¸½","ã":"ï¸¾","ã":"ï¹","ã":"ï¹","ã":"ï¹","ã":"ï¹","ã":"ï¸»","ã":"ï¸¼","ã":"ï¸¹","ã":"ï¸º","ã":"ï¸","ã":"ï¸","ï¼":"ï¸","ï¼":"ï¸µ","ï¼":"ï¸¶","ï¼":"ï¸","ï¼":"ï¸²","ï¼":"ã»","ï¼":"ï¸","ï¼":"ï¸","ï¼":"ï¸¿","ï¼":"ï¹","ï¼":"ï¸","ï¼»":"ï¹","ï¼½":"ï¹","ï¼¿":"ï¸³","ï½":"ï¸·","ï½":"â","ï½":"ï¸¸","ï½":"ï¸µ","ï½ ":"ï¸¶","ï½¡":"ï¸","ï½¢":"ï¹","ï½£":"ï¹"};var ai=24;const eg=4294967296,q_=1/eg,G_=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class tg{constructor(t=new Uint8Array(16)){this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(t,n,c=this.length){for(;this.pos<c;){const p=this.readVarint(),_=p>>3,b=this.pos;this.type=7&p,t(_,n,this),this.pos===b&&this.skip(p)}return n}readMessage(t,n){return this.readFields(t,n,this.readVarint()+this.pos)}readFixed32(){const t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){const t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*eg;return this.pos+=8,t}readSFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*eg;return this.pos+=8,t}readFloat(){const t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){const t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){const n=this.buf;let c,p;return p=n[this.pos++],c=127&p,p<128?c:(p=n[this.pos++],c|=(127&p)<<7,p<128?c:(p=n[this.pos++],c|=(127&p)<<14,p<128?c:(p=n[this.pos++],c|=(127&p)<<21,p<128?c:(p=n[this.pos],c|=(15&p)<<28,(function(_,b,w){const T=w.buf;let P,E;if(E=T[w.pos++],P=(112&E)>>4,E<128||(E=T[w.pos++],P|=(127&E)<<3,E<128)||(E=T[w.pos++],P|=(127&E)<<10,E<128)||(E=T[w.pos++],P|=(127&E)<<17,E<128)||(E=T[w.pos++],P|=(127&E)<<24,E<128)||(E=T[w.pos++],P|=(1&E)<<31,E<128))return Oc(_,P,b);throw new Error("Expected varint not more than 10 bytes")})(c,t,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const t=this.readVarint();return t%2==1?(t+1)/-2:t/2}readBoolean(){return!!this.readVarint()}readString(){const t=this.readVarint()+this.pos,n=this.pos;return this.pos=t,t-n>=12&&G_?G_.decode(this.buf.subarray(n,t)):(function(c,p,_){let b="",w=p;for(;w<_;){const T=c[w];let P,E,z,F=null,$=T>239?4:T>223?3:T>191?2:1;if(w+$>_)break;$===1?T<128&&(F=T):$===2?(P=c[w+1],(192&P)==128&&(F=(31&T)<<6|63&P,F<=127&&(F=null))):$===3?(P=c[w+1],E=c[w+2],(192&P)==128&&(192&E)==128&&(F=(15&T)<<12|(63&P)<<6|63&E,(F<=2047||F>=55296&&F<=57343)&&(F=null))):$===4&&(P=c[w+1],E=c[w+2],z=c[w+3],(192&P)==128&&(192&E)==128&&(192&z)==128&&(F=(15&T)<<18|(63&P)<<12|(63&E)<<6|63&z,(F<=65535||F>=1114112)&&(F=null))),F===null?(F=65533,$=1):F>65535&&(F-=65536,b+=String.fromCharCode(F>>>10&1023|55296),F=56320|1023&F),b+=String.fromCharCode(F),w+=$}return b})(this.buf,n,t)}readBytes(){const t=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,t);return this.pos=t,n}readPackedVarint(t=[],n){const c=this.readPackedEnd();for(;this.pos<c;)t.push(this.readVarint(n));return t}readPackedSVarint(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readSVarint());return t}readPackedBoolean(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readBoolean());return t}readPackedFloat(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readFloat());return t}readPackedDouble(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readDouble());return t}readPackedFixed32(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readFixed32());return t}readPackedSFixed32(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readSFixed32());return t}readPackedFixed64(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readFixed64());return t}readPackedSFixed64(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readSFixed64());return t}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(t){const n=7&t;if(n===0)for(;this.buf[this.pos++]>127;);else if(n===2)this.pos=this.readVarint()+this.pos;else if(n===5)this.pos+=4;else{if(n!==1)throw new Error(`Unimplemented type: ${n}`);this.pos+=8}}writeTag(t,n){this.writeVarint(t<<3|n)}realloc(t){let n=this.length||16;for(;n<this.pos+t;)n*=2;if(n!==this.length){const c=new Uint8Array(n);c.set(this.buf),this.buf=c,this.dataView=new DataView(c.buffer),this.length=n}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*q_),!0),this.pos+=8}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*q_),!0),this.pos+=8}writeVarint(t){(t=+t||0)>268435455||t<0?(function(n,c){let p,_;if(n>=0?(p=n%4294967296|0,_=n/4294967296|0):(p=~(-n%4294967296),_=~(-n/4294967296),4294967295^p?p=p+1|0:(p=0,_=_+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),(function(b,w,T){T.buf[T.pos++]=127&b|128,b>>>=7,T.buf[T.pos++]=127&b|128,b>>>=7,T.buf[T.pos++]=127&b|128,b>>>=7,T.buf[T.pos++]=127&b|128,T.buf[T.pos]=127&(b>>>=7)})(p,0,c),(function(b,w){const T=(7&b)<<4;w.buf[w.pos++]|=T|((b>>>=3)?128:0),b&&(w.buf[w.pos++]=127&b|((b>>>=7)?128:0),b&&(w.buf[w.pos++]=127&b|((b>>>=7)?128:0),b&&(w.buf[w.pos++]=127&b|((b>>>=7)?128:0),b&&(w.buf[w.pos++]=127&b|((b>>>=7)?128:0),b&&(w.buf[w.pos++]=127&b)))))})(_,c)})(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))}writeSVarint(t){this.writeVarint(t<0?2*-t-1:2*t)}writeBoolean(t){this.writeVarint(+t)}writeString(t){t=String(t),this.realloc(4*t.length),this.pos++;const n=this.pos;this.pos=(function(p,_,b){for(let w,T,P=0;P<_.length;P++){if(w=_.charCodeAt(P),w>55295&&w<57344){if(!T){w>56319||P+1===_.length?(p[b++]=239,p[b++]=191,p[b++]=189):T=w;continue}if(w<56320){p[b++]=239,p[b++]=191,p[b++]=189,T=w;continue}w=T-55296<<10|w-56320|65536,T=null}else T&&(p[b++]=239,p[b++]=191,p[b++]=189,T=null);w<128?p[b++]=w:(w<2048?p[b++]=w>>6|192:(w<65536?p[b++]=w>>12|224:(p[b++]=w>>18|240,p[b++]=w>>12&63|128),p[b++]=w>>6&63|128),p[b++]=63&w|128)}return b})(this.buf,t,this.pos);const c=this.pos-n;c>=128&&Z_(n,c,this),this.pos=n-1,this.writeVarint(c),this.pos+=c}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8}writeBytes(t){const n=t.length;this.writeVarint(n),this.realloc(n);for(let c=0;c<n;c++)this.buf[this.pos++]=t[c]}writeRawMessage(t,n){this.pos++;const c=this.pos;t(n,this);const p=this.pos-c;p>=128&&Z_(c,p,this),this.pos=c-1,this.writeVarint(p),this.pos+=p}writeMessage(t,n,c){this.writeTag(t,2),this.writeRawMessage(n,c)}writePackedVarint(t,n){n.length&&this.writeMessage(t,oS,n)}writePackedSVarint(t,n){n.length&&this.writeMessage(t,sS,n)}writePackedBoolean(t,n){n.length&&this.writeMessage(t,uS,n)}writePackedFloat(t,n){n.length&&this.writeMessage(t,lS,n)}writePackedDouble(t,n){n.length&&this.writeMessage(t,cS,n)}writePackedFixed32(t,n){n.length&&this.writeMessage(t,hS,n)}writePackedSFixed32(t,n){n.length&&this.writeMessage(t,pS,n)}writePackedFixed64(t,n){n.length&&this.writeMessage(t,dS,n)}writePackedSFixed64(t,n){n.length&&this.writeMessage(t,fS,n)}writeBytesField(t,n){this.writeTag(t,2),this.writeBytes(n)}writeFixed32Field(t,n){this.writeTag(t,5),this.writeFixed32(n)}writeSFixed32Field(t,n){this.writeTag(t,5),this.writeSFixed32(n)}writeFixed64Field(t,n){this.writeTag(t,1),this.writeFixed64(n)}writeSFixed64Field(t,n){this.writeTag(t,1),this.writeSFixed64(n)}writeVarintField(t,n){this.writeTag(t,0),this.writeVarint(n)}writeSVarintField(t,n){this.writeTag(t,0),this.writeSVarint(n)}writeStringField(t,n){this.writeTag(t,2),this.writeString(n)}writeFloatField(t,n){this.writeTag(t,5),this.writeFloat(n)}writeDoubleField(t,n){this.writeTag(t,1),this.writeDouble(n)}writeBooleanField(t,n){this.writeVarintField(t,+n)}}function Oc(a,t,n){return n?4294967296*t+(a>>>0):4294967296*(t>>>0)+(a>>>0)}function Z_(a,t,n){const c=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(c);for(let p=n.pos-1;p>=a;p--)n.buf[p+c]=n.buf[p]}function oS(a,t){for(let n=0;n<a.length;n++)t.writeVarint(a[n])}function sS(a,t){for(let n=0;n<a.length;n++)t.writeSVarint(a[n])}function lS(a,t){for(let n=0;n<a.length;n++)t.writeFloat(a[n])}function cS(a,t){for(let n=0;n<a.length;n++)t.writeDouble(a[n])}function uS(a,t){for(let n=0;n<a.length;n++)t.writeBoolean(a[n])}function hS(a,t){for(let n=0;n<a.length;n++)t.writeFixed32(a[n])}function pS(a,t){for(let n=0;n<a.length;n++)t.writeSFixed32(a[n])}function dS(a,t){for(let n=0;n<a.length;n++)t.writeFixed64(a[n])}function fS(a,t){for(let n=0;n<a.length;n++)t.writeSFixed64(a[n])}function mS(a,t,n){a===1&&n.readMessage(gS,t)}function gS(a,t,n){if(a===3){const{id:c,bitmap:p,width:_,height:b,left:w,top:T,advance:P}=n.readMessage(yS,{});t.push({id:c,bitmap:new Ch({width:_+6,height:b+6},p),metrics:{width:_,height:b,left:w,top:T,advance:P}})}}function yS(a,t,n){a===1?t.id=n.readVarint():a===2?t.bitmap=n.readBytes():a===3?t.width=n.readVarint():a===4?t.height=n.readVarint():a===5?t.left=n.readSVarint():a===6?t.top=n.readSVarint():a===7&&(t.advance=n.readVarint())}function W_(a){let t=0,n=0;for(const b of a)t+=b.w*b.h,n=Math.max(n,b.w);a.sort(((b,w)=>w.h-b.h));const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let p=0,_=0;for(const b of a)for(let w=c.length-1;w>=0;w--){const T=c[w];if(!(b.w>T.w||b.h>T.h)){if(b.x=T.x,b.y=T.y,_=Math.max(_,b.y+b.h),p=Math.max(p,b.x+b.w),b.w===T.w&&b.h===T.h){const P=c.pop();P&&w<c.length&&(c[w]=P)}else b.h===T.h?(T.x+=b.w,T.w-=b.w):b.w===T.w?(T.y+=b.h,T.h-=b.h):(c.push({x:T.x+b.w,y:T.y,w:T.w-b.w,h:b.h}),T.y+=b.h,T.h-=b.h);break}}return{w:p,h:_,fill:t/(p*_)||0}}class rg{constructor(t,{pixelRatio:n,version:c,stretchX:p,stretchY:_,content:b,textFitWidth:w,textFitHeight:T}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=p,this.stretchY=_,this.content=b,this.version=c,this.textFitWidth=w,this.textFitHeight=T}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class H_{constructor(t,n){const c={},p={};this.haveRenderCallbacks=[];const _=[];this.addImages(t,c,_),this.addImages(n,p,_);const{w:b,h:w}=W_(_),T=new rn({width:b||1,height:w||1});for(const P in t){const E=t[P],z=c[P].paddedRect;rn.copy(E.data,T,{x:0,y:0},{x:z.x+1,y:z.y+1},E.data)}for(const P in n){const E=n[P],z=p[P].paddedRect,F=z.x+1,$=z.y+1,N=E.data.width,q=E.data.height;rn.copy(E.data,T,{x:0,y:0},{x:F,y:$},E.data),rn.copy(E.data,T,{x:0,y:q-1},{x:F,y:$-1},{width:N,height:1}),rn.copy(E.data,T,{x:0,y:0},{x:F,y:$+q},{width:N,height:1}),rn.copy(E.data,T,{x:N-1,y:0},{x:F-1,y:$},{width:1,height:q}),rn.copy(E.data,T,{x:0,y:0},{x:F+N,y:$},{width:1,height:q})}this.image=T,this.iconPositions=c,this.patternPositions=p}addImages(t,n,c){for(const p in t){const _=t[p],b={x:0,y:0,w:_.data.width+2,h:_.data.height+2};c.push(b),n[p]=new rg(b,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(t,n){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in t.updatedImages)this.patchUpdatedImage(this.iconPositions[c],t.getImage(c),n),this.patchUpdatedImage(this.patternPositions[c],t.getImage(c),n)}patchUpdatedImage(t,n,c){if(!t||!n||t.version===n.version)return;t.version=n.version;const[p,_]=t.tl;c.update(n.data,void 0,{x:p,y:_})}}var vs;Ye("ImagePosition",rg),Ye("ImageAtlas",H_),f.ao=void 0,(vs=f.ao||(f.ao={}))[vs.none=0]="none",vs[vs.horizontal=1]="horizontal",vs[vs.vertical=2]="vertical",vs[vs.horizontalOnly=3]="horizontalOnly";class Fh{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,n,c){const p=new Fh;return p.scale=t||1,p.fontStack=n,p.verticalAlign=c||"bottom",p}static forImage(t,n){const c=new Fh;return c.imageName=t,c.verticalAlign=n||"bottom",c}}class Bc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){const c=new Bc;for(let p=0;p<t.sections.length;p++){const _=t.sections[p];_.image?c.addImageSection(_):c.addTextSection(_,n)}return c}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=(function(t){let n="";for(let c=0;c<t.length;c++){const p=t.charCodeAt(c+1)||null,_=t.charCodeAt(c-1)||null;n+=p&&vd(p)&&!Dh[t[c+1]]||_&&vd(_)&&!Dh[t[c-1]]||!Dh[t[c]]?t[c]:Dh[t[c]]}return n})(this.text)}trim(){let t=0;for(let c=0;c<this.text.length&&Dd[this.text.charCodeAt(c)];c++)t++;let n=this.text.length;for(let c=this.text.length-1;c>=0&&c>=t&&Dd[this.text.charCodeAt(c)];c--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){const c=new Bc;return c.text=this.text.substring(t,n),c.sectionIndex=this.sectionIndex.slice(t,n),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,n)=>Math.max(t,this.sections[n].scale)),0)}getMaxImageSize(t){let n=0,c=0;for(let p=0;p<this.length();p++){const _=this.getSection(p);if(_.imageName){const b=t[_.imageName];if(!b)continue;const w=b.displaySize;n=Math.max(n,w[0]),c=Math.max(c,w[1])}}return{maxImageWidth:n,maxImageHeight:c}}addTextSection(t,n){this.text+=t.text,this.sections.push(Fh.forText(t.scale,t.fontStack||n,t.verticalAlign));const c=this.sections.length-1;for(let p=0;p<t.text.length;++p)this.sectionIndex.push(c)}addImageSection(t){const n=t.image?t.image.name:"";if(n.length===0)return void ar("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(Fh.forImage(n,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):ar("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ld(a,t,n,c,p,_,b,w,T,P,E,z,F,$,N){const q=Bc.fromFeature(a,p);let H;z===f.ao.vertical&&q.verticalizePunctuation();const{processBidirectionalText:Q,processStyledBidirectionalText:me}=Cn;if(Q&&q.sections.length===1){H=[];const ke=Q(q.toString(),ig(q,P,_,t,c,$));for(const Ee of ke){const De=new Bc;De.text=Ee,De.sections=q.sections;for(let Ze=0;Ze<Ee.length;Ze++)De.sectionIndex.push(0);H.push(De)}}else if(me){H=[];const ke=me(q.text,q.sectionIndex,ig(q,P,_,t,c,$));for(const Ee of ke){const De=new Bc;De.text=Ee[0],De.sectionIndex=Ee[1],De.sections=q.sections,H.push(De)}}else H=(function(ke,Ee){const De=[],Ze=ke.text;let $e=0;for(const qe of Ee)De.push(ke.substring($e,qe)),$e=qe;return $e<Ze.length&&De.push(ke.substring($e,Ze.length)),De})(q,ig(q,P,_,t,c,$));const ae=[],se={positionedLines:ae,text:q.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:z,iconsInText:!1,verticalizable:!1};return(function(ke,Ee,De,Ze,$e,qe,st,Ue,Ge,ze,mt,_t){let ut=0,nt=0,Vt=0,Pr=0;const Qr=Ue==="right"?1:Ue==="left"?0:.5,Ci=ai/_t;let In=0;for(const wr of $e){wr.trim();const oi=wr.getMaxScale(),mi={positionedGlyphs:[],lineOffset:0};ke.positionedLines[In]=mi;const gi=mi.positionedGlyphs;let Xi=0;if(!wr.length()){nt+=qe,++In;continue}const zn=xS(Ze,wr,Ci);for(let an=0;an<wr.length();an++){const ei=wr.getSection(an),li=wr.getSectionIndex(an),ci=wr.getCharCode(an),Gr=wS(Ge,mt,ci);let _r;if(ei.imageName){if(ke.iconsInText=!0,ei.scale=ei.scale*Ci,_r=SS(ei,Gr,oi,zn,Ze),!_r)continue;Xi=Math.max(Xi,_r.imageOffset)}else if(_r=TS(ei,ci,Gr,zn,Ee,De),!_r)continue;const{rect:ma,metrics:Vc,baselineOffset:ga}=_r;gi.push({glyph:ci,imageName:ei.imageName,x:ut,y:nt+ga+-17,vertical:Gr,scale:ei.scale,fontStack:ei.fontStack,sectionIndex:li,metrics:Vc,rect:ma}),Gr?(ke.verticalizable=!0,ut+=(ei.imageName?Vc.advance:ai)*ei.scale+ze):ut+=Vc.advance*ei.scale+ze}gi.length!==0&&(Vt=Math.max(ut-ze,Vt),kS(gi,0,gi.length-1,Qr)),ut=0,mi.lineOffset=Math.max(Xi,(oi-1)*ai);const si=qe*oi+Xi;nt+=si,Pr=Math.max(si,Pr),++In}const{horizontalAlign:nn,verticalAlign:fi}=ng(st);(function(wr,oi,mi,gi,Xi,zn,si,an,ei){const li=(oi-mi)*Xi;let ci=0;ci=zn!==si?-an*gi- -17:-gi*ei*si+.5*si;for(const Gr of wr)for(const _r of Gr.positionedGlyphs)_r.x+=li,_r.y+=ci})(ke.positionedLines,Qr,nn,fi,Vt,Pr,qe,nt,$e.length),ke.top+=-fi*nt,ke.bottom=ke.top+nt,ke.left+=-nn*Vt,ke.right=ke.left+Vt})(se,t,n,c,H,b,w,T,z,P,F,N),!(function(ke){for(const Ee of ke)if(Ee.positionedGlyphs.length!==0)return!1;return!0})(ae)&&se}const Dd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},_S={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},vS={40:!0};function X_(a,t,n,c,p,_){if(t.imageName){const b=c[t.imageName];return b?b.displaySize[0]*t.scale*ai/_+p:0}{const b=n[t.fontStack],w=b&&b[a];return w?w.metrics.advance*t.scale+p:0}}function K_(a,t,n,c){const p=Math.pow(a-t,2);return c?a<t?p/2:2*p:p+Math.abs(n)*n}function bS(a,t,n){let c=0;return a===10&&(c-=1e4),n&&(c+=150),a!==40&&a!==65288||(c+=50),t!==41&&t!==65289||(c+=50),c}function Y_(a,t,n,c,p,_){let b=null,w=K_(t,n,p,_);for(const T of c){const P=K_(t-T.x,n,p,_)+T.badness;P<=w&&(b=T,w=P)}return{index:a,x:t,priorBreak:b,badness:w}}function J_(a){return a?J_(a.priorBreak).concat(a.index):[]}function ig(a,t,n,c,p,_){if(!a)return[];const b=[],w=(function(z,F,$,N,q,H){let Q=0;for(let me=0;me<z.length();me++){const ae=z.getSection(me);Q+=X_(z.getCharCode(me),ae,N,q,F,H)}return Q/Math.max(1,Math.ceil(Q/$))})(a,t,n,c,p,_),T=a.text.indexOf("â")>=0;let P=0;for(let z=0;z<a.length();z++){const F=a.getSection(z),$=a.getCharCode(z);if(Dd[$]||(P+=X_($,F,c,p,t,_)),z<a.length()-1){const N=!((E=$)<11904)&&(!!Ut["CJK Compatibility Forms"](E)||!!Ut["CJK Compatibility"](E)||!!Ut["CJK Strokes"](E)||!!Ut["CJK Symbols and Punctuation"](E)||!!Ut["Enclosed CJK Letters and Months"](E)||!!Ut["Halfwidth and Fullwidth Forms"](E)||!!Ut["Ideographic Description Characters"](E)||!!Ut["Vertical Forms"](E)||fh.test(String.fromCodePoint(E)));(_S[$]||N||F.imageName||z!==a.length()-2&&vS[a.getCharCode(z+1)])&&b.push(Y_(z+1,P,w,b,bS($,a.getCharCode(z+1),N&&T),!1))}}var E;return J_(Y_(a.length(),P,w,b,0,!0))}function ng(a){let t=.5,n=.5;switch(a){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function xS(a,t,n){const c=t.getMaxScale()*ai,{maxImageWidth:p,maxImageHeight:_}=t.getMaxImageSize(a),b=Math.max(c,_*n);return{verticalLineContentWidth:Math.max(c,p*n),horizontalLineContentHeight:b}}function Q_(a){switch(a){case"top":return 0;case"center":return .5;default:return 1}}function wS(a,t,n){return!(a===f.ao.horizontal||!t&&!mh(n)||t&&(Dd[n]||(c=n,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(c)))));var c}function TS(a,t,n,c,p,_){const b=_[a.fontStack],w=(function(P,E,z,F){if(P&&P.rect)return P;const $=E[z.fontStack],N=$&&$[F];return N?{rect:null,metrics:N.metrics}:null})(b&&b[t],p,a,t);if(w===null)return null;let T;if(n)T=c.verticalLineContentWidth-a.scale*ai;else{const P=Q_(a.verticalAlign);T=(c.horizontalLineContentHeight-a.scale*ai)*P}return{rect:w.rect,metrics:w.metrics,baselineOffset:T}}function SS(a,t,n,c,p){const _=p[a.imageName];if(!_)return null;const b=_.paddedRect,w=_.displaySize,T={width:w[0],height:w[1],left:1,top:-3,advance:t?w[1]:w[0]};let P;if(t)P=c.verticalLineContentWidth-w[1]*a.scale;else{const E=Q_(a.verticalAlign);P=(c.horizontalLineContentHeight-w[1]*a.scale)*E}return{rect:b,metrics:T,baselineOffset:P,imageOffset:(t?w[0]:w[1])*a.scale-ai*n}}function kS(a,t,n,c){if(c===0)return;const p=a[n],_=(a[n].x+p.metrics.advance*p.scale)*c;for(let b=t;b<=n;b++)a[b].x-=_}function CS(a,t,n){const{horizontalAlign:c,verticalAlign:p}=ng(n),_=t[0]-a.displaySize[0]*c,b=t[1]-a.displaySize[1]*p;return{image:a,top:b,bottom:b+a.displaySize[1],left:_,right:_+a.displaySize[0]}}function ev(a){var t,n;let c=a.left,p=a.top,_=a.right-c,b=a.bottom-p;const w=(t=a.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",T=(n=a.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",P=(a.image.content[2]-a.image.content[0])/(a.image.content[3]-a.image.content[1]);if(T==="proportional"){if(w==="stretchOnly"&&_/b<P||w==="proportional"){const E=Math.ceil(b*P);c*=E/_,_=E}}else if(w==="proportional"&&T==="stretchOnly"&&P!==0&&_/b>P){const E=Math.ceil(_/P);p*=E/b,b=E}return{x1:c,y1:p,x2:c+_,y2:p+b}}function tv(a,t,n,c,p,_){const b=a.image;let w;if(b.content){const H=b.content,Q=b.pixelRatio||1;w=[H[0]/Q,H[1]/Q,b.displaySize[0]-H[2]/Q,b.displaySize[1]-H[3]/Q]}const T=t.left*_,P=t.right*_;let E,z,F,$;n==="width"||n==="both"?($=p[0]+T-c[3],z=p[0]+P+c[1]):($=p[0]+(T+P-b.displaySize[0])/2,z=$+b.displaySize[0]);const N=t.top*_,q=t.bottom*_;return n==="height"||n==="both"?(E=p[1]+N-c[0],F=p[1]+q+c[2]):(E=p[1]+(N+q-b.displaySize[1])/2,F=E+b.displaySize[1]),{image:b,top:E,right:z,bottom:F,left:$,collisionPadding:w}}const Eo=128,bs=32640;function rv(a,t){const{expression:n}=t;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new vr(a+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:p}=n;let _=0;for(;_<c.length&&c[_]<=a;)_++;_=Math.max(0,_-1);let b=_;for(;b<c.length&&c[b]<a+1;)b++;b=Math.min(c.length-1,b);const w=c[_],T=c[b];return n.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:T,interpolationType:p}:{kind:"camera",minZoom:w,maxZoom:T,minSize:n.evaluate(new vr(w)),maxSize:n.evaluate(new vr(T)),interpolationType:p}}}function ag(a,t,n){let c="never";const p=a.get(t);return p?c=p:a.get(n)&&(c="always"),c}const PS=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Fd(a,t,n,c,p,_,b,w,T,P,E,z,F){const $=w?Math.min(bs,Math.round(w[0])):0,N=w?Math.min(bs,Math.round(w[1])):0;a.emplaceBack(t,n,Math.round(32*c),Math.round(32*p),_,b,($<<1)+(T?1:0),N,16*P,16*E,256*z,256*F)}function og(a,t,n){a.emplaceBack(t.x,t.y,n),a.emplaceBack(t.x,t.y,n),a.emplaceBack(t.x,t.y,n),a.emplaceBack(t.x,t.y,n)}function MS(a){for(const t of a.sections)if(wd(t.text))return!0;return!1}class sg{constructor(t){this.layoutVertexArray=new Ne,this.indexArray=new lr,this.programConfigurations=t,this.segments=new kt,this.dynamicLayoutVertexArray=new Le,this.opacityVertexArray=new it,this.hasVisibleVertices=!1,this.placedSymbolArray=new U}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,n,c,p){this.isEmpty()||(c&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,tS.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,rS.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,PS,!0),this.opacityVertexBuffer.itemSize=1),(c||p)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ye("SymbolBuffers",sg);class lg{constructor(t,n,c){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new c,this.segments=new kt,this.collisionVertexArray=new tr}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,iS.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ye("CollisionBuffers",lg);class $c{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((b=>b.id)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=rv(this.zoom,n["text-size"]),this.iconSizeData=rv(this.zoom,n["icon-size"]);const c=this.layers[0].layout,p=c.get("symbol-sort-key"),_=c.get("symbol-z-order");this.canOverlap=ag(c,"text-overlap","text-allow-overlap")!=="never"||ag(c,"icon-overlap","icon-allow-overlap")!=="never"||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&!p.isConstant(),this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,c.get("symbol-placement")==="point"&&(this.writingModes=c.get("text-writing-mode").map((b=>f.ao[b]))),this.stateDependentLayerIds=this.layers.filter((b=>b.isStateDependent())).map((b=>b.id)),this.sourceID=t.sourceID}createArrays(){this.text=new sg(new tn(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new sg(new tn(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new Y,this.lineVertexArray=new ee,this.symbolInstances=new X,this.textAnchorOffsets=new te}calculateGlyphDependencies(t,n,c,p,_){for(let b=0;b<t.length;b++)if(n[t.charCodeAt(b)]=!0,(c||p)&&_){const w=Dh[t.charAt(b)];w&&(n[w.charCodeAt(0)]=!0)}}populate(t,n,c){const p=this.layers[0],_=p.layout,b=_.get("text-font"),w=_.get("text-field"),T=_.get("icon-image"),P=(w.value.kind!=="constant"||w.value.value instanceof Ei&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),E=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,z=_.get("symbol-sort-key");if(this.features=[],!P&&!E)return;const F=n.iconDependencies,$=n.glyphDependencies,N=n.availableImages,q=new vr(this.zoom,{globalState:this.globalState});for(const{feature:H,id:Q,index:me,sourceLayerIndex:ae}of t){const se=p._featureFilter.needGeometry,ke=fa(H,se);if(!p._featureFilter.filter(q,ke,c))continue;let Ee,De;if(se||(ke.geometry=Ka(H)),P){const $e=p.getValueAndResolveTokens("text-field",ke,c,N),qe=Ei.factory($e),st=this.hasRTLText=this.hasRTLText||MS(qe);(!st||Cn.getRTLTextPluginStatus()==="unavailable"||st&&Cn.isParsed())&&(Ee=aS(qe,p,ke))}if(E){const $e=p.getValueAndResolveTokens("icon-image",ke,c,N);De=$e instanceof Qi?$e:Qi.fromString($e)}if(!Ee&&!De)continue;const Ze=this.sortFeaturesByKey?z.evaluate(ke,{},c):void 0;if(this.features.push({id:Q,text:Ee,icon:De,index:me,sourceLayerIndex:ae,geometry:ke.geometry,properties:H.properties,type:jc.types[H.type],sortKey:Ze}),De&&(F[De.name]=!0),Ee){const $e=b.evaluate(ke,{},c).join(","),qe=_.get("text-rotation-alignment")!=="viewport"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(f.ao.vertical)>=0;for(const st of Ee.sections)if(st.image)F[st.image.name]=!0;else{const Ue=Tc(Ee.toString()),Ge=st.fontStack||$e,ze=$[Ge]=$[Ge]||{};this.calculateGlyphDependencies(st.text,ze,qe,this.allowVerticalPlacement,Ue)}}}_.get("symbol-placement")==="line"&&(this.features=(function(H){const Q={},me={},ae=[];let se=0;function ke($e){ae.push(H[$e]),se++}function Ee($e,qe,st){const Ue=me[$e];return delete me[$e],me[qe]=Ue,ae[Ue].geometry[0].pop(),ae[Ue].geometry[0]=ae[Ue].geometry[0].concat(st[0]),Ue}function De($e,qe,st){const Ue=Q[qe];return delete Q[qe],Q[$e]=Ue,ae[Ue].geometry[0].shift(),ae[Ue].geometry[0]=st[0].concat(ae[Ue].geometry[0]),Ue}function Ze($e,qe,st){const Ue=st?qe[0][qe[0].length-1]:qe[0][0];return`${$e}:${Ue.x}:${Ue.y}`}for(let $e=0;$e<H.length;$e++){const qe=H[$e],st=qe.geometry,Ue=qe.text?qe.text.toString():null;if(!Ue){ke($e);continue}const Ge=Ze(Ue,st),ze=Ze(Ue,st,!0);if(Ge in me&&ze in Q&&me[Ge]!==Q[ze]){const mt=De(Ge,ze,st),_t=Ee(Ge,ze,ae[mt].geometry);delete Q[Ge],delete me[ze],me[Ze(Ue,ae[_t].geometry,!0)]=_t,ae[mt].geometry=null}else Ge in me?Ee(Ge,ze,st):ze in Q?De(Ge,ze,st):(ke($e),Q[Ge]=se-1,me[ze]=se-1)}return ae.filter(($e=>$e.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((H,Q)=>H.sortKey-Q.sortKey))}update(t,n,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,c),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,c))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const c=this.lineVertexArray.length;if(t.segment!==void 0){let p=t.dist(n[t.segment+1]),_=t.dist(n[t.segment]);const b={};for(let w=t.segment+1;w<n.length;w++)b[w]={x:n[w].x,y:n[w].y,tileUnitDistanceFromAnchor:p},w<n.length-1&&(p+=n[w+1].dist(n[w]));for(let w=t.segment||0;w>=0;w--)b[w]={x:n[w].x,y:n[w].y,tileUnitDistanceFromAnchor:_},w>0&&(_+=n[w-1].dist(n[w]));for(let w=0;w<n.length;w++){const T=b[w];this.lineVertexArray.emplaceBack(T.x,T.y,T.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(t,n,c,p,_,b,w,T,P,E,z,F){const $=t.indexArray,N=t.layoutVertexArray,q=t.segments.prepareSegment(4*n.length,N,$,this.canOverlap?b.sortKey:void 0),H=this.glyphOffsetArray.length,Q=q.vertexLength,me=this.allowVerticalPlacement&&w===f.ao.vertical?Math.PI/2:0,ae=b.text&&b.text.sections;for(let se=0;se<n.length;se++){const{tl:ke,tr:Ee,bl:De,br:Ze,tex:$e,pixelOffsetTL:qe,pixelOffsetBR:st,minFontScaleX:Ue,minFontScaleY:Ge,glyphOffset:ze,isSDF:mt,sectionIndex:_t}=n[se],ut=q.vertexLength,nt=ze[1];Fd(N,T.x,T.y,ke.x,nt+ke.y,$e.x,$e.y,c,mt,qe.x,qe.y,Ue,Ge),Fd(N,T.x,T.y,Ee.x,nt+Ee.y,$e.x+$e.w,$e.y,c,mt,st.x,qe.y,Ue,Ge),Fd(N,T.x,T.y,De.x,nt+De.y,$e.x,$e.y+$e.h,c,mt,qe.x,st.y,Ue,Ge),Fd(N,T.x,T.y,Ze.x,nt+Ze.y,$e.x+$e.w,$e.y+$e.h,c,mt,st.x,st.y,Ue,Ge),og(t.dynamicLayoutVertexArray,T,me),$.emplaceBack(ut,ut+2,ut+1),$.emplaceBack(ut+1,ut+2,ut+3),q.vertexLength+=4,q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ze[0]),se!==n.length-1&&_t===n[se+1].sectionIndex||t.programConfigurations.populatePaintArrays(N.length,b,b.index,{},F,ae&&ae[_t])}t.placedSymbolArray.emplaceBack(T.x,T.y,H,this.glyphOffsetArray.length-H,Q,P,E,T.segment,c?c[0]:0,c?c[1]:0,p[0],p[1],w,0,!1,0,z)}_addCollisionDebugVertex(t,n,c,p,_,b){return n.emplaceBack(0,0),t.emplaceBack(c.x,c.y,p,_,Math.round(b.x),Math.round(b.y))}addCollisionDebugVertices(t,n,c,p,_,b,w){const T=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),P=T.vertexLength,E=_.layoutVertexArray,z=_.collisionVertexArray,F=w.anchorX,$=w.anchorY;this._addCollisionDebugVertex(E,z,b,F,$,new C(t,n)),this._addCollisionDebugVertex(E,z,b,F,$,new C(c,n)),this._addCollisionDebugVertex(E,z,b,F,$,new C(c,p)),this._addCollisionDebugVertex(E,z,b,F,$,new C(t,p)),T.vertexLength+=4;const N=_.indexArray;N.emplaceBack(P,P+1),N.emplaceBack(P+1,P+2),N.emplaceBack(P+2,P+3),N.emplaceBack(P+3,P),T.primitiveLength+=4}addDebugCollisionBoxes(t,n,c,p){for(let _=t;_<n;_++){const b=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,p?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,c)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new lg(Pt,V_.members,or),this.iconCollisionBox=new lg(Pt,V_.members,or);for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(t,n,c,p,_,b,w,T,P){const E={};for(let z=n;z<c;z++){const F=t.get(z);E.textBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},E.textFeatureIndex=F.featureIndex;break}for(let z=p;z<_;z++){const F=t.get(z);E.verticalTextBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},E.verticalTextFeatureIndex=F.featureIndex;break}for(let z=b;z<w;z++){const F=t.get(z);E.iconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},E.iconFeatureIndex=F.featureIndex;break}for(let z=T;z<P;z++){const F=t.get(z);E.verticalIconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},E.verticalIconFeatureIndex=F.featureIndex;break}return E}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const c=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,n){const c=t.placedSymbolArray.get(n),p=c.vertexStartIndex+4*c.numGlyphs;for(let _=c.vertexStartIndex;_<p;_+=4)t.indexArray.emplaceBack(_,_+2,_+1),t.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(t),c=Math.cos(t),p=[],_=[],b=[];for(let w=0;w<this.symbolInstances.length;++w){b.push(w);const T=this.symbolInstances.get(w);p.push(0|Math.round(n*T.anchorX+c*T.anchorY)),_.push(T.featureIndex)}return b.sort(((w,T)=>p[w]-p[T]||_[T]-_[w])),b}addToSortKeyRanges(t,n){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===n?c.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const c=this.symbolInstances.get(n);this.featureSortOrder.push(c.featureIndex),[c.rightJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.leftJustifiedTextSymbolIndex].forEach(((p,_,b)=>{p>=0&&b.indexOf(p)===_&&this.addIndicesForPlacedSymbol(this.text,p)})),c.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,c.verticalPlacedTextSymbolIndex),c.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.placedIconSymbolIndex),c.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let iv,nv;Ye("SymbolBucket",$c,{omit:["layers","collisionBoxArray","features","compareText"]}),$c.MAX_GLYPHS=65535,$c.addDynamicAttributes=og;var cg={get paint(){return nv=nv||new Ri({"icon-opacity":new dt(be.paint_symbol["icon-opacity"]),"icon-color":new dt(be.paint_symbol["icon-color"]),"icon-halo-color":new dt(be.paint_symbol["icon-halo-color"]),"icon-halo-width":new dt(be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new dt(be.paint_symbol["icon-halo-blur"]),"icon-translate":new ot(be.paint_symbol["icon-translate"]),"icon-translate-anchor":new ot(be.paint_symbol["icon-translate-anchor"]),"text-opacity":new dt(be.paint_symbol["text-opacity"]),"text-color":new dt(be.paint_symbol["text-color"],{runtimeType:pi,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new dt(be.paint_symbol["text-halo-color"]),"text-halo-width":new dt(be.paint_symbol["text-halo-width"]),"text-halo-blur":new dt(be.paint_symbol["text-halo-blur"]),"text-translate":new ot(be.paint_symbol["text-translate"]),"text-translate-anchor":new ot(be.paint_symbol["text-translate-anchor"])})},get layout(){return iv=iv||new Ri({"symbol-placement":new ot(be.layout_symbol["symbol-placement"]),"symbol-spacing":new ot(be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ot(be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new dt(be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ot(be.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ot(be.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ot(be.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ot(be.layout_symbol["icon-ignore-placement"]),"icon-optional":new ot(be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ot(be.layout_symbol["icon-rotation-alignment"]),"icon-size":new dt(be.layout_symbol["icon-size"]),"icon-text-fit":new ot(be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ot(be.layout_symbol["icon-text-fit-padding"]),"icon-image":new dt(be.layout_symbol["icon-image"]),"icon-rotate":new dt(be.layout_symbol["icon-rotate"]),"icon-padding":new dt(be.layout_symbol["icon-padding"]),"icon-keep-upright":new ot(be.layout_symbol["icon-keep-upright"]),"icon-offset":new dt(be.layout_symbol["icon-offset"]),"icon-anchor":new dt(be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ot(be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ot(be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ot(be.layout_symbol["text-rotation-alignment"]),"text-field":new dt(be.layout_symbol["text-field"]),"text-font":new dt(be.layout_symbol["text-font"]),"text-size":new dt(be.layout_symbol["text-size"]),"text-max-width":new dt(be.layout_symbol["text-max-width"]),"text-line-height":new ot(be.layout_symbol["text-line-height"]),"text-letter-spacing":new dt(be.layout_symbol["text-letter-spacing"]),"text-justify":new dt(be.layout_symbol["text-justify"]),"text-radial-offset":new dt(be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ot(be.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new dt(be.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new dt(be.layout_symbol["text-anchor"]),"text-max-angle":new ot(be.layout_symbol["text-max-angle"]),"text-writing-mode":new ot(be.layout_symbol["text-writing-mode"]),"text-rotate":new dt(be.layout_symbol["text-rotate"]),"text-padding":new ot(be.layout_symbol["text-padding"]),"text-keep-upright":new ot(be.layout_symbol["text-keep-upright"]),"text-transform":new dt(be.layout_symbol["text-transform"]),"text-offset":new dt(be.layout_symbol["text-offset"]),"text-allow-overlap":new ot(be.layout_symbol["text-allow-overlap"]),"text-overlap":new ot(be.layout_symbol["text-overlap"]),"text-ignore-placement":new ot(be.layout_symbol["text-ignore-placement"]),"text-optional":new ot(be.layout_symbol["text-optional"])})}};class av{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Ho,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ye("FormatSectionOverride",av,{omit:["defaultValue"]});class jd extends pn{constructor(t){super(t,cg)}recalculate(t,n){if(super.recalculate(t,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const c=this.layout.get("text-writing-mode");if(c){const p=[];for(const _ of c)p.indexOf(_)<0&&p.push(_);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,n,c,p){const _=this.layout.get(t).evaluate(n,{},c,p),b=this._unevaluatedLayout._values[t];return b.isDataDriven()||mc(b.value)||!_?_:(function(w,T){return T.replace(/{([^{}]+)}/g,((P,E)=>w&&E in w?String(w[E]):""))})(n.properties,_)}createBucket(t){return new $c(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of cg.paint.overridableProperties){if(!jd.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),c=new av(n),p=new rh(c,n.property.specification);let _=null;_=n.value.kind==="constant"||n.value.kind==="source"?new Js("source",p):new ih("composite",p,n.value.zoomStops),this.paint._values[t]=new Yn(n.property,_,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,c){return!(!this.layout||n.isDataDriven()||c.isDataDriven())&&jd.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const c=t.get("text-field"),p=cg.paint.properties[n];let _=!1;const b=w=>{for(const T of w)if(p.overrides&&p.overrides.hasOverride(T))return void(_=!0)};if(c.value.kind==="constant"&&c.value.value instanceof Ei)b(c.value.value.sections);else if(c.value.kind==="source"){const w=P=>{_||(P instanceof ua&&ft(P.value)===Ba?b(P.value.sections):P instanceof go?b(P.sections):P.eachChild(w))},T=c.value;T._styleExpression&&w(T._styleExpression.expression)}return _}}let ov;var AS={get paint(){return ov=ov||new Ri({"background-color":new ot(be.paint_background["background-color"]),"background-pattern":new Ga(be.paint_background["background-pattern"]),"background-opacity":new ot(be.paint_background["background-opacity"])})}};class ES extends pn{constructor(t){super(t,AS)}}let sv;var IS={get paint(){return sv=sv||new Ri({"raster-opacity":new ot(be.paint_raster["raster-opacity"]),"raster-hue-rotate":new ot(be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ot(be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ot(be.paint_raster["raster-brightness-max"]),"raster-saturation":new ot(be.paint_raster["raster-saturation"]),"raster-contrast":new ot(be.paint_raster["raster-contrast"]),"raster-resampling":new ot(be.paint_raster["raster-resampling"]),"raster-fade-duration":new ot(be.paint_raster["raster-fade-duration"])})}};class zS extends pn{constructor(t){super(t,IS)}}class RS extends pn{constructor(t){super(t,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class LS{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const DS={once:!0},ug=63710088e-1;class xs{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new xs(br(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,c=this.lat*n,p=t.lat*n,_=Math.sin(c)*Math.sin(p)+Math.cos(c)*Math.cos(p)*Math.cos((t.lng-this.lng)*n);return ug*Math.acos(Math.min(_,1))}static convert(t){if(t instanceof xs)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new xs(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new xs(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const lv=2*Math.PI*ug;function cv(a){return lv*Math.cos(a*Math.PI/180)}function uv(a){return(180+a)/360}function hv(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function pv(a,t){return a/cv(t)}function hg(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function dv(a,t){return a*cv(hg(t))}class jh{constructor(t,n,c=0){this.x=+t,this.y=+n,this.z=+c}static fromLngLat(t,n=0){const c=xs.convert(t);return new jh(uv(c.lng),hv(c.lat),pv(n,c.lat))}toLngLat(){return new xs(360*this.x-180,hg(this.y))}toAltitude(){return dv(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/lv*(t=hg(this.y),1/Math.cos(t*Math.PI/180));var t}}function fv(a,t,n){var c=2*Math.PI*6378137/256/Math.pow(2,n);return[a*c-2*Math.PI*6378137/2,t*c-2*Math.PI*6378137/2]}class pg{constructor(t,n,c){if(!(function(p,_,b){return!(p<0||p>25||b<0||b>=Math.pow(2,p)||_<0||_>=Math.pow(2,p))})(t,n,c))throw new Error(`x=${n}, y=${c}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=n,this.y=c,this.key=Nc(0,t,t,n,c)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n,c){const p=(b=this.y,w=this.z,T=fv(256*(_=this.x),256*(b=Math.pow(2,w)-b-1),w),P=fv(256*(_+1),256*(b+1),w),T[0]+","+T[1]+","+P[0]+","+P[1]);var _,b,w,T,P;const E=(function(z,F,$){let N,q="";for(let H=z;H>0;H--)N=1<<H-1,q+=(F&N?1:0)+($&N?2:0);return q})(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(c==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,E).replace(/{bbox-epsg-3857}/g,p)}isChildOf(t){const n=this.z-t.z;return n>0&&t.x===this.x>>n&&t.y===this.y>>n}getTilePoint(t){const n=Math.pow(2,this.z);return new C((t.x*n-this.x)*At,(t.y*n-this.y)*At)}toString(){return`${this.z}/${this.x}/${this.y}`}}class mv{constructor(t,n){this.wrap=t,this.canonical=n,this.key=Nc(t,n.z,n.z,n.x,n.y)}}class En{constructor(t,n,c,p,_){if(this.terrainRttPosMatrix32f=null,t<c)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${c}`);this.overscaledZ=t,this.wrap=n,this.canonical=new pg(c,+p,+_),this.key=Nc(n,t,c,p,_)}clone(){return new En(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-t;return t>this.canonical.z?new En(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new En(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(t,n){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-t;return t>this.canonical.z?Nc(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y):Nc(this.wrap*+n,t,t,this.canonical.x>>c,this.canonical.y>>c)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const n=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new En(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,c=2*this.canonical.x,p=2*this.canonical.y;return[new En(n,this.wrap,n,c,p),new En(n,this.wrap,n,c+1,p),new En(n,this.wrap,n,c,p+1),new En(n,this.wrap,n,c+1,p+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new En(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new En(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new mv(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new jh(t.x-this.wrap,t.y))}}function Nc(a,t,n,c,p){(a*=2)<0&&(a=-1*a-1);const _=1<<n;return(_*_*a+_*p+c).toString(36)+n.toString(36)+t.toString(36)}function Oh(a,t){return t?a.properties[t]:a.id}Ye("CanonicalTileID",pg),Ye("OverscaledTileID",En,{omit:["terrainRttPosMatrix32f"]});class hl{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(t){return this.minX=Math.min(this.minX,t.x),this.minY=Math.min(this.minY,t.y),this.maxX=Math.max(this.maxX,t.x),this.maxY=Math.max(this.maxY,t.y),this}expandBy(t){return this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(t){return this.expandBy(-t)}map(t){const n=new hl;return n.extend(t(new C(this.minX,this.minY))),n.extend(t(new C(this.maxX,this.minY))),n.extend(t(new C(this.minX,this.maxY))),n.extend(t(new C(this.maxX,this.maxY))),n}static fromPoints(t){const n=new hl;for(const c of t)n.extend(c);return n}contains(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(t){return!this.empty()&&!t.empty()&&t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY}intersects(t){return!this.empty()&&!t.empty()&&t.minX<=this.maxX&&t.maxX>=this.minX&&t.minY<=this.maxY&&t.maxY>=this.minY}}class gv{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const c=t[n];this._stringToNumber[c]=n,this._numberToString[n]=c}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class yv{constructor(t,n,c,p,_){this.type="Feature",this._vectorTileFeature=t,t._z=n,t._x=c,t._y=p,this.properties=t.properties,this.id=_}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(t[n]=this[n]);return t}}class _v{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new al(At,16,0),this.grid3D=new al(At,16,0),this.featureIndexArray=new ce,this.promoteId=n}insert(t,n,c,p,_,b){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,p,_);const T=b?this.grid3D:this.grid;for(let P=0;P<n.length;P++){const E=n[P],z=[1/0,1/0,-1/0,-1/0];for(let F=0;F<E.length;F++){const $=E[F];z[0]=Math.min(z[0],$.x),z[1]=Math.min(z[1],$.y),z[2]=Math.max(z[2],$.x),z[3]=Math.max(z[3],$.y)}z[0]<At&&z[1]<At&&z[2]>=0&&z[3]>=0&&T.insert(w,z[0],z[1],z[2],z[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new L_(new tg(this.rawTileData)).layers,this.sourceLayerCoder=new gv(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,n,c,p){this.loadVTLayers();const _=t.params,b=At/t.tileSize/t.scale,w=wo(_.filter),T=t.queryGeometry,P=t.queryPadding*b,E=hl.fromPoints(T),z=this.grid.query(E.minX-P,E.minY-P,E.maxX+P,E.maxY+P),F=hl.fromPoints(t.cameraQueryGeometry).expandBy(P),$=this.grid3D.query(F.minX,F.minY,F.maxX,F.maxY,((H,Q,me,ae)=>(function(se,ke,Ee,De,Ze){for(const qe of se)if(ke<=qe.x&&Ee<=qe.y&&De>=qe.x&&Ze>=qe.y)return!0;const $e=[new C(ke,Ee),new C(ke,Ze),new C(De,Ze),new C(De,Ee)];if(se.length>2){for(const qe of $e)if(Rc(se,qe))return!0}for(let qe=0;qe<se.length-1;qe++)if(dT(se[qe],se[qe+1],$e))return!0;return!1})(t.cameraQueryGeometry,H-P,Q-P,me+P,ae+P)));for(const H of $)z.push(H);z.sort(FS);const N={};let q;for(let H=0;H<z.length;H++){const Q=z[H];if(Q===q)continue;q=Q;const me=this.featureIndexArray.get(Q);let ae=null;this.loadMatchingFeature(N,me.bucketIndex,me.sourceLayerIndex,me.featureIndex,w,_.layers,_.availableImages,n,c,p,((se,ke,Ee)=>(ae||(ae=Ka(se)),ke.queryIntersectsFeature({queryGeometry:T,feature:se,featureState:Ee,geometry:ae,zoom:this.z,transform:t.transform,pixelsToTileUnits:b,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation}))))}return N}loadMatchingFeature(t,n,c,p,_,b,w,T,P,E,z){const F=this.bucketLayerIDs[n];if(b&&!F.some((H=>b.has(H))))return;const $=this.sourceLayerCoder.decode(c),N=this.vtLayers[$].feature(p);if(_.needGeometry){const H=fa(N,!0);if(!_.filter(new vr(this.tileID.overscaledZ),H,this.tileID.canonical))return}else if(!_.filter(new vr(this.tileID.overscaledZ),N))return;const q=this.getId(N,$);for(let H=0;H<F.length;H++){const Q=F[H];if(b&&!b.has(Q))continue;const me=T[Q];if(!me)continue;let ae={};q&&E&&(ae=E.getState(me.sourceLayer||"_geojsonTileLayer",q));const se=nr({},P[Q]);se.paint=vv(se.paint,me.paint,N,ae,w),se.layout=vv(se.layout,me.layout,N,ae,w);const ke=!z||z(N,me,ae);if(!ke)continue;const Ee=new yv(N,this.z,this.x,this.y,q);Ee.layer=se;let De=t[Q];De===void 0&&(De=t[Q]=[]),De.push({featureIndex:p,feature:Ee,intersectionZ:ke})}}lookupSymbolFeatures(t,n,c,p,_,b,w,T){const P={};this.loadVTLayers();const E=wo(_);for(const z of t)this.loadMatchingFeature(P,c,p,z,E,b,w,T,n);return P}hasLayer(t){for(const n of this.bucketLayerIDs)for(const c of n)if(t===c)return!0;return!1}getId(t,n){var c;let p=t.id;return this.promoteId&&(p=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof p=="boolean"&&(p=Number(p)),p===void 0&&(!((c=t.properties)===null||c===void 0)&&c.cluster)&&this.promoteId&&(p=Number(t.properties.cluster_id))),p}}function vv(a,t,n,c,p){return xi(a,((_,b)=>{const w=t instanceof kc?t.get(b):null;return w&&w.evaluate?w.evaluate(n,c,p):w}))}function FS(a,t){return t-a}function bv(a,t,n,c,p){const _=[];for(let b=0;b<a.length;b++){const w=a[b];let T;for(let P=0;P<w.length-1;P++){let E=w[P],z=w[P+1];E.x<t&&z.x<t||(E.x<t?E=new C(t,E.y+(t-E.x)/(z.x-E.x)*(z.y-E.y))._round():z.x<t&&(z=new C(t,E.y+(t-E.x)/(z.x-E.x)*(z.y-E.y))._round()),E.y<n&&z.y<n||(E.y<n?E=new C(E.x+(n-E.y)/(z.y-E.y)*(z.x-E.x),n)._round():z.y<n&&(z=new C(E.x+(n-E.y)/(z.y-E.y)*(z.x-E.x),n)._round()),E.x>=c&&z.x>=c||(E.x>=c?E=new C(c,E.y+(c-E.x)/(z.x-E.x)*(z.y-E.y))._round():z.x>=c&&(z=new C(c,E.y+(c-E.x)/(z.x-E.x)*(z.y-E.y))._round()),E.y>=p&&z.y>=p||(E.y>=p?E=new C(E.x+(p-E.y)/(z.y-E.y)*(z.x-E.x),p)._round():z.y>=p&&(z=new C(E.x+(p-E.y)/(z.y-E.y)*(z.x-E.x),p)._round()),T&&E.equals(T[T.length-1])||(T=[E],_.push(T)),T.push(z)))))}}return _}Ye("FeatureIndex",_v,{omit:["rawTileData","sourceLayerCoder"]});class ws extends C{constructor(t,n,c,p){super(t,n),this.angle=c,p!==void 0&&(this.segment=p)}clone(){return new ws(this.x,this.y,this.angle,this.segment)}}function xv(a,t,n,c,p){if(t.segment===void 0||n===0)return!0;let _=t,b=t.segment+1,w=0;for(;w>-n/2;){if(b--,b<0)return!1;w-=a[b].dist(_),_=a[b]}w+=a[b].dist(a[b+1]),b++;const T=[];let P=0;for(;w<n/2;){const E=a[b],z=a[b+1];if(!z)return!1;let F=a[b-1].angleTo(E)-E.angleTo(z);for(F=Math.abs((F+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:w,angleDelta:F}),P+=F;w-T[0].distance>c;)P-=T.shift().angleDelta;if(P>p)return!1;b++,w+=E.dist(z)}return!0}function wv(a){let t=0;for(let n=0;n<a.length-1;n++)t+=a[n].dist(a[n+1]);return t}function Tv(a,t,n){return a?.6*t*n:0}function Sv(a,t){return Math.max(a?a.right-a.left:0,t?t.right-t.left:0)}function jS(a,t,n,c,p,_){const b=Tv(n,p,_),w=Sv(n,c)*_;let T=0;const P=wv(a)/2;for(let E=0;E<a.length-1;E++){const z=a[E],F=a[E+1],$=z.dist(F);if(T+$>P){const N=(P-T)/$,q=Xn.number(z.x,F.x,N),H=Xn.number(z.y,F.y,N),Q=new ws(q,H,F.angleTo(z),E);return Q._round(),!b||xv(a,Q,w,b,t)?Q:void 0}T+=$}}function OS(a,t,n,c,p,_,b,w,T){const P=Tv(c,_,b),E=Sv(c,p),z=E*b,F=a[0].x===0||a[0].x===T||a[0].y===0||a[0].y===T;return t-z<t/4&&(t=z+t/4),kv(a,F?t/2*w%t:(E/2+2*_)*b*w%t,t,P,n,z,F,!1,T)}function kv(a,t,n,c,p,_,b,w,T){const P=_/2,E=wv(a);let z=0,F=t-n,$=[];for(let N=0;N<a.length-1;N++){const q=a[N],H=a[N+1],Q=q.dist(H),me=H.angleTo(q);for(;F+n<z+Q;){F+=n;const ae=(F-z)/Q,se=Xn.number(q.x,H.x,ae),ke=Xn.number(q.y,H.y,ae);if(se>=0&&se<T&&ke>=0&&ke<T&&F-P>=0&&F+P<=E){const Ee=new ws(se,ke,me,N);Ee._round(),c&&!xv(a,Ee,_,c,p)||$.push(Ee)}}z+=Q}return w||$.length||b||($=kv(a,z/2,n,c,p,_,b,!0,T)),$}function Cv(a,t,n,c){const p=[],_=a.image,b=_.pixelRatio,w=_.paddedRect.w-2,T=_.paddedRect.h-2;let P={x1:a.left,y1:a.top,x2:a.right,y2:a.bottom};const E=_.stretchX||[[0,w]],z=_.stretchY||[[0,T]],F=(ze,mt)=>ze+mt[1]-mt[0],$=E.reduce(F,0),N=z.reduce(F,0),q=w-$,H=T-N;let Q=0,me=$,ae=0,se=N,ke=0,Ee=q,De=0,Ze=H;if(_.content&&c){const ze=_.content,mt=ze[2]-ze[0],_t=ze[3]-ze[1];(_.textFitWidth||_.textFitHeight)&&(P=ev(a)),Q=Od(E,0,ze[0]),ae=Od(z,0,ze[1]),me=Od(E,ze[0],ze[2]),se=Od(z,ze[1],ze[3]),ke=ze[0]-Q,De=ze[1]-ae,Ee=mt-me,Ze=_t-se}const $e=P.x1,qe=P.y1,st=P.x2-$e,Ue=P.y2-qe,Ge=(ze,mt,_t,ut)=>{const nt=Bd(ze.stretch-Q,me,st,$e),Vt=$d(ze.fixed-ke,Ee,ze.stretch,$),Pr=Bd(mt.stretch-ae,se,Ue,qe),Qr=$d(mt.fixed-De,Ze,mt.stretch,N),Ci=Bd(_t.stretch-Q,me,st,$e),In=$d(_t.fixed-ke,Ee,_t.stretch,$),nn=Bd(ut.stretch-ae,se,Ue,qe),fi=$d(ut.fixed-De,Ze,ut.stretch,N),wr=new C(nt,Pr),oi=new C(Ci,Pr),mi=new C(Ci,nn),gi=new C(nt,nn),Xi=new C(Vt/b,Qr/b),zn=new C(In/b,fi/b),si=t*Math.PI/180;if(si){const li=Math.sin(si),ci=Math.cos(si),Gr=[ci,-li,li,ci];wr._matMult(Gr),oi._matMult(Gr),gi._matMult(Gr),mi._matMult(Gr)}const an=ze.stretch+ze.fixed,ei=mt.stretch+mt.fixed;return{tl:wr,tr:oi,bl:gi,br:mi,tex:{x:_.paddedRect.x+1+an,y:_.paddedRect.y+1+ei,w:_t.stretch+_t.fixed-an,h:ut.stretch+ut.fixed-ei},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Xi,pixelOffsetBR:zn,minFontScaleX:Ee/b/st,minFontScaleY:Ze/b/Ue,isSDF:n}};if(c&&(_.stretchX||_.stretchY)){const ze=Pv(E,q,$),mt=Pv(z,H,N);for(let _t=0;_t<ze.length-1;_t++){const ut=ze[_t],nt=ze[_t+1];for(let Vt=0;Vt<mt.length-1;Vt++)p.push(Ge(ut,mt[Vt],nt,mt[Vt+1]))}}else p.push(Ge({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:T+1}));return p}function Od(a,t,n){let c=0;for(const p of a)c+=Math.max(t,Math.min(n,p[1]))-Math.max(t,Math.min(n,p[0]));return c}function Pv(a,t,n){const c=[{fixed:-1,stretch:0}];for(const[p,_]of a){const b=c[c.length-1];c.push({fixed:p-b.stretch,stretch:b.stretch}),c.push({fixed:p-b.stretch,stretch:b.stretch+(_-p)})}return c.push({fixed:t+1,stretch:n}),c}function Bd(a,t,n,c){return a/t*n+c}function $d(a,t,n,c){return a-t*n/c}Ye("Anchor",ws);class Nd{constructor(t,n,c,p,_,b,w,T,P,E){var z;if(this.boxStartIndex=t.length,P){let F=b.top,$=b.bottom;const N=b.collisionPadding;N&&(F-=N[1],$+=N[3]);let q=$-F;q>0&&(q=Math.max(10,q),this.circleDiameter=q)}else{const F=!((z=b.image)===null||z===void 0)&&z.content&&(b.image.textFitWidth||b.image.textFitHeight)?ev(b):{x1:b.left,y1:b.top,x2:b.right,y2:b.bottom};F.y1=F.y1*w-T[0],F.y2=F.y2*w+T[2],F.x1=F.x1*w-T[3],F.x2=F.x2*w+T[1];const $=b.collisionPadding;if($&&(F.x1-=$[0]*w,F.y1-=$[1]*w,F.x2+=$[2]*w,F.y2+=$[3]*w),E){const N=new C(F.x1,F.y1),q=new C(F.x2,F.y1),H=new C(F.x1,F.y2),Q=new C(F.x2,F.y2),me=E*Math.PI/180;N._rotate(me),q._rotate(me),H._rotate(me),Q._rotate(me),F.x1=Math.min(N.x,q.x,H.x,Q.x),F.x2=Math.max(N.x,q.x,H.x,Q.x),F.y1=Math.min(N.y,q.y,H.y,Q.y),F.y2=Math.max(N.y,q.y,H.y,Q.y)}t.emplaceBack(n.x,n.y,F.x1,F.y1,F.x2,F.y2,c,p,_)}this.boxEndIndex=t.length}}class BS{constructor(t=[],n=(c,p)=>c<p?-1:c>p?1:0){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:c}=this,p=n[t];for(;t>0;){const _=t-1>>1,b=n[_];if(c(p,b)>=0)break;n[t]=b,t=_}n[t]=p}_down(t){const{data:n,compare:c}=this,p=this.length>>1,_=n[t];for(;t<p;){let b=1+(t<<1);const w=b+1;if(w<this.length&&c(n[w],n[b])<0&&(b=w),c(n[b],_)>=0)break;n[t]=n[b],t=b}n[t]=_}}function $S(a,t=1,n=!1){const c=hl.fromPoints(a[0]),p=Math.min(c.width(),c.height());let _=p/2;const b=new BS([],NS),{minX:w,minY:T,maxX:P,maxY:E}=c;if(p===0)return new C(w,T);for(let $=w;$<P;$+=p)for(let N=T;N<E;N+=p)b.push(new Uc($+_,N+_,_,a));let z=(function($){let N=0,q=0,H=0;const Q=$[0];for(let me=0,ae=Q.length,se=ae-1;me<ae;se=me++){const ke=Q[me],Ee=Q[se],De=ke.x*Ee.y-Ee.x*ke.y;q+=(ke.x+Ee.x)*De,H+=(ke.y+Ee.y)*De,N+=3*De}return new Uc(q/N,H/N,0,$)})(a),F=b.length;for(;b.length;){const $=b.pop();($.d>z.d||!z.d)&&(z=$,n&&console.log("found best %d after %d probes",Math.round(1e4*$.d)/1e4,F)),$.max-z.d<=t||(_=$.h/2,b.push(new Uc($.p.x-_,$.p.y-_,_,a)),b.push(new Uc($.p.x+_,$.p.y-_,_,a)),b.push(new Uc($.p.x-_,$.p.y+_,_,a)),b.push(new Uc($.p.x+_,$.p.y+_,_,a)),F+=4)}return n&&(console.log(`num probes: ${F}`),console.log(`best distance: ${z.d}`)),z.p}function NS(a,t){return t.max-a.max}function Uc(a,t,n,c){this.p=new C(a,t),this.h=n,this.d=(function(p,_){let b=!1,w=1/0;for(let T=0;T<_.length;T++){const P=_[T];for(let E=0,z=P.length,F=z-1;E<z;F=E++){const $=P[E],N=P[F];$.y>p.y!=N.y>p.y&&p.x<(N.x-$.x)*(p.y-$.y)/(N.y-$.y)+$.x&&(b=!b),w=Math.min(w,h_(p,$,N))}}return(b?1:-1)*Math.sqrt(w)})(this.p,c),this.max=this.d+this.h*Math.SQRT2}var ki;f.aE=void 0,(ki=f.aE||(f.aE={}))[ki.center=1]="center",ki[ki.left=2]="left",ki[ki.right=3]="right",ki[ki.top=4]="top",ki[ki.bottom=5]="bottom",ki[ki["top-left"]=6]="top-left",ki[ki["top-right"]=7]="top-right",ki[ki["bottom-left"]=8]="bottom-left",ki[ki["bottom-right"]=9]="bottom-right";const dg=Number.POSITIVE_INFINITY;function Mv(a,t){return t[1]!==dg?(function(n,c,p){let _=0,b=0;switch(c=Math.abs(c),p=Math.abs(p),n){case"top-right":case"top-left":case"top":b=p-7;break;case"bottom-right":case"bottom-left":case"bottom":b=7-p}switch(n){case"top-right":case"bottom-right":case"right":_=-c;break;case"top-left":case"bottom-left":case"left":_=c}return[_,b]})(a,t[0],t[1]):(function(n,c){let p=0,_=0;c<0&&(c=0);const b=c/Math.SQRT2;switch(n){case"top-right":case"top-left":_=b-7;break;case"bottom-right":case"bottom-left":_=7-b;break;case"bottom":_=7-c;break;case"top":_=c-7}switch(n){case"top-right":case"bottom-right":p=-b;break;case"top-left":case"bottom-left":p=b;break;case"left":p=c;break;case"right":p=-c}return[p,_]})(a,t[0])}function Av(a,t,n){var c;const p=a.layout,_=(c=p.get("text-variable-anchor-offset"))===null||c===void 0?void 0:c.evaluate(t,{},n);if(_){const w=_.values,T=[];for(let P=0;P<w.length;P+=2){const E=T[P]=w[P],z=w[P+1].map((F=>F*ai));E.startsWith("top")?z[1]-=7:E.startsWith("bottom")&&(z[1]+=7),T[P+1]=z}return new zi(T)}const b=p.get("text-variable-anchor");if(b){let w;w=a._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[p.get("text-radial-offset").evaluate(t,{},n)*ai,dg]:p.get("text-offset").evaluate(t,{},n).map((P=>P*ai));const T=[];for(const P of b)T.push(P,Mv(P,w));return new zi(T)}return null}function fg(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function US(a,t,n,c,p,_,b,w,T,P,E,z){let F=_.textMaxSize.evaluate(t,{});F===void 0&&(F=b);const $=a.layers[0].layout,N=$.get("icon-offset").evaluate(t,{},E),q=Iv(n.horizontal),H=b/24,Q=a.tilePixelRatio*H,me=a.tilePixelRatio*F/24,ae=a.tilePixelRatio*w,se=a.tilePixelRatio*$.get("symbol-spacing"),ke=$.get("text-padding")*a.tilePixelRatio,Ee=(function(_t,ut,nt,Vt=1){const Pr=_t.get("icon-padding").evaluate(ut,{},nt),Qr=Pr&&Pr.values;return[Qr[0]*Vt,Qr[1]*Vt,Qr[2]*Vt,Qr[3]*Vt]})($,t,E,a.tilePixelRatio),De=$.get("text-max-angle")/180*Math.PI,Ze=$.get("text-rotation-alignment")!=="viewport"&&$.get("symbol-placement")!=="point",$e=$.get("icon-rotation-alignment")==="map"&&$.get("symbol-placement")!=="point",qe=$.get("symbol-placement"),st=se/2,Ue=$.get("icon-text-fit");let Ge;c&&Ue!=="none"&&(a.allowVerticalPlacement&&n.vertical&&(Ge=tv(c,n.vertical,Ue,$.get("icon-text-fit-padding"),N,H)),q&&(c=tv(c,q,Ue,$.get("icon-text-fit-padding"),N,H)));const ze=E?z.line.getGranularityForZoomLevel(E.z):1,mt=(_t,ut)=>{ut.x<0||ut.x>=At||ut.y<0||ut.y>=At||(function(nt,Vt,Pr,Qr,Ci,In,nn,fi,wr,oi,mi,gi,Xi,zn,si,an,ei,li,ci,Gr,_r,ma,Vc,ga,GS){const qc=nt.addToLineVertexArray(Vt,Pr);let pl,Gc,Zc,Wc,Dv=0,Fv=0,jv=0,Ov=0,wg=-1,Tg=-1;const Io={};let Bv=ys("");if(nt.allowVerticalPlacement&&Qr.vertical){const Fi=fi.layout.get("text-rotate").evaluate(_r,{},ga)+90;Zc=new Nd(wr,Vt,oi,mi,gi,Qr.vertical,Xi,zn,si,Fi),nn&&(Wc=new Nd(wr,Vt,oi,mi,gi,nn,ei,li,si,Fi))}if(Ci){const Fi=fi.layout.get("icon-rotate").evaluate(_r,{}),Rn=fi.layout.get("icon-text-fit")!=="none",dl=Cv(Ci,Fi,Vc,Rn),_a=nn?Cv(nn,Fi,Vc,Rn):void 0;Gc=new Nd(wr,Vt,oi,mi,gi,Ci,ei,li,!1,Fi),Dv=4*dl.length;const fl=nt.iconSizeData;let Ya=null;fl.kind==="source"?(Ya=[Eo*fi.layout.get("icon-size").evaluate(_r,{})],Ya[0]>bs&&ar(`${nt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):fl.kind==="composite"&&(Ya=[Eo*ma.compositeIconSizes[0].evaluate(_r,{},ga),Eo*ma.compositeIconSizes[1].evaluate(_r,{},ga)],(Ya[0]>bs||Ya[1]>bs)&&ar(`${nt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),nt.addSymbols(nt.icon,dl,Ya,Gr,ci,_r,f.ao.none,Vt,qc.lineStartIndex,qc.lineLength,-1,ga),wg=nt.icon.placedSymbolArray.length-1,_a&&(Fv=4*_a.length,nt.addSymbols(nt.icon,_a,Ya,Gr,ci,_r,f.ao.vertical,Vt,qc.lineStartIndex,qc.lineLength,-1,ga),Tg=nt.icon.placedSymbolArray.length-1)}const $v=Object.keys(Qr.horizontal);for(const Fi of $v){const Rn=Qr.horizontal[Fi];if(!pl){Bv=ys(Rn.text);const _a=fi.layout.get("text-rotate").evaluate(_r,{},ga);pl=new Nd(wr,Vt,oi,mi,gi,Rn,Xi,zn,si,_a)}const dl=Rn.positionedLines.length===1;if(jv+=Ev(nt,Vt,Rn,In,fi,si,_r,an,qc,Qr.vertical?f.ao.horizontal:f.ao.horizontalOnly,dl?$v:[Fi],Io,wg,ma,ga),dl)break}Qr.vertical&&(Ov+=Ev(nt,Vt,Qr.vertical,In,fi,si,_r,an,qc,f.ao.vertical,["vertical"],Io,Tg,ma,ga));const ZS=pl?pl.boxStartIndex:nt.collisionBoxArray.length,WS=pl?pl.boxEndIndex:nt.collisionBoxArray.length,HS=Zc?Zc.boxStartIndex:nt.collisionBoxArray.length,XS=Zc?Zc.boxEndIndex:nt.collisionBoxArray.length,KS=Gc?Gc.boxStartIndex:nt.collisionBoxArray.length,YS=Gc?Gc.boxEndIndex:nt.collisionBoxArray.length,JS=Wc?Wc.boxStartIndex:nt.collisionBoxArray.length,QS=Wc?Wc.boxEndIndex:nt.collisionBoxArray.length;let ya=-1;const Vd=(Fi,Rn)=>Fi&&Fi.circleDiameter?Math.max(Fi.circleDiameter,Rn):Rn;ya=Vd(pl,ya),ya=Vd(Zc,ya),ya=Vd(Gc,ya),ya=Vd(Wc,ya);const Nv=ya>-1?1:0;Nv&&(ya*=GS/ai),nt.glyphOffsetArray.length>=$c.MAX_GLYPHS&&ar("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),_r.sortKey!==void 0&&nt.addToSortKeyRanges(nt.symbolInstances.length,_r.sortKey);const ek=Av(fi,_r,ga),[tk,rk]=(function(Fi,Rn){const dl=Fi.length,_a=Rn?.values;if(_a?.length>0)for(let fl=0;fl<_a.length;fl+=2){const Ya=_a[fl+1];Fi.emplaceBack(f.aE[_a[fl]],Ya[0],Ya[1])}return[dl,Fi.length]})(nt.textAnchorOffsets,ek);nt.symbolInstances.emplaceBack(Vt.x,Vt.y,Io.right>=0?Io.right:-1,Io.center>=0?Io.center:-1,Io.left>=0?Io.left:-1,Io.vertical||-1,wg,Tg,Bv,ZS,WS,HS,XS,KS,YS,JS,QS,oi,jv,Ov,Dv,Fv,Nv,0,Xi,ya,tk,rk)})(a,ut,_t,n,c,p,Ge,a.layers[0],a.collisionBoxArray,t.index,t.sourceLayerIndex,a.index,Q,[ke,ke,ke,ke],Ze,T,ae,Ee,$e,N,t,_,P,E,b)};if(qe==="line")for(const _t of bv(t.geometry,0,0,At,At)){const ut=ul(_t,ze),nt=OS(ut,se,De,n.vertical||q,c,24,me,a.overscaling,At);for(const Vt of nt)q&&VS(a,q.text,st,Vt)||mt(ut,Vt)}else if(qe==="line-center"){for(const _t of t.geometry)if(_t.length>1){const ut=ul(_t,ze),nt=jS(ut,De,n.vertical||q,c,24,me);nt&&mt(ut,nt)}}else if(t.type==="Polygon")for(const _t of Ws(t.geometry,0)){const ut=$S(_t,16);mt(ul(_t[0],ze,!0),new ws(ut.x,ut.y,0))}else if(t.type==="LineString")for(const _t of t.geometry){const ut=ul(_t,ze);mt(ut,new ws(ut[0].x,ut[0].y,0))}else if(t.type==="Point")for(const _t of t.geometry)for(const ut of _t)mt([ut],new ws(ut.x,ut.y,0))}function Ev(a,t,n,c,p,_,b,w,T,P,E,z,F,$,N){const q=(function(me,ae,se,ke,Ee,De,Ze,$e){const qe=ke.layout.get("text-rotate").evaluate(De,{})*Math.PI/180,st=[];for(const Ue of ae.positionedLines)for(const Ge of Ue.positionedGlyphs){if(!Ge.rect)continue;const ze=Ge.rect||{};let mt=4,_t=!0,ut=1,nt=0;const Vt=(Ee||$e)&&Ge.vertical,Pr=Ge.metrics.advance*Ge.scale/2;if($e&&ae.verticalizable&&(nt=Ue.lineOffset/2-(Ge.imageName?-(ai-Ge.metrics.width*Ge.scale)/2:(Ge.scale-1)*ai)),Ge.imageName){const li=Ze[Ge.imageName];_t=li.sdf,ut=li.pixelRatio,mt=1/ut}const Qr=Ee?[Ge.x+Pr,Ge.y]:[0,0];let Ci=Ee?[0,0]:[Ge.x+Pr+se[0],Ge.y+se[1]-nt],In=[0,0];Vt&&(In=Ci,Ci=[0,0]);const nn=Ge.metrics.isDoubleResolution?2:1,fi=(Ge.metrics.left-mt)*Ge.scale-Pr+Ci[0],wr=(-Ge.metrics.top-mt)*Ge.scale+Ci[1],oi=fi+ze.w/nn*Ge.scale/ut,mi=wr+ze.h/nn*Ge.scale/ut,gi=new C(fi,wr),Xi=new C(oi,wr),zn=new C(fi,mi),si=new C(oi,mi);if(Vt){const li=new C(-Pr,Pr- -17),ci=-Math.PI/2,Gr=12-Pr,_r=new C(22-Gr,-(Ge.imageName?Gr:0)),ma=new C(...In);gi._rotateAround(ci,li)._add(_r)._add(ma),Xi._rotateAround(ci,li)._add(_r)._add(ma),zn._rotateAround(ci,li)._add(_r)._add(ma),si._rotateAround(ci,li)._add(_r)._add(ma)}if(qe){const li=Math.sin(qe),ci=Math.cos(qe),Gr=[ci,-li,li,ci];gi._matMult(Gr),Xi._matMult(Gr),zn._matMult(Gr),si._matMult(Gr)}const an=new C(0,0),ei=new C(0,0);st.push({tl:gi,tr:Xi,bl:zn,br:si,tex:ze,writingMode:ae.writingMode,glyphOffset:Qr,sectionIndex:Ge.sectionIndex,isSDF:_t,pixelOffsetTL:an,pixelOffsetBR:ei,minFontScaleX:0,minFontScaleY:0})}return st})(0,n,w,p,_,b,c,a.allowVerticalPlacement),H=a.textSizeData;let Q=null;H.kind==="source"?(Q=[Eo*p.layout.get("text-size").evaluate(b,{})],Q[0]>bs&&ar(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):H.kind==="composite"&&(Q=[Eo*$.compositeTextSizes[0].evaluate(b,{},N),Eo*$.compositeTextSizes[1].evaluate(b,{},N)],(Q[0]>bs||Q[1]>bs)&&ar(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,q,Q,w,_,b,P,t,T.lineStartIndex,T.lineLength,F,N);for(const me of E)z[me]=a.text.placedSymbolArray.length-1;return 4*q.length}function Iv(a){for(const t in a)return a[t];return null}function VS(a,t,n,c){const p=a.compareText;if(t in p){const _=p[t];for(let b=_.length-1;b>=0;b--)if(c.dist(_[b])<n)return!0}else p[t]=[];return p[t].push(c),!1}const zv=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class mg{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,c]=new Uint8Array(t,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const p=c>>4;if(p!==1)throw new Error(`Got v${p} data when expected v1.`);const _=zv[15&c];if(!_)throw new Error("Unrecognized array type.");const[b]=new Uint16Array(t,2,1),[w]=new Uint32Array(t,4,1);return new mg(w,b,_,t)}constructor(t,n=64,c=Float64Array,p){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=c,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const _=zv.indexOf(this.ArrayType),b=2*t*this.ArrayType.BYTES_PER_ELEMENT,w=t*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-w%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${c}.`);p&&p instanceof ArrayBuffer?(this.data=p,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+w+T,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+b+w+T),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+w+T,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=t,this.coords[this._pos++]=n,c}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return gg(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,c,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:b,nodeSize:w}=this,T=[0,_.length-1,0],P=[];for(;T.length;){const E=T.pop()||0,z=T.pop()||0,F=T.pop()||0;if(z-F<=w){for(let H=F;H<=z;H++){const Q=b[2*H],me=b[2*H+1];Q>=t&&Q<=c&&me>=n&&me<=p&&P.push(_[H])}continue}const $=F+z>>1,N=b[2*$],q=b[2*$+1];N>=t&&N<=c&&q>=n&&q<=p&&P.push(_[$]),(E===0?t<=N:n<=q)&&(T.push(F),T.push($-1),T.push(1-E)),(E===0?c>=N:p>=q)&&(T.push($+1),T.push(z),T.push(1-E))}return P}within(t,n,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:_,nodeSize:b}=this,w=[0,p.length-1,0],T=[],P=c*c;for(;w.length;){const E=w.pop()||0,z=w.pop()||0,F=w.pop()||0;if(z-F<=b){for(let H=F;H<=z;H++)Lv(_[2*H],_[2*H+1],t,n)<=P&&T.push(p[H]);continue}const $=F+z>>1,N=_[2*$],q=_[2*$+1];Lv(N,q,t,n)<=P&&T.push(p[$]),(E===0?t-c<=N:n-c<=q)&&(w.push(F),w.push($-1),w.push(1-E)),(E===0?t+c>=N:n+c>=q)&&(w.push($+1),w.push(z),w.push(1-E))}return T}}function gg(a,t,n,c,p,_){if(p-c<=n)return;const b=c+p>>1;Rv(a,t,b,c,p,_),gg(a,t,n,c,b-1,1-_),gg(a,t,n,b+1,p,1-_)}function Rv(a,t,n,c,p,_){for(;p>c;){if(p-c>600){const P=p-c+1,E=n-c+1,z=Math.log(P),F=.5*Math.exp(2*z/3),$=.5*Math.sqrt(z*F*(P-F)/P)*(E-P/2<0?-1:1);Rv(a,t,n,Math.max(c,Math.floor(n-E*F/P+$)),Math.min(p,Math.floor(n+(P-E)*F/P+$)),_)}const b=t[2*n+_];let w=c,T=p;for(Bh(a,t,c,n),t[2*p+_]>b&&Bh(a,t,c,p);w<T;){for(Bh(a,t,w,T),w++,T--;t[2*w+_]<b;)w++;for(;t[2*T+_]>b;)T--}t[2*c+_]===b?Bh(a,t,c,T):(T++,Bh(a,t,T,p)),T<=n&&(c=T+1),n<=T&&(p=T-1)}}function Bh(a,t,n,c){yg(a,n,c),yg(t,2*n,2*c),yg(t,2*n+1,2*c+1)}function yg(a,t,n){const c=a[t];a[t]=a[n],a[n]=c}function Lv(a,t,n,c){const p=a-n,_=t-c;return p*p+_*_}var _g;f.cx=void 0,(_g=f.cx||(f.cx={})).create="create",_g.load="load",_g.fullLoad="fullLoad";let Ud=null,$h=[];const vg=1e3/60,bg="loadTime",xg="fullLoadTime",qS={mark(a){performance.mark(a)},frame(a){const t=a;Ud!=null&&$h.push(t-Ud),Ud=t},clearMetrics(){Ud=null,$h=[],performance.clearMeasures(bg),performance.clearMeasures(xg);for(const a in f.cx)performance.clearMarks(f.cx[a])},getPerformanceMetrics(){performance.measure(bg,f.cx.create,f.cx.load),performance.measure(xg,f.cx.create,f.cx.fullLoad);const a=performance.getEntriesByName(bg)[0].duration,t=performance.getEntriesByName(xg)[0].duration,n=$h.length,c=1/($h.reduce(((_,b)=>_+b),0)/n/1e3),p=$h.filter((_=>_>vg)).reduce(((_,b)=>_+(b-vg)/vg),0);return{loadTime:a,fullLoadTime:t,fps:c,percentDroppedFrames:p/(n+p)*100,totalFrames:n}}};f.$=At,f.A=de,f.B=function([a,t,n]){return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:a*Math.cos(t)*Math.sin(n),y:a*Math.sin(t)*Math.sin(n),z:a*Math.cos(n)}},f.C=Xn,f.D=ot,f.E=at,f.F=vr,f.G=il,f.H=function(a){if(so==null){const t=a.navigator?a.navigator.userAgent:null;so=!!a.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return so},f.I=rg,f.J=class{constructor(a,t){this.target=a,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new LS((()=>this.process())),this.subscription=Ra(this.target,"message",(n=>this.receive(n)),!1),this.globalScope=qi(self)?a:window}registerMessageHandler(a,t){this.messageHandlers[a]=t}sendAsync(a,t){return new Promise(((n,c)=>{const p=Math.round(1e18*Math.random()).toString(36).substring(0,10),_=t?Ra(t.signal,"abort",(()=>{_?.unsubscribe(),delete this.resolveRejects[p];const T={id:p,type:"<cancel>",origin:location.origin,targetMapId:a.targetMapId,sourceMapId:this.mapId};this.target.postMessage(T)}),DS):null;this.resolveRejects[p]={resolve:T=>{_?.unsubscribe(),n(T)},reject:T=>{_?.unsubscribe(),c(T)}};const b=[],w=Object.assign(Object.assign({},a),{id:p,sourceMapId:this.mapId,origin:location.origin,data:hs(a.data,b)});this.target.postMessage(w,{transfer:b})}))}receive(a){const t=a.data,n=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[n];const c=this.abortControllers[n];return delete this.abortControllers[n],void(c&&c.abort())}if(qi(self)||t.mustQueue)return this.tasks[n]=t,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,t)}}process(){if(this.taskQueue.length===0)return;const a=this.taskQueue.shift(),t=this.tasks[a];delete this.tasks[a],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(a,t)}processTask(a,t){return l(this,void 0,void 0,(function*(){if(t.type==="<response>"){const p=this.resolveRejects[a];return delete this.resolveRejects[a],p?void(t.error?p.reject(ko(t.error)):p.resolve(ko(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(a,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=ko(t.data),c=new AbortController;this.abortControllers[a]=c;try{const p=yield this.messageHandlers[t.type](t.sourceMapId,n,c);this.completeTask(a,null,p)}catch(p){this.completeTask(a,p)}}))}completeTask(a,t,n){const c=[];delete this.abortControllers[a];const p={id:a,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?hs(t):null,data:hs(n,c)};this.target.postMessage(p,{transfer:c})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},f.K=W,f.L=function(){var a=new de(16);return de!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},f.M=function(a,t,n){var c,p,_,b,w,T,P,E,z,F,$,N,q=n[0],H=n[1],Q=n[2];return t===a?(a[12]=t[0]*q+t[4]*H+t[8]*Q+t[12],a[13]=t[1]*q+t[5]*H+t[9]*Q+t[13],a[14]=t[2]*q+t[6]*H+t[10]*Q+t[14],a[15]=t[3]*q+t[7]*H+t[11]*Q+t[15]):(p=t[1],_=t[2],b=t[3],w=t[4],T=t[5],P=t[6],E=t[7],z=t[8],F=t[9],$=t[10],N=t[11],a[0]=c=t[0],a[1]=p,a[2]=_,a[3]=b,a[4]=w,a[5]=T,a[6]=P,a[7]=E,a[8]=z,a[9]=F,a[10]=$,a[11]=N,a[12]=c*q+w*H+z*Q+t[12],a[13]=p*q+T*H+F*Q+t[13],a[14]=_*q+P*H+$*Q+t[14],a[15]=b*q+E*H+N*Q+t[15]),a},f.N=function(a,t,n){var c=n[0],p=n[1],_=n[2];return a[0]=t[0]*c,a[1]=t[1]*c,a[2]=t[2]*c,a[3]=t[3]*c,a[4]=t[4]*p,a[5]=t[5]*p,a[6]=t[6]*p,a[7]=t[7]*p,a[8]=t[8]*_,a[9]=t[9]*_,a[10]=t[10]*_,a[11]=t[11]*_,a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a},f.O=function(a,t,n){var c=t[0],p=t[1],_=t[2],b=t[3],w=t[4],T=t[5],P=t[6],E=t[7],z=t[8],F=t[9],$=t[10],N=t[11],q=t[12],H=t[13],Q=t[14],me=t[15],ae=n[0],se=n[1],ke=n[2],Ee=n[3];return a[0]=ae*c+se*w+ke*z+Ee*q,a[1]=ae*p+se*T+ke*F+Ee*H,a[2]=ae*_+se*P+ke*$+Ee*Q,a[3]=ae*b+se*E+ke*N+Ee*me,a[4]=(ae=n[4])*c+(se=n[5])*w+(ke=n[6])*z+(Ee=n[7])*q,a[5]=ae*p+se*T+ke*F+Ee*H,a[6]=ae*_+se*P+ke*$+Ee*Q,a[7]=ae*b+se*E+ke*N+Ee*me,a[8]=(ae=n[8])*c+(se=n[9])*w+(ke=n[10])*z+(Ee=n[11])*q,a[9]=ae*p+se*T+ke*F+Ee*H,a[10]=ae*_+se*P+ke*$+Ee*Q,a[11]=ae*b+se*E+ke*N+Ee*me,a[12]=(ae=n[12])*c+(se=n[13])*w+(ke=n[14])*z+(Ee=n[15])*q,a[13]=ae*p+se*T+ke*F+Ee*H,a[14]=ae*_+se*P+ke*$+Ee*Q,a[15]=ae*b+se*E+ke*N+Ee*me,a},f.P=C,f.Q=function(a,t){const n={};for(let c=0;c<t.length;c++){const p=t[c];p in a&&(n[p]=a[p])}return n},f.R=rn,f.S=xs,f.T=Gm,f.U=hv,f.V=uv,f.W=we,f.X=pe,f.Y=Zo,f.Z=En,f._=l,f.a=V,f.a$=er,f.a0=function(a,t){var n,c,p,_;if(!a)return t??{};if(!t)return a;const b=Object.assign({},a);if(t.removeAll&&(b.removeAll=!0),t.remove){const w=new Set(b.remove?b.remove.concat(t.remove):t.remove);b.remove=Array.from(w.values())}if(t.add){const w=b.add?b.add.concat(t.add):t.add,T=new Map(w.map((P=>[P.id,P])));b.add=Array.from(T.values())}if(t.update){const w=new Map((n=b.update)===null||n===void 0?void 0:n.map((T=>[T.id,T])));for(const T of t.update){const P=(c=w.get(T.id))!==null&&c!==void 0?c:{id:T.id};T.newGeometry&&(P.newGeometry=T.newGeometry),T.addOrUpdateProperties&&(P.addOrUpdateProperties=((p=P.addOrUpdateProperties)!==null&&p!==void 0?p:[]).concat(T.addOrUpdateProperties)),T.removeProperties&&(P.removeProperties=((_=P.removeProperties)!==null&&_!==void 0?_:[]).concat(T.removeProperties)),T.removeAllProperties&&(P.removeAllProperties=!0),w.set(T.id,P)}b.update=Array.from(w.values())}return b},f.a1=jh,f.a2=hl,f.a3=25,f.a4=pg,f.a5=a=>{const t=window.document.createElement("video");return t.muted=!0,new Promise((n=>{t.onloadstart=()=>{n(t)};for(const c of a){const p=window.document.createElement("source");Ce(c)||(t.crossOrigin="Anonymous"),p.src=c,t.appendChild(p)}}))},f.a6=Be,f.a7=function(){return Mr++},f.a8=L,f.a9=$c,f.aA=function(a){let t=1/0,n=1/0,c=-1/0,p=-1/0;for(const _ of a)t=Math.min(t,_.x),n=Math.min(n,_.y),c=Math.max(c,_.x),p=Math.max(p,_.y);return[t,n,c,p]},f.aB=ai,f.aC=Qe,f.aD=function(a,t,n,c,p=!1){if(!n[0]&&!n[1])return[0,0];const _=p?c==="map"?-a.bearingInRadians:0:c==="viewport"?a.bearingInRadians:0;if(_){const b=Math.sin(_),w=Math.cos(_);n=[n[0]*w-n[1]*b,n[0]*b+n[1]*w]}return[p?n[0]:Qe(t,n[0],a.zoom),p?n[1]:Qe(t,n[1],a.zoom)]},f.aF=ag,f.aG=fg,f.aH=ng,f.aI=mg,f.aJ=Ir,f.aK=zd,f.aL=re,f.aM=kt,f.aN=lr,f.aO=br,f.aP=La,f.aQ=dv,f.aR=et,f.aS=rt,f.aT=function(a){var t=new de(3);return t[0]=a[0],t[1]=a[1],t[2]=a[2],t},f.aU=function(a,t,n){return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],a},f.aV=function(a,t){var n=t[0],c=t[1],p=t[2],_=n*n+c*c+p*p;return _>0&&(_=1/Math.sqrt(_)),a[0]=t[0]*_,a[1]=t[1]*_,a[2]=t[2]*_,a},f.aW=It,f.aX=function(a,t){return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]},f.aY=function(a,t,n){return a[0]=t[0]*n[0],a[1]=t[1]*n[1],a[2]=t[2]*n[2],a[3]=t[3]*n[3],a},f.aZ=Fe,f.a_=function(a,t,n){const c=t[0]*n[0]+t[1]*n[1]+t[2]*n[2];return c===0?null:(-(a[0]*n[0]+a[1]*n[1]+a[2]*n[2])-n[3])/c},f.aa=wo,f.ab=fa,f.ac=yv,f.ad=function(a){const t={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((n,c,p,_)=>{const b=p||_;return t[c]=!b||b.toLowerCase(),""})),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t},f.ae=lo,f.af=function(a){return Math.pow(2,a)},f.ag=fe,f.ah=Et,f.ai=85.051129,f.aj=pv,f.ak=function(a){return Math.log(a)/Math.LN2},f.al=function(a){var t=a[0],n=a[1];return t*t+n*n},f.am=function(a,t){const n=[];for(const c in a)c in t||n.push(c);return n},f.an=function(a,t){let n=0,c=0;if(a.kind==="constant")c=a.layoutSize;else if(a.kind!=="source"){const{interpolationType:p,minZoom:_,maxZoom:b}=a,w=p?Et(di.interpolationFactor(p,t,_,b),0,1):0;a.kind==="camera"?c=Xn.number(a.minSize,a.maxSize,w):n=w}return{uSizeT:n,uSize:c}},f.ap=function(a,{uSize:t,uSizeT:n},{lowerSize:c,upperSize:p}){return a.kind==="source"?c/Eo:a.kind==="composite"?Xn.number(c/Eo,p/Eo,n):t},f.aq=function(a,t){var n=t[0],c=t[1],p=t[2],_=t[3],b=t[4],w=t[5],T=t[6],P=t[7],E=t[8],z=t[9],F=t[10],$=t[11],N=t[12],q=t[13],H=t[14],Q=t[15],me=n*w-c*b,ae=n*T-p*b,se=n*P-_*b,ke=c*T-p*w,Ee=c*P-_*w,De=p*P-_*T,Ze=E*q-z*N,$e=E*H-F*N,qe=E*Q-$*N,st=z*H-F*q,Ue=z*Q-$*q,Ge=F*Q-$*H,ze=me*Ge-ae*Ue+se*st+ke*qe-Ee*$e+De*Ze;return ze?(a[0]=(w*Ge-T*Ue+P*st)*(ze=1/ze),a[1]=(p*Ue-c*Ge-_*st)*ze,a[2]=(q*De-H*Ee+Q*ke)*ze,a[3]=(F*Ee-z*De-$*ke)*ze,a[4]=(T*qe-b*Ge-P*$e)*ze,a[5]=(n*Ge-p*qe+_*$e)*ze,a[6]=(H*se-N*De-Q*ae)*ze,a[7]=(E*De-F*se+$*ae)*ze,a[8]=(b*Ue-w*qe+P*Ze)*ze,a[9]=(c*qe-n*Ue-_*Ze)*ze,a[10]=(N*Ee-q*se+Q*me)*ze,a[11]=(z*se-E*Ee-$*me)*ze,a[12]=(w*$e-b*st-T*Ze)*ze,a[13]=(n*st-c*$e+p*Ze)*ze,a[14]=(q*ae-N*ke-H*me)*ze,a[15]=(E*ke-z*ae+F*me)*ze,a):null},f.ar=bi,f.as=function(a){return Math.hypot(a[0],a[1])},f.at=function(a){return a[0]=0,a[1]=0,a},f.au=function(a,t,n){return a[0]=t[0]*n,a[1]=t[1]*n,a},f.av=og,f.aw=dr,f.ax=function(a,t,n,c){const p=t.y-a.y,_=t.x-a.x,b=c.y-n.y,w=c.x-n.x,T=b*_-w*p;if(T===0)return null;const P=(w*(a.y-n.y)-b*(a.x-n.x))/T;return new C(a.x+P*_,a.y+P*p)},f.ay=bv,f.az=c_,f.b=qn,f.b$=class extends g{},f.b0=function(a,t,n){return a[0]=t[0]*n,a[1]=t[1]*n,a[2]=t[2]*n,a[3]=t[3]*n,a},f.b1=function(a,t){return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]+a[3]},f.b2=mv,f.b3=Nc,f.b4=function(a,t,n,c,p){var _,b=1/Math.tan(t/2);return a[0]=b/n,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=b,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,p!=null&&p!==1/0?(a[10]=(p+c)*(_=1/(c-p)),a[14]=2*p*c*_):(a[10]=-1,a[14]=-2*c),a},f.b5=function(a){var t=new de(16);return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},f.b6=function(a,t,n){var c=Math.sin(n),p=Math.cos(n),_=t[0],b=t[1],w=t[2],T=t[3],P=t[4],E=t[5],z=t[6],F=t[7];return t!==a&&(a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[0]=_*p+P*c,a[1]=b*p+E*c,a[2]=w*p+z*c,a[3]=T*p+F*c,a[4]=P*p-_*c,a[5]=E*p-b*c,a[6]=z*p-w*c,a[7]=F*p-T*c,a},f.b7=function(a,t,n){var c=Math.sin(n),p=Math.cos(n),_=t[4],b=t[5],w=t[6],T=t[7],P=t[8],E=t[9],z=t[10],F=t[11];return t!==a&&(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[4]=_*p+P*c,a[5]=b*p+E*c,a[6]=w*p+z*c,a[7]=T*p+F*c,a[8]=P*p-_*c,a[9]=E*p-b*c,a[10]=z*p-w*c,a[11]=F*p-T*c,a},f.b8=function(){const a=new Float32Array(16);return fe(a),a},f.b9=function(){const a=new Float64Array(16);return fe(a),a},f.bA=function(a,t){const n=lt(a,360),c=lt(t,360),p=c-n,_=c>n?p-360:p+360;return Math.abs(p)<Math.abs(_)?p:_},f.bB=function(a){return a[0]=0,a[1]=0,a[2]=0,a},f.bC=function(a,t,n,c){const p=Math.sqrt(a*a+t*t),_=Math.sqrt(n*n+c*c);a/=p,t/=p,n/=_,c/=_;const b=Math.acos(a*n+t*c);return-t*n+a*c>0?b:-b},f.bD=function(a,t){const n=lt(a,2*Math.PI),c=lt(t,2*Math.PI);return Math.min(Math.abs(n-c),Math.abs(n-c+2*Math.PI),Math.abs(n-c-2*Math.PI))},f.bE=function(){const a={},t=be.$version;for(const n in be.$root){const c=be.$root[n];if(c.required){let p=null;p=n==="version"?t:c.type==="array"?[]:{},p!=null&&(a[n]=p)}}return a},f.bF=wc,f.bG=ue,f.bH=function a(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(let c=0;c<t.length;c++)if(!a(t[c],n[c]))return!1;return!0}if(typeof t=="object"&&t!==null&&n!==null){if(typeof n!="object"||Object.keys(t).length!==Object.keys(n).length)return!1;for(const c in t)if(!a(t[c],n[c]))return!1;return!0}return t===n},f.bI=function(a){a=a.slice();const t=Object.create(null);for(let n=0;n<a.length;n++)t[a[n].id]=a[n];for(let n=0;n<a.length;n++)"ref"in a[n]&&(a[n]=zt(a[n],t[a[n].ref]));return a},f.bJ=function(a){if(a.type==="custom")return new RS(a);switch(a.type){case"background":return new ES(a);case"circle":return new mT(a);case"color-relief":return new xT(a);case"fill":return new FT(a);case"fill-extrusion":return new WT(a);case"heatmap":return new yT(a);case"hillshade":return new vT(a);case"line":return new eS(a);case"raster":return new zS(a);case"symbol":return new jd(a)}},f.bK=gr,f.bL=function(a,t){if(!a)return[{command:"setStyle",args:[t]}];let n=[];try{if(!ct(a.version,t.version))return[{command:"setStyle",args:[t]}];ct(a.center,t.center)||n.push({command:"setCenter",args:[t.center]}),ct(a.state,t.state)||n.push({command:"setGlobalState",args:[t.state]}),ct(a.centerAltitude,t.centerAltitude)||n.push({command:"setCenterAltitude",args:[t.centerAltitude]}),ct(a.zoom,t.zoom)||n.push({command:"setZoom",args:[t.zoom]}),ct(a.bearing,t.bearing)||n.push({command:"setBearing",args:[t.bearing]}),ct(a.pitch,t.pitch)||n.push({command:"setPitch",args:[t.pitch]}),ct(a.roll,t.roll)||n.push({command:"setRoll",args:[t.roll]}),ct(a.sprite,t.sprite)||n.push({command:"setSprite",args:[t.sprite]}),ct(a.glyphs,t.glyphs)||n.push({command:"setGlyphs",args:[t.glyphs]}),ct(a.transition,t.transition)||n.push({command:"setTransition",args:[t.transition]}),ct(a.light,t.light)||n.push({command:"setLight",args:[t.light]}),ct(a.terrain,t.terrain)||n.push({command:"setTerrain",args:[t.terrain]}),ct(a.sky,t.sky)||n.push({command:"setSky",args:[t.sky]}),ct(a.projection,t.projection)||n.push({command:"setProjection",args:[t.projection]});const c={},p=[];(function(b,w,T,P){let E;for(E in w=w||{},b=b||{})Object.prototype.hasOwnProperty.call(b,E)&&(Object.prototype.hasOwnProperty.call(w,E)||Xr(E,T,P));for(E in w)Object.prototype.hasOwnProperty.call(w,E)&&(Object.prototype.hasOwnProperty.call(b,E)?ct(b[E],w[E])||(b[E].type==="geojson"&&w[E].type==="geojson"&&Dr(b,w,E)?St(T,{command:"setGeoJSONSourceData",args:[E,w[E].data]}):Kr(E,w,T,P)):mr(E,w,T))})(a.sources,t.sources,p,c);const _=[];a.layers&&a.layers.forEach((b=>{"source"in b&&c[b.source]?n.push({command:"removeLayer",args:[b.id]}):_.push(b)})),n=n.concat(p),(function(b,w,T){w=w||[];const P=(b=b||[]).map(Zt),E=w.map(Zt),z=b.reduce($r,{}),F=w.reduce($r,{}),$=P.slice(),N=Object.create(null);let q,H,Q,me,ae;for(let se=0,ke=0;se<P.length;se++)q=P[se],Object.prototype.hasOwnProperty.call(F,q)?ke++:(St(T,{command:"removeLayer",args:[q]}),$.splice($.indexOf(q,ke),1));for(let se=0,ke=0;se<E.length;se++)q=E[E.length-1-se],$[$.length-1-se]!==q&&(Object.prototype.hasOwnProperty.call(z,q)?(St(T,{command:"removeLayer",args:[q]}),$.splice($.lastIndexOf(q,$.length-ke),1)):ke++,me=$[$.length-se],St(T,{command:"addLayer",args:[F[q],me]}),$.splice($.length-se,0,q),N[q]=!0);for(let se=0;se<E.length;se++)if(q=E[se],H=z[q],Q=F[q],!N[q]&&!ct(H,Q))if(ct(H.source,Q.source)&&ct(H["source-layer"],Q["source-layer"])&&ct(H.type,Q.type)){for(ae in jt(H.layout,Q.layout,T,q,null,"setLayoutProperty"),jt(H.paint,Q.paint,T,q,null,"setPaintProperty"),ct(H.filter,Q.filter)||St(T,{command:"setFilter",args:[q,Q.filter]}),ct(H.minzoom,Q.minzoom)&&ct(H.maxzoom,Q.maxzoom)||St(T,{command:"setLayerZoomRange",args:[q,Q.minzoom,Q.maxzoom]}),H)Object.prototype.hasOwnProperty.call(H,ae)&&ae!=="layout"&&ae!=="paint"&&ae!=="filter"&&ae!=="metadata"&&ae!=="minzoom"&&ae!=="maxzoom"&&(ae.indexOf("paint.")===0?jt(H[ae],Q[ae],T,q,ae.slice(6),"setPaintProperty"):ct(H[ae],Q[ae])||St(T,{command:"setLayerProperty",args:[q,ae,Q[ae]]}));for(ae in Q)Object.prototype.hasOwnProperty.call(Q,ae)&&!Object.prototype.hasOwnProperty.call(H,ae)&&ae!=="layout"&&ae!=="paint"&&ae!=="filter"&&ae!=="metadata"&&ae!=="minzoom"&&ae!=="maxzoom"&&(ae.indexOf("paint.")===0?jt(H[ae],Q[ae],T,q,ae.slice(6),"setPaintProperty"):ct(H[ae],Q[ae])||St(T,{command:"setLayerProperty",args:[q,ae,Q[ae]]}))}else St(T,{command:"removeLayer",args:[q]}),me=$[$.lastIndexOf(q)+1],St(T,{command:"addLayer",args:[Q,me]})})(_,t.layers,n)}catch(c){console.warn("Unable to compute style diff:",c),n=[{command:"setStyle",args:[t]}]}return n},f.bM=function(a){const t=[],n=a.id;return n===void 0&&t.push({message:`layers.${n}: missing required property "id"`}),a.render===void 0&&t.push({message:`layers.${n}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},f.bN=xi,f.bO=Tr,f.bP=class extends Di{constructor(a,t){super(a,t),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},f.bQ=Jr,f.bR=class extends Di{constructor(a,t){super(a,t),this.current=dn}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let t=1;t<16;t++)if(a[t]!==this.current[t]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},f.bS=Vr,f.bT=class extends Di{constructor(a,t){super(a,t),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},f.bU=class extends Di{constructor(a,t){super(a,t),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},f.bV=he,f.bW=function(a,t){var n=Math.sin(t),c=Math.cos(t);return a[0]=c,a[1]=n,a[2]=0,a[3]=-n,a[4]=c,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},f.bX=function(a,t,n){var c=t[0],p=t[1],_=t[2];return a[0]=c*n[0]+p*n[3]+_*n[6],a[1]=c*n[1]+p*n[4]+_*n[7],a[2]=c*n[2]+p*n[5]+_*n[8],a},f.bY=function(a,t,n,c,p,_,b){var w=1/(t-n),T=1/(c-p),P=1/(_-b);return a[0]=-2*w,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*T,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*P,a[11]=0,a[12]=(t+n)*w,a[13]=(p+c)*T,a[14]=(b+_)*P,a[15]=1,a},f.bZ=class extends Di{constructor(a,t){super(a,t),this.current=new Array}set(a){if(a!=this.current){this.current=a;const t=new Float32Array(4*a.length);for(let n=0;n<a.length;n++)t[4*n]=a[n].r,t[4*n+1]=a[n].g,t[4*n+2]=a[n].b,t[4*n+3]=a[n].a;this.gl.uniform4fv(this.location,t)}}},f.b_=class extends Di{constructor(a,t){super(a,t),this.current=new Array}set(a){if(a!=this.current){this.current=a;const t=new Float32Array(a);this.gl.uniform1fv(this.location,t)}}},f.ba=function(){return new Float64Array(16)},f.bb=function(a,t,n){const c=new Float64Array(4);return hi(c,a,t-90,n),c},f.bc=function(a,t,n,c){var p,_,b,w,T,P=t[0],E=t[1],z=t[2],F=t[3],$=n[0],N=n[1],q=n[2],H=n[3];return(_=P*$+E*N+z*q+F*H)<0&&(_=-_,$=-$,N=-N,q=-q,H=-H),1-_>xe?(p=Math.acos(_),b=Math.sin(p),w=Math.sin((1-c)*p)/b,T=Math.sin(c*p)/b):(w=1-c,T=c),a[0]=w*P+T*$,a[1]=w*E+T*N,a[2]=w*z+T*q,a[3]=w*F+T*H,a},f.bd=function(a){const t=new Float64Array(9);var n,c,p,_,b,w,T,P,E,z,F,$,N,q,H,Q,me,ae;z=(p=(c=a)[0])*(T=p+p),F=(_=c[1])*T,N=(b=c[2])*T,q=b*(P=_+_),Q=(w=c[3])*T,me=w*P,ae=w*(E=b+b),(n=t)[0]=1-($=_*P)-(H=b*E),n[3]=F-ae,n[6]=N+me,n[1]=F+ae,n[4]=1-z-H,n[7]=q-Q,n[2]=N-me,n[5]=q+Q,n[8]=1-z-$;const se=La(-Math.asin(Et(t[2],-1,1)));let ke,Ee;return Math.hypot(t[5],t[8])<.001?(ke=0,Ee=-La(Math.atan2(t[3],t[4]))):(ke=La(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),Ee=La(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:ke,pitch:se+90,bearing:Ee}},f.be=function(a,t){return a.roll==t.roll&&a.pitch==t.pitch&&a.bearing==t.bearing},f.bf=Dt,f.bg=Ha,f.bh=Fc,f.bi=Ih,f.bj=Dc,f.bk=xt,f.bl=gt,f.bm=Ti,f.bn=function(a,t,n,c,p){return xt(c,p,Et((a-t)/(n-t),0,1))},f.bo=lt,f.bp=function(){return new Float64Array(3)},f.bq=function(a,t,n,c){return a[0]=t[0]+n[0]*c,a[1]=t[1]+n[1]*c,a[2]=t[2]+n[2]*c,a},f.br=hi,f.bs=function(a,t,n){var c=n[0],p=n[1],_=n[2],b=t[0],w=t[1],T=t[2],P=p*T-_*w,E=_*b-c*T,z=c*w-p*b,F=p*z-_*E,$=_*P-c*z,N=c*E-p*P,q=2*n[3];return E*=q,z*=q,$*=2,N*=2,a[0]=b+(P*=q)+(F*=2),a[1]=w+E+$,a[2]=T+z+N,a},f.bt=function(a,t,n){const c=(p=[a[0],a[1],a[2],t[0],t[1],t[2],n[0],n[1],n[2]])[0]*((E=p[8])*(b=p[4])-(w=p[5])*(P=p[7]))+p[1]*(-E*(_=p[3])+w*(T=p[6]))+p[2]*(P*_-b*T);var p,_,b,w,T,P,E;if(c===0)return null;const z=It([],[t[0],t[1],t[2]],[n[0],n[1],n[2]]),F=It([],[n[0],n[1],n[2]],[a[0],a[1],a[2]]),$=It([],[a[0],a[1],a[2]],[t[0],t[1],t[2]]),N=et([],z,-a[3]);return rt(N,N,et([],F,-t[3])),rt(N,N,et([],$,-n[3])),et(N,N,1/c),N},f.bu=ug,f.bv=function(){return new Float64Array(4)},f.bw=function(a,t,n,c){var p=[],_=[];return p[0]=t[0]-n[0],p[1]=t[1]-n[1],p[2]=t[2]-n[2],_[0]=p[0]*Math.cos(c)-p[1]*Math.sin(c),_[1]=p[0]*Math.sin(c)+p[1]*Math.cos(c),_[2]=p[2],a[0]=_[0]+n[0],a[1]=_[1]+n[1],a[2]=_[2]+n[2],a},f.bx=function(a,t,n,c){var p=[],_=[];return p[0]=t[0]-n[0],p[1]=t[1]-n[1],p[2]=t[2]-n[2],_[0]=p[0],_[1]=p[1]*Math.cos(c)-p[2]*Math.sin(c),_[2]=p[1]*Math.sin(c)+p[2]*Math.cos(c),a[0]=_[0]+n[0],a[1]=_[1]+n[1],a[2]=_[2]+n[2],a},f.by=function(a,t,n,c){var p=[],_=[];return p[0]=t[0]-n[0],p[1]=t[1]-n[1],p[2]=t[2]-n[2],_[0]=p[2]*Math.sin(c)+p[0]*Math.cos(c),_[1]=p[1],_[2]=p[2]*Math.cos(c)-p[0]*Math.sin(c),a[0]=_[0]+n[0],a[1]=_[1]+n[1],a[2]=_[2]+n[2],a},f.bz=function(a,t,n){var c=Math.sin(n),p=Math.cos(n),_=t[0],b=t[1],w=t[2],T=t[3],P=t[8],E=t[9],z=t[10],F=t[11];return t!==a&&(a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[0]=_*p-P*c,a[1]=b*p-E*c,a[2]=w*p-z*c,a[3]=T*p-F*c,a[8]=_*c+P*p,a[9]=b*c+E*p,a[10]=w*c+z*p,a[11]=T*c+F*p,a},f.c=ge,f.c0=nS,f.c1=class extends s{},f.c2=qm,f.c3=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},f.c4=v_,f.c5=function(a,t,n){var c=t[0],p=t[1],_=t[2],b=n[3]*c+n[7]*p+n[11]*_+n[15];return a[0]=(n[0]*c+n[4]*p+n[8]*_+n[12])/(b=b||1),a[1]=(n[1]*c+n[5]*p+n[9]*_+n[13])/b,a[2]=(n[2]*c+n[6]*p+n[10]*_+n[14])/b,a},f.c6=class extends bh{},f.c7=class extends A{},f.c8=function(a,t){return a[0]===t[0]&&a[1]===t[1]&&a[2]===t[2]&&a[3]===t[3]&&a[4]===t[4]&&a[5]===t[5]&&a[6]===t[6]&&a[7]===t[7]&&a[8]===t[8]&&a[9]===t[9]&&a[10]===t[10]&&a[11]===t[11]&&a[12]===t[12]&&a[13]===t[13]&&a[14]===t[14]&&a[15]===t[15]},f.c9=function(a,t){var n=a[0],c=a[1],p=a[2],_=a[3],b=a[4],w=a[5],T=a[6],P=a[7],E=a[8],z=a[9],F=a[10],$=a[11],N=a[12],q=a[13],H=a[14],Q=a[15],me=t[0],ae=t[1],se=t[2],ke=t[3],Ee=t[4],De=t[5],Ze=t[6],$e=t[7],qe=t[8],st=t[9],Ue=t[10],Ge=t[11],ze=t[12],mt=t[13],_t=t[14],ut=t[15];return Math.abs(n-me)<=xe*Math.max(1,Math.abs(n),Math.abs(me))&&Math.abs(c-ae)<=xe*Math.max(1,Math.abs(c),Math.abs(ae))&&Math.abs(p-se)<=xe*Math.max(1,Math.abs(p),Math.abs(se))&&Math.abs(_-ke)<=xe*Math.max(1,Math.abs(_),Math.abs(ke))&&Math.abs(b-Ee)<=xe*Math.max(1,Math.abs(b),Math.abs(Ee))&&Math.abs(w-De)<=xe*Math.max(1,Math.abs(w),Math.abs(De))&&Math.abs(T-Ze)<=xe*Math.max(1,Math.abs(T),Math.abs(Ze))&&Math.abs(P-$e)<=xe*Math.max(1,Math.abs(P),Math.abs($e))&&Math.abs(E-qe)<=xe*Math.max(1,Math.abs(E),Math.abs(qe))&&Math.abs(z-st)<=xe*Math.max(1,Math.abs(z),Math.abs(st))&&Math.abs(F-Ue)<=xe*Math.max(1,Math.abs(F),Math.abs(Ue))&&Math.abs($-Ge)<=xe*Math.max(1,Math.abs($),Math.abs(Ge))&&Math.abs(N-ze)<=xe*Math.max(1,Math.abs(N),Math.abs(ze))&&Math.abs(q-mt)<=xe*Math.max(1,Math.abs(q),Math.abs(mt))&&Math.abs(H-_t)<=xe*Math.max(1,Math.abs(H),Math.abs(_t))&&Math.abs(Q-ut)<=xe*Math.max(1,Math.abs(Q),Math.abs(ut))},f.cA=function(a,t){V.REGISTERED_PROTOCOLS[a]=t},f.cB=function(a){delete V.REGISTERED_PROTOCOLS[a]},f.cC=function(a,t){const n={};for(let p=0;p<a.length;p++){const _=t&&t[a[p].id]||zm(a[p]);t&&(t[a[p].id]=_);let b=n[_];b||(b=n[_]=[]),b.push(a[p])}const c=[];for(const p in n)c.push(n[p]);return c},f.cD=Ye,f.cE=gv,f.cF=_v,f.cG=H_,f.cH=function(a){a.bucket.createArrays(),a.bucket.tilePixelRatio=At/(512*a.bucket.overscaling),a.bucket.compareText={},a.bucket.iconsNeedLinear=!1;const t=a.bucket.layers[0],n=t.layout,c=t._unevaluatedLayout._values,p={layoutIconSize:c["icon-size"].possiblyEvaluate(new vr(a.bucket.zoom+1),a.canonical),layoutTextSize:c["text-size"].possiblyEvaluate(new vr(a.bucket.zoom+1),a.canonical),textMaxSize:c["text-size"].possiblyEvaluate(new vr(18))};if(a.bucket.textSizeData.kind==="composite"){const{minZoom:P,maxZoom:E}=a.bucket.textSizeData;p.compositeTextSizes=[c["text-size"].possiblyEvaluate(new vr(P),a.canonical),c["text-size"].possiblyEvaluate(new vr(E),a.canonical)]}if(a.bucket.iconSizeData.kind==="composite"){const{minZoom:P,maxZoom:E}=a.bucket.iconSizeData;p.compositeIconSizes=[c["icon-size"].possiblyEvaluate(new vr(P),a.canonical),c["icon-size"].possiblyEvaluate(new vr(E),a.canonical)]}const _=n.get("text-line-height")*ai,b=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",w=n.get("text-keep-upright"),T=n.get("text-size");for(const P of a.bucket.features){const E=n.get("text-font").evaluate(P,{},a.canonical).join(","),z=T.evaluate(P,{},a.canonical),F=p.layoutTextSize.evaluate(P,{},a.canonical),$=p.layoutIconSize.evaluate(P,{},a.canonical),N={horizontal:{},vertical:void 0},q=P.text;let H,Q=[0,0];if(q){const se=q.toString(),ke=n.get("text-letter-spacing").evaluate(P,{},a.canonical)*ai,Ee=Fm(se)?ke:0,De=n.get("text-anchor").evaluate(P,{},a.canonical),Ze=Av(t,P,a.canonical);if(!Ze){const Ue=n.get("text-radial-offset").evaluate(P,{},a.canonical);Q=Ue?Mv(De,[Ue*ai,dg]):n.get("text-offset").evaluate(P,{},a.canonical).map((Ge=>Ge*ai))}let $e=b?"center":n.get("text-justify").evaluate(P,{},a.canonical);const qe=n.get("symbol-placement")==="point"?n.get("text-max-width").evaluate(P,{},a.canonical)*ai:1/0,st=()=>{a.bucket.allowVerticalPlacement&&Tc(se)&&(N.vertical=Ld(q,a.glyphMap,a.glyphPositions,a.imagePositions,E,qe,_,De,"left",Ee,Q,f.ao.vertical,!0,F,z))};if(!b&&Ze){const Ue=new Set;if($e==="auto")for(let ze=0;ze<Ze.values.length;ze+=2)Ue.add(fg(Ze.values[ze]));else Ue.add($e);let Ge=!1;for(const ze of Ue)if(!N.horizontal[ze])if(Ge)N.horizontal[ze]=N.horizontal[0];else{const mt=Ld(q,a.glyphMap,a.glyphPositions,a.imagePositions,E,qe,_,"center",ze,Ee,Q,f.ao.horizontal,!1,F,z);mt&&(N.horizontal[ze]=mt,Ge=mt.positionedLines.length===1)}st()}else{$e==="auto"&&($e=fg(De));const Ue=Ld(q,a.glyphMap,a.glyphPositions,a.imagePositions,E,qe,_,De,$e,Ee,Q,f.ao.horizontal,!1,F,z);Ue&&(N.horizontal[$e]=Ue),st(),Tc(se)&&b&&w&&(N.vertical=Ld(q,a.glyphMap,a.glyphPositions,a.imagePositions,E,qe,_,De,$e,Ee,Q,f.ao.vertical,!1,F,z))}}let me=!1;if(P.icon&&P.icon.name){const se=a.imageMap[P.icon.name];se&&(H=CS(a.imagePositions[P.icon.name],n.get("icon-offset").evaluate(P,{},a.canonical),n.get("icon-anchor").evaluate(P,{},a.canonical)),me=!!se.sdf,a.bucket.sdfIcons===void 0?a.bucket.sdfIcons=me:a.bucket.sdfIcons!==me&&ar("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(se.pixelRatio!==a.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(a.bucket.iconsNeedLinear=!0))}const ae=Iv(N.horizontal)||N.vertical;a.bucket.iconsInText=!!ae&&ae.iconsInText,(ae||H)&&US(a.bucket,P,N,H,a.imageMap,p,F,$,Q,me,a.canonical,a.subdivisionGranularity)}a.showCollisionBoxes&&a.bucket.generateCollisionDebugBuffers()},f.cI=Qm,f.cJ=Km,f.cK=Jm,f.cL=L_,f.cM=tg,f.cN=class{constructor(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let a=performance.getEntriesByName(this._marks.measure);return a.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),a=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),a}},f.cO=function(a,t,n,c,p){return l(this,void 0,void 0,(function*(){if(pe())try{return yield Zo(a,t,n,c,p)}catch{}return(function(_,b,w,T,P){const E=_.width,z=_.height;Ia&&za||(Ia=new OffscreenCanvas(E,z),za=Ia.getContext("2d",{willReadFrequently:!0})),Ia.width=E,Ia.height=z,za.drawImage(_,0,0,E,z);const F=za.getImageData(b,w,T,P);return za.clearRect(0,0,E,z),F.data})(a,t,n,c,p)}))},f.cP=w_,f.cQ=M,f.cR=R_,f.cS=jc,f.cT=Ys,f.cU=function(a,t){const n=new Map;if(a!=null)if(a.type==="Feature")n.set(Oh(a,t),a);else for(const c of a.features)n.set(Oh(c,t),c);return n},f.cV=function(a,t){if(a==null)return!0;if(a.type==="Feature")return Oh(a,t)!=null;if(a.type==="FeatureCollection"){const n=new Set;for(const c of a.features){const p=Oh(c,t);if(p==null||n.has(p))return!1;n.add(p)}return!0}return!1},f.cW=function(a,t,n){var c,p,_,b;if(t.removeAll&&a.clear(),t.remove)for(const w of t.remove)a.delete(w);if(t.add)for(const w of t.add){const T=Oh(w,n);T!=null&&a.set(T,w)}if(t.update)for(const w of t.update){let T=a.get(w.id);if(T==null)continue;const P=!w.removeAllProperties&&(((c=w.removeProperties)===null||c===void 0?void 0:c.length)>0||((p=w.addOrUpdateProperties)===null||p===void 0?void 0:p.length)>0);if((w.newGeometry||w.removeAllProperties||P)&&(T=Object.assign({},T),a.set(w.id,T),P&&(T.properties=Object.assign({},T.properties))),w.newGeometry&&(T.geometry=w.newGeometry),w.removeAllProperties)T.properties={};else if(((_=w.removeProperties)===null||_===void 0?void 0:_.length)>0)for(const E of w.removeProperties)Object.prototype.hasOwnProperty.call(T.properties,E)&&delete T.properties[E];if(((b=w.addOrUpdateProperties)===null||b===void 0?void 0:b.length)>0)for(const{key:E,value:z}of w.addOrUpdateProperties)T.properties[E]=z}},f.cX=Cn,f.ca=function(a,t){return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a},f.cb=a=>a.type==="symbol",f.cc=a=>a.type==="circle",f.cd=a=>a.type==="heatmap",f.ce=a=>a.type==="line",f.cf=a=>a.type==="fill",f.cg=a=>a.type==="fill-extrusion",f.ch=a=>a.type==="hillshade",f.ci=a=>a.type==="color-relief",f.cj=a=>a.type==="raster",f.ck=a=>a.type==="background",f.cl=a=>a.type==="custom",f.cm=yt,f.cn=function(a,t,n){const c=fr(t.x-n.x,t.y-n.y),p=fr(a.x-n.x,a.y-n.y);var _,b;return La(Math.atan2(c[0]*p[1]-c[1]*p[0],(_=c)[0]*(b=p)[0]+_[1]*b[1]))},f.co=Kt,f.cp=function(a,t){return Fa[t]&&(a instanceof MouseEvent||a instanceof WheelEvent)},f.cq=function(a,t){return Da[t]&&"touches"in a},f.cr=function(a){return Da[a]||Fa[a]},f.cs=function(a,t,n){var c=t[0],p=t[1];return a[0]=n[0]*c+n[4]*p+n[12],a[1]=n[1]*c+n[5]*p+n[13],a},f.ct=function(a,t){const{x:n,y:c}=jh.fromLngLat(t);return!(a<0||a>25||c<0||c>=1||n<0||n>=1)},f.cu=function(a,t){return a[0]=t[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=t[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=t[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},f.cv=class extends fs{},f.cw=qS,f.cy=function(a){return a.message===Wo},f.cz=ie,f.d=Ce,f.e=nr,f.f=a=>l(void 0,void 0,void 0,(function*(){if(a.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(a)],{type:"image/png"});try{return createImageBitmap(t)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),f.g=Z,f.h=a=>new Promise(((t,n)=>{const c=new Image;c.onload=()=>{t(c),URL.revokeObjectURL(c.src),c.onload=null,window.requestAnimationFrame((()=>{c.src=Gn}))},c.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const p=new Blob([new Uint8Array(a)],{type:"image/png"});c.src=a.byteLength?URL.createObjectURL(p):Gn})),f.i=qi,f.j=(a,t)=>ye(nr(a,{type:"json"}),t),f.k=Re,f.l=je,f.m=ye,f.n=(a,t)=>ye(nr(a,{type:"arrayBuffer"}),t),f.o=function(a){return new tg(a).readFields(mS,[])},f.p=W_,f.q=Ch,f.r=Ri,f.s=Ra,f.t=Td,f.u=Ut,f.v=be,f.w=ar,f.x=Rm,f.y=nl,f.z=us})),m("worker",["./shared"],(function(f){class l{constructor(V){this.keyCache={},V&&this.replace(V)}replace(V){this._layerConfigs={},this._layers={},this.update(V,[])}update(V,Z){for(const ie of V){this._layerConfigs[ie.id]=ie;const ue=this._layers[ie.id]=f.bJ(ie);ue._featureFilter=f.aa(ue.filter),this.keyCache[ie.id]&&delete this.keyCache[ie.id]}for(const ie of Z)delete this.keyCache[ie],delete this._layerConfigs[ie],delete this._layers[ie];this.familiesBySource={};const W=f.cC(Object.values(this._layerConfigs),this.keyCache);for(const ie of W){const ue=ie.map((Re=>this._layers[Re.id])),ye=ue[0];if(ye.visibility==="none")continue;const Ce=ye.source||"";let ve=this.familiesBySource[Ce];ve||(ve=this.familiesBySource[Ce]={});const Ie=ye.sourceLayer||"_geojsonTileLayer";let je=ve[Ie];je||(je=ve[Ie]=[]),je.push(ue)}}}class C{constructor(V){const Z={},W=[];for(const Ce in V){const ve=V[Ce],Ie=Z[Ce]={};for(const je in ve){const Re=ve[+je];if(!Re||Re.bitmap.width===0||Re.bitmap.height===0)continue;const at={x:0,y:0,w:Re.bitmap.width+2,h:Re.bitmap.height+2};W.push(at),Ie[je]={rect:at,metrics:Re.metrics}}}const{w:ie,h:ue}=f.p(W),ye=new f.q({width:ie||1,height:ue||1});for(const Ce in V){const ve=V[Ce];for(const Ie in ve){const je=ve[+Ie];if(!je||je.bitmap.width===0||je.bitmap.height===0)continue;const Re=Z[Ce][Ie].rect;f.q.copy(je.bitmap,ye,{x:0,y:0},{x:Re.x+1,y:Re.y+1},je.bitmap)}}this.image=ye,this.positions=Z}}f.cD("GlyphAtlas",C);class M{constructor(V){this.tileID=new f.Z(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId,this.inFlightDependencies=[],this.globalState=V.globalState}parse(V,Z,W,ie,ue){return f._(this,void 0,void 0,(function*(){this.status="parsing",this.data=V,this.collisionBoxArray=new f.a8;const ye=new f.cE(Object.keys(V.layers).sort()),Ce=new f.cF(this.tileID,this.promoteId);Ce.bucketLayerIDs=[];const ve={},Ie={featureIndex:Ce,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:W,subdivisionGranularity:ue},je=Z.familiesBySource[this.source];for(const jt in je){const Zt=V.layers[jt];if(!Zt)continue;Zt.version===1&&f.w(`Vector tile source "${this.source}" layer "${jt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const $r=ye.encode(jt),Be=[];for(let wi=0;wi<Zt.length;wi++){const Sr=Zt.feature(wi),ja=Ce.getId(Sr,jt);Be.push({feature:Sr,id:ja,index:wi,sourceLayerIndex:$r})}for(const wi of je[jt]){const Sr=wi[0];Sr.source!==this.source&&f.w(`layer.source = ${Sr.source} does not equal this.source = ${this.source}`),Sr.minzoom&&this.zoom<Math.floor(Sr.minzoom)||Sr.maxzoom&&this.zoom>=Sr.maxzoom||Sr.visibility!=="none"&&(R(wi,this.zoom,W),(ve[Sr.id]=Sr.createBucket({index:Ce.bucketLayerIDs.length,layers:wi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:$r,sourceID:this.source,globalState:this.globalState})).populate(Be,Ie,this.tileID.canonical),Ce.bucketLayerIDs.push(wi.map((ja=>ja.id))))}}const Re=f.bN(Ie.glyphDependencies,(jt=>Object.keys(jt).map(Number)));this.inFlightDependencies.forEach((jt=>jt?.abort())),this.inFlightDependencies=[];let at=Promise.resolve({});if(Object.keys(Re).length){const jt=new AbortController;this.inFlightDependencies.push(jt),at=ie.sendAsync({type:"GG",data:{stacks:Re,source:this.source,tileID:this.tileID,type:"glyphs"}},jt)}const be=Object.keys(Ie.iconDependencies);let vt=Promise.resolve({});if(be.length){const jt=new AbortController;this.inFlightDependencies.push(jt),vt=ie.sendAsync({type:"GI",data:{icons:be,source:this.source,tileID:this.tileID,type:"icons"}},jt)}const zt=Object.keys(Ie.patternDependencies);let ct=Promise.resolve({});if(zt.length){const jt=new AbortController;this.inFlightDependencies.push(jt),ct=ie.sendAsync({type:"GI",data:{icons:zt,source:this.source,tileID:this.tileID,type:"patterns"}},jt)}const[St,mr,Xr]=yield Promise.all([at,vt,ct]),Kr=new C(St),Dr=new f.cG(mr,Xr);for(const jt in ve){const Zt=ve[jt];Zt instanceof f.a9?(R(Zt.layers,this.zoom,W),f.cH({bucket:Zt,glyphMap:St,glyphPositions:Kr.positions,imageMap:mr,imagePositions:Dr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Ie.subdivisionGranularity})):Zt.hasPattern&&(Zt instanceof f.cI||Zt instanceof f.cJ||Zt instanceof f.cK)&&(R(Zt.layers,this.zoom,W),Zt.addFeatures(Ie,this.tileID.canonical,Dr.patternPositions))}return this.status="done",{buckets:Object.values(ve).filter((jt=>!jt.isEmpty())),featureIndex:Ce,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Kr.image,imageAtlas:Dr,glyphMap:this.returnDependencies?St:null,iconMap:this.returnDependencies?mr:null,glyphPositions:this.returnDependencies?Kr.positions:null}}))}}function R(ge,V,Z){const W=new f.F(V);for(const ie of ge)ie.recalculate(W,Z)}class j{constructor(V,Z,W){this.actor=V,this.layerIndex=Z,this.availableImages=W,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(V,Z){return f._(this,void 0,void 0,(function*(){const W=yield f.n(V.request,Z);try{return{vectorTile:new f.cL(new f.cM(W.data)),rawData:W.data,cacheControl:W.cacheControl,expires:W.expires}}catch(ie){const ue=new Uint8Array(W.data);let ye=`Unable to parse the tile at ${V.request.url}, `;throw ye+=ue[0]===31&&ue[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ie.message}`,new Error(ye)}}))}loadTile(V){return f._(this,void 0,void 0,(function*(){const Z=V.uid,W=!!(V&&V.request&&V.request.collectResourceTiming)&&new f.cN(V.request),ie=new M(V);this.loading[Z]=ie;const ue=new AbortController;ie.abort=ue;try{const ye=yield this.loadVectorTile(V,ue);if(delete this.loading[Z],!ye)return null;const Ce=ye.rawData,ve={};ye.expires&&(ve.expires=ye.expires),ye.cacheControl&&(ve.cacheControl=ye.cacheControl);const Ie={};if(W){const Re=W.finish();Re&&(Ie.resourceTiming=JSON.parse(JSON.stringify(Re)))}ie.vectorTile=ye.vectorTile;const je=ie.parse(ye.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity);this.loaded[Z]=ie,this.fetching[Z]={rawTileData:Ce,cacheControl:ve,resourceTiming:Ie};try{const Re=yield je;return f.e({rawTileData:Ce.slice(0)},Re,ve,Ie)}finally{delete this.fetching[Z]}}catch(ye){throw delete this.loading[Z],ie.status="done",this.loaded[Z]=ie,ye}}))}reloadTile(V){return f._(this,void 0,void 0,(function*(){const Z=V.uid;if(!this.loaded||!this.loaded[Z])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const W=this.loaded[Z];if(W.showCollisionBoxes=V.showCollisionBoxes,W.globalState=V.globalState,W.status==="parsing"){const ie=yield W.parse(W.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity);let ue;if(this.fetching[Z]){const{rawTileData:ye,cacheControl:Ce,resourceTiming:ve}=this.fetching[Z];delete this.fetching[Z],ue=f.e({rawTileData:ye.slice(0)},ie,Ce,ve)}else ue=ie;return ue}if(W.status==="done"&&W.vectorTile)return W.parse(W.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity)}))}abortTile(V){return f._(this,void 0,void 0,(function*(){const Z=this.loading,W=V.uid;Z&&Z[W]&&Z[W].abort&&(Z[W].abort.abort(),delete Z[W])}))}removeTile(V){return f._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[V.uid]&&delete this.loaded[V.uid]}))}}class G{constructor(){this.loaded={}}loadTile(V){return f._(this,void 0,void 0,(function*(){const{uid:Z,encoding:W,rawImageData:ie,redFactor:ue,greenFactor:ye,blueFactor:Ce,baseShift:ve}=V,Ie=ie.width+2,je=ie.height+2,Re=f.b(ie)?new f.R({width:Ie,height:je},yield f.cO(ie,-1,-1,Ie,je)):ie,at=new f.cP(Z,Re,W,ue,ye,Ce,ve);return this.loaded=this.loaded||{},this.loaded[Z]=at,at}))}removeTile(V){const Z=this.loaded,W=V.uid;Z&&Z[W]&&delete Z[W]}}var B,J,le=(function(){if(J)return B;function ge(Z,W){if(Z.length!==0){V(Z[0],W);for(var ie=1;ie<Z.length;ie++)V(Z[ie],!W)}}function V(Z,W){for(var ie=0,ue=0,ye=0,Ce=Z.length,ve=Ce-1;ye<Ce;ve=ye++){var Ie=(Z[ye][0]-Z[ve][0])*(Z[ve][1]+Z[ye][1]),je=ie+Ie;ue+=Math.abs(ie)>=Math.abs(Ie)?ie-je+Ie:Ie-je+ie,ie=je}ie+ue>=0!=!!W&&Z.reverse()}return J=1,B=function Z(W,ie){var ue,ye=W&&W.type;if(ye==="FeatureCollection")for(ue=0;ue<W.features.length;ue++)Z(W.features[ue],ie);else if(ye==="GeometryCollection")for(ue=0;ue<W.geometries.length;ue++)Z(W.geometries[ue],ie);else if(ye==="Feature")Z(W.geometry,ie);else if(ye==="Polygon")ge(W.coordinates,ie);else if(ye==="MultiPolygon")for(ue=0;ue<W.coordinates.length;ue++)ge(W.coordinates[ue],ie);return W}})(),we=f.cQ(le);class pe extends f.cS{constructor(V,Z){super(new f.cM,0,Z,[],[]),this.feature=V,this.type=V.type,this.properties=V.tags?V.tags:{},"id"in V&&(typeof V.id=="string"?this.id=parseInt(V.id,10):typeof V.id!="number"||isNaN(V.id)||(this.id=V.id))}loadGeometry(){const V=[],Z=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const W of Z){const ie=[];for(const ue of W)ie.push(new f.P(ue[0],ue[1]));V.push(ie)}return V}}class xe extends f.cR{constructor(V,Z){super(new f.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=Z?Z.version:1,this.extent=Z?Z.extent:4096,this.length=V.length,this.features=V}feature(V){return new pe(this.features[V],this.extent)}}function de(ge,V){V.writeVarintField(15,ge.version||1),V.writeStringField(1,ge.name||""),V.writeVarintField(5,ge.extent||4096);const Z={keys:[],values:[],keycache:{},valuecache:{}};for(let ue=0;ue<ge.length;ue++)Z.feature=ge.feature(ue),V.writeMessage(2,he,Z);const W=Z.keys;for(const ue of W)V.writeStringField(3,ue);const ie=Z.values;for(const ue of ie)V.writeMessage(4,rt,ue)}function he(ge,V){if(!ge.feature)return;const Z=ge.feature;Z.id!==void 0&&V.writeVarintField(1,Z.id),V.writeMessage(2,fe,ge),V.writeVarintField(3,Z.type),V.writeMessage(4,He,Z)}function fe(ge,V){for(const Z in ge.feature?.properties){let W=ge.feature.properties[Z],ie=ge.keycache[Z];if(W===null)continue;ie===void 0&&(ge.keys.push(Z),ie=ge.keys.length-1,ge.keycache[Z]=ie),V.writeVarint(ie),typeof W!="string"&&typeof W!="boolean"&&typeof W!="number"&&(W=JSON.stringify(W));const ue=typeof W+":"+W;let ye=ge.valuecache[ue];ye===void 0&&(ge.values.push(W),ye=ge.values.length-1,ge.valuecache[ue]=ye),V.writeVarint(ye)}}function Ae(ge,V){return(V<<3)+(7&ge)}function Fe(ge){return ge<<1^ge>>31}function He(ge,V){const Z=ge.loadGeometry(),W=ge.type;let ie=0,ue=0;for(const ye of Z){let Ce=1;W===1&&(Ce=ye.length),V.writeVarint(Ae(1,Ce));const ve=W===3?ye.length-1:ye.length;for(let Ie=0;Ie<ve;Ie++){Ie===1&&W!==1&&V.writeVarint(Ae(2,ve-1));const je=ye[Ie].x-ie,Re=ye[Ie].y-ue;V.writeVarint(Fe(je)),V.writeVarint(Fe(Re)),ie+=je,ue+=Re}ge.type===3&&V.writeVarint(Ae(7,1))}}function rt(ge,V){const Z=typeof ge;Z==="string"?V.writeStringField(1,ge):Z==="boolean"?V.writeBooleanField(7,ge):Z==="number"&&(ge%1!=0?V.writeDoubleField(3,ge):ge<0?V.writeSVarintField(6,ge):V.writeVarintField(5,ge))}const et={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ge=>ge},It=Math.fround||(bt=new Float32Array(1),ge=>(bt[0]=+ge,bt[0]));var bt;class er{constructor(V){this.options=Object.assign(Object.create(et),V),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(V){const{log:Z,minZoom:W,maxZoom:ie}=this.options;Z&&console.time("total time");const ue=`prepare ${V.length} points`;Z&&console.time(ue),this.points=V;const ye=[];for(let ve=0;ve<V.length;ve++){const Ie=V[ve];if(!Ie.geometry)continue;const[je,Re]=Ie.geometry.coordinates,at=It(hi(je)),be=It(bi(Re));ye.push(at,be,1/0,ve,-1,1),this.options.reduce&&ye.push(0)}let Ce=this.trees[ie+1]=this._createTree(ye);Z&&console.timeEnd(ue);for(let ve=ie;ve>=W;ve--){const Ie=+Date.now();Ce=this.trees[ve]=this._createTree(this._cluster(Ce,ve)),Z&&console.log("z%d: %d clusters in %dms",ve,Ce.numItems,+Date.now()-Ie)}return Z&&console.timeEnd("total time"),this}getClusters(V,Z){let W=((V[0]+180)%360+360)%360-180;const ie=Math.max(-90,Math.min(90,V[1]));let ue=V[2]===180?180:((V[2]+180)%360+360)%360-180;const ye=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)W=-180,ue=180;else if(W>ue){const Re=this.getClusters([W,ie,180,ye],Z),at=this.getClusters([-180,ie,ue,ye],Z);return Re.concat(at)}const Ce=this.trees[this._limitZoom(Z)],ve=Ce.range(hi(W),bi(ye),hi(ue),bi(ie)),Ie=Ce.data,je=[];for(const Re of ve){const at=this.stride*Re;je.push(Ie[at+5]>1?dr(Ie,at,this.clusterProps):this.points[Ie[at+3]])}return je}getChildren(V){const Z=this._getOriginId(V),W=this._getOriginZoom(V),ie="No cluster with the specified id.",ue=this.trees[W];if(!ue)throw new Error(ie);const ye=ue.data;if(Z*this.stride>=ye.length)throw new Error(ie);const Ce=this.options.radius/(this.options.extent*Math.pow(2,W-1)),ve=ue.within(ye[Z*this.stride],ye[Z*this.stride+1],Ce),Ie=[];for(const je of ve){const Re=je*this.stride;ye[Re+4]===V&&Ie.push(ye[Re+5]>1?dr(ye,Re,this.clusterProps):this.points[ye[Re+3]])}if(Ie.length===0)throw new Error(ie);return Ie}getLeaves(V,Z,W){const ie=[];return this._appendLeaves(ie,V,Z=Z||10,W=W||0,0),ie}getTile(V,Z,W){const ie=this.trees[this._limitZoom(V)],ue=Math.pow(2,V),{extent:ye,radius:Ce}=this.options,ve=Ce/ye,Ie=(W-ve)/ue,je=(W+1+ve)/ue,Re={features:[]};return this._addTileFeatures(ie.range((Z-ve)/ue,Ie,(Z+1+ve)/ue,je),ie.data,Z,W,ue,Re),Z===0&&this._addTileFeatures(ie.range(1-ve/ue,Ie,1,je),ie.data,ue,W,ue,Re),Z===ue-1&&this._addTileFeatures(ie.range(0,Ie,ve/ue,je),ie.data,-1,W,ue,Re),Re.features.length?Re:null}getClusterExpansionZoom(V){let Z=this._getOriginZoom(V)-1;for(;Z<=this.options.maxZoom;){const W=this.getChildren(V);if(Z++,W.length!==1)break;V=W[0].properties.cluster_id}return Z}_appendLeaves(V,Z,W,ie,ue){const ye=this.getChildren(Z);for(const Ce of ye){const ve=Ce.properties;if(ve&&ve.cluster?ue+ve.point_count<=ie?ue+=ve.point_count:ue=this._appendLeaves(V,ve.cluster_id,W,ie,ue):ue<ie?ue++:V.push(Ce),V.length===W)break}return ue}_createTree(V){const Z=new f.aI(V.length/this.stride|0,this.options.nodeSize,Float32Array);for(let W=0;W<V.length;W+=this.stride)Z.add(V[W],V[W+1]);return Z.finish(),Z.data=V,Z}_addTileFeatures(V,Z,W,ie,ue,ye){for(const Ce of V){const ve=Ce*this.stride,Ie=Z[ve+5]>1;let je,Re,at;if(Ie)je=Lr(Z,ve,this.clusterProps),Re=Z[ve],at=Z[ve+1];else{const zt=this.points[Z[ve+3]];je=zt.properties;const[ct,St]=zt.geometry.coordinates;Re=hi(ct),at=bi(St)}const be={type:1,geometry:[[Math.round(this.options.extent*(Re*ue-W)),Math.round(this.options.extent*(at*ue-ie))]],tags:je};let vt;vt=Ie||this.options.generateId?Z[ve+3]:this.points[Z[ve+3]].id,vt!==void 0&&(be.id=vt),ye.features.push(be)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,Z){const{radius:W,extent:ie,reduce:ue,minPoints:ye}=this.options,Ce=W/(ie*Math.pow(2,Z)),ve=V.data,Ie=[],je=this.stride;for(let Re=0;Re<ve.length;Re+=je){if(ve[Re+2]<=Z)continue;ve[Re+2]=Z;const at=ve[Re],be=ve[Re+1],vt=V.within(ve[Re],ve[Re+1],Ce),zt=ve[Re+5];let ct=zt;for(const St of vt){const mr=St*je;ve[mr+2]>Z&&(ct+=ve[mr+5])}if(ct>zt&&ct>=ye){let St,mr=at*zt,Xr=be*zt,Kr=-1;const Dr=(Re/je<<5)+(Z+1)+this.points.length;for(const jt of vt){const Zt=jt*je;if(ve[Zt+2]<=Z)continue;ve[Zt+2]=Z;const $r=ve[Zt+5];mr+=ve[Zt]*$r,Xr+=ve[Zt+1]*$r,ve[Zt+4]=Dr,ue&&(St||(St=this._map(ve,Re,!0),Kr=this.clusterProps.length,this.clusterProps.push(St)),ue(St,this._map(ve,Zt)))}ve[Re+4]=Dr,Ie.push(mr/ct,Xr/ct,1/0,Dr,-1,ct),ue&&Ie.push(Kr)}else{for(let St=0;St<je;St++)Ie.push(ve[Re+St]);if(ct>1)for(const St of vt){const mr=St*je;if(!(ve[mr+2]<=Z)){ve[mr+2]=Z;for(let Xr=0;Xr<je;Xr++)Ie.push(ve[mr+Xr])}}}}return Ie}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,Z,W){if(V[Z+5]>1){const ye=this.clusterProps[V[Z+6]];return W?Object.assign({},ye):ye}const ie=this.points[V[Z+3]].properties,ue=this.options.map(ie);return W&&ue===ie?Object.assign({},ue):ue}}function dr(ge,V,Z){return{type:"Feature",id:ge[V+3],properties:Lr(ge,V,Z),geometry:{type:"Point",coordinates:[(W=ge[V],360*(W-.5)),fr(ge[V+1])]}};var W}function Lr(ge,V,Z){const W=ge[V+5],ie=W>=1e4?`${Math.round(W/1e3)}k`:W>=1e3?Math.round(W/100)/10+"k":W,ue=ge[V+6],ye=ue===-1?{}:Object.assign({},Z[ue]);return Object.assign(ye,{cluster:!0,cluster_id:ge[V+3],point_count:W,point_count_abbreviated:ie})}function hi(ge){return ge/360+.5}function bi(ge){const V=Math.sin(ge*Math.PI/180),Z=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return Z<0?0:Z>1?1:Z}function fr(ge){const V=(180-360*ge)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function At(ge,V,Z,W){let ie=W;const ue=V+(Z-V>>1);let ye,Ce=Z-V;const ve=ge[V],Ie=ge[V+1],je=ge[Z],Re=ge[Z+1];for(let at=V+3;at<Z;at+=3){const be=Qe(ge[at],ge[at+1],ve,Ie,je,Re);if(be>ie)ye=at,ie=be;else if(be===ie){const vt=Math.abs(at-ue);vt<Ce&&(ye=at,Ce=vt)}}ie>W&&(ye-V>3&&At(ge,V,ye,W),ge[ye+2]=ie,Z-ye>3&&At(ge,ye,Z,W))}function Qe(ge,V,Z,W,ie,ue){let ye=ie-Z,Ce=ue-W;if(ye!==0||Ce!==0){const ve=((ge-Z)*ye+(V-W)*Ce)/(ye*ye+Ce*Ce);ve>1?(Z=ie,W=ue):ve>0&&(Z+=ye*ve,W+=Ce*ve)}return ye=ge-Z,Ce=V-W,ye*ye+Ce*Ce}function lt(ge,V,Z,W){const ie={id:ge??null,type:V,geometry:Z,tags:W,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(V==="Point"||V==="MultiPoint"||V==="LineString")xt(ie,Z);else if(V==="Polygon")xt(ie,Z[0]);else if(V==="MultiLineString")for(const ue of Z)xt(ie,ue);else if(V==="MultiPolygon")for(const ue of Z)xt(ie,ue[0]);return ie}function xt(ge,V){for(let Z=0;Z<V.length;Z+=3)ge.minX=Math.min(ge.minX,V[Z]),ge.minY=Math.min(ge.minY,V[Z+1]),ge.maxX=Math.max(ge.maxX,V[Z]),ge.maxY=Math.max(ge.maxY,V[Z+1])}function gt(ge,V,Z,W){if(!V.geometry)return;const ie=V.geometry.coordinates;if(ie&&ie.length===0)return;const ue=V.geometry.type,ye=Math.pow(Z.tolerance/((1<<Z.maxZoom)*Z.extent),2);let Ce=[],ve=V.id;if(Z.promoteId?ve=V.properties[Z.promoteId]:Z.generateId&&(ve=W||0),ue==="Point")yt(ie,Ce);else if(ue==="MultiPoint")for(const Ie of ie)yt(Ie,Ce);else if(ue==="LineString")Kt(ie,Ce,ye,!1);else if(ue==="MultiLineString"){if(Z.lineMetrics){for(const Ie of ie)Ce=[],Kt(Ie,Ce,ye,!1),ge.push(lt(ve,"LineString",Ce,V.properties));return}Et(ie,Ce,ye,!1)}else if(ue==="Polygon")Et(ie,Ce,ye,!0);else{if(ue!=="MultiPolygon"){if(ue==="GeometryCollection"){for(const Ie of V.geometry.geometries)gt(ge,{id:ve,geometry:Ie,properties:V.properties},Z,W);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ie of ie){const je=[];Et(Ie,je,ye,!0),Ce.push(je)}}ge.push(lt(ve,ue,Ce,V.properties))}function yt(ge,V){V.push(br(ge[0]),nr(ge[1]),0)}function Kt(ge,V,Z,W){let ie,ue,ye=0;for(let ve=0;ve<ge.length;ve++){const Ie=br(ge[ve][0]),je=nr(ge[ve][1]);V.push(Ie,je,0),ve>0&&(ye+=W?(ie*je-Ie*ue)/2:Math.sqrt(Math.pow(Ie-ie,2)+Math.pow(je-ue,2))),ie=Ie,ue=je}const Ce=V.length-3;V[2]=1,At(V,0,Ce,Z),V[Ce+2]=1,V.size=Math.abs(ye),V.start=0,V.end=V.size}function Et(ge,V,Z,W){for(let ie=0;ie<ge.length;ie++){const ue=[];Kt(ge[ie],ue,Z,W),V.push(ue)}}function br(ge){return ge/360+.5}function nr(ge){const V=Math.sin(ge*Math.PI/180),Z=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return Z<0?0:Z>1?1:Z}function Mr(ge,V,Z,W,ie,ue,ye,Ce){if(W/=V,ue>=(Z/=V)&&ye<W)return ge;if(ye<Z||ue>=W)return null;const ve=[];for(const Ie of ge){const je=Ie.geometry;let Re=Ie.type;const at=ie===0?Ie.minX:Ie.minY,be=ie===0?Ie.maxX:Ie.maxY;if(at>=Z&&be<W){ve.push(Ie);continue}if(be<Z||at>=W)continue;let vt=[];if(Re==="Point"||Re==="MultiPoint")xi(je,vt,Z,W,ie);else if(Re==="LineString")Tr(je,vt,Z,W,ie,!1,Ce.lineMetrics);else if(Re==="MultiLineString")Yt(je,vt,Z,W,ie,!1);else if(Re==="Polygon")Yt(je,vt,Z,W,ie,!0);else if(Re==="MultiPolygon")for(const zt of je){const ct=[];Yt(zt,ct,Z,W,ie,!0),ct.length&&vt.push(ct)}if(vt.length){if(Ce.lineMetrics&&Re==="LineString"){for(const zt of vt)ve.push(lt(Ie.id,Re,zt,Ie.tags));continue}Re!=="LineString"&&Re!=="MultiLineString"||(vt.length===1?(Re="LineString",vt=vt[0]):Re="MultiLineString"),Re!=="Point"&&Re!=="MultiPoint"||(Re=vt.length===3?"Point":"MultiPoint"),ve.push(lt(Ie.id,Re,vt,Ie.tags))}}return ve.length?ve:null}function xi(ge,V,Z,W,ie){for(let ue=0;ue<ge.length;ue+=3){const ye=ge[ue+ie];ye>=Z&&ye<=W&&ar(V,ge[ue],ge[ue+1],ge[ue+2])}}function Tr(ge,V,Z,W,ie,ue,ye){let Ce=gr(ge);const ve=ie===0?Hr:qi;let Ie,je,Re=ge.start;for(let ct=0;ct<ge.length-3;ct+=3){const St=ge[ct],mr=ge[ct+1],Xr=ge[ct+2],Kr=ge[ct+3],Dr=ge[ct+4],jt=ie===0?St:mr,Zt=ie===0?Kr:Dr;let $r=!1;ye&&(Ie=Math.sqrt(Math.pow(St-Kr,2)+Math.pow(mr-Dr,2))),jt<Z?Zt>Z&&(je=ve(Ce,St,mr,Kr,Dr,Z),ye&&(Ce.start=Re+Ie*je)):jt>W?Zt<W&&(je=ve(Ce,St,mr,Kr,Dr,W),ye&&(Ce.start=Re+Ie*je)):ar(Ce,St,mr,Xr),Zt<Z&&jt>=Z&&(je=ve(Ce,St,mr,Kr,Dr,Z),$r=!0),Zt>W&&jt<=W&&(je=ve(Ce,St,mr,Kr,Dr,W),$r=!0),!ue&&$r&&(ye&&(Ce.end=Re+Ie*je),V.push(Ce),Ce=gr(ge)),ye&&(Re+=Ie)}let at=ge.length-3;const be=ge[at],vt=ge[at+1],zt=ie===0?be:vt;zt>=Z&&zt<=W&&ar(Ce,be,vt,ge[at+2]),at=Ce.length-3,ue&&at>=3&&(Ce[at]!==Ce[0]||Ce[at+1]!==Ce[1])&&ar(Ce,Ce[0],Ce[1],Ce[2]),Ce.length&&V.push(Ce)}function gr(ge){const V=[];return V.size=ge.size,V.start=ge.start,V.end=ge.end,V}function Yt(ge,V,Z,W,ie,ue){for(const ye of ge)Tr(ye,V,Z,W,ie,ue,!1)}function ar(ge,V,Z,W){ge.push(V,Z,W)}function Hr(ge,V,Z,W,ie,ue){const ye=(ue-V)/(W-V);return ar(ge,ue,Z+(ie-Z)*ye,1),ye}function qi(ge,V,Z,W,ie,ue){const ye=(ue-Z)/(ie-Z);return ar(ge,V+(W-V)*ye,ue,1),ye}function so(ge,V){const Z=[];for(let W=0;W<ge.length;W++){const ie=ge[W],ue=ie.type;let ye;if(ue==="Point"||ue==="MultiPoint"||ue==="LineString")ye=qn(ie.geometry,V);else if(ue==="MultiLineString"||ue==="Polygon"){ye=[];for(const Ce of ie.geometry)ye.push(qn(Ce,V))}else if(ue==="MultiPolygon"){ye=[];for(const Ce of ie.geometry){const ve=[];for(const Ie of Ce)ve.push(qn(Ie,V));ye.push(ve)}}Z.push(lt(ie.id,ue,ye,ie.tags))}return Z}function qn(ge,V){const Z=[];Z.size=ge.size,ge.start!==void 0&&(Z.start=ge.start,Z.end=ge.end);for(let W=0;W<ge.length;W+=3)Z.push(ge[W]+V,ge[W+1],ge[W+2]);return Z}function Gn(ge,V){if(ge.transformed)return ge;const Z=1<<ge.z,W=ge.x,ie=ge.y;for(const ue of ge.features){const ye=ue.geometry,Ce=ue.type;if(ue.geometry=[],Ce===1)for(let ve=0;ve<ye.length;ve+=2)ue.geometry.push(Zo(ye[ve],ye[ve+1],V,Z,W,ie));else for(let ve=0;ve<ye.length;ve++){const Ie=[];for(let je=0;je<ye[ve].length;je+=2)Ie.push(Zo(ye[ve][je],ye[ve][je+1],V,Z,W,ie));ue.geometry.push(Ie)}}return ge.transformed=!0,ge}function Zo(ge,V,Z,W,ie,ue){return[Math.round(Z*(ge*W-ie)),Math.round(Z*(V*W-ue))]}function Ia(ge,V,Z,W,ie){const ue=V===ie.maxZoom?0:ie.tolerance/((1<<V)*ie.extent),ye={features:[],numPoints:0,numSimplified:0,numFeatures:ge.length,source:null,x:Z,y:W,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ce of ge)za(ye,Ce,ue,ie);return ye}function za(ge,V,Z,W){const ie=V.geometry,ue=V.type,ye=[];if(ge.minX=Math.min(ge.minX,V.minX),ge.minY=Math.min(ge.minY,V.minY),ge.maxX=Math.max(ge.maxX,V.maxX),ge.maxY=Math.max(ge.maxY,V.maxY),ue==="Point"||ue==="MultiPoint")for(let Ce=0;Ce<ie.length;Ce+=3)ye.push(ie[Ce],ie[Ce+1]),ge.numPoints++,ge.numSimplified++;else if(ue==="LineString")Ra(ye,ie,ge,Z,!1,!1);else if(ue==="MultiLineString"||ue==="Polygon")for(let Ce=0;Ce<ie.length;Ce++)Ra(ye,ie[Ce],ge,Z,ue==="Polygon",Ce===0);else if(ue==="MultiPolygon")for(let Ce=0;Ce<ie.length;Ce++){const ve=ie[Ce];for(let Ie=0;Ie<ve.length;Ie++)Ra(ye,ve[Ie],ge,Z,!0,Ie===0)}if(ye.length){let Ce=V.tags||null;if(ue==="LineString"&&W.lineMetrics){Ce={};for(const Ie in V.tags)Ce[Ie]=V.tags[Ie];Ce.mapbox_clip_start=ie.start/ie.size,Ce.mapbox_clip_end=ie.end/ie.size}const ve={geometry:ye,type:ue==="Polygon"||ue==="MultiPolygon"?3:ue==="LineString"||ue==="MultiLineString"?2:1,tags:Ce};V.id!==null&&(ve.id=V.id),ge.features.push(ve)}}function Ra(ge,V,Z,W,ie,ue){const ye=W*W;if(W>0&&V.size<(ie?ye:W))return void(Z.numPoints+=V.length/3);const Ce=[];for(let ve=0;ve<V.length;ve+=3)(W===0||V[ve+2]>ye)&&(Z.numSimplified++,Ce.push(V[ve],V[ve+1])),Z.numPoints++;ie&&(function(ve,Ie){let je=0;for(let Re=0,at=ve.length,be=at-2;Re<at;be=Re,Re+=2)je+=(ve[Re]-ve[be])*(ve[Re+1]+ve[be+1]);if(je>0===Ie)for(let Re=0,at=ve.length;Re<at/2;Re+=2){const be=ve[Re],vt=ve[Re+1];ve[Re]=ve[at-2-Re],ve[Re+1]=ve[at-1-Re],ve[at-2-Re]=be,ve[at-1-Re]=vt}})(Ce,ue),ge.push(Ce)}const lo={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class La{constructor(V,Z){const W=(Z=this.options=(function(ue,ye){for(const Ce in ye)ue[Ce]=ye[Ce];return ue})(Object.create(lo),Z)).debug;if(W&&console.time("preprocess data"),Z.maxZoom<0||Z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Z.promoteId&&Z.generateId)throw new Error("promoteId and generateId cannot be used together.");let ie=(function(ue,ye){const Ce=[];if(ue.type==="FeatureCollection")for(let ve=0;ve<ue.features.length;ve++)gt(Ce,ue.features[ve],ye,ve);else gt(Ce,ue.type==="Feature"?ue:{geometry:ue},ye);return Ce})(V,Z);this.tiles={},this.tileCoords=[],W&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Z.indexMaxZoom,Z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ie=(function(ue,ye){const Ce=ye.buffer/ye.extent;let ve=ue;const Ie=Mr(ue,1,-1-Ce,Ce,0,-1,2,ye),je=Mr(ue,1,1-Ce,2+Ce,0,-1,2,ye);return(Ie||je)&&(ve=Mr(ue,1,-Ce,1+Ce,0,-1,2,ye)||[],Ie&&(ve=so(Ie,1).concat(ve)),je&&(ve=ve.concat(so(je,-1)))),ve})(ie,Z),ie.length&&this.splitTile(ie,0,0,0),W&&(ie.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(V,Z,W,ie,ue,ye,Ce){const ve=[V,Z,W,ie],Ie=this.options,je=Ie.debug;for(;ve.length;){ie=ve.pop(),W=ve.pop(),Z=ve.pop(),V=ve.pop();const Re=1<<Z,at=Da(Z,W,ie);let be=this.tiles[at];if(!be&&(je>1&&console.time("creation"),be=this.tiles[at]=Ia(V,Z,W,ie,Ie),this.tileCoords.push({z:Z,x:W,y:ie}),je)){je>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Z,W,ie,be.numFeatures,be.numPoints,be.numSimplified),console.timeEnd("creation"));const $r=`z${Z}`;this.stats[$r]=(this.stats[$r]||0)+1,this.total++}if(be.source=V,ue==null){if(Z===Ie.indexMaxZoom||be.numPoints<=Ie.indexMaxPoints)continue}else{if(Z===Ie.maxZoom||Z===ue)continue;if(ue!=null){const $r=ue-Z;if(W!==ye>>$r||ie!==Ce>>$r)continue}}if(be.source=null,V.length===0)continue;je>1&&console.time("clipping");const vt=.5*Ie.buffer/Ie.extent,zt=.5-vt,ct=.5+vt,St=1+vt;let mr=null,Xr=null,Kr=null,Dr=null,jt=Mr(V,Re,W-vt,W+ct,0,be.minX,be.maxX,Ie),Zt=Mr(V,Re,W+zt,W+St,0,be.minX,be.maxX,Ie);V=null,jt&&(mr=Mr(jt,Re,ie-vt,ie+ct,1,be.minY,be.maxY,Ie),Xr=Mr(jt,Re,ie+zt,ie+St,1,be.minY,be.maxY,Ie),jt=null),Zt&&(Kr=Mr(Zt,Re,ie-vt,ie+ct,1,be.minY,be.maxY,Ie),Dr=Mr(Zt,Re,ie+zt,ie+St,1,be.minY,be.maxY,Ie),Zt=null),je>1&&console.timeEnd("clipping"),ve.push(mr||[],Z+1,2*W,2*ie),ve.push(Xr||[],Z+1,2*W,2*ie+1),ve.push(Kr||[],Z+1,2*W+1,2*ie),ve.push(Dr||[],Z+1,2*W+1,2*ie+1)}}getTile(V,Z,W){V=+V,Z=+Z,W=+W;const ie=this.options,{extent:ue,debug:ye}=ie;if(V<0||V>24)return null;const Ce=1<<V,ve=Da(V,Z=Z+Ce&Ce-1,W);if(this.tiles[ve])return Gn(this.tiles[ve],ue);ye>1&&console.log("drilling down to z%d-%d-%d",V,Z,W);let Ie,je=V,Re=Z,at=W;for(;!Ie&&je>0;)je--,Re>>=1,at>>=1,Ie=this.tiles[Da(je,Re,at)];return Ie&&Ie.source?(ye>1&&(console.log("found parent tile z%d-%d-%d",je,Re,at),console.time("drilling down")),this.splitTile(Ie.source,je,Re,at,V,Z,W),ye>1&&console.timeEnd("drilling down"),this.tiles[ve]?Gn(this.tiles[ve],ue):null):null}}function Da(ge,V,Z){return 32*((1<<ge)*Z+V)+ge}class Fa extends j{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(V,Z){return f._(this,void 0,void 0,(function*(){const W=V.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ie=this._geoJSONIndex.getTile(W.z,W.x,W.y);if(!ie)return null;const ue=new xe(ie.features,{version:2,extent:f.$});let ye=(function(Ce){const ve=new f.cM;return(function(Ie,je){for(const Re in Ie.layers)je.writeMessage(3,de,Ie.layers[Re])})(Ce,ve),ve.finish()})(ue);return ye.byteOffset===0&&ye.byteLength===ye.buffer.byteLength||(ye=new Uint8Array(ye)),{vectorTile:ue,rawData:ye.buffer}}))}loadData(V){return f._(this,void 0,void 0,(function*(){var Z;(Z=this._pendingRequest)===null||Z===void 0||Z.abort();const W=!!(V&&V.request&&V.request.collectResourceTiming)&&new f.cN(V.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(V,this._pendingRequest);const ie=yield this._pendingData;this._geoJSONIndex=V.cluster?new er((function({superclusterOptions:ye,clusterProperties:Ce}){if(!Ce||!ye)return ye;const ve={},Ie={},je={accumulated:null,zoom:0},Re={properties:null},at=Object.keys(Ce);for(const be of at){const[vt,zt]=Ce[be],ct=f.cT(zt),St=f.cT(typeof vt=="string"?[vt,["accumulated"],["get",be]]:vt);ve[be]=ct.value,Ie[be]=St.value}return ye.map=be=>{Re.properties=be;const vt={};for(const zt of at)vt[zt]=ve[zt].evaluate(je,Re);return vt},ye.reduce=(be,vt)=>{Re.properties=vt;for(const zt of at)je.accumulated=be[zt],be[zt]=Ie[zt].evaluate(je,Re)},ye})(V)).load(ie.features):(function(ye,Ce){return new La(ye,Ce)})(ie,V.geojsonVtOptions),this.loaded={};const ue={data:ie};if(W){const ye=W.finish();ye&&(ue.resourceTiming={},ue.resourceTiming[V.source]=JSON.parse(JSON.stringify(ye)))}return ue}catch(ie){if(delete this._pendingRequest,f.cy(ie))return{abandoned:!0};throw ie}}))}getData(){return f._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(V){const Z=this.loaded;return Z&&Z[V.uid]?super.reloadTile(V):this.loadTile(V)}loadAndProcessGeoJSON(V,Z){return f._(this,void 0,void 0,(function*(){let W=yield this.loadGeoJSON(V,Z);if(delete this._pendingRequest,typeof W!="object")throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`);if(we(W,!0),V.filter){const ie=f.cT(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ie.result==="error")throw new Error(ie.value.map((ye=>`${ye.key}: ${ye.message}`)).join(", "));W={type:"FeatureCollection",features:W.features.filter((ye=>ie.value.evaluate({zoom:0},ye)))}}return W}))}loadGeoJSON(V,Z){return f._(this,void 0,void 0,(function*(){const{promoteId:W}=V;if(V.request){const ie=yield f.j(V.request,Z);return this._dataUpdateable=f.cV(ie.data,W)?f.cU(ie.data,W):void 0,ie.data}if(typeof V.data=="string")try{const ie=JSON.parse(V.data);return this._dataUpdateable=f.cV(ie,W)?f.cU(ie,W):void 0,ie}catch{throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`)}if(!V.dataDiff)throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${V.source}`);return f.cW(this._dataUpdateable,V.dataDiff,W),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(V){return f._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(V){return this._geoJSONIndex.getClusterExpansionZoom(V.clusterId)}getClusterChildren(V){return this._geoJSONIndex.getChildren(V.clusterId)}getClusterLeaves(V){return this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset)}}class Wo{constructor(V){this.self=V,this.actor=new f.J(V),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(Z,W)=>{if(this.externalWorkerSourceTypes[Z])throw new Error(`Worker source with name "${Z}" already registered.`);this.externalWorkerSourceTypes[Z]=W},this.self.addProtocol=f.cA,this.self.removeProtocol=f.cB,this.self.registerRTLTextPlugin=Z=>{f.cX.setMethods(Z)},this.actor.registerMessageHandler("LDT",((Z,W)=>this._getDEMWorkerSource(Z,W.source).loadTile(W))),this.actor.registerMessageHandler("RDT",((Z,W)=>f._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(Z,W.source).removeTile(W)})))),this.actor.registerMessageHandler("GCEZ",((Z,W)=>f._(this,void 0,void 0,(function*(){return this._getWorkerSource(Z,W.type,W.source).getClusterExpansionZoom(W)})))),this.actor.registerMessageHandler("GCC",((Z,W)=>f._(this,void 0,void 0,(function*(){return this._getWorkerSource(Z,W.type,W.source).getClusterChildren(W)})))),this.actor.registerMessageHandler("GCL",((Z,W)=>f._(this,void 0,void 0,(function*(){return this._getWorkerSource(Z,W.type,W.source).getClusterLeaves(W)})))),this.actor.registerMessageHandler("LD",((Z,W)=>this._getWorkerSource(Z,W.type,W.source).loadData(W))),this.actor.registerMessageHandler("GD",((Z,W)=>this._getWorkerSource(Z,W.type,W.source).getData())),this.actor.registerMessageHandler("LT",((Z,W)=>this._getWorkerSource(Z,W.type,W.source).loadTile(W))),this.actor.registerMessageHandler("RT",((Z,W)=>this._getWorkerSource(Z,W.type,W.source).reloadTile(W))),this.actor.registerMessageHandler("AT",((Z,W)=>this._getWorkerSource(Z,W.type,W.source).abortTile(W))),this.actor.registerMessageHandler("RMT",((Z,W)=>this._getWorkerSource(Z,W.type,W.source).removeTile(W))),this.actor.registerMessageHandler("RS",((Z,W)=>f._(this,void 0,void 0,(function*(){if(!this.workerSources[Z]||!this.workerSources[Z][W.type]||!this.workerSources[Z][W.type][W.source])return;const ie=this.workerSources[Z][W.type][W.source];delete this.workerSources[Z][W.type][W.source],ie.removeSource!==void 0&&ie.removeSource(W)})))),this.actor.registerMessageHandler("RM",(Z=>f._(this,void 0,void 0,(function*(){delete this.layerIndexes[Z],delete this.availableImages[Z],delete this.workerSources[Z],delete this.demWorkerSources[Z]})))),this.actor.registerMessageHandler("SR",((Z,W)=>f._(this,void 0,void 0,(function*(){this.referrer=W})))),this.actor.registerMessageHandler("SRPS",((Z,W)=>this._syncRTLPluginState(Z,W))),this.actor.registerMessageHandler("IS",((Z,W)=>f._(this,void 0,void 0,(function*(){this.self.importScripts(W)})))),this.actor.registerMessageHandler("SI",((Z,W)=>this._setImages(Z,W))),this.actor.registerMessageHandler("UL",((Z,W)=>f._(this,void 0,void 0,(function*(){this._getLayerIndex(Z).update(W.layers,W.removedIds)})))),this.actor.registerMessageHandler("SL",((Z,W)=>f._(this,void 0,void 0,(function*(){this._getLayerIndex(Z).replace(W)}))))}_setImages(V,Z){return f._(this,void 0,void 0,(function*(){this.availableImages[V]=Z;for(const W in this.workerSources[V]){const ie=this.workerSources[V][W];for(const ue in ie)ie[ue].availableImages=Z}}))}_syncRTLPluginState(V,Z){return f._(this,void 0,void 0,(function*(){return yield f.cX.syncState(Z,this.self.importScripts)}))}_getAvailableImages(V){let Z=this.availableImages[V];return Z||(Z=[]),Z}_getLayerIndex(V){let Z=this.layerIndexes[V];return Z||(Z=this.layerIndexes[V]=new l),Z}_getWorkerSource(V,Z,W){if(this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][Z]||(this.workerSources[V][Z]={}),!this.workerSources[V][Z][W]){const ie={sendAsync:(ue,ye)=>(ue.targetMapId=V,this.actor.sendAsync(ue,ye))};switch(Z){case"vector":this.workerSources[V][Z][W]=new j(ie,this._getLayerIndex(V),this._getAvailableImages(V));break;case"geojson":this.workerSources[V][Z][W]=new Fa(ie,this._getLayerIndex(V),this._getAvailableImages(V));break;default:this.workerSources[V][Z][W]=new this.externalWorkerSourceTypes[Z](ie,this._getLayerIndex(V),this._getAvailableImages(V))}}return this.workerSources[V][Z][W]}_getDEMWorkerSource(V,Z){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][Z]||(this.demWorkerSources[V][Z]=new G),this.demWorkerSources[V][Z]}}return f.i(self)&&(self.worker=new Wo(self)),Wo})),m("index",["exports","./shared"],(function(f,l){var C="5.6.2";function M(){var g=new l.A(4);return l.A!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g}let R,j;const G={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(g,e,s){const u=requestAnimationFrame((y=>{d(),e(y)})),{unsubscribe:d}=l.s(g.signal,"abort",(()=>{d(),cancelAnimationFrame(u),s(l.c())}),!1)},frameAsync(g){return new Promise(((e,s)=>{this.frame(g,e,s)}))},getImageData(g,e=0){return this.getImageCanvasContext(g).getImageData(-e,-e,g.width+2*e,g.height+2*e)},getImageCanvasContext(g){const e=window.document.createElement("canvas"),s=e.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return e.width=g.width,e.height=g.height,s.drawImage(g,0,0,g.width,g.height),s},resolveURL:g=>(R||(R=document.createElement("a")),R.href=g,R.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(j==null&&(j=matchMedia("(prefers-reduced-motion: reduce)")),j.matches)}};class B{static testProp(e){if(!B.docStyle)return e[0];for(let s=0;s<e.length;s++)if(e[s]in B.docStyle)return e[s];return e[0]}static create(e,s,u){const d=window.document.createElement(e);return s!==void 0&&(d.className=s),u&&u.appendChild(d),d}static createNS(e,s){return window.document.createElementNS(e,s)}static disableDrag(){B.docStyle&&B.selectProp&&(B.userSelect=B.docStyle[B.selectProp],B.docStyle[B.selectProp]="none")}static enableDrag(){B.docStyle&&B.selectProp&&(B.docStyle[B.selectProp]=B.userSelect)}static setTransform(e,s){e.style[B.transformProp]=s}static addEventListener(e,s,u,d={}){e.addEventListener(s,u,"passive"in d?d:d.capture)}static removeEventListener(e,s,u,d={}){e.removeEventListener(s,u,"passive"in d?d:d.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",B.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",B.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",B.suppressClickInternal,!0)}),0)}static getScale(e){const s=e.getBoundingClientRect();return{x:s.width/e.offsetWidth||1,y:s.height/e.offsetHeight||1,boundingClientRect:s}}static getPoint(e,s,u){const d=s.boundingClientRect;return new l.P((u.clientX-d.left)/s.x-e.clientLeft,(u.clientY-d.top)/s.y-e.clientTop)}static mousePos(e,s){const u=B.getScale(e);return B.getPoint(e,u,s)}static touchPos(e,s){const u=[],d=B.getScale(e);for(let y=0;y<s.length;y++)u.push(B.getPoint(e,d,s[y]));return u}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const s=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),u=s.querySelectorAll("script");for(const d of u)d.remove();return B.clean(s),s.innerHTML}static isPossiblyDangerous(e,s){const u=s.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!u.includes("javascript:")&&!u.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const s=e.children;for(const u of s)B.removeAttributes(u),B.clean(u)}static removeAttributes(e){for(const{name:s,value:u}of e.attributes)B.isPossiblyDangerous(s,u)&&e.removeAttribute(s)}}B.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,B.selectProp=B.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),B.transformProp=B.testProp(["transform","WebkitTransform"]);const J={supported:!1,testSupport:function(g){!pe&&we&&(xe?de(g):le=g)}};let le,we,pe=!1,xe=!1;function de(g){const e=g.createTexture();g.bindTexture(g.TEXTURE_2D,e);try{if(g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,we),g.isContextLost())return;J.supported=!0}catch{}g.deleteTexture(e),pe=!0}var he;typeof document<"u"&&(we=document.createElement("img"),we.onload=()=>{le&&de(le),le=null,xe=!0},we.onerror=()=>{pe=!0,le=null},we.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(g){let e,s,u,d;g.resetRequestQueue=()=>{e=[],s=0,u=0,d={}},g.addThrottleControl=k=>{const A=u++;return d[A]=k,A},g.removeThrottleControl=k=>{delete d[k],x()},g.getImage=(k,A,I=!0)=>new Promise(((D,L)=>{J.supported&&(k.headers||(k.headers={}),k.headers.accept="image/webp,*/*"),l.e(k,{type:"image"}),e.push({abortController:A,requestParameters:k,supportImageRefresh:I,state:"queued",onError:O=>{L(O)},onSuccess:O=>{D(O)}}),x()}));const y=k=>l._(this,void 0,void 0,(function*(){k.state="running";const{requestParameters:A,supportImageRefresh:I,onError:D,onSuccess:L,abortController:O}=k,U=I===!1&&!l.i(self)&&!l.g(A.url)&&(!A.headers||Object.keys(A.headers).reduce(((Y,ee)=>Y&&ee==="accept"),!0));s++;const K=U?S(A,O):l.m(A,O);try{const Y=yield K;delete k.abortController,k.state="completed",Y.data instanceof HTMLImageElement||l.b(Y.data)?L(Y):Y.data&&L({data:yield(X=Y.data,typeof createImageBitmap=="function"?l.f(X):l.h(X)),cacheControl:Y.cacheControl,expires:Y.expires})}catch(Y){delete k.abortController,D(Y)}finally{s--,x()}var X})),x=()=>{const k=(()=>{for(const A of Object.keys(d))if(d[A]())return!0;return!1})()?l.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let A=s;A<k&&e.length>0;A++){const I=e.shift();I.abortController.signal.aborted?A--:y(I)}},S=(k,A)=>new Promise(((I,D)=>{const L=new Image,O=k.url,U=k.credentials;U&&U==="include"?L.crossOrigin="use-credentials":(U&&U==="same-origin"||!l.d(O))&&(L.crossOrigin="anonymous"),A.signal.addEventListener("abort",(()=>{L.src="",D(l.c())})),L.fetchPriority="high",L.onload=()=>{L.onerror=L.onload=null,I({data:L})},L.onerror=()=>{L.onerror=L.onload=null,A.signal.aborted||D(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},L.src=O}))})(he||(he={})),he.resetRequestQueue();class fe{constructor(e){this._transformRequestFn=e??null}transformRequest(e,s){return this._transformRequestFn&&this._transformRequestFn(e,s)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function Ae(g){const e=[];if(typeof g=="string")e.push({id:"default",url:g});else if(g&&g.length>0){const s=[];for(const{id:u,url:d}of g){const y=`${u}${d}`;s.indexOf(y)===-1&&(s.push(y),e.push({id:u,url:d}))}}return e}function Fe(g,e,s){try{const u=new URL(g);return u.pathname+=`${e}${s}`,u.toString()}catch{throw new Error(`Invalid sprite URL "${g}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function He(g){const{userImage:e}=g;return!!(e&&e.render&&e.render())&&(g.data.replace(new Uint8Array(e.data.buffer)),!0)}class rt extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:s,promiseResolve:u}of this.requestors)u(this._getImagesForIds(s));this.requestors=[]}}getImage(e){const s=this.images[e];if(s&&!s.data&&s.spriteData){const u=s.spriteData;s.data=new l.R({width:u.width,height:u.height},u.context.getImageData(u.x,u.y,u.width,u.height).data),s.spriteData=null}return s}addImage(e,s){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,s)&&(this.images[e]=s)}_validate(e,s){let u=!0;const d=s.data||s.spriteData;return this._validateStretch(s.stretchX,d&&d.width)||(this.fire(new l.k(new Error(`Image "${e}" has invalid "stretchX" value`))),u=!1),this._validateStretch(s.stretchY,d&&d.height)||(this.fire(new l.k(new Error(`Image "${e}" has invalid "stretchY" value`))),u=!1),this._validateContent(s.content,s)||(this.fire(new l.k(new Error(`Image "${e}" has invalid "content" value`))),u=!1),u}_validateStretch(e,s){if(!e)return!0;let u=0;for(const d of e){if(d[0]<u||d[1]<d[0]||s<d[1])return!1;u=d[1]}return!0}_validateContent(e,s){if(!e)return!0;if(e.length!==4)return!1;const u=s.spriteData,d=u&&u.width||s.data.width,y=u&&u.height||s.data.height;return!(e[0]<0||d<e[0]||e[1]<0||y<e[1]||e[2]<0||d<e[2]||e[3]<0||y<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,s,u=!0){const d=this.getImage(e);if(u&&(d.data.width!==s.data.width||d.data.height!==s.data.height))throw new Error(`size mismatch between old image (${d.data.width}x${d.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=d.version+1,this.images[e]=s,this.updatedImages[e]=!0}removeImage(e){const s=this.images[e];delete this.images[e],delete this.patterns[e],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise(((s,u)=>{let d=!0;if(!this.isLoaded())for(const y of e)this.images[y]||(d=!1);this.isLoaded()||d?s(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:s})}))}_getImagesForIds(e){const s={};for(const u of e){let d=this.getImage(u);d||(this.fire(new l.l("styleimagemissing",{id:u})),d=this.getImage(u)),d?s[u]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,textFitWidth:d.textFitWidth,textFitHeight:d.textFitHeight,hasRenderCallback:!!(d.userImage&&d.userImage.render)}:l.w(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return s}getPixelSize(){const{width:e,height:s}=this.atlasImage;return{width:e,height:s}}getPattern(e){const s=this.patterns[e],u=this.getImage(e);if(!u)return null;if(s&&s.position.version===u.version)return s.position;if(s)s.position.version=u.version;else{const d={w:u.data.width+2,h:u.data.height+2,x:0,y:0},y=new l.I(d,u);this.patterns[e]={bin:d,position:y}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const s=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new l.T(e,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const y in this.patterns)e.push(this.patterns[y].bin);const{w:s,h:u}=l.p(e),d=this.atlasImage;d.resize({width:s||1,height:u||1});for(const y in this.patterns){const{bin:x}=this.patterns[y],S=x.x+1,k=x.y+1,A=this.getImage(y).data,I=A.width,D=A.height;l.R.copy(A,d,{x:0,y:0},{x:S,y:k},{width:I,height:D}),l.R.copy(A,d,{x:0,y:D-1},{x:S,y:k-1},{width:I,height:1}),l.R.copy(A,d,{x:0,y:0},{x:S,y:k+D},{width:I,height:1}),l.R.copy(A,d,{x:I-1,y:0},{x:S-1,y:k},{width:1,height:D}),l.R.copy(A,d,{x:0,y:0},{x:S+I,y:k},{width:1,height:D})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const s of e){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const u=this.getImage(s);u||l.w(`Image with ID: "${s}" was not found`),He(u)&&this.updateImage(s,u)}}}const et=1e20;function It(g,e,s,u,d,y,x,S,k){for(let A=e;A<e+u;A++)bt(g,s*y+A,y,d,x,S,k);for(let A=s;A<s+d;A++)bt(g,A*y+e,1,u,x,S,k)}function bt(g,e,s,u,d,y,x){y[0]=0,x[0]=-et,x[1]=et,d[0]=g[e];for(let S=1,k=0,A=0;S<u;S++){d[S]=g[e+S*s];const I=S*S;do{const D=y[k];A=(d[S]-d[D]+I-D*D)/(S-D)/2}while(A<=x[k]&&--k>-1);k++,y[k]=S,x[k]=A,x[k+1]=et}for(let S=0,k=0;S<u;S++){for(;x[k+1]<S;)k++;const A=y[k],I=S-A;g[e+S*s]=d[A]+I*I}}class er{constructor(e,s){this.requestManager=e,this.localIdeographFontFamily=s,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return l._(this,void 0,void 0,(function*(){const s=[];for(const y in e)for(const x of e[y])s.push(this._getAndCacheGlyphsPromise(y,x));const u=yield Promise.all(s),d={};for(const{stack:y,id:x,glyph:S}of u)d[y]||(d[y]={}),d[y][x]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics};return d}))}_getAndCacheGlyphsPromise(e,s){return l._(this,void 0,void 0,(function*(){let u=this.entries[e];u||(u=this.entries[e]={glyphs:{},requests:{},ranges:{}});let d=u.glyphs[s];if(d!==void 0)return{stack:e,id:s,glyph:d};if(d=this._tinySDF(u,e,s),d)return u.glyphs[s]=d,{stack:e,id:s,glyph:d};const y=Math.floor(s/256);if(256*y>65535)throw new Error("glyphs > 65535 not supported");if(u.ranges[y])return{stack:e,id:s,glyph:d};if(!this.url)throw new Error("glyphsUrl is not set");if(!u.requests[y]){const S=er.loadGlyphRange(e,y,this.url,this.requestManager);u.requests[y]=S}const x=yield u.requests[y];for(const S in x)this._doesCharSupportLocalGlyph(+S)||(u.glyphs[+S]=x[+S]);return u.ranges[y]=!0,{stack:e,id:s,glyph:x[s]||null}}))}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))||l.u["CJK Unified Ideographs"](e)||l.u["Hangul Syllables"](e)||l.u.Hiragana(e)||l.u.Katakana(e)||l.u["CJK Symbols and Punctuation"](e)||l.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,s,u){const d=this.localIdeographFontFamily;if(!d||!this._doesCharSupportLocalGlyph(u))return;let y=e.tinySDF;if(!y){let S="400";/bold/i.test(s)?S="900":/medium/i.test(s)?S="500":/light/i.test(s)&&(S="200"),y=e.tinySDF=new er.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:d,fontWeight:S})}const x=y.draw(String.fromCharCode(u));return{id:u,bitmap:new l.q({width:x.width||60,height:x.height||60},x.data),metrics:{width:x.glyphWidth/2||24,height:x.glyphHeight/2||24,left:x.glyphLeft/2+.5||0,top:x.glyphTop/2-27.5||-8,advance:x.glyphAdvance/2||24,isDoubleResolution:!0}}}}er.loadGlyphRange=function(g,e,s,u){return l._(this,void 0,void 0,(function*(){const d=256*e,y=d+255,x=u.transformRequest(s.replace("{fontstack}",g).replace("{range}",`${d}-${y}`),"Glyphs"),S=yield l.n(x,new AbortController);if(!S||!S.data)throw new Error(`Could not load glyph range. range: ${e}, ${d}-${y}`);const k={};for(const A of l.o(S.data))k[A.id]=A;return k}))},er.TinySDF=class{constructor({fontSize:g=24,buffer:e=3,radius:s=8,cutoff:u=.25,fontFamily:d="sans-serif",fontWeight:y="normal",fontStyle:x="normal",lang:S=null}={}){this.buffer=e,this.cutoff=u,this.radius=s,this.lang=S;const k=this.size=g+4*e,A=this._createCanvas(k),I=this.ctx=A.getContext("2d",{willReadFrequently:!0});I.font=`${x} ${y} ${g}px ${d}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(k*k),this.gridInner=new Float64Array(k*k),this.f=new Float64Array(k),this.z=new Float64Array(k+1),this.v=new Uint16Array(k)}_createCanvas(g){const e=document.createElement("canvas");return e.width=e.height=g,e}draw(g){const{width:e,actualBoundingBoxAscent:s,actualBoundingBoxDescent:u,actualBoundingBoxLeft:d,actualBoundingBoxRight:y}=this.ctx.measureText(g),x=Math.ceil(s),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-d))),k=Math.min(this.size-this.buffer,x+Math.ceil(u)),A=S+2*this.buffer,I=k+2*this.buffer,D=Math.max(A*I,0),L=new Uint8ClampedArray(D),O={data:L,width:A,height:I,glyphWidth:S,glyphHeight:k,glyphTop:x,glyphLeft:0,glyphAdvance:e};if(S===0||k===0)return O;const{ctx:U,buffer:K,gridInner:X,gridOuter:Y}=this;this.lang&&(U.lang=this.lang),U.clearRect(K,K,S,k),U.fillText(g,K,K+x);const ee=U.getImageData(K,K,S,k);Y.fill(et,0,D),X.fill(0,0,D);for(let ne=0;ne<k;ne++)for(let te=0;te<S;te++){const oe=ee.data[4*(ne*S+te)+3]/255;if(oe===0)continue;const ce=(ne+K)*A+te+K;if(oe===1)Y[ce]=0,X[ce]=et;else{const re=.5-oe;Y[ce]=re>0?re*re:0,X[ce]=re<0?re*re:0}}It(Y,0,0,A,I,A,this.f,this.v,this.z),It(X,K,K,S,k,A,this.f,this.v,this.z);for(let ne=0;ne<D;ne++){const te=Math.sqrt(Y[ne])-Math.sqrt(X[ne]);L[ne]=Math.round(255-255*(te/this.radius+this.cutoff))}return O}};class dr{constructor(){this.specification=l.v.light.position}possiblyEvaluate(e,s){return l.B(e.expression.evaluate(s))}interpolate(e,s,u){return{x:l.C.number(e.x,s.x,u),y:l.C.number(e.y,s.y,u),z:l.C.number(e.z,s.z,u)}}}let Lr;class hi extends l.E{constructor(e){super(),Lr=Lr||new l.r({anchor:new l.D(l.v.light.anchor),position:new dr,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.t(Lr),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,s={}){if(!this._validate(l.x,e,s))for(const u in e){const d=e[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),d):this._transitionable.setValue(u,d)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,u){return(!u||u.validate!==!1)&&l.y(this,e.call(l.z,{value:s,style:{glyphs:!0,sprite:!0},styleSpec:l.v}))}}const bi=new l.r({"sky-color":new l.D(l.v.sky["sky-color"]),"horizon-color":new l.D(l.v.sky["horizon-color"]),"fog-color":new l.D(l.v.sky["fog-color"]),"fog-ground-blend":new l.D(l.v.sky["fog-ground-blend"]),"horizon-fog-blend":new l.D(l.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new l.D(l.v.sky["sky-horizon-blend"]),"atmosphere-blend":new l.D(l.v.sky["atmosphere-blend"])});class fr extends l.E{constructor(e){super(),this._transitionable=new l.t(bi),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.F(0))}setSky(e,s={}){if(!this._validate(l.G,e,s)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const u in e){const d=e[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),d):this._transitionable.setValue(u,d)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,u={}){return u?.validate!==!1&&l.y(this,e.call(l.z,l.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:l.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class At{constructor(e,s){this.width=e,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,s){const u=e.join(",")+String(s);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(e,s)),this.dashEntry[u]}getDashRanges(e,s,u){const d=[];let y=e.length%2==1?-e[e.length-1]*u:0,x=e[0]*u,S=!0;d.push({left:y,right:x,isDash:S,zeroLength:e[0]===0});let k=e[0];for(let A=1;A<e.length;A++){S=!S;const I=e[A];y=k*u,k+=I,x=k*u,d.push({left:y,right:x,isDash:S,zeroLength:I===0})}return d}addRoundDash(e,s,u){const d=s/2;for(let y=-u;y<=u;y++){const x=this.width*(this.nextRow+u+y);let S=0,k=e[S];for(let A=0;A<this.width;A++){A/k.right>1&&(k=e[++S]);const I=Math.abs(A-k.left),D=Math.abs(A-k.right),L=Math.min(I,D);let O;const U=y/u*(d+1);if(k.isDash){const K=d-Math.abs(U);O=Math.sqrt(L*L+K*K)}else O=d-Math.sqrt(L*L+U*U);this.data[x+A]=Math.max(0,Math.min(255,O+128))}}}addRegularDash(e){for(let S=e.length-1;S>=0;--S){const k=e[S],A=e[S+1];k.zeroLength?e.splice(S,1):A&&A.isDash===k.isDash&&(A.left=k.left,e.splice(S,1))}const s=e[0],u=e[e.length-1];s.isDash===u.isDash&&(s.left=u.left-this.width,u.right=s.right+this.width);const d=this.width*this.nextRow;let y=0,x=e[y];for(let S=0;S<this.width;S++){S/x.right>1&&(x=e[++y]);const k=Math.abs(S-x.left),A=Math.abs(S-x.right),I=Math.min(k,A);this.data[d+S]=Math.max(0,Math.min(255,(x.isDash?I:-I)+128))}}addDash(e,s){const u=s?7:0,d=2*u+1;if(this.nextRow+d>this.height)return l.w("LineAtlas out of space"),null;let y=0;for(let S=0;S<e.length;S++)y+=e[S];if(y!==0){const S=this.width/y,k=this.getDashRanges(e,this.width,S);s?this.addRoundDash(k,S,u):this.addRegularDash(k)}const x={y:(this.nextRow+u+.5)/this.height,height:2*u/this.height,width:y};return this.nextRow+=d,this.dirty=!0,x}bind(e){const s=e.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}const Qe="maplibre_preloaded_worker_pool";class lt{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<lt.workerCount;)this.workers.push(new Worker(l.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach((s=>{s.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Qe]}numActive(){return Object.keys(this.active).length}}const xt=Math.floor(G.hardwareConcurrency/2);let gt,yt;function Kt(){return gt||(gt=new lt),gt}lt.workerCount=l.H(globalThis)?Math.max(Math.min(xt,3),1):1;class Et{constructor(e,s){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=s;const u=this.workerPool.acquire(s);for(let d=0;d<u.length;d++){const y=new l.J(u[d],s);y.name=`Worker ${d}`,this.actors.push(y)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,s){const u=[];for(const d of this.actors)u.push(d.sendAsync({type:e,data:s}));return Promise.all(u)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach((s=>{s.remove()})),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,s){for(const u of this.actors)u.registerMessageHandler(e,s)}}function br(){return yt||(yt=new Et(Kt(),l.K),yt.registerMessageHandler("GR",((g,e,s)=>l.m(e,s)))),yt}function nr(g,e){const s=l.L();return l.M(s,s,[1,1,0]),l.N(s,s,[.5*g.width,.5*g.height,1]),g.calculatePosMatrix?l.O(s,s,g.calculatePosMatrix(e.toUnwrapped())):s}function Mr(g,e,s,u,d,y,x){var S;const k=(function(L,O,U){if(L)for(const K of L){const X=O[K];if(X&&X.source===U&&X.type==="fill-extrusion")return!0}else for(const K in O){const X=O[K];if(X.source===U&&X.type==="fill-extrusion")return!0}return!1})((S=d?.layers)!==null&&S!==void 0?S:null,e,g.id),A=y.maxPitchScaleFactor(),I=g.tilesIn(u,A,k);I.sort(xi);const D=[];for(const L of I)D.push({wrappedTileID:L.tileID.wrapped().key,queryResults:L.tile.queryRenderedFeatures(e,s,g._state,L.queryGeometry,L.cameraQueryGeometry,L.scale,d,y,A,nr(g.transform,L.tileID),x?(O,U)=>x(L.tileID,O,U):void 0)});return(function(L,O){for(const U in L)for(const K of L[U])Tr(K,O);return L})((function(L){const O={},U={};for(const K of L){const X=K.queryResults,Y=K.wrappedTileID,ee=U[Y]=U[Y]||{};for(const ne in X){const te=X[ne],oe=ee[ne]=ee[ne]||{},ce=O[ne]=O[ne]||[];for(const re of te)oe[re.featureIndex]||(oe[re.featureIndex]=!0,ce.push(re))}}return O})(D),g)}function xi(g,e){const s=g.tileID,u=e.tileID;return s.overscaledZ-u.overscaledZ||s.canonical.y-u.canonical.y||s.wrap-u.wrap||s.canonical.x-u.canonical.x}function Tr(g,e){const s=g.feature,u=e.getFeatureState(s.layer["source-layer"],s.id);s.source=s.layer.source,s.layer["source-layer"]&&(s.sourceLayer=s.layer["source-layer"]),s.state=u}function gr(g,e,s){return l._(this,void 0,void 0,(function*(){let u=g;if(g.url?u=(yield l.j(e.transformRequest(g.url,"Source"),s)).data:yield G.frameAsync(s),!u)return null;const d=l.Q(l.e(u,g),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in u&&u.vector_layers&&(d.vectorLayerIds=u.vector_layers.map((y=>y.id))),d}))}class Yt{constructor(e,s){e&&(s?this.setSouthWest(e).setNorthEast(s):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof l.S?new l.S(e.lng,e.lat):l.S.convert(e),this}setSouthWest(e){return this._sw=e instanceof l.S?new l.S(e.lng,e.lat):l.S.convert(e),this}extend(e){const s=this._sw,u=this._ne;let d,y;if(e instanceof l.S)d=e,y=e;else{if(!(e instanceof Yt))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Yt.convert(e)):this.extend(l.S.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(l.S.convert(e)):this;if(d=e._sw,y=e._ne,!d||!y)return this}return s||u?(s.lng=Math.min(d.lng,s.lng),s.lat=Math.min(d.lat,s.lat),u.lng=Math.max(y.lng,u.lng),u.lat=Math.max(y.lat,u.lat)):(this._sw=new l.S(d.lng,d.lat),this._ne=new l.S(y.lng,y.lat)),this}getCenter(){return new l.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.S(this.getWest(),this.getNorth())}getSouthEast(){return new l.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:s,lat:u}=l.S.convert(e);let d=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&d}static convert(e){return e instanceof Yt?e:e&&new Yt(e)}static fromLngLat(e,s=0){const u=360*s/40075017,d=u/Math.cos(Math.PI/180*e.lat);return new Yt(new l.S(e.lng-d,e.lat-u),new l.S(e.lng+d,e.lat+u))}adjustAntiMeridian(){const e=new l.S(this._sw.lng,this._sw.lat),s=new l.S(this._ne.lng,this._ne.lat);return new Yt(e,e.lng>s.lng?new l.S(s.lng+360,s.lat):s)}}class ar{constructor(e,s,u){this.bounds=Yt.convert(this.validateBounds(e)),this.minzoom=s||0,this.maxzoom=u||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const s=Math.pow(2,e.z),u=Math.floor(l.V(this.bounds.getWest())*s),d=Math.floor(l.U(this.bounds.getNorth())*s),y=Math.ceil(l.V(this.bounds.getEast())*s),x=Math.ceil(l.U(this.bounds.getSouth())*s);return e.x>=u&&e.x<y&&e.y>=d&&e.y<x}}class Hr extends l.E{constructor(e,s,u,d){if(super(),this.id=e,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.Q(s,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d)}load(){return l._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield gr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(l.e(this,e),e.bounds&&(this.tileBounds=new ar(e.bounds,this.minzoom,this.maxzoom)),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new l.k(e))}}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(e){return l._(this,void 0,void 0,(function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(s,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};u.request.collectResourceTiming=this._collectResourceTiming;let d="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise(((y,x)=>{e.reloadPromise={resolve:y,reject:x}}))}else e.actor=this.dispatcher.getActor(),d="LT";e.abortController=new AbortController;try{const y=yield e.actor.sendAsync({type:d,data:u},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,y)}catch(y){if(delete e.abortController,e.aborted)return;if(y&&y.status!==404)throw y;this._afterTileLoadWorkerResponse(e,null)}}))}_afterTileLoadWorkerResponse(e,s){if(s&&s.resourceTiming&&(e.resourceTiming=s.resourceTiming),s&&this.map._refreshExpiredTiles&&e.setExpiryData(s),e.loadVectorData(s,this.map.painter),e.reloadPromise){const u=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(u.resolve).catch(u.reject)}}abortTile(e){return l._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}unloadTile(e){return l._(this,void 0,void 0,(function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class qi extends l.E{constructor(e,s,u,d){super(),this.id=e,this.dispatcher=u,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},s),l.e(this,l.Q(s,["url","scheme","tileSize"]))}load(){return l._(this,arguments,void 0,(function*(e=!1){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const s=yield gr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,s&&(l.e(this,s),s.bounds&&(this.tileBounds=new ar(s.bounds,this.minzoom,this.maxzoom)),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(s){this._tileJSONRequest=null,this.fire(new l.k(s))}}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}serialize(){return l.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return l._(this,void 0,void 0,(function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const u=yield he.getImage(this.map._requestManager.transformRequest(s,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(u&&u.data){this.map._refreshExpiredTiles&&(u.cacheControl||u.expires)&&e.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const d=this.map.painter.context,y=d.gl,x=u.data;e.texture=this.map.painter.getTileTexture(x.width),e.texture?e.texture.update(x,{useMipmap:!0}):(e.texture=new l.T(d,x,y.RGBA,{useMipmap:!0}),e.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(u){if(delete e.abortController,e.aborted)e.state="unloaded";else if(u)throw e.state="errored",u}}))}abortTile(e){return l._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)}))}unloadTile(e){return l._(this,void 0,void 0,(function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)}))}hasTransition(){return!1}}class so extends qi{constructor(e,s,u,d){super(e,s,u,d),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox",this.redFactor=s.redFactor,this.greenFactor=s.greenFactor,this.blueFactor=s.blueFactor,this.baseShift=s.baseShift}loadTile(e){return l._(this,void 0,void 0,(function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u=this.map._requestManager.transformRequest(s,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const d=yield he.getImage(u,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(d&&d.data){const y=d.data;this.map._refreshExpiredTiles&&(d.cacheControl||d.expires)&&e.setExpiryData({cacheControl:d.cacheControl,expires:d.expires});const x=l.b(y)&&l.W()?y:yield this.readImageNow(y),S={type:this.type,uid:e.uid,source:this.id,rawImageData:x,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const k=yield e.actor.sendAsync({type:"LDT",data:S});e.dem=k,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(d){if(delete e.abortController,e.aborted)e.state="unloaded";else if(d)throw e.state="errored",d}}))}readImageNow(e){return l._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&l.X()){const s=e.width+2,u=e.height+2;try{return new l.R({width:s,height:u},yield l.Y(e,-1,-1,s,u))}catch{}}return G.getImageData(e,1)}))}_getNeighboringTiles(e){const s=e.canonical,u=Math.pow(2,s.z),d=(s.x-1+u)%u,y=s.x===0?e.wrap-1:e.wrap,x=(s.x+1+u)%u,S=s.x+1===u?e.wrap+1:e.wrap,k={};return k[new l.Z(e.overscaledZ,y,s.z,d,s.y).key]={backfilled:!1},k[new l.Z(e.overscaledZ,S,s.z,x,s.y).key]={backfilled:!1},s.y>0&&(k[new l.Z(e.overscaledZ,y,s.z,d,s.y-1).key]={backfilled:!1},k[new l.Z(e.overscaledZ,e.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},k[new l.Z(e.overscaledZ,S,s.z,x,s.y-1).key]={backfilled:!1}),s.y+1<u&&(k[new l.Z(e.overscaledZ,y,s.z,d,s.y+1).key]={backfilled:!1},k[new l.Z(e.overscaledZ,e.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},k[new l.Z(e.overscaledZ,S,s.z,x,s.y+1).key]={backfilled:!1}),k}unloadTile(e){return l._(this,void 0,void 0,(function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))}))}}class qn extends l.E{constructor(e,s,u,d){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:s.data},this.actor=u.getActor(),this.setEventedParent(d),this._data=s.data,this._options=l.e({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId,s.clusterMaxZoom!==void 0&&this.maxzoom<=s.clusterMaxZoom&&l.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${s.clusterMaxZoom}".`),this.workerOptions=l.e({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(s.buffer!==void 0?s.buffer:128),tolerance:this._pixelsToTileUnits(s.tolerance!==void 0?s.tolerance:.375),extent:l.$,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(s.clusterMaxZoom),minPoints:Math.max(2,s.clusterMinPoints||2),extent:l.$,radius:this._pixelsToTileUnits(s.clusterRadius||50),log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(l.$/this.tileSize)}_getClusterMaxZoom(e){const s=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||e===void 0||l.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${s}"`),s}load(){return l._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._pendingWorkerUpdate={data:e},this._updateWorkerData(),this}updateData(e){return this._pendingWorkerUpdate.diff=l.a0(this._pendingWorkerUpdate.diff,e),this._updateWorkerData(),this}getData(){return l._(this,void 0,void 0,(function*(){const e=l.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})}))}getCoordinatesFromGeometry(e){return e.type==="GeometryCollection"?e.geometries.map((s=>s.coordinates)).flat(1/0):e.coordinates.flat(1/0)}getBounds(){return l._(this,void 0,void 0,(function*(){const e=new Yt,s=yield this.getData();let u;switch(s.type){case"FeatureCollection":u=s.features.map((d=>this.getCoordinatesFromGeometry(d.geometry))).flat(1/0);break;case"Feature":u=this.getCoordinatesFromGeometry(s.geometry);break;default:u=this.getCoordinatesFromGeometry(s)}if(u.length==0)return e;for(let d=0;d<u.length-1;d+=2)e.extend([u[d],u[d+1]]);return e}))}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,s,u){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:s,offset:u}})}_updateWorkerData(){return l._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;const{data:e,diff:s}=this._pendingWorkerUpdate;if(!e&&!s)return void l.w(`No data or diff provided to GeoJSONSource ${this.id}.`);const u=l.e({type:this.type},this.workerOptions);e?(typeof e=="string"?(u.request=this.map._requestManager.transformRequest(G.resolveURL(e),"Source"),u.request.collectResourceTiming=this._collectResourceTiming):u.data=JSON.stringify(e),this._pendingWorkerUpdate.data=void 0):s&&(u.dataDiff=s,this._pendingWorkerUpdate.diff=void 0),this._isUpdatingWorker=!0,this.fire(new l.l("dataloading",{dataType:"source"}));try{const d=yield this.actor.sendAsync({type:"LD",data:u});if(this._isUpdatingWorker=!1,this._removed||d.abandoned)return void this.fire(new l.l("dataabort",{dataType:"source"}));this._data=d.data;let y=null;d.resourceTiming&&d.resourceTiming[this.id]&&(y=d.resourceTiming[this.id].slice(0));const x={dataType:"source"};this._collectResourceTiming&&y&&y.length>0&&l.e(x,{resourceTiming:y}),this.fire(new l.l("data",Object.assign(Object.assign({},x),{sourceDataType:"metadata"}))),this.fire(new l.l("data",Object.assign(Object.assign({},x),{sourceDataType:"content"})))}catch(d){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new l.l("dataabort",{dataType:"source"}));this.fire(new l.k(d))}finally{(this._pendingWorkerUpdate.data||this._pendingWorkerUpdate.diff)&&this._updateWorkerData()}}))}loaded(){return!this._isUpdatingWorker&&this._pendingWorkerUpdate.data===void 0&&this._pendingWorkerUpdate.diff===void 0}loadTile(e){return l._(this,void 0,void 0,(function*(){const s=e.actor?"RT":"LT";e.actor=this.actor;const u={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};e.abortController=new AbortController;const d=yield this.actor.sendAsync({type:s,data:u},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(d,this.map.painter,s==="RT")}))}abortTile(e){return l._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0}))}unloadTile(e){return l._(this,void 0,void 0,(function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Gn extends l.E{constructor(e,s,u,d){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=u,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(d),this.options=s}load(e){return l._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const s=yield he.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,s&&s.data&&(this.image=s.data,e&&(this.coordinates=e),this._finishLoading())}catch(s){this._request=null,this._loaded=!0,this.fire(new l.k(s))}}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const s=e.map(l.a1.fromLngLat);var u;return this.tileID=(function(d){const y=l.a2.fromPoints(d),x=y.width(),S=y.height(),k=Math.max(x,S),A=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),I=Math.pow(2,A);return new l.a4(A,Math.floor((y.minX+y.maxX)/2*I),Math.floor((y.minY+y.maxY)/2*I))})(s),this.terrainTileRanges=this._getOverlappingTileRanges(s),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=s.map((d=>this.tileID.getTilePoint(d)._round())),this.flippedWindingOrder=((u=this.tileCoords)[1].x-u[0].x)*(u[2].y-u[0].y)-(u[1].y-u[0].y)*(u[2].x-u[0].x)<0,this.fire(new l.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,s=e.gl;this.texture||(this.texture=new l.T(e,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let u=!1;for(const d in this.tiles){const y=this.tiles[d];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,u=!0)}u&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return l._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){const{minX:s,minY:u,maxX:d,maxY:y}=l.a2.fromPoints(e),x={};for(let S=0;S<=l.a3;S++){const k=Math.pow(2,S),A=Math.floor(s*k),I=Math.floor(u*k),D=Math.floor(d*k),L=Math.floor(y*k);x[S]={minTileX:A,minTileY:I,maxTileX:D,maxTileY:L}}return x}}class Zo extends Gn{constructor(e,s,u,d){super(e,s,u,d),this.roundZoom=!0,this.type="video",this.options=s}load(){return l._(this,void 0,void 0,(function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const s of e.urls)this.urls.push(this.map._requestManager.transformRequest(s,"Source").url);try{const s=yield l.a5(this.urls);if(this._loaded=!0,!s)return;this.video=s,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(s){this.fire(new l.k(s))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const s=this.video.seekable;e<s.start(0)||e>s.end(0)?this.fire(new l.k(new l.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,s=e.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new l.T(e,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let u=!1;for(const d in this.tiles){const y=this.tiles[d];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,u=!0)}u&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Ia extends Gn{constructor(e,s,u,d){super(e,s,u,d),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some((y=>!Array.isArray(y)||y.length!==2||y.some((x=>typeof x!="number"))))||this.fire(new l.k(new l.a6(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.k(new l.a6(`sources.${e}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new l.k(new l.a6(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new l.k(new l.a6(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.k(new l.a6(`sources.${e}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){return l._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,u=s.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new l.T(s,this.canvas,u.RGBA,{premultiply:!0});let d=!1;for(const y in this.tiles){const x=this.tiles[y];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,d=!0)}d&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const za={},Ra=g=>{switch(g){case"geojson":return qn;case"image":return Gn;case"raster":return qi;case"raster-dem":return so;case"vector":return Hr;case"video":return Zo;case"canvas":return Ia}return za[g]},lo="RTLPluginLoaded";class La extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=br()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch((s=>{throw this.status="error",s}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return l._(this,arguments,void 0,(function*(s,u=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=G.resolveURL(s),!this.url)throw new Error(`requested url ${s} is invalid`);if(this.status==="unavailable"){if(!u)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return l._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.l(lo))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Da=null;function Fa(){return Da||(Da=new La),Da}class Wo{constructor(e,s){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=l.a7(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const s=e+this.timeAdded;s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,s,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=(function(d,y){const x={};if(!y)return x;for(const S of d){const k=S.layerIds.map((A=>y.getLayer(A))).filter(Boolean);if(k.length!==0){S.layers=k,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map((A=>k.filter((I=>I.id===A))[0])));for(const A of k)x[A.id]=S}}return x})(e.buckets,s?.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const y=this.buckets[d];if(y instanceof l.a9){if(this.hasSymbolBuckets=!0,!u)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const y=this.buckets[d];if(y instanceof l.a9&&y.hasRTLText){this.hasRTLText=!0,Fa().lazyLoad();break}}this.queryPadding=0;for(const d in this.buckets){const y=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(d).queryRadius(y))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new l.a8}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const u in this.buckets){const d=this.buckets[u];d.uploadPending()&&d.upload(e)}const s=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new l.T(e,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new l.T(e,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,s,u,d,y,x,S,k,A,I,D){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:d,cameraQueryGeometry:y,scale:x,tileSize:this.tileSize,pixelPosMatrix:I,transform:k,params:S,queryPadding:this.queryPadding*A,getElevation:D},e,s,u):{}}querySourceFeatures(e,s){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const d=u.loadVTLayers(),y=s&&s.sourceLayer?s.sourceLayer:"",x=d._geojsonTileLayer||d[y];if(!x)return;const S=l.aa(s&&s.filter),{z:k,x:A,y:I}=this.tileID.canonical,D={z:k,x:A,y:I};for(let L=0;L<x.length;L++){const O=x.feature(L);if(S.needGeometry){const X=l.ab(O,!0);if(!S.filter(new l.F(this.tileID.overscaledZ),X,this.tileID.canonical))continue}else if(!S.filter(new l.F(this.tileID.overscaledZ),O))continue;const U=u.getId(O,y),K=new l.ac(O,k,A,I,U);K.tile=D,e.push(K)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const s=this.expirationTime;if(e.cacheControl){const u=l.ad(e.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const u=Date.now();let d=!1;if(this.expirationTime>u)d=!1;else if(s)if(this.expirationTime<s)d=!0;else{const y=this.expirationTime-s;y?this.expirationTime=u+Math.max(y,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const u=this.latestFeatureIndex.loadVTLayers();for(const d in this.buckets){if(!s.style.hasLayer(d))continue;const y=this.buckets[d],x=y.layers[0].sourceLayer||"_geojsonTileLayer",S=u[x],k=e[x];if(!S||!k||Object.keys(k).length===0)continue;y.update(k,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});const A=s&&s.style&&s.style.getLayer(d);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<G.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=G.now()+e}setDependencies(e,s){const u={};for(const d of s)u[d]=!0;this.dependencies[e]=u}hasDependency(e,s){for(const u of e){const d=this.dependencies[u];if(d){for(const y of s)if(d[y])return!0}}return!1}}class ge{constructor(e,s){this.max=e,this.onRemove=s,this.reset()}reset(){for(const e in this.data)for(const s of this.data[e])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(e,s,u){const d=e.wrapped().key;this.data[d]===void 0&&(this.data[d]=[]);const y={value:s,timeout:void 0};if(u!==void 0&&(y.timeout=setTimeout((()=>{this.remove(e,y)}),u)),this.data[d].push(y),this.order.push(d),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const s=this.data[e].shift();return s.timeout&&clearTimeout(s.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),s.value}getByKey(e){const s=this.data[e];return s?s[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,s){if(!this.has(e))return this;const u=e.wrapped().key,d=s===void 0?0:this.data[u].indexOf(s),y=this.data[u][d];return this.data[u].splice(d,1),y.timeout&&clearTimeout(y.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(y.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(e){const s=[];for(const u in this.data)for(const d of this.data[u])e(d.value)||s.push(d);for(const u of s)this.remove(u.value.tileID,u)}}class V{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,s,u){const d=String(s);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][d]=this.stateChanges[e][d]||{},l.e(this.stateChanges[e][d],u),this.deletedStates[e]===null){this.deletedStates[e]={};for(const y in this.state[e])y!==d&&(this.deletedStates[e][y]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][d]===null){this.deletedStates[e][d]={};for(const y in this.state[e][d])u[y]||(this.deletedStates[e][d][y]=null)}else for(const y in u)this.deletedStates[e]&&this.deletedStates[e][d]&&this.deletedStates[e][d][y]===null&&delete this.deletedStates[e][d][y]}removeFeatureState(e,s,u){if(this.deletedStates[e]===null)return;const d=String(s);if(this.deletedStates[e]=this.deletedStates[e]||{},u&&s!==void 0)this.deletedStates[e][d]!==null&&(this.deletedStates[e][d]=this.deletedStates[e][d]||{},this.deletedStates[e][d][u]=null);else if(s!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][d])for(u in this.deletedStates[e][d]={},this.stateChanges[e][d])this.deletedStates[e][d][u]=null;else this.deletedStates[e][d]=null;else this.deletedStates[e]=null}getState(e,s){const u=String(s),d=l.e({},(this.state[e]||{})[u],(this.stateChanges[e]||{})[u]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const y=this.deletedStates[e][s];if(y===null)return{};for(const x in y)delete d[x]}return d}initializeTileState(e,s){e.setFeatureState(this.state,s)}coalesceChanges(e,s){const u={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const y={};for(const x in this.stateChanges[d])this.state[d][x]||(this.state[d][x]={}),l.e(this.state[d][x],this.stateChanges[d][x]),y[x]=this.state[d][x];u[d]=y}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const y={};if(this.deletedStates[d]===null)for(const x in this.state[d])y[x]={},this.state[d][x]={};else for(const x in this.deletedStates[d]){if(this.deletedStates[d][x]===null)this.state[d][x]={};else for(const S of Object.keys(this.deletedStates[d][x]))delete this.state[d][x][S];y[x]=this.state[d][x]}u[d]=u[d]||{},l.e(u[d],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const d in e)e[d].setFeatureState(u,s)}}const Z=89.25;function W(g,e){const s=l.ah(e.lat,-l.ai,l.ai);return new l.P(l.V(e.lng)*g,l.U(s)*g)}function ie(g,e){return new l.a1(e.x/g,e.y/g).toLngLat()}function ue(g){return g.cameraToCenterDistance*Math.min(.85*Math.tan(l.ae(90-g.pitch)),Math.tan(l.ae(Z-g.pitch)))}function ye(g,e){const s=g.canonical,u=e/l.af(s.z),d=s.x+Math.pow(2,s.z)*g.wrap,y=l.ag(new Float64Array(16));return l.M(y,y,[d*u,s.y*u,0]),l.N(y,y,[u/l.$,u/l.$,1]),y}function Ce(g,e,s,u,d){const y=l.a1.fromLngLat(g,e),x=d*l.aj(1,g.lat),S=x*Math.cos(l.ae(s)),k=Math.sqrt(x*x-S*S),A=k*Math.sin(l.ae(-u)),I=k*Math.cos(l.ae(-u));return new l.a1(y.x+A,y.y+I,y.z+S)}function ve(g,e,s){const u=e.intersectsFrustum(g);if(!s||u===0)return u;const d=e.intersectsPlane(s);return d===0?0:u===2&&d===2?2:1}function Ie(g,e,s){let u=0;const d=(s-e)/10;for(let y=0;y<10;y++)u+=d*Math.pow(Math.cos(e+(y+.5)/10*(s-e)),g);return u}function je(g,e){return function(s,u,d,y,x){const S=2*((g-1)/l.ak(Math.cos(l.ae(Z-x))/Math.cos(l.ae(Z)))-1),k=Math.acos(d/y),A=2*Ie(S-1,0,l.ae(x/2)),I=Math.min(l.ae(Z),k+l.ae(x/2)),D=Ie(S-1,Math.min(I,k-l.ae(x/2)),I),L=Math.atan(u/d),O=Math.hypot(u,d);let U=s;return U+=l.ak(y/O/Math.max(.5,Math.cos(l.ae(x/2)))),U+=S*l.ak(Math.cos(L))/2,U-=l.ak(Math.max(1,D/A/e))/2,U}}const Re=je(9.314,3);function at(g,e){const s=(e.roundZoom?Math.round:Math.floor)(g.zoom+l.ak(g.tileSize/e.tileSize));return Math.max(0,s)}function be(g,e){const s=g.getCameraFrustum(),u=g.getClippingPlane(),d=g.screenPointToMercatorCoordinate(g.getCameraPoint()),y=l.a1.fromLngLat(g.center,g.elevation);d.z=y.z+Math.cos(g.pitchInRadians)*g.cameraToCenterDistance/g.worldSize;const x=g.getCoveringTilesDetailsProvider(),S=x.allowVariableZoom(g,e),k=at(g,e),A=e.minzoom||0,I=e.maxzoom!==void 0?e.maxzoom:g.maxZoom,D=Math.min(Math.max(0,k),I),L=Math.pow(2,D),O=[L*d.x,L*d.y,0],U=[L*y.x,L*y.y,0],K=Math.hypot(y.x-d.x,y.y-d.y),X=Math.abs(y.z-d.z),Y=Math.hypot(K,X),ee=oe=>({zoom:0,x:0,y:0,wrap:oe,fullyVisible:!1}),ne=[],te=[];if(g.renderWorldCopies&&x.allowWorldCopies())for(let oe=1;oe<=3;oe++)ne.push(ee(-oe)),ne.push(ee(oe));for(ne.push(ee(0));ne.length>0;){const oe=ne.pop(),ce=oe.x,re=oe.y;let _e=oe.fullyVisible;const Me={x:ce,y:re,z:oe.zoom},Te=x.getTileBoundingVolume(Me,oe.wrap,g.elevation,e);if(!_e){const Ne=ve(s,Te,u);if(Ne===0)continue;_e=Ne===2}const Se=x.distanceToTile2d(d.x,d.y,Me,Te);let Pe=k;S&&(Pe=(e.calculateTileZoom||Re)(g.zoom+l.ak(g.tileSize/e.tileSize),Se,X,Y,g.fov)),Pe=(e.roundZoom?Math.round:Math.floor)(Pe),Pe=Math.max(0,Pe);const Oe=Math.min(Pe,I);if(oe.wrap=x.getWrap(y,Me,oe.wrap),oe.zoom>=Oe){if(oe.zoom<A)continue;const Ne=D-oe.zoom,Le=O[0]-.5-(ce<<Ne),it=O[1]-.5-(re<<Ne),Pt=e.reparseOverscaled?Math.max(oe.zoom,Pe):oe.zoom;te.push({tileID:new l.Z(oe.zoom===I?Pt:oe.zoom,oe.wrap,oe.zoom,ce,re),distanceSq:l.al([U[0]-.5-ce,U[1]-.5-re]),tileDistanceToCamera:Math.sqrt(Le*Le+it*it)})}else for(let Ne=0;Ne<4;Ne++)ne.push({zoom:oe.zoom+1,x:(ce<<1)+Ne%2,y:(re<<1)+(Ne>>1),wrap:oe.wrap,fullyVisible:_e})}return te.sort(((oe,ce)=>oe.distanceSq-ce.distanceSq)).map((oe=>oe.tileID))}const vt=l.a2.fromPoints([new l.P(0,0),new l.P(l.$,l.$)]);class zt extends l.E{constructor(e,s,u){super(),this.id=e,this.dispatcher=u,this.on("data",(d=>this._dataHandler(d))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((d,y,x,S)=>{const k=new(Ra(y.type))(d,y,x,S);if(k.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${k.id}`);return k})(e,s,u,this),this._tiles={},this._cache=new ge(0,(d=>this._unloadTile(d))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new V,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const s=this._tiles[e];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,s,u){return l._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,s,u)}catch(d){e.state="errored",d.status!==404?this._source.fire(new l.k(d,{tile:e})):this.update(this.transform,this.terrain)}}))}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new l.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const u=this._tiles[s];u.upload(e),u.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((e=>e.tileID)).sort(ct).map((e=>e.key))}getRenderableIds(e){const s=[];for(const u in this._tiles)this._isIdRenderable(u,e)&&s.push(this._tiles[u]);return e?s.sort(((u,d)=>{const y=u.tileID,x=d.tileID,S=new l.P(y.canonical.x,y.canonical.y)._rotate(-this.transform.bearingInRadians),k=new l.P(x.canonical.x,x.canonical.y)._rotate(-this.transform.bearingInRadians);return y.overscaledZ-x.overscaledZ||k.y-S.y||k.x-S.x})).map((u=>u.tileID.key)):s.map((u=>u.tileID)).sort(ct).map((u=>u.key))}hasRenderableParent(e){const s=this.findLoadedParent(e,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(e,s){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(s||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)e?this._reloadTile(s,"expired"):this._tiles[s].state!=="errored"&&this._reloadTile(s,"reloading")}}_reloadTile(e,s){return l._(this,void 0,void 0,(function*(){const u=this._tiles[e];u&&(u.state!=="loading"&&(u.state=s),yield this._loadTile(u,e,s))}))}_tileLoaded(e,s,u){e.timeAdded=G.now(),u==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(s,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new l.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const s=this.getRenderableIds();for(let d=0;d<s.length;d++){const y=s[d];if(e.neighboringTiles&&e.neighboringTiles[y]){const x=this.getTileByID(y);u(e,x),u(x,e)}}function u(d,y){d.needsHillshadePrepare=!0,d.needsTerrainPrepare=!0;let x=y.tileID.canonical.x-d.tileID.canonical.x;const S=y.tileID.canonical.y-d.tileID.canonical.y,k=Math.pow(2,d.tileID.canonical.z),A=y.tileID.key;x===0&&S===0||Math.abs(S)>1||(Math.abs(x)>1&&(Math.abs(x+k)===1?x+=k:Math.abs(x-k)===1&&(x-=k)),y.dem&&d.dem&&(d.dem.backfillBorder(y.dem,x,S),d.neighboringTiles&&d.neighboringTiles[A]&&(d.neighboringTiles[A].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,s,u,d){for(const y in this._tiles){let x=this._tiles[y];if(d[y]||!x.hasData()||x.tileID.overscaledZ<=s||x.tileID.overscaledZ>u)continue;let S=x.tileID;for(;x&&x.tileID.overscaledZ>s+1;){const A=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[A.key],x&&x.hasData()&&(S=A)}let k=S;for(;k.overscaledZ>s;)if(k=k.scaledTo(k.overscaledZ-1),e[k.key]||e[k.canonical.key]){d[S.key]=S;break}}}findLoadedParent(e,s){if(e.key in this._loadedParentTiles){const u=this._loadedParentTiles[e.key];return u&&u.tileID.overscaledZ>=s?u:null}for(let u=e.overscaledZ-1;u>=s;u--){const d=e.scaledTo(u),y=this._getLoadedTile(d);if(y)return y}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const s=this._tiles[e.key];return s&&s.hasData()?s:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const s=Math.ceil(e.width/this._source.tileSize)+1,u=Math.ceil(e.height/this._source.tileSize)+1,d=Math.floor(s*u*(this._maxTileCacheZoomLevels===null?l.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(y)}handleWrapJump(e){const s=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,s){const u={};for(const d in this._tiles){const y=this._tiles[d];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+s),u[y.tileID.key]=y}this._tiles=u;for(const d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(const d in this._tiles)this._setTileReloadTimer(d,this._tiles[d])}}_updateCoveredAndRetainedTiles(e,s,u,d,y,x){const S={},k={},A=Object.keys(e),I=G.now();for(const D of A){const L=e[D],O=this._tiles[D];if(!O||O.fadeEndTime!==0&&O.fadeEndTime<=I)continue;const U=this.findLoadedParent(L,s),K=this.findLoadedSibling(L),X=U||K||null;X&&(this._addTile(X.tileID),S[X.tileID.key]=X.tileID),k[D]=L}this._retainLoadedChildren(k,d,u,e);for(const D in S)e[D]||(this._coveredTiles[D]=!0,e[D]=S[D]);if(x){const D={},L={};for(const O of y)this._tiles[O.key].hasData()?D[O.key]=O:L[O.key]=O;for(const O in L){const U=L[O].children(this._source.maxzoom);this._tiles[U[0].key]&&this._tiles[U[1].key]&&this._tiles[U[2].key]&&this._tiles[U[3].key]&&(D[U[0].key]=e[U[0].key]=U[0],D[U[1].key]=e[U[1].key]=U[1],D[U[2].key]=e[U[2].key]=U[2],D[U[3].key]=e[U[3].key]=U[3],delete L[O])}for(const O in L){const U=L[O],K=this.findLoadedParent(U,this._source.minzoom),X=this.findLoadedSibling(U),Y=K||X||null;if(Y){D[Y.tileID.key]=e[Y.tileID.key]=Y.tileID;for(const ee in D)D[ee].isChildOf(Y.tileID)&&delete D[ee]}}for(const O in this._tiles)D[O]||(this._coveredTiles[O]=!0)}}update(e,s){if(!this._sourceLoaded||this._paused)return;let u;this.transform=e,this.terrain=s,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((I=>new l.Z(I.canonical.z,I.wrap,I.canonical.z,I.canonical.x,I.canonical.y))):(u=be(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(u=u.filter((I=>this._source.hasTile(I))))):u=[];const d=at(e,this._source),y=Math.max(d-zt.maxOverzooming,this._source.minzoom),x=Math.max(d+zt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const I={};for(const D of u)if(D.canonical.z>this._source.minzoom){const L=D.scaledTo(D.canonical.z-1);I[L.key]=L;const O=D.scaledTo(Math.max(this._source.minzoom,Math.min(D.canonical.z,5)));I[O.key]=O}u=u.concat(Object.values(I))}const S=u.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,S&&this.fire(new l.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const k=this._updateRetainedTiles(u,d);St(this._source.type)&&this._updateCoveredAndRetainedTiles(k,y,x,d,u,s);for(const I in k)this._tiles[I].clearFadeHold();const A=l.am(this._tiles,k);for(const I of A){const D=this._tiles[I];D.hasSymbolBuckets&&!D.holdingForFade()?D.setHoldDuration(this.map._fadeDuration):D.hasSymbolBuckets&&!D.symbolFadeFinished()||this._removeTile(I)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,s){var u;const d={},y={},x=Math.max(s-zt.maxOverzooming,this._source.minzoom),S=Math.max(s+zt.maxUnderzooming,this._source.minzoom),k={};for(const A of e){const I=this._addTile(A);d[A.key]=A,I.hasData()||s<this._source.maxzoom&&(k[A.key]=A)}this._retainLoadedChildren(k,s,S,d);for(const A of e){let I=this._tiles[A.key];if(I.hasData())continue;if(s+1>this._source.maxzoom){const L=A.children(this._source.maxzoom)[0],O=this.getTile(L);if(O&&O.hasData()){d[L.key]=L;continue}}else{const L=A.children(this._source.maxzoom);if(d[L[0].key]&&d[L[1].key]&&d[L[2].key]&&d[L[3].key])continue}let D=I.wasRequested();for(let L=A.overscaledZ-1;L>=x;--L){const O=A.scaledTo(L);if(y[O.key])break;if(y[O.key]=!0,I=this.getTile(O),!I&&D&&(I=this._addTile(O)),I){const U=I.hasData();if((U||!(!((u=this.map)===null||u===void 0)&&u.cancelPendingTileRequestsWhileZooming)||D)&&(d[O.key]=O),D=I.wasRequested(),U)break}}}return d}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const s=[];let u,d=this._tiles[e].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){u=this._loadedParentTiles[d.key];break}s.push(d.key);const y=d.scaledTo(d.overscaledZ-1);if(u=this._getLoadedTile(y),u)break;d=y}for(const y of s)this._loadedParentTiles[y]=u}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const s=this._tiles[e].tileID,u=this._getLoadedTile(s);this._loadedSiblingTiles[s.key]=u}}_addTile(e){let s=this._tiles[e.key];if(s)return s;s=this._cache.getAndRemove(e),s&&(this._setTileReloadTimer(e.key,s),s.tileID=e,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,s)));const u=s;return s||(s=new Wo(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(s,e.key,s.state)),s.uses++,this._tiles[e.key]=s,u||this._source.fire(new l.l("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(e,s){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const u=s.getExpiryTimeout();u&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),u))}refreshTiles(e){for(const s in this._tiles)(this._isIdRenderable(s)||this._tiles[s].state=="errored")&&e.some((u=>u.equals(this._tiles[s].tileID.canonical)))&&this._reloadTile(s,"expired")}_removeTile(e){const s=this._tiles[e];s&&(s.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}_dataHandler(e){const s=e.sourceDataType;e.dataType==="source"&&s==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&s==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,s,u){const d=[],y=this.transform;if(!y)return d;const x=y.getCoveringTilesDetailsProvider().allowWorldCopies(),S=u?y.getCameraQueryGeometry(e):e,k=O=>y.screenPointToMercatorCoordinate(O,this.terrain),A=this.transformBbox(e,k,!x),I=this.transformBbox(S,k,!x),D=this.getIds(),L=l.a2.fromPoints(I);for(let O=0;O<D.length;O++){const U=this._tiles[D[O]];if(U.holdingForFade())continue;const K=x?[U.tileID]:[U.tileID.unwrapTo(-1),U.tileID.unwrapTo(0)],X=Math.pow(2,y.zoom-U.tileID.overscaledZ),Y=s*U.queryPadding*l.$/U.tileSize/X;for(const ee of K){const ne=L.map((te=>ee.getTilePoint(new l.a1(te.x,te.y))));if(ne.expandBy(Y),ne.intersects(vt)){const te=A.map((ce=>ee.getTilePoint(ce))),oe=I.map((ce=>ee.getTilePoint(ce)));d.push({tile:U,tileID:x?ee:ee.unwrapTo(0),queryGeometry:te,cameraQueryGeometry:oe,scale:X})}}}return d}transformBbox(e,s,u){let d=e.map(s);if(u){const y=l.a2.fromPoints(e);y.shrinkBy(.001*Math.min(y.width(),y.height()));const x=y.map(s);l.a2.fromPoints(d).covers(x)||(d=d.map((S=>S.x>.5?new l.a1(S.x-1,S.y,S.z):S)))}return d}getVisibleCoordinates(e){const s=this.getRenderableIds(e).map((u=>this._tiles[u].tileID));return this.transform&&this.transform.populateCache(s),s}hasTransition(){if(this._source.hasTransition())return!0;if(St(this._source.type)){const e=G.now();for(const s in this._tiles)if(this._tiles[s].fadeEndTime>=e)return!0}return!1}setFeatureState(e,s,u){this._state.updateState(e=e||"_geojsonTileLayer",s,u)}removeFeatureState(e,s,u){this._state.removeFeatureState(e=e||"_geojsonTileLayer",s,u)}getFeatureState(e,s){return this._state.getState(e=e||"_geojsonTileLayer",s)}setDependencies(e,s,u){const d=this._tiles[e];d&&d.setDependencies(s,u)}reloadTilesForDependencies(e,s){for(const u in this._tiles)this._tiles[u].hasDependency(e,s)&&this._reloadTile(u,"reloading");this._cache.filter((u=>!u.hasDependency(e,s)))}}function ct(g,e){const s=Math.abs(2*g.wrap)-+(g.wrap<0),u=Math.abs(2*e.wrap)-+(e.wrap<0);return g.overscaledZ-e.overscaledZ||u-s||e.canonical.y-g.canonical.y||e.canonical.x-g.canonical.x}function St(g){return g==="raster"||g==="image"||g==="video"}zt.maxOverzooming=10,zt.maxUnderzooming=3;class mr{constructor(e,s){this.reset(e,s)}reset(e,s){this.points=e||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=l.ah(e,0,1);let s=1,u=this._distances[s];const d=e*this.paddedLength+this.padding;for(;u<d&&s<this._distances.length;)u=this._distances[++s];const y=s-1,x=this._distances[y],S=u-x,k=S>0?(d-x)/S:0;return this.points[y].mult(1-k).add(this.points[s].mult(k))}}function Xr(g,e){let s=!0;return g==="always"||g!=="never"&&e!=="never"||(s=!1),s}class Kr{constructor(e,s,u){const d=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(e/u),this.yCellCount=Math.ceil(s/u);for(let x=0;x<this.xCellCount*this.yCellCount;x++)d.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=s,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,s,u,d,y){this._forEachCell(s,u,d,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(s),this.bboxes.push(u),this.bboxes.push(d),this.bboxes.push(y)}insertCircle(e,s,u,d){this._forEachCell(s-d,u-d,s+d,u+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(s),this.circles.push(u),this.circles.push(d)}_insertBoxCell(e,s,u,d,y,x){this.boxCells[y].push(x)}_insertCircleCell(e,s,u,d,y,x){this.circleCells[y].push(x)}_query(e,s,u,d,y,x,S){if(u<0||e>this.width||d<0||s>this.height)return[];const k=[];if(e<=0&&s<=0&&this.width<=u&&this.height<=d){if(y)return[{key:null,x1:e,y1:s,x2:u,y2:d}];for(let A=0;A<this.boxKeys.length;A++)k.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const I=this.circles[3*A],D=this.circles[3*A+1],L=this.circles[3*A+2];k.push({key:this.circleKeys[A],x1:I-L,y1:D-L,x2:I+L,y2:D+L})}}else this._forEachCell(e,s,u,d,this._queryCell,k,{hitTest:y,overlapMode:x,seenUids:{box:{},circle:{}}},S);return k}query(e,s,u,d){return this._query(e,s,u,d,!1,null)}hitTest(e,s,u,d,y,x){return this._query(e,s,u,d,!0,y,x).length>0}hitTestCircle(e,s,u,d,y){const x=e-u,S=e+u,k=s-u,A=s+u;if(S<0||x>this.width||A<0||k>this.height)return!1;const I=[];return this._forEachCell(x,k,S,A,this._queryCellCircle,I,{hitTest:!0,overlapMode:d,circle:{x:e,y:s,radius:u},seenUids:{box:{},circle:{}}},y),I.length>0}_queryCell(e,s,u,d,y,x,S,k){const{seenUids:A,hitTest:I,overlapMode:D}=S,L=this.boxCells[y];if(L!==null){const U=this.bboxes;for(const K of L)if(!A.box[K]){A.box[K]=!0;const X=4*K,Y=this.boxKeys[K];if(e<=U[X+2]&&s<=U[X+3]&&u>=U[X+0]&&d>=U[X+1]&&(!k||k(Y))&&(!I||!Xr(D,Y.overlapMode))&&(x.push({key:Y,x1:U[X],y1:U[X+1],x2:U[X+2],y2:U[X+3]}),I))return!0}}const O=this.circleCells[y];if(O!==null){const U=this.circles;for(const K of O)if(!A.circle[K]){A.circle[K]=!0;const X=3*K,Y=this.circleKeys[K];if(this._circleAndRectCollide(U[X],U[X+1],U[X+2],e,s,u,d)&&(!k||k(Y))&&(!I||!Xr(D,Y.overlapMode))){const ee=U[X],ne=U[X+1],te=U[X+2];if(x.push({key:Y,x1:ee-te,y1:ne-te,x2:ee+te,y2:ne+te}),I)return!0}}}return!1}_queryCellCircle(e,s,u,d,y,x,S,k){const{circle:A,seenUids:I,overlapMode:D}=S,L=this.boxCells[y];if(L!==null){const U=this.bboxes;for(const K of L)if(!I.box[K]){I.box[K]=!0;const X=4*K,Y=this.boxKeys[K];if(this._circleAndRectCollide(A.x,A.y,A.radius,U[X+0],U[X+1],U[X+2],U[X+3])&&(!k||k(Y))&&!Xr(D,Y.overlapMode))return x.push(!0),!0}}const O=this.circleCells[y];if(O!==null){const U=this.circles;for(const K of O)if(!I.circle[K]){I.circle[K]=!0;const X=3*K,Y=this.circleKeys[K];if(this._circlesCollide(U[X],U[X+1],U[X+2],A.x,A.y,A.radius)&&(!k||k(Y))&&!Xr(D,Y.overlapMode))return x.push(!0),!0}}}_forEachCell(e,s,u,d,y,x,S,k){const A=this._convertToXCellCoord(e),I=this._convertToYCellCoord(s),D=this._convertToXCellCoord(u),L=this._convertToYCellCoord(d);for(let O=A;O<=D;O++)for(let U=I;U<=L;U++)if(y.call(this,e,s,u,d,this.xCellCount*U+O,x,S,k))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,s,u,d,y,x){const S=d-e,k=y-s,A=u+x;return A*A>S*S+k*k}_circleAndRectCollide(e,s,u,d,y,x,S){const k=(x-d)/2,A=Math.abs(e-(d+k));if(A>k+u)return!1;const I=(S-y)/2,D=Math.abs(s-(y+I));if(D>I+u)return!1;if(A<=k||D<=I)return!0;const L=A-k,O=D-I;return L*L+O*O<=u*u}}function Dr(g,e,s){const u=l.L();if(!g){const{vecSouth:D,vecEast:L}=Zt(e),O=M();O[0]=L[0],O[1]=L[1],O[2]=D[0],O[3]=D[1],d=O,(I=(x=(y=O)[0])*(A=y[3])-(k=y[2])*(S=y[1]))&&(d[0]=A*(I=1/I),d[1]=-S*I,d[2]=-k*I,d[3]=x*I),u[0]=O[0],u[1]=O[1],u[4]=O[2],u[5]=O[3]}var d,y,x,S,k,A,I;return l.N(u,u,[1/s,1/s,1]),u}function jt(g,e,s,u){if(g){const d=l.L();if(!e){const{vecSouth:y,vecEast:x}=Zt(s);d[0]=x[0],d[1]=x[1],d[4]=y[0],d[5]=y[1]}return l.N(d,d,[u,u,1]),d}return s.pixelsToClipSpaceMatrix}function Zt(g){const e=Math.cos(g.rollInRadians),s=Math.sin(g.rollInRadians),u=Math.cos(g.pitchInRadians),d=Math.cos(g.bearingInRadians),y=Math.sin(g.bearingInRadians),x=l.ar();x[0]=-d*u*s-y*e,x[1]=-y*u*s+d*e;const S=l.as(x);S<1e-9?l.at(x):l.au(x,x,1/S);const k=l.ar();k[0]=d*u*e-y*s,k[1]=y*u*e+d*s;const A=l.as(k);return A<1e-9?l.at(k):l.au(k,k,1/A),{vecEast:k,vecSouth:x}}function $r(g,e,s,u){let d;u?(d=[g,e,u(g,e),1],l.aw(d,d,s)):(d=[g,e,0,1],Xo(d,d,s));const y=d[3];return{point:new l.P(d[0]/y,d[1]/y),signedDistanceFromCamera:y,isOccluded:!1}}function Be(g,e){return .5+g/e*.5}function wi(g,e){return g.x>=-e[0]&&g.x<=e[0]&&g.y>=-e[1]&&g.y<=e[1]}function Sr(g,e,s,u,d,y,x,S,k,A,I,D,L){const O=s?g.textSizeData:g.iconSizeData,U=l.an(O,e.transform.zoom),K=[256/e.width*2+1,256/e.height*2+1],X=s?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;X.clear();const Y=g.lineVertexArray,ee=s?g.text.placedSymbolArray:g.icon.placedSymbolArray,ne=e.transform.width/e.transform.height;let te=!1;for(let oe=0;oe<ee.length;oe++){const ce=ee.get(oe);if(ce.hidden||ce.writingMode===l.ao.vertical&&!te){Zn(ce.numGlyphs,X);continue}te=!1;const re=new l.P(ce.anchorX,ce.anchorY),_e={getElevation:L,pitchedLabelPlaneMatrix:u,lineVertexArray:Y,pitchWithMap:y,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:re,unwrappedTileID:k,width:A,height:I,translation:D},Me=Oa(ce.anchorX,ce.anchorY,_e);if(!wi(Me.point,K)){Zn(ce.numGlyphs,X);continue}const Te=Be(e.transform.cameraToCenterDistance,Me.signedDistanceFromCamera),Se=l.ap(O,U,ce),Pe=y?Se*e.transform.getPitchedTextCorrection(ce.anchorX,ce.anchorY,k)/Te:Se*Te,Oe=We({projectionContext:_e,pitchedLabelPlaneMatrixInverse:d,symbol:ce,fontSize:Pe,flip:!1,keepUpright:x,glyphOffsetArray:g.glyphOffsetArray,dynamicLayoutVertexArray:X,aspectRatio:ne,rotateToLine:S});te=Oe.useVertical,(Oe.notEnoughRoom||te||Oe.needsFlipping&&We({projectionContext:_e,pitchedLabelPlaneMatrixInverse:d,symbol:ce,fontSize:Pe,flip:!0,keepUpright:x,glyphOffsetArray:g.glyphOffsetArray,dynamicLayoutVertexArray:X,aspectRatio:ne,rotateToLine:S}).notEnoughRoom)&&Zn(ce.numGlyphs,X)}s?g.text.dynamicLayoutVertexBuffer.updateData(X):g.icon.dynamicLayoutVertexBuffer.updateData(X)}function ja(g,e,s,u,d,y,x,S){const k=y.glyphStartIndex+y.numGlyphs,A=y.lineStartIndex,I=y.lineStartIndex+y.lineLength,D=e.getoffsetX(y.glyphStartIndex),L=e.getoffsetX(k-1),O=Ba(g*D,s,u,d,y.segment,A,I,S,x);if(!O)return null;const U=Ba(g*L,s,u,d,y.segment,A,I,S,x);return U?S.projectionCache.anyProjectionOccluded?null:{first:O,last:U}:null}function Ho(g,e,s,u){return g===l.ao.horizontal&&Math.abs(s.y-e.y)>Math.abs(s.x-e.x)*u?{useVertical:!0}:(g===l.ao.vertical?e.y<s.y:e.x>s.x)?{needsFlipping:!0}:null}function We(g){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:s,symbol:u,fontSize:d,flip:y,keepUpright:x,glyphOffsetArray:S,dynamicLayoutVertexArray:k,aspectRatio:A,rotateToLine:I}=g,D=d/24,L=u.lineOffsetX*D,O=u.lineOffsetY*D;let U;if(u.numGlyphs>1){const K=u.glyphStartIndex+u.numGlyphs,X=u.lineStartIndex,Y=u.lineStartIndex+u.lineLength,ee=ja(D,S,L,O,y,u,I,e);if(!ee)return{notEnoughRoom:!0};const ne=co(ee.first.point.x,ee.first.point.y,e,s),te=co(ee.last.point.x,ee.last.point.y,e,s);if(x&&!y){const oe=Ho(u.writingMode,ne,te,A);if(oe)return oe}U=[ee.first];for(let oe=u.glyphStartIndex+1;oe<K-1;oe++){const ce=Ba(D*S.getoffsetX(oe),L,O,y,u.segment,X,Y,e,I);if(!ce)return{notEnoughRoom:!0};U.push(ce)}U.push(ee.last)}else{if(x&&!y){const X=pi(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,Y=u.lineStartIndex+u.segment+1,ee=new l.P(e.lineVertexArray.getx(Y),e.lineVertexArray.gety(Y)),ne=pi(ee.x,ee.y,e),te=ne.signedDistanceFromCamera>0?ne.point:Rt(e.tileAnchorPoint,ee,X,1,e),oe=co(X.x,X.y,e,s),ce=co(te.x,te.y,e,s),re=Ho(u.writingMode,oe,ce,A);if(re)return re}const K=Ba(D*S.getoffsetX(u.glyphStartIndex),L,O,y,u.segment,u.lineStartIndex,u.lineStartIndex+u.lineLength,e,I);if(!K||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};U=[K]}for(const K of U)l.av(k,K.point,K.angle);return{}}function Rt(g,e,s,u,d){const y=g.add(g.sub(e)._unit()),x=pi(y.x,y.y,d).point,S=s.sub(x);return s.add(S._mult(u/S.mag()))}function Mt(g,e,s){const u=e.projectionCache;if(u.projections[g])return u.projections[g];const d=new l.P(e.lineVertexArray.getx(g),e.lineVertexArray.gety(g)),y=pi(d.x,d.y,e);if(y.signedDistanceFromCamera>0)return u.projections[g]=y.point,u.anyProjectionOccluded=u.anyProjectionOccluded||y.isOccluded,y.point;const x=g-s.direction;return Rt(s.distanceFromAnchor===0?e.tileAnchorPoint:new l.P(e.lineVertexArray.getx(x),e.lineVertexArray.gety(x)),d,s.previousVertex,s.absOffsetX-s.distanceFromAnchor+1,e)}function pi(g,e,s){const u=g+s.translation[0],d=e+s.translation[1];let y;return s.pitchWithMap?(y=$r(u,d,s.pitchedLabelPlaneMatrix,s.getElevation),y.isOccluded=!1):(y=s.transform.projectTileCoordinates(u,d,s.unwrappedTileID,s.getElevation),y.point.x=(.5*y.point.x+.5)*s.width,y.point.y=(.5*-y.point.y+.5)*s.height),y}function co(g,e,s,u){if(s.pitchWithMap){const d=[g,e,0,1];return l.aw(d,d,u),s.transform.projectTileCoordinates(d[0]/d[3],d[1]/d[3],s.unwrappedTileID,s.getElevation).point}return{x:g/s.width*2-1,y:1-e/s.height*2}}function Oa(g,e,s){return s.transform.projectTileCoordinates(g,e,s.unwrappedTileID,s.getElevation)}function Ct(g,e,s){return g._unit()._perp()._mult(e*s)}function Wl(g,e,s,u,d,y,x,S,k){if(S.projectionCache.offsets[g])return S.projectionCache.offsets[g];const A=s.add(e);if(g+k.direction<u||g+k.direction>=d)return S.projectionCache.offsets[g]=A,A;const I=Mt(g+k.direction,S,k),D=Ct(I.sub(s),x,k.direction),L=s.add(D),O=I.add(D);return S.projectionCache.offsets[g]=l.ax(y,A,L,O)||A,S.projectionCache.offsets[g]}function Ba(g,e,s,u,d,y,x,S,k){const A=u?g-e:g+e;let I=A>0?1:-1,D=0;u&&(I*=-1,D=Math.PI),I<0&&(D+=Math.PI);let L,O=I>0?y+d:y+d+1;S.projectionCache.cachedAnchorPoint?L=S.projectionCache.cachedAnchorPoint:(L=pi(S.tileAnchorPoint.x,S.tileAnchorPoint.y,S).point,S.projectionCache.cachedAnchorPoint=L);let U,K,X=L,Y=L,ee=0,ne=0;const te=Math.abs(A),oe=[];let ce;for(;ee+ne<=te;){if(O+=I,O<y||O>=x)return null;ee+=ne,Y=X,K=U;const Me={absOffsetX:te,direction:I,distanceFromAnchor:ee,previousVertex:Y};if(X=Mt(O,S,Me),s===0)oe.push(Y),ce=X.sub(Y);else{let Te;const Se=X.sub(Y);Te=Se.mag()===0?Ct(Mt(O+I,S,Me).sub(X),s,I):Ct(Se,s,I),K||(K=Y.add(Te)),U=Wl(O,Te,X,y,x,K,s,S,Me),oe.push(K),ce=U.sub(K)}ne=ce.mag()}const re=ce._mult((te-ee)/ne)._add(K||Y),_e=D+Math.atan2(X.y-Y.y,X.x-Y.x);return oe.push(re),{point:re,angle:k?_e:0,path:oe}}const Hl=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Zn(g,e){for(let s=0;s<g;s++){const u=e.length;e.resize(u+4),e.float32.set(Hl,3*u)}}function Xo(g,e,s){const u=e[0],d=e[1];return g[0]=s[0]*u+s[4]*d+s[12],g[1]=s[1]*u+s[5]*d+s[13],g[3]=s[3]*u+s[7]*d+s[15],g}const Ar=100;class Xl{constructor(e,s=new Kr(e.width+200,e.height+200,25),u=new Kr(e.width+200,e.height+200,25)){this.transform=e,this.grid=s,this.ignoredGrid=u,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Ar,this.screenBottomBoundary=e.height+Ar,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,s,u,d,y,x,S,k,A,I,D,L){const O=this.projectAndGetPerspectiveRatio(e.anchorPointX+k[0],e.anchorPointY+k[1],y,I,L),U=u*O.perspectiveRatio;let K;if(x||S)K=this._projectCollisionBox(e,U,d,y,x,S,k,O,I,D,L);else{const ce=O.x+(D?D.x*U:0),re=O.y+(D?D.y*U:0);K={allPointsOccluded:!1,box:[ce+e.x1*U,re+e.y1*U,ce+e.x2*U,re+e.y2*U]}}const[X,Y,ee,ne]=K.box,te=x?K.allPointsOccluded:O.isOccluded;let oe=te;return oe||(oe=O.perspectiveRatio<this.perspectiveRatioCutoff),oe||(oe=!this.isInsideGrid(X,Y,ee,ne)),oe||s!=="always"&&this.grid.hitTest(X,Y,ee,ne,s,A)?{box:[X,Y,ee,ne],placeable:!1,offscreen:!1,occluded:te}:{box:[X,Y,ee,ne],placeable:!0,offscreen:this.isOffscreen(X,Y,ee,ne),occluded:te}}placeCollisionCircles(e,s,u,d,y,x,S,k,A,I,D,L,O,U){const K=[],X=new l.P(s.anchorX,s.anchorY),Y=this.getPerspectiveRatio(X.x,X.y,x,U),ee=(A?y*this.transform.getPitchedTextCorrection(s.anchorX,s.anchorY,x)/Y:y*Y)/l.aB,ne={getElevation:U,pitchedLabelPlaneMatrix:S,lineVertexArray:u,pitchWithMap:A,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:X,unwrappedTileID:x,width:this.transform.width,height:this.transform.height,translation:O},te=ja(ee,d,s.lineOffsetX*ee,s.lineOffsetY*ee,!1,s,!1,ne);let oe=!1,ce=!1,re=!0;if(te){const _e=.5*D*Y+L,Me=new l.P(-100,-100),Te=new l.P(this.screenRightBoundary,this.screenBottomBoundary),Se=new mr,Pe=te.first,Oe=te.last;let Ne=[];for(let Pt=Pe.path.length-1;Pt>=1;Pt--)Ne.push(Pe.path[Pt]);for(let Pt=1;Pt<Oe.path.length;Pt++)Ne.push(Oe.path[Pt]);const Le=2.5*_e;if(A){const Pt=this.projectPathToScreenSpace(Ne,ne);Ne=Pt.some((tr=>tr.signedDistanceFromCamera<=0))?[]:Pt.map((tr=>tr.point))}let it=[];if(Ne.length>0){const Pt=Ne[0].clone(),tr=Ne[0].clone();for(let lr=1;lr<Ne.length;lr++)Pt.x=Math.min(Pt.x,Ne[lr].x),Pt.y=Math.min(Pt.y,Ne[lr].y),tr.x=Math.max(tr.x,Ne[lr].x),tr.y=Math.max(tr.y,Ne[lr].y);it=Pt.x>=Me.x&&tr.x<=Te.x&&Pt.y>=Me.y&&tr.y<=Te.y?[Ne]:tr.x<Me.x||Pt.x>Te.x||tr.y<Me.y||Pt.y>Te.y?[]:l.ay([Ne],Me.x,Me.y,Te.x,Te.y)}for(const Pt of it){Se.reset(Pt,.25*_e);let tr=0;tr=Se.length<=.5*_e?1:Math.ceil(Se.paddedLength/Le)+1;for(let lr=0;lr<tr;lr++){const or=lr/Math.max(tr-1,1),xr=Se.lerp(or),Cr=xr.x+Ar,kt=xr.y+Ar;K.push(Cr,kt,_e,0);const cr=Cr-_e,Ur=kt-_e,Yr=Cr+_e,ni=kt+_e;if(re=re&&this.isOffscreen(cr,Ur,Yr,ni),ce=ce||this.isInsideGrid(cr,Ur,Yr,ni),e!=="always"&&this.grid.hitTestCircle(Cr,kt,_e,e,I)&&(oe=!0,!k))return{circles:[],offscreen:!1,collisionDetected:oe}}}}return{circles:!k&&oe||!ce||Y<this.perspectiveRatioCutoff?[]:K,offscreen:re,collisionDetected:oe}}projectPathToScreenSpace(e,s){const u=(function(d,y){const x=l.L();return l.aq(x,y.pitchedLabelPlaneMatrix),d.map((S=>{const k=$r(S.x,S.y,x,y.getElevation),A=y.transform.projectTileCoordinates(k.point.x,k.point.y,y.unwrappedTileID,y.getElevation);return A.point.x=(.5*A.point.x+.5)*y.width,A.point.y=(.5*-A.point.y+.5)*y.height,A}))})(e,s);return(function(d){let y=0,x=0,S=0,k=0;for(let A=0;A<d.length;A++)d[A].isOccluded?(S=A+1,k=0):(k++,k>x&&(x=k,y=S));return d.slice(y,y+x)})(u)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[],u=new l.a2;for(const D of e){const L=new l.P(D.x+Ar,D.y+Ar);u.extend(L),s.push(L)}const{minX:d,minY:y,maxX:x,maxY:S}=u,k=this.grid.query(d,y,x,S).concat(this.ignoredGrid.query(d,y,x,S)),A={},I={};for(const D of k){const L=D.key;if(A[L.bucketInstanceId]===void 0&&(A[L.bucketInstanceId]={}),A[L.bucketInstanceId][L.featureIndex])continue;const O=[new l.P(D.x1,D.y1),new l.P(D.x2,D.y1),new l.P(D.x2,D.y2),new l.P(D.x1,D.y2)];l.az(s,O)&&(A[L.bucketInstanceId][L.featureIndex]=!0,I[L.bucketInstanceId]===void 0&&(I[L.bucketInstanceId]=[]),I[L.bucketInstanceId].push(L.featureIndex))}return I}insertCollisionBox(e,s,u,d,y,x){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:y,collisionGroupID:x,overlapMode:s},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,s,u,d,y,x){const S=u?this.ignoredGrid:this.grid,k={bucketInstanceId:d,featureIndex:y,collisionGroupID:x,overlapMode:s};for(let A=0;A<e.length;A+=4)S.insertCircle(k,e[A],e[A+1],e[A+2])}projectAndGetPerspectiveRatio(e,s,u,d,y){if(y){let x;d?(x=[e,s,d(e,s),1],l.aw(x,x,y)):(x=[e,s,0,1],Xo(x,x,y));const S=x[3];return{x:(x[0]/S+1)/2*this.transform.width+Ar,y:(-x[1]/S+1)/2*this.transform.height+Ar,perspectiveRatio:.5+this.transform.cameraToCenterDistance/S*.5,isOccluded:!1,signedDistanceFromCamera:S}}{const x=this.transform.projectTileCoordinates(e,s,u,d);return{x:(x.point.x+1)/2*this.transform.width+Ar,y:(1-x.point.y)/2*this.transform.height+Ar,perspectiveRatio:.5+this.transform.cameraToCenterDistance/x.signedDistanceFromCamera*.5,isOccluded:x.isOccluded,signedDistanceFromCamera:x.signedDistanceFromCamera}}}getPerspectiveRatio(e,s,u,d){const y=this.transform.projectTileCoordinates(e,s,u,d);return .5+this.transform.cameraToCenterDistance/y.signedDistanceFromCamera*.5}isOffscreen(e,s,u,d){return u<Ar||e>=this.screenRightBoundary||d<Ar||s>this.screenBottomBoundary}isInsideGrid(e,s,u,d){return u>=0&&e<this.gridRightBoundary&&d>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const e=l.ag([]);return l.M(e,e,[-100,-100,0]),e}_projectCollisionBox(e,s,u,d,y,x,S,k,A,I,D){let L=1,O=0,U=0,K=1;const X=e.anchorPointX+S[0],Y=e.anchorPointY+S[1];if(x&&!y){const Ne=this.projectAndGetPerspectiveRatio(X+1,Y,d,A,D),Le=Ne.x-k.x,it=Math.atan((Ne.y-k.y)/Le)+(Le<0?Math.PI:0),Pt=Math.sin(it),tr=Math.cos(it);L=tr,O=Pt,U=-Pt,K=tr}else if(!x&&y){const Ne=Zt(this.transform);L=Ne.vecEast[0],O=Ne.vecEast[1],U=Ne.vecSouth[0],K=Ne.vecSouth[1]}let ee=k.x,ne=k.y,te=s;y&&(ee=X,ne=Y,te=Math.pow(2,-(this.transform.zoom-u.overscaledZ)),te*=this.transform.getPitchedTextCorrection(X,Y,d),I||(te*=l.ah(.5+k.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),I&&(ee+=L*I.x*te+U*I.y*te,ne+=O*I.x*te+K*I.y*te);const oe=e.x1*te,ce=e.x2*te,re=(oe+ce)/2,_e=e.y1*te,Me=e.y2*te,Te=(_e+Me)/2,Se=[{offsetX:oe,offsetY:_e},{offsetX:re,offsetY:_e},{offsetX:ce,offsetY:_e},{offsetX:ce,offsetY:Te},{offsetX:ce,offsetY:Me},{offsetX:re,offsetY:Me},{offsetX:oe,offsetY:Me},{offsetX:oe,offsetY:Te}];let Pe=[];for(const{offsetX:Ne,offsetY:Le}of Se)Pe.push(new l.P(ee+L*Ne+U*Le,ne+O*Ne+K*Le));let Oe=!1;if(y){const Ne=Pe.map((Le=>this.projectAndGetPerspectiveRatio(Le.x,Le.y,d,A,D)));Oe=Ne.some((Le=>!Le.isOccluded)),Pe=Ne.map((Le=>new l.P(Le.x,Le.y)))}else Oe=!0;return{box:l.aA(Pe),allPointsOccluded:!Oe}}}class Gi{constructor(e,s,u,d){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?s:-s))):d&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class ur{constructor(e,s,u,d,y){this.text=new Gi(e?e.text:null,s,u,y),this.icon=new Gi(e?e.icon:null,s,d,y)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Lp{constructor(e,s,u){this.text=e,this.icon=s,this.skipFade=u}}class Ds{constructor(e,s,u,d,y){this.bucketInstanceId=e,this.featureIndex=s,this.sourceLayerIndex=u,this.bucketIndex=d,this.tileID=y}}class Iu{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const s=++this.maxGroupID;this.collisionGroups[e]={ID:s,predicate:u=>u.collisionGroupID===s}}return this.collisionGroups[e]}}function $a(g,e,s,u,d){const{horizontalAlign:y,verticalAlign:x}=l.aH(g);return new l.P(-(y-.5)*e+u[0]*d,-(x-.5)*s+u[1]*d)}class Na{constructor(e,s,u,d,y){this.transform=e.clone(),this.terrain=s,this.collisionIndex=new Xl(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Iu(d),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const s=this.terrain;return s?(u,d)=>s.getElevation(e,u,d):null}getBucketParts(e,s,u,d){const y=u.getBucket(s),x=u.latestFeatureIndex;if(!y||!x||s.id!==y.layerIds[0])return;const S=u.collisionBoxArray,k=y.layers[0].layout,A=y.layers[0].paint,I=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),D=u.tileSize/l.$,L=u.tileID.toUnwrapped(),O=k.get("text-rotation-alignment")==="map",U=l.aC(u,1,this.transform.zoom),K=l.aD(this.collisionIndex.transform,u,A.get("text-translate"),A.get("text-translate-anchor")),X=l.aD(this.collisionIndex.transform,u,A.get("icon-translate"),A.get("icon-translate-anchor")),Y=Dr(O,this.transform,U);this.retainedQueryData[y.bucketInstanceId]=new Ds(y.bucketInstanceId,x,y.sourceLayerIndex,y.index,u.tileID);const ee={bucket:y,layout:k,translationText:K,translationIcon:X,unwrappedTileID:L,pitchedLabelPlaneMatrix:Y,scale:I,textPixelRatio:D,holdingForFade:u.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:l.an(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(d)for(const ne of y.sortKeyRanges){const{sortKey:te,symbolInstanceStart:oe,symbolInstanceEnd:ce}=ne;e.push({sortKey:te,symbolInstanceStart:oe,symbolInstanceEnd:ce,parameters:ee})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:ee})}attemptAnchorPlacement(e,s,u,d,y,x,S,k,A,I,D,L,O,U,K,X,Y,ee,ne,te){const oe=l.aE[e.textAnchor],ce=[e.textOffset0,e.textOffset1],re=$a(oe,u,d,ce,y),_e=this.collisionIndex.placeCollisionBox(s,L,k,A,I,S,x,X,D.predicate,ne,re,te);if((!ee||this.collisionIndex.placeCollisionBox(ee,L,k,A,I,S,x,Y,D.predicate,ne,re,te).placeable)&&_e.placeable){let Me;if(this.prevPlacement&&this.prevPlacement.variableOffsets[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID]&&this.prevPlacement.placements[O.crossTileID].text&&(Me=this.prevPlacement.variableOffsets[O.crossTileID].anchor),O.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[O.crossTileID]={textOffset:ce,width:u,height:d,anchor:oe,textBoxScale:y,prevAnchor:Me},this.markUsedJustification(U,oe,O,K),U.allowVerticalPlacement&&(this.markUsedOrientation(U,K,O),this.placedOrientations[O.crossTileID]=K),{shift:re,placedGlyphBoxes:_e}}}placeLayerBucketPart(e,s,u){const{bucket:d,layout:y,translationText:x,translationIcon:S,unwrappedTileID:k,pitchedLabelPlaneMatrix:A,textPixelRatio:I,holdingForFade:D,collisionBoxArray:L,partiallyEvaluatedTextSize:O,collisionGroup:U}=e.parameters,K=y.get("text-optional"),X=y.get("icon-optional"),Y=l.aF(y,"text-overlap","text-allow-overlap"),ee=Y==="always",ne=l.aF(y,"icon-overlap","icon-allow-overlap"),te=ne==="always",oe=y.get("text-rotation-alignment")==="map",ce=y.get("text-pitch-alignment")==="map",re=y.get("icon-text-fit")!=="none",_e=y.get("symbol-z-order")==="viewport-y",Me=ee&&(te||!d.hasIconData()||X),Te=te&&(ee||!d.hasTextData()||K);!d.collisionArrays&&L&&d.deserializeCollisionBoxes(L);const Se=this.retainedQueryData[d.bucketInstanceId].tileID,Pe=this._getTerrainElevationFunc(Se),Oe=this.transform.getFastPathSimpleProjectionMatrix(Se),Ne=(Le,it,Pt)=>{var tr,lr;if(s[Le.crossTileID])return;if(D)return void(this.placements[Le.crossTileID]=new Lp(!1,!1,!1));let or=!1,xr=!1,Cr=!0,kt=null,cr={box:null,placeable:!1,offscreen:null,occluded:!1},Ur={placeable:!1},Yr=null,ni=null,Li=null,Pn=0,Za=0,Wa=0;it.textFeatureIndex?Pn=it.textFeatureIndex:Le.useRuntimeCollisionCircles&&(Pn=Le.featureIndex),it.verticalTextFeatureIndex&&(Za=it.verticalTextFeatureIndex);const gs=it.textBox;if(gs){const Hi=Vr=>{let Jr=l.ao.horizontal;if(d.allowVerticalPlacement&&!Vr&&this.prevPlacement){const dn=this.prevPlacement.placedOrientations[Le.crossTileID];dn&&(this.placedOrientations[Le.crossTileID]=dn,Jr=dn,this.markUsedOrientation(d,Jr,Le))}return Jr},Mn=(Vr,Jr)=>{if(d.allowVerticalPlacement&&Le.numVerticalGlyphVertices>0&&it.verticalTextBox){for(const dn of d.writingModes)if(dn===l.ao.vertical?(cr=Jr(),Ur=cr):cr=Vr(),cr&&cr.placeable)break}else cr=Vr()},Di=Le.textAnchorOffsetStartIndex,Ha=Le.textAnchorOffsetEndIndex;if(Ha===Di){const Vr=(Jr,dn)=>{const qr=this.collisionIndex.placeCollisionBox(Jr,Y,I,Se,k,ce,oe,x,U.predicate,Pe,void 0,Oe);return qr&&qr.placeable&&(this.markUsedOrientation(d,dn,Le),this.placedOrientations[Le.crossTileID]=dn),qr};Mn((()=>Vr(gs,l.ao.horizontal)),(()=>{const Jr=it.verticalTextBox;return d.allowVerticalPlacement&&Le.numVerticalGlyphVertices>0&&Jr?Vr(Jr,l.ao.vertical):{box:null,offscreen:null}})),Hi(cr&&cr.placeable)}else{let Vr=l.aE[(lr=(tr=this.prevPlacement)===null||tr===void 0?void 0:tr.variableOffsets[Le.crossTileID])===null||lr===void 0?void 0:lr.anchor];const Jr=(qr,ll,_s)=>{const da=qr.x2-qr.x1,An=qr.y2-qr.y1,Xa=Le.textBoxScale,Cd=re&&ne==="never"?ll:null;let tn=null,Pd=Y==="never"?1:2,Sh="never";Vr&&Pd++;for(let Ic=0;Ic<Pd;Ic++){for(let zc=Di;zc<Ha;zc++){const Ka=d.textAnchorOffsets.get(zc);if(Vr&&Ka.textAnchor!==Vr)continue;const fa=this.attemptAnchorPlacement(Ka,qr,da,An,Xa,oe,ce,I,Se,k,U,Sh,Le,d,_s,x,S,Cd,Pe);if(fa&&(tn=fa.placedGlyphBoxes,tn&&tn.placeable))return or=!0,kt=fa.shift,tn}Vr?Vr=null:Sh=Y}return u&&!tn&&(tn={box:this.collisionIndex.placeCollisionBox(gs,"always",I,Se,k,ce,oe,x,U.predicate,Pe,void 0,Oe).box,offscreen:!1,placeable:!1,occluded:!1}),tn};Mn((()=>Jr(gs,it.iconBox,l.ao.horizontal)),(()=>{const qr=it.verticalTextBox;return d.allowVerticalPlacement&&(!cr||!cr.placeable)&&Le.numVerticalGlyphVertices>0&&qr?Jr(qr,it.verticalIconBox,l.ao.vertical):{box:null,occluded:!0,offscreen:null}})),cr&&(or=cr.placeable,Cr=cr.offscreen);const dn=Hi(cr&&cr.placeable);if(!or&&this.prevPlacement){const qr=this.prevPlacement.variableOffsets[Le.crossTileID];qr&&(this.variableOffsets[Le.crossTileID]=qr,this.markUsedJustification(d,qr.anchor,Le,dn))}}}if(Yr=cr,or=Yr&&Yr.placeable,Cr=Yr&&Yr.offscreen,Le.useRuntimeCollisionCircles){const Hi=d.text.placedSymbolArray.get(Le.centerJustifiedTextSymbolIndex),Mn=l.ap(d.textSizeData,O,Hi),Di=y.get("text-padding");ni=this.collisionIndex.placeCollisionCircles(Y,Hi,d.lineVertexArray,d.glyphOffsetArray,Mn,k,A,u,ce,U.predicate,Le.collisionCircleDiameter,Di,x,Pe),ni.circles.length&&ni.collisionDetected&&!u&&l.w("Collisions detected, but collision boxes are not shown"),or=ee||ni.circles.length>0&&!ni.collisionDetected,Cr=Cr&&ni.offscreen}if(it.iconFeatureIndex&&(Wa=it.iconFeatureIndex),it.iconBox){const Hi=Mn=>this.collisionIndex.placeCollisionBox(Mn,ne,I,Se,k,ce,oe,S,U.predicate,Pe,re&&kt?kt:void 0,Oe);Ur&&Ur.placeable&&it.verticalIconBox?(Li=Hi(it.verticalIconBox),xr=Li.placeable):(Li=Hi(it.iconBox),xr=Li.placeable),Cr=Cr&&Li.offscreen}const ys=K||Le.numHorizontalGlyphVertices===0&&Le.numVerticalGlyphVertices===0,Mo=X||Le.numIconVertices===0;ys||Mo?Mo?ys||(xr=xr&&or):or=xr&&or:xr=or=xr&&or;const Ao=xr&&Li.placeable;if(or&&Yr.placeable&&this.collisionIndex.insertCollisionBox(Yr.box,Y,y.get("text-ignore-placement"),d.bucketInstanceId,Ur&&Ur.placeable&&Za?Za:Pn,U.ID),Ao&&this.collisionIndex.insertCollisionBox(Li.box,ne,y.get("icon-ignore-placement"),d.bucketInstanceId,Wa,U.ID),ni&&or&&this.collisionIndex.insertCollisionCircles(ni.circles,Y,y.get("text-ignore-placement"),d.bucketInstanceId,Pn,U.ID),u&&this.storeCollisionData(d.bucketInstanceId,Pt,it,Yr,Li,ni),Le.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(d.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Le.crossTileID]=new Lp((or||Me)&&!Yr?.occluded,(xr||Te)&&!Li?.occluded,Cr||d.justReloaded),s[Le.crossTileID]=!0};if(_e){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Le=d.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let it=Le.length-1;it>=0;--it){const Pt=Le[it];Ne(d.symbolInstances.get(Pt),d.collisionArrays[Pt],Pt)}}else for(let Le=e.symbolInstanceStart;Le<e.symbolInstanceEnd;Le++)Ne(d.symbolInstances.get(Le),d.collisionArrays[Le],Le);d.justReloaded=!1}storeCollisionData(e,s,u,d,y,x){if(u.textBox||u.iconBox){let S,k;this.collisionBoxArrays.has(e)?S=this.collisionBoxArrays.get(e):(S=new Map,this.collisionBoxArrays.set(e,S)),S.has(s)?k=S.get(s):(k={text:null,icon:null},S.set(s,k)),u.textBox&&(k.text=d.box),u.iconBox&&(k.icon=y.box)}if(x){let S=this.collisionCircleArrays[e];S===void 0&&(S=this.collisionCircleArrays[e]=[]);for(let k=0;k<x.circles.length;k+=4)S.push(x.circles[k+0]-Ar),S.push(x.circles[k+1]-Ar),S.push(x.circles[k+2]),S.push(x.collisionDetected?1:0)}}markUsedJustification(e,s,u,d){let y;y=d===l.ao.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[l.aG(s)];const x=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const S of x)S>=0&&(e.text.placedSymbolArray.get(S).crossTileID=y>=0&&S!==y?0:u.crossTileID)}markUsedOrientation(e,s,u){const d=s===l.ao.horizontal||s===l.ao.horizontalOnly?s:0,y=s===l.ao.vertical?s:0,x=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(const S of x)e.text.placedSymbolArray.get(S).placedOrientation=d;u.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let u=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const d=s?s.symbolFadeChange(e):1,y=s?s.opacities:{},x=s?s.variableOffsets:{},S=s?s.placedOrientations:{};for(const k in this.placements){const A=this.placements[k],I=y[k];I?(this.opacities[k]=new ur(I,d,A.text,A.icon),u=u||A.text!==I.text.placed||A.icon!==I.icon.placed):(this.opacities[k]=new ur(null,d,A.text,A.icon,A.skipFade),u=u||A.text||A.icon)}for(const k in y){const A=y[k];if(!this.opacities[k]){const I=new ur(A,d,!1,!1);I.isHidden()||(this.opacities[k]=I,u=u||A.text.placed||A.icon.placed)}}for(const k in x)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=x[k]);for(const k in S)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=S[k]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");u?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:e)}updateLayerOpacities(e,s){const u={};for(const d of s){const y=d.getBucket(e);y&&d.latestFeatureIndex&&e.id===y.layerIds[0]&&this.updateBucketOpacities(y,d.tileID,u,d.collisionBoxArray)}}updateBucketOpacities(e,s,u,d){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const y=e.layers[0],x=y.layout,S=new ur(null,0,!1,!1,!0),k=x.get("text-allow-overlap"),A=x.get("icon-allow-overlap"),I=y._unevaluatedLayout.hasValue("text-variable-anchor")||y._unevaluatedLayout.hasValue("text-variable-anchor-offset"),D=x.get("text-rotation-alignment")==="map",L=x.get("text-pitch-alignment")==="map",O=x.get("icon-text-fit")!=="none",U=new ur(null,0,k&&(A||!e.hasIconData()||x.get("icon-optional")),A&&(k||!e.hasTextData()||x.get("text-optional")),!0);!e.collisionArrays&&d&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(d);const K=(Y,ee,ne)=>{for(let te=0;te<ee/4;te++)Y.opacityVertexArray.emplaceBack(ne);Y.hasVisibleVertices=Y.hasVisibleVertices||ne!==Yo},X=this.collisionBoxArrays.get(e.bucketInstanceId);for(let Y=0;Y<e.symbolInstances.length;Y++){const ee=e.symbolInstances.get(Y),{numHorizontalGlyphVertices:ne,numVerticalGlyphVertices:te,crossTileID:oe}=ee;let ce=this.opacities[oe];u[oe]?ce=S:ce||(ce=U,this.opacities[oe]=ce),u[oe]=!0;const re=ee.numIconVertices>0,_e=this.placedOrientations[ee.crossTileID],Me=_e===l.ao.vertical,Te=_e===l.ao.horizontal||_e===l.ao.horizontalOnly;if(ne>0||te>0){const Pe=Ru(ce.text);K(e.text,ne,Me?Yo:Pe),K(e.text,te,Te?Yo:Pe);const Oe=ce.text.isHidden();[ee.rightJustifiedTextSymbolIndex,ee.centerJustifiedTextSymbolIndex,ee.leftJustifiedTextSymbolIndex].forEach((it=>{it>=0&&(e.text.placedSymbolArray.get(it).hidden=Oe||Me?1:0)})),ee.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(ee.verticalPlacedTextSymbolIndex).hidden=Oe||Te?1:0);const Ne=this.variableOffsets[ee.crossTileID];Ne&&this.markUsedJustification(e,Ne.anchor,ee,_e);const Le=this.placedOrientations[ee.crossTileID];Le&&(this.markUsedJustification(e,"left",ee,Le),this.markUsedOrientation(e,Le,ee))}if(re){const Pe=Ru(ce.icon),Oe=!(O&&ee.verticalPlacedIconSymbolIndex&&Me);ee.placedIconSymbolIndex>=0&&(K(e.icon,ee.numIconVertices,Oe?Pe:Yo),e.icon.placedSymbolArray.get(ee.placedIconSymbolIndex).hidden=ce.icon.isHidden()),ee.verticalPlacedIconSymbolIndex>=0&&(K(e.icon,ee.numVerticalIconVertices,Oe?Yo:Pe),e.icon.placedSymbolArray.get(ee.verticalPlacedIconSymbolIndex).hidden=ce.icon.isHidden())}const Se=X&&X.has(Y)?X.get(Y):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Pe=e.collisionArrays[Y];if(Pe){let Oe=new l.P(0,0);if(Pe.textBox||Pe.verticalTextBox){let Ne=!0;if(I){const Le=this.variableOffsets[oe];Le?(Oe=$a(Le.anchor,Le.width,Le.height,Le.textOffset,Le.textBoxScale),D&&Oe._rotate(L?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Ne=!1}if(Pe.textBox||Pe.verticalTextBox){let Le;Pe.textBox&&(Le=Me),Pe.verticalTextBox&&(Le=Te),zu(e.textCollisionBox.collisionVertexArray,ce.text.placed,!Ne||Le,Se.text,Oe.x,Oe.y)}}if(Pe.iconBox||Pe.verticalIconBox){const Ne=!!(!Te&&Pe.verticalIconBox);let Le;Pe.iconBox&&(Le=Ne),Pe.verticalIconBox&&(Le=!Ne),zu(e.iconCollisionBox.collisionVertexArray,ce.icon.placed,Le,Se.icon,O?Oe.x:0,O?Oe.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,s){const u=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*u>e}setStale(){this.stale=!0}}function zu(g,e,s,u,d,y){u&&u.length!==0||(u=[0,0,0,0]);const x=u[0]-Ar,S=u[1]-Ar,k=u[2]-Ar,A=u[3]-Ar;g.emplaceBack(e?1:0,s?1:0,d||0,y||0,x,S),g.emplaceBack(e?1:0,s?1:0,d||0,y||0,k,S),g.emplaceBack(e?1:0,s?1:0,d||0,y||0,k,A),g.emplaceBack(e?1:0,s?1:0,d||0,y||0,x,A)}const Dp=Math.pow(2,25),Fp=Math.pow(2,24),Ko=Math.pow(2,17),jp=Math.pow(2,16),um=Math.pow(2,9),hm=Math.pow(2,8),pm=Math.pow(2,1);function Ru(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const e=g.placed?1:0,s=Math.floor(127*g.opacity);return s*Dp+e*Fp+s*Ko+e*jp+s*um+e*hm+s*pm+e}const Yo=0;class Lu{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,s,u,d,y){const x=this._bucketParts;for(;this._currentTileIndex<e.length;)if(s.getBucketParts(x,d,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort(((S,k)=>S.sortKey-k.sortKey)));this._currentPartIndex<x.length;)if(s.placeLayerBucketPart(x[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,y())return!0;return!1}}class Du{constructor(e,s,u,d,y,x,S,k){this.placement=new Na(e,s,x,S,k),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(e,s,u){const d=G.now(),y=()=>!this._forceFullPlacement&&G.now()-d>2;for(;this._currentPlacementIndex>=0;){const x=s[e[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(x.type==="symbol"&&(!x.minzoom||x.minzoom<=S)&&(!x.maxzoom||x.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new Lu(x)),this._inProgressLayer.continuePlacement(u[x.source],this.placement,this._showCollisionBoxes,x,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Jo=512/l.$/2;class Fu{constructor(e,s,u){this.tileID=e,this.bucketInstanceId=u,this._symbolsByKey={};const d=new Map;for(let y=0;y<s.length;y++){const x=s.get(y),S=x.key,k=d.get(S);k?k.push(x):d.set(S,[x])}for(const[y,x]of d){const S={positions:x.map((k=>({x:Math.floor(k.anchorX*Jo),y:Math.floor(k.anchorY*Jo)}))),crossTileIDs:x.map((k=>k.crossTileID))};if(S.positions.length>128){const k=new l.aI(S.positions.length,16,Uint16Array);for(const{x:A,y:I}of S.positions)k.add(A,I);k.finish(),delete S.positions,S.index=k}this._symbolsByKey[y]=S}}getScaledCoordinates(e,s){const{x:u,y:d,z:y}=this.tileID.canonical,{x,y:S,z:k}=s.canonical,A=Jo/Math.pow(2,k-y),I=(S*l.$+e.anchorY)*A,D=d*l.$*Jo;return{x:Math.floor((x*l.$+e.anchorX)*A-u*l.$*Jo),y:Math.floor(I-D)}}findMatches(e,s,u){const d=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let y=0;y<e.length;y++){const x=e.get(y);if(x.crossTileID)continue;const S=this._symbolsByKey[x.key];if(!S)continue;const k=this.getScaledCoordinates(x,s);if(S.index){const A=S.index.range(k.x-d,k.y-d,k.x+d,k.y+d).sort();for(const I of A){const D=S.crossTileIDs[I];if(!u[D]){u[D]=!0,x.crossTileID=D;break}}}else if(S.positions)for(let A=0;A<S.positions.length;A++){const I=S.positions[A],D=S.crossTileIDs[A];if(Math.abs(I.x-k.x)<=d&&Math.abs(I.y-k.y)<=d&&!u[D]){u[D]=!0,x.crossTileID=D;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:e})=>e))}}class ju{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class dm{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const s=Math.round((e-this.lng)/360);if(s!==0)for(const u in this.indexes){const d=this.indexes[u],y={};for(const x in d){const S=d[x];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+s),y[S.tileID.key]=S}this.indexes[u]=y}this.lng=e}addBucket(e,s,u){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let y=0;y<s.symbolInstances.length;y++)s.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const d=this.usedCrossTileIDs[e.overscaledZ];for(const y in this.indexes){const x=this.indexes[y];if(Number(y)>e.overscaledZ)for(const S in x){const k=x[S];k.tileID.isChildOf(e)&&k.findMatches(s.symbolInstances,e,d)}else{const S=x[e.scaledTo(Number(y)).key];S&&S.findMatches(s.symbolInstances,e,d)}}for(let y=0;y<s.symbolInstances.length;y++){const x=s.symbolInstances.get(y);x.crossTileID||(x.crossTileID=u.generate(),d[x.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Fu(e,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(e,s){for(const u of s.getCrossTileIDsLists())for(const d of u)delete this.usedCrossTileIDs[e][d]}removeStaleBuckets(e){let s=!1;for(const u in this.indexes){const d=this.indexes[u];for(const y in d)e[d[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,d[y]),delete d[y],s=!0)}return s}}class Qo{constructor(){this.layerIndexes={},this.crossTileIDs=new ju,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,s,u){let d=this.layerIndexes[e.id];d===void 0&&(d=this.layerIndexes[e.id]=new dm);let y=!1;const x={};d.handleWrapJump(u);for(const S of s){const k=S.getBucket(e);k&&e.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(S.tileID,k,this.crossTileIDs)&&(y=!0),x[k.bucketInstanceId]=!0)}return d.removeStaleBuckets(x)&&(y=!0),y}pruneUnusedLayers(e){const s={};e.forEach((u=>{s[u]=!0}));for(const u in this.layerIndexes)s[u]||delete this.layerIndexes[u]}}var Fs="void main() {fragColor=vec4(1.0);}";const vn={prelude:Lt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Lt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Lt("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Lt(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Lt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Lt(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Lt(Fs,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Lt(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Lt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Lt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Lt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Lt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Lt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Lt(Fs,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Lt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Lt(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Lt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Lt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Lt(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Lt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Lt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Lt(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Lt(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Lt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Lt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Lt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Lt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Lt(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Lt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Lt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Lt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Lt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Lt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Lt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Lt(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Lt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Lt(g,e){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=e.match(/in ([\w]+) ([\w]+)/g),d=g.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=y?y.concat(d):d,S={};return{fragmentSource:g=g.replace(s,((k,A,I,D,L)=>(S[L]=!0,A==="define"?`
#ifndef HAS_UNIFORM_u_${L}
in ${I} ${D} ${L};
#else
uniform ${I} ${D} u_${L};
#endif
`:`
#ifdef HAS_UNIFORM_u_${L}
    ${I} ${D} ${L} = u_${L};
#endif
`))),vertexSource:e=e.replace(s,((k,A,I,D,L)=>{const O=D==="float"?"vec2":"vec4",U=L.match(/color/)?"color":O;return S[L]?A==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
in ${I} ${O} a_${L};
out ${I} ${D} ${L};
#else
uniform ${I} ${D} u_${L};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = a_${L};
#else
    ${I} ${D} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = unpack_mix_${U}(a_${L}, u_${L}_t);
#else
    ${I} ${D} ${L} = u_${L};
#endif
`:A==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
in ${I} ${O} a_${L};
#else
uniform ${I} ${D} u_${L};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${I} ${D} ${L} = a_${L};
#else
    ${I} ${D} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${I} ${D} ${L} = unpack_mix_${U}(a_${L}, u_${L}_t);
#else
    ${I} ${D} ${L} = u_${L};
#endif
`})),staticAttributes:u,staticUniforms:x}}class uo{constructor(e,s,u){this.vertexBuffer=e,this.indexBuffer=s,this.segments=u}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Ua=l.aJ([{name:"a_pos",type:"Int16",components:2}]);const ca="#define PROJECTION_MERCATOR",ho="mercator";class Dt{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return ho}get shaderDefine(){return ca}get shaderPreludeCode(){return vn.projectionMercator}get vertexShaderPreludeCode(){return vn.projectionMercator.vertexSource}get subdivisionGranularity(){return l.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,s,u,d,y){if(this._cachedMesh)return this._cachedMesh;const x=new l.aL;x.emplaceBack(0,0),x.emplaceBack(l.$,0),x.emplaceBack(0,l.$),x.emplaceBack(l.$,l.$);const S=e.createVertexBuffer(x,Ua.members),k=l.aM.simpleSegment(0,0,4,2),A=new l.aN;A.emplaceBack(1,0,2),A.emplaceBack(1,2,3);const I=e.createIndexBuffer(A);return this._cachedMesh=new uo(S,I,k),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class po{constructor(e=0,s=0,u=0,d=0){if(isNaN(e)||e<0||isNaN(s)||s<0||isNaN(u)||u<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=s,this.left=u,this.right=d}interpolate(e,s,u){return s.top!=null&&e.top!=null&&(this.top=l.C.number(e.top,s.top,u)),s.bottom!=null&&e.bottom!=null&&(this.bottom=l.C.number(e.bottom,s.bottom,u)),s.left!=null&&e.left!=null&&(this.left=l.C.number(e.left,s.left,u)),s.right!=null&&e.right!=null&&(this.right=l.C.number(e.right,s.right,u)),this}getCenter(e,s){const u=l.ah((this.left+e-this.right)/2,0,e),d=l.ah((this.top+s-this.bottom)/2,0,s);return new l.P(u,d)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new po(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Kl(g,e){if(!g.renderWorldCopies||g.lngRange)return;const s=e.lng-g.center.lng;e.lng+=s>180?-360:s<-180?360:0}function Yl(g){return Math.max(0,Math.floor(g))}class Ei{constructor(e,s,u,d,y,x){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=x===void 0||!!x,this._minZoom=s||0,this._maxZoom=u||22,this._minPitch=d??0,this._maxPitch=y??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new l.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Yl(this._zoom),this._scale=l.af(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new po,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,s,u){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=Yl(this._zoom),this._scale=l.af(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new po(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!u&&e.autoCalculateNearFarZ,s&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const s=l.aO(e,-180,180)*Math.PI/180;var u,d,y,x,S,k,A,I,D;this._bearingInRadians!==s&&(this._unmodified=!1,this._bearingInRadians=s,this._calcMatrices(),this._rotationMatrix=M(),u=this._rotationMatrix,y=-this._bearingInRadians,x=(d=this._rotationMatrix)[0],S=d[1],k=d[2],A=d[3],I=Math.sin(y),D=Math.cos(y),u[0]=x*D+k*I,u[1]=S*D+A*I,u[2]=x*-I+k*D,u[3]=S*-I+A*D)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const s=l.ah(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==s&&(this._unmodified=!1,this._pitchInRadians=s,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const s=e/180*Math.PI;this._rollInRadians!==s&&(this._unmodified=!1,this._rollInRadians=s,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return l.aP(this._fovInRadians)}setFov(e){e=l.ah(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=l.ae(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const s=this.getConstrained(this._center,e).zoom;this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this._tileZoom=Math.max(0,Math.floor(s)),this._scale=l.af(s),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,s){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=s,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,s,u){this._unmodified=!1,this._edgeInsets.interpolate(e,s,u),this._constrain(),this._calcMatrices()}resize(e,s,u=!0){this._width=e,this._height=s,u&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Yt([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-l.ai,l.ai])}getConstrained(e,s){return this._callbacks.getConstrained(e,s)}getCameraQueryGeometry(e,s){if(s.length===1)return[s[0],e];{const{minX:u,minY:d,maxX:y,maxY:x}=l.a2.fromPoints(s).extend(e);return[new l.P(u,d),new l.P(y,d),new l.P(y,x),new l.P(u,x),new l.P(u,d)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:s,zoom:u}=this.getConstrained(this.center,this.zoom);this.setCenter(s),this.setZoom(u),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=l.ag(new Float64Array(16));l.N(e,e,[this._width/2,-this._height/2,1]),l.M(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=l.ag(new Float64Array(16)),l.N(e,e,[1,-1,1]),l.M(e,e,[-1,-1,0]),l.N(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,s,u,d){const y=u!==void 0?u:this.bearing,x=d=d!==void 0?d:this.pitch,S=l.a1.fromLngLat(e,s),k=-Math.cos(l.ae(x)),A=Math.sin(l.ae(x)),I=A*Math.sin(l.ae(y)),D=-A*Math.cos(l.ae(y));let L=this.elevation;const O=s-L;let U;k*O>=0||Math.abs(k)<.1?(U=1e4,L=s+U*k):U=-O/k;let K,X,Y=l.aQ(1,S.y),ee=0;do{if(ee+=1,ee>10)break;X=U/Y,K=new l.a1(S.x+I*X,S.y+D*X),Y=1/K.meterInMercatorCoordinateUnits()}while(Math.abs(U-X*Y)>1e-12);return{center:K.toLngLat(),elevation:L,zoom:l.ak(this.height/2/Math.tan(this.fovInRadians/2)/X/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const s=l.aj(1,this.center.lat)*this.worldSize,u=this.cameraToCenterDistance/s,d=l.a1.fromLngLat(this.center,this.elevation),y=Ce(this.center,this.elevation,this.pitch,this.bearing,u);this._elevation=e;const x=this.calculateCenterFromCameraLngLatAlt(y.toLngLat(),l.aQ(y.z,d.y),this.bearing,this.pitch);this._elevation=x.elevation,this._center=x.center,this.setZoom(x.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=l.aj(1,this.center.lat)*this.worldSize;return Ce(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const s=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/s,e.canonical.y/s,1/s/l.$,1/s/l.$]}}class ri{constructor(e,s){this.min=e,this.max=s,this.center=l.aR([],l.aS([],this.min,this.max),.5)}quadrant(e){const s=[e%2==0,e<2],u=l.aT(this.min),d=l.aT(this.max);for(let y=0;y<s.length;y++)u[y]=s[y]?this.min[y]:this.center[y],d[y]=s[y]?this.center[y]:this.max[y];return d[2]=this.max[2],new ri(u,d)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let s=!0;for(let u=0;u<e.planes.length;u++){const d=this.intersectsPlane(e.planes[u]);if(d===0)return 0;d===1&&(s=!1)}return s?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let s=e[3],u=e[3];for(let d=0;d<3;d++)e[d]>0?(s+=e[d]*this.min[d],u+=e[d]*this.max[d]):(u+=e[d]*this.min[d],s+=e[d]*this.max[d]);return s>=0?2:u<0?0:1}}class Ii{distanceToTile2d(e,s,u,d){const y=d.distanceX([e,s]),x=d.distanceY([e,s]);return Math.hypot(y,x)}getWrap(e,s,u){return u}getTileBoundingVolume(e,s,u,d){var y,x;let S=0,k=0;if(d?.terrain){const I=new l.Z(e.z,s,e.z,e.x,e.y),D=d.terrain.getMinMaxElevation(I);S=(y=D.minElevation)!==null&&y!==void 0?y:Math.min(0,u),k=(x=D.maxElevation)!==null&&x!==void 0?x:Math.max(0,u)}const A=1<<e.z;return new ri([s+e.x/A,e.y/A,S],[s+(e.x+1)/A,(e.y+1)/A,k])}allowVariableZoom(e,s){const u=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,d=l.ah(78.5-u/2,0,60);return!!s.terrain||e.pitch>d}allowWorldCopies(){return!0}prepareNextFrame(){}}class Nr{constructor(e,s,u){this.points=e,this.planes=s,this.aabb=u}static fromInvProjectionMatrix(e,s=1,u=0,d,y){const x=y?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],S=Math.pow(2,u),k=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((L=>(function(O,U,K,X){const Y=l.aw([],O,U),ee=1/Y[3]/K*X;return l.aY(Y,Y,[ee,ee,1/Y[3],ee])})(L,e,s,S)));d&&(function(L,O,U,K){const X=K?4:0,Y=K?0:4;let ee=0;const ne=[],te=[];for(let re=0;re<4;re++){const _e=l.aU([],L[re+Y],L[re+X]),Me=l.aZ(_e);l.aR(_e,_e,1/Me),ne.push(Me),te.push(_e)}for(let re=0;re<4;re++){const _e=l.a_(L[re+X],te[re],U);ee=_e!==null&&_e>=0?Math.max(ee,_e):Math.max(ee,ne[re])}const oe=(function(re,_e){const Me=l.aU([],re[_e[0]],re[_e[1]]),Te=l.aU([],re[_e[2]],re[_e[1]]),Se=[0,0,0,0];return l.aV(Se,l.aW([],Me,Te)),Se[3]=-l.aX(Se,re[_e[0]]),Se})(L,O),ce=(function(re,_e){const Me=l.a$(re),Te=l.b0([],re,1/Me),Se=l.aU([],_e,l.aR([],Te,l.aX(_e,Te))),Pe=l.a$(Se);if(Pe>0){const Oe=Math.sqrt(1-Te[3]*Te[3]),Ne=l.aR([],Te,-Te[3]),Le=l.aS([],Ne,l.aR([],Se,Oe/Pe));return l.b1(_e,Le)}return null})(U,oe);if(ce!==null){const re=ce/l.aX(te[0],oe);ee=Math.min(ee,re)}for(let re=0;re<4;re++){const _e=Math.min(ee,ne[re]);L[re+Y]=[L[re+X][0]+te[re][0]*_e,L[re+X][1]+te[re][1]*_e,L[re+X][2]+te[re][2]*_e,1]}})(k,x[0],d,y);const A=x.map((L=>{const O=l.aU([],k[L[0]],k[L[1]]),U=l.aU([],k[L[2]],k[L[1]]),K=l.aV([],l.aW([],O,U)),X=-l.aX(K,k[L[1]]);return K.concat(X)})),I=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],D=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const L of k)for(let O=0;O<3;O++)I[O]=Math.min(I[O],L[O]),D[O]=Math.max(D[O],L[O]);return new Nr(k,A,new ri(I,D))}}class hr{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,s,u){return this._helper.interpolatePadding(e,s,u)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,s,u=!0){this._helper.resize(e,s,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,s){this._helper.overrideNearFarZ(e,s)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,s){}constructor(e,s,u,d,y){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Ei({calcMatrices:()=>{this._calcMatrices()},getConstrained:(x,S)=>this.getConstrained(x,S)},e,s,u,d,y),this._coveringTilesDetailsProvider=new Ii}clone(){const e=new hr;return e.apply(this),e}apply(e,s,u){this._helper.apply(e,s,u)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const s=[new l.b2(0,e)];if(this._helper._renderWorldCopies){const u=this.screenPointToMercatorCoordinate(new l.P(0,0)),d=this.screenPointToMercatorCoordinate(new l.P(this._helper._width,0)),y=this.screenPointToMercatorCoordinate(new l.P(this._helper._width,this._helper._height)),x=this.screenPointToMercatorCoordinate(new l.P(0,this._helper._height)),S=Math.floor(Math.min(u.x,d.x,y.x,x.x)),k=Math.floor(Math.max(u.x,d.x,y.x,x.x)),A=1;for(let I=S-A;I<=k+A;I++)I!==0&&s.push(new l.b2(I,e))}return s}getCameraFrustum(){return Nr.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const s=this.screenPointToLocation(this.centerPoint,e),u=e?e.getElevationForLngLatZoom(s,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(u)}setLocationAtPoint(e,s){const u=l.aj(this.elevation,this.center.lat),d=this.screenPointToMercatorCoordinateAtZ(s,u),y=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,u),x=l.a1.fromLngLat(e),S=new l.a1(x.x-(d.x-y.x),x.y-(d.y-y.y));this.setCenter(S?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,s){return s?this.coordinatePoint(l.a1.fromLngLat(e),s.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(l.a1.fromLngLat(e))}screenPointToLocation(e,s){var u;return(u=this.screenPointToMercatorCoordinate(e,s))===null||u===void 0?void 0:u.toLngLat()}screenPointToMercatorCoordinate(e,s){if(s){const u=s.pointCoordinate(e);if(u!=null)return u}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,s){const u=s||0,d=[e.x,e.y,0,1],y=[e.x,e.y,1,1];l.aw(d,d,this._pixelMatrixInverse),l.aw(y,y,this._pixelMatrixInverse);const x=d[3],S=y[3],k=d[1]/x,A=y[1]/S,I=d[2]/x,D=y[2]/S,L=I===D?0:(u-I)/(D-I);return new l.a1(l.C.number(d[0]/x,y[0]/S,L)/this.worldSize,l.C.number(k,A,L)/this.worldSize,u)}coordinatePoint(e,s=0,u=this._pixelMatrix){const d=[e.x*this.worldSize,e.y*this.worldSize,s,1];return l.aw(d,d,u),new l.P(d[0]/d[3],d[1]/d[3])}getBounds(){const e=Math.max(0,this._helper._height/2-ue(this));return new Yt().extend(this.screenPointToLocation(new l.P(0,e))).extend(this.screenPointToLocation(new l.P(this._helper._width,e))).extend(this.screenPointToLocation(new l.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new l.P(0,this._helper._height)))}isPointOnMapSurface(e,s){return s?s.pointCoordinate(e)!=null:e.y>this.height/2-ue(this)}calculatePosMatrix(e,s=!1,u){var d;const y=(d=e.key)!==null&&d!==void 0?d:l.b3(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),x=s?this._alignedPosMatrixCache:this._posMatrixCache;if(x.has(y)){const A=x.get(y);return u?A.f32:A.f64}const S=ye(e,this.worldSize);l.O(S,s?this._alignedProjMatrix:this._viewProjMatrix,S);const k={f64:S,f32:new Float32Array(S)};return x.set(y,k),u?k.f32:k.f64}calculateFogMatrix(e){const s=e.key,u=this._fogMatrixCacheF32;if(u.has(s))return u.get(s);const d=ye(e,this.worldSize);return l.O(d,this._fogMatrix,d),u.set(s,new Float32Array(d)),u.get(s)}getConstrained(e,s){s=l.ah(+s,this.minZoom,this.maxZoom);const u={center:new l.S(e.lng,e.lat),zoom:s};let d=this._helper._lngRange;if(!this._helper._renderWorldCopies&&d===null){const ne=179.9999999999;d=[-ne,ne]}const y=this.tileSize*l.af(u.zoom);let x=0,S=y,k=0,A=y,I=0,D=0;const{x:L,y:O}=this.size;if(this._helper._latRange){const ne=this._helper._latRange;x=l.U(ne[1])*y,S=l.U(ne[0])*y,S-x<O&&(I=O/(S-x))}d&&(k=l.aO(l.V(d[0])*y,0,y),A=l.aO(l.V(d[1])*y,0,y),A<k&&(A+=y),A-k<L&&(D=L/(A-k)));const{x:U,y:K}=W(y,e);let X,Y;const ee=Math.max(D||0,I||0);if(ee){const ne=new l.P(D?(A+k)/2:U,I?(S+x)/2:K);return u.center=ie(y,ne).wrap(),u.zoom+=l.ak(ee),u}if(this._helper._latRange){const ne=O/2;K-ne<x&&(Y=x+ne),K+ne>S&&(Y=S-ne)}if(d){const ne=(k+A)/2;let te=U;this._helper._renderWorldCopies&&(te=l.aO(U,ne-y/2,ne+y/2));const oe=L/2;te-oe<k&&(X=k+oe),te+oe>A&&(X=A-oe)}if(X!==void 0||Y!==void 0){const ne=new l.P(X??U,Y??K);u.center=ie(y,ne).wrap()}return u}calculateCenterFromCameraLngLatAlt(e,s,u,d){return this._helper.calculateCenterFromCameraLngLatAlt(e,s,u,d)}_calculateNearFarZIfNeeded(e,s,u){if(!this._helper.autoCalculateNearFarZ)return;const d=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),y=e-d*this._helper._pixelPerMeter/Math.cos(s),x=d<0?y:e,S=Math.PI/2+this.pitchInRadians,k=l.ae(this.fov)*(Math.abs(Math.cos(l.ae(this.roll)))*this.height+Math.abs(Math.sin(l.ae(this.roll)))*this.width)/this.height*(.5+u.y/this.height),A=Math.sin(k)*x/Math.sin(l.ah(Math.PI-S-k,.01,Math.PI-.01)),I=ue(this),D=Math.atan(I/this._helper.cameraToCenterDistance),L=l.ae(.75),O=D>L?2*D*(.5+u.y/(2*I)):L,U=Math.sin(O)*x/Math.sin(l.ah(Math.PI-S-O,.01,Math.PI-.01)),K=Math.min(A,U);this._helper._farZ=1.01*(Math.cos(Math.PI/2-s)*K+x),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,s=W(this.worldSize,this.center),u=s.x,d=s.y;this._helper._pixelPerMeter=l.aj(1,this.center.lat)*this.worldSize;const y=l.ae(Math.min(this.pitch,Z)),x=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(y));let S;this._calculateNearFarZIfNeeded(x,y,e),S=new Float64Array(16),l.b4(S,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),l.aq(this._invProjMatrix,S),S[8]=2*-e.x/this._helper._width,S[9]=2*e.y/this._helper._height,this._projectionMatrix=l.b5(S),l.N(S,S,[1,-1,1]),l.M(S,S,[0,0,-this._helper.cameraToCenterDistance]),l.b6(S,S,-this.rollInRadians),l.b7(S,S,this.pitchInRadians),l.b6(S,S,-this.bearingInRadians),l.M(S,S,[-u,-d,0]),this._mercatorMatrix=l.N([],S,[this.worldSize,this.worldSize,this.worldSize]),l.N(S,S,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=l.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,S),l.M(S,S,[0,0,-this.elevation]),this._viewProjMatrix=S,this._invViewProjMatrix=l.aq([],S);const k=[0,0,-1,1];l.aw(k,k,this._invViewProjMatrix),this._cameraPosition=[k[0]/k[3],k[1]/k[3],k[2]/k[3]],this._fogMatrix=new Float64Array(16),l.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,x,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,l.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),l.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),l.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),l.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),l.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),l.M(this._fogMatrix,this._fogMatrix,[-u,-d,0]),l.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),l.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=l.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,S);const A=this._helper._width%2/2,I=this._helper._height%2/2,D=Math.cos(this.bearingInRadians),L=Math.sin(-this.bearingInRadians),O=u-Math.round(u)+D*A+L*I,U=d-Math.round(d)+D*I+L*A,K=new Float64Array(S);if(l.M(K,K,[O>.5?O-1:O,U>.5?U-1:U,0]),this._alignedProjMatrix=K,S=l.aq(new Float64Array(16),this._pixelMatrix),!S)throw new Error("failed to invert matrix");this._pixelMatrixInverse=S,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new l.P(0,0)),s=[e.x*this.worldSize,e.y*this.worldSize,0,1];return l.aw(s,s,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=l.aj(1,this.center.lat)*this.worldSize;return Ce(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,s){const u=l.a1.fromLngLat(e),d=[u.x*this.worldSize,u.y*this.worldSize,s,1];return l.aw(d,d,this._viewProjMatrix),d[2]/d[3]}getProjectionData(e){const{overscaledTileID:s,aligned:u,applyTerrainMatrix:d}=e,y=this._helper.getMercatorTileCoordinates(s),x=s?this.calculatePosMatrix(s,u,!0):null;let S;return S=s&&s.terrainRttPosMatrix32f&&d?s.terrainRttPosMatrix32f:x||l.b8(),{mainMatrix:S,tileMercatorCoords:y,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:S}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,s,u){return 1}transformLightDirection(e){return l.aT(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,s,u,d){const y=this.calculatePosMatrix(u);let x;d?(x=[e,s,d(e,s),1],l.aw(x,x,y)):(x=[e,s,0,1],Xo(x,x,y));const S=x[3];return{point:new l.P(x[0]/S,x[1]/S),signedDistanceFromCamera:S,isOccluded:!1}}populateCache(e){for(const s of e)this.calculatePosMatrix(s)}getMatrixForModel(e,s){const u=l.a1.fromLngLat(e,s),d=u.meterInMercatorCoordinateUnits(),y=l.b9();return l.M(y,y,[u.x,u.y,u.z]),l.b6(y,y,Math.PI),l.b7(y,y,Math.PI/2),l.N(y,y,[-d,d,d]),y}getProjectionDataForCustomLayer(e=!0){const s=new l.Z(0,0,0,0,0),u=this.getProjectionData({overscaledTileID:s,applyGlobeMatrix:e}),d=ye(s,this.worldSize);l.O(d,this._viewProjMatrix,d),u.tileMercatorCoords=[0,0,1,1];const y=[l.$,l.$,this.worldSize/this._helper.pixelsPerMeter],x=l.ba();return l.N(x,d,y),u.fallbackMatrix=x,u.mainMatrix=x,u}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function Op(){l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function zi(g){if(g.useSlerp)if(g.k<1){const e=l.bb(g.startEulerAngles.roll,g.startEulerAngles.pitch,g.startEulerAngles.bearing),s=l.bb(g.endEulerAngles.roll,g.endEulerAngles.pitch,g.endEulerAngles.bearing),u=new Float64Array(4);l.bc(u,e,s,g.k);const d=l.bd(u);g.tr.setRoll(d.roll),g.tr.setPitch(d.pitch),g.tr.setBearing(d.bearing)}else g.tr.setRoll(g.endEulerAngles.roll),g.tr.setPitch(g.endEulerAngles.pitch),g.tr.setBearing(g.endEulerAngles.bearing);else g.tr.setRoll(l.C.number(g.startEulerAngles.roll,g.endEulerAngles.roll,g.k)),g.tr.setPitch(l.C.number(g.startEulerAngles.pitch,g.endEulerAngles.pitch,g.k)),g.tr.setBearing(l.C.number(g.startEulerAngles.bearing,g.endEulerAngles.bearing,g.k))}function Qi(g,e,s,u,d){const y=d.padding,x=W(d.worldSize,s.getNorthWest()),S=W(d.worldSize,s.getNorthEast()),k=W(d.worldSize,s.getSouthEast()),A=W(d.worldSize,s.getSouthWest()),I=l.ae(-u),D=x.rotate(I),L=S.rotate(I),O=k.rotate(I),U=A.rotate(I),K=new l.P(Math.max(D.x,L.x,U.x,O.x),Math.max(D.y,L.y,U.y,O.y)),X=new l.P(Math.min(D.x,L.x,U.x,O.x),Math.min(D.y,L.y,U.y,O.y)),Y=K.sub(X),ee=(d.width-(y.left+y.right+e.left+e.right))/Y.x,ne=(d.height-(y.top+y.bottom+e.top+e.bottom))/Y.y;if(ne<0||ee<0)return void Op();const te=Math.min(l.ak(d.scale*Math.min(ee,ne)),g.maxZoom),oe=l.P.convert(g.offset),ce=new l.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(l.ae(u)),re=oe.add(ce).mult(d.scale/l.af(te));return{center:ie(d.worldSize,x.add(k).div(2).sub(re)),zoom:te,bearing:u}}class Ti{get useGlobeControls(){return!1}handlePanInertia(e,s){return{easingOffset:e,easingCenter:s.center}}handleMapControlsRollPitchBearingZoom(e,s){e.bearingDelta&&s.setBearing(s.bearing+e.bearingDelta),e.pitchDelta&&s.setPitch(s.pitch+e.pitchDelta),e.rollDelta&&s.setRoll(s.roll+e.rollDelta),e.zoomDelta&&s.setZoom(s.zoom+e.zoomDelta)}handleMapControlsPan(e,s,u){e.around.distSqr(s.centerPoint)<.01||s.setLocationAtPoint(u,e.around)}cameraForBoxAndBearing(e,s,u,d,y){return Qi(e,s,u,d,y)}handleJumpToCenterZoom(e,s){e.zoom!==(s.zoom!==void 0?+s.zoom:e.zoom)&&e.setZoom(+s.zoom),s.center!==void 0&&e.setCenter(l.S.convert(s.center))}handleEaseTo(e,s){const u=e.zoom,d=e.padding,y={roll:e.roll,pitch:e.pitch,bearing:e.bearing},x={roll:s.roll===void 0?e.roll:s.roll,pitch:s.pitch===void 0?e.pitch:s.pitch,bearing:s.bearing===void 0?e.bearing:s.bearing},S=s.zoom!==void 0,k=!e.isPaddingEqual(s.padding);let A=!1;const I=S?+s.zoom:e.zoom;let D=e.centerPoint.add(s.offsetAsPoint);const L=e.screenPointToLocation(D),{center:O,zoom:U}=e.getConstrained(l.S.convert(s.center||L),I??u);Kl(e,O);const K=W(e.worldSize,L),X=W(e.worldSize,O).sub(K),Y=l.af(U-u);return A=U!==u,{easeFunc:ee=>{if(A&&e.setZoom(l.C.number(u,U,ee)),l.be(y,x)||zi({startEulerAngles:y,endEulerAngles:x,tr:e,k:ee,useSlerp:y.roll!=x.roll}),k&&(e.interpolatePadding(d,s.padding,ee),D=e.centerPoint.add(s.offsetAsPoint)),s.around)e.setLocationAtPoint(s.around,s.aroundPoint);else{const ne=l.af(e.zoom-u),te=U>u?Math.min(2,Y):Math.max(.5,Y),oe=Math.pow(te,1-ee),ce=ie(e.worldSize,K.add(X.mult(ee*oe)).mult(ne));e.setLocationAtPoint(e.renderWorldCopies?ce.wrap():ce,D)}},isZooming:A,elevationCenter:O}}handleFlyTo(e,s){const u=s.zoom!==void 0,d=e.zoom,y=e.getConstrained(l.S.convert(s.center||s.locationAtOffset),u?+s.zoom:d),x=y.center,S=y.zoom;Kl(e,x);const k=W(e.worldSize,s.locationAtOffset),A=W(e.worldSize,x).sub(k),I=A.mag(),D=l.af(S-d);let L;if(s.minZoom!==void 0){const O=Math.min(+s.minZoom,d,S),U=e.getConstrained(x,O).zoom;L=l.af(U-d)}return{easeFunc:(O,U,K,X)=>{e.setZoom(O===1?S:d+l.ak(U));const Y=O===1?x:ie(e.worldSize,k.add(A.mult(K)).mult(U));e.setLocationAtPoint(e.renderWorldCopies?Y.wrap():Y,X)},scaleOfZoom:D,targetCenter:x,scaleOfMinZoom:L,pixelPathLength:I}}}class yr{constructor(e,s,u){this.blendFunction=e,this.blendColor=s,this.mask=u}}yr.Replace=[1,0],yr.disabled=new yr(yr.Replace,l.bf.transparent,[!1,!1,!1,!1]),yr.unblended=new yr(yr.Replace,l.bf.transparent,[!0,!0,!0,!0]),yr.alphaBlended=new yr([1,771],l.bf.transparent,[!0,!0,!0,!0]);const fo=2305;class ft{constructor(e,s,u){this.enable=e,this.mode=s,this.frontFace=u}}ft.disabled=new ft(!1,1029,fo),ft.backCCW=new ft(!0,1029,fo),ft.frontCCW=new ft(!0,1028,fo);class wt{constructor(e,s,u){this.func=e,this.mask=s,this.range=u}}wt.ReadOnly=!1,wt.ReadWrite=!0,wt.disabled=new wt(519,wt.ReadOnly,[0,1]);const ua=7680;class Wt{constructor(e,s,u,d,y,x){this.test=e,this.ref=s,this.mask=u,this.fail=d,this.depthFail=y,this.pass=x}}Wt.disabled=new Wt({func:519,mask:0},0,0,ua,ua,ua);const en=new WeakMap;function Wn(g){var e;if(en.has(g))return en.get(g);{const s=(e=g.getParameter(g.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return en.set(g,s),s}}class Hn{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const s=e.context,u=s.gl;this._texFormat=u.RGBA,this._texType=u.UNSIGNED_BYTE;const d=new l.aL;d.emplaceBack(-1,-1),d.emplaceBack(2,-1),d.emplaceBack(-1,2);const y=new l.aN;y.emplaceBack(0,1,2),this._fullscreenTriangle=new uo(s.createVertexBuffer(d,Ua.members),s.createIndexBuffer(y),l.aM.simpleSegment(0,0,d.length,y.length)),this._resultBuffer=new Uint8Array(4),s.activeTexture.set(u.TEXTURE1);const x=u.createTexture();u.bindTexture(u.TEXTURE_2D,x),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.NEAREST),u.texImage2D(u.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=s.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(x),Wn(u)&&(this._pbo=u.createBuffer(),u.bindBuffer(u.PIXEL_PACK_BUFFER,this._pbo),u.bufferData(u.PIXEL_PACK_BUFFER,4,u.STREAM_READ),u.bindBuffer(u.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,s){const u=this._updateCount;return this._readbackQueue?u>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():u>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,s),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,s=e.gl;e.activeTexture.set(s.TEXTURE1),s.bindTexture(s.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,s){const u=this._cachedRenderContext.context,d=u.gl;if(this._bindFramebuffer(),u.viewport.set([0,0,this._texWidth,this._texHeight]),u.clear({color:l.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(u,d.TRIANGLES,wt.disabled,Wt.disabled,yr.unblended,ft.disabled,((y,x)=>({u_input:y,u_output_expected:x}))(e,s),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Wn(d)){d.bindBuffer(d.PIXEL_PACK_BUFFER,this._pbo),d.readBuffer(d.COLOR_ATTACHMENT0),d.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),d.bindBuffer(d.PIXEL_PACK_BUFFER,null);const y=d.fenceSync(d.SYNC_GPU_COMMANDS_COMPLETE,0);d.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:y}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Wn(e)){const s=e.clientWaitSync(this._readbackQueue.sync,0,0);if(s===e.WAIT_FAILED)return l.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(s===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=Hn._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let s=0;return s+=e[0]/256,s+=e[1]/65536,s+=e[2]/16777216,e[3]<127&&(s=-s),s/128}}const Jl=l.$/128;function Ou(g,e){const s=g.granularity!==void 0?Math.max(g.granularity,1):1,u=s+(g.generateBorders?2:0),d=s+(g.extendToNorthPole||g.generateBorders?1:0)+(g.extendToSouthPole||g.generateBorders?1:0),y=u+1,x=d+1,S=g.generateBorders?-1:0,k=g.generateBorders||g.extendToNorthPole?-1:0,A=s+(g.generateBorders?1:0),I=s+(g.generateBorders||g.extendToSouthPole?1:0),D=y*x,L=u*d*6,O=y*x>65536;if(O&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const U=O||e==="32bit",K=new Int16Array(2*D);let X=0;for(let ne=k;ne<=I;ne++)for(let te=S;te<=A;te++){let oe=te/s*l.$;te===-1&&(oe=-Jl),te===s+1&&(oe=l.$+Jl);let ce=ne/s*l.$;ne===-1&&(ce=g.extendToNorthPole?l.bh:-Jl),ne===s+1&&(ce=g.extendToSouthPole?l.bi:l.$+Jl),K[X++]=oe,K[X++]=ce}const Y=U?new Uint32Array(L):new Uint16Array(L);let ee=0;for(let ne=0;ne<d;ne++)for(let te=0;te<u;te++){const oe=te+1+ne*y,ce=te+(ne+1)*y,re=te+1+(ne+1)*y;Y[ee++]=te+ne*y,Y[ee++]=ce,Y[ee++]=oe,Y[ee++]=oe,Y[ee++]=ce,Y[ee++]=re}return{vertices:K.buffer.slice(0),indices:Y.buffer.slice(0),uses32bitIndices:U}}const es=new l.aK({fill:new l.bj(128,2),line:new l.bj(512,0),tile:new l.bj(128,32),stencil:new l.bj(128,1),circle:3});class js{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return vn.projectionGlobe}get vertexShaderPreludeCode(){return vn.projectionMercator.vertexSource}get subdivisionGranularity(){return es}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new Hn(e));const s=l.U(this._errorQueryLatitudeDegrees),u=2*Math.atan(Math.exp(Math.PI-s*Math.PI*2))-.5*Math.PI,d=this._errorMeasurement.updateErrorLoop(s,u),y=G.now();d!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=d,this._errorMeasurementLastChangeTime=y);const x=Math.min(Math.max((y-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=l.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,l.bl(x))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,s,u,d,y){const x=(y==="stencil"?es.stencil:es.tile).getGranularityForZoomLevel(s.z);return this._getMesh(e,{granularity:x,generateBorders:u,extendToNorthPole:s.y===0&&d,extendToSouthPole:s.y===(1<<s.z)-1&&d})}_getMesh(e,s){const u=this._getMeshKey(s);if(u in this._tileMeshCache)return this._tileMeshCache[u];const d=(function(y,x){const S=Ou(x,"16bit"),k=l.aL.deserialize({arrayBuffer:S.vertices,length:S.vertices.byteLength/2/2}),A=l.aN.deserialize({arrayBuffer:S.indices,length:S.indices.byteLength/2/3});return new uo(y.createVertexBuffer(k,Ua.members),y.createIndexBuffer(A),l.aM.simpleSegment(0,0,k.length,A.length))})(e,s);return this._tileMeshCache[u]=d,d}recalculate(e){}hasTransition(){const e=G.now();let s=!1;return s=s||(e-this._errorMeasurementLastChangeTime)/1e3<.7,s=s||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,s}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const Ql=new l.r({type:new l.D(l.v.projection.type)});class ec extends l.E{constructor(e){super(),this._transitionable=new l.t(Ql),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.F(0)),this._mercatorProjection=new Dt,this._verticalPerspectiveProjection=new js}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof l.bm){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,s,u,d,y){return this.currentProjection.getMeshFromTileID(e,s,u,d,y)}setProjection(e){this._transitionable.setValue("type",e?.type||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function tc(g){const e=ts(g.worldSize,g.center.lat);return 2*Math.PI*e}function bn(g,e,s,u,d){const y=1/(1<<d),x=e/l.$*y+u*y,S=l.bo((g/l.$*y+s*y)*Math.PI*2+Math.PI,2*Math.PI),k=2*Math.atan(Math.exp(Math.PI-x*Math.PI*2))-.5*Math.PI,A=Math.cos(k),I=new Float64Array(3);return I[0]=Math.sin(S)*A,I[1]=Math.sin(k),I[2]=Math.cos(S)*A,I}function ii(g){return(function(e,s){const u=Math.cos(s),d=new Float64Array(3);return d[0]=Math.sin(e)*u,d[1]=Math.sin(s),d[2]=Math.cos(e)*u,d})(g.lng*Math.PI/180,g.lat*Math.PI/180)}function ts(g,e){return g/(2*Math.PI)/Math.cos(e*Math.PI/180)}function Os(g){const e=Math.asin(g[1])/Math.PI*180,s=Math.sqrt(g[0]*g[0]+g[2]*g[2]);if(s>1e-6){const u=g[0]/s,d=Math.acos(g[2]/s),y=(u>0?d:-d)/Math.PI*180;return new l.S(l.aO(y,-180,180),e)}return new l.S(0,e)}function mo(g){return Math.cos(g*Math.PI/180)}function Er(g,e){const s=mo(g),u=mo(e);return l.ak(u/s)}function Bp(g,e){const s=g.rotate(e.bearingInRadians),u=e.zoom+Er(e.center.lat,0),d=l.bk(1/mo(e.center.lat),1/mo(Math.min(Math.abs(e.center.lat),60)),l.bn(u,7,3,0,1)),y=360/tc({worldSize:e.worldSize,center:{lat:e.center.lat}});return new l.S(e.center.lng-s.x*y*d,l.ah(e.center.lat+s.y*y,-l.ai,l.ai))}function Bs(g){const e=.5*g,s=Math.sin(e),u=Math.cos(e);return Math.log(s+u)-Math.log(u-s)}function Bu(g,e,s,u){const d=g.lat+s*u;if(Math.abs(s)>1){const y=(Math.sign(g.lat+s)!==Math.sign(g.lat)?-Math.abs(g.lat):Math.abs(g.lat))*Math.PI/180,x=Math.abs(g.lat+s)*Math.PI/180,S=Bs(y+u*(x-y)),k=Bs(y),A=Bs(x);return new l.S(g.lng+e*((S-k)/(A-k)),d)}return new l.S(g.lng+e*u,d)}class fm{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,s,u,d){const y=`${e.z}_${e.x}_${e.y}_${d?.terrain?"t":""}`,x=this._cache.get(y);if(x)return x;const S=this._cachePrevious.get(y);if(S)return this._cache.set(y,S),S;const k=this._boundingVolumeFactory(e,s,u,d);return this._cache.set(y,k),this._hadAnyChanges=!0,k}}class rs{constructor(e,s,u,d){this.min=u,this.max=d,this.points=e,this.planes=s}static fromAabb(e,s){const u=[];for(let d=0;d<8;d++)u.push([1&~d?e[0]:s[0],(d>>1&1)==1?s[1]:e[1],(d>>2&1)==1?s[2]:e[2]]);return new rs(u,[[-1,0,0,s[0]],[1,0,0,-e[0]],[0,-1,0,s[1]],[0,1,0,-e[1]],[0,0,-1,s[2]],[0,0,1,-e[2]]],e,s)}static fromCenterSizeAngles(e,s,u){const d=l.br([],u[0],u[1],u[2]),y=l.bs([],[s[0],0,0],d),x=l.bs([],[0,s[1],0],d),S=l.bs([],[0,0,s[2]],d),k=[...e],A=[...e];for(let D=0;D<8;D++)for(let L=0;L<3;L++){const O=e[L]+y[L]*(1&~D?-1:1)+x[L]*((D>>1&1)==1?1:-1)+S[L]*((D>>2&1)==1?1:-1);k[L]=Math.min(k[L],O),A[L]=Math.max(A[L],O)}const I=[];for(let D=0;D<8;D++){const L=[...e];l.aS(L,L,l.aR([],y,1&~D?-1:1)),l.aS(L,L,l.aR([],x,(D>>1&1)==1?1:-1)),l.aS(L,L,l.aR([],S,(D>>2&1)==1?1:-1)),I.push(L)}return new rs(I,[[...y,-l.aX(y,I[0])],[...x,-l.aX(x,I[0])],[...S,-l.aX(S,I[0])],[-y[0],-y[1],-y[2],-l.aX(y,I[7])],[-x[0],-x[1],-x[2],-l.aX(x,I[7])],[-S[0],-S[1],-S[2],-l.aX(S,I[7])]],k,A)}intersectsFrustum(e){let s=!0;const u=this.points.length,d=this.planes.length,y=e.planes.length,x=e.points.length;for(let S=0;S<y;S++){const k=e.planes[S];let A=0;for(let I=0;I<u;I++){const D=this.points[I];k[0]*D[0]+k[1]*D[1]+k[2]*D[2]+k[3]>=0&&A++}if(A===0)return 0;A<u&&(s=!1)}if(s)return 2;for(let S=0;S<d;S++){const k=this.planes[S];let A=0;for(let I=0;I<x;I++){const D=e.points[I];k[0]*D[0]+k[1]*D[1]+k[2]*D[2]+k[3]>=0&&A++}if(A===0)return 0}return 1}intersectsPlane(e){const s=this.points.length;let u=0;for(let d=0;d<s;d++){const y=this.points[d];e[0]*y[0]+e[1]*y[1]+e[2]*y[2]+e[3]>=0&&u++}return u===s?2:u===0?0:1}}function di(g,e,s){const u=g-e;return u<0?-u:Math.max(0,u-s)}function $s(g,e,s,u,d){const y=g-s;let x;return x=y<0?Math.min(-y,1+y-d):y>1?Math.min(Math.max(y-d,0),1-y):0,Math.max(x,di(e,u,d))}class Xn{constructor(){this._boundingVolumeCache=new fm(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,s,u,d){const y=1<<u.z,x=1/y,S=u.x/y,k=u.y/y;let A=2;return A=Math.min(A,$s(e,s,S,k,x)),A=Math.min(A,$s(e,s,S+.5,-k-x,x)),A=Math.min(A,$s(e,s,S+.5,2-k-x,x)),A}getWrap(e,s,u){const d=1<<s.z,y=1/d,x=s.x/d,S=di(e.x,x,y),k=di(e.x,x-1,y),A=di(e.x,x+1,y),I=Math.min(S,k,A);return I===A?1:I===k?-1:0}allowVariableZoom(e,s){return at(e,s)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,s,u,d){return this._boundingVolumeCache.getTileBoundingVolume(e,s,u,d)}_computeTileBoundingVolume(e,s,u,d){var y,x;let S=0,k=0;if(d?.terrain){const A=new l.Z(e.z,s,e.z,e.x,e.y),I=d.terrain.getMinMaxElevation(A);S=(y=I.minElevation)!==null&&y!==void 0?y:Math.min(0,u),k=(x=I.maxElevation)!==null&&x!==void 0?x:Math.max(0,u)}if(S/=l.bu,k/=l.bu,S+=1,k+=1,e.z<=0)return rs.fromAabb([-k,-k,-k],[k,k,k]);if(e.z===1)return rs.fromAabb([e.x===0?-k:0,e.y===0?0:-k,-k],[e.x===0?0:k,e.y===0?k:0,k]);{const A=[bn(0,0,e.x,e.y,e.z),bn(l.$,0,e.x,e.y,e.z),bn(l.$,l.$,e.x,e.y,e.z),bn(0,l.$,e.x,e.y,e.z)],I=[];for(const Se of A)I.push(l.aR([],Se,k));if(k!==S)for(const Se of A)I.push(l.aR([],Se,S));e.y===0&&I.push([0,1,0]),e.y===(1<<e.z)-1&&I.push([0,-1,0]);const D=[1,1,1],L=[-1,-1,-1];for(const Se of I)for(let Pe=0;Pe<3;Pe++)D[Pe]=Math.min(D[Pe],Se[Pe]),L[Pe]=Math.max(L[Pe],Se[Pe]);const O=bn(l.$/2,l.$/2,e.x,e.y,e.z),U=l.aW([],[0,1,0],O);l.aV(U,U);const K=l.aW([],O,U);l.aV(K,K);const X=l.aW([],A[2],A[1]);l.aV(X,X);const Y=l.aW([],A[0],A[3]);l.aV(Y,Y),I.push(l.aR([],O,k)),e.y>=(1<<e.z)/2&&I.push(l.aR([],bn(l.$/2,0,e.x,e.y,e.z),k)),e.y<(1<<e.z)/2&&I.push(l.aR([],bn(l.$/2,l.$,e.x,e.y,e.z),k));const ee=Ns(O,I),ne=Ns(K,I),te=[-O[0],-O[1],-O[2],ee.max],oe=[O[0],O[1],O[2],-ee.min],ce=[-K[0],-K[1],-K[2],ne.max],re=[K[0],K[1],K[2],-ne.min],_e=[...X,0],Me=[...Y,0],Te=[];return e.y===0?Te.push(l.bt(Me,_e,te),l.bt(Me,_e,oe)):Te.push(l.bt(ce,_e,te),l.bt(ce,_e,oe),l.bt(ce,Me,te),l.bt(ce,Me,oe)),e.y===(1<<e.z)-1?Te.push(l.bt(Me,_e,te),l.bt(Me,_e,oe)):Te.push(l.bt(re,_e,te),l.bt(re,_e,oe),l.bt(re,Me,te),l.bt(re,Me,oe)),new rs(Te,[te,oe,ce,re,_e,Me],D,L)}}}function Ns(g,e){let s=1/0,u=-1/0;for(const d of e){const y=l.aX(g,d);s=Math.min(s,y),u=Math.max(u,y)}return{min:s,max:u}}class Us{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,s,u){return this._helper.interpolatePadding(e,s,u)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,s){this._helper.resize(e,s)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,s){this._helper.overrideNearFarZ(e,s)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=l.bv(),this._projectionMatrix=l.b9(),this._globeViewProjMatrix32f=l.b8(),this._globeViewProjMatrixNoCorrection=l.b9(),this._globeViewProjMatrixNoCorrectionInverted=l.b9(),this._globeProjMatrixInverted=l.b9(),this._cameraPosition=l.bp(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Ei({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,s)=>this.getConstrained(e,s)}),this._coveringTilesDetailsProvider=new Xn}clone(){const e=new Us;return e.apply(this),e}apply(e,s){this._globeLatitudeErrorCorrectionRadians=s||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=l.bp();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:s,applyGlobeMatrix:u}=e,d=this._helper.getMercatorTileCoordinates(s);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:d,clippingPlane:this._cachedClippingPlane,projectionTransition:u?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const s=this.pitchInRadians,u=this.cameraToCenterDistance/e,d=Math.sin(s)*u,y=Math.cos(s)*u+1,x=1/Math.sqrt(d*d+y*y)*1;let S=-d,k=y;const A=Math.sqrt(S*S+k*k);S/=A,k/=A;const I=[0,S,k];l.bw(I,I,[0,0,0],-this.bearingInRadians),l.bx(I,I,[0,0,0],-1*this.center.lat*Math.PI/180),l.by(I,I,[0,0,0],this.center.lng*Math.PI/180);const D=1/l.aZ(I);return l.aR(I,I,D),[...I,-x*D]}isLocationOccluded(e){return!this.isSurfacePointVisible(ii(e))}transformLightDirection(e){const s=this._helper._center.lng*Math.PI/180,u=this._helper._center.lat*Math.PI/180,d=Math.cos(u),y=[Math.sin(s)*d,Math.sin(u),Math.cos(s)*d],x=[y[2],0,-y[0]],S=[0,0,0];l.aW(S,x,y),l.aV(x,x),l.aV(S,S);const k=[0,0,0];return l.aV(k,[x[0]*e[0]+S[0]*e[1]+y[0]*e[2],x[1]*e[0]+S[1]*e[1]+y[1]*e[2],x[2]*e[0]+S[2]*e[1]+y[2]*e[2]]),k}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,s,u){const d=(function(S,k,A){const I=1/(1<<A.z);return new l.a1(S/l.$*I+A.x*I,k/l.$*I+A.y*I)})(e,s,u.canonical),y=(x=d.y,[l.bo(d.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-x*Math.PI*2))-.5*Math.PI]);var x;return this.getCircleRadiusCorrection()/Math.cos(y[1])}projectTileCoordinates(e,s,u,d){const y=u.canonical,x=bn(e,s,y.x,y.y,y.z),S=1+(d?d(e,s):0)/l.bu,k=[x[0]*S,x[1]*S,x[2]*S,1];l.aw(k,k,this._globeViewProjMatrixNoCorrection);const A=this._cachedClippingPlane,I=A[0]*x[0]+A[1]*x[1]+A[2]*x[2]+A[3]<0;return{point:new l.P(k[0]/k[3],k[1]/k[3]),signedDistanceFromCamera:k[3],isOccluded:I}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=ts(this.worldSize,this.center.lat),s=l.ba(),u=l.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),l.b4(s,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const d=this.centerOffset;s[8]=2*-d.x/this._helper._width,s[9]=2*d.y/this._helper._height,this._projectionMatrix=l.b5(s),this._globeProjMatrixInverted=l.ba(),l.aq(this._globeProjMatrixInverted,s),l.M(s,s,[0,0,-this.cameraToCenterDistance]),l.b6(s,s,this.rollInRadians),l.b7(s,s,-this.pitchInRadians),l.b6(s,s,this.bearingInRadians),l.M(s,s,[0,0,-e]);const y=l.bp();y[0]=e,y[1]=e,y[2]=e,l.b7(u,s,this.center.lat*Math.PI/180),l.bz(u,u,-this.center.lng*Math.PI/180),l.N(u,u,y),this._globeViewProjMatrixNoCorrection=u,l.b7(s,s,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),l.bz(s,s,-this.center.lng*Math.PI/180),l.N(s,s,y),this._globeViewProjMatrix32f=new Float32Array(s),this._globeViewProjMatrixNoCorrectionInverted=l.ba(),l.aq(this._globeViewProjMatrixNoCorrectionInverted,u);const x=l.bp();this._cameraPosition=l.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/e,l.bw(this._cameraPosition,this._cameraPosition,x,-this.rollInRadians),l.bx(this._cameraPosition,this._cameraPosition,x,this.pitchInRadians),l.bw(this._cameraPosition,this._cameraPosition,x,-this.bearingInRadians),l.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),l.bx(this._cameraPosition,this._cameraPosition,x,-this.center.lat*Math.PI/180),l.by(this._cameraPosition,this._cameraPosition,x,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const S=l.b5(this._globeViewProjMatrixNoCorrectionInverted);l.N(S,S,[1,1,-1]),this._cachedFrustum=Nr.fromInvProjectionMatrix(S,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){l.w("calculateFogMatrix is not supported on globe projection.");const s=l.ba();return l.ag(s),s}getVisibleUnwrappedCoordinates(e){return[new l.b2(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&l.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,s){if(!this._globeViewProjMatrixNoCorrection)return 1;const u=ii(e);l.aR(u,u,1+s/l.bu);const d=l.bv();return l.aw(d,[u[0],u[1],u[2],1],this._globeViewProjMatrixNoCorrection),d[2]/d[3]}populateCache(e){}getBounds(){const e=.5*this.width,s=.5*this.height,u=[new l.P(0,0),new l.P(e,0),new l.P(this.width,0),new l.P(this.width,s),new l.P(this.width,this.height),new l.P(e,this.height),new l.P(0,this.height),new l.P(0,s)],d=[];for(const D of u)d.push(this.unprojectScreenPoint(D));let y=0,x=0,S=0,k=0;const A=this.center;for(const D of d){const L=l.bA(A.lng,D.lng),O=l.bA(A.lat,D.lat);L<x&&(x=L),L>y&&(y=L),O<k&&(k=O),O>S&&(S=O)}const I=[A.lng+x,A.lat+k,A.lng+y,A.lat+S];return this.isSurfacePointOnScreen([0,1,0])&&(I[3]=90,I[0]=-180,I[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(I[1]=-90,I[0]=-180,I[2]=180),new Yt(I)}getConstrained(e,s){const u=l.ah(e.lat,-l.ai,l.ai),d=l.ah(+s,this.minZoom+Er(0,u),this.maxZoom);return{center:new l.S(e.lng,u),zoom:d}}calculateCenterFromCameraLngLatAlt(e,s,u,d){return this._helper.calculateCenterFromCameraLngLatAlt(e,s,u,d)}setLocationAtPoint(e,s){const u=ii(this.unprojectScreenPoint(s)),d=ii(e),y=l.bp();l.bB(y);const x=l.bp();l.by(x,u,y,-this.center.lng*Math.PI/180),l.bx(x,x,y,this.center.lat*Math.PI/180);const S=d[0]*d[0]+d[2]*d[2],k=x[0]*x[0];if(S<k)return;const A=Math.sqrt(S-k),I=-A,D=l.bC(d[0],d[2],x[0],A),L=l.bC(d[0],d[2],x[0],I),O=l.bp();l.by(O,d,y,-D);const U=l.bC(O[1],O[2],x[1],x[2]),K=l.bp();l.by(K,d,y,-L);const X=l.bC(K[1],K[2],x[1],x[2]),Y=.5*Math.PI,ee=U>=-Y&&U<=Y,ne=X>=-Y&&X<=Y;let te,oe;if(ee&&ne){const Me=this.center.lng*Math.PI/180,Te=this.center.lat*Math.PI/180;l.bD(D,Me)+l.bD(U,Te)<l.bD(L,Me)+l.bD(X,Te)?(te=D,oe=U):(te=L,oe=X)}else if(ee)te=D,oe=U;else{if(!ne)return;te=L,oe=X}const ce=te/Math.PI*180,re=oe/Math.PI*180,_e=this.center.lat;this.setCenter(new l.S(ce,l.ah(re,-90,90))),this.setZoom(this.zoom+Er(_e,this.center.lat))}locationToScreenPoint(e,s){const u=ii(e);if(s){const d=s.getElevationForLngLatZoom(e,this._helper._tileZoom);l.aR(u,u,1+d/l.bu)}return this._projectSurfacePointToScreen(u)}_projectSurfacePointToScreen(e){const s=l.bv();return l.aw(s,[...e,1],this._globeViewProjMatrixNoCorrection),s[0]/=s[3],s[1]/=s[3],new l.P((.5*s[0]+.5)*this.width,(.5*-s[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,s){if(s){const u=s.pointCoordinate(e);if(u)return u}return l.a1.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,s){var u;return(u=this.screenPointToMercatorCoordinate(e,s))===null||u===void 0?void 0:u.toLngLat()}isPointOnMapSurface(e,s){const u=this._cameraPosition,d=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(u,d)}getRayDirectionFromPixel(e){const s=l.bv();s[0]=e.x/this.width*2-1,s[1]=-1*(e.y/this.height*2-1),s[2]=1,s[3]=1,l.aw(s,s,this._globeViewProjMatrixNoCorrectionInverted),s[0]/=s[3],s[1]/=s[3],s[2]/=s[3];const u=l.bp();u[0]=s[0]-this._cameraPosition[0],u[1]=s[1]-this._cameraPosition[1],u[2]=s[2]-this._cameraPosition[2];const d=l.bp();return l.aV(d,u),d}isSurfacePointVisible(e){const s=this._cachedClippingPlane;return s[0]*e[0]+s[1]*e[1]+s[2]*e[2]+s[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const s=l.bv();return l.aw(s,[...e,1],this._globeViewProjMatrixNoCorrection),s[0]/=s[3],s[1]/=s[3],s[2]/=s[3],s[0]>-1&&s[0]<1&&s[1]>-1&&s[1]<1&&s[2]>-1&&s[2]<1}rayPlanetIntersection(e,s){const u=l.aX(e,s),d=l.bp(),y=l.bp();l.aR(y,s,u),l.aU(d,e,y);const x=1-l.aX(d,d);if(x<0)return null;const S=l.aX(e,e)-1,k=-u+(u<0?1:-1)*Math.sqrt(x),A=S/k,I=k;return{tMin:Math.min(A,I),tMax:Math.max(A,I)}}unprojectScreenPoint(e){const s=this._cameraPosition,u=this.getRayDirectionFromPixel(e),d=this.rayPlanetIntersection(s,u);if(d){const I=l.bp();l.aS(I,s,[u[0]*d.tMin,u[1]*d.tMin,u[2]*d.tMin]);const D=l.bp();return l.aV(D,I),Os(D)}const y=this._cachedClippingPlane,x=y[0]*u[0]+y[1]*u[1]+y[2]*u[2],S=-l.b1(y,s)/x,k=l.bp();if(S>0)l.aS(k,s,[u[0]*S,u[1]*S,u[2]*S]);else{const I=l.bp();l.aS(I,s,[2*u[0],2*u[1],2*u[2]]);const D=l.b1(this._cachedClippingPlane,I);l.aU(k,I,[this._cachedClippingPlane[0]*D,this._cachedClippingPlane[1]*D,this._cachedClippingPlane[2]*D])}const A=(function(I){const D=l.bp();return D[0]=I[0]*-I[3],D[1]=I[1]*-I[3],D[2]=I[2]*-I[3],{center:D,radius:Math.sqrt(1-I[3]*I[3])}})(y);return Os((function(I,D,L){const O=l.bp();l.aU(O,L,I);const U=l.bp();return l.bq(U,I,O,D/l.a$(O)),U})(A.center,A.radius,k))}getMatrixForModel(e,s){const u=l.S.convert(e),d=1/l.bu,y=l.b9();return l.bz(y,y,u.lng/180*Math.PI),l.b7(y,y,-u.lat/180*Math.PI),l.M(y,y,[0,0,1+s/l.bu]),l.b7(y,y,.5*Math.PI),l.N(y,y,[d,d,d]),y}getProjectionDataForCustomLayer(e=!0){const s=this.getProjectionData({overscaledTileID:new l.Z(0,0,0,0,0),applyGlobeMatrix:e});return s.tileMercatorCoords=[0,0,1,1],s}getFastPathSimpleProjectionMatrix(e){}}class Vs{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,s,u){return this._helper.interpolatePadding(e,s,u)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,s,u=!0){this._helper.resize(e,s,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,s){this._helper.overrideNearFarZ(e,s)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,s){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=s,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Ei({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,s)=>this.getConstrained(e,s)}),this._globeness=1,this._mercatorTransform=new hr,this._verticalPerspectiveTransform=new Us}clone(){const e=new Vs;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const s=this._mercatorTransform.getProjectionData(e),u=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?u.mainMatrix:s.mainMatrix,clippingPlane:u.clippingPlane,tileMercatorCoords:u.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:s.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return l.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return l.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,s,u){const d=this._mercatorTransform.getPitchedTextCorrection(e,s,u),y=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,s,u);return l.bk(d,y,this._globeness)}projectTileCoordinates(e,s,u,d){return this.currentTransform.projectTileCoordinates(e,s,u,d)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,s){return this.currentTransform.lngLatToCameraDepth(e,s)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,s){return this.currentTransform.getConstrained(e,s)}calculateCenterFromCameraLngLatAlt(e,s,u,d){return this._helper.calculateCenterFromCameraLngLatAlt(e,s,u,d)}setLocationAtPoint(e,s){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,s),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,s),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,s){return this.currentTransform.locationToScreenPoint(e,s)}screenPointToMercatorCoordinate(e,s){return this.currentTransform.screenPointToMercatorCoordinate(e,s)}screenPointToLocation(e,s){return this.currentTransform.screenPointToLocation(e,s)}isPointOnMapSurface(e,s){return this.currentTransform.isPointOnMapSurface(e,s)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,s){return this.currentTransform.getMatrixForModel(e,s)}getProjectionDataForCustomLayer(e=!0){const s=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return s;const u=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return u.fallbackMatrix=s.mainMatrix,u}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class Si{get useGlobeControls(){return!0}handlePanInertia(e,s){const u=Bp(e,s);return Math.abs(u.lng-s.center.lng)>180&&(u.lng=s.center.lng+179.5*Math.sign(u.lng-s.center.lng)),{easingCenter:u,easingOffset:new l.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,s){const u=e.around,d=s.screenPointToLocation(u);e.bearingDelta&&s.setBearing(s.bearing+e.bearingDelta),e.pitchDelta&&s.setPitch(s.pitch+e.pitchDelta),e.rollDelta&&s.setRoll(s.roll+e.rollDelta);const y=s.zoom;e.zoomDelta&&s.setZoom(s.zoom+e.zoomDelta);const x=s.zoom-y;if(x===0)return;const S=l.bA(s.center.lng,d.lng),k=S/(Math.abs(S/180)+1),A=l.bA(s.center.lat,d.lat),I=s.getRayDirectionFromPixel(u),D=s.cameraPosition,L=-1*l.aX(D,I),O=l.bp();l.aS(O,D,[I[0]*L,I[1]*L,I[2]*L]);const U=l.aZ(O)-1,K=Math.exp(.5*-Math.max(U-.3,0)),X=ts(s.worldSize,s.center.lat)/Math.min(s.width,s.height),Y=l.bn(X,.9,.5,1,.25),ee=(1-l.af(-x))*Math.min(K,Y),ne=s.center.lat,te=s.zoom,oe=new l.S(s.center.lng+k*ee,l.ah(s.center.lat+A*ee,-l.ai,l.ai));s.setLocationAtPoint(d,u);const ce=s.center,re=l.bn(Math.abs(S),45,85,0,1),_e=l.bn(X,.75,.35,0,1),Me=Math.pow(Math.max(re,_e),.25),Te=l.bA(ce.lng,oe.lng),Se=l.bA(ce.lat,oe.lat);s.setCenter(new l.S(ce.lng+Te*Me,ce.lat+Se*Me).wrap()),s.setZoom(te+Er(ne,s.center.lat))}handleMapControlsPan(e,s,u){if(!e.panDelta)return;const d=s.center.lat,y=s.zoom;s.setCenter(Bp(e.panDelta,s).wrap()),s.setZoom(y+Er(d,s.center.lat))}cameraForBoxAndBearing(e,s,u,d,y){const x=Qi(e,s,u,d,y),S=s.left/y.width*2-1,k=(y.width-s.right)/y.width*2-1,A=s.top/y.height*-2+1,I=(y.height-s.bottom)/y.height*-2+1,D=l.bA(u.getWest(),u.getEast())<0,L=D?u.getEast():u.getWest(),O=D?u.getWest():u.getEast(),U=Math.max(u.getNorth(),u.getSouth()),K=Math.min(u.getNorth(),u.getSouth()),X=L+.5*l.bA(L,O),Y=U+.5*l.bA(U,K),ee=y.clone();ee.setCenter(x.center),ee.setBearing(x.bearing),ee.setPitch(0),ee.setRoll(0),ee.setZoom(x.zoom);const ne=ee.modelViewProjectionMatrix,te=[ii(u.getNorthWest()),ii(u.getNorthEast()),ii(u.getSouthWest()),ii(u.getSouthEast()),ii(new l.S(O,Y)),ii(new l.S(L,Y)),ii(new l.S(X,U)),ii(new l.S(X,K))],oe=ii(x.center);let ce=Number.POSITIVE_INFINITY;for(const re of te)S<0&&(ce=Si.getLesserNonNegativeNonNull(ce,Si.solveVectorScale(re,oe,ne,"x",S))),k>0&&(ce=Si.getLesserNonNegativeNonNull(ce,Si.solveVectorScale(re,oe,ne,"x",k))),A>0&&(ce=Si.getLesserNonNegativeNonNull(ce,Si.solveVectorScale(re,oe,ne,"y",A))),I<0&&(ce=Si.getLesserNonNegativeNonNull(ce,Si.solveVectorScale(re,oe,ne,"y",I)));if(Number.isFinite(ce)&&ce!==0)return x.zoom=ee.zoom+l.ak(ce),x;Op()}handleJumpToCenterZoom(e,s){const u=e.center.lat,d=e.getConstrained(s.center?l.S.convert(s.center):e.center,e.zoom).center;e.setCenter(d.wrap());const y=s.zoom!==void 0?+s.zoom:e.zoom+Er(u,d.lat);e.zoom!==y&&e.setZoom(y)}handleEaseTo(e,s){const u=e.zoom,d=e.center,y=e.padding,x={roll:e.roll,pitch:e.pitch,bearing:e.bearing},S={roll:s.roll===void 0?e.roll:s.roll,pitch:s.pitch===void 0?e.pitch:s.pitch,bearing:s.bearing===void 0?e.bearing:s.bearing},k=s.zoom!==void 0,A=!e.isPaddingEqual(s.padding);let I=!1;const D=s.center?l.S.convert(s.center):d,L=e.getConstrained(D,u).center;Kl(e,L);const O=e.clone();O.setCenter(L),O.setZoom(k?+s.zoom:u+Er(d.lat,D.lat)),O.setBearing(s.bearing);const U=new l.P(l.ah(e.centerPoint.x+s.offsetAsPoint.x,0,e.width),l.ah(e.centerPoint.y+s.offsetAsPoint.y,0,e.height));O.setLocationAtPoint(L,U);const K=(s.offset&&s.offsetAsPoint.mag())>0?O.center:L,X=k?+s.zoom:u+Er(d.lat,K.lat),Y=u+Er(d.lat,0),ee=X+Er(K.lat,0),ne=l.bA(d.lng,K.lng),te=l.bA(d.lat,K.lat),oe=l.af(ee-Y);return I=X!==u,{easeFunc:ce=>{if(l.be(x,S)||zi({startEulerAngles:x,endEulerAngles:S,tr:e,k:ce,useSlerp:x.roll!=S.roll}),A&&e.interpolatePadding(y,s.padding,ce),s.around)l.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(s.around,s.aroundPoint);else{const re=ee>Y?Math.min(2,oe):Math.max(.5,oe),_e=Math.pow(re,1-ce),Me=Bu(d,ne,te,ce*_e);e.setCenter(Me.wrap())}if(I){const re=l.C.number(Y,ee,ce)+Er(0,e.center.lat);e.setZoom(re)}},isZooming:I,elevationCenter:K}}handleFlyTo(e,s){const u=s.zoom!==void 0,d=e.center,y=e.zoom,x=e.padding,S=!e.isPaddingEqual(s.padding),k=e.getConstrained(l.S.convert(s.center||s.locationAtOffset),y).center,A=u?+s.zoom:e.zoom+Er(e.center.lat,k.lat),I=e.clone();I.setCenter(k),I.setZoom(A),I.setBearing(s.bearing);const D=new l.P(l.ah(e.centerPoint.x+s.offsetAsPoint.x,0,e.width),l.ah(e.centerPoint.y+s.offsetAsPoint.y,0,e.height));I.setLocationAtPoint(k,D);const L=I.center;Kl(e,L);const O=(function(te,oe,ce){const re=ii(oe),_e=ii(ce),Me=l.aX(re,_e),Te=Math.acos(Me),Se=tc(te);return Te/(2*Math.PI)*Se})(e,d,L),U=y+Er(d.lat,0),K=A+Er(L.lat,0),X=l.af(K-U);let Y;if(typeof s.minZoom=="number"){const te=+s.minZoom+Er(L.lat,0),oe=Math.min(te,U,K)+Er(0,L.lat),ce=e.getConstrained(L,oe).zoom+Er(L.lat,0);Y=l.af(ce-U)}const ee=l.bA(d.lng,L.lng),ne=l.bA(d.lat,L.lat);return{easeFunc:(te,oe,ce,re)=>{const _e=Bu(d,ee,ne,ce);S&&e.interpolatePadding(x,s.padding,te);const Me=te===1?L:_e;e.setCenter(Me.wrap());const Te=U+l.ak(oe);e.setZoom(te===1?A:Te+Er(0,Me.lat))},scaleOfZoom:X,targetCenter:L,scaleOfMinZoom:Y,pixelPathLength:O}}static solveVectorScale(e,s,u,d,y){const x=d==="x"?[u[0],u[4],u[8],u[12]]:[u[1],u[5],u[9],u[13]],S=[u[3],u[7],u[11],u[15]],k=e[0]*x[0]+e[1]*x[1]+e[2]*x[2],A=e[0]*S[0]+e[1]*S[1]+e[2]*S[2],I=s[0]*x[0]+s[1]*x[1]+s[2]*x[2],D=s[0]*S[0]+s[1]*S[1]+s[2]*S[2];return I+y*A===k+y*D||S[3]*(k-I)+x[3]*(D-A)+k*D==I*A?null:(I+x[3]-y*D-y*S[3])/(I-k-y*D+y*A)}static getLesserNonNegativeNonNull(e,s){return s!==null&&s>=0&&s<e?s:e}}class $p{constructor(e){this._globe=e,this._mercatorCameraHelper=new Ti,this._verticalPerspectiveCameraHelper=new Si}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,s){return this.currentHelper.handlePanInertia(e,s)}handleMapControlsRollPitchBearingZoom(e,s){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,s)}handleMapControlsPan(e,s,u){this.currentHelper.handleMapControlsPan(e,s,u)}cameraForBoxAndBearing(e,s,u,d,y){return this.currentHelper.cameraForBoxAndBearing(e,s,u,d,y)}handleJumpToCenterZoom(e,s){this.currentHelper.handleJumpToCenterZoom(e,s)}handleEaseTo(e,s){return this.currentHelper.handleEaseTo(e,s)}handleFlyTo(e,s){return this.currentHelper.handleFlyTo(e,s)}}const rc=(g,e)=>l.y(g,e&&e.filter((s=>s.identifier!=="source.canvas"))),mm=l.bE();class $u extends l.E{constructor(e,s={}){super(),this._rtlPluginLoaded=()=>{for(const u in this.sourceCaches){const d=this.sourceCaches[u].getSource().type;d!=="vector"&&d!=="geojson"||this.sourceCaches[u].reload()}},this.map=e,this.dispatcher=new Et(Kt(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",((u,d)=>this.getGlyphs(u,d))),this.dispatcher.registerMessageHandler("GI",((u,d)=>this.getImages(u,d))),this.imageManager=new rt,this.imageManager.setEventedParent(this),this.glyphManager=new er(e._requestManager,s.localIdeographFontFamily),this.lineAtlas=new At(256,512),this.crossTileSymbolIndex=new Qo,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",l.bG()),Fa().on(lo,this._rtlPluginLoaded),this.on("data",(u=>{if(u.dataType!=="source"||u.sourceDataType!=="metadata")return;const d=this.sourceCaches[u.sourceId];if(!d)return;const y=d.getSource();if(y&&y.vectorLayerIds)for(const x in this._layers){const S=this._layers[x];S.source===y.id&&this._validateLayer(S)}}))}setGlobalStateProperty(e,s){var u,d,y;this._checkLoaded();const x=s===null?(y=(d=(u=this.stylesheet.state)===null||u===void 0?void 0:u[e])===null||d===void 0?void 0:d.default)!==null&&y!==void 0?y:null:s;if(l.bH(x,this._globalState[e]))return this;this._globalState[e]=x;const S=this._findGlobalStateAffectedSources([e]);for(const k in this.sourceCaches)S.has(k)&&(this._reloadSource(k),this._changed=!0)}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();const s=[];for(const d in e)!l.bH(this._globalState[d],e[d].default)&&(s.push(d),this._globalState[d]=e[d].default);const u=this._findGlobalStateAffectedSources(s);for(const d in this.sourceCaches)u.has(d)&&(this._reloadSource(d),this._changed=!0)}_findGlobalStateAffectedSources(e){if(e.length===0)return new Set;const s=new Set;for(const u in this._layers){const d=this._layers[u],y=d.getLayoutAffectingGlobalStateRefs();for(const x of e)y.has(x)&&s.add(d.source)}return s}loadURL(e,s={},u){this.fire(new l.l("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const d=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const y=this._loadStyleRequest;l.j(d,this._loadStyleRequest).then((x=>{this._loadStyleRequest=null,this._load(x.data,s,u)})).catch((x=>{this._loadStyleRequest=null,x&&!y.signal.aborted&&this.fire(new l.k(x))}))}loadJSON(e,s={},u){this.fire(new l.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,G.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,s.validate=s.validate!==!1,this._load(e,s,u)})).catch((()=>{}))}loadEmpty(){this.fire(new l.l("dataloading",{dataType:"style"})),this._load(mm,{validate:!1})}_load(e,s,u){var d,y,x;const S=s.transformStyle?s.transformStyle(u,e):e;if(!s.validate||!rc(this,l.z(S))){this._loaded=!0,this.stylesheet=S;for(const k in S.sources)this.addSource(k,S.sources[k],{validate:!1});S.sprite?this._loadSprite(S.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(S.glyphs),this._createLayers(),this.light=new hi(this.stylesheet.light),this._setProjectionInternal(((d=this.stylesheet.projection)===null||d===void 0?void 0:d.type)||"mercator"),this.sky=new fr(this.stylesheet.sky),this.map.setTerrain((y=this.stylesheet.terrain)!==null&&y!==void 0?y:null),this.setGlobalState((x=this.stylesheet.state)!==null&&x!==void 0?x:null),this.fire(new l.l("data",{dataType:"style"})),this.fire(new l.l("style.load"))}}_createLayers(){const e=l.bI(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map((s=>s.id)),this._layers={},this._serializedLayers=null;for(const s of e){const u=l.bJ(s);u.setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=u}}_loadSprite(e,s=!1,u=void 0){let d;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(y,x,S,k){return l._(this,void 0,void 0,(function*(){const A=Ae(y),I=S>1?"@2x":"",D={},L={};for(const{id:O,url:U}of A){const K=x.transformRequest(Fe(U,I,".json"),"SpriteJSON");D[O]=l.j(K,k);const X=x.transformRequest(Fe(U,I,".png"),"SpriteImage");L[O]=he.getImage(X,k)}return yield Promise.all([...Object.values(D),...Object.values(L)]),(function(O,U){return l._(this,void 0,void 0,(function*(){const K={};for(const X in O){K[X]={};const Y=G.getImageCanvasContext((yield U[X]).data),ee=(yield O[X]).data;for(const ne in ee){const{width:te,height:oe,x:ce,y:re,sdf:_e,pixelRatio:Me,stretchX:Te,stretchY:Se,content:Pe,textFitWidth:Oe,textFitHeight:Ne}=ee[ne];K[X][ne]={data:null,pixelRatio:Me,sdf:_e,stretchX:Te,stretchY:Se,content:Pe,textFitWidth:Oe,textFitHeight:Ne,spriteData:{width:te,height:oe,x:ce,y:re,context:Y}}}}return K}))})(D,L)}))})(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((y=>{if(this._spriteRequest=null,y)for(const x in y){this._spritesImagesIds[x]=[];const S=this._spritesImagesIds[x]?this._spritesImagesIds[x].filter((k=>!(k in y))):[];for(const k of S)this.imageManager.removeImage(k),this._changedImages[k]=!0;for(const k in y[x]){const A=x==="default"?k:`${x}:${k}`;this._spritesImagesIds[x].push(A),A in this.imageManager.images?this.imageManager.updateImage(A,y[x][k],!1):this.imageManager.addImage(A,y[x][k]),s&&(this._changedImages[A]=!0)}}})).catch((y=>{this._spriteRequest=null,d=y,this.fire(new l.k(d))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"})),u&&u(d)}))}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}_validateLayer(e){const s=this.sourceCaches[e.source];if(!s)return;const u=e.sourceLayer;if(!u)return;const d=s.getSource();(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(u)===-1)&&this.fire(new l.k(new Error(`Source layer "${u}" does not exist on source "${d.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,s=!1){const u=this._serializedAllLayers();if(!e||e.length===0)return Object.values(s?l.bK(u):u);const d=[];for(const y of e)if(u[y]){const x=s?l.bK(u[y]):u[y];d.push(x)}return d}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const s=Object.keys(this._layers);for(const u of s){const d=this._layers[u];d.type!=="custom"&&(e[u]=d.serialize())}return e}hasTransitions(){var e,s,u;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((s=this.sky)===null||s===void 0)&&s.hasTransition()||!((u=this.projection)===null||u===void 0)&&u.hasTransition())return!0;for(const d in this.sourceCaches)if(this.sourceCaches[d].hasTransition())return!0;for(const d in this._layers)if(this._layers[d].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const s=this._changed;if(s){const d=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(d.length||y.length)&&this._updateWorkerLayers(d,y);for(const x in this._updatedSources){const S=this._updatedSources[x];if(S==="reload")this._reloadSource(x);else{if(S!=="clear")throw new Error(`Invalid action ${S}`);this._clearSource(x)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const x in this._updatedPaintProps)this._layers[x].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const u={};for(const d in this.sourceCaches){const y=this.sourceCaches[d];u[d]=y.used,y.used=!1}for(const d of this._order){const y=this._layers[d];y.recalculate(e,this._availableImages),!y.isHidden(e.zoom)&&y.source&&(this.sourceCaches[y.source].used=!0)}for(const d in u){const y=this.sourceCaches[d];!!u[d]!=!!y.used&&y.fire(new l.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:d}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,s&&this.fire(new l.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,s){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,s={}){var u;this._checkLoaded();const d=this.serialize();if(e=s.transformStyle?s.transformStyle(d,e):e,((u=s.validate)===null||u===void 0||u)&&rc(this,l.z(e)))return!1;(e=l.bK(e)).layers=l.bI(e.layers);const y=l.bL(d,e),x=this._getOperationsToPerform(y);if(x.unimplemented.length>0)throw new Error(`Unimplemented: ${x.unimplemented.join(", ")}.`);if(x.operations.length===0)return!1;for(const S of x.operations)S();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const s=[],u=[];for(const d of e)switch(d.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":s.push((()=>this.addLayer.apply(this,d.args)));break;case"removeLayer":s.push((()=>this.removeLayer.apply(this,d.args)));break;case"setPaintProperty":s.push((()=>this.setPaintProperty.apply(this,d.args)));break;case"setLayoutProperty":s.push((()=>this.setLayoutProperty.apply(this,d.args)));break;case"setFilter":s.push((()=>this.setFilter.apply(this,d.args)));break;case"addSource":s.push((()=>this.addSource.apply(this,d.args)));break;case"removeSource":s.push((()=>this.removeSource.apply(this,d.args)));break;case"setLayerZoomRange":s.push((()=>this.setLayerZoomRange.apply(this,d.args)));break;case"setLight":s.push((()=>this.setLight.apply(this,d.args)));break;case"setGeoJSONSourceData":s.push((()=>this.setGeoJSONSourceData.apply(this,d.args)));break;case"setGlyphs":s.push((()=>this.setGlyphs.apply(this,d.args)));break;case"setSprite":s.push((()=>this.setSprite.apply(this,d.args)));break;case"setTerrain":s.push((()=>this.map.setTerrain.apply(this,d.args)));break;case"setSky":s.push((()=>this.setSky.apply(this,d.args)));break;case"setProjection":this.setProjection.apply(this,d.args);break;case"setGlobalState":s.push((()=>this.setGlobalState.apply(this,d.args)));break;case"setTransition":s.push((()=>{}));break;default:u.push(d.command)}return{operations:s,unimplemented:u}}addImage(e,s){if(this.getImage(e))return this.fire(new l.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,s),this._afterImageUpdated(e)}updateImage(e,s){this.imageManager.updateImage(e,s)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new l.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,s,u={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(l.z.source,`sources.${e}`,s,null,u))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const d=this.sourceCaches[e]=new zt(e,s,this.dispatcher);d.style=this,d.setEventedParent(this,(()=>({isSourceLoaded:d.loaded(),source:d.serialize(),sourceId:e}))),d.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const u in this._layers)if(this._layers[u].source===e)return this.fire(new l.k(new Error(`Source "${e}" cannot be removed while layer "${u}" is using it.`)));const s=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],s.fire(new l.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,s){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const u=this.sourceCaches[e].getSource();if(u.type!=="geojson")throw new Error(`geojsonSource.type is ${u.type}, which is !== 'geojson`);u.setData(s),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,s,u={}){this._checkLoaded();const d=e.id;if(this.getLayer(d))return void this.fire(new l.k(new Error(`Layer "${d}" already exists on this map.`)));let y;if(e.type==="custom"){if(rc(this,l.bM(e)))return;y=l.bJ(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(d,e.source),e=l.bK(e),e=l.e(e,{source:d})),this._validate(l.z.layer,`layers.${d}`,e,{arrayIndex:-1},u))return;y=l.bJ(e),this._validateLayer(y),y.setEventedParent(this,{layer:{id:d}})}const x=s?this._order.indexOf(s):this._order.length;if(s&&x===-1)this.fire(new l.k(new Error(`Cannot add layer "${d}" before non-existing layer "${s}".`)));else{if(this._order.splice(x,0,d),this._layerOrderChanged=!0,this._layers[d]=y,this._removedLayers[d]&&y.source&&y.type!=="custom"){const S=this._removedLayers[d];delete this._removedLayers[d],S.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",this.sourceCaches[y.source].pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map)}}moveLayer(e,s){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new l.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===s)return;const u=this._order.indexOf(e);this._order.splice(u,1);const d=s?this._order.indexOf(s):this._order.length;s&&d===-1?this.fire(new l.k(new Error(`Cannot move layer "${e}" before non-existing layer "${s}".`))):(this._order.splice(d,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const s=this._layers[e];if(!s)return void this.fire(new l.k(new Error(`Cannot remove non-existing layer "${e}".`)));s.setEventedParent(null);const u=this._order.indexOf(e);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=s,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],s.onRemove&&s.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,s,u){this._checkLoaded();const d=this.getLayer(e);d?d.minzoom===s&&d.maxzoom===u||(s!=null&&(d.minzoom=s),u!=null&&(d.maxzoom=u),this._updateLayer(d)):this.fire(new l.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,s,u={}){this._checkLoaded();const d=this.getLayer(e);if(d){if(!l.bH(d.filter,s))return s==null?(d.setFilter(void 0),void this._updateLayer(d)):void(this._validate(l.z.filter,`layers.${d.id}.filter`,s,null,u)||(d.setFilter(l.bK(s)),this._updateLayer(d)))}else this.fire(new l.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return l.bK(this.getLayer(e).filter)}setLayoutProperty(e,s,u,d={}){this._checkLoaded();const y=this.getLayer(e);y?l.bH(y.getLayoutProperty(s),u)||(y.setLayoutProperty(s,u,d),this._updateLayer(y)):this.fire(new l.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,s){const u=this.getLayer(e);if(u)return u.getLayoutProperty(s);this.fire(new l.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,s,u,d={}){this._checkLoaded();const y=this.getLayer(e);y?l.bH(y.getPaintProperty(s),u)||(y.setPaintProperty(s,u,d)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new l.k(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,s){return this.getLayer(e).getPaintProperty(s)}setFeatureState(e,s){this._checkLoaded();const u=e.source,d=e.sourceLayer,y=this.sourceCaches[u];if(y===void 0)return void this.fire(new l.k(new Error(`The source '${u}' does not exist in the map's style.`)));const x=y.getSource().type;x==="geojson"&&d?this.fire(new l.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):x!=="vector"||d?(e.id===void 0&&this.fire(new l.k(new Error("The feature id parameter must be provided."))),y.setFeatureState(d,e.id,s)):this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,s){this._checkLoaded();const u=e.source,d=this.sourceCaches[u];if(d===void 0)return void this.fire(new l.k(new Error(`The source '${u}' does not exist in the map's style.`)));const y=d.getSource().type,x=y==="vector"?e.sourceLayer:void 0;y!=="vector"||x?s&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new l.k(new Error("A feature id is required to remove its specific state property."))):d.removeFeatureState(x,e.id,s):this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const s=e.source,u=e.sourceLayer,d=this.sourceCaches[s];if(d!==void 0)return d.getSource().type!=="vector"||u?(e.id===void 0&&this.fire(new l.k(new Error("The feature id parameter must be provided."))),d.getFeatureState(u,e.id)):void this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.k(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=l.bN(this.sourceCaches,(y=>y.serialize())),s=this._serializeByIds(this._order,!0),u=this.map.getTerrain()||void 0,d=this.stylesheet;return l.bO({version:d.version,name:d.name,metadata:d.metadata,light:d.light,sky:d.sky,center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch,sprite:d.sprite,glyphs:d.glyphs,transition:d.transition,projection:d.projection,sources:e,layers:s,terrain:u},(y=>y!==void 0))}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const s=x=>this._layers[x].type==="fill-extrusion",u={},d=[];for(let x=this._order.length-1;x>=0;x--){const S=this._order[x];if(s(S)){u[S]=x;for(const k of e){const A=k[S];if(A)for(const I of A)d.push(I)}}}d.sort(((x,S)=>S.intersectionZ-x.intersectionZ));const y=[];for(let x=this._order.length-1;x>=0;x--){const S=this._order[x];if(s(S))for(let k=d.length-1;k>=0;k--){const A=d[k].feature;if(u[A.layer.id]<x)break;y.push(A),d.pop()}else for(const k of e){const A=k[S];if(A)for(const I of A)y.push(I.feature)}}return y}queryRenderedFeatures(e,s,u){s&&s.filter&&this._validate(l.z.filter,"queryRenderedFeatures.filter",s.filter,null,s);const d={};if(s&&s.layers){if(!(Array.isArray(s.layers)||s.layers instanceof Set))return this.fire(new l.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const A of s.layers){const I=this._layers[A];if(!I)return this.fire(new l.k(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];d[I.source]=!0}}const y=[];s.availableImages=this._availableImages;const x=this._serializedAllLayers(),S=s.layers instanceof Set?s.layers:Array.isArray(s.layers)?new Set(s.layers):null,k=Object.assign(Object.assign({},s),{layers:S});for(const A in this.sourceCaches)s.layers&&!d[A]||y.push(Mr(this.sourceCaches[A],this._layers,x,e,k,u,this.map.terrain?(I,D,L)=>this.map.terrain.getElevation(I,D,L):void 0));return this.placement&&y.push((function(A,I,D,L,O,U,K){const X={},Y=U.queryRenderedSymbols(L),ee=[];for(const ne of Object.keys(Y).map(Number))ee.push(K[ne]);ee.sort(xi);for(const ne of ee){const te=ne.featureIndex.lookupSymbolFeatures(Y[ne.bucketInstanceId],I,ne.bucketIndex,ne.sourceLayerIndex,O.filter,O.layers,O.availableImages,A);for(const oe in te){const ce=X[oe]=X[oe]||[],re=te[oe];re.sort(((_e,Me)=>{const Te=ne.featureSortOrder;if(Te){const Se=Te.indexOf(_e.featureIndex);return Te.indexOf(Me.featureIndex)-Se}return Me.featureIndex-_e.featureIndex}));for(const _e of re)ce.push(_e)}}return(function(ne,te,oe){for(const ce in ne)for(const re of ne[ce])Tr(re,oe[te[ce].source]);return ne})(X,A,D)})(this._layers,x,this.sourceCaches,e,k,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(e,s){s&&s.filter&&this._validate(l.z.filter,"querySourceFeatures.filter",s.filter,null,s);const u=this.sourceCaches[e];return u?(function(d,y){const x=d.getRenderableIds().map((A=>d.getTileByID(A))),S=[],k={};for(let A=0;A<x.length;A++){const I=x[A],D=I.tileID.canonical.key;k[D]||(k[D]=!0,I.querySourceFeatures(S,y))}return S})(u,s):[]}getLight(){return this.light.getLight()}setLight(e,s={}){this._checkLoaded();const u=this.light.getLight();let d=!1;for(const x in e)if(!l.bH(e[x],u[x])){d=!0;break}if(!d)return;const y={now:G.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,s),this.light.updateTransitions(y)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,s={}){this._checkLoaded();const u=this.getSky();let d=!1;if(!e&&!u)return;if(e&&!u)d=!0;else if(!e&&u)d=!0;else for(const x in e)if(!l.bH(e[x],u[x])){d=!0;break}if(!d)return;const y={now:G.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,s),this.sky.updateTransitions(y)}_setProjectionInternal(e){const s=(function(u){if(Array.isArray(u)){const d=new ec({type:u});return{projection:d,transform:new Vs,cameraHelper:new $p(d)}}switch(u){case"mercator":return{projection:new Dt,transform:new hr,cameraHelper:new Ti};case"globe":{const d=new ec({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:d,transform:new Vs,cameraHelper:new $p(d)}}case"vertical-perspective":return{projection:new js,transform:new Us,cameraHelper:new Si};default:return l.w(`Unknown projection name: ${u}. Falling back to mercator projection.`),{projection:new Dt,transform:new hr,cameraHelper:new Ti}}})(e);this.projection=s.projection,this.map.migrateProjection(s.transform,s.cameraHelper);for(const u in this.sourceCaches)this.sourceCaches[u].reload()}_validate(e,s,u,d,y={}){return(!y||y.validate!==!1)&&rc(this,e.call(l.z,l.e({key:s,style:this.serialize(),value:u,styleSpec:l.v},d)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Fa().off(lo,this._rtlPluginLoaded);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const u=this.sourceCaches[s];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const s in this.sourceCaches)this.sourceCaches[s].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,s,u,d,y=!1){let x=!1,S=!1;const k={};for(const A of this._order){const I=this._layers[A];if(I.type!=="symbol")continue;if(!k[I.source]){const L=this.sourceCaches[I.source];k[I.source]=L.getRenderableIds(!0).map((O=>L.getTileByID(O))).sort(((O,U)=>U.tileID.overscaledZ-O.tileID.overscaledZ||(O.tileID.isLessThan(U.tileID)?-1:1)))}const D=this.crossTileSymbolIndex.addLayer(I,k[I.source],e.center.lng);x=x||D}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((y=y||this._layerOrderChanged||u===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(G.now(),e.zoom))&&(this.pauseablePlacement=new Du(e,this.map.terrain,this._order,y,s,u,d,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(G.now()),S=!0),x&&this.pauseablePlacement.placement.setStale()),S||x)for(const A of this._order){const I=this._layers[A];I.type==="symbol"&&this.placement.updateLayerOpacities(I,k[I.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(G.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,s){return l._(this,void 0,void 0,(function*(){const u=yield this.imageManager.getImages(s.icons);this._updateTilesForChangedImages();const d=this.sourceCaches[s.source];return d&&d.setDependencies(s.tileID.key,s.type,s.icons),u}))}getGlyphs(e,s){return l._(this,void 0,void 0,(function*(){const u=yield this.glyphManager.getGlyphs(s.stacks),d=this.sourceCaches[s.source];return d&&d.setDependencies(s.tileID.key,s.type,[""]),u}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,s={}){this._checkLoaded(),e&&this._validate(l.z.glyphs,"glyphs",e,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,s,u={},d){this._checkLoaded();const y=[{id:e,url:s}],x=[...Ae(this.stylesheet.sprite),...y];this._validate(l.z.sprite,"sprite",x,null,u)||(this.stylesheet.sprite=x,this._loadSprite(y,!0,d))}removeSprite(e){this._checkLoaded();const s=Ae(this.stylesheet.sprite);if(s.find((u=>u.id===e))){if(this._spritesImagesIds[e])for(const u of this._spritesImagesIds[e])this.imageManager.removeImage(u),this._changedImages[u]=!0;s.splice(s.findIndex((u=>u.id===e)),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}else this.fire(new l.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Ae(this.stylesheet.sprite)}setSprite(e,s={},u){this._checkLoaded(),e&&this._validate(l.z.sprite,"sprite",e,null,s)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,u):(this._unloadSprite(),u&&u(null)))}}var gm=l.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ym{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,s,u,d,y,x,S,k,A){this.context=e;let I=this.boundPaintVertexBuffers.length!==d.length;for(let D=0;!I&&D<d.length;D++)this.boundPaintVertexBuffers[D]!==d[D]&&(I=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==u||I||this.boundIndexBuffer!==y||this.boundVertexOffset!==x||this.boundDynamicVertexBuffer!==S||this.boundDynamicVertexBuffer2!==k||this.boundDynamicVertexBuffer3!==A?this.freshBind(s,u,d,y,x,S,k,A):(e.bindVertexArray.set(this.vao),S&&S.bind(),y&&y.dynamicDraw&&y.bind(),k&&k.bind(),A&&A.bind())}freshBind(e,s,u,d,y,x,S,k){const A=e.numAttributes,I=this.context,D=I.gl;this.vao&&this.destroy(),this.vao=I.createVertexArray(),I.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=d,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=x,this.boundDynamicVertexBuffer2=S,this.boundDynamicVertexBuffer3=k,s.enableAttributes(D,e);for(const L of u)L.enableAttributes(D,e);x&&x.enableAttributes(D,e),S&&S.enableAttributes(D,e),k&&k.enableAttributes(D,e),s.bind(),s.setVertexAttribPointers(D,e,y);for(const L of u)L.bind(),L.setVertexAttribPointers(D,e,y);x&&(x.bind(),x.setVertexAttribPointers(D,e,y)),d&&d.bind(),S&&(S.bind(),S.setVertexAttribPointers(D,e,y)),k&&(k.bind(),k.setVertexAttribPointers(D,e,y)),I.currentNumAttributes=A}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const ic=(g,e,s,u,d)=>({u_texture:0,u_ele_delta:g,u_fog_matrix:e,u_fog_color:s?s.properties.get("fog-color"):l.bf.white,u_fog_ground_blend:s?s.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:d?0:s?s.calculateFogBlendOpacity(u):0,u_horizon_color:s?s.properties.get("horizon-color"):l.bf.white,u_horizon_fog_blend:s?s.properties.get("horizon-fog-blend"):1,u_is_globe_mode:d?1:0}),Nu={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function go(g){const e=[];for(let s=0;s<g.length;s++){if(g[s]===null)continue;const u=g[s].split(" ");e.push(u.pop())}return e}class Uu{constructor(e,s,u,d,y,x,S,k,A=[]){const I=e.gl;this.program=I.createProgram();const D=go(s.staticAttributes),L=u?u.getBinderAttributes():[],O=D.concat(L),U=vn.prelude.staticUniforms?go(vn.prelude.staticUniforms):[],K=S.staticUniforms?go(S.staticUniforms):[],X=s.staticUniforms?go(s.staticUniforms):[],Y=u?u.getBinderUniforms():[],ee=U.concat(K).concat(X).concat(Y),ne=[];for(const Te of ee)ne.indexOf(Te)<0&&ne.push(Te);const te=u?u.defines():[];Wn(I)&&te.unshift("#version 300 es"),y&&te.push("#define OVERDRAW_INSPECTOR;"),x&&te.push("#define TERRAIN3D;"),k&&te.push(k),A&&te.push(...A);let oe=te.concat(vn.prelude.fragmentSource,S.fragmentSource,s.fragmentSource).join(`
`),ce=te.concat(vn.prelude.vertexSource,S.vertexSource,s.vertexSource).join(`
`);Wn(I)||(oe=(function(Te){return Te.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(oe),ce=(function(Te){return Te.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(ce));const re=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);if(I.shaderSource(re,oe),I.compileShader(re),!I.getShaderParameter(re,I.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${I.getShaderInfoLog(re)}`);I.attachShader(this.program,re);const _e=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);if(I.shaderSource(_e,ce),I.compileShader(_e),!I.getShaderParameter(_e,I.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${I.getShaderInfoLog(_e)}`);I.attachShader(this.program,_e),this.attributes={};const Me={};this.numAttributes=O.length;for(let Te=0;Te<this.numAttributes;Te++)O[Te]&&(I.bindAttribLocation(this.program,Te,O[Te]),this.attributes[O[Te]]=Te);if(I.linkProgram(this.program),!I.getProgramParameter(this.program,I.LINK_STATUS))throw new Error(`Program failed to link: ${I.getProgramInfoLog(this.program)}`);I.deleteShader(_e),I.deleteShader(re);for(let Te=0;Te<ne.length;Te++){const Se=ne[Te];if(Se&&!Me[Se]){const Pe=I.getUniformLocation(this.program,Se);Pe&&(Me[Se]=Pe)}}this.fixedUniforms=d(e,Me),this.terrainUniforms=((Te,Se)=>({u_depth:new l.bP(Te,Se.u_depth),u_terrain:new l.bP(Te,Se.u_terrain),u_terrain_dim:new l.bg(Te,Se.u_terrain_dim),u_terrain_matrix:new l.bR(Te,Se.u_terrain_matrix),u_terrain_unpack:new l.bS(Te,Se.u_terrain_unpack),u_terrain_exaggeration:new l.bg(Te,Se.u_terrain_exaggeration)}))(e,Me),this.projectionUniforms=((Te,Se)=>({u_projection_matrix:new l.bR(Te,Se.u_projection_matrix),u_projection_tile_mercator_coords:new l.bS(Te,Se.u_projection_tile_mercator_coords),u_projection_clipping_plane:new l.bS(Te,Se.u_projection_clipping_plane),u_projection_transition:new l.bg(Te,Se.u_projection_transition),u_projection_fallback_matrix:new l.bR(Te,Se.u_projection_fallback_matrix)}))(e,Me),this.binderUniforms=u?u.getUniforms(e,Me):[]}draw(e,s,u,d,y,x,S,k,A,I,D,L,O,U,K,X,Y,ee,ne){const te=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(u),e.setStencilMode(d),e.setColorMode(y),e.setCullFace(x),k){e.activeTexture.set(te.TEXTURE2),te.bindTexture(te.TEXTURE_2D,k.depthTexture),e.activeTexture.set(te.TEXTURE3),te.bindTexture(te.TEXTURE_2D,k.texture);for(const ce in this.terrainUniforms)this.terrainUniforms[ce].set(k[ce])}if(A)for(const ce in A)this.projectionUniforms[Nu[ce]].set(A[ce]);if(S)for(const ce in this.fixedUniforms)this.fixedUniforms[ce].set(S[ce]);X&&X.setUniforms(e,this.binderUniforms,U,{zoom:K});let oe=0;switch(s){case te.LINES:oe=2;break;case te.TRIANGLES:oe=3;break;case te.LINE_STRIP:oe=1}for(const ce of O.get()){const re=ce.vaos||(ce.vaos={});(re[I]||(re[I]=new ym)).bind(e,this,D,X?X.getPaintVertexBuffers():[],L,ce.vertexOffset,Y,ee,ne),te.drawElements(s,ce.primitiveLength*oe,te.UNSIGNED_SHORT,ce.primitiveOffset*oe*2)}}}function nc(g,e,s){const u=1/l.aC(s,1,e.transform.tileZoom),d=Math.pow(2,s.tileID.overscaledZ),y=s.tileSize*Math.pow(2,e.transform.tileZoom)/d,x=y*(s.tileID.canonical.x+s.tileID.wrap*d),S=y*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[u,g.fromScale,g.toScale],u_fade:g.t,u_pixel_coord_upper:[x>>16,S>>16],u_pixel_coord_lower:[65535&x,65535&S]}}const xn=(g,e,s,u)=>{const d=g.style.light,y=d.properties.get("position"),x=[y.x,y.y,y.z],S=l.bV();d.properties.get("anchor")==="viewport"&&l.bW(S,g.transform.bearingInRadians),l.bX(x,x,S);const k=g.transform.transformLightDirection(x),A=d.properties.get("color");return{u_lightpos:x,u_lightpos_globe:k,u_lightintensity:d.properties.get("intensity"),u_lightcolor:[A.r,A.g,A.b],u_vertical_gradient:+e,u_opacity:s,u_fill_translate:u}},_m=(g,e,s,u,d,y,x)=>l.e(xn(g,e,s,u),nc(y,g,x),{u_height_factor:-Math.pow(2,d.overscaledZ)/x.tileSize/8}),ac=(g,e,s,u)=>l.e(nc(e,g,s),{u_fill_translate:u}),qs=(g,e)=>({u_world:g,u_fill_translate:e}),Gs=(g,e,s,u,d)=>l.e(ac(g,e,s,d),{u_world:u}),vm=(g,e,s,u,d)=>{const y=g.transform;let x,S,k=0;if(s.paint.get("circle-pitch-alignment")==="map"){const A=l.aC(e,1,y.zoom);x=!0,S=[A,A],k=A/(l.$*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*d}else x=!1,S=y.pixelsToGLUnits;return{u_camera_to_center_distance:y.cameraToCenterDistance,u_scale_with_map:+(s.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+x,u_device_pixel_ratio:g.pixelRatio,u_extrude_scale:S,u_globe_extrude_scale:k,u_translate:u}},oc=g=>({u_pixel_extrude_scale:[1/g.width,1/g.height]}),bm=g=>({u_viewport_size:[g.width,g.height]}),yo=(g,e=1)=>({u_color:g,u_overlay:0,u_overlay_scale:e}),Np=(g,e,s,u)=>{const d=l.aC(g,1,e)/(l.$*Math.pow(2,g.tileID.overscaledZ))*2*Math.PI*u;return{u_extrude_scale:l.aC(g,1,e),u_intensity:s,u_globe_extrude_scale:d}},Vu=(g,e,s,u)=>{const d=l.L();l.bY(d,0,g.width,g.height,0,0,1);const y=g.context.gl;return{u_matrix:d,u_world:[y.drawingBufferWidth,y.drawingBufferHeight],u_image:s,u_color_ramp:u,u_opacity:e.paint.get("heatmap-opacity")}},xm=(g,e,s)=>{const u=s.paint.get("hillshade-accent-color");let d;switch(s.paint.get("hillshade-method")){case"basic":d=4;break;case"combined":d=1;break;case"igor":d=2;break;case"multidirectional":d=3;break;default:d=0}const y=s.getIlluminationProperties();for(let x=0;x<y.directionRadians.length;x++)s.paint.get("hillshade-illumination-anchor")==="viewport"&&(y.directionRadians[x]+=g.transform.bearingInRadians);return{u_image:0,u_latrange:qu(0,e.tileID),u_exaggeration:s.paint.get("hillshade-exaggeration"),u_altitudes:y.altitudeRadians,u_azimuths:y.directionRadians,u_accent:u,u_method:d,u_highlights:y.highlightColor,u_shadows:y.shadowColor}},Up=(g,e)=>{const s=e.stride,u=l.L();return l.bY(u,0,l.$,-l.$,0,0,1),l.M(u,u,[0,-l.$,0]),{u_matrix:u,u_image:1,u_dimension:[s,s],u_zoom:g.overscaledZ,u_unpack:e.getUnpackVector()}};function qu(g,e){const s=Math.pow(2,e.canonical.z),u=e.canonical.y;return[new l.a1(0,u/s).toLngLat().lat,new l.a1(0,(u+1)/s).toLngLat().lat]}const Vp=(g,e,s=0)=>({u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:s,u_opacity:g.paint.get("color-relief-opacity")}),sc=(g,e,s,u)=>{const d=g.transform;return{u_translation:Zu(g,e,s),u_ratio:u/l.aC(e,1,d.zoom),u_device_pixel_ratio:g.pixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},qp=(g,e,s,u,d)=>l.e(sc(g,e,s,u),{u_image:0,u_image_height:d}),Gp=(g,e,s,u,d)=>{const y=g.transform,x=Gu(e,y);return{u_translation:Zu(g,e,s),u_texsize:e.imageAtlasTexture.size,u_ratio:u/l.aC(e,1,y.zoom),u_device_pixel_ratio:g.pixelRatio,u_image:0,u_scale:[x,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},_o=(g,e,s,u,d,y)=>{const x=g.lineAtlas,S=Gu(e,g.transform),k=s.layout.get("line-cap")==="round",A=x.getDash(d.from,k),I=x.getDash(d.to,k),D=A.width*y.fromScale,L=I.width*y.toScale;return l.e(sc(g,e,s,u),{u_patternscale_a:[S/D,-A.height/2],u_patternscale_b:[S/L,-I.height/2],u_sdfgamma:x.width/(256*Math.min(D,L)*g.pixelRatio)/2,u_image:0,u_tex_y_a:A.y,u_tex_y_b:I.y,u_mix:y.t})};function Gu(g,e){return 1/l.aC(g,1,e.tileZoom)}function Zu(g,e,s){return l.aD(g.transform,e,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const Zs=(g,e,s,u,d)=>{return{u_tl_parent:g,u_scale_parent:e,u_buffer_scale:1,u_fade_t:s.mix,u_opacity:s.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(x=u.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(y=u.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:wm(u.paint.get("raster-hue-rotate")),u_coords_top:[d[0].x,d[0].y,d[1].x,d[1].y],u_coords_bottom:[d[3].x,d[3].y,d[2].x,d[2].y]};var y,x};function wm(g){g*=Math.PI/180;const e=Math.sin(g),s=Math.cos(g);return[(2*s+1)/3,(-Math.sqrt(3)*e-s+1)/3,(Math.sqrt(3)*e-s+1)/3]}const Ws=(g,e,s,u,d,y,x,S,k,A,I,D,L)=>{const O=x.transform;return{u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:O.cameraToCenterDistance,u_pitch:O.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:O.width/O.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_label_plane_matrix:S,u_coord_matrix:k,u_is_text:+I,u_pitch_with_map:+u,u_is_along_line:d,u_is_variable_anchor:y,u_texsize:D,u_texture:0,u_translation:A,u_pitched_scale:L}},Zp=(g,e,s,u,d,y,x,S,k,A,I,D,L,O)=>{const U=x.transform;return l.e(Ws(g,e,s,u,d,y,x,S,k,A,I,D,O),{u_gamma_scale:u?Math.cos(U.pitch*Math.PI/180)*U.cameraToCenterDistance:1,u_device_pixel_ratio:x.pixelRatio,u_is_halo:1})},Tm=(g,e,s,u,d,y,x,S,k,A,I,D,L)=>l.e(Zp(g,e,s,u,d,y,x,S,k,A,!0,I,0,L),{u_texsize_icon:D,u_texture_icon:1}),Wp=(g,e)=>({u_opacity:g,u_color:e}),Hp=(g,e,s,u,d)=>l.e((function(y,x,S,k){const A=S.imageManager.getPattern(y.from.toString()),I=S.imageManager.getPattern(y.to.toString()),{width:D,height:L}=S.imageManager.getPixelSize(),O=Math.pow(2,k.tileID.overscaledZ),U=k.tileSize*Math.pow(2,S.transform.tileZoom)/O,K=U*(k.tileID.canonical.x+k.tileID.wrap*O),X=U*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:A.tl,u_pattern_br_a:A.br,u_pattern_tl_b:I.tl,u_pattern_br_b:I.br,u_texsize:[D,L],u_mix:x.t,u_pattern_size_a:A.displaySize,u_pattern_size_b:I.displaySize,u_scale_a:x.fromScale,u_scale_b:x.toScale,u_tile_units_to_pixels:1/l.aC(k,1,S.transform.tileZoom),u_pixel_coord_upper:[K>>16,X>>16],u_pixel_coord_lower:[65535&K,65535&X]}})(s,d,e,u),{u_opacity:g}),Wu=(g,e)=>{},Hu={fillExtrusion:(g,e)=>({u_lightpos:new l.bT(g,e.u_lightpos),u_lightpos_globe:new l.bT(g,e.u_lightpos_globe),u_lightintensity:new l.bg(g,e.u_lightintensity),u_lightcolor:new l.bT(g,e.u_lightcolor),u_vertical_gradient:new l.bg(g,e.u_vertical_gradient),u_opacity:new l.bg(g,e.u_opacity),u_fill_translate:new l.bU(g,e.u_fill_translate)}),fillExtrusionPattern:(g,e)=>({u_lightpos:new l.bT(g,e.u_lightpos),u_lightpos_globe:new l.bT(g,e.u_lightpos_globe),u_lightintensity:new l.bg(g,e.u_lightintensity),u_lightcolor:new l.bT(g,e.u_lightcolor),u_vertical_gradient:new l.bg(g,e.u_vertical_gradient),u_height_factor:new l.bg(g,e.u_height_factor),u_opacity:new l.bg(g,e.u_opacity),u_fill_translate:new l.bU(g,e.u_fill_translate),u_image:new l.bP(g,e.u_image),u_texsize:new l.bU(g,e.u_texsize),u_pixel_coord_upper:new l.bU(g,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.bU(g,e.u_pixel_coord_lower),u_scale:new l.bT(g,e.u_scale),u_fade:new l.bg(g,e.u_fade)}),fill:(g,e)=>({u_fill_translate:new l.bU(g,e.u_fill_translate)}),fillPattern:(g,e)=>({u_image:new l.bP(g,e.u_image),u_texsize:new l.bU(g,e.u_texsize),u_pixel_coord_upper:new l.bU(g,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.bU(g,e.u_pixel_coord_lower),u_scale:new l.bT(g,e.u_scale),u_fade:new l.bg(g,e.u_fade),u_fill_translate:new l.bU(g,e.u_fill_translate)}),fillOutline:(g,e)=>({u_world:new l.bU(g,e.u_world),u_fill_translate:new l.bU(g,e.u_fill_translate)}),fillOutlinePattern:(g,e)=>({u_world:new l.bU(g,e.u_world),u_image:new l.bP(g,e.u_image),u_texsize:new l.bU(g,e.u_texsize),u_pixel_coord_upper:new l.bU(g,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.bU(g,e.u_pixel_coord_lower),u_scale:new l.bT(g,e.u_scale),u_fade:new l.bg(g,e.u_fade),u_fill_translate:new l.bU(g,e.u_fill_translate)}),circle:(g,e)=>({u_camera_to_center_distance:new l.bg(g,e.u_camera_to_center_distance),u_scale_with_map:new l.bP(g,e.u_scale_with_map),u_pitch_with_map:new l.bP(g,e.u_pitch_with_map),u_extrude_scale:new l.bU(g,e.u_extrude_scale),u_device_pixel_ratio:new l.bg(g,e.u_device_pixel_ratio),u_globe_extrude_scale:new l.bg(g,e.u_globe_extrude_scale),u_translate:new l.bU(g,e.u_translate)}),collisionBox:(g,e)=>({u_pixel_extrude_scale:new l.bU(g,e.u_pixel_extrude_scale)}),collisionCircle:(g,e)=>({u_viewport_size:new l.bU(g,e.u_viewport_size)}),debug:(g,e)=>({u_color:new l.bQ(g,e.u_color),u_overlay:new l.bP(g,e.u_overlay),u_overlay_scale:new l.bg(g,e.u_overlay_scale)}),depth:Wu,clippingMask:Wu,heatmap:(g,e)=>({u_extrude_scale:new l.bg(g,e.u_extrude_scale),u_intensity:new l.bg(g,e.u_intensity),u_globe_extrude_scale:new l.bg(g,e.u_globe_extrude_scale)}),heatmapTexture:(g,e)=>({u_matrix:new l.bR(g,e.u_matrix),u_world:new l.bU(g,e.u_world),u_image:new l.bP(g,e.u_image),u_color_ramp:new l.bP(g,e.u_color_ramp),u_opacity:new l.bg(g,e.u_opacity)}),hillshade:(g,e)=>({u_image:new l.bP(g,e.u_image),u_latrange:new l.bU(g,e.u_latrange),u_exaggeration:new l.bg(g,e.u_exaggeration),u_altitudes:new l.b_(g,e.u_altitudes),u_azimuths:new l.b_(g,e.u_azimuths),u_accent:new l.bQ(g,e.u_accent),u_method:new l.bP(g,e.u_method),u_shadows:new l.bZ(g,e.u_shadows),u_highlights:new l.bZ(g,e.u_highlights)}),hillshadePrepare:(g,e)=>({u_matrix:new l.bR(g,e.u_matrix),u_image:new l.bP(g,e.u_image),u_dimension:new l.bU(g,e.u_dimension),u_zoom:new l.bg(g,e.u_zoom),u_unpack:new l.bS(g,e.u_unpack)}),colorRelief:(g,e)=>({u_image:new l.bP(g,e.u_image),u_unpack:new l.bS(g,e.u_unpack),u_dimension:new l.bU(g,e.u_dimension),u_elevation_stops:new l.bP(g,e.u_elevation_stops),u_color_stops:new l.bP(g,e.u_color_stops),u_color_ramp_size:new l.bP(g,e.u_color_ramp_size),u_opacity:new l.bg(g,e.u_opacity)}),line:(g,e)=>({u_translation:new l.bU(g,e.u_translation),u_ratio:new l.bg(g,e.u_ratio),u_device_pixel_ratio:new l.bg(g,e.u_device_pixel_ratio),u_units_to_pixels:new l.bU(g,e.u_units_to_pixels)}),lineGradient:(g,e)=>({u_translation:new l.bU(g,e.u_translation),u_ratio:new l.bg(g,e.u_ratio),u_device_pixel_ratio:new l.bg(g,e.u_device_pixel_ratio),u_units_to_pixels:new l.bU(g,e.u_units_to_pixels),u_image:new l.bP(g,e.u_image),u_image_height:new l.bg(g,e.u_image_height)}),linePattern:(g,e)=>({u_translation:new l.bU(g,e.u_translation),u_texsize:new l.bU(g,e.u_texsize),u_ratio:new l.bg(g,e.u_ratio),u_device_pixel_ratio:new l.bg(g,e.u_device_pixel_ratio),u_image:new l.bP(g,e.u_image),u_units_to_pixels:new l.bU(g,e.u_units_to_pixels),u_scale:new l.bT(g,e.u_scale),u_fade:new l.bg(g,e.u_fade)}),lineSDF:(g,e)=>({u_translation:new l.bU(g,e.u_translation),u_ratio:new l.bg(g,e.u_ratio),u_device_pixel_ratio:new l.bg(g,e.u_device_pixel_ratio),u_units_to_pixels:new l.bU(g,e.u_units_to_pixels),u_patternscale_a:new l.bU(g,e.u_patternscale_a),u_patternscale_b:new l.bU(g,e.u_patternscale_b),u_sdfgamma:new l.bg(g,e.u_sdfgamma),u_image:new l.bP(g,e.u_image),u_tex_y_a:new l.bg(g,e.u_tex_y_a),u_tex_y_b:new l.bg(g,e.u_tex_y_b),u_mix:new l.bg(g,e.u_mix)}),raster:(g,e)=>({u_tl_parent:new l.bU(g,e.u_tl_parent),u_scale_parent:new l.bg(g,e.u_scale_parent),u_buffer_scale:new l.bg(g,e.u_buffer_scale),u_fade_t:new l.bg(g,e.u_fade_t),u_opacity:new l.bg(g,e.u_opacity),u_image0:new l.bP(g,e.u_image0),u_image1:new l.bP(g,e.u_image1),u_brightness_low:new l.bg(g,e.u_brightness_low),u_brightness_high:new l.bg(g,e.u_brightness_high),u_saturation_factor:new l.bg(g,e.u_saturation_factor),u_contrast_factor:new l.bg(g,e.u_contrast_factor),u_spin_weights:new l.bT(g,e.u_spin_weights),u_coords_top:new l.bS(g,e.u_coords_top),u_coords_bottom:new l.bS(g,e.u_coords_bottom)}),symbolIcon:(g,e)=>({u_is_size_zoom_constant:new l.bP(g,e.u_is_size_zoom_constant),u_is_size_feature_constant:new l.bP(g,e.u_is_size_feature_constant),u_size_t:new l.bg(g,e.u_size_t),u_size:new l.bg(g,e.u_size),u_camera_to_center_distance:new l.bg(g,e.u_camera_to_center_distance),u_pitch:new l.bg(g,e.u_pitch),u_rotate_symbol:new l.bP(g,e.u_rotate_symbol),u_aspect_ratio:new l.bg(g,e.u_aspect_ratio),u_fade_change:new l.bg(g,e.u_fade_change),u_label_plane_matrix:new l.bR(g,e.u_label_plane_matrix),u_coord_matrix:new l.bR(g,e.u_coord_matrix),u_is_text:new l.bP(g,e.u_is_text),u_pitch_with_map:new l.bP(g,e.u_pitch_with_map),u_is_along_line:new l.bP(g,e.u_is_along_line),u_is_variable_anchor:new l.bP(g,e.u_is_variable_anchor),u_texsize:new l.bU(g,e.u_texsize),u_texture:new l.bP(g,e.u_texture),u_translation:new l.bU(g,e.u_translation),u_pitched_scale:new l.bg(g,e.u_pitched_scale)}),symbolSDF:(g,e)=>({u_is_size_zoom_constant:new l.bP(g,e.u_is_size_zoom_constant),u_is_size_feature_constant:new l.bP(g,e.u_is_size_feature_constant),u_size_t:new l.bg(g,e.u_size_t),u_size:new l.bg(g,e.u_size),u_camera_to_center_distance:new l.bg(g,e.u_camera_to_center_distance),u_pitch:new l.bg(g,e.u_pitch),u_rotate_symbol:new l.bP(g,e.u_rotate_symbol),u_aspect_ratio:new l.bg(g,e.u_aspect_ratio),u_fade_change:new l.bg(g,e.u_fade_change),u_label_plane_matrix:new l.bR(g,e.u_label_plane_matrix),u_coord_matrix:new l.bR(g,e.u_coord_matrix),u_is_text:new l.bP(g,e.u_is_text),u_pitch_with_map:new l.bP(g,e.u_pitch_with_map),u_is_along_line:new l.bP(g,e.u_is_along_line),u_is_variable_anchor:new l.bP(g,e.u_is_variable_anchor),u_texsize:new l.bU(g,e.u_texsize),u_texture:new l.bP(g,e.u_texture),u_gamma_scale:new l.bg(g,e.u_gamma_scale),u_device_pixel_ratio:new l.bg(g,e.u_device_pixel_ratio),u_is_halo:new l.bP(g,e.u_is_halo),u_translation:new l.bU(g,e.u_translation),u_pitched_scale:new l.bg(g,e.u_pitched_scale)}),symbolTextAndIcon:(g,e)=>({u_is_size_zoom_constant:new l.bP(g,e.u_is_size_zoom_constant),u_is_size_feature_constant:new l.bP(g,e.u_is_size_feature_constant),u_size_t:new l.bg(g,e.u_size_t),u_size:new l.bg(g,e.u_size),u_camera_to_center_distance:new l.bg(g,e.u_camera_to_center_distance),u_pitch:new l.bg(g,e.u_pitch),u_rotate_symbol:new l.bP(g,e.u_rotate_symbol),u_aspect_ratio:new l.bg(g,e.u_aspect_ratio),u_fade_change:new l.bg(g,e.u_fade_change),u_label_plane_matrix:new l.bR(g,e.u_label_plane_matrix),u_coord_matrix:new l.bR(g,e.u_coord_matrix),u_is_text:new l.bP(g,e.u_is_text),u_pitch_with_map:new l.bP(g,e.u_pitch_with_map),u_is_along_line:new l.bP(g,e.u_is_along_line),u_is_variable_anchor:new l.bP(g,e.u_is_variable_anchor),u_texsize:new l.bU(g,e.u_texsize),u_texsize_icon:new l.bU(g,e.u_texsize_icon),u_texture:new l.bP(g,e.u_texture),u_texture_icon:new l.bP(g,e.u_texture_icon),u_gamma_scale:new l.bg(g,e.u_gamma_scale),u_device_pixel_ratio:new l.bg(g,e.u_device_pixel_ratio),u_is_halo:new l.bP(g,e.u_is_halo),u_translation:new l.bU(g,e.u_translation),u_pitched_scale:new l.bg(g,e.u_pitched_scale)}),background:(g,e)=>({u_opacity:new l.bg(g,e.u_opacity),u_color:new l.bQ(g,e.u_color)}),backgroundPattern:(g,e)=>({u_opacity:new l.bg(g,e.u_opacity),u_image:new l.bP(g,e.u_image),u_pattern_tl_a:new l.bU(g,e.u_pattern_tl_a),u_pattern_br_a:new l.bU(g,e.u_pattern_br_a),u_pattern_tl_b:new l.bU(g,e.u_pattern_tl_b),u_pattern_br_b:new l.bU(g,e.u_pattern_br_b),u_texsize:new l.bU(g,e.u_texsize),u_mix:new l.bg(g,e.u_mix),u_pattern_size_a:new l.bU(g,e.u_pattern_size_a),u_pattern_size_b:new l.bU(g,e.u_pattern_size_b),u_scale_a:new l.bg(g,e.u_scale_a),u_scale_b:new l.bg(g,e.u_scale_b),u_pixel_coord_upper:new l.bU(g,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.bU(g,e.u_pixel_coord_lower),u_tile_units_to_pixels:new l.bg(g,e.u_tile_units_to_pixels)}),terrain:(g,e)=>({u_texture:new l.bP(g,e.u_texture),u_ele_delta:new l.bg(g,e.u_ele_delta),u_fog_matrix:new l.bR(g,e.u_fog_matrix),u_fog_color:new l.bQ(g,e.u_fog_color),u_fog_ground_blend:new l.bg(g,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new l.bg(g,e.u_fog_ground_blend_opacity),u_horizon_color:new l.bQ(g,e.u_horizon_color),u_horizon_fog_blend:new l.bg(g,e.u_horizon_fog_blend),u_is_globe_mode:new l.bg(g,e.u_is_globe_mode)}),terrainDepth:(g,e)=>({u_ele_delta:new l.bg(g,e.u_ele_delta)}),terrainCoords:(g,e)=>({u_texture:new l.bP(g,e.u_texture),u_terrain_coords_id:new l.bg(g,e.u_terrain_coords_id),u_ele_delta:new l.bg(g,e.u_ele_delta)}),projectionErrorMeasurement:(g,e)=>({u_input:new l.bg(g,e.u_input),u_output_expected:new l.bg(g,e.u_output_expected)}),atmosphere:(g,e)=>({u_sun_pos:new l.bT(g,e.u_sun_pos),u_atmosphere_blend:new l.bg(g,e.u_atmosphere_blend),u_globe_position:new l.bT(g,e.u_globe_position),u_globe_radius:new l.bg(g,e.u_globe_radius),u_inv_proj_matrix:new l.bR(g,e.u_inv_proj_matrix)}),sky:(g,e)=>({u_sky_color:new l.bQ(g,e.u_sky_color),u_horizon_color:new l.bQ(g,e.u_horizon_color),u_horizon:new l.bU(g,e.u_horizon),u_horizon_normal:new l.bU(g,e.u_horizon_normal),u_sky_horizon_blend:new l.bg(g,e.u_sky_horizon_blend),u_sky_blend:new l.bg(g,e.u_sky_blend)})};class Xp{constructor(e,s,u){this.context=e;const d=e.gl;this.buffer=d.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const lc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ha{constructor(e,s,u,d){this.length=s.length,this.attributes=u,this.itemSize=s.bytesPerElement,this.dynamicDraw=d,this.context=e;const y=e.gl;this.buffer=y.createBuffer(),e.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,s){for(let u=0;u<this.attributes.length;u++){const d=s.attributes[this.attributes[u].name];d!==void 0&&e.enableVertexAttribArray(d)}}setVertexAttribPointers(e,s,u){for(let d=0;d<this.attributes.length;d++){const y=this.attributes[d],x=s.attributes[y.name];x!==void 0&&e.vertexAttribPointer(x,y.components,e[lc[y.type]],!1,this.itemSize,y.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Jt{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Xu extends Jt{getDefault(){return l.bf.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Ku extends Jt{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Kp extends Jt{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Yu extends Jt{getDefault(){return[!0,!0,!0,!0]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class vo extends Jt{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Ju extends Jt{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Sm extends Jt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const s=this.current;(e.func!==s.func||e.ref!==s.ref||e.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class km extends Jt{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Cm extends Jt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=e,this.dirty=!1}}class Pm extends Jt{getDefault(){return[0,1]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Yp extends Jt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=e,this.dirty=!1}}class Mm extends Jt{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Jp extends Jt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.BLEND):s.disable(s.BLEND),this.current=e,this.dirty=!1}}class cc extends Jt{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class uc extends Jt{getDefault(){return l.bf.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class hc extends Jt{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Qu extends Jt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=e,this.dirty=!1}}class bo extends Jt{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Hs extends Jt{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class is extends Jt{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class un extends Jt{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Qp extends Jt{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ed extends Jt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class eh extends Jt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class xo extends Jt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class pc extends Jt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class dc extends Jt{getDefault(){return null}set(e){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Xs extends Jt{getDefault(){return null}set(e){var s;if(e===this.current&&!this.dirty)return;const u=this.gl;Wn(u)?u.bindVertexArray(e):(s=u.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class fc extends Jt{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class td extends Jt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class ns extends Jt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Va extends Jt{constructor(e,s){super(e),this.context=e,this.parent=s}getDefault(){return null}}class rd extends Va{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class th extends Va{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Ot extends Va{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const Ks="Framebuffer is not complete";class Am{constructor(e,s,u,d,y){this.context=e,this.width=s,this.height=u;const x=e.gl,S=this.framebuffer=x.createFramebuffer();if(this.colorAttachment=new rd(e,S),d)this.depthAttachment=y?new Ot(e,S):new th(e,S);else if(y)throw new Error("Stencil cannot be set without depth");if(x.checkFramebufferStatus(x.FRAMEBUFFER)!==x.FRAMEBUFFER_COMPLETE)throw new Error(Ks)}destroy(){const e=this.context.gl,s=this.colorAttachment.get();if(s&&e.deleteTexture(s),this.depthAttachment){const u=this.depthAttachment.get();u&&e.deleteRenderbuffer(u)}e.deleteFramebuffer(this.framebuffer)}}class id{constructor(e){var s,u;if(this.gl=e,this.clearColor=new Xu(this),this.clearDepth=new Ku(this),this.clearStencil=new Kp(this),this.colorMask=new Yu(this),this.depthMask=new vo(this),this.stencilMask=new Ju(this),this.stencilFunc=new Sm(this),this.stencilOp=new km(this),this.stencilTest=new Cm(this),this.depthRange=new Pm(this),this.depthTest=new Yp(this),this.depthFunc=new Mm(this),this.blend=new Jp(this),this.blendFunc=new cc(this),this.blendColor=new uc(this),this.blendEquation=new hc(this),this.cullFace=new Qu(this),this.cullFaceSide=new bo(this),this.frontFace=new Hs(this),this.program=new is(this),this.activeTexture=new un(this),this.viewport=new Qp(this),this.bindFramebuffer=new ed(this),this.bindRenderbuffer=new eh(this),this.bindTexture=new xo(this),this.bindVertexBuffer=new pc(this),this.bindElementBuffer=new dc(this),this.bindVertexArray=new Xs(this),this.pixelStoreUnpack=new fc(this),this.pixelStoreUnpackPremultiplyAlpha=new td(this),this.pixelStoreUnpackFlipY=new ns(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Wn(e)){this.HALF_FLOAT=e.HALF_FLOAT;const d=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=e.RGBA16F)!==null&&s!==void 0?s:d?.RGBA16F_EXT,this.RGB16F=(u=e.RGB16F)!==null&&u!==void 0?u:d?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const d=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=d?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,s){return new Xp(this,e,s)}createVertexBuffer(e,s,u){return new ha(this,e,s,u)}createRenderbuffer(e,s,u){const d=this.gl,y=d.createRenderbuffer();return this.bindRenderbuffer.set(y),d.renderbufferStorage(d.RENDERBUFFER,e,s,u),this.bindRenderbuffer.set(null),y}createFramebuffer(e,s,u,d){return new Am(this,e,s,u,d)}clear({color:e,depth:s,stencil:u}){const d=this.gl;let y=0;e&&(y|=d.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(y|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),u!==void 0&&(y|=d.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),d.clear(y)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){l.bH(e.blendFunction,yr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Wn(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var s;return Wn(this.gl)?this.gl.deleteVertexArray(e):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let qa;function nd(g,e,s,u,d){const y=g.context,x=g.transform,S=y.gl,k=g.useProgram("collisionBox"),A=[];let I=0,D=0;for(let Y=0;Y<u.length;Y++){const ee=u[Y],ne=e.getTile(ee).getBucket(s);if(!ne)continue;const te=d?ne.textCollisionBox:ne.iconCollisionBox,oe=ne.collisionCircleArray;oe.length>0&&(A.push({circleArray:oe,circleOffset:D,coord:ee}),I+=oe.length/4,D=I),te&&k.draw(y,S.LINES,wt.disabled,Wt.disabled,g.colorModeForRenderPass(),ft.disabled,oc(g.transform),g.style.map.terrain&&g.style.map.terrain.getTerrainData(ee),x.getProjectionData({overscaledTileID:ee,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),s.id,te.layoutVertexBuffer,te.indexBuffer,te.segments,null,g.transform.zoom,null,null,te.collisionVertexBuffer)}if(!d||!A.length)return;const L=g.useProgram("collisionCircle"),O=new l.b$;O.resize(4*I),O._trim();let U=0;for(const Y of A)for(let ee=0;ee<Y.circleArray.length/4;ee++){const ne=4*ee,te=Y.circleArray[ne+0],oe=Y.circleArray[ne+1],ce=Y.circleArray[ne+2],re=Y.circleArray[ne+3];O.emplace(U++,te,oe,ce,re,0),O.emplace(U++,te,oe,ce,re,1),O.emplace(U++,te,oe,ce,re,2),O.emplace(U++,te,oe,ce,re,3)}(!qa||qa.length<2*I)&&(qa=(function(Y){const ee=2*Y,ne=new l.c1;ne.resize(ee),ne._trim();for(let te=0;te<ee;te++){const oe=6*te;ne.uint16[oe+0]=4*te+0,ne.uint16[oe+1]=4*te+1,ne.uint16[oe+2]=4*te+2,ne.uint16[oe+3]=4*te+2,ne.uint16[oe+4]=4*te+3,ne.uint16[oe+5]=4*te+0}return ne})(I));const K=y.createIndexBuffer(qa,!0),X=y.createVertexBuffer(O,l.c0.members,!0);for(const Y of A){const ee=bm(g.transform);L.draw(y,S.TRIANGLES,wt.disabled,Wt.disabled,g.colorModeForRenderPass(),ft.disabled,ee,g.style.map.terrain&&g.style.map.terrain.getTerrainData(Y.coord),null,s.id,X,K,l.aM.simpleSegment(0,2*Y.circleOffset,Y.circleArray.length,Y.circleArray.length/2),null,g.transform.zoom,null,null,null)}X.destroy(),K.destroy()}const Em=l.ag(new Float32Array(16));function ad(g,e,s,u,d,y){const{horizontalAlign:x,verticalAlign:S}=l.aH(g);return new l.P((-(x-.5)*e/d+u[0])*y,(-(S-.5)*s/d+u[1])*y)}function Im(g,e,s,u,d,y){const x=e.tileAnchorPoint.add(new l.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let S=u.mult(y);s||(S=S.rotate(-d));const k=x.add(S);return $r(k.x,k.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(s){const S=pi(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(g),k=Math.atan(S.y/S.x)+(S.x<0?Math.PI:0);return g.add(u.rotate(k))}return g.add(u)}function rh(g,e,s,u,d,y,x,S,k,A,I,D){const L=g.text.placedSymbolArray,O=g.text.dynamicLayoutVertexArray,U=g.icon.dynamicLayoutVertexArray,K={};O.clear();for(let X=0;X<L.length;X++){const Y=L.get(X),ee=Y.hidden||!Y.crossTileID||g.allowVerticalPlacement&&!Y.placedOrientation?null:u[Y.crossTileID];if(ee){const ne=new l.P(Y.anchorX,Y.anchorY),te={getElevation:D,width:d.width,height:d.height,pitchedLabelPlaneMatrix:y,pitchWithMap:s,transform:d,tileAnchorPoint:ne,translation:A,unwrappedTileID:I},oe=s?Oa(ne.x,ne.y,te):pi(ne.x,ne.y,te),ce=Be(d.cameraToCenterDistance,oe.signedDistanceFromCamera);let re=l.ap(g.textSizeData,S,Y)*ce/l.aB;s&&(re*=g.tilePixelRatio/x);const{width:_e,height:Me,anchor:Te,textOffset:Se,textBoxScale:Pe}=ee,Oe=ad(Te,_e,Me,Se,Pe,re),Ne=d.getPitchedTextCorrection(ne.x+A[0],ne.y+A[1],I),Le=Im(oe.point,te,e,Oe,-d.bearingInRadians,Ne),it=g.allowVerticalPlacement&&Y.placedOrientation===l.ao.vertical?Math.PI/2:0;for(let Pt=0;Pt<Y.numGlyphs;Pt++)l.av(O,Le,it);k&&Y.associatedIconIndex>=0&&(K[Y.associatedIconIndex]={shiftedAnchor:Le,angle:it})}else Zn(Y.numGlyphs,O)}if(k){U.clear();const X=g.icon.placedSymbolArray;for(let Y=0;Y<X.length;Y++){const ee=X.get(Y);if(ee.hidden)Zn(ee.numGlyphs,U);else{const ne=K[Y];if(ne)for(let te=0;te<ee.numGlyphs;te++)l.av(U,ne.shiftedAnchor,ne.angle);else Zn(ee.numGlyphs,U)}}g.icon.dynamicLayoutVertexBuffer.updateData(U)}g.text.dynamicLayoutVertexBuffer.updateData(O)}function mc(g,e,s){return s.iconsInText&&e?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function Ys(g,e,s,u,d,y,x,S,k,A,I,D,L){const O=g.context,U=O.gl,K=g.transform,X=S==="map",Y=k==="map",ee=S!=="viewport"&&s.layout.get("symbol-placement")!=="point",ne=X&&!Y&&!ee,te=!s.layout.get("symbol-sort-key").isConstant();let oe=!1;const ce=g.getDepthModeForSublayer(0,wt.ReadOnly),re=s._unevaluatedLayout.hasValue("text-variable-anchor")||s._unevaluatedLayout.hasValue("text-variable-anchor-offset"),_e=[],Me=K.getCircleRadiusCorrection();for(const Te of u){const Se=e.getTile(Te),Pe=Se.getBucket(s);if(!Pe)continue;const Oe=d?Pe.text:Pe.icon;if(!Oe||!Oe.segments.get().length||!Oe.hasVisibleVertices)continue;const Ne=Oe.programConfigurations.get(s.id),Le=d||Pe.sdfIcons,it=d?Pe.textSizeData:Pe.iconSizeData,Pt=Y||K.pitch!==0,tr=g.useProgram(mc(Le,d,Pe),Ne),lr=l.an(it,K.zoom),or=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Te);let xr,Cr,kt,cr,Ur=[0,0],Yr=null;if(d)Cr=Se.glyphAtlasTexture,kt=U.LINEAR,xr=Se.glyphAtlasTexture.size,Pe.iconsInText&&(Ur=Se.imageAtlasTexture.size,Yr=Se.imageAtlasTexture,cr=Pt||g.options.rotating||g.options.zooming||it.kind==="composite"||it.kind==="camera"?U.LINEAR:U.NEAREST);else{const Vr=s.layout.get("icon-size").constantOr(0)!==1||Pe.iconsNeedLinear;Cr=Se.imageAtlasTexture,kt=Le||g.options.rotating||g.options.zooming||Vr||Pt?U.LINEAR:U.NEAREST,xr=Se.imageAtlasTexture.size}const ni=l.aC(Se,1,g.transform.zoom),Li=Dr(X,g.transform,ni),Pn=l.L();l.aq(Pn,Li);const Za=jt(Y,X,g.transform,ni),Wa=l.aD(K,Se,y,x),gs=K.getProjectionData({overscaledTileID:Te,applyGlobeMatrix:!L,applyTerrainMatrix:!0}),ys=re&&Pe.hasTextData(),Mo=s.layout.get("icon-text-fit")!=="none"&&ys&&Pe.hasIconData();if(ee){const Vr=g.style.map.terrain?(dn,qr)=>g.style.map.terrain.getElevation(Te,dn,qr):null,Jr=s.layout.get("text-rotation-alignment")==="map";Sr(Pe,g,d,Li,Pn,Y,A,Jr,Te.toUnwrapped(),K.width,K.height,Wa,Vr)}const Ao=d&&re||Mo,Hi=ee||Ao?Em:Y?Li:g.transform.clipSpaceToPixelsMatrix,Mn=Le&&s.paint.get(d?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Di;Di=Le?Pe.iconsInText?Tm(it.kind,lr,ne,Y,ee,Ao,g,Hi,Za,Wa,xr,Ur,Me):Zp(it.kind,lr,ne,Y,ee,Ao,g,Hi,Za,Wa,d,xr,0,Me):Ws(it.kind,lr,ne,Y,ee,Ao,g,Hi,Za,Wa,d,xr,Me);const Ha={program:tr,buffers:Oe,uniformValues:Di,projectionData:gs,atlasTexture:Cr,atlasTextureIcon:Yr,atlasInterpolation:kt,atlasInterpolationIcon:cr,isSDF:Le,hasHalo:Mn};if(te&&Pe.canOverlap){oe=!0;const Vr=Oe.segments.get();for(const Jr of Vr)_e.push({segments:new l.aM([Jr]),sortKey:Jr.sortKey,state:Ha,terrainData:or})}else _e.push({segments:Oe.segments,sortKey:0,state:Ha,terrainData:or})}oe&&_e.sort(((Te,Se)=>Te.sortKey-Se.sortKey));for(const Te of _e){const Se=Te.state;if(O.activeTexture.set(U.TEXTURE0),Se.atlasTexture.bind(Se.atlasInterpolation,U.CLAMP_TO_EDGE),Se.atlasTextureIcon&&(O.activeTexture.set(U.TEXTURE1),Se.atlasTextureIcon&&Se.atlasTextureIcon.bind(Se.atlasInterpolationIcon,U.CLAMP_TO_EDGE)),Se.isSDF){const Pe=Se.uniformValues;Se.hasHalo&&(Pe.u_is_halo=1,Js(Se.buffers,Te.segments,s,g,Se.program,ce,I,D,Pe,Se.projectionData,Te.terrainData)),Pe.u_is_halo=0}Js(Se.buffers,Te.segments,s,g,Se.program,ce,I,D,Se.uniformValues,Se.projectionData,Te.terrainData)}}function Js(g,e,s,u,d,y,x,S,k,A,I){const D=u.context;d.draw(D,D.gl.TRIANGLES,y,x,S,ft.backCCW,k,I,A,s.id,g.layoutVertexBuffer,g.indexBuffer,e,s.paint,u.transform.zoom,g.programConfigurations.get(s.id),g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer)}function ih(g,e,s,u,d){const y=g.context,x=y.gl,S=Wt.disabled,k=new yr([x.ONE,x.ONE],l.bf.transparent,[!0,!0,!0,!0]),A=e.getBucket(s);if(!A)return;const I=u.key;let D=s.heatmapFbos.get(I);D||(D=Qs(y,e.tileSize,e.tileSize),s.heatmapFbos.set(I,D)),y.bindFramebuffer.set(D.framebuffer),y.viewport.set([0,0,e.tileSize,e.tileSize]),y.clear({color:l.bf.transparent});const L=A.programConfigurations.get(s.id),O=g.useProgram("heatmap",L,!d),U=g.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),K=g.style.map.terrain.getTerrainData(u);O.draw(y,x.TRIANGLES,wt.disabled,S,k,ft.disabled,Np(e,g.transform.zoom,s.paint.get("heatmap-intensity"),1),K,U,s.id,A.layoutVertexBuffer,A.indexBuffer,A.segments,s.paint,g.transform.zoom,L)}function od(g,e,s,u,d){const y=g.context,x=y.gl,S=g.transform;y.setColorMode(g.colorModeForRenderPass());const k=el(y,e),A=s.key,I=e.heatmapFbos.get(A);if(!I)return;y.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,I.colorAttachment.get()),y.activeTexture.set(x.TEXTURE1),k.bind(x.LINEAR,x.CLAMP_TO_EDGE);const D=S.getProjectionData({overscaledTileID:s,applyTerrainMatrix:d,applyGlobeMatrix:!u});g.useProgram("heatmapTexture").draw(y,x.TRIANGLES,wt.disabled,Wt.disabled,g.colorModeForRenderPass(),ft.disabled,Vu(g,e,0,1),null,D,e.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments,e.paint,S.zoom),I.destroy(),e.heatmapFbos.delete(A)}function Qs(g,e,s){var u,d;const y=g.gl,x=y.createTexture();y.bindTexture(y.TEXTURE_2D,x),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,y.LINEAR),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,y.LINEAR);const S=(u=g.HALF_FLOAT)!==null&&u!==void 0?u:y.UNSIGNED_BYTE,k=(d=g.RGBA16F)!==null&&d!==void 0?d:y.RGBA;y.texImage2D(y.TEXTURE_2D,0,k,e,s,0,y.RGBA,S,null);const A=g.createFramebuffer(e,s,!1,!1);return A.colorAttachment.set(x),A}function el(g,e){return e.colorRampTexture||(e.colorRampTexture=new l.T(g,e.colorRamp,g.gl.RGBA)),e.colorRampTexture}function tl(g,e,s,u,d){if(!s||!u||!u.imageAtlas)return;const y=u.imageAtlas.patternPositions;let x=y[s.to.toString()],S=y[s.from.toString()];if(!x&&S&&(x=S),!S&&x&&(S=x),!x||!S){const k=d.getPaintProperty(e);x=y[k],S=y[k]}x&&S&&g.setConstantPatternPositions(x,S)}function gc(g,e,s,u,d,y,x,S){const k=g.context.gl,A="fill-pattern",I=s.paint.get(A),D=I&&I.constantOr(1),L=s.getCrossfadeParameters();let O,U,K,X,Y;const ee=g.transform,ne=s.paint.get("fill-translate"),te=s.paint.get("fill-translate-anchor");x?(U=D&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",O=k.LINES):(U=D?"fillPattern":"fill",O=k.TRIANGLES);const oe=I.constantOr(null);for(const ce of u){const re=e.getTile(ce);if(D&&!re.patternsLoaded())continue;const _e=re.getBucket(s);if(!_e)continue;const Me=_e.programConfigurations.get(s.id),Te=g.useProgram(U,Me),Se=g.style.map.terrain&&g.style.map.terrain.getTerrainData(ce);D&&(g.context.activeTexture.set(k.TEXTURE0),re.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),Me.updatePaintBuffers(L)),tl(Me,A,oe,re,s);const Pe=ee.getProjectionData({overscaledTileID:ce,applyGlobeMatrix:!S,applyTerrainMatrix:!0}),Oe=l.aD(ee,re,ne,te);if(x){X=_e.indexBuffer2,Y=_e.segments2;const Le=[k.drawingBufferWidth,k.drawingBufferHeight];K=U==="fillOutlinePattern"&&D?Gs(g,L,re,Le,Oe):qs(Le,Oe)}else X=_e.indexBuffer,Y=_e.segments,K=D?ac(g,L,re,Oe):{u_fill_translate:Oe};const Ne=g.stencilModeForClipping(ce);Te.draw(g.context,O,d,Ne,y,ft.backCCW,K,Se,Pe,s.id,_e.layoutVertexBuffer,X,Y,s.paint,g.transform.zoom,Me)}}function nh(g,e,s,u,d,y,x,S){const k=g.context,A=k.gl,I="fill-extrusion-pattern",D=s.paint.get(I),L=D.constantOr(1),O=s.getCrossfadeParameters(),U=s.paint.get("fill-extrusion-opacity"),K=D.constantOr(null),X=g.transform;for(const Y of u){const ee=e.getTile(Y),ne=ee.getBucket(s);if(!ne)continue;const te=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Y),oe=ne.programConfigurations.get(s.id),ce=g.useProgram(L?"fillExtrusionPattern":"fillExtrusion",oe);L&&(g.context.activeTexture.set(A.TEXTURE0),ee.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),oe.updatePaintBuffers(O));const re=X.getProjectionData({overscaledTileID:Y,applyGlobeMatrix:!S,applyTerrainMatrix:!0});tl(oe,I,K,ee,s);const _e=l.aD(X,ee,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Me=s.paint.get("fill-extrusion-vertical-gradient"),Te=L?_m(g,Me,U,_e,Y,O,ee):xn(g,Me,U,_e);ce.draw(k,k.gl.TRIANGLES,d,y,x,ft.backCCW,Te,te,re,s.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,s.paint,g.transform.zoom,oe,g.style.map.terrain&&ne.centroidVertexBuffer)}}function wo(g,e,s,u,d,y,x,S,k){var A;const I=g.style.projection,D=g.context,L=g.transform,O=D.gl,U=[`#define NUM_ILLUMINATION_SOURCES ${s.paint.get("hillshade-highlight-color").values.length}`],K=g.useProgram("hillshade",null,!1,U),X=!g.options.moving;for(const Y of u){const ee=e.getTile(Y),ne=ee.fbo;if(!ne)continue;const te=I.getMeshFromTileID(D,Y.canonical,S,!0,"raster"),oe=(A=g.style.map.terrain)===null||A===void 0?void 0:A.getTerrainData(Y);D.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,ne.colorAttachment.get());const ce=L.getProjectionData({overscaledTileID:Y,aligned:X,applyGlobeMatrix:!k,applyTerrainMatrix:!0});K.draw(D,O.TRIANGLES,y,d[Y.overscaledZ],x,ft.backCCW,xm(g,ee,s),oe,ce,s.id,te.vertexBuffer,te.indexBuffer,te.segments)}}function ah(g,e,s,u,d,y,x,S,k){var A;const I=g.style.projection,D=g.context,L=g.transform,O=D.gl,U=g.useProgram("colorRelief"),K=!g.options.moving;let X=!0,Y=0;for(const ee of u){const ne=e.getTile(ee),te=ne.dem;if(X){const Te=O.getParameter(O.MAX_TEXTURE_SIZE),{elevationTexture:Se,colorTexture:Pe}=s.getColorRampTextures(D,Te,te.getUnpackVector());D.activeTexture.set(O.TEXTURE1),Se.bind(O.NEAREST,O.CLAMP_TO_EDGE),D.activeTexture.set(O.TEXTURE4),Pe.bind(O.LINEAR,O.CLAMP_TO_EDGE),X=!1,Y=Se.size[0]}if(!te||!te.data)continue;const oe=te.stride,ce=te.getPixels();if(D.activeTexture.set(O.TEXTURE0),D.pixelStoreUnpackPremultiplyAlpha.set(!1),ne.demTexture=ne.demTexture||g.getTileTexture(oe),ne.demTexture){const Te=ne.demTexture;Te.update(ce,{premultiply:!1}),Te.bind(O.LINEAR,O.CLAMP_TO_EDGE)}else ne.demTexture=new l.T(D,ce,O.RGBA,{premultiply:!1}),ne.demTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE);const re=I.getMeshFromTileID(D,ee.canonical,S,!0,"raster"),_e=(A=g.style.map.terrain)===null||A===void 0?void 0:A.getTerrainData(ee),Me=L.getProjectionData({overscaledTileID:ee,aligned:K,applyGlobeMatrix:!k,applyTerrainMatrix:!0});U.draw(D,O.TRIANGLES,y,d[ee.overscaledZ],x,ft.backCCW,Vp(s,ne.dem,Y),_e,Me,s.id,re.vertexBuffer,re.indexBuffer,re.segments)}}const yc=[new l.P(0,0),new l.P(l.$,0),new l.P(l.$,l.$),new l.P(0,l.$)];function To(g,e,s,u,d,y,x,S,k=!1,A=!1){const I=u[u.length-1].overscaledZ,D=g.context,L=D.gl,O=g.useProgram("raster"),U=g.transform,K=g.style.projection,X=g.colorModeForRenderPass(),Y=!g.options.moving;for(const ee of u){const ne=g.getDepthModeForSublayer(ee.overscaledZ-I,s.paint.get("raster-opacity")===1?wt.ReadWrite:wt.ReadOnly,L.LESS),te=e.getTile(ee);te.registerFadeDuration(s.paint.get("raster-fade-duration"));const oe=e.findLoadedParent(ee,0),ce=e.findLoadedSibling(ee),re=oh(te,oe||ce||null,e,s,g.transform,g.style.map.terrain);let _e,Me;const Te=s.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;D.activeTexture.set(L.TEXTURE0),te.texture.bind(Te,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),D.activeTexture.set(L.TEXTURE1),oe?(oe.texture.bind(Te,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),_e=Math.pow(2,oe.tileID.overscaledZ-te.tileID.overscaledZ),Me=[te.tileID.canonical.x*_e%1,te.tileID.canonical.y*_e%1]):te.texture.bind(Te,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),te.texture.useMipmap&&D.extTextureFilterAnisotropic&&g.transform.pitch>20&&L.texParameterf(L.TEXTURE_2D,D.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,D.extTextureFilterAnisotropicMax);const Se=g.style.map.terrain&&g.style.map.terrain.getTerrainData(ee),Pe=U.getProjectionData({overscaledTileID:ee,aligned:Y,applyGlobeMatrix:!A,applyTerrainMatrix:!0}),Oe=Zs(Me||[0,0],_e||1,re,s,S),Ne=K.getMeshFromTileID(D,ee.canonical,y,x,"raster");O.draw(D,L.TRIANGLES,ne,d?d[ee.overscaledZ]:Wt.disabled,X,k?ft.frontCCW:ft.backCCW,Oe,Se,Pe,s.id,Ne.vertexBuffer,Ne.indexBuffer,Ne.segments)}}function oh(g,e,s,u,d,y){const x=u.paint.get("raster-fade-duration");if(!y&&x>0){const S=G.now(),k=(S-g.timeAdded)/x,A=e?(S-e.timeAdded)/x:-1,I=s.getSource(),D=at(d,{tileSize:I.tileSize,roundZoom:I.roundZoom}),L=!e||Math.abs(e.tileID.overscaledZ-D)>Math.abs(g.tileID.overscaledZ-D),O=L&&g.refreshedUponExpiration?1:l.ah(L?k:1-A,0,1);return g.refreshedUponExpiration&&k>=1&&(g.refreshedUponExpiration=!1),e?{opacity:1,mix:1-O}:{opacity:O,mix:0}}return{opacity:1,mix:0}}const sd=new l.bf(1,0,0,1),ld=new l.bf(0,1,0,1),_c=new l.bf(0,0,1,1),sh=new l.bf(1,0,1,1),zm=new l.bf(0,1,1,1);function lh(g,e,s,u){Kn(g,0,e+s/2,g.transform.width,s,u)}function kr(g,e,s,u){Kn(g,e-s/2,0,s,g.transform.height,u)}function Kn(g,e,s,u,d,y){const x=g.context,S=x.gl;S.enable(S.SCISSOR_TEST),S.scissor(e*g.pixelRatio,s*g.pixelRatio,u*g.pixelRatio,d*g.pixelRatio),x.clear({color:y}),S.disable(S.SCISSOR_TEST)}function hn(g,e,s){const u=g.context,d=u.gl,y=g.useProgram("debug"),x=wt.disabled,S=Wt.disabled,k=g.colorModeForRenderPass(),A="$debug",I=g.style.map.terrain&&g.style.map.terrain.getTerrainData(s);u.activeTexture.set(d.TEXTURE0);const D=e.getTileByID(s.key).latestRawTileData,L=Math.floor((D&&D.byteLength||0)/1024),O=e.getTile(s).tileSize,U=512/Math.min(O,512)*(s.overscaledZ/g.transform.zoom)*.5;let K=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(K+=` => ${s.overscaledZ}`),(function(Y,ee){Y.initDebugOverlayCanvas();const ne=Y.debugOverlayCanvas,te=Y.context.gl,oe=Y.debugOverlayCanvas.getContext("2d");oe.clearRect(0,0,ne.width,ne.height),oe.shadowColor="white",oe.shadowBlur=2,oe.lineWidth=1.5,oe.strokeStyle="white",oe.textBaseline="top",oe.font="bold 36px Open Sans, sans-serif",oe.fillText(ee,5,5),oe.strokeText(ee,5,5),Y.debugOverlayTexture.update(ne),Y.debugOverlayTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE)})(g,`${K} ${L}kB`);const X=g.transform.getProjectionData({overscaledTileID:s,applyGlobeMatrix:!0,applyTerrainMatrix:!0});y.draw(u,d.TRIANGLES,x,S,yr.alphaBlended,ft.disabled,yo(l.bf.transparent,U),null,X,A,g.debugBuffer,g.quadTriangleIndexBuffer,g.debugSegments),y.draw(u,d.LINE_STRIP,x,S,k,ft.disabled,yo(l.bf.red),I,X,A,g.debugBuffer,g.tileBorderIndexBuffer,g.debugSegments)}function vc(g,e,s,u){const{isRenderingGlobe:d}=u,y=g.context,x=y.gl,S=g.transform,k=g.colorModeForRenderPass(),A=g.getDepthModeFor3D(),I=g.useProgram("terrain");y.bindFramebuffer.set(null),y.viewport.set([0,0,g.width,g.height]);for(const D of s){const L=e.getTerrainMesh(D.tileID),O=g.renderToTexture.getTexture(D),U=e.getTerrainData(D.tileID);y.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,O.texture);const K=e.getMeshFrameDelta(S.zoom),X=S.calculateFogMatrix(D.tileID.toUnwrapped()),Y=ic(K,X,g.style.sky,S.pitch,d),ee=S.getProjectionData({overscaledTileID:D.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});I.draw(y,x.TRIANGLES,A,Wt.disabled,k,ft.backCCW,Y,U,ee,"terrain",L.vertexBuffer,L.indexBuffer,L.segments)}}function rl(g,e){if(!e.mesh){const s=new l.aL;s.emplaceBack(-1,-1),s.emplaceBack(1,-1),s.emplaceBack(1,1),s.emplaceBack(-1,1);const u=new l.aN;u.emplaceBack(0,1,2),u.emplaceBack(0,2,3),e.mesh=new uo(g.createVertexBuffer(s,Ua.members),g.createIndexBuffer(u),l.aM.simpleSegment(0,0,s.length,u.length))}return e.mesh}class cd{constructor(e,s){this.context=new id(e),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.ag(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=zt.maxUnderzooming+zt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Qo}resize(e,s,u){if(this.width=Math.floor(e*u),this.height=Math.floor(s*u),this.pixelRatio=u,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style._order)this.style._layers[d].resize()}setup(){const e=this.context,s=new l.aL;s.emplaceBack(0,0),s.emplaceBack(l.$,0),s.emplaceBack(0,l.$),s.emplaceBack(l.$,l.$),this.tileExtentBuffer=e.createVertexBuffer(s,Ua.members),this.tileExtentSegments=l.aM.simpleSegment(0,0,4,2);const u=new l.aL;u.emplaceBack(0,0),u.emplaceBack(l.$,0),u.emplaceBack(0,l.$),u.emplaceBack(l.$,l.$),this.debugBuffer=e.createVertexBuffer(u,Ua.members),this.debugSegments=l.aM.simpleSegment(0,0,4,5);const d=new l.c6;d.emplaceBack(0,0,0,0),d.emplaceBack(l.$,0,l.$,0),d.emplaceBack(0,l.$,0,l.$),d.emplaceBack(l.$,l.$,l.$,l.$),this.rasterBoundsBuffer=e.createVertexBuffer(d,gm.members),this.rasterBoundsSegments=l.aM.simpleSegment(0,0,4,2);const y=new l.aL;y.emplaceBack(0,0),y.emplaceBack(l.$,0),y.emplaceBack(0,l.$),y.emplaceBack(l.$,l.$),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(y,Ua.members),this.rasterBoundsSegmentsPosOnly=l.aM.simpleSegment(0,0,4,5);const x=new l.aL;x.emplaceBack(0,0),x.emplaceBack(1,0),x.emplaceBack(0,1),x.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(x,Ua.members),this.viewportSegments=l.aM.simpleSegment(0,0,4,2);const S=new l.c7;S.emplaceBack(0),S.emplaceBack(1),S.emplaceBack(3),S.emplaceBack(2),S.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(S);const k=new l.aN;k.emplaceBack(1,0,2),k.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(k);const A=this.context.gl;this.stencilClearMode=new Wt({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.tileExtentMesh=new uo(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,s=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const u=l.L();l.bY(u,0,this.width,this.height,0,0,1),l.N(u,u,[s.drawingBufferWidth,s.drawingBufferHeight,0]);const d={mainMatrix:u,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:u};this.useProgram("clippingMask",null,!0).draw(e,s.TRIANGLES,wt.disabled,this.stencilClearMode,yr.disabled,ft.disabled,null,null,d,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,s,u){if(this.currentStencilSource===e.source||!e.isTileClipped()||!s||!s.length)return;this.currentStencilSource=e.source,this.nextStencilID+s.length>256&&this.clearStencil();const d=this.context;d.setColorMode(yr.disabled),d.setDepthMode(wt.disabled);const y={};for(const x of s)y[x.key]=this.nextStencilID++;this._renderTileMasks(y,s,u,!0),this._renderTileMasks(y,s,u,!1),this._tileClippingMaskIDs=y}_renderTileMasks(e,s,u,d){const y=this.context,x=y.gl,S=this.style.projection,k=this.transform,A=this.useProgram("clippingMask");for(const I of s){const D=e[I.key],L=this.style.map.terrain&&this.style.map.terrain.getTerrainData(I),O=S.getMeshFromTileID(this.context,I.canonical,d,!0,"stencil"),U=k.getProjectionData({overscaledTileID:I,applyGlobeMatrix:!u,applyTerrainMatrix:!0});A.draw(y,x.TRIANGLES,wt.disabled,new Wt({func:x.ALWAYS,mask:0},D,255,x.KEEP,x.KEEP,x.REPLACE),yr.disabled,u?ft.disabled:ft.backCCW,null,L,U,"$clipping",O.vertexBuffer,O.indexBuffer,O.segments)}}_renderTilesDepthBuffer(){const e=this.context,s=e.gl,u=this.style.projection,d=this.transform,y=this.useProgram("depth"),x=this.getDepthModeFor3D(),S=be(d,{tileSize:d.tileSize});for(const k of S){const A=this.style.map.terrain&&this.style.map.terrain.getTerrainData(k),I=u.getMeshFromTileID(this.context,k.canonical,!0,!0,"raster"),D=d.getProjectionData({overscaledTileID:k,applyGlobeMatrix:!0,applyTerrainMatrix:!0});y.draw(e,s.TRIANGLES,x,Wt.disabled,yr.disabled,ft.backCCW,null,A,D,"$clipping",I.vertexBuffer,I.indexBuffer,I.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,s=this.context.gl;return new Wt({func:s.NOTEQUAL,mask:255},e,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(e){const s=this.context.gl;return new Wt({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,s.KEEP,s.KEEP,s.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const s=this.context.gl,u=e.sort(((x,S)=>S.overscaledZ-x.overscaledZ)),d=u[u.length-1].overscaledZ,y=u[0].overscaledZ-d+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const x={};for(let S=0;S<y;S++)x[S+d]=new Wt({func:s.GEQUAL,mask:255},S+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=y,[x,u]}return[{[d]:Wt.disabled},u]}stencilConfigForOverlapTwoPass(e){const s=this.context.gl,u=e.sort(((x,S)=>S.overscaledZ-x.overscaledZ)),d=u[u.length-1].overscaledZ,y=u[0].overscaledZ-d+1;if(this.clearStencil(),y>1){const x={},S={};for(let k=0;k<y;k++)x[k+d]=new Wt({func:s.GREATER,mask:255},y+1+k,255,s.KEEP,s.KEEP,s.REPLACE),S[k+d]=new Wt({func:s.GREATER,mask:255},1+k,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID=2*y+1,[x,S,u]}return this.nextStencilID=3,[{[d]:new Wt({func:s.GREATER,mask:255},2,255,s.KEEP,s.KEEP,s.REPLACE)},{[d]:new Wt({func:s.GREATER,mask:255},1,255,s.KEEP,s.KEEP,s.REPLACE)},u]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new yr([e.CONSTANT_COLOR,e.ONE],new l.bf(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?yr.unblended:yr.alphaBlended}getDepthModeForSublayer(e,s,u){if(!this.opaquePassEnabledForLayer())return wt.disabled;const d=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new wt(u||this.context.gl.LEQUAL,s,[d,d])}getDepthModeFor3D(){return new wt(this.context.gl.LEQUAL,wt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,s){var u,d;this.style=e,this.options=s,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(G.now()),this.imageManager.beginFrame();const y=this.style._order,x=this.style.sourceCaches,S={},k={},A={},I={isRenderingToTexture:!1,isRenderingGlobe:((u=e.projection)===null||u===void 0?void 0:u.transitionState)>0};for(const L in x){const O=x[L];O.used&&O.prepare(this.context),S[L]=O.getVisibleCoordinates(!1),k[L]=S[L].slice().reverse(),A[L]=O.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let L=0;L<y.length;L++)if(this.style._layers[y[L]].is3D()){this.opaquePassCutoff=L;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const L of y){const O=this.style._layers[L];if(!O.hasOffscreenPass()||O.isHidden(this.transform.zoom))continue;const U=k[O.source];(O.type==="custom"||U.length)&&this.renderLayer(this,x[O.source],O,U,I)}if((d=this.style.projection)===null||d===void 0||d.updateGPUdependent({context:this.context,useProgram:L=>this.useProgram(L)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?l.bf.black:l.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(L,O){const U=L.context,K=U.gl,X=((ce,re,_e)=>{const Me=Math.cos(re.rollInRadians),Te=Math.sin(re.rollInRadians),Se=ue(re),Pe=re.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:ce.properties.get("sky-color"),u_horizon_color:ce.properties.get("horizon-color"),u_horizon:[(re.width/2-Se*Te)*_e,(re.height/2+Se*Me)*_e],u_horizon_normal:[-Te,Me],u_sky_horizon_blend:ce.properties.get("sky-horizon-blend")*re.height/2*_e,u_sky_blend:Pe}})(O,L.style.map.transform,L.pixelRatio),Y=new wt(K.LEQUAL,wt.ReadWrite,[0,1]),ee=Wt.disabled,ne=L.colorModeForRenderPass(),te=L.useProgram("sky"),oe=rl(U,O);te.draw(U,K.TRIANGLES,Y,ee,ne,ft.disabled,X,null,void 0,"sky",oe.vertexBuffer,oe.indexBuffer,oe.segments)})(this,this.style.sky),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){const L=this.style._layers[y[this.currentLayer]],O=x[L.source],U=S[L.source];this._renderTileClippingMasks(L,U,!1),this.renderLayer(this,O,L,U,I)}this.renderPass="translucent";let D=!1;for(this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){const L=this.style._layers[y[this.currentLayer]],O=x[L.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(L,I))continue;this.opaquePassEnabledForLayer()||D||(D=!0,I.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const U=(L.type==="symbol"?A:k)[L.source];this._renderTileClippingMasks(L,S[L.source],!!this.renderToTexture),this.renderLayer(this,O,L,U,I)}if(I.isRenderingGlobe&&(function(L,O,U){const K=L.context,X=K.gl,Y=L.useProgram("atmosphere"),ee=new wt(X.LEQUAL,wt.ReadOnly,[0,1]),ne=L.transform,te=(function(Pe,Oe){const Ne=Pe.properties.get("position"),Le=[-Ne.x,-Ne.y,-Ne.z],it=l.ag(new Float64Array(16));return Pe.properties.get("anchor")==="map"&&(l.b6(it,it,Oe.rollInRadians),l.b7(it,it,-Oe.pitchInRadians),l.b6(it,it,Oe.bearingInRadians),l.b7(it,it,Oe.center.lat*Math.PI/180),l.bz(it,it,-Oe.center.lng*Math.PI/180)),l.c5(Le,Le,it),Le})(U,L.transform),oe=ne.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ce=O.properties.get("atmosphere-blend")*oe.projectionTransition;if(ce===0)return;const re=ts(ne.worldSize,ne.center.lat),_e=ne.inverseProjectionMatrix,Me=new Float64Array(4);Me[3]=1,l.aw(Me,Me,ne.modelViewProjectionMatrix),Me[0]/=Me[3],Me[1]/=Me[3],Me[2]/=Me[3],Me[3]=1,l.aw(Me,Me,_e),Me[0]/=Me[3],Me[1]/=Me[3],Me[2]/=Me[3],Me[3]=1;const Te=((Pe,Oe,Ne,Le,it)=>({u_sun_pos:Pe,u_atmosphere_blend:Oe,u_globe_position:Ne,u_globe_radius:Le,u_inv_proj_matrix:it}))(te,ce,[Me[0],Me[1],Me[2]],re,_e),Se=rl(K,O);Y.draw(K,X.TRIANGLES,ee,Wt.disabled,yr.alphaBlended,ft.disabled,Te,null,null,"atmosphere",Se.vertexBuffer,Se.indexBuffer,Se.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const L=(function(O,U){let K=null;const X=Object.values(O._layers).flatMap((te=>te.source&&!te.isHidden(U)?[O.sourceCaches[te.source]]:[])),Y=X.filter((te=>te.getSource().type==="vector")),ee=X.filter((te=>te.getSource().type!=="vector")),ne=te=>{(!K||K.getSource().maxzoom<te.getSource().maxzoom)&&(K=te)};return Y.forEach((te=>ne(te))),K||ee.forEach((te=>ne(te))),K})(this.style,this.transform.zoom);L&&(function(O,U,K){for(let X=0;X<K.length;X++)hn(O,U,K[X])})(this,L,L.getVisibleCoordinates())}this.options.showPadding&&(function(L){const O=L.transform.padding;lh(L,L.transform.height-(O.top||0),3,sd),lh(L,O.bottom||0,3,ld),kr(L,O.left||0,3,_c),kr(L,L.transform.width-(O.right||0),3,sh);const U=L.transform.centerPoint;(function(K,X,Y,ee){Kn(K,X-1,Y-10,2,20,ee),Kn(K,X-10,Y-1,20,2,ee)})(L,U.x,L.transform.height-U.y,zm)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const s=this.terrainFacilitator.matrix,u=this.transform.modelViewProjectionMatrix;let d=this.terrainFacilitator.dirty;d||(d=e?!l.c8(s,u):!l.c9(s,u)),d||(d=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),d&&(l.ca(s,u),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(y,x){const S=y.context,k=S.gl,A=y.transform,I=yr.unblended,D=new wt(k.LEQUAL,wt.ReadWrite,[0,1]),L=x.sourceCache.getRenderableTiles(),O=y.useProgram("terrainDepth");S.bindFramebuffer.set(x.getFramebuffer("depth").framebuffer),S.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),S.clear({color:l.bf.transparent,depth:1});for(const U of L){const K=x.getTerrainMesh(U.tileID),X=x.getTerrainData(U.tileID),Y=A.getProjectionData({overscaledTileID:U.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),ee={u_ele_delta:x.getMeshFrameDelta(A.zoom)};O.draw(S,k.TRIANGLES,D,Wt.disabled,I,ft.backCCW,ee,X,Y,"terrain",K.vertexBuffer,K.indexBuffer,K.segments)}S.bindFramebuffer.set(null),S.viewport.set([0,0,y.width,y.height])})(this,this.style.map.terrain),(function(y,x){const S=y.context,k=S.gl,A=y.transform,I=yr.unblended,D=new wt(k.LEQUAL,wt.ReadWrite,[0,1]),L=x.getCoordsTexture(),O=x.sourceCache.getRenderableTiles(),U=y.useProgram("terrainCoords");S.bindFramebuffer.set(x.getFramebuffer("coords").framebuffer),S.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),S.clear({color:l.bf.transparent,depth:1}),x.coordsIndex=[];for(const K of O){const X=x.getTerrainMesh(K.tileID),Y=x.getTerrainData(K.tileID);S.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,L.texture);const ee={u_terrain_coords_id:(255-x.coordsIndex.length)/255,u_texture:0,u_ele_delta:x.getMeshFrameDelta(A.zoom)},ne=A.getProjectionData({overscaledTileID:K.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});U.draw(S,k.TRIANGLES,D,Wt.disabled,I,ft.backCCW,ee,Y,ne,"terrain",X.vertexBuffer,X.indexBuffer,X.segments),x.coordsIndex.push(K.tileID.key)}S.bindFramebuffer.set(null),S.viewport.set([0,0,y.width,y.height])})(this,this.style.map.terrain))}renderLayer(e,s,u,d,y){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="custom"||(d||[]).length)&&(this.id=u.id,l.cb(u)?(function(x,S,k,A,I,D){if(x.renderPass!=="translucent")return;const{isRenderingToTexture:L}=D,O=Wt.disabled,U=x.colorModeForRenderPass();(k._unevaluatedLayout.hasValue("text-variable-anchor")||k._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(K,X,Y,ee,ne,te,oe,ce,re){const _e=X.transform,Me=X.style.map.terrain,Te=ne==="map",Se=te==="map";for(const Pe of K){const Oe=ee.getTile(Pe),Ne=Oe.getBucket(Y);if(!Ne||!Ne.text||!Ne.text.segments.get().length)continue;const Le=l.an(Ne.textSizeData,_e.zoom),it=l.aC(Oe,1,X.transform.zoom),Pt=Dr(Te,X.transform,it),tr=Y.layout.get("icon-text-fit")!=="none"&&Ne.hasIconData();if(Le){const lr=Math.pow(2,_e.zoom-Oe.tileID.overscaledZ),or=Me?(xr,Cr)=>Me.getElevation(Pe,xr,Cr):null;rh(Ne,Te,Se,re,_e,Pt,lr,Le,tr,l.aD(_e,Oe,oe,ce),Pe.toUnwrapped(),or)}}})(A,x,k,S,k.layout.get("text-rotation-alignment"),k.layout.get("text-pitch-alignment"),k.paint.get("text-translate"),k.paint.get("text-translate-anchor"),I),k.paint.get("icon-opacity").constantOr(1)!==0&&Ys(x,S,k,A,!1,k.paint.get("icon-translate"),k.paint.get("icon-translate-anchor"),k.layout.get("icon-rotation-alignment"),k.layout.get("icon-pitch-alignment"),k.layout.get("icon-keep-upright"),O,U,L),k.paint.get("text-opacity").constantOr(1)!==0&&Ys(x,S,k,A,!0,k.paint.get("text-translate"),k.paint.get("text-translate-anchor"),k.layout.get("text-rotation-alignment"),k.layout.get("text-pitch-alignment"),k.layout.get("text-keep-upright"),O,U,L),S.map.showCollisionBoxes&&(nd(x,S,k,A,!0),nd(x,S,k,A,!1))})(e,s,u,d,this.style.placement.variableOffsets,y):l.cc(u)?(function(x,S,k,A,I){if(x.renderPass!=="translucent")return;const{isRenderingToTexture:D}=I,L=k.paint.get("circle-opacity"),O=k.paint.get("circle-stroke-width"),U=k.paint.get("circle-stroke-opacity"),K=!k.layout.get("circle-sort-key").isConstant();if(L.constantOr(1)===0&&(O.constantOr(1)===0||U.constantOr(1)===0))return;const X=x.context,Y=X.gl,ee=x.transform,ne=x.getDepthModeForSublayer(0,wt.ReadOnly),te=Wt.disabled,oe=x.colorModeForRenderPass(),ce=[],re=ee.getCircleRadiusCorrection();for(let _e=0;_e<A.length;_e++){const Me=A[_e],Te=S.getTile(Me),Se=Te.getBucket(k);if(!Se)continue;const Pe=k.paint.get("circle-translate"),Oe=k.paint.get("circle-translate-anchor"),Ne=l.aD(ee,Te,Pe,Oe),Le=Se.programConfigurations.get(k.id),it=x.useProgram("circle",Le),Pt=Se.layoutVertexBuffer,tr=Se.indexBuffer,lr=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Me),or={programConfiguration:Le,program:it,layoutVertexBuffer:Pt,indexBuffer:tr,uniformValues:vm(x,Te,k,Ne,re),terrainData:lr,projectionData:ee.getProjectionData({overscaledTileID:Me,applyGlobeMatrix:!D,applyTerrainMatrix:!0})};if(K){const xr=Se.segments.get();for(const Cr of xr)ce.push({segments:new l.aM([Cr]),sortKey:Cr.sortKey,state:or})}else ce.push({segments:Se.segments,sortKey:0,state:or})}K&&ce.sort(((_e,Me)=>_e.sortKey-Me.sortKey));for(const _e of ce){const{programConfiguration:Me,program:Te,layoutVertexBuffer:Se,indexBuffer:Pe,uniformValues:Oe,terrainData:Ne,projectionData:Le}=_e.state;Te.draw(X,Y.TRIANGLES,ne,te,oe,ft.backCCW,Oe,Ne,Le,k.id,Se,Pe,_e.segments,k.paint,x.transform.zoom,Me)}})(e,s,u,d,y):l.cd(u)?(function(x,S,k,A,I){if(k.paint.get("heatmap-opacity")===0)return;const D=x.context,{isRenderingToTexture:L,isRenderingGlobe:O}=I;if(x.style.map.terrain){for(const U of A){const K=S.getTile(U);S.hasRenderableParent(U)||(x.renderPass==="offscreen"?ih(x,K,k,U,O):x.renderPass==="translucent"&&od(x,k,U,L,O))}D.viewport.set([0,0,x.width,x.height])}else x.renderPass==="offscreen"?(function(U,K,X,Y){const ee=U.context,ne=ee.gl,te=U.transform,oe=Wt.disabled,ce=new yr([ne.ONE,ne.ONE],l.bf.transparent,[!0,!0,!0,!0]);(function(re,_e,Me){const Te=re.gl;re.activeTexture.set(Te.TEXTURE1),re.viewport.set([0,0,_e.width/4,_e.height/4]);let Se=Me.heatmapFbos.get(l.c2);Se?(Te.bindTexture(Te.TEXTURE_2D,Se.colorAttachment.get()),re.bindFramebuffer.set(Se.framebuffer)):(Se=Qs(re,_e.width/4,_e.height/4),Me.heatmapFbos.set(l.c2,Se))})(ee,U,X),ee.clear({color:l.bf.transparent});for(let re=0;re<Y.length;re++){const _e=Y[re];if(K.hasRenderableParent(_e))continue;const Me=K.getTile(_e),Te=Me.getBucket(X);if(!Te)continue;const Se=Te.programConfigurations.get(X.id),Pe=U.useProgram("heatmap",Se),Oe=te.getProjectionData({overscaledTileID:_e,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Ne=te.getCircleRadiusCorrection();Pe.draw(ee,ne.TRIANGLES,wt.disabled,oe,ce,ft.backCCW,Np(Me,te.zoom,X.paint.get("heatmap-intensity"),Ne),null,Oe,X.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segments,X.paint,te.zoom,Se)}ee.viewport.set([0,0,U.width,U.height])})(x,S,k,A):x.renderPass==="translucent"&&(function(U,K){const X=U.context,Y=X.gl;X.setColorMode(U.colorModeForRenderPass());const ee=K.heatmapFbos.get(l.c2);ee&&(X.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_2D,ee.colorAttachment.get()),X.activeTexture.set(Y.TEXTURE1),el(X,K).bind(Y.LINEAR,Y.CLAMP_TO_EDGE),U.useProgram("heatmapTexture").draw(X,Y.TRIANGLES,wt.disabled,Wt.disabled,U.colorModeForRenderPass(),ft.disabled,Vu(U,K,0,1),null,null,K.id,U.viewportBuffer,U.quadTriangleIndexBuffer,U.viewportSegments,K.paint,U.transform.zoom))})(x,k)})(e,s,u,d,y):l.ce(u)?(function(x,S,k,A,I){if(x.renderPass!=="translucent")return;const{isRenderingToTexture:D}=I,L=k.paint.get("line-opacity"),O=k.paint.get("line-width");if(L.constantOr(1)===0||O.constantOr(1)===0)return;const U=x.getDepthModeForSublayer(0,wt.ReadOnly),K=x.colorModeForRenderPass(),X=k.paint.get("line-dasharray"),Y=k.paint.get("line-pattern"),ee=Y.constantOr(1),ne=k.paint.get("line-gradient"),te=k.getCrossfadeParameters(),oe=ee?"linePattern":X?"lineSDF":ne?"lineGradient":"line",ce=x.context,re=ce.gl,_e=x.transform;let Me=!0;for(const Te of A){const Se=S.getTile(Te);if(ee&&!Se.patternsLoaded())continue;const Pe=Se.getBucket(k);if(!Pe)continue;const Oe=Pe.programConfigurations.get(k.id),Ne=x.context.program.get(),Le=x.useProgram(oe,Oe),it=Me||Le.program!==Ne,Pt=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Te),tr=Y.constantOr(null);if(tr&&Se.imageAtlas){const kt=Se.imageAtlas,cr=kt.patternPositions[tr.to.toString()],Ur=kt.patternPositions[tr.from.toString()];cr&&Ur&&Oe.setConstantPatternPositions(cr,Ur)}const lr=_e.getProjectionData({overscaledTileID:Te,applyGlobeMatrix:!D,applyTerrainMatrix:!0}),or=_e.getPixelScale(),xr=ee?Gp(x,Se,k,or,te):X?_o(x,Se,k,or,X,te):ne?qp(x,Se,k,or,Pe.lineClipsArray.length):sc(x,Se,k,or);if(ee)ce.activeTexture.set(re.TEXTURE0),Se.imageAtlasTexture.bind(re.LINEAR,re.CLAMP_TO_EDGE),Oe.updatePaintBuffers(te);else if(X&&(it||x.lineAtlas.dirty))ce.activeTexture.set(re.TEXTURE0),x.lineAtlas.bind(ce);else if(ne){const kt=Pe.gradients[k.id];let cr=kt.texture;if(k.gradientVersion!==kt.version){let Ur=256;if(k.stepInterpolant){const Yr=S.getSource().maxzoom,ni=Te.canonical.z===Yr?Math.ceil(1<<x.transform.maxZoom-Te.canonical.z):1;Ur=l.ah(l.c3(Pe.maxLineLength/l.$*1024*ni),256,ce.maxTextureSize)}kt.gradient=l.c4({expression:k.gradientExpression(),evaluationKey:"lineProgress",resolution:Ur,image:kt.gradient||void 0,clips:Pe.lineClipsArray}),kt.texture?kt.texture.update(kt.gradient):kt.texture=new l.T(ce,kt.gradient,re.RGBA),kt.version=k.gradientVersion,cr=kt.texture}ce.activeTexture.set(re.TEXTURE0),cr.bind(k.stepInterpolant?re.NEAREST:re.LINEAR,re.CLAMP_TO_EDGE)}const Cr=x.stencilModeForClipping(Te);Le.draw(ce,re.TRIANGLES,U,Cr,K,ft.disabled,xr,Pt,lr,k.id,Pe.layoutVertexBuffer,Pe.indexBuffer,Pe.segments,k.paint,x.transform.zoom,Oe,Pe.layoutVertexBuffer2),Me=!1}})(e,s,u,d,y):l.cf(u)?(function(x,S,k,A,I){const D=k.paint.get("fill-color"),L=k.paint.get("fill-opacity");if(L.constantOr(1)===0)return;const{isRenderingToTexture:O}=I,U=x.colorModeForRenderPass(),K=k.paint.get("fill-pattern"),X=x.opaquePassEnabledForLayer()&&!K.constantOr(1)&&D.constantOr(l.bf.transparent).a===1&&L.constantOr(0)===1?"opaque":"translucent";if(x.renderPass===X){const Y=x.getDepthModeForSublayer(1,x.renderPass==="opaque"?wt.ReadWrite:wt.ReadOnly);gc(x,S,k,A,Y,U,!1,O)}if(x.renderPass==="translucent"&&k.paint.get("fill-antialias")){const Y=x.getDepthModeForSublayer(k.getPaintProperty("fill-outline-color")?2:0,wt.ReadOnly);gc(x,S,k,A,Y,U,!0,O)}})(e,s,u,d,y):l.cg(u)?(function(x,S,k,A,I){const D=k.paint.get("fill-extrusion-opacity");if(D===0)return;const{isRenderingToTexture:L}=I;if(x.renderPass==="translucent"){const O=new wt(x.context.gl.LEQUAL,wt.ReadWrite,x.depthRangeFor3D);if(D!==1||k.paint.get("fill-extrusion-pattern").constantOr(1))nh(x,S,k,A,O,Wt.disabled,yr.disabled,L),nh(x,S,k,A,O,x.stencilModeFor3D(),x.colorModeForRenderPass(),L);else{const U=x.colorModeForRenderPass();nh(x,S,k,A,O,Wt.disabled,U,L)}}})(e,s,u,d,y):l.ch(u)?(function(x,S,k,A,I){if(x.renderPass!=="offscreen"&&x.renderPass!=="translucent")return;const{isRenderingToTexture:D}=I,L=x.context,O=x.style.projection.useSubdivision,U=x.getDepthModeForSublayer(0,wt.ReadOnly),K=x.colorModeForRenderPass();if(x.renderPass==="offscreen")(function(X,Y,ee,ne,te,oe,ce){const re=X.context,_e=re.gl;for(const Me of ee){const Te=Y.getTile(Me),Se=Te.dem;if(!Se||!Se.data||!Te.needsHillshadePrepare)continue;const Pe=Se.dim,Oe=Se.stride,Ne=Se.getPixels();if(re.activeTexture.set(_e.TEXTURE1),re.pixelStoreUnpackPremultiplyAlpha.set(!1),Te.demTexture=Te.demTexture||X.getTileTexture(Oe),Te.demTexture){const it=Te.demTexture;it.update(Ne,{premultiply:!1}),it.bind(_e.NEAREST,_e.CLAMP_TO_EDGE)}else Te.demTexture=new l.T(re,Ne,_e.RGBA,{premultiply:!1}),Te.demTexture.bind(_e.NEAREST,_e.CLAMP_TO_EDGE);re.activeTexture.set(_e.TEXTURE0);let Le=Te.fbo;if(!Le){const it=new l.T(re,{width:Pe,height:Pe,data:null},_e.RGBA);it.bind(_e.LINEAR,_e.CLAMP_TO_EDGE),Le=Te.fbo=re.createFramebuffer(Pe,Pe,!0,!1),Le.colorAttachment.set(it.texture)}re.bindFramebuffer.set(Le.framebuffer),re.viewport.set([0,0,Pe,Pe]),X.useProgram("hillshadePrepare").draw(re,_e.TRIANGLES,te,oe,ce,ft.disabled,Up(Te.tileID,Se),null,null,ne.id,X.rasterBoundsBuffer,X.quadTriangleIndexBuffer,X.rasterBoundsSegments),Te.needsHillshadePrepare=!1}})(x,S,A,k,U,Wt.disabled,K),L.viewport.set([0,0,x.width,x.height]);else if(x.renderPass==="translucent")if(O){const[X,Y,ee]=x.stencilConfigForOverlapTwoPass(A);wo(x,S,k,ee,X,U,K,!1,D),wo(x,S,k,ee,Y,U,K,!0,D)}else{const[X,Y]=x.getStencilConfigForOverlapAndUpdateStencilID(A);wo(x,S,k,Y,X,U,K,!1,D)}})(e,s,u,d,y):l.ci(u)?(function(x,S,k,A,I){if(x.renderPass!=="translucent"||!A.length)return;const{isRenderingToTexture:D}=I,L=x.style.projection.useSubdivision,O=x.getDepthModeForSublayer(0,wt.ReadOnly),U=x.colorModeForRenderPass();if(L){const[K,X,Y]=x.stencilConfigForOverlapTwoPass(A);ah(x,S,k,Y,K,O,U,!1,D),ah(x,S,k,Y,X,O,U,!0,D)}else{const[K,X]=x.getStencilConfigForOverlapAndUpdateStencilID(A);ah(x,S,k,X,K,O,U,!1,D)}})(e,s,u,d,y):l.cj(u)?(function(x,S,k,A,I){if(x.renderPass!=="translucent"||k.paint.get("raster-opacity")===0||!A.length)return;const{isRenderingToTexture:D}=I,L=S.getSource(),O=x.style.projection.useSubdivision;if(L instanceof Gn)To(x,S,k,A,null,!1,!1,L.tileCoords,L.flippedWindingOrder,D);else if(O){const[U,K,X]=x.stencilConfigForOverlapTwoPass(A);To(x,S,k,X,U,!1,!0,yc,!1,D),To(x,S,k,X,K,!0,!0,yc,!1,D)}else{const[U,K]=x.getStencilConfigForOverlapAndUpdateStencilID(A);To(x,S,k,K,U,!1,!0,yc,!1,D)}})(e,s,u,d,y):l.ck(u)?(function(x,S,k,A,I){const D=k.paint.get("background-color"),L=k.paint.get("background-opacity");if(L===0)return;const{isRenderingToTexture:O}=I,U=x.context,K=U.gl,X=x.style.projection,Y=x.transform,ee=Y.tileSize,ne=k.paint.get("background-pattern");if(x.isPatternMissing(ne))return;const te=!ne&&D.a===1&&L===1&&x.opaquePassEnabledForLayer()?"opaque":"translucent";if(x.renderPass!==te)return;const oe=Wt.disabled,ce=x.getDepthModeForSublayer(0,te==="opaque"?wt.ReadWrite:wt.ReadOnly),re=x.colorModeForRenderPass(),_e=x.useProgram(ne?"backgroundPattern":"background"),Me=A||be(Y,{tileSize:ee,terrain:x.style.map.terrain});ne&&(U.activeTexture.set(K.TEXTURE0),x.imageManager.bind(x.context));const Te=k.getCrossfadeParameters();for(const Se of Me){const Pe=Y.getProjectionData({overscaledTileID:Se,applyGlobeMatrix:!O,applyTerrainMatrix:!0}),Oe=ne?Hp(L,x,ne,{tileID:Se,tileSize:ee},Te):Wp(L,D),Ne=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Se),Le=X.getMeshFromTileID(U,Se.canonical,!1,!0,"raster");_e.draw(U,K.TRIANGLES,ce,oe,re,ft.backCCW,Oe,Ne,Pe,k.id,Le.vertexBuffer,Le.indexBuffer,Le.segments)}})(e,0,u,d,y):l.cl(u)&&(function(x,S,k,A){const{isRenderingGlobe:I}=A,D=x.context,L=k.implementation,O=x.style.projection,U=x.transform,K=U.getProjectionDataForCustomLayer(I),X={farZ:U.farZ,nearZ:U.nearZ,fov:U.fov*Math.PI/180,modelViewProjectionMatrix:U.modelViewProjectionMatrix,projectionMatrix:U.projectionMatrix,shaderData:{variantName:O.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${O.shaderPreludeCode.vertexSource}`,define:O.shaderDefine},defaultProjectionData:K},Y=L.renderingMode?L.renderingMode:"2d";if(x.renderPass==="offscreen"){const ee=L.prerender;ee&&(x.setCustomLayerDefaults(),D.setColorMode(x.colorModeForRenderPass()),ee.call(L,D.gl,X),D.setDirty(),x.setBaseState())}else if(x.renderPass==="translucent"){x.setCustomLayerDefaults(),D.setColorMode(x.colorModeForRenderPass()),D.setStencilMode(Wt.disabled);const ee=Y==="3d"?x.getDepthModeFor3D():x.getDepthModeForSublayer(0,wt.ReadOnly);D.setDepthMode(ee),L.render(D.gl,X),D.setDirty(),x.setBaseState(),D.bindFramebuffer.set(null)}})(e,0,u,y))}saveTileTexture(e){const s=this._tileTextures[e.size[0]];s?s.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const s=this._tileTextures[e];return s&&s.length>0?s.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const s=this.imageManager.getPattern(e.from.toString()),u=this.imageManager.getPattern(e.to.toString());return!s||!u}useProgram(e,s,u=!1,d=[]){this.cache=this.cache||{};const y=!!this.style.map.terrain,x=this.style.projection,S=u?vn.projectionMercator:x.shaderPreludeCode,k=u?ca:x.shaderDefine,A=e+(s?s.cacheKey:"")+`/${u?ho:x.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(y?"/terrain":"")+(d?`/${d.join("/")}`:"");return this.cache[A]||(this.cache[A]=new Uu(this.context,vn[e],s,Hu[e],this._showOverdrawInspector,y,S,k,d)),this.cache[A]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new l.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:s}=this.context.gl;return this.width!==e||this.height!==s}}function So(g,e){let s,u=!1,d=null,y=null;const x=()=>{d=null,u&&(g.apply(y,s),d=setTimeout(x,e),u=!1)};return(...S)=>(u=!0,y=this,s=S,d||x(),d)}class bc{constructor(e){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let u;return s.split("&").map((d=>d.split("="))).forEach((d=>{d[0]===this._hashName&&(u=d)})),(u&&u[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(!this._isValidHash(s))return!1;const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:u,pitch:+(s[4]||0)}),!0},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,s)},this._removeHash=()=>{const s=this._getCurrentHash();if(s.length===0)return;const u=s.join("/");let d=u;d.split("&").length>0&&(d=d.split("&")[0]),this._hashName&&(d=`${this._hashName}=${u}`);let y=window.location.hash.replace(d,"");y.startsWith("#&")?y=y.slice(0,1)+y.slice(2):y==="#"&&(y="");let x=window.location.href.replace(/(#.+)?$/,y);x=x.replace("&&","&"),window.history.replaceState(window.history.state,null,x)},this._updateHash=So(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const s=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,d=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,d),x=Math.round(s.lng*y)/y,S=Math.round(s.lat*y)/y,k=this._map.getBearing(),A=this._map.getPitch();let I="";if(I+=e?`/${x}/${S}/${u}`:`${u}/${S}/${x}`,(k||A)&&(I+="/"+Math.round(10*k)/10),A&&(I+=`/${Math.round(A)}`),this._hashName){const D=this._hashName;let L=!1;const O=window.location.hash.slice(1).split("&").map((U=>{const K=U.split("=")[0];return K===D?(L=!0,`${K}=${I}`):U})).filter((U=>U));return L||O.push(`${D}=${I}`),`#${O.join("&")}`}return`#${I}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new l.S(+e[2],+e[1])}catch{return!1}const s=+e[0],u=+(e[3]||0),d=+(e[4]||0);return s>=this._map.getMinZoom()&&s<=this._map.getMaxZoom()&&u>=-180&&u<=180&&d>=this._map.getMinPitch()&&d<=this._map.getMaxPitch()}}const pa={linearity:.3,easing:l.cm(0,0,.3,1)},ch=l.e({deceleration:2500,maxSpeed:1400},pa),ud=l.e({deceleration:20,maxSpeed:1400},pa),hd=l.e({deceleration:1e3,maxSpeed:360},pa),pd=l.e({deceleration:1e3,maxSpeed:90},pa),dd=l.e({deceleration:1e3,maxSpeed:360},pa);class fd{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:G.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,s=G.now();for(;e.length>0&&s-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,roll:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)s.zoom+=y.zoomDelta||0,s.bearing+=y.bearingDelta||0,s.pitch+=y.pitchDelta||0,s.roll+=y.rollDelta||0,y.panDelta&&s.pan._add(y.panDelta),y.around&&(s.around=y.around),y.pinchAround&&(s.pinchAround=y.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,d={};if(s.pan.mag()){const y=as(s.pan.mag(),u,l.e({},ch,e||{})),x=s.pan.mult(y.amount/s.pan.mag()),S=this._map.cameraHelper.handlePanInertia(x,this._map.transform);d.center=S.easingCenter,d.offset=S.easingOffset,wn(d,y)}if(s.zoom){const y=as(s.zoom,u,ud);d.zoom=this._map.transform.zoom+y.amount,wn(d,y)}if(s.bearing){const y=as(s.bearing,u,hd);d.bearing=this._map.transform.bearing+l.ah(y.amount,-179,179),wn(d,y)}if(s.pitch){const y=as(s.pitch,u,pd);d.pitch=this._map.transform.pitch+y.amount,wn(d,y)}if(s.roll){const y=as(s.roll,u,dd);d.roll=this._map.transform.roll+l.ah(y.amount,-179,179),wn(d,y)}if(d.zoom||d.bearing){const y=s.pinchAround===void 0?s.around:s.pinchAround;d.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),l.e(d,{noMoveStart:!0})}}function wn(g,e){(!g.duration||g.duration<e.duration)&&(g.duration=e.duration,g.easing=e.easing)}function as(g,e,s){const{maxSpeed:u,linearity:d,deceleration:y}=s,x=l.ah(g*d/(e/1e3),-u,u),S=Math.abs(x)/(y*d);return{easing:s.easing,duration:1e3*S,amount:x*(S/2)}}class Zi extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,u,d={}){u=u instanceof MouseEvent?u:new MouseEvent(e,u);const y=B.mousePos(s.getCanvas(),u),x=s.unproject(y);super(e,l.e({point:y,lngLat:x,originalEvent:u},d)),this._defaultPrevented=!1,this.target=s}}class os extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,u){const d=e==="touchend"?u.changedTouches:u.touches,y=B.touchPos(s.getCanvasContainer(),d),x=y.map((k=>s.unproject(k))),S=y.reduce(((k,A,I,D)=>k.add(A.div(D.length))),new l.P(0,0));super(e,{points:y,point:S,lngLats:x,lngLat:s.unproject(S),originalEvent:u}),this._defaultPrevented=!1}}class uh extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,u){super(e,{originalEvent:u}),this._defaultPrevented=!1}}class md{constructor(e,s){this._map=e,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new uh(e.type,this._map,e))}mousedown(e,s){return this._mousedownPos=s,this._firePreventable(new Zi(e.type,this._map,e))}mouseup(e){this._map.fire(new Zi(e.type,this._map,e))}click(e,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new Zi(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Zi(e.type,this._map,e))}mouseover(e){this._map.fire(new Zi(e.type,this._map,e))}mouseout(e){this._map.fire(new Zi(e.type,this._map,e))}touchstart(e){return this._firePreventable(new os(e.type,this._map,e))}touchmove(e){this._map.fire(new os(e.type,this._map,e))}touchend(e){this._map.fire(new os(e.type,this._map,e))}touchcancel(e){this._map.fire(new os(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class gd{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Zi(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Zi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Zi(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ss{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(l.P.convert(e),this._map.terrain)}}class hh{constructor(e,s){this._map=e,this._tr=new ss(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,s){this.isEnabled()&&e.shiftKey&&e.button===0&&(B.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(e,s){if(!this._active)return;const u=s;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;const d=this._startPos;this._lastPos=u,this._box||(this._box=B.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const y=Math.min(d.x,u.x),x=Math.max(d.x,u.x),S=Math.min(d.y,u.y),k=Math.max(d.y,u.y);B.setTransform(this._box,`translate(${y}px,${S}px)`),this._box.style.width=x-y+"px",this._box.style.height=k-S+"px"}mouseupWindow(e,s){if(!this._active||e.button!==0)return;const u=this._startPos,d=s;if(this.reset(),B.suppressClick(),u.x!==d.x||u.y!==d.y)return this._map.fire(new l.l("boxzoomend",{originalEvent:e})),{cameraAnimation:y=>y.fitScreenCoordinates(u,d,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(B.remove(this._box),this._box=null),B.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,s){return this._map.fire(new l.l(e,{originalEvent:s}))}}function ls(g,e){if(g.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${g.length}, points ${e.length}`);const s={};for(let u=0;u<g.length;u++)s[g[u].identifier]=e[u];return s}class yd{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,s,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),u.length===this.numTouches&&(this.centroid=(function(d){const y=new l.P(0,0);for(const x of d)y._add(x);return y.div(d.length)})(s),this.touches=ls(u,s)))}touchmove(e,s,u){if(this.aborted||!this.centroid)return;const d=ls(u,s);for(const y in this.touches){const x=d[y];(!x||x.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(e,s,u){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const d=!this.aborted&&this.centroid;if(this.reset(),d)return d}}}class Wi{constructor(e){this.singleTap=new yd(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,s,u){this.singleTap.touchstart(e,s,u)}touchmove(e,s,u){this.singleTap.touchmove(e,s,u)}touchend(e,s,u){const d=this.singleTap.touchend(e,s,u);if(d){const y=e.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(d)<30;if(y&&x||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}}}class Tn{constructor(e){this._tr=new ss(e),this._zoomIn=new Wi({numTouches:1,numTaps:2}),this._zoomOut=new Wi({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,s,u){this._zoomIn.touchstart(e,s,u),this._zoomOut.touchstart(e,s,u)}touchmove(e,s,u){this._zoomIn.touchmove(e,s,u),this._zoomOut.touchmove(e,s,u)}touchend(e,s,u){const d=this._zoomIn.touchend(e,s,u),y=this._zoomOut.touchend(e,s,u),x=this._tr;return d?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:x.zoom+1,around:x.unproject(d)},{originalEvent:e})}):y?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:x.zoom-1,around:x.unproject(y)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cs{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const s=this._moveFunction(...e);if(s.bearingDelta||s.pitchDelta||s.rollDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(e,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(s)?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,s){if(!this.isEnabled())return;const u=this._lastPoint;if(!u)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const d=Array.isArray(s)?s[0]:s;return!this._moved&&d.dist(u)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=d,this._move(u,d))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&B.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Sn=0,us=2,Rm={[Sn]:1,[us]:2};class il{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const s=B.mouseButton(e);this._eventButton=s}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!(function(s,u){const d=Rm[u];return s.buttons===void 0||(s.buttons&d)!==d})(e,this._eventButton)}isValidEndEvent(e){return B.mouseButton(e)===this._eventButton}}class Lm{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class Dm{constructor(e=new il({checkCorrectEvent:()=>!0}),s=new Lm){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=s}_executeRelevantHandler(e,s,u){return e instanceof MouseEvent?s(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?u(e):void 0}startMove(e){this._executeRelevantHandler(e,(s=>this.mouseMoveStateManager.startMove(s)),(s=>this.oneFingerTouchMoveStateManager.startMove(s)))}endMove(e){this._executeRelevantHandler(e,(s=>this.mouseMoveStateManager.endMove(s)),(s=>this.oneFingerTouchMoveStateManager.endMove(s)))}isValidStartEvent(e){return this._executeRelevantHandler(e,(s=>this.mouseMoveStateManager.isValidStartEvent(s)),(s=>this.oneFingerTouchMoveStateManager.isValidStartEvent(s)))}isValidMoveEvent(e){return this._executeRelevantHandler(e,(s=>this.mouseMoveStateManager.isValidMoveEvent(s)),(s=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(s)))}isValidEndEvent(e){return this._executeRelevantHandler(e,(s=>this.mouseMoveStateManager.isValidEndEvent(s)),(s=>this.oneFingerTouchMoveStateManager.isValidEndEvent(s)))}}const nl=g=>{g.mousedown=g.dragStart,g.mousemoveWindow=g.dragMove,g.mouseup=g.dragEnd,g.contextmenu=e=>{e.preventDefault()}};class al{constructor(e,s){this._clickTolerance=e.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,s,u){return this._calculateTransform(e,s,u)}touchmove(e,s,u){if(this._active){if(!this._shouldBePrevented(u.length))return e.preventDefault(),this._calculateTransform(e,s,u);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,s,u){this._calculateTransform(e,s,u),this._active&&this._shouldBePrevented(u.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,s,u){u.length>0&&(this._active=!0);const d=ls(u,s),y=new l.P(0,0),x=new l.P(0,0);let S=0;for(const A in d){const I=d[A],D=this._touches[A];D&&(y._add(I),x._add(I.sub(D)),S++,d[A]=I)}if(this._touches=d,this._shouldBePrevented(S)||!x.mag())return;const k=x.div(S);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(S),panDelta:k}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class kn{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,s,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([s[0],s[1]]))}touchmove(e,s,u){if(!this._firstTwoTouches)return;e.preventDefault();const[d,y]=this._firstTwoTouches,x=Ye(u,s,d),S=Ye(u,s,y);if(!x||!S)return;const k=this._aroundCenter?null:x.add(S).div(2);return this._move([x,S],k,e)}touchend(e,s,u){if(!this._firstTwoTouches)return;const[d,y]=this._firstTwoTouches,x=Ye(u,s,d),S=Ye(u,s,y);x&&S||(this._active&&B.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ye(g,e,s){for(let u=0;u<g.length;u++)if(g[u].identifier===s)return e[u]}function ph(g,e){return Math.log(g/e)/Math.LN2}class xc extends kn{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,s){const u=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(ph(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ph(this._distance,u),pinchAround:s}}}function dh(g,e){return 180*g.angleWith(e)/Math.PI}class hs extends kn{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,s,u){const d=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:dh(this._vector,d),pinchAround:s}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const s=25/(Math.PI*this._minDiameter)*360,u=dh(e,this._startVector);return Math.abs(u)<s}}function ko(g){return Math.abs(g.y)>Math.abs(g.x)}class wc extends kn{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,s,u){super.touchstart(e,s,u),this._currentTouchCount=u.length}_start(e){this._lastPoints=e,ko(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,s,u){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const d=e[0].sub(this._lastPoints[0]),y=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(d,y,u.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(d.y+y.y)/2*-.5}):void 0}gestureBeginsVertically(e,s,u){if(this._valid!==void 0)return this._valid;const d=e.mag()>=2,y=s.mag()>=2;if(!d&&!y)return;if(!d||!y)return this._firstMove===void 0&&(this._firstMove=u),u-this._firstMove<100&&void 0;const x=e.y>0==s.y>0;return ko(e)&&ko(s)&&x}}const Ut={panStep:100,bearingStep:15,pitchStep:10};class Tc{constructor(e){this._tr=new ss(e);const s=Ut;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let s=0,u=0,d=0,y=0,x=0;switch(e.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:e.shiftKey?u=-1:(e.preventDefault(),y=-1);break;case 39:e.shiftKey?u=1:(e.preventDefault(),y=1);break;case 38:e.shiftKey?d=1:(e.preventDefault(),x=-1);break;case 40:e.shiftKey?d=-1:(e.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(u=0,d=0),{cameraAnimation:S=>{const k=this._tr;S.easeTo({duration:300,easeId:"keyboardHandler",easing:Fm,zoom:s?Math.round(k.zoom)+s*(e.shiftKey?2:1):k.zoom,bearing:k.bearing+u*this._bearingStep,pitch:k.pitch+d*this._pitchStep,offset:[-y*this._panStep,-x*this._panStep],center:k.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Fm(g){return g*(2-g)}const Sc=4.000244140625,jm=1/450;class _d{constructor(e,s){this._onTimeout=u=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)},this._map=e,this._tr=new ss(e),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=jm}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let s=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const u=G.now(),d=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,s!==0&&s%Sc==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(d*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),e.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=e,this._delta-=s,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=B.mousePos(this._map.getCanvas(),e),u=this._tr;this._aroundPoint=this._aroundCenter?u.transform.locationToScreenPoint(l.S.convert(u.center)):s,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const S=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=S),typeof this._targetZoom=="number"&&(this._targetZoom+=S)}if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>Sc?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&k!==0&&(k=1/k);const A=typeof this._targetZoom!="number"?e.scale:l.af(this._targetZoom);this._targetZoom=e.getConstrained(e.getCameraLngLat(),l.ak(A*k)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,u=this._startZoom,d=this._easing;let y,x=!1;if(this._type==="wheel"&&u&&d){const S=G.now()-this._lastWheelEventTime,k=Math.min((S+5)/200,1),A=d(k);y=l.C.number(u,s,A),k<1?this._frameId||(this._frameId=!0):x=!0}else y=s,x=!0;return this._active=!0,x&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=y,{noInertia:!0,needsRenderFrame:!x,zoomDelta:y-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let s=l.co;if(this._prevEase){const u=this._prevEase,d=(G.now()-u.start)/u.duration,y=u.easing(d+.01)-u.easing(d),x=.27/Math.sqrt(y*y+1e-4)*.01,S=Math.sqrt(.0729-x*x);s=l.cm(x,S,.25,1)}return this._prevEase={start:G.now(),duration:e,easing:s},s}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class fh{constructor(e,s){this._clickZoom=e,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class mh{constructor(e){this._tr=new ss(e),this.reset()}reset(){this._active=!1}dblclick(e,s){return e.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vd{constructor(){this._tap=new Wi({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,s,u){if(!this._swipePoint)if(this._tapTime){const d=s[0],y=e.timeStamp-this._tapTime<500,x=this._tapPoint.dist(d)<30;y&&x?u.length>0&&(this._swipePoint=d,this._swipeTouch=u[0].identifier):this.reset()}else this._tap.touchstart(e,s,u)}touchmove(e,s,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const d=s[0],y=d.y-this._swipePoint.y;return this._swipePoint=d,e.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(e,s,u)}touchend(e,s,u){if(this._tapTime)this._swipePoint&&u.length===0&&this.reset();else{const d=this._tap.touchend(e,s,u);d&&(this._tapTime=e.timeStamp,this._tapPoint=d)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class bd{constructor(e,s,u){this._el=e,this._mousePan=s,this._touchPan=u}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class gh{constructor(e,s,u,d){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=s,this._mousePitch=u,this._mouseRoll=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class xd{constructor(e,s,u,d){this._el=e,this._touchZoom=s,this._touchRotate=u,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class wd{constructor(e,s){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=s,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=B.create("div","maplibregl-cooperative-gesture-screen",e);let s=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(s=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const u=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),d=document.createElement("div");d.className="maplibregl-desktop-message",d.textContent=s,this._container.appendChild(d);const y=document.createElement("div");y.className="maplibregl-mobile-message",y.textContent=u,this._container.appendChild(y),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(B.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,s){this._enabled&&(this._map.fire(new l.l("cooperativegestureprevented",{gestureType:e,originalEvent:s})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const Cn=g=>g.zoom||g.drag||g.roll||g.pitch||g.rotate;class vr extends l.l{}function ps(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta||g.rollDelta}class yh{constructor(e,s){this.handleWindowEvent=d=>{this.handleEvent(d,`${d.type}Window`)},this.handleEvent=(d,y)=>{if(d.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const x=d.type==="renderFrame"?void 0:d,S={needsRenderFrame:!1},k={},A={};for(const{handlerName:L,handler:O,allowed:U}of this._handlers){if(!O.isEnabled())continue;let K;if(this._blockedByActive(A,U,L))O.reset();else if(O[y||d.type]){if(l.cp(d,y||d.type)){const X=B.mousePos(this._map.getCanvas(),d);K=O[y||d.type](d,X)}else if(l.cq(d,y||d.type)){const X=this._getMapTouches(d.touches),Y=B.touchPos(this._map.getCanvas(),X);K=O[y||d.type](d,Y,X)}else l.cr(y||d.type)||(K=O[y||d.type](d));this.mergeHandlerResult(S,k,K,L,x),K&&K.needsRenderFrame&&this._triggerRenderFrame()}(K||O.isActive())&&(A[L]=O)}const I={};for(const L in this._previousActiveHandlers)A[L]||(I[L]=x);this._previousActiveHandlers=A,(Object.keys(I).length||ps(S))&&(this._changes.push([S,k,I]),this._triggerRenderFrame()),(Object.keys(A).length||ps(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:D}=S;D&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],D(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new fd(e),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[d,y,x]of this._listeners)B.addEventListener(d,y,d===document?this.handleWindowEvent:this.handleEvent,x)}destroy(){for(const[e,s,u]of this._listeners)B.removeEventListener(e,s,e===document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(e){const s=this._map,u=s.getCanvasContainer();this._add("mapEvent",new md(s,e));const d=s.boxZoom=new hh(s,e);this._add("boxZoom",d),e.interactive&&e.boxZoom&&d.enable();const y=s.cooperativeGestures=new wd(s,e.cooperativeGestures);this._add("cooperativeGestures",y),e.cooperativeGestures&&y.enable();const x=new Tn(s),S=new mh(s);s.doubleClickZoom=new fh(S,x),this._add("tapZoom",x),this._add("clickZoom",S),e.interactive&&e.doubleClickZoom&&s.doubleClickZoom.enable();const k=new vd;this._add("tapDragZoom",k);const A=s.touchPitch=new wc(s);this._add("touchPitch",A),e.interactive&&e.touchPitch&&s.touchPitch.enable(e.touchPitch);const I=()=>s.project(s.getCenter()),D=(function({enable:te,clickTolerance:oe,aroundCenter:ce=!0,minPixelCenterThreshold:re=100,rotateDegreesPerPixelMoved:_e=.8},Me){const Te=new il({checkCorrectEvent:Se=>B.mouseButton(Se)===0&&Se.ctrlKey||B.mouseButton(Se)===2&&!Se.ctrlKey});return new cs({clickTolerance:oe,move:(Se,Pe)=>{const Oe=Me();if(ce&&Math.abs(Oe.y-Se.y)>re)return{bearingDelta:l.cn(new l.P(Se.x,Pe.y),Pe,Oe)};let Ne=(Pe.x-Se.x)*_e;return ce&&Pe.y<Oe.y&&(Ne=-Ne),{bearingDelta:Ne}},moveStateManager:Te,enable:te,assignEvents:nl})})(e,I),L=(function({enable:te,clickTolerance:oe,pitchDegreesPerPixelMoved:ce=-.5}){const re=new il({checkCorrectEvent:_e=>B.mouseButton(_e)===0&&_e.ctrlKey||B.mouseButton(_e)===2});return new cs({clickTolerance:oe,move:(_e,Me)=>({pitchDelta:(Me.y-_e.y)*ce}),moveStateManager:re,enable:te,assignEvents:nl})})(e),O=(function({enable:te,clickTolerance:oe,rollDegreesPerPixelMoved:ce=.3},re){const _e=new il({checkCorrectEvent:Me=>B.mouseButton(Me)===2&&Me.ctrlKey});return new cs({clickTolerance:oe,move:(Me,Te)=>{const Se=re();let Pe=(Te.x-Me.x)*ce;return Te.y<Se.y&&(Pe=-Pe),{rollDelta:Pe}},moveStateManager:_e,enable:te,assignEvents:nl})})(e,I);s.dragRotate=new gh(e,D,L,O),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",L,["mouseRotate","mouseRoll"]),this._add("mouseRoll",O,["mousePitch"]),e.interactive&&e.dragRotate&&s.dragRotate.enable();const U=(function({enable:te,clickTolerance:oe}){const ce=new il({checkCorrectEvent:re=>B.mouseButton(re)===0&&!re.ctrlKey});return new cs({clickTolerance:oe,move:(re,_e)=>({around:_e,panDelta:_e.sub(re)}),activateOnStart:!0,moveStateManager:ce,enable:te,assignEvents:nl})})(e),K=new al(e,s);s.dragPan=new bd(u,U,K),this._add("mousePan",U),this._add("touchPan",K,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&s.dragPan.enable(e.dragPan);const X=new hs,Y=new xc;s.touchZoomRotate=new xd(u,Y,X,k),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",Y,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&s.touchZoomRotate.enable(e.touchZoomRotate);const ee=s.scrollZoom=new _d(s,(()=>this._triggerRenderFrame()));this._add("scrollZoom",ee,["mousePan"]),e.interactive&&e.scrollZoom&&s.scrollZoom.enable(e.scrollZoom);const ne=s.keyboard=new Tc(s);this._add("keyboard",ne),e.interactive&&e.keyboard&&s.keyboard.enable(),this._add("blockableMapEvent",new gd(s))}_add(e,s,u){this._handlers.push({handlerName:e,handler:s,allowed:u}),this._handlersById[e]=s}stop(e){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Cn(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,s,u){for(const d in e)if(d!==u&&(!s||s.indexOf(d)<0))return!0;return!1}_getMapTouches(e){const s=[];for(const u of e)this._el.contains(u.target)&&s.push(u);return s}mergeHandlerResult(e,s,u,d,y){if(!u)return;l.e(e,u);const x={handlerName:d,originalEvent:u.originalEvent||y};u.zoomDelta!==void 0&&(s.zoom=x),u.panDelta!==void 0&&(s.drag=x),u.rollDelta!==void 0&&(s.roll=x),u.pitchDelta!==void 0&&(s.pitch=x),u.bearingDelta!==void 0&&(s.rotate=x)}_applyChanges(){const e={},s={},u={};for(const[d,y,x]of this._changes)d.panDelta&&(e.panDelta=(e.panDelta||new l.P(0,0))._add(d.panDelta)),d.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+d.zoomDelta),d.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+d.bearingDelta),d.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+d.pitchDelta),d.rollDelta&&(e.rollDelta=(e.rollDelta||0)+d.rollDelta),d.around!==void 0&&(e.around=d.around),d.pinchAround!==void 0&&(e.pinchAround=d.pinchAround),d.noInertia&&(e.noInertia=d.noInertia),l.e(s,y),l.e(u,x);this._updateMapTransform(e,s,u),this._changes=[]}_updateMapTransform(e,s,u){const d=this._map,y=d._getTransformForUpdate(),x=d.terrain;if(!(ps(e)||x&&this._terrainMovement))return this._fireEvents(s,u,!0);d._stop(!0);let{panDelta:S,zoomDelta:k,bearingDelta:A,pitchDelta:I,rollDelta:D,around:L,pinchAround:O}=e;O!==void 0&&(L=O),L=L||d.transform.centerPoint,x&&!y.isPointOnMapSurface(L)&&(L=y.centerPoint);const U={panDelta:S,zoomDelta:k,rollDelta:D,pitchDelta:I,bearingDelta:A,around:L};this._map.cameraHelper.useGlobeControls&&!y.isPointOnMapSurface(L)&&(L=y.centerPoint);const K=L.distSqr(y.centerPoint)<.01?y.center:y.screenPointToLocation(S?L.sub(S):L);x?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(U,y),this._terrainMovement||!s.drag&&!s.zoom?s.drag&&this._terrainMovement?y.setCenter(y.screenPointToLocation(y.centerPoint.sub(S))):this._map.cameraHelper.handleMapControlsPan(U,y,K):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(U,y,K))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(U,y),this._map.cameraHelper.handleMapControlsPan(U,y,K)),d._applyUpdatedTransform(y),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(s,u,!0)}_fireEvents(e,s,u){const d=Cn(this._eventsInProgress),y=Cn(e),x={};for(const D in e){const{originalEvent:L}=e[D];this._eventsInProgress[D]||(x[`${D}start`]=L),this._eventsInProgress[D]=e[D]}!d&&y&&this._fireEvent("movestart",y.originalEvent);for(const D in x)this._fireEvent(D,x[D]);y&&this._fireEvent("move",y.originalEvent);for(const D in e){const{originalEvent:L}=e[D];this._fireEvent(D,L)}const S={};let k;for(const D in this._eventsInProgress){const{handlerName:L,originalEvent:O}=this._eventsInProgress[D];this._handlersById[L].isActive()||(delete this._eventsInProgress[D],k=s[L]||O,S[`${D}end`]=k)}for(const D in S)this._fireEvent(D,S[D]);const A=Cn(this._eventsInProgress),I=(d||y)&&!A;if(I&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const D=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&D.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(D)}if(u&&I){this._updatingCamera=!0;const D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),L=O=>O!==0&&-this._bearingSnap<O&&O<this._bearingSnap;!D||!D.essential&&G.prefersReducedMotion?(this._map.fire(new l.l("moveend",{originalEvent:k})),L(this._map.getBearing())&&this._map.resetNorth()):(L(D.bearing||this._map.getBearing())&&(D.bearing=0),D.freezeElevation=!0,this._map.easeTo(D,{originalEvent:k})),this._updatingCamera=!1}}_fireEvent(e,s){this._map.fire(new l.l(e,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new vr("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Td extends l.E{constructor(e,s,u){super(),this._renderFrameCallback=()=>{const d=Math.min((G.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(d)),d<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=u.bearingSnap,this.cameraHelper=s,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(e,s){e.apply(this.transform),this.transform=e,this.cameraHelper=s}getCenter(){return new l.S(this.transform.center.lng,this.transform.center.lat)}setCenter(e,s){return this.jumpTo({center:e},s)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,s){return this.jumpTo({elevation:e},s),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,s,u){return e=l.P.convert(e).mult(-1),this.panTo(this.transform.center,l.e({offset:e},s),u)}panTo(e,s,u){return this.easeTo(l.e({center:e},s),u)}getZoom(){return this.transform.zoom}setZoom(e,s){return this.jumpTo({zoom:e},s),this}zoomTo(e,s,u){return this.easeTo(l.e({zoom:e},s),u)}zoomIn(e,s){return this.zoomTo(this.getZoom()+1,e,s),this}zoomOut(e,s){return this.zoomTo(this.getZoom()-1,e,s),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,s){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new l.l("movestart",s)).fire(new l.l("move",s)).fire(new l.l("moveend",s))),this}getBearing(){return this.transform.bearing}setBearing(e,s){return this.jumpTo({bearing:e},s),this}getPadding(){return this.transform.padding}setPadding(e,s){return this.jumpTo({padding:e},s),this}rotateTo(e,s,u){return this.easeTo(l.e({bearing:e},s),u)}resetNorth(e,s){return this.rotateTo(0,l.e({duration:1e3},e),s),this}resetNorthPitch(e,s){return this.easeTo(l.e({bearing:0,pitch:0,roll:0,duration:1e3},e),s),this}snapToNorth(e,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,s):this}getPitch(){return this.transform.pitch}setPitch(e,s){return this.jumpTo({pitch:e},s),this}getRoll(){return this.transform.roll}setRoll(e,s){return this.jumpTo({roll:e},s),this}cameraForBounds(e,s){e=Yt.convert(e).adjustAntiMeridian();const u=s&&s.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),u,s)}_cameraForBoxAndBearing(e,s,u,d){const y={top:0,bottom:0,right:0,left:0};if(typeof(d=l.e({padding:y,offset:[0,0],maxZoom:this.transform.maxZoom},d)).padding=="number"){const A=d.padding;d.padding={top:A,bottom:A,right:A,left:A}}const x=l.e(y,d.padding);d.padding=x;const S=this.transform,k=new Yt(e,s);return this.cameraHelper.cameraForBoxAndBearing(d,x,k,u,S)}fitBounds(e,s,u){return this._fitInternal(this.cameraForBounds(e,s),s,u)}fitScreenCoordinates(e,s,u,d,y){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(l.P.convert(e)),this.transform.screenPointToLocation(l.P.convert(s)),u,d),d,y)}_fitInternal(e,s,u){return e?(delete(s=l.e(e,s)).padding,s.linear?this.easeTo(s,u):this.flyTo(s,u)):this}jumpTo(e,s){this.stop();const u=this._getTransformForUpdate();let d=!1,y=!1,x=!1;const S=u.zoom;this.cameraHelper.handleJumpToCenterZoom(u,e);const k=u.zoom!==S;return"elevation"in e&&u.elevation!==+e.elevation&&u.setElevation(+e.elevation),"bearing"in e&&u.bearing!==+e.bearing&&(d=!0,u.setBearing(+e.bearing)),"pitch"in e&&u.pitch!==+e.pitch&&(y=!0,u.setPitch(+e.pitch)),"roll"in e&&u.roll!==+e.roll&&(x=!0,u.setRoll(+e.roll)),e.padding==null||u.isPaddingEqual(e.padding)||u.setPadding(e.padding),this._applyUpdatedTransform(u),this.fire(new l.l("movestart",s)).fire(new l.l("move",s)),k&&this.fire(new l.l("zoomstart",s)).fire(new l.l("zoom",s)).fire(new l.l("zoomend",s)),d&&this.fire(new l.l("rotatestart",s)).fire(new l.l("rotate",s)).fire(new l.l("rotateend",s)),y&&this.fire(new l.l("pitchstart",s)).fire(new l.l("pitch",s)).fire(new l.l("pitchend",s)),x&&this.fire(new l.l("rollstart",s)).fire(new l.l("roll",s)).fire(new l.l("rollend",s)),this.fire(new l.l("moveend",s))}calculateCameraOptionsFromTo(e,s,u,d=0){const y=l.a1.fromLngLat(e,s),x=l.a1.fromLngLat(u,d),S=x.x-y.x,k=x.y-y.y,A=x.z-y.z,I=Math.hypot(S,k,A);if(I===0)throw new Error("Can't calculate camera options with same From and To");const D=Math.hypot(S,k),L=l.ak(this.transform.cameraToCenterDistance/I/this.transform.tileSize),O=180*Math.atan2(S,-k)/Math.PI;let U=180*Math.acos(D/I)/Math.PI;return U=A<0?90-U:90+U,{center:x.toLngLat(),elevation:d,zoom:L,pitch:U,bearing:O}}calculateCameraOptionsFromCameraLngLatAltRotation(e,s,u,d,y){const x=this.transform.calculateCenterFromCameraLngLatAlt(e,s,u,d);return{center:x.center,elevation:x.elevation,zoom:x.zoom,bearing:u,pitch:d,roll:y}}easeTo(e,s){this._stop(!1,e.easeId),((e=l.e({offset:[0,0],duration:500,easing:l.co},e)).animate===!1||!e.essential&&G.prefersReducedMotion)&&(e.duration=0);const u=this._getTransformForUpdate(),d=this.getBearing(),y=u.pitch,x=u.roll,S="bearing"in e?this._normalizeBearing(e.bearing,d):d,k="pitch"in e?+e.pitch:y,A="roll"in e?this._normalizeBearing(e.roll,x):x,I="padding"in e?e.padding:u.padding,D=l.P.convert(e.offset);let L,O;e.around&&(L=l.S.convert(e.around),O=u.locationToScreenPoint(L));const U={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},K=this.cameraHelper.handleEaseTo(u,{bearing:S,pitch:k,roll:A,padding:I,around:L,aroundPoint:O,offsetAsPoint:D,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||d!==S,this._pitching=this._pitching||k!==y,this._rolling=this._rolling||A!==x,this._padding=!u.isPaddingEqual(I),this._zooming=this._zooming||K.isZooming,this._easeId=e.easeId,this._prepareEase(s,e.noMoveStart,U),this.terrain&&this._prepareElevation(K.elevationCenter),this._ease((X=>{K.easeFunc(X),this.terrain&&!e.freezeElevation&&this._updateElevation(X),this._applyUpdatedTransform(u),this._fireMoveEvents(s)}),(X=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(s,X)}),e),this}_prepareEase(e,s,u={}){this._moving=!0,s||u.moving||this.fire(new l.l("movestart",e)),this._zooming&&!u.zooming&&this.fire(new l.l("zoomstart",e)),this._rotating&&!u.rotating&&this.fire(new l.l("rotatestart",e)),this._pitching&&!u.pitching&&this.fire(new l.l("pitchstart",e)),this._rolling&&!u.rolling&&this.fire(new l.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const s=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&s!==this._elevationTarget){const u=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(u-(s-(u*e+this._elevationStart))/(1-e)),this._elevationTarget=s}this.transform.setElevation(l.C.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const s=e.getCameraLngLat(),u=e.getCameraAltitude(),d=this.terrain?this.terrain.getElevationForLngLatZoom(s,e.zoom):0;if(u<d){const y=this.calculateCameraOptionsFromTo(s,d,e.center,e.elevation);return{pitch:y.pitch,zoom:y.zoom}}return{}}_applyUpdatedTransform(e){const s=[];if(s.push((d=>this._elevateCameraIfInsideTerrain(d))),this.transformCameraUpdate&&s.push((d=>this.transformCameraUpdate(d))),!s.length)return;const u=e.clone();for(const d of s){const y=u.clone(),{center:x,zoom:S,roll:k,pitch:A,bearing:I,elevation:D}=d(y);x&&y.setCenter(x),D!==void 0&&y.setElevation(D),S!==void 0&&y.setZoom(S),k!==void 0&&y.setRoll(k),A!==void 0&&y.setPitch(A),I!==void 0&&y.setBearing(I),u.apply(y)}this.transform.apply(u)}_fireMoveEvents(e){this.fire(new l.l("move",e)),this._zooming&&this.fire(new l.l("zoom",e)),this._rotating&&this.fire(new l.l("rotate",e)),this._pitching&&this.fire(new l.l("pitch",e)),this._rolling&&this.fire(new l.l("roll",e))}_afterEase(e,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const u=this._zooming,d=this._rotating,y=this._pitching,x=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,u&&this.fire(new l.l("zoomend",e)),d&&this.fire(new l.l("rotateend",e)),y&&this.fire(new l.l("pitchend",e)),x&&this.fire(new l.l("rollend",e)),this.fire(new l.l("moveend",e))}flyTo(e,s){if(!e.essential&&G.prefersReducedMotion){const Pe=l.Q(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Pe,s)}this.stop(),e=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.co},e);const u=this._getTransformForUpdate(),d=u.bearing,y=u.pitch,x=u.roll,S=u.padding,k="bearing"in e?this._normalizeBearing(e.bearing,d):d,A="pitch"in e?+e.pitch:y,I="roll"in e?this._normalizeBearing(e.roll,x):x,D="padding"in e?e.padding:u.padding,L=l.P.convert(e.offset);let O=u.centerPoint.add(L);const U=u.screenPointToLocation(O),K=this.cameraHelper.handleFlyTo(u,{bearing:k,pitch:A,roll:I,padding:D,locationAtOffset:U,offsetAsPoint:L,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let X=e.curve;const Y=Math.max(u.width,u.height),ee=Y/K.scaleOfZoom,ne=K.pixelPathLength;typeof K.scaleOfMinZoom=="number"&&(X=Math.sqrt(Y/K.scaleOfMinZoom/ne*2));const te=X*X;function oe(Pe){const Oe=(ee*ee-Y*Y+(Pe?-1:1)*te*te*ne*ne)/(2*(Pe?ee:Y)*te*ne);return Math.log(Math.sqrt(Oe*Oe+1)-Oe)}function ce(Pe){return(Math.exp(Pe)-Math.exp(-Pe))/2}function re(Pe){return(Math.exp(Pe)+Math.exp(-Pe))/2}const _e=oe(!1);let Me=function(Pe){return re(_e)/re(_e+X*Pe)},Te=function(Pe){return Y*((re(_e)*(ce(Oe=_e+X*Pe)/re(Oe))-ce(_e))/te)/ne;var Oe},Se=(oe(!0)-_e)/X;if(Math.abs(ne)<2e-6||!isFinite(Se)){if(Math.abs(Y-ee)<1e-6)return this.easeTo(e,s);const Pe=ee<Y?-1:1;Se=Math.abs(Math.log(ee/Y))/X,Te=()=>0,Me=Oe=>Math.exp(Pe*X*Oe)}return e.duration="duration"in e?+e.duration:1e3*Se/("screenSpeed"in e?+e.screenSpeed/X:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=d!==k,this._pitching=A!==y,this._rolling=I!==x,this._padding=!u.isPaddingEqual(D),this._prepareEase(s,!1),this.terrain&&this._prepareElevation(K.targetCenter),this._ease((Pe=>{const Oe=Pe*Se,Ne=1/Me(Oe),Le=Te(Oe);this._rotating&&u.setBearing(l.C.number(d,k,Pe)),this._pitching&&u.setPitch(l.C.number(y,A,Pe)),this._rolling&&u.setRoll(l.C.number(x,I,Pe)),this._padding&&(u.interpolatePadding(S,D,Pe),O=u.centerPoint.add(L)),K.easeFunc(Pe,Ne,Le,O),this.terrain&&!e.freezeElevation&&this._updateElevation(Pe),this._applyUpdatedTransform(u),this._fireMoveEvents(s)}),(()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(s)}),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,s){var u;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const d=this._onEaseEnd;delete this._onEaseEnd,d.call(this,s)}return e||(u=this.handlers)===null||u===void 0||u.stop(!1),this}_ease(e,s,u){u.animate===!1||u.duration===0?(e(1),s()):(this._easeStart=G.now(),this._easeOptions=u,this._onEaseFrame=e,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,s){e=l.aO(e,-180,180);const u=Math.abs(e-s);return Math.abs(e-360-s)<u&&(e-=360),Math.abs(e+360-s)<u&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(l.S.convert(e),this.transform.tileZoom):null}}const _h={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class vh{constructor(e=_h){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=B.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=B.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=B.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){B.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,s){const u=this._map._getUIString(`AttributionControl.${s}`);e.title=u,e.setAttribute("aria-label",u)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((d=>typeof d!="string"?"":d))):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}const s=this._map.style.sourceCaches;for(const d in s){const y=s[d];if(y.used||y.usedForTerrain){const x=y.getSource();x.attribution&&e.indexOf(x.attribution)<0&&e.push(x.attribution)}}e=e.filter((d=>String(d).trim())),e.sort(((d,y)=>d.length-y.length)),e=e.filter(((d,y)=>{for(let x=y+1;x<e.length;x++)if(e[x].indexOf(d)>=0)return!1;return!0}));const u=e.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,e.length?(this._innerContainer.innerHTML=B.sanitize(u),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Sd{constructor(e={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const u=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&u.classList.add("maplibregl-compact"):u.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=B.create("div","maplibregl-ctrl");const s=B.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){B.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Yn{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const s=++this._id;return this._queue.push({callback:e,id:s,cancelled:!1}),s}remove(e){const s=this._currentlyRunning,u=s?this._queue.concat(s):this._queue;for(const d of u)if(d.id===e)return void(d.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const u of s)if(!u.cancelled&&(u.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var kc=l.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class ot extends l.E{constructor(e){super(),this._lastTilesetChange=G.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,s){this.sourceCache.update(e,s),this._renderableTilesKeys=[];const u={};for(const d of be(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))u[d.key]=!0,this._renderableTilesKeys.push(d.key),this._tiles[d.key]||(d.terrainRttPosMatrix32f=new Float64Array(16),l.bY(d.terrainRttPosMatrix32f,0,l.$,l.$,0,0,1),this._tiles[d.key]=new Wo(d,this.tileSize),this._lastTilesetChange=G.now());for(const d in this._tiles)u[d]||delete this._tiles[d]}freeRtt(e){for(const s in this._tiles){const u=this._tiles[s];(!e||u.tileID.equals(e)||u.tileID.isChildOf(e)||e.isChildOf(u.tileID))&&(u.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((e=>this.getTileByID(e)))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,s){return s?this._getTerrainCoordsForTileRanges(e,s):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const s={};for(const u of this._renderableTilesKeys){const d=this._tiles[u].tileID,y=e.clone(),x=l.ba();if(d.canonical.equals(e.canonical))l.bY(x,0,l.$,l.$,0,0,1);else if(d.canonical.isChildOf(e.canonical)){const S=d.canonical.z-e.canonical.z,k=d.canonical.x-(d.canonical.x>>S<<S),A=d.canonical.y-(d.canonical.y>>S<<S),I=l.$>>S;l.bY(x,0,I,I,0,0,1),l.M(x,x,[-k*I,-A*I,0])}else{if(!e.canonical.isChildOf(d.canonical))continue;{const S=e.canonical.z-d.canonical.z,k=e.canonical.x-(e.canonical.x>>S<<S),A=e.canonical.y-(e.canonical.y>>S<<S),I=l.$>>S;l.bY(x,0,l.$,l.$,0,0,1),l.M(x,x,[k*I,A*I,0]),l.N(x,x,[1/2**S,1/2**S,0])}}y.terrainRttPosMatrix32f=new Float32Array(x),s[u]=y}return s}_getTerrainCoordsForTileRanges(e,s){const u={};for(const d of this._renderableTilesKeys){const y=this._tiles[d].tileID;if(!this._isWithinTileRanges(y,s))continue;const x=e.clone(),S=l.ba();if(y.canonical.z===e.canonical.z){const k=e.canonical.x-y.canonical.x,A=e.canonical.y-y.canonical.y;l.bY(S,0,l.$,l.$,0,0,1),l.M(S,S,[k*l.$,A*l.$,0])}else if(y.canonical.z>e.canonical.z){const k=y.canonical.z-e.canonical.z,A=y.canonical.x-(y.canonical.x>>k<<k),I=y.canonical.y-(y.canonical.y>>k<<k),D=e.canonical.x-(y.canonical.x>>k),L=e.canonical.y-(y.canonical.y>>k),O=l.$>>k;l.bY(S,0,O,O,0,0,1),l.M(S,S,[-A*O+D*l.$,-I*O+L*l.$,0])}else{const k=e.canonical.z-y.canonical.z,A=e.canonical.x-(e.canonical.x>>k<<k),I=e.canonical.y-(e.canonical.y>>k<<k),D=(e.canonical.x>>k)-y.canonical.x,L=(e.canonical.y>>k)-y.canonical.y,O=l.$<<k;l.bY(S,0,O,O,0,0,1),l.M(S,S,[A*l.$+D*O,I*l.$+L*O,0])}x.terrainRttPosMatrix32f=new Float32Array(S),u[d]=x}return u}getSourceTile(e,s){const u=this.sourceCache._source;let d=e.overscaledZ-this.deltaZoom;if(d>u.maxzoom&&(d=u.maxzoom),d<u.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(d).key);let y=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!y||!y.dem)&&s)for(;d>=u.minzoom&&(!y||!y.dem);)y=this.sourceCache.getTileByID(e.scaledTo(d--).key);return y}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,s){return s[e.canonical.z]&&e.canonical.x>=s[e.canonical.z].minTileX&&e.canonical.x<=s[e.canonical.z].maxTileX&&e.canonical.y>=s[e.canonical.z].minTileY&&e.canonical.y<=s[e.canonical.z].maxTileY}}class dt{constructor(e,s,u){this._meshCache={},this.painter=e,this.sourceCache=new ot(s),this.options=u,this.exaggeration=typeof u.exaggeration=="number"?u.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,s,u,d=l.$){var y;if(!(s>=0&&s<d&&u>=0&&u<d))return 0;const x=this.getTerrainData(e),S=(y=x.tile)===null||y===void 0?void 0:y.dem;if(!S)return 0;const k=l.cs([],[s/d*l.$,u/d*l.$],x.u_terrain_matrix),A=[k[0]*S.dim,k[1]*S.dim],I=Math.floor(A[0]),D=Math.floor(A[1]),L=A[0]-I,O=A[1]-D;return S.get(I,D)*(1-L)*(1-O)+S.get(I+1,D)*L*(1-O)+S.get(I,D+1)*(1-L)*O+S.get(I+1,D+1)*L*O}getElevationForLngLatZoom(e,s){if(!l.ct(s,e.wrap()))return 0;const{tileID:u,mercatorX:d,mercatorY:y}=this._getOverscaledTileIDFromLngLatZoom(e,s);return this.getElevation(u,d%l.$,y%l.$,l.$)}getElevation(e,s,u,d=l.$){return this.getDEMElevation(e,s,u,d)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const d=this.painter.context,y=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new l.T(d,y,d.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new l.T(d,new l.R({width:1,height:1}),d.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.ag([])}const s=this.sourceCache.getSourceTile(e,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const d=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new l.T(d,s.dem.getPixels(),d.gl.RGBA,{premultiply:!1}),s.demTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const u=s&&s+s.tileID.key+e.key;if(u&&!this._demMatrixCache[u]){const d=this.sourceCache.sourceCache._source.maxzoom;let y=e.canonical.z-s.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=d?y=e.canonical.z-d:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const x=e.canonical.x-(e.canonical.x>>y<<y),S=e.canonical.y-(e.canonical.y>>y<<y),k=l.cu(new Float64Array(16),[1/(l.$<<y),1/(l.$<<y),0]);l.M(k,k,[x*l.$,S*l.$,0]),this._demMatrixCache[e.key]={matrix:k,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:u?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(e){const s=this.painter,u=s.width/devicePixelRatio,d=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===u&&this._fbo.height===d||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new l.T(s.context,{width:u,height:d,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new l.T(s.context,{width:u,height:d,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(u,d,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,u,d))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let y=0,x=0;y<this._coordsTextureSize;y++)for(let S=0;S<this._coordsTextureSize;S++,x+=4)s[x+0]=255&S,s[x+1]=255&y,s[x+2]=S>>8<<4|y>>8,s[x+3]=0;const u=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),d=new l.T(e,u,e.gl.RGBA,{premultiply:!1});return d.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=d,d}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const s=new Uint8Array(4),u=this.painter.context,d=u.gl,y=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),x=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),S=Math.round(this.painter.height/devicePixelRatio);u.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),d.readPixels(y,S-x-1,1,1,d.RGBA,d.UNSIGNED_BYTE,s),u.bindFramebuffer.set(null);const k=s[0]+(s[2]>>4<<8),A=s[1]+((15&s[2])<<8),I=this.coordsIndex[255-s[3]],D=I&&this.sourceCache.getTileByID(I);if(!D)return null;const L=this._coordsTextureSize,O=(1<<D.tileID.canonical.z)*L;return new l.a1((D.tileID.canonical.x*L+k)/O+D.tileID.wrap,(D.tileID.canonical.y*L+A)/O,this.getElevation(D.tileID,k,A,L))}depthAtPoint(e){const s=new Uint8Array(4),u=this.painter.context,d=u.gl;return u.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),d.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,d.RGBA,d.UNSIGNED_BYTE,s),u.bindFramebuffer.set(null),(s[0]/16777216+s[1]/65536+s[2]/256+s[3])/256}getTerrainMesh(e){var s;const u=((s=this.painter.style.projection)===null||s===void 0?void 0:s.transitionState)>0,d=u&&e.canonical.y===0,y=u&&e.canonical.y===(1<<e.canonical.z)-1,x=`m_${d?"n":""}_${y?"s":""}`;if(this._meshCache[x])return this._meshCache[x];const S=this.painter.context,k=new l.cv,A=new l.aN,I=this.meshSize,D=l.$/I,L=I*I;for(let re=0;re<=I;re++)for(let _e=0;_e<=I;_e++)k.emplaceBack(_e*D,re*D,0);for(let re=0;re<L;re+=I+1)for(let _e=0;_e<I;_e++)A.emplaceBack(_e+re,I+_e+re+1,I+_e+re+2),A.emplaceBack(_e+re,I+_e+re+2,_e+re+1);const O=k.length,U=O+(I+1),K=(I+1)*I,X=d?l.bh:0,Y=d?0:1,ee=y?l.bi:l.$,ne=y?0:1;for(let re=0;re<=I;re++)k.emplaceBack(re*D,X,Y);for(let re=0;re<=I;re++)k.emplaceBack(re*D,ee,ne);for(let re=0;re<I;re++)A.emplaceBack(K+re,U+re,U+re+1),A.emplaceBack(K+re,U+re+1,K+re+1),A.emplaceBack(0+re,O+re+1,O+re),A.emplaceBack(0+re,0+re+1,O+re+1);const te=k.length,oe=te+2*(I+1);for(const re of[0,1])for(let _e=0;_e<=I;_e++)for(const Me of[0,1])k.emplaceBack(re*l.$,_e*D,Me);for(let re=0;re<2*I;re+=2)A.emplaceBack(te+re,te+re+1,te+re+3),A.emplaceBack(te+re,te+re+3,te+re+2),A.emplaceBack(oe+re,oe+re+3,oe+re+1),A.emplaceBack(oe+re,oe+re+2,oe+re+3);const ce=new uo(S.createVertexBuffer(k,kc.members),S.createIndexBuffer(A),l.aM.simpleSegment(0,0,k.length,A.length));return this._meshCache[x]=ce,ce}getMeshFrameDelta(e){return 2*Math.PI*l.bu/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,s){var u;const{tileID:d}=this._getOverscaledTileIDFromLngLatZoom(e,s);return(u=this.getMinMaxElevation(d).minElevation)!==null&&u!==void 0?u:0}getMinMaxElevation(e){const s=this.getTerrainData(e).tile,u={minElevation:null,maxElevation:null};return s&&s.dem&&(u.minElevation=s.dem.min*this.exaggeration,u.maxElevation=s.dem.max*this.exaggeration),u}_getOverscaledTileIDFromLngLatZoom(e,s){const u=l.a1.fromLngLat(e.wrap()),d=(1<<s)*l.$,y=u.x*d,x=u.y*d,S=Math.floor(y/l.$),k=Math.floor(x/l.$);return{tileID:new l.Z(s,0,s,S,k),mercatorX:y,mercatorY:x}}}class Cc{constructor(e,s,u){this._context=e,this._size=s,this._tileSize=u,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),u=new l.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return u.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(u.texture),{id:e,fbo:s,texture:u,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((s=>e.id!==s)),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((e=>!e.inUse))===!1}}const Ga={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Pc{constructor(e,s){this.painter=e,this.terrain=s,this.pool=new Cc(e.context,30,s.sourceCache.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter((u=>!e._layers[u].isHidden(s))),this._coordsAscending={};for(const u in e.sourceCaches){this._coordsAscending[u]={};const d=e.sourceCaches[u].getVisibleCoordinates(),y=e.sourceCaches[u].getSource(),x=y instanceof Gn?y.terrainTileRanges:null;for(const S of d){const k=this.terrain.sourceCache.getTerrainCoords(S,x);for(const A in k)this._coordsAscending[u][A]||(this._coordsAscending[u][A]=[]),this._coordsAscending[u][A].push(k[A])}}this._coordsAscendingStr={};for(const u of e._order){const d=e._layers[u],y=d.source;if(Ga[d.type]&&!this._coordsAscendingStr[y]){this._coordsAscendingStr[y]={};for(const x in this._coordsAscending[y])this._coordsAscendingStr[y][x]=this._coordsAscending[y][x].map((S=>S.key)).sort().join()}}for(const u of this._renderableTiles)for(const d in this._coordsAscendingStr){const y=this._coordsAscendingStr[d][u.tileID.key];y&&y!==u.rttCoords[d]&&(u.rtt=[])}}renderLayer(e,s){if(e.isHidden(this.painter.transform.zoom))return!1;const u=Object.assign(Object.assign({},s),{isRenderingToTexture:!0}),d=e.type,y=this.painter,x=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(Ga[d]&&(this._prevType&&Ga[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(e.id),!x))return!0;if(Ga[this._prevType]||Ga[d]&&x){this._prevType=d;const S=this._stacks.length-1,k=this._stacks[S]||[];for(const A of this._renderableTiles){if(this.pool.isFull()&&(vc(this.painter,this.terrain,this._rttTiles,u),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(A),A.rtt[S]){const D=this.pool.getObjectForId(A.rtt[S].id);if(D.stamp===A.rtt[S].stamp){this.pool.useObject(D);continue}}const I=this.pool.getOrCreateFreeObject();this.pool.useObject(I),this.pool.stampObject(I),A.rtt[S]={id:I.id,stamp:I.stamp},y.context.bindFramebuffer.set(I.fbo.framebuffer),y.context.clear({color:l.bf.transparent,stencil:0}),y.currentStencilSource=void 0;for(let D=0;D<k.length;D++){const L=y.style._layers[k[D]],O=L.source?this._coordsAscending[L.source][A.tileID.key]:[A.tileID];y.context.viewport.set([0,0,I.fbo.width,I.fbo.height]),y._renderTileClippingMasks(L,O,!0),y.renderLayer(y,y.style.sourceCaches[L.source],L,O,u),L.source&&(A.rttCoords[L.source]=this._coordsAscendingStr[L.source][A.tileID.key])}}return vc(this.painter,this.terrain,this._rttTiles,u),this._rttTiles=[],this.pool.freeAllObjects(),Ga[d]}return!1}}const Ri={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use â + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},kd=C,pn={hash:!1,interactive:!0,bearingSnap:7,attributionControl:_h,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},Om={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class ol{constructor(e,s,u=!1){this.mousedown=y=>{this.startMove(y,B.mousePos(this.element,y)),B.addEventListener(window,"mousemove",this.mousemove),B.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=y=>{this.move(y,B.mousePos(this.element,y))},this.mouseup=y=>{this._rotatePitchHandler.dragEnd(y),this.offTemp()},this.touchstart=y=>{y.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=B.touchPos(this.element,y.targetTouches)[0],this.startMove(y,this._startPos),B.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),B.addEventListener(window,"touchend",this.touchend))},this.touchmove=y=>{y.targetTouches.length!==1?this.reset():(this._lastPos=B.touchPos(this.element,y.targetTouches)[0],this.move(y,this._lastPos))},this.touchend=y=>{y.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=s;const d=new Dm;this._rotatePitchHandler=new cs({clickTolerance:3,move:(y,x)=>{const S=s.getBoundingClientRect(),k=new l.P((S.bottom-S.top)/2,(S.right-S.left)/2);return{bearingDelta:l.cn(new l.P(y.x,x.y),x,k),pitchDelta:u?-.5*(x.y-y.y):void 0}},moveStateManager:d,enable:!0,assignEvents:()=>{}}),this.map=e,B.addEventListener(s,"mousedown",this.mousedown),B.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),B.addEventListener(s,"touchcancel",this.reset)}startMove(e,s){this._rotatePitchHandler.dragStart(e,s),B.disableDrag()}move(e,s){const u=this.map,{bearingDelta:d,pitchDelta:y}=this._rotatePitchHandler.dragMove(e,s)||{};d&&u.setBearing(u.getBearing()+d),y&&u.setPitch(u.getPitch()+y)}off(){const e=this.element;B.removeEventListener(e,"mousedown",this.mousedown),B.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),B.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),B.removeEventListener(window,"touchend",this.touchend),B.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){B.enableDrag(),B.removeEventListener(window,"mousemove",this.mousemove),B.removeEventListener(window,"mouseup",this.mouseup),B.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),B.removeEventListener(window,"touchend",this.touchend)}}let sr;function Ir(g,e,s,u=!1){if(u||!s.getCoveringTilesDetailsProvider().allowWorldCopies())return g?.wrap();const d=new l.S(g.lng,g.lat);if(g=new l.S(g.lng,g.lat),e){const y=new l.S(g.lng-360,g.lat),x=new l.S(g.lng+360,g.lat),S=s.locationToScreenPoint(g).distSqr(e);s.locationToScreenPoint(y).distSqr(e)<S?g=y:s.locationToScreenPoint(x).distSqr(e)<S&&(g=x)}for(;Math.abs(g.lng-s.center.lng)>180;){const y=s.locationToScreenPoint(g);if(y.x>=0&&y.y>=0&&y.x<=s.width&&y.y<=s.height)break;g.lng>s.center.lng?g.lng-=360:g.lng+=360}return g.lng!==d.lng&&s.isPointOnMapSurface(s.locationToScreenPoint(g))?g:d}const Mc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ds(g,e,s){const u=g.classList;for(const d in Mc)u.remove(`maplibregl-${s}-anchor-${d}`);u.add(`maplibregl-${s}-anchor-${e}`)}class fs extends l.E{constructor(e){if(super(),this._onKeyPress=s=>{const u=s.code,d=s.charCode||s.keyCode;u!=="Space"&&u!=="Enter"&&d!==32&&d!==13||this.togglePopup()},this._onMapClick=s=>{const u=s.originalEvent.target,d=this._element;this._popup&&(u===d||d.contains(u))&&this.togglePopup()},this._update=s=>{if(!this._map)return;const u=this._map.loaded()&&!this._map.isMoving();(s?.type==="terrain"||s?.type==="render"&&!u)&&this._map.once("render",this._update),this._lngLat=Ir(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(d=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let y="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?y="rotateX(0deg)":this._pitchAlignment==="map"&&(y=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||s&&s.type!=="moveend"||(this._pos=this._pos.round()),B.setTransform(this._element,`${Mc[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${y} ${d}`),G.frameAsync(new AbortController).then((()=>{this._updateOpacity(s&&s.type==="moveend")})).catch((()=>{}))},this._onMove=s=>{if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.l("dragstart"))),this.fire(new l.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.l("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=l.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=B.create("div");const s=B.createNS("http://www.w3.org/2000/svg","svg"),u=41,d=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${u}px`),s.setAttributeNS(null,"width",`${d}px`),s.setAttributeNS(null,"viewBox",`0 0 ${d} ${u}`);const y=B.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd");const x=B.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"fill-rule","nonzero");const S=B.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"transform","translate(3.0, 29.0)"),S.setAttributeNS(null,"fill","#000000");const k=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Y of k){const ee=B.createNS("http://www.w3.org/2000/svg","ellipse");ee.setAttributeNS(null,"opacity","0.04"),ee.setAttributeNS(null,"cx","10.5"),ee.setAttributeNS(null,"cy","5.80029008"),ee.setAttributeNS(null,"rx",Y.rx),ee.setAttributeNS(null,"ry",Y.ry),S.appendChild(ee)}const A=B.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill",this._color);const I=B.createNS("http://www.w3.org/2000/svg","path");I.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),A.appendChild(I);const D=B.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"opacity","0.25"),D.setAttributeNS(null,"fill","#000000");const L=B.createNS("http://www.w3.org/2000/svg","path");L.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),D.appendChild(L);const O=B.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"transform","translate(6.0, 7.0)"),O.setAttributeNS(null,"fill","#FFFFFF");const U=B.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"transform","translate(8.0, 8.0)");const K=B.createNS("http://www.w3.org/2000/svg","circle");K.setAttributeNS(null,"fill","#000000"),K.setAttributeNS(null,"opacity","0.25"),K.setAttributeNS(null,"cx","5.5"),K.setAttributeNS(null,"cy","5.5"),K.setAttributeNS(null,"r","5.4999962");const X=B.createNS("http://www.w3.org/2000/svg","circle");X.setAttributeNS(null,"fill","#FFFFFF"),X.setAttributeNS(null,"cx","5.5"),X.setAttributeNS(null,"cy","5.5"),X.setAttributeNS(null,"r","5.4999962"),U.appendChild(K),U.appendChild(X),x.appendChild(S),x.appendChild(A),x.appendChild(D),x.appendChild(O),x.appendChild(U),s.appendChild(x),s.setAttributeNS(null,"height",u*this._scale+"px"),s.setAttributeNS(null,"width",d*this._scale+"px"),this._element.appendChild(s),this._offset=l.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(s=>{s.preventDefault()})),this._element.addEventListener("mousedown",(s=>{s.preventDefault()})),ds(this._element,this._anchor,"marker"),e&&e.className)for(const s of e.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),B.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=l.S.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const d=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(38.1-13.5+d)],"bottom-right":[-d,-1*(38.1-13.5+d)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var s,u;const d=(s=this._map)===null||s===void 0?void 0:s.terrain,y=this._map.transform.isLocationOccluded(this._lngLat);if(!d||y){const O=y?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==O&&(this._element.style.opacity=O))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const x=this._map,S=x.terrain.depthAtPoint(this._pos),k=x.terrain.getElevationForLngLatZoom(this._lngLat,x.transform.tileZoom);if(x.transform.lngLatToCameraDepth(this._lngLat,k)-S<.006)return void(this._element.style.opacity=this._opacity);const A=-this._offset.y/x.transform.pixelsPerMeter,I=Math.sin(x.getPitch()*Math.PI/180)*A,D=x.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),L=x.transform.lngLatToCameraDepth(this._lngLat,k+I)-D>.006;!((u=this._popup)===null||u===void 0)&&u.isOpen()&&L&&this._popup.remove(),this._element.style.opacity=L?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=l.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,s){return(this._opacity===void 0||e===void 0&&s===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),s!==void 0&&(this._opacityWhenCovered=s),this._map&&this._updateOpacity(!0),this}}const bh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ms=0,Co=!1;const sl={maxWidth:100,unit:"metric"};function Ac(g,e,s){const u=s&&s.maxWidth||100,d=g._container.clientHeight/2,y=g._container.clientWidth/2,x=g.unproject([y-u/2,d]),S=g.unproject([y+u/2,d]),k=Math.round(g.project(S).x-g.project(x).x),A=Math.min(u,k,g._container.clientWidth),I=x.distanceTo(S);if(s&&s.unit==="imperial"){const D=3.2808*I;D>5280?Po(e,A,D/5280,g._getUIString("ScaleControl.Miles")):Po(e,A,D,g._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?Po(e,A,I/1852,g._getUIString("ScaleControl.NauticalMiles")):I>=1e3?Po(e,A,I/1e3,g._getUIString("ScaleControl.Kilometers")):Po(e,A,I,g._getUIString("ScaleControl.Meters"))}function Po(g,e,s,u){const d=(function(y){const x=Math.pow(10,`${Math.floor(y)}`.length-1);let S=y/x;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:(function(k){const A=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*A)/A})(S),x*S})(s);g.style.width=e*(d/s)+"px",g.innerHTML=`${d}&nbsp;${u}`}const xh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},wh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ec(g){if(g){if(typeof g=="number"){const e=Math.round(Math.abs(g)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,g),"top-left":new l.P(e,e),"top-right":new l.P(-e,e),bottom:new l.P(0,-g),"bottom-left":new l.P(e,-e),"bottom-right":new l.P(-e,-e),left:new l.P(g,0),right:new l.P(-g,0)}}if(g instanceof l.P||Array.isArray(g)){const e=l.P.convert(g);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:l.P.convert(g.center||[0,0]),top:l.P.convert(g.top||[0,0]),"top-left":l.P.convert(g["top-left"]||[0,0]),"top-right":l.P.convert(g["top-right"]||[0,0]),bottom:l.P.convert(g.bottom||[0,0]),"bottom-left":l.P.convert(g["bottom-left"]||[0,0]),"bottom-right":l.P.convert(g["bottom-right"]||[0,0]),left:l.P.convert(g.left||[0,0]),right:l.P.convert(g.right||[0,0])}}return Ec(new l.P(0,0))}const Th=C;f.AJAXError=l.cz,f.Event=l.l,f.Evented=l.E,f.LngLat=l.S,f.MercatorCoordinate=l.a1,f.Point=l.P,f.addProtocol=l.cA,f.config=l.a,f.removeProtocol=l.cB,f.AttributionControl=vh,f.BoxZoomHandler=hh,f.CanvasSource=Ia,f.CooperativeGesturesHandler=wd,f.DoubleClickZoomHandler=fh,f.DragPanHandler=bd,f.DragRotateHandler=gh,f.EdgeInsets=po,f.FullscreenControl=class extends l.E{constructor(g={}){super(),this._onFullscreenChange=()=>{var e;let s=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=s?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)s=s.shadowRoot.fullscreenElement;s===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=B.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){B.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const g=this._fullscreenButton=B.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);B.create("span","maplibregl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.title=g}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},f.GeoJSONSource=qn,f.GeolocateControl=class extends l.E{constructor(g){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new l.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const s=new l.S(e.coords.longitude,e.coords.latitude),u=e.coords.accuracy,d=this._map.getBearing(),y=l.e({bearing:d},this.options.fitBoundsOptions),x=Yt.fromLngLat(s,u);this._map.fitBounds(x,y,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const s=new l.S(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Co)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=B.create("button","maplibregl-ctrl-geolocate",this._container),B.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=B.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new fs({element:this._dotElement}),this._circleElement=B.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new fs({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(s=>{const u=s?.[0]instanceof ResizeObserverEntry;s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||u||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.l("trackuserlocationend")),this.fire(new l.l("userlocationlostfocus")))}))}},this.options=l.e({},bh,g)}onAdd(g){return this._map=g,this._container=B.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return l._(this,arguments,void 0,(function*(e=!1){if(sr!==void 0&&!e)return sr;if(window.navigator.permissions===void 0)return sr=!!window.navigator.geolocation,sr;try{sr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{sr=!!window.navigator.geolocation}return sr}))})().then((e=>this._finishSetupUI(e))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),B.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ms=0,Co=!1}_isOutOfMapMaxBounds(g){const e=this._map.getMaxBounds(),s=g.coords;return e&&(s.longitude<e.getWest()||s.longitude>e.getEast()||s.latitude<e.getSouth()||s.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const g=this._map.getBounds(),e=g.getSouthEast(),s=g.getNorthEast(),u=e.distanceTo(s),d=Math.ceil(this._accuracy/(u/this._map._container.clientHeight)*2);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ms--,Co=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.l("trackuserlocationstart")),this.fire(new l.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ms++,ms>1?(g={maximumAge:6e5,timeout:0},Co=!0):(g=this.options.positionOptions,Co=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,g)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},f.GlobeControl=class{constructor(){this._toggleProjection=()=>{var g;const e=(g=this._map.getProjection())===null||g===void 0?void 0:g.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var g;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((g=this._map.getProjection())===null||g===void 0?void 0:g.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(g){return this._map=g,this._container=B.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=B.create("button","maplibregl-ctrl-globe",this._container),B.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){B.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},f.Hash=bc,f.ImageSource=Gn,f.KeyboardHandler=Tc,f.LngLatBounds=Yt,f.LogoControl=Sd,f.Map=class extends Td{constructor(g){var e,s;l.cw.mark(l.cx.create);const u=Object.assign(Object.assign(Object.assign({},pn),g),{canvasContextAttributes:Object.assign(Object.assign({},pn.canvasContextAttributes),g.canvasContextAttributes)});if(u.minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const d=new hr,y=new Ti;if(u.minZoom!==void 0&&d.setMinZoom(u.minZoom),u.maxZoom!==void 0&&d.setMaxZoom(u.maxZoom),u.minPitch!==void 0&&d.setMinPitch(u.minPitch),u.maxPitch!==void 0&&d.setMaxPitch(u.maxPitch),u.renderWorldCopies!==void 0&&d.setRenderWorldCopies(u.renderWorldCopies),super(d,y,{bearingSnap:u.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Yn,this._controls=[],this._mapId=l.a7(),this._contextLost=S=>{S.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new l.l("webglcontextlost",{originalEvent:S}))},this._contextRestored=S=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.l("webglcontextrestored",{originalEvent:S}))},this._onMapScroll=S=>{if(S.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=u.interactive,this._maxTileCacheSize=u.maxTileCacheSize,this._maxTileCacheZoomLevels=u.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},u.canvasContextAttributes),this._trackResize=u.trackResize===!0,this._bearingSnap=u.bearingSnap,this._centerClampedToGround=u.centerClampedToGround,this._refreshExpiredTiles=u.refreshExpiredTiles===!0,this._fadeDuration=u.fadeDuration,this._crossSourceCollisions=u.crossSourceCollisions===!0,this._collectResourceTiming=u.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Ri),u.locale),this._clickTolerance=u.clickTolerance,this._overridePixelRatio=u.pixelRatio,this._maxCanvasSize=u.maxCanvasSize,this.transformCameraUpdate=u.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=u.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=he.addThrottleControl((()=>this.isMoving())),this._requestManager=new fe(u.transformRequest),typeof u.container=="string"){if(this._container=document.getElementById(u.container),!this._container)throw new Error(`Container '${u.container}' not found.`)}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(u.maxBounds&&this.setMaxBounds(u.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let S=!1;const k=So((A=>{this._trackResize&&!this._removed&&(this.resize(A),this.redraw())}),50);this._resizeObserver=new ResizeObserver((A=>{S?k(A):S=!0})),this._resizeObserver.observe(this._container)}this.handlers=new yh(this,u),this._hash=u.hash&&new bc(typeof u.hash=="string"&&u.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:u.center,elevation:u.elevation,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch,roll:u.roll}),u.bounds&&(this.resize(),this.fitBounds(u.bounds,l.e({},u.fitBoundsOptions,{duration:0}))));const x=typeof u.style=="string"||((s=(e=u.style)===null||e===void 0?void 0:e.projection)===null||s===void 0?void 0:s.type)!=="globe";this.resize(null,x),this._localIdeographFontFamily=u.localIdeographFontFamily,this._validateStyle=u.validateStyle,u.style&&this.setStyle(u.style,{localIdeographFontFamily:u.localIdeographFontFamily}),u.attributionControl&&this.addControl(new vh(typeof u.attributionControl=="boolean"?void 0:u.attributionControl)),u.maplibreLogo&&this.addControl(new Sd,u.logoPosition),this.on("style.load",(()=>{if(x||this._resizeTransform(),this.transform.unmodified){const S=l.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(S)}})),this.on("data",(S=>{this._update(S.dataType==="style"),this.fire(new l.l(`${S.dataType}data`,S))})),this.on("dataloading",(S=>{this.fire(new l.l(`${S.dataType}dataloading`,S))})),this.on("dataabort",(S=>{this.fire(new l.l("sourcedataabort",S))}))}_getMapId(){return this._mapId}setGlobalStateProperty(g,e){return this.style.setGlobalStateProperty(g,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(g,e){if(e===void 0&&(e=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new l.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=g.onAdd(this);this._controls.push(g);const u=this._controlPositions[e];return e.indexOf("bottom")!==-1?u.insertBefore(s,u.firstChild):u.appendChild(s),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new l.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(g);return e>-1&&this._controls.splice(e,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}calculateCameraOptionsFromTo(g,e,s,u){return u==null&&this.terrain&&(u=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(g,e,s,u)}resize(g,e=!0){const[s,u]=this._containerDimensions(),d=this._getClampedPixelRatio(s,u);if(this._resizeCanvas(s,u,d),this.painter.resize(s,u,d),this.painter.overLimit()){const x=this.painter.context.gl;this._maxCanvasSize=[x.drawingBufferWidth,x.drawingBufferHeight];const S=this._getClampedPixelRatio(s,u);this._resizeCanvas(s,u,S),this.painter.resize(s,u,S)}this._resizeTransform(e);const y=!this._moving;return y&&(this.stop(),this.fire(new l.l("movestart",g)).fire(new l.l("move",g))),this.fire(new l.l("resize",g)),y&&this.fire(new l.l("moveend",g)),this}_resizeTransform(g=!0){var e;const[s,u]=this._containerDimensions();this.transform.resize(s,u,g),(e=this._requestedCameraState)===null||e===void 0||e.resize(s,u,g)}_getClampedPixelRatio(g,e){const{0:s,1:u}=this._maxCanvasSize,d=this.getPixelRatio(),y=g*d,x=e*d;return Math.min(y>s?s/y:1,x>u?u/x:1)*d}getPixelRatio(){var g;return(g=this._overridePixelRatio)!==null&&g!==void 0?g:devicePixelRatio}setPixelRatio(g){this._overridePixelRatio=g,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(g){return this.transform.setMaxBounds(Yt.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.setMinZoom(g),this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.setMaxZoom(g),this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.setMinPitch(g),this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(g>=this.transform.minPitch)return this.transform.setMaxPitch(g),this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.setRenderWorldCopies(g),this._update()}project(g){return this.transform.locationToScreenPoint(l.S.convert(g),this.style&&this.terrain)}unproject(g){return this.transform.screenPointToLocation(l.P.convert(g),this.terrain)}isMoving(){var g;return this._moving||((g=this.handlers)===null||g===void 0?void 0:g.isMoving())}isZooming(){var g;return this._zooming||((g=this.handlers)===null||g===void 0?void 0:g.isZooming())}isRotating(){var g;return this._rotating||((g=this.handlers)===null||g===void 0?void 0:g.isRotating())}_createDelegatedListener(g,e,s){if(g==="mouseenter"||g==="mouseover"){let u=!1;return{layers:e,listener:s,delegates:{mousemove:y=>{const x=e.filter((k=>this.getLayer(k))),S=x.length!==0?this.queryRenderedFeatures(y.point,{layers:x}):[];S.length?u||(u=!0,s.call(this,new Zi(g,this,y.originalEvent,{features:S}))):u=!1},mouseout:()=>{u=!1}}}}if(g==="mouseleave"||g==="mouseout"){let u=!1;return{layers:e,listener:s,delegates:{mousemove:x=>{const S=e.filter((k=>this.getLayer(k)));(S.length!==0?this.queryRenderedFeatures(x.point,{layers:S}):[]).length?u=!0:u&&(u=!1,s.call(this,new Zi(g,this,x.originalEvent)))},mouseout:x=>{u&&(u=!1,s.call(this,new Zi(g,this,x.originalEvent)))}}}}{const u=d=>{const y=e.filter((S=>this.getLayer(S))),x=y.length!==0?this.queryRenderedFeatures(d.point,{layers:y}):[];x.length&&(d.features=x,s.call(this,d),delete d.features)};return{layers:e,listener:s,delegates:{[g]:u}}}}_saveDelegatedListener(g,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(e)}_removeDelegatedListener(g,e,s){if(!this._delegatedListeners||!this._delegatedListeners[g])return;const u=this._delegatedListeners[g];for(let d=0;d<u.length;d++){const y=u[d];if(y.listener===s&&y.layers.length===e.length&&y.layers.every((x=>e.includes(x)))){for(const x in y.delegates)this.off(x,y.delegates[x]);return void u.splice(d,1)}}}on(g,e,s){if(s===void 0)return super.on(g,e);const u=typeof e=="string"?[e]:e,d=this._createDelegatedListener(g,u,s);this._saveDelegatedListener(g,d);for(const y in d.delegates)this.on(y,d.delegates[y]);return{unsubscribe:()=>{this._removeDelegatedListener(g,u,s)}}}once(g,e,s){if(s===void 0)return super.once(g,e);const u=typeof e=="string"?[e]:e,d=this._createDelegatedListener(g,u,s);for(const y in d.delegates){const x=d.delegates[y];d.delegates[y]=(...S)=>{this._removeDelegatedListener(g,u,s),x(...S)}}this._saveDelegatedListener(g,d);for(const y in d.delegates)this.once(y,d.delegates[y]);return this}off(g,e,s){return s===void 0?super.off(g,e):(this._removeDelegatedListener(g,typeof e=="string"?[e]:e,s),this)}queryRenderedFeatures(g,e){if(!this.style)return[];let s;const u=g instanceof l.P||Array.isArray(g),d=u?g:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(u?{}:g)||{},d instanceof l.P||typeof d[0]=="number")s=[l.P.convert(d)];else{const y=l.P.convert(d[0]),x=l.P.convert(d[1]);s=[y,new l.P(x.x,y.y),x,new l.P(y.x,x.y),y]}return this.style.queryRenderedFeatures(s,e,this.transform)}querySourceFeatures(g,e){return this.style.querySourceFeatures(g,e)}setStyle(g,e){return(e=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(g,e))}setTransformRequest(g){return this._requestManager.setTransformRequest(g),this}_getUIString(g){const e=this._locale[g];if(e==null)throw new Error(`Missing UI string '${g}'`);return e}_updateStyle(g,e){var s,u;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(g,e)));const d=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!g)),g?(this.style=new $u(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g,e,d):this.style.loadJSON(g,e,d),this):((u=(s=this.style)===null||s===void 0?void 0:s.projection)===null||u===void 0||u.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new $u(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,e){if(typeof g=="string"){const s=this._requestManager.transformRequest(g,"Style");l.j(s,new AbortController).then((u=>{this._updateDiff(u.data,e)})).catch((u=>{u&&this.fire(new l.k(u))}))}else typeof g=="object"&&this._updateDiff(g,e)}_updateDiff(g,e){try{this.style.setState(g,e)&&this._update(!0)}catch(s){l.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(g,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(g,e){return this._lazyInitEmptyStyle(),this.style.addSource(g,e),this._update(!0)}isSourceLoaded(g){const e=this.style&&this.style.sourceCaches[g];if(e!==void 0)return e.loaded();this.fire(new l.k(new Error(`There is no source with ID '${g}'`)))}setTerrain(g){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),g){const e=this.style.sourceCaches[g.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${g.source}`);this.terrain===null&&e.reload();for(const s in this.style._layers){const u=this.style._layers[s];u.type==="hillshade"&&u.source===g.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),u.type==="color-relief"&&u.source===g.source&&l.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new dt(this.painter,e,g),this.painter.renderToTexture=new Pc(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=s=>{var u;s.dataType==="style"?this.terrain.sourceCache.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId!==g.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((u=s.source)===null||u===void 0?void 0:u.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new l.l("terrain",{terrain:g})),this}getTerrain(){var g,e;return(e=(g=this.terrain)===null||g===void 0?void 0:g.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const g=this.style&&this.style.sourceCaches;for(const e in g){const s=g[e]._tiles;for(const u in s){const d=s[u];if(d.state!=="loaded"&&d.state!=="errored")return!1}}return!0}removeSource(g){return this.style.removeSource(g),this._update(!0)}getSource(g){return this.style.getSource(g)}setSourceTileLodParams(g,e,s){if(s){const u=this.getSource(s);if(!u)throw new Error(`There is no source with ID "${s}", cannot set LOD parameters`);u.calculateTileZoom=je(Math.max(1,g),Math.max(1,e))}else for(const u in this.style.sourceCaches)this.style.sourceCaches[u].getSource().calculateTileZoom=je(Math.max(1,g),Math.max(1,e));return this._update(!0),this}refreshTiles(g,e){const s=this.style.sourceCaches[g];if(!s)throw new Error(`There is no source cache with ID "${g}", cannot refresh tile`);e===void 0?s.reload(!0):s.refreshTiles(e.map((u=>new l.a4(u.z,u.x,u.y))))}addImage(g,e,s={}){const{pixelRatio:u=1,sdf:d=!1,stretchX:y,stretchY:x,content:S,textFitWidth:k,textFitHeight:A}=s;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||l.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new l.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:I,height:D,data:L}=e,O=e;return this.style.addImage(g,{data:new l.R({width:I,height:D},new Uint8Array(L)),pixelRatio:u,stretchX:y,stretchY:x,content:S,textFitWidth:k,textFitHeight:A,sdf:d,version:0,userImage:O}),O.onAdd&&O.onAdd(this,g),this}}{const{width:I,height:D,data:L}=G.getImageData(e);this.style.addImage(g,{data:new l.R({width:I,height:D},L),pixelRatio:u,stretchX:y,stretchY:x,content:S,textFitWidth:k,textFitHeight:A,sdf:d,version:0})}}updateImage(g,e){const s=this.style.getImage(g);if(!s)return this.fire(new l.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=e instanceof HTMLImageElement||l.b(e)?G.getImageData(e):e,{width:d,height:y,data:x}=u;if(d===void 0||y===void 0)return this.fire(new l.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(d!==s.data.width||y!==s.data.height)return this.fire(new l.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const S=!(e instanceof HTMLImageElement||l.b(e));return s.data.replace(x,S),this.style.updateImage(g,s),this}getImage(g){return this.style.getImage(g)}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new l.k(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g){return he.getImage(this._requestManager.transformRequest(g,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(g,e){return this._lazyInitEmptyStyle(),this.style.addLayer(g,e),this._update(!0)}moveLayer(g,e){return this.style.moveLayer(g,e),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(g,e,s){return this.style.setLayerZoomRange(g,e,s),this._update(!0)}setFilter(g,e,s={}){return this.style.setFilter(g,e,s),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,e,s,u={}){return this.style.setPaintProperty(g,e,s,u),this._update(!0)}getPaintProperty(g,e){return this.style.getPaintProperty(g,e)}setLayoutProperty(g,e,s,u={}){return this.style.setLayoutProperty(g,e,s,u),this._update(!0)}getLayoutProperty(g,e){return this.style.getLayoutProperty(g,e)}setGlyphs(g,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(g,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(g,e,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(g,e,s,(u=>{u||this._update(!0)})),this}removeSprite(g){return this._lazyInitEmptyStyle(),this.style.removeSprite(g),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(g,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(g,e,(s=>{s||this._update(!0)})),this}setLight(g,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(g,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(g,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(g,e){return this.style.setFeatureState(g,e),this._update()}removeFeatureState(g,e){return this.style.removeFeatureState(g,e),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let g=0,e=0;return this._container&&(g=this._container.clientWidth||400,e=this._container.clientHeight||300),[g,e]}_setupContainer(){const g=this._container;g.classList.add("maplibregl-map");const e=this._canvasContainer=B.create("div","maplibregl-canvas-container",g);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=B.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),u=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],u);const d=this._controlContainer=B.create("div","maplibregl-control-container",g),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((x=>{y[x]=B.create("div",`maplibregl-ctrl-${x} `,d)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,e,s){this._canvas.width=Math.floor(s*g),this._canvas.height=Math.floor(s*e),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const g=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",(u=>{e={requestedAttributes:g},u&&(e.statusMessage=u.statusMessage,e.type=u.type)}),{once:!0});let s=null;if(s=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,g):this._canvas.getContext("webgl2",g)||this._canvas.getContext("webgl",g),!s){const u="Failed to initialize WebGL";throw e?(e.message=u,new Error(JSON.stringify(e))):new Error(u)}this.painter=new cd(s,this.transform),J.testSupport(s)}migrateProjection(g,e){super.migrateProjection(g,e),this.painter.transform=g,this.fire(new l.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_render(g){var e,s,u,d,y;const x=this._idleTriggered?this._fadeDuration:0,S=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),this._removed)return;let k=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const D=this.transform.zoom,L=G.now();this.style.zoomHistory.update(D,L);const O=new l.F(D,{now:L,fadeDuration:x,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),U=O.crossFadingFactor();U===1&&U===this._crossFadingFactor||(k=!0,this._crossFadingFactor=U),this.style.update(O)}const A=((s=this.style.projection)===null||s===void 0?void 0:s.transitionState)>0!==S;(u=this.style.projection)===null||u===void 0||u.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((d=this.style.projection)===null||d===void 0?void 0:d.transitionState,(y=this.style.projection)===null||y===void 0?void 0:y.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||A)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,x,this._crossSourceCollisions,A),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,showPadding:this.showPadding}),this.fire(new l.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.cw.mark(l.cx.load),this.fire(new l.l("load"))),this.style&&(this.style.hasTransitions()||k)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const I=this._sourcesDirty||this._styleDirty||this._placementDirty;return I||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.l("idle")),!this._loaded||this._fullyLoaded||I||(this._fullyLoaded=!0,l.cw.mark(l.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var g;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),he.removeThrottleControl(this._imageQueueHandle),(g=this._resizeObserver)===null||g===void 0||g.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),B.remove(this._canvasContainer),B.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),l.cw.clearMetrics(),this._removed=!0,this.fire(new l.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,G.frame(this._frameRequest,(g=>{l.cw.frame(g),this._frameRequest=null;try{this._render(g)}catch(e){if(!l.cy(e)&&!(function(s){return s.message===Ks})(e))throw e}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get version(){return kd}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(g){return this._lazyInitEmptyStyle(),this.style.setProjection(g),this._update(!0)}},f.MapMouseEvent=Zi,f.MapTouchEvent=os,f.MapWheelEvent=uh,f.Marker=fs,f.NavigationControl=class{constructor(g){this._updateZoomButtons=()=>{const e=this._map.getZoom(),s=e===this._map.getMaxZoom(),u=e===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,s)=>{const u=this._map._getUIString(`NavigationControl.${s}`);e.title=u,e.setAttribute("aria-label",u)},this.options=l.e({},Om,g),this._container=B.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),B.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),B.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})),this._compassIcon=B.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ol(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){B.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(g,e){const s=B.create("button",g,this._container);return s.type="button",s.addEventListener("click",e),s}},f.Popup=class extends l.E{constructor(g){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&B.remove(this._content),this._container&&(B.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=B.create("div","maplibregl-popup",this._map.getContainer()),this._tip=B.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const x of this.options.className.split(" "))this._container.classList.add(x);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Ir(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const s=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let u=this.options.anchor;const d=Ec(this.options.offset);if(!u){const x=this._container.offsetWidth,S=this._container.offsetHeight;let k;k=s.y+d.bottom.y<S?["top"]:s.y>this._map.transform.height-S?["bottom"]:[],s.x<x/2?k.push("left"):s.x>this._map.transform.width-x/2&&k.push("right"),u=k.length===0?"bottom":k.join("-")}let y=s.add(d[u]);this.options.subpixelPositioning||(y=y.round()),B.setTransform(this._container,`${Mc[u]} translate(${y.x}px,${y.y}px)`),ds(this._container,u,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(xh),g)}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(g){return this._lngLat=l.S.convert(g),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const e=document.createDocumentFragment(),s=document.createElement("body");let u;for(s.innerHTML=g;u=s.firstChild,u;)e.appendChild(u);return this.setDOMContent(e)}getMaxWidth(){var g;return(g=this._container)===null||g===void 0?void 0:g.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=B.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(g),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(g){return this._container&&this._container.classList.add(g),this}removeClassName(g){return this._container&&this._container.classList.remove(g),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){if(this._container)return this._container.classList.toggle(g)}setSubpixelPositioning(g){this.options.subpixelPositioning=g}_createCloseButton(){this.options.closeButton&&(this._closeButton=B.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(wh);g&&g.focus()}},f.RasterDEMTileSource=so,f.RasterTileSource=qi,f.ScaleControl=class{constructor(g){this._onMove=()=>{Ac(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Ac(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},sl),g)}getDefaultPosition(){return"bottom-left"}onAdd(g){return this._map=g,this._container=B.create("div","maplibregl-ctrl maplibregl-ctrl-scale",g.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){B.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},f.ScrollZoomHandler=_d,f.Style=$u,f.TerrainControl=class{constructor(g){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=g}onAdd(g){return this._map=g,this._container=B.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=B.create("button","maplibregl-ctrl-terrain",this._container),B.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){B.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},f.TwoFingersTouchPitchHandler=wc,f.TwoFingersTouchRotateHandler=hs,f.TwoFingersTouchZoomHandler=xc,f.TwoFingersTouchZoomRotateHandler=xd,f.VectorTileSource=Hr,f.VideoSource=Zo,f.addSourceType=(g,e)=>l._(void 0,void 0,void 0,(function*(){if(Ra(g))throw new Error(`A source type called "${g}" already exists.`);((s,u)=>{za[s]=u})(g,e)})),f.clearPrewarmedResources=function(){const g=gt;g&&(g.isPreloaded()&&g.numActive()===1?(g.release(Qe),gt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},f.createTileMesh=Ou,f.getMaxParallelImageRequests=function(){return l.a.MAX_PARALLEL_IMAGE_REQUESTS},f.getRTLTextPluginStatus=function(){return Fa().getRTLTextPluginStatus()},f.getVersion=function(){return Th},f.getWorkerCount=function(){return lt.workerCount},f.getWorkerUrl=function(){return l.a.WORKER_URL},f.importScriptInWorkers=function(g){return br().broadcast("IS",g)},f.prewarm=function(){Kt().acquire(Qe)},f.setMaxParallelImageRequests=function(g){l.a.MAX_PARALLEL_IMAGE_REQUESTS=g},f.setRTLTextPlugin=function(g,e){return Fa().setRTLTextPlugin(g,e)},f.setWorkerCount=function(g){lt.workerCount=g},f.setWorkerUrl=function(g){l.a.WORKER_URL=g}}));var v=o;return v}))})(rf)),rf.exports}var B5=O5();const ht=Ax(B5);function $5(){return typeof self<"u"?fetch.bind(self):typeof global<"u"&&global.fetch?global.fetch:null}class N5{constructor(){this._apiKey="",this._fetch=$5(),this.tileCacheSize=200}set apiKey(r){this._apiKey=r}get apiKey(){return this._apiKey}set fetch(r){this._fetch=r}get fetch(){return this._fetch}}const hu=new N5,U5={AUTO:{code:null,flag:"auto",name:"Auto",latin:!1,isMode:!0,geocoding:!0},LATIN:{code:"latin",flag:"name:latin",name:"Latin",latin:!0,isMode:!1,geocoding:!1},NON_LATIN:{code:"nonlatin",flag:"name:nonlatin",name:"Non Latin",latin:!1,isMode:!1,geocoding:!1},LOCAL:{code:null,flag:"name",name:"Local",latin:!0,isMode:!1,geocoding:!1}},V5={ALBANIAN:{code:"sq",flag:"name:sq",name:"Albanian",latin:!0,isMode:!1,geocoding:!0},AMHARIC:{code:"am",flag:"name:am",name:"Amharic",latin:!1,isMode:!1,geocoding:!0},ARABIC:{code:"ar",flag:"name:ar",name:"Arabic",latin:!1,isMode:!1,geocoding:!0},ARMENIAN:{code:"hy",flag:"name:hy",name:"Armenian",latin:!1,isMode:!1,geocoding:!0},AZERBAIJANI:{code:"az",flag:"name:az",name:"Azerbaijani",latin:!0,isMode:!1,geocoding:!0},BASQUE:{code:"eu",flag:"name:eu",name:"Basque",latin:!0,isMode:!1,geocoding:!0},BELARUSIAN:{code:"be",flag:"name:be",name:"Belarusian",latin:!1,isMode:!1,geocoding:!0},BENGALI:{code:"bn",flag:"name:bn",name:"Bengali",latin:!0,isMode:!1,geocoding:!0},BOSNIAN:{code:"bs",flag:"name:bs",name:"Bosnian",latin:!0,isMode:!1,geocoding:!0},BRETON:{code:"br",flag:"name:br",name:"Breton",latin:!0,isMode:!1,geocoding:!0},BULGARIAN:{code:"bg",flag:"bg",name:"Bulgarian",latin:!1,isMode:!1,geocoding:!0},CATALAN:{code:"ca",flag:"name:ca",name:"Catalan",latin:!0,isMode:!1,geocoding:!0},CHINESE:{code:"zh",flag:"name:zh",name:"Chinese",latin:!1,isMode:!1,geocoding:!0},TRADITIONAL_CHINESE:{code:"zh-Hant",flag:"name:zh-Hant",name:"Chinese (traditional)",latin:!1,isMode:!1,geocoding:!1},SIMPLIFIED_CHINESE:{code:"zh-Hans",flag:"name:zh-Hans",name:"Chinese (simplified)",latin:!1,isMode:!1,geocoding:!1},CORSICAN:{code:"co",flag:"name:co",name:"Corsican",latin:!0,isMode:!1,geocoding:!0},CROATIAN:{code:"hr",flag:"name:hr",name:"Croatian",latin:!0,isMode:!1,geocoding:!0},CZECH:{code:"cs",flag:"name:cs",name:"Czech",latin:!0,isMode:!1,geocoding:!0},DANISH:{code:"da",flag:"name:da",name:"Danish",latin:!0,isMode:!1,geocoding:!0},DUTCH:{code:"nl",flag:"name:nl",name:"Dutch",latin:!0,isMode:!1,geocoding:!0},GERMAN:{code:"de",flag:"name:de",name:"German",latin:!0,isMode:!1,geocoding:!0},GREEK:{code:"el",flag:"name:el",name:"Greek",latin:!1,isMode:!1,geocoding:!0},ENGLISH:{code:"en",flag:"name:en",name:"English",latin:!0,isMode:!1,geocoding:!0},ESPERANTO:{code:"eo",flag:"name:eo",name:"Esperanto",latin:!0,isMode:!1,geocoding:!0},ESTONIAN:{code:"et",flag:"name:et",name:"Estonian",latin:!0,isMode:!1,geocoding:!0},FINNISH:{code:"fi",flag:"name:fi",name:"Finnish",latin:!0,isMode:!1,geocoding:!0},FRENCH:{code:"fr",flag:"name:fr",name:"French",latin:!0,isMode:!1,geocoding:!0},FRISIAN:{code:"fy",flag:"name:fy",name:"Frisian (West)",latin:!0,isMode:!1,geocoding:!0},GEORGIAN:{code:"ka",flag:"name:ka",name:"Georgian",latin:!1,isMode:!1,geocoding:!0},HEBREW:{code:"he",flag:"name:he",name:"Hebrew",latin:!1,isMode:!1,geocoding:!0},HINDI:{code:"hi",flag:"name:hi",name:"Hindi",latin:!1,isMode:!1,geocoding:!0},HUNGARIAN:{code:"hu",flag:"name:hu",name:"Hungarian",latin:!0,isMode:!1,geocoding:!0},ICELANDIC:{code:"is",flag:"name:is",name:"Icelandic",latin:!0,isMode:!1,geocoding:!0},INDONESIAN:{code:"id",flag:"name:id",name:"Indonesian",latin:!0,isMode:!1,geocoding:!0},IRISH:{code:"ga",flag:"name:ga",name:"Irish",latin:!0,isMode:!1,geocoding:!0},ITALIAN:{code:"it",flag:"name:it",name:"Italian",latin:!0,isMode:!1,geocoding:!0},JAPANESE:{code:"ja",flag:"name:ja",name:"Japanese",latin:!1,isMode:!1,geocoding:!0},JAPANESE_HIRAGANA:{code:"ja-Hira",flag:"name:ja-Hira",name:"Japanese Hiragana form",latin:!1,isMode:!1,geocoding:!1},JAPANESE_2018:{code:"ja-Latn",flag:"name:ja-Latn",name:"Japanese (Latin 2018)",latin:!0,isMode:!1,geocoding:!1},JAPANESE_KANA:{code:"ja_kana",flag:"name:ja_kana",name:"Japanese (Kana)",latin:!1,isMode:!1,geocoding:!1},JAPANESE_LATIN:{code:"ja_rm",flag:"name:ja_rm",name:"Japanese (Latin script)",latin:!0,isMode:!1,geocoding:!1},KANNADA:{code:"kn",flag:"name:kn",name:"Kannada",latin:!0,isMode:!1,geocoding:!0},KAZAKH:{code:"kk",flag:"name:kk",name:"Kazakh",latin:!1,isMode:!1,geocoding:!0},KOREAN:{code:"ko",flag:"name:ko",name:"Korean",latin:!1,isMode:!1,geocoding:!0},KOREAN_LATIN:{code:"ko-Latn",flag:"name:ko-Latn",name:"Korean (Latin script)",latin:!0,isMode:!1,geocoding:!1},KURDISH:{code:"ku",flag:"name:ku",name:"Kurdish",latin:!0,isMode:!1,geocoding:!0},CLASSICAL_LATIN:{code:"la",flag:"name:la",name:"Latin",latin:!0,isMode:!1,geocoding:!0},LATVIAN:{code:"lv",flag:"name:lv",name:"Latvian",latin:!0,isMode:!1,geocoding:!0},LITHUANIAN:{code:"lt",flag:"name:lt",name:"Lithuanian",latin:!0,isMode:!1,geocoding:!0},LUXEMBOURGISH:{code:"lb",flag:"name:lb",name:"Luxembourgish",latin:!0,isMode:!1,geocoding:!0},MACEDONIAN:{code:"mk",flag:"name:mk",name:"Macedonian",latin:!1,isMode:!1,geocoding:!0},MALAYALAM:{code:"ml",flag:"name:ml",name:"Malayalam",latin:!1,isMode:!1,geocoding:!0},MALTESE:{code:"mt",flag:"name:mt",name:"Maltese",latin:!0,isMode:!1,geocoding:!0},NORWEGIAN:{code:"no",flag:"name:no",name:"Norwegian",latin:!0,isMode:!1,geocoding:!0},OCCITAN:{code:"oc",flag:"name:oc",name:"Occitan",latin:!0,isMode:!1,geocoding:!0},PERSIAN:{code:"fa",flag:"name:fa",name:"Persian",latin:!1,isMode:!1,geocoding:!0},POLISH:{code:"pl",flag:"name:pl",name:"Polish",latin:!0,isMode:!1,geocoding:!0},PORTUGUESE:{code:"pt",flag:"name:pt",name:"Portuguese",latin:!0,isMode:!1,geocoding:!0},PUNJABI:{code:"pa",flag:"name:pa",name:"Punjabi",latin:!1,isMode:!1,geocoding:!0},WESTERN_PUNJABI:{code:"pnb",flag:"name:pnb",name:"Western Punjabi",latin:!1,isMode:!1,geocoding:!1},ROMANIAN:{code:"ro",flag:"name:ro",name:"Romanian",latin:!0,isMode:!1,geocoding:!0},ROMANSH:{code:"rm",flag:"name:rm",name:"Romansh",latin:!0,isMode:!1,geocoding:!0},RUSSIAN:{code:"ru",flag:"name:ru",name:"Russian",latin:!1,isMode:!1,geocoding:!0},SERBIAN_CYRILLIC:{code:"sr",flag:"name:sr",name:"Serbian (Cyrillic script)",latin:!1,isMode:!1,geocoding:!0},SERBIAN_LATIN:{code:"sr-Latn",flag:"name:sr-Latn",name:"Serbian (Latin script)",latin:!0,isMode:!1,geocoding:!1},SCOTTISH_GAELIC:{code:"gd",flag:"name:gd",name:"Scottish Gaelic",latin:!0,isMode:!1,geocoding:!0},SLOVAK:{code:"sk",flag:"name:sk",name:"Slovak",latin:!0,isMode:!1,geocoding:!0},SLOVENE:{code:"sl",flag:"name:sl",name:"Slovene",latin:!0,isMode:!1,geocoding:!0},SPANISH:{code:"es",flag:"name:es",name:"Spanish",latin:!0,isMode:!1,geocoding:!0},SWEDISH:{code:"sv",flag:"name:sv",name:"Swedish",latin:!0,isMode:!1,geocoding:!0},TAMIL:{code:"ta",flag:"name:ta",name:"Tamil",latin:!1,isMode:!1,geocoding:!0},TELUGU:{code:"te",flag:"name:te",name:"Telugu",latin:!1,isMode:!1,geocoding:!0},THAI:{code:"th",flag:"name:th",name:"Thai",latin:!1,isMode:!1,geocoding:!0},TURKISH:{code:"tr",flag:"name:tr",name:"Turkish",latin:!0,isMode:!1,geocoding:!0},UKRAINIAN:{code:"uk",flag:"name:uk",name:"Ukrainian",latin:!1,isMode:!1,geocoding:!0},VIETNAMESE:{code:"vi",flag:"name:vi",name:"Vietnamese (Latin script)",latin:!0,isMode:!1,geocoding:!0},WELSH:{code:"cy",flag:"name:cy",name:"Welsh",latin:!0,isMode:!1,geocoding:!0}},Mp={...U5,...V5};function q5(i,r=Mp){return i in r?i[i]:null}function vy(i,r=Mp){for(const o of Object.values(r))if(o.code===i)return o;return null}function by(i,r=Mp){for(const o of Object.values(r))if(o.flag===i)return o;return null}function G5(i){return i!==null&&typeof i=="object"&&"code"in i&&"flag"in i&&"name"in i&&"latin"in i&&"isMode"in i&&"geocoding"in i&&(typeof i.code=="string"||i.code===null)&&typeof i.flag=="string"&&typeof i.name=="string"&&typeof i.latin=="boolean"&&typeof i.isMode=="boolean"&&typeof i.geocoding=="boolean"}function rb(i,r=Mp){return G5(i)?by(i.flag,r):typeof i!="string"?null:q5(i,r)||vy(i,r)||by(i,r)||null}async function Z5(i,r={}){if(hu.fetch===null)throw new Error("The fetch function was not found. If on NodeJS < 18 please specify the fetch function with config.fetch");if(new URL(i).searchParams.get("key").trim()==="")throw new Error("The MapTiler Cloud API key is missing. Set it in `config.apiKey` or get one for free at https://maptiler.com");return hu.fetch(i,r)}const Ix={maptilerApiURL:"https://api.maptiler.com/",mapStyle:"streets-v2"};Object.freeze(Ix);class W5 extends Error{constructor(r,o=""){super(`Call to enpoint ${r.url} failed with the status code ${r.status}. ${o}`),this.res=r}}const ib={403:"Key is missing, invalid or restricted"};async function H5(i={}){const r=new URL("geolocation/ip.json",Ix.maptilerApiURL);r.searchParams.set("key",i.apiKey??hu.apiKey),"elevation"in i&&r.searchParams.set("elevation",i.elevation?"true":"false");const o=r.toString(),h=await Z5(o);if(!h.ok)throw new W5(h,h.status in ib?ib[h.status]:"");return await h.json()}const nb={info:H5};function zx(i){const r=/^maptiler:\/\/(.*)/;let o;const h=i.trim();let m;return h.startsWith("http://")||h.startsWith("https://")?m=h:(o=r.exec(h))!==null?m=`https://api.maptiler.com/maps/${o[1]}/style.json`:m=`https://api.maptiler.com/maps/${h}/style.json`,m}class Rx{constructor(r,o,h,m,v,f,l=!1){this.name=r,this.variantType=o,this.id=h,this.referenceStyle=m,this.description=v,this.imageURL=f,this.deprecated=l}getName(){return this.name}getFullName(){return`${this.referenceStyle.getName()} ${this.name}`}getType(){return this.variantType}getId(){return this.id}getDescription(){return this.description}getReferenceStyle(){return this.referenceStyle}hasVariant(r){return this.referenceStyle.hasVariant(r)}getVariant(r){const o=this.referenceStyle.getVariant(r);return this.warnIfDeprecated(o),o}getVariants(){return this.referenceStyle.getVariants().filter(r=>r!==this).map(r=>(this.warnIfDeprecated(r),r))}getImageURL(){return this.imageURL}getExpandedStyleURL(){return zx(this.getId())}warnIfDeprecated(r=this){if(!r.deprecated)return r;const o=r.getFullName();return console.warn(`Style "${o}" is deprecated and will be removed in a future version.`),r}}class Lx{constructor(r,o){this.name=r,this.id=o,this.variants={},this.orderedVariants=[]}getName(){return this.name}getId(){return this.id}addVariant(r){this.variants[r.getType()]=r,this.orderedVariants.push(r)}hasVariant(r){return r in this.variants}getVariant(r){return r in this.variants?this.variants[r]:this.orderedVariants[0]}getVariants(){return Object.values(this.variants)}getDefaultVariant(){return this.orderedVariants[0].warnIfDeprecated()}}const Qh=[{referenceStyleID:"STREETS",name:"Streets",description:"",variants:[{id:"streets-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"streets-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"streets-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"streets-v2-night",name:"Night",variantType:"NIGHT",description:"",imageURL:""},{id:"streets-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OUTDOOR",name:"Outdoor",description:"",variants:[{id:"outdoor-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"outdoor-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"WINTER",name:"Winter",description:"",variants:[{id:"winter-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"winter-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"SATELLITE",name:"Satellite",description:"",variants:[{id:"satellite",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"HYBRID",name:"Hybrid",description:"",variants:[{id:"hybrid",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"BASIC",name:"Basic",description:"",variants:[{id:"basic-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"basic-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"basic-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BRIGHT",name:"Bright",description:"",variants:[{id:"bright-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"bright-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"bright-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"bright-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OPENSTREETMAP",name:"OpenStreetMap",description:"",variants:[{id:"openstreetmap",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"TOPO",name:"Topo",description:"",variants:[{id:"topo-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"topo-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"topo-v2-shiny",name:"Shiny",deprecated:!0,variantType:"SHINY",description:"",imageURL:""},{id:"topo-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""},{id:"topo-v2-topographique",name:"Topographique",variantType:"TOPOGRAPHIQUE",description:"",imageURL:""}]},{referenceStyleID:"VOYAGER",name:"Voyager",description:"",variants:[{id:"voyager-v2",name:"Default",deprecated:!0,variantType:"DEFAULT",description:"",imageURL:""},{id:"voyager-v2-darkmatter",name:"Darkmatter",deprecated:!0,variantType:"DARK",description:"",imageURL:""},{id:"voyager-v2-positron",name:"Positron",deprecated:!0,variantType:"LIGHT",description:"",imageURL:""},{id:"voyager-v2-vintage",name:"Vintage",deprecated:!0,variantType:"VINTAGE",description:"",imageURL:""}]},{referenceStyleID:"TONER",name:"Toner",description:"",variants:[{id:"toner-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"toner-v2-background",name:"Background",variantType:"BACKGROUND",deprecated:!0,description:"",imageURL:""},{id:"toner-v2-lite",name:"Lite",variantType:"LITE",description:"",imageURL:""},{id:"toner-v2-lines",name:"Lines",variantType:"LINES",deprecated:!0,description:"",imageURL:""}]},{referenceStyleID:"DATAVIZ",name:"Dataviz",description:"",variants:[{id:"dataviz",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"dataviz-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"dataviz-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BACKDROP",name:"Backdrop",description:"",variants:[{id:"backdrop",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"backdrop-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"backdrop-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"OCEAN",name:"Ocean",description:"",variants:[{id:"ocean",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"AQUARELLE",name:"Aquarelle",description:"Watercolor map for creative use",variants:[{id:"aquarelle",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"aquarelle-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"aquarelle-vivid",name:"Vivid",variantType:"VIVID",description:"",imageURL:""}]},{referenceStyleID:"LANDSCAPE",name:"Landscape",description:"Terrain map for data overlays and visualisations",variants:[{id:"landscape",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"landscape-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"landscape-vivid",name:"Vivid",variantType:"VIVID",description:"",imageURL:""}]}];function X5(i){return new Proxy(i,{get(r,o,h){return r.hasVariant(o)?r.getVariant(o):o.toString().toUpperCase()===o?i.getDefaultVariant():Reflect.get(r,o,h)}})}function K5(){const i={};for(let r=0;r<Qh.length;r+=1){const o=Qh[r],h=X5(new Lx(o.name,o.referenceStyleID));for(let m=0;m<o.variants.length;m+=1){const v=o.variants[m],f=new Rx(v.name,v.variantType,v.id,h,v.description,v.imageURL,v.deprecated);h.addVariant(f)}i[o.referenceStyleID]=h}return i}const ep=K5();var Wd={exports:{}},ab;function Y5(){if(ab)return Wd.exports;ab=1;var i=typeof Reflect=="object"?Reflect:null,r=i&&typeof i.apply=="function"?i.apply:function(fe,Ae,Fe){return Function.prototype.apply.call(fe,Ae,Fe)},o;i&&typeof i.ownKeys=="function"?o=i.ownKeys:Object.getOwnPropertySymbols?o=function(fe){return Object.getOwnPropertyNames(fe).concat(Object.getOwnPropertySymbols(fe))}:o=function(fe){return Object.getOwnPropertyNames(fe)};function h(he){console&&console.warn&&console.warn(he)}var m=Number.isNaN||function(fe){return fe!==fe};function v(){v.init.call(this)}Wd.exports=v,Wd.exports.once=pe,v.EventEmitter=v,v.prototype._events=void 0,v.prototype._eventsCount=0,v.prototype._maxListeners=void 0;var f=10;function l(he){if(typeof he!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof he)}Object.defineProperty(v,"defaultMaxListeners",{enumerable:!0,get:function(){return f},set:function(he){if(typeof he!="number"||he<0||m(he))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+he+".");f=he}}),v.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},v.prototype.setMaxListeners=function(fe){if(typeof fe!="number"||fe<0||m(fe))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+fe+".");return this._maxListeners=fe,this};function C(he){return he._maxListeners===void 0?v.defaultMaxListeners:he._maxListeners}v.prototype.getMaxListeners=function(){return C(this)},v.prototype.emit=function(fe){for(var Ae=[],Fe=1;Fe<arguments.length;Fe++)Ae.push(arguments[Fe]);var He=fe==="error",rt=this._events;if(rt!==void 0)He=He&&rt.error===void 0;else if(!He)return!1;if(He){var et;if(Ae.length>0&&(et=Ae[0]),et instanceof Error)throw et;var It=new Error("Unhandled error."+(et?" ("+et.message+")":""));throw It.context=et,It}var bt=rt[fe];if(bt===void 0)return!1;if(typeof bt=="function")r(bt,this,Ae);else for(var er=bt.length,dr=J(bt,er),Fe=0;Fe<er;++Fe)r(dr[Fe],this,Ae);return!0};function M(he,fe,Ae,Fe){var He,rt,et;if(l(Ae),rt=he._events,rt===void 0?(rt=he._events=Object.create(null),he._eventsCount=0):(rt.newListener!==void 0&&(he.emit("newListener",fe,Ae.listener?Ae.listener:Ae),rt=he._events),et=rt[fe]),et===void 0)et=rt[fe]=Ae,++he._eventsCount;else if(typeof et=="function"?et=rt[fe]=Fe?[Ae,et]:[et,Ae]:Fe?et.unshift(Ae):et.push(Ae),He=C(he),He>0&&et.length>He&&!et.warned){et.warned=!0;var It=new Error("Possible EventEmitter memory leak detected. "+et.length+" "+String(fe)+" listeners added. Use emitter.setMaxListeners() to increase limit");It.name="MaxListenersExceededWarning",It.emitter=he,It.type=fe,It.count=et.length,h(It)}return he}v.prototype.addListener=function(fe,Ae){return M(this,fe,Ae,!1)},v.prototype.on=v.prototype.addListener,v.prototype.prependListener=function(fe,Ae){return M(this,fe,Ae,!0)};function R(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function j(he,fe,Ae){var Fe={fired:!1,wrapFn:void 0,target:he,type:fe,listener:Ae},He=R.bind(Fe);return He.listener=Ae,Fe.wrapFn=He,He}v.prototype.once=function(fe,Ae){return l(Ae),this.on(fe,j(this,fe,Ae)),this},v.prototype.prependOnceListener=function(fe,Ae){return l(Ae),this.prependListener(fe,j(this,fe,Ae)),this},v.prototype.removeListener=function(fe,Ae){var Fe,He,rt,et,It;if(l(Ae),He=this._events,He===void 0)return this;if(Fe=He[fe],Fe===void 0)return this;if(Fe===Ae||Fe.listener===Ae)--this._eventsCount===0?this._events=Object.create(null):(delete He[fe],He.removeListener&&this.emit("removeListener",fe,Fe.listener||Ae));else if(typeof Fe!="function"){for(rt=-1,et=Fe.length-1;et>=0;et--)if(Fe[et]===Ae||Fe[et].listener===Ae){It=Fe[et].listener,rt=et;break}if(rt<0)return this;rt===0?Fe.shift():le(Fe,rt),Fe.length===1&&(He[fe]=Fe[0]),He.removeListener!==void 0&&this.emit("removeListener",fe,It||Ae)}return this},v.prototype.off=v.prototype.removeListener,v.prototype.removeAllListeners=function(fe){var Ae,Fe,He;if(Fe=this._events,Fe===void 0)return this;if(Fe.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):Fe[fe]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete Fe[fe]),this;if(arguments.length===0){var rt=Object.keys(Fe),et;for(He=0;He<rt.length;++He)et=rt[He],et!=="removeListener"&&this.removeAllListeners(et);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(Ae=Fe[fe],typeof Ae=="function")this.removeListener(fe,Ae);else if(Ae!==void 0)for(He=Ae.length-1;He>=0;He--)this.removeListener(fe,Ae[He]);return this};function G(he,fe,Ae){var Fe=he._events;if(Fe===void 0)return[];var He=Fe[fe];return He===void 0?[]:typeof He=="function"?Ae?[He.listener||He]:[He]:Ae?we(He):J(He,He.length)}v.prototype.listeners=function(fe){return G(this,fe,!0)},v.prototype.rawListeners=function(fe){return G(this,fe,!1)},v.listenerCount=function(he,fe){return typeof he.listenerCount=="function"?he.listenerCount(fe):B.call(he,fe)},v.prototype.listenerCount=B;function B(he){var fe=this._events;if(fe!==void 0){var Ae=fe[he];if(typeof Ae=="function")return 1;if(Ae!==void 0)return Ae.length}return 0}v.prototype.eventNames=function(){return this._eventsCount>0?o(this._events):[]};function J(he,fe){for(var Ae=new Array(fe),Fe=0;Fe<fe;++Fe)Ae[Fe]=he[Fe];return Ae}function le(he,fe){for(;fe+1<he.length;fe++)he[fe]=he[fe+1];he.pop()}function we(he){for(var fe=new Array(he.length),Ae=0;Ae<fe.length;++Ae)fe[Ae]=he[Ae].listener||he[Ae];return fe}function pe(he,fe){return new Promise(function(Ae,Fe){function He(et){he.removeListener(fe,rt),Fe(et)}function rt(){typeof he.removeListener=="function"&&he.removeListener("error",He),Ae([].slice.call(arguments))}de(he,fe,rt,{once:!0}),fe!=="error"&&xe(he,He,{once:!0})})}function xe(he,fe,Ae){typeof he.on=="function"&&de(he,"error",fe,Ae)}function de(he,fe,Ae,Fe){if(typeof he.on=="function")Fe.once?he.once(fe,Ae):he.on(fe,Ae);else if(typeof he.addEventListener=="function")he.addEventListener(fe,function He(rt){Fe.once&&he.removeEventListener(fe,He),Ae(rt)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof he)}return Wd.exports}var J5=Y5();const Q5=Ax(J5),ji=[];for(let i=0;i<256;++i)ji.push((i+256).toString(16).slice(1));function eC(i,r=0){return(ji[i[r+0]]+ji[i[r+1]]+ji[i[r+2]]+ji[i[r+3]]+"-"+ji[i[r+4]]+ji[i[r+5]]+"-"+ji[i[r+6]]+ji[i[r+7]]+"-"+ji[i[r+8]]+ji[i[r+9]]+"-"+ji[i[r+10]]+ji[i[r+11]]+ji[i[r+12]]+ji[i[r+13]]+ji[i[r+14]]+ji[i[r+15]]).toLowerCase()}let Cg;const tC=new Uint8Array(16);function rC(){if(!Cg){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Cg=crypto.getRandomValues.bind(crypto)}return Cg(tC)}const iC=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),ob={randomUUID:iC};function nC(i,r,o){if(ob.randomUUID&&!i)return ob.randomUUID();i=i||{};const h=i.random??i.rng?.()??rC();if(h.length<16)throw new Error("Random bytes length must be >= 16");return h[6]=h[6]&15|64,h[8]=h[8]&63|128,eC(h)}const Dx="3.7.8",aC=Dx,ku=typeof Buffer=="function",sb=typeof TextDecoder=="function"?new TextDecoder:void 0,lb=typeof TextEncoder=="function"?new TextEncoder:void 0,oC="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Vh=Array.prototype.slice.call(oC),Hd=(i=>{let r={};return i.forEach((o,h)=>r[o]=h),r})(Vh),sC=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,Bi=String.fromCharCode.bind(String),cb=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):i=>new Uint8Array(Array.prototype.slice.call(i,0)),Fx=i=>i.replace(/=/g,"").replace(/[+\/]/g,r=>r=="+"?"-":"_"),jx=i=>i.replace(/[^A-Za-z0-9\+\/]/g,""),Ox=i=>{let r,o,h,m,v="";const f=i.length%3;for(let l=0;l<i.length;){if((o=i.charCodeAt(l++))>255||(h=i.charCodeAt(l++))>255||(m=i.charCodeAt(l++))>255)throw new TypeError("invalid character found");r=o<<16|h<<8|m,v+=Vh[r>>18&63]+Vh[r>>12&63]+Vh[r>>6&63]+Vh[r&63]}return f?v.slice(0,f-3)+"===".substring(f):v},o0=typeof btoa=="function"?i=>btoa(i):ku?i=>Buffer.from(i,"binary").toString("base64"):Ox,xy=ku?i=>Buffer.from(i).toString("base64"):i=>{let o=[];for(let h=0,m=i.length;h<m;h+=4096)o.push(Bi.apply(null,i.subarray(h,h+4096)));return o0(o.join(""))},nf=(i,r=!1)=>r?Fx(xy(i)):xy(i),lC=i=>{if(i.length<2){var r=i.charCodeAt(0);return r<128?i:r<2048?Bi(192|r>>>6)+Bi(128|r&63):Bi(224|r>>>12&15)+Bi(128|r>>>6&63)+Bi(128|r&63)}else{var r=65536+(i.charCodeAt(0)-55296)*1024+(i.charCodeAt(1)-56320);return Bi(240|r>>>18&7)+Bi(128|r>>>12&63)+Bi(128|r>>>6&63)+Bi(128|r&63)}},cC=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,Bx=i=>i.replace(cC,lC),ub=ku?i=>Buffer.from(i,"utf8").toString("base64"):lb?i=>xy(lb.encode(i)):i=>o0(Bx(i)),pu=(i,r=!1)=>r?Fx(ub(i)):ub(i),hb=i=>pu(i,!0),uC=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,hC=i=>{switch(i.length){case 4:var r=(7&i.charCodeAt(0))<<18|(63&i.charCodeAt(1))<<12|(63&i.charCodeAt(2))<<6|63&i.charCodeAt(3),o=r-65536;return Bi((o>>>10)+55296)+Bi((o&1023)+56320);case 3:return Bi((15&i.charCodeAt(0))<<12|(63&i.charCodeAt(1))<<6|63&i.charCodeAt(2));default:return Bi((31&i.charCodeAt(0))<<6|63&i.charCodeAt(1))}},$x=i=>i.replace(uC,hC),Nx=i=>{if(i=i.replace(/\s+/g,""),!sC.test(i))throw new TypeError("malformed base64.");i+="==".slice(2-(i.length&3));let r,o,h,m=[];for(let v=0;v<i.length;)r=Hd[i.charAt(v++)]<<18|Hd[i.charAt(v++)]<<12|(o=Hd[i.charAt(v++)])<<6|(h=Hd[i.charAt(v++)]),o===64?m.push(Bi(r>>16&255)):h===64?m.push(Bi(r>>16&255,r>>8&255)):m.push(Bi(r>>16&255,r>>8&255,r&255));return m.join("")},s0=typeof atob=="function"?i=>atob(jx(i)):ku?i=>Buffer.from(i,"base64").toString("binary"):Nx,Ux=ku?i=>cb(Buffer.from(i,"base64")):i=>cb(s0(i).split("").map(r=>r.charCodeAt(0))),Vx=i=>Ux(qx(i)),pC=ku?i=>Buffer.from(i,"base64").toString("utf8"):sb?i=>sb.decode(Ux(i)):i=>$x(s0(i)),qx=i=>jx(i.replace(/[-_]/g,r=>r=="-"?"+":"/")),wy=i=>pC(qx(i)),dC=i=>{if(typeof i!="string")return!1;const r=i.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(r)||!/[^\s0-9a-zA-Z\-_]/.test(r)},Gx=i=>({value:i,enumerable:!1,writable:!0,configurable:!0}),Zx=function(){const i=(r,o)=>Object.defineProperty(String.prototype,r,Gx(o));i("fromBase64",function(){return wy(this)}),i("toBase64",function(r){return pu(this,r)}),i("toBase64URI",function(){return pu(this,!0)}),i("toBase64URL",function(){return pu(this,!0)}),i("toUint8Array",function(){return Vx(this)})},Wx=function(){const i=(r,o)=>Object.defineProperty(Uint8Array.prototype,r,Gx(o));i("toBase64",function(r){return nf(this,r)}),i("toBase64URI",function(){return nf(this,!0)}),i("toBase64URL",function(){return nf(this,!0)})},fC=()=>{Zx(),Wx()},mC={version:Dx,VERSION:aC,atob:s0,atobPolyfill:Nx,btoa:o0,btoaPolyfill:Ox,fromBase64:wy,toBase64:pu,encode:pu,encodeURI:hb,encodeURL:hb,utob:Bx,btou:$x,decode:wy,isValid:dC,fromUint8Array:nf,toUint8Array:Vx,extendString:Zx,extendUint8Array:Wx,extendBuiltins:fC};var gC=Object.defineProperty,Hx=i=>{throw TypeError(i)},yC=(i,r,o)=>r in i?gC(i,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[r]=o,tt=(i,r,o)=>yC(i,typeof r!="symbol"?r+"":r,o),l0=(i,r,o)=>r.has(i)||Hx("Cannot "+o),pt=(i,r,o)=>(l0(i,r,"read from private field"),o?o.call(i):r.get(i)),fn=(i,r,o)=>r.has(i)?Hx("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(i):r.set(i,o),Bn=(i,r,o,h)=>(l0(i,r,"write to private field"),r.set(i,o),o),jn=(i,r,o)=>(l0(i,r,"access private method"),o);const rr={VISITOR:{code:null,flag:"visitor",name:"Visitor",latin:!0,isMode:!0,geocoding:!1},VISITOR_ENGLISH:{code:null,flag:"visitor_en",name:"Visitor English",latin:!0,isMode:!0,geocoding:!1},STYLE:{code:null,flag:"style",name:"Style",latin:!1,isMode:!0,geocoding:!1},STYLE_LOCK:{code:null,flag:"style_lock",name:"Style Lock",latin:!1,isMode:!0,geocoding:!1},...Mp};function pb(){if(typeof navigator>"u"){const i=Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0];return vy(i)||rr.ENGLISH}return Array.from(new Set(navigator.languages.map(i=>i.split("-")[0]))).map(i=>vy(i)).filter(i=>i)[0]??rr.LOCAL}const cn={maptilerLogoURL:"https://api.maptiler.com/resources/logo.svg",maptilerURL:"https://www.maptiler.com/",maptilerApiHost:"api.maptiler.com",telemetryURL:"https://api.maptiler.com/metrics",rtlPluginURL:"https://cdn.maptiler.com/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.min.js",primaryLanguage:rr.STYLE,secondaryLanguage:rr.LOCAL,terrainSourceURL:"https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json",terrainSourceId:"maptiler-terrain"};Object.freeze(cn);const c0=nC();let _C=class extends Q5{constructor(){super(...arguments),tt(this,"primaryLanguage",cn.primaryLanguage),tt(this,"secondaryLanguage"),tt(this,"session",!0),tt(this,"caching",!0),tt(this,"telemetry",!0),tt(this,"_unit","metric"),tt(this,"_apiKey","")}set unit(r){this._unit=r,this.emit("unit",r)}get unit(){return this._unit}set apiKey(r){this._apiKey=r,hu.apiKey=r,this.emit("apiKey",r)}get apiKey(){return this._apiKey}set fetch(r){hu.fetch=r}get fetch(){return hu.fetch}};const _i=new _C,Ty="localcache_source",Sy="localcache",vC="maptiler_sdk",bC=1e3,xC=100,ky=typeof caches<"u",{addProtocol:db}=ht;function wC(i,r){if(ky&&_i.caching&&_i.session&&i.host===cn.maptilerApiHost){if(r==="Source"&&i.href.includes("tiles.json"))return i.href.replace("https://",`${Ty}://`);if(r==="Tile"||r==="Glyphs")return i.href.replace("https://",`${Sy}://`)}return i.href}let Pg;async function Xx(){return Pg||(Pg=await caches.open(vC)),Pg}let fb=0;async function TC(){const i=await Xx(),r=await i.keys(),o=r.slice(0,Math.max(r.length-bC,0));for(const h of o)i.delete(h)}function SC(){db(Ty,async(i,r)=>{if(!i.url)throw new Error("");i.url=i.url.replace(`${Ty}://`,"https://");const o=i;o.signal=r.signal;const h=await fetch(i.url,o),m=await h.json();return m.tiles&&m.tiles.length>0&&(m.tiles[0]+=`&last-modified=${h.headers.get("Last-Modified")}`),{data:m,cacheControl:h.headers.get("Cache-Control"),expires:h.headers.get("Expires")}}),db(Sy,async(i,r)=>{if(!i.url)throw new Error("");i.url=i.url.replace(`${Sy}://`,"https://");const o=new URL(i.url),h=new URL(o);h.searchParams.delete("mtsid"),h.searchParams.delete("key");const m=h.toString(),v=new URL(o);v.searchParams.delete("last-modified");const f=v.toString(),l=async G=>({data:await G.arrayBuffer(),cacheControl:G.headers.get("Cache-Control"),expires:G.headers.get("Expires")}),C=await Xx(),M=await C.match(m);if(M)return l(M);const R=i;R.signal=r.signal;const j=await fetch(f,R);return j.status>=200&&j.status<300&&(C.put(m,j.clone()).catch(()=>{}),++fb>xC&&(TC(),fb=0)),l(j)})}function kC(){if(typeof window>"u")return;const i=ht.getRTLTextPluginStatus();if(i==="unavailable"||i==="requested")try{ht.setRTLTextPlugin(cn.rtlPluginURL,!0)}catch{}}function CC(i,r){for(const o of i)typeof r[o]=="function"&&(r[o]=r[o].bind(r))}function mb(i,r){let o=null;try{o=new URL(i)}catch{return{url:i}}return o.host===cn.maptilerApiHost&&(o.searchParams.has("key")||o.searchParams.append("key",_i.apiKey),_i.session&&o.searchParams.append("mtsid",c0)),{url:wC(o,r)}}function gb(i){return(r,o)=>{if(i!=null){const h=i(r,o),m=mb(h?.url??"",o);return{...h,...m}}return mb(r,o)}}function PC(){return document.createElement("canvas").getContext("webgl2")?null:typeof WebGL2RenderingContext<"u"?"Graphic rendering with WebGL2 has been disabled or is not supported by your graphic card. The map cannot be displayed.":"Your browser does not support graphic rendering with WebGL2. The map cannot be displayed."}function MC(i){const r=PC();if(!r)return;let o=null;if(typeof i=="string"?o=document.getElementById(i):i instanceof HTMLElement&&(o=i),!o)throw new Error("The Map container must be provided.");const h=document.createElement("div");throw h.innerHTML=r,h.classList.add("webgl-warning-div"),o.appendChild(h),new Error(r)}function yb(i,r){return!(!Array.isArray(i)||i.length!==2||i[0]!=="get"||typeof i[1]!="string"||r&&!i[1].startsWith("name:")||!r&&i[1]!=="name")}function AC(i,r,o){const h=structuredClone(i),m=v=>{if(typeof v!="string")for(let f=0;f<v.length;f+=1)yb(v[f],o)?v[f]=structuredClone(r):m(v[f])};return yb(h,o)?r:(m(h),h)}function EC(i,r){const o=r?/\{name:\S+\}/:/\{name\}/;return{contains:o.test(i),exactMatch:new RegExp(`^${o.source}$`).test(i)}}function IC(i,r,o){const h=o?/\{name:\S+\}/:/\{name\}/,m=i.split(h);return["concat",...m.flatMap((v,f)=>f===m.length-1?[v]:[v,r])]}function zC(i){var r;const o=/\{name(?::(?<language>\S+))?\}/g,h=[];for(;;){const m=o.exec(i);if(!m)break;const v=((r=m.groups)==null?void 0:r.language)??null;h.push(v)}return h}function RC(i){return!Array.isArray(i)||i.length!==2||i[0]!=="get"||typeof i[1]!="string"?null:i[1].trim()==="name"?{isLanguage:!0,localization:null}:i[1].trim().startsWith("name:")?{isLanguage:!0,localization:i[1].trim().split(":").pop()}:null}function LC(i){const r=[],o=structuredClone(i),h=m=>{if(typeof m!="string")for(let v=0;v<m.length;v+=1){const f=RC(m[v]);f?r.push(f.localization):h(m[v])}};return h([o]),r}function DC(i,r){const o=[];for(const v of i){if(v.type!=="symbol")continue;const f=v,{id:l,layout:C}=f;if(!C||!("text-field"in C))continue;const M=r.getLayoutProperty(l,"text-field");if(M)if(typeof M=="string"){const R=zC(M);o.push(R)}else{const R=LC(M);o.push(R)}}const h=o.flat(),m={unlocalized:0,localized:{}};for(const v of h)v===null?m.unlocalized+=1:(v in m.localized||(m.localized[v]=0),m.localized[v]+=1);return m}(class extends ht.Marker{addTo(i){return super.addTo(i)}});class FC extends ht.Popup{addTo(r){return super.addTo(r)}}class SR extends ht.Style{constructor(r,o={}){super(r,o)}}class kR extends ht.CanvasSource{onAdd(r){super.onAdd(r)}}class CR extends ht.GeoJSONSource{onAdd(r){super.onAdd(r)}}class PR extends ht.ImageSource{onAdd(r){super.onAdd(r)}}class MR extends ht.RasterTileSource{onAdd(r){super.onAdd(r)}}class AR extends ht.RasterDEMTileSource{onAdd(r){super.onAdd(r)}}class ER extends ht.VectorTileSource{onAdd(r){super.onAdd(r)}}class IR extends ht.VideoSource{onAdd(r){super.onAdd(r)}}let jC=class extends ht.NavigationControl{onAdd(r){return super.onAdd(r)}},OC=class extends ht.GeolocateControl{onAdd(r){return super.onAdd(r)}};class LR extends ht.AttributionControl{onAdd(r){return super.onAdd(r)}}let BC=class extends ht.LogoControl{onAdd(r){return super.onAdd(r)}},$C=class extends ht.ScaleControl{onAdd(r){return super.onAdd(r)}},NC=class extends ht.FullscreenControl{onAdd(r){return super.onAdd(r)}};class OR extends ht.TerrainControl{onAdd(r){return super.onAdd(r)}}class BR extends ht.BoxZoomHandler{constructor(r,o){super(r,o)}}class $R extends ht.ScrollZoomHandler{constructor(r,o){super(r,o)}}class NR extends ht.CooperativeGesturesHandler{constructor(r,o){super(r,o)}}class UR extends ht.KeyboardHandler{constructor(r){super(r)}}class VR extends ht.TwoFingersTouchPitchHandler{constructor(r){super(r)}}class qR extends ht.MapWheelEvent{constructor(r,o,h){super(r,o,h)}}class GR extends ht.MapTouchEvent{constructor(r,o,h){super(r,o,h)}}class ZR extends ht.MapMouseEvent{constructor(r,o,h,m={}){super(r,o,h,m)}}let _b=class extends BC{constructor(r={}){super(r),tt(this,"logoURL",""),tt(this,"linkURL",""),this.logoURL=r.logoURL??cn.maptilerLogoURL,this.linkURL=r.linkURL??cn.maptilerURL}onAdd(r){this._map=r,this._compact=this.options.compact??!1,this._container=window.document.createElement("div"),this._container.className="maplibregl-ctrl";const o=window.document.createElement("a");return o.style.backgroundRepeat="no-repeat",o.style.cursor="pointer",o.style.display="block",o.style.height="23px",o.style.margin="0 0 -4px -4px",o.style.overflow="hidden",o.style.width="88px",o.style.backgroundImage=`url(${this.logoURL})`,o.style.backgroundSize="100px 30px",o.style.width="100px",o.style.height="30px",o.target="_blank",o.rel="noopener",o.href=this.linkURL,o.setAttribute("aria-label","MapTiler logo"),o.setAttribute("rel","noopener"),this._container.appendChild(o),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}};var UC=8,VC={version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},qC={"*":{type:"source"}},GC=["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],ZC={type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},WC={type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},HC={type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},XC={type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},KC={type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},YC={type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},JC={id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},QC=["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],eP={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},tP={"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},rP={"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},iP={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},nP={"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},aP={"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},oP={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},sP={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},lP={type:"array",value:"*"},cP={type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},uP={type:"enum",values:{Point:{},LineString:{},Polygon:{}}},hP={type:"array",minimum:0,maximum:24,value:["number","color"],length:2},pP={type:"array",value:"*",minimum:1},dP={anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},fP={"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},mP={source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},gP={type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},yP=["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],_P={"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},vP={"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},bP={"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},xP={"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},wP={"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},TP={"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},SP={"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},kP={"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},CP={duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},PP={"*":{type:"string"}},MP={$version:UC,$root:VC,sources:qC,source:GC,source_vector:ZC,source_raster:WC,source_raster_dem:HC,source_geojson:XC,source_video:KC,source_image:YC,layer:JC,layout:QC,layout_background:eP,layout_fill:tP,layout_circle:rP,layout_heatmap:iP,"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:nP,layout_symbol:aP,layout_raster:oP,layout_hillshade:sP,"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:lP,filter_operator:cP,geometry_type:uP,function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:hP,expression:pP,light:dP,sky:fP,terrain:mP,projection:gP,paint:yP,paint_fill:_P,"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:vP,paint_circle:bP,paint_heatmap:xP,paint_symbol:wP,paint_raster:TP,paint_hillshade:SP,"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:kP,transition:CP,"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:PP};class Ve{constructor(r,o,h,m){this.message=(r?`${r}: `:"")+h,m&&(this.identifier=m),o!=null&&o.__line__&&(this.line=o.__line__)}}function _f(i,...r){for(const o of r)for(const h in o)i[h]=o[h];return i}let eo=class extends Error{constructor(r,o){super(o),this.message=o,this.key=r}},AP=class Kx{constructor(r,o=[]){this.parent=r,this.bindings={};for(const[h,m]of o)this.bindings[h]=m}concat(r){return new Kx(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return this.bindings[r]?!0:this.parent?this.parent.has(r):!1}};const Nf={kind:"null"},Xe={kind:"number"},qt={kind:"string"},Bt={kind:"boolean"},ro={kind:"color"},Uf={kind:"projectionDefinition"},El={kind:"object"},Ft={kind:"value"},EP={kind:"error"},Vf={kind:"collator"},qf={kind:"formatted"},Gf={kind:"padding"},up={kind:"colorArray"},Zf={kind:"numberArray"},Ap={kind:"resolvedImage"},Wf={kind:"variableAnchorOffsetCollection"};function $n(i,r){return{kind:"array",itemType:i,N:r}}function zr(i){if(i.kind==="array"){const r=zr(i.itemType);return typeof i.N=="number"?`array<${r}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${r}>`}else return i.kind}const IP=[Nf,Xe,qt,Bt,ro,Uf,qf,El,$n(Ft),Gf,Zf,up,Ap,Wf];function hp(i,r){if(r.kind==="error")return null;if(i.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!hp(i.itemType,r.itemType))&&(typeof i.N!="number"||i.N===r.N))return null}else{if(i.kind===r.kind)return null;if(i.kind==="value"){for(const o of IP)if(!hp(o,r))return null}}return`Expected ${zr(i)} but found ${zr(r)} instead.`}function u0(i,r){return r.some(o=>o.kind===i.kind)}function Il(i,r){return r.some(o=>o==="null"?i===null:o==="array"?Array.isArray(i):o==="object"?i&&!Array.isArray(i)&&typeof i=="object":o===typeof i)}function Ts(i,r){return i.kind==="array"&&r.kind==="array"?i.itemType.kind===r.itemType.kind&&typeof i.N=="number":i.kind===r.kind}const Yx=.96422,Jx=1,Qx=.82521,ew=4/29,du=6/29,tw=3*du*du,zP=du*du*du,RP=Math.PI/180,LP=180/Math.PI;function rw(i){return i=i%360,i<0&&(i+=360),i}function iw([i,r,o,h]){i=Mg(i),r=Mg(r),o=Mg(o);let m,v;const f=Ag((.2225045*i+.7168786*r+.0606169*o)/Jx);i===r&&r===o?m=v=f:(m=Ag((.4360747*i+.3850649*r+.1430804*o)/Yx),v=Ag((.0139322*i+.0971045*r+.7141733*o)/Qx));const l=116*f-16;return[l<0?0:l,500*(m-f),200*(f-v),h]}function Mg(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Ag(i){return i>zP?Math.pow(i,1/3):i/tw+ew}function nw([i,r,o,h]){let m=(i+16)/116,v=isNaN(r)?m:m+r/500,f=isNaN(o)?m:m-o/200;return m=Jx*Ig(m),v=Yx*Ig(v),f=Qx*Ig(f),[Eg(3.1338561*v-1.6168667*m-.4906146*f),Eg(-.9787684*v+1.9161415*m+.033454*f),Eg(.0719453*v-.2289914*m+1.4052427*f),h]}function Eg(i){return i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055,i<0?0:i>1?1:i}function Ig(i){return i>du?i*i*i:tw*(i-ew)}function DP(i){const[r,o,h,m]=iw(i),v=Math.sqrt(o*o+h*h);return[Math.round(v*1e4)?rw(Math.atan2(h,o)*LP):NaN,v,r,m]}function FP([i,r,o,h]){return i=isNaN(i)?0:i*RP,nw([o,Math.cos(i)*r,Math.sin(i)*r,h])}function jP([i,r,o,h]){i=rw(i),r/=100,o/=100;function m(v){const f=(v+i/30)%12,l=r*Math.min(o,1-o);return o-l*Math.max(-1,Math.min(f-3,9-f,1))}return[m(0),m(8),m(4),h]}const OP=Object.hasOwn||function(i,r){return Object.prototype.hasOwnProperty.call(i,r)};function tp(i,r){return OP(i,r)?i[r]:void 0}function BP(i){if(i=i.toLowerCase().trim(),i==="transparent")return[0,0,0,0];const r=tp($P,i);if(r){const[m,v,f]=r;return[m/255,v/255,f/255,1]}if(i.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(i)){const m=i.length<6?1:2;let v=1;return[Xd(i.slice(v,v+=m)),Xd(i.slice(v,v+=m)),Xd(i.slice(v,v+=m)),Xd(i.slice(v,v+m)||"ff")]}if(i.startsWith("rgb")){const m=/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,v=i.match(m);if(v){const[f,l,C,M,R,j,G,B,J,le,we,pe]=v,xe=[M||" ",G||" ",le].join("");if(xe==="  "||xe==="  /"||xe===",,"||xe===",,,"){const de=[C,j,J].join(""),he=de==="%%%"?100:de===""?255:0;if(he){const fe=[Qc(+l/he,0,1),Qc(+R/he,0,1),Qc(+B/he,0,1),we?vb(+we,pe):1];if(bb(fe))return fe}}return}}const o=/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,h=i.match(o);if(h){const[m,v,f,l,C,M,R,j,G]=h,B=[f||" ",C||" ",R].join("");if(B==="  "||B==="  /"||B===",,"||B===",,,"){const J=[+v,Qc(+l,0,100),Qc(+M,0,100),j?vb(+j,G):1];if(bb(J))return jP(J)}}}function Xd(i){return parseInt(i.padEnd(2,i),16)/255}function vb(i,r){return Qc(r?i/100:i,0,1)}function Qc(i,r,o){return Math.min(Math.max(r,i),o)}function bb(i){return!i.some(Number.isNaN)}const $P={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function zl(i,r,o){return i+o*(r-i)}function pp(i,r,o){return i.map((h,m)=>zl(h,r[m],o))}class pr{constructor(r,o,h,m=1,v=!0){this.r=r,this.g=o,this.b=h,this.a=m,v||(this.r*=m,this.g*=m,this.b*=m,m||this.overwriteGetter("rgb",[r,o,h,m]))}static parse(r){if(r instanceof pr)return r;if(typeof r!="string")return;const o=BP(r);if(o)return new pr(...o,!1)}get rgb(){const{r,g:o,b:h,a:m}=this,v=m||1/0;return this.overwriteGetter("rgb",[r/v,o/v,h/v,m])}get hcl(){return this.overwriteGetter("hcl",DP(this.rgb))}get lab(){return this.overwriteGetter("lab",iw(this.rgb))}overwriteGetter(r,o){return Object.defineProperty(this,r,{value:o}),o}toString(){const[r,o,h,m]=this.rgb;return`rgba(${[r,o,h].map(v=>Math.round(v*255)).join(",")},${m})`}static interpolate(r,o,h,m="rgb"){switch(m){case"rgb":{const[v,f,l,C]=pp(r.rgb,o.rgb,h);return new pr(v,f,l,C,!1)}case"hcl":{const[v,f,l,C]=r.hcl,[M,R,j,G]=o.hcl;let B,J;if(!isNaN(v)&&!isNaN(M)){let de=M-v;M>v&&de>180?de-=360:M<v&&v-M>180&&(de+=360),B=v+h*de}else isNaN(v)?isNaN(M)?B=NaN:(B=M,(l===1||l===0)&&(J=R)):(B=v,(j===1||j===0)&&(J=f));const[le,we,pe,xe]=FP([B,J??zl(f,R,h),zl(l,j,h),zl(C,G,h)]);return new pr(le,we,pe,xe,!1)}case"lab":{const[v,f,l,C]=nw(pp(r.lab,o.lab,h));return new pr(v,f,l,C,!1)}}}}pr.black=new pr(0,0,0,1);pr.white=new pr(1,1,1,1);pr.transparent=new pr(0,0,0,0);pr.red=new pr(1,0,0,1);let h0=class{constructor(r,o,h){r?this.sensitivity=o?"variant":"case":this.sensitivity=o?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,o){return this.collator.compare(r,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}};const NP=["bottom","center","top"];let Cy=class{constructor(r,o,h,m,v,f){this.text=r,this.image=o,this.scale=h,this.fontStack=m,this.textColor=v,this.verticalAlign=f}};class Oo{constructor(r){this.sections=r}static fromString(r){return new Oo([new Cy(r,null,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(r=>r.text.length!==0||r.image&&r.image.name.length!==0)}static factory(r){return r instanceof Oo?r:Oo.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map(r=>r.text).join("")}}class Ta{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof Ta)return r;if(typeof r=="number")return new Ta([r,r,r,r]);if(Array.isArray(r)&&!(r.length<1||r.length>4)){for(const o of r)if(typeof o!="number")return;switch(r.length){case 1:r=[r[0],r[0],r[0],r[0]];break;case 2:r=[r[0],r[1],r[0],r[1]];break;case 3:r=[r[0],r[1],r[2],r[1]];break}return new Ta(r)}}toString(){return JSON.stringify(this.values)}static interpolate(r,o,h){return new Ta(pp(r.values,o.values,h))}}class Sa{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof Sa)return r;if(typeof r=="number")return new Sa([r]);if(Array.isArray(r)){for(const o of r)if(typeof o!="number")return;return new Sa(r)}}toString(){return JSON.stringify(this.values)}static interpolate(r,o,h){return new Sa(pp(r.values,o.values,h))}}let Is=class qh{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof qh)return r;if(typeof r=="string"){const h=pr.parse(r);return h?new qh([h]):void 0}if(!Array.isArray(r))return;const o=[];for(const h of r){if(typeof h!="string")return;const m=pr.parse(h);if(!m)return;o.push(m)}return new qh(o)}toString(){return JSON.stringify(this.values)}static interpolate(r,o,h,m="rgb"){const v=[];if(r.values.length!=o.values.length)throw new Error(`colorArray: Arrays have mismatched length (${r.values.length} vs. ${o.values.length}), cannot interpolate.`);for(let f=0;f<r.values.length;f++)v.push(pr.interpolate(r.values[f],o.values[f],h,m));return new qh(v)}};class Or extends Error{constructor(r){super(r),this.name="RuntimeError"}toJSON(){return this.message}}const UP=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class io{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof io)return r;if(!(!Array.isArray(r)||r.length<1||r.length%2!==0)){for(let o=0;o<r.length;o+=2){const h=r[o],m=r[o+1];if(typeof h!="string"||!UP.has(h)||!Array.isArray(m)||m.length!==2||typeof m[0]!="number"||typeof m[1]!="number")return}return new io(r)}}toString(){return JSON.stringify(this.values)}static interpolate(r,o,h){const m=r.values,v=o.values;if(m.length!==v.length)throw new Or(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${o.toString()}`);const f=[];for(let l=0;l<m.length;l+=2){if(m[l]!==v[l])throw new Or(`Cannot interpolate values containing mismatched anchors. from[${l}]: ${m[l]}, to[${l}]: ${v[l]}`);f.push(m[l]);const[C,M]=m[l+1],[R,j]=v[l+1];f.push([zl(C,R,h),zl(M,j,h)])}return new io(f)}}class Ls{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new Ls({name:r,available:!1}):null}}let Ep=class eu{constructor(r,o,h){this.from=r,this.to=o,this.transition=h}static interpolate(r,o,h){return new eu(r,o,h)}static parse(r){if(r instanceof eu)return r;if(Array.isArray(r)&&r.length===3&&typeof r[0]=="string"&&typeof r[1]=="string"&&typeof r[2]=="number")return new eu(r[0],r[1],r[2]);if(typeof r=="object"&&typeof r.from=="string"&&typeof r.to=="string"&&typeof r.transition=="number")return new eu(r.from,r.to,r.transition);if(typeof r=="string")return new eu(r,r,1)}};function aw(i,r,o,h){return typeof i=="number"&&i>=0&&i<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof o=="number"&&o>=0&&o<=255?typeof h>"u"||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[i,r,o,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[i,r,o,h]:[i,r,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function dp(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Ep||i instanceof pr||i instanceof h0||i instanceof Oo||i instanceof Ta||i instanceof Sa||i instanceof Is||i instanceof io||i instanceof Ls)return!0;if(Array.isArray(i)){for(const r of i)if(!dp(r))return!1;return!0}else if(typeof i=="object"){for(const r in i)if(!dp(i[r]))return!1;return!0}else return!1}function ui(i){if(i===null)return Nf;if(typeof i=="string")return qt;if(typeof i=="boolean")return Bt;if(typeof i=="number")return Xe;if(i instanceof pr)return ro;if(i instanceof Ep)return Uf;if(i instanceof h0)return Vf;if(i instanceof Oo)return qf;if(i instanceof Ta)return Gf;if(i instanceof Sa)return Zf;if(i instanceof Is)return up;if(i instanceof io)return Wf;if(i instanceof Ls)return Ap;if(Array.isArray(i)){const r=i.length;let o;for(const h of i){const m=ui(h);if(!o)o=m;else{if(o===m)continue;o=Ft;break}}return $n(o||Ft,r)}else return El}function rp(i){const r=typeof i;return i===null?"":r==="string"||r==="number"||r==="boolean"?String(i):i instanceof pr||i instanceof Ep||i instanceof Oo||i instanceof Ta||i instanceof Sa||i instanceof Is||i instanceof io||i instanceof Ls?i.toString():JSON.stringify(i)}let vf=class ow{constructor(r,o){this.type=r,this.value=o}static parse(r,o){if(r.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!dp(r[1]))return o.error("invalid value");const h=r[1];let m=ui(h);const v=o.expectedType;return m.kind==="array"&&m.N===0&&v&&v.kind==="array"&&(typeof v.N!="number"||v.N===0)&&(m=v),new ow(m,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}};const Kd={string:qt,number:Xe,boolean:Bt,object:El};let Lo=class sw{constructor(r,o){this.type=r,this.args=o}static parse(r,o){if(r.length<2)return o.error("Expected at least one argument.");let h=1,m;const v=r[0];if(v==="array"){let l;if(r.length>2){const M=r[1];if(typeof M!="string"||!(M in Kd)||M==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);l=Kd[M],h++}else l=Ft;let C;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return o.error('The length argument to "array" must be a positive integer literal',2);C=r[2],h++}m=$n(l,C)}else{if(!Kd[v])throw new Error(`Types doesn't contain name = ${v}`);m=Kd[v]}const f=[];for(;h<r.length;h++){const l=o.parse(r[h],h,Ft);if(!l)return null;f.push(l)}return new sw(m,f)}evaluate(r){for(let o=0;o<this.args.length;o++){const h=this.args[o].evaluate(r);if(hp(this.type,ui(h))){if(o===this.args.length-1)throw new Or(`Expected value to be of type ${zr(this.type)}, but found ${zr(ui(h))} instead.`)}else return h}throw new Error}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}};const xb={"to-boolean":Bt,"to-color":ro,"to-number":Xe,"to-string":qt};let au=class lw{constructor(r,o){this.type=r,this.args=o}static parse(r,o){if(r.length<2)return o.error("Expected at least one argument.");const h=r[0];if(!xb[h])throw new Error(`Can't parse ${h} as it is not part of the known types`);if((h==="to-boolean"||h==="to-string")&&r.length!==2)return o.error("Expected one argument.");const m=xb[h],v=[];for(let f=1;f<r.length;f++){const l=o.parse(r[f],f,Ft);if(!l)return null;v.push(l)}return new lw(m,v)}evaluate(r){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(r);case"color":{let o,h;for(const m of this.args){if(o=m.evaluate(r),h=null,o instanceof pr)return o;if(typeof o=="string"){const v=r.parseColor(o);if(v)return v}else if(Array.isArray(o)&&(o.length<3||o.length>4?h=`Invalid rgba value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:h=aw(o[0],o[1],o[2],o[3]),!h))return new pr(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new Or(h||`Could not parse color from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"padding":{let o;for(const h of this.args){o=h.evaluate(r);const m=Ta.parse(o);if(m)return m}throw new Or(`Could not parse padding from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"numberArray":{let o;for(const h of this.args){o=h.evaluate(r);const m=Sa.parse(o);if(m)return m}throw new Or(`Could not parse numberArray from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"colorArray":{let o;for(const h of this.args){o=h.evaluate(r);const m=Is.parse(o);if(m)return m}throw new Or(`Could not parse colorArray from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"variableAnchorOffsetCollection":{let o;for(const h of this.args){o=h.evaluate(r);const m=io.parse(o);if(m)return m}throw new Or(`Could not parse variableAnchorOffsetCollection from value '${typeof o=="string"?o:JSON.stringify(o)}'`)}case"number":{let o=null;for(const h of this.args){if(o=h.evaluate(r),o===null)return 0;const m=Number(o);if(!isNaN(m))return m}throw new Or(`Could not convert ${JSON.stringify(o)} to number.`)}case"formatted":return Oo.fromString(rp(this.args[0].evaluate(r)));case"resolvedImage":return Ls.fromString(rp(this.args[0].evaluate(r)));case"projectionDefinition":return this.args[0].evaluate(r);default:return rp(this.args[0].evaluate(r))}}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}};const VP=["Unknown","Point","LineString","Polygon"];let cw=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?VP[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(r){let o=this._parseColorCache.get(r);return o||(o=pr.parse(r),this._parseColorCache.set(r,o)),o}},uw=class hw{constructor(r,o,h=[],m,v=new AP,f=[]){this.registry=r,this.path=h,this.key=h.map(l=>`[${l}]`).join(""),this.scope=v,this.errors=f,this.expectedType=m,this._isConstant=o}parse(r,o,h,m,v={}){return o?this.concat(o,h,m)._parse(r,v):this._parse(r,v)}_parse(r,o){(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number")&&(r=["literal",r]);function h(m,v,f){return f==="assert"?new Lo(v,[m]):f==="coerce"?new au(v,[m]):m}if(Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=r[0];if(typeof m!="string")return this.error(`Expression name must be a string, but found ${typeof m} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const v=this.registry[m];if(v){let f=v.parse(r,this);if(!f)return null;if(this.expectedType){const l=this.expectedType,C=f.type;if((l.kind==="string"||l.kind==="number"||l.kind==="boolean"||l.kind==="object"||l.kind==="array")&&C.kind==="value")f=h(f,l,o.typeAnnotation||"assert");else if(l.kind==="projectionDefinition"&&["string","array"].includes(C.kind)||["color","formatted","resolvedImage"].includes(l.kind)&&["value","string"].includes(C.kind)||["padding","numberArray"].includes(l.kind)&&["value","number","array"].includes(C.kind)||l.kind==="colorArray"&&["value","string","array"].includes(C.kind)||l.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(C.kind))f=h(f,l,o.typeAnnotation||"coerce");else if(this.checkSubtype(l,C))return null}if(!(f instanceof vf)&&f.type.kind!=="resolvedImage"&&this._isConstant(f)){const l=new cw;try{f=new vf(f.type,f.evaluate(l))}catch(C){return this.error(C.message),null}}return f}return this.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof r>"u"?this.error("'undefined' value invalid. Use null instead."):typeof r=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof r} instead.`)}concat(r,o,h){const m=typeof r=="number"?this.path.concat(r):this.path,v=h?this.scope.concat(h):this.scope;return new hw(this.registry,this._isConstant,m,o||null,v,this.errors)}error(r,...o){const h=`${this.key}${o.map(m=>`[${m}]`).join("")}`;this.errors.push(new eo(h,r))}checkSubtype(r,o){const h=hp(r,o);return h&&this.error(h),h}},pw=class dw{constructor(r,o){this.type=o.type,this.bindings=[].concat(r),this.result=o}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const o of this.bindings)r(o[1]);r(this.result)}static parse(r,o){if(r.length<4)return o.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const h=[];for(let v=1;v<r.length-1;v+=2){const f=r[v];if(typeof f!="string")return o.error(`Expected string, but found ${typeof f} instead.`,v);if(/[^a-zA-Z0-9_]/.test(f))return o.error("Variable names must contain only alphanumeric characters or '_'.",v);const l=o.parse(r[v+1],v+1);if(!l)return null;h.push([f,l])}const m=o.parse(r[r.length-1],r.length-1,o.expectedType,h);return m?new dw(h,m):null}outputDefined(){return this.result.outputDefined()}},fw=class mw{constructor(r,o){this.type=o.type,this.name=r,this.boundExpression=o}static parse(r,o){if(r.length!==2||typeof r[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const h=r[1];return o.scope.has(h)?new mw(h,o.scope.get(h)):o.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}},qP=class gw{constructor(r,o,h){this.type=r,this.index=o,this.input=h}static parse(r,o){if(r.length!==3)return o.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const h=o.parse(r[1],1,Xe),m=o.parse(r[2],2,$n(o.expectedType||Ft));if(!h||!m)return null;const v=m.type;return new gw(v.itemType,h,m)}evaluate(r){const o=this.index.evaluate(r),h=this.input.evaluate(r);if(o<0)throw new Or(`Array index out of bounds: ${o} < 0.`);if(o>=h.length)throw new Or(`Array index out of bounds: ${o} > ${h.length-1}.`);if(o!==Math.floor(o))throw new Or(`Array index must be an integer, but found ${o} instead.`);return h[o]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}},GP=class yw{constructor(r,o){this.type=Bt,this.needle=r,this.haystack=o}static parse(r,o){if(r.length!==3)return o.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const h=o.parse(r[1],1,Ft),m=o.parse(r[2],2,Ft);return!h||!m?null:u0(h.type,[Bt,qt,Xe,Nf,Ft])?new yw(h,m):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${zr(h.type)} instead`)}evaluate(r){const o=this.needle.evaluate(r),h=this.haystack.evaluate(r);if(!h)return!1;if(!Il(o,["boolean","string","number","null"]))throw new Or(`Expected first argument to be of type boolean, string, number or null, but found ${zr(ui(o))} instead.`);if(!Il(h,["string","array"]))throw new Or(`Expected second argument to be of type array or string, but found ${zr(ui(h))} instead.`);return h.indexOf(o)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}},ZP=class Py{constructor(r,o,h){this.type=Xe,this.needle=r,this.haystack=o,this.fromIndex=h}static parse(r,o){if(r.length<=2||r.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const h=o.parse(r[1],1,Ft),m=o.parse(r[2],2,Ft);if(!h||!m)return null;if(!u0(h.type,[Bt,qt,Xe,Nf,Ft]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${zr(h.type)} instead`);if(r.length===4){const v=o.parse(r[3],3,Xe);return v?new Py(h,m,v):null}else return new Py(h,m)}evaluate(r){const o=this.needle.evaluate(r),h=this.haystack.evaluate(r);if(!Il(o,["boolean","string","number","null"]))throw new Or(`Expected first argument to be of type boolean, string, number or null, but found ${zr(ui(o))} instead.`);let m;if(this.fromIndex&&(m=this.fromIndex.evaluate(r)),Il(h,["string"])){const v=h.indexOf(o,m);return v===-1?-1:[...h.slice(0,v)].length}else{if(Il(h,["array"]))return h.indexOf(o,m);throw new Or(`Expected second argument to be of type array or string, but found ${zr(ui(h))} instead.`)}}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}},WP=class _w{constructor(r,o,h,m,v,f){this.inputType=r,this.type=o,this.input=h,this.cases=m,this.outputs=v,this.otherwise=f}static parse(r,o){if(r.length<5)return o.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!==1)return o.error("Expected an even number of arguments.");let h,m;o.expectedType&&o.expectedType.kind!=="value"&&(m=o.expectedType);const v={},f=[];for(let M=2;M<r.length-1;M+=2){let R=r[M];const j=r[M+1];Array.isArray(R)||(R=[R]);const G=o.concat(M);if(R.length===0)return G.error("Expected at least one branch label.");for(const J of R){if(typeof J!="number"&&typeof J!="string")return G.error("Branch labels must be numbers or strings.");if(typeof J=="number"&&Math.abs(J)>Number.MAX_SAFE_INTEGER)return G.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof J=="number"&&Math.floor(J)!==J)return G.error("Numeric branch labels must be integer values.");if(!h)h=ui(J);else if(G.checkSubtype(h,ui(J)))return null;if(typeof v[String(J)]<"u")return G.error("Branch labels must be unique.");v[String(J)]=f.length}const B=o.parse(j,M,m);if(!B)return null;m=m||B.type,f.push(B)}const l=o.parse(r[1],1,Ft);if(!l)return null;const C=o.parse(r[r.length-1],r.length-1,m);return!C||l.type.kind!=="value"&&o.concat(1).checkSubtype(h,l.type)?null:new _w(h,m,l,v,f,C)}evaluate(r){const o=this.input.evaluate(r);return(ui(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}},HP=class vw{constructor(r,o,h){this.type=r,this.branches=o,this.otherwise=h}static parse(r,o){if(r.length<4)return o.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!==0)return o.error("Expected an odd number of arguments.");let h;o.expectedType&&o.expectedType.kind!=="value"&&(h=o.expectedType);const m=[];for(let f=1;f<r.length-1;f+=2){const l=o.parse(r[f],f,Bt);if(!l)return null;const C=o.parse(r[f+1],f+1,h);if(!C)return null;m.push([l,C]),h=h||C.type}const v=o.parse(r[r.length-1],r.length-1,h);if(!v)return null;if(!h)throw new Error("Can't infer output type");return new vw(h,m,v)}evaluate(r){for(const[o,h]of this.branches)if(o.evaluate(r))return h.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[o,h]of this.branches)r(o),r(h);r(this.otherwise)}outputDefined(){return this.branches.every(([r,o])=>o.outputDefined())&&this.otherwise.outputDefined()}},XP=class My{constructor(r,o,h,m){this.type=r,this.input=o,this.beginIndex=h,this.endIndex=m}static parse(r,o){if(r.length<=2||r.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const h=o.parse(r[1],1,Ft),m=o.parse(r[2],2,Xe);if(!h||!m)return null;if(!u0(h.type,[$n(Ft),qt,Ft]))return o.error(`Expected first argument to be of type array or string, but found ${zr(h.type)} instead`);if(r.length===4){const v=o.parse(r[3],3,Xe);return v?new My(h.type,h,m,v):null}else return new My(h.type,h,m)}evaluate(r){const o=this.input.evaluate(r),h=this.beginIndex.evaluate(r);let m;if(this.endIndex&&(m=this.endIndex.evaluate(r)),Il(o,["string"]))return[...o].slice(h,m).join("");if(Il(o,["array"]))return o.slice(h,m);throw new Or(`Expected first argument to be of type array or string, but found ${zr(ui(o))} instead.`)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}};function bw(i,r){const o=i.length-1;let h=0,m=o,v=0,f,l;for(;h<=m;)if(v=Math.floor((h+m)/2),f=i[v],l=i[v+1],f<=r){if(v===o||r<l)return v;h=v+1}else if(f>r)m=v-1;else throw new Or("Input is not a number.");return 0}let xw=class ww{constructor(r,o,h){this.type=r,this.input=o,this.labels=[],this.outputs=[];for(const[m,v]of h)this.labels.push(m),this.outputs.push(v)}static parse(r,o){if(r.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!==0)return o.error("Expected an even number of arguments.");const h=o.parse(r[1],1,Xe);if(!h)return null;const m=[];let v=null;o.expectedType&&o.expectedType.kind!=="value"&&(v=o.expectedType);for(let f=1;f<r.length;f+=2){const l=f===1?-1/0:r[f],C=r[f+1],M=f,R=f+1;if(typeof l!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(m.length&&m[m.length-1][0]>=l)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const j=o.parse(C,R,v);if(!j)return null;v=v||j.type,m.push([l,j])}return new ww(v,h,m)}evaluate(r){const o=this.labels,h=this.outputs;if(o.length===1)return h[0].evaluate(r);const m=this.input.evaluate(r);if(m<=o[0])return h[0].evaluate(r);const v=o.length;if(m>=o[v-1])return h[v-1].evaluate(r);const f=bw(o,m);return h[f].evaluate(r)}eachChild(r){r(this.input);for(const o of this.outputs)r(o)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}};function KP(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var zg,wb;function YP(){if(wb)return zg;wb=1,zg=i;function i(r,o,h,m){this.cx=3*r,this.bx=3*(h-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(m-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=o,this.p2x=h,this.p2y=m}return i.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,o){if(o===void 0&&(o=1e-6),r<0)return 0;if(r>1)return 1;for(var h=r,m=0;m<8;m++){var v=this.sampleCurveX(h)-r;if(Math.abs(v)<o)return h;var f=this.sampleCurveDerivativeX(h);if(Math.abs(f)<1e-6)break;h=h-v/f}var l=0,C=1;for(h=r,m=0;m<20&&(v=this.sampleCurveX(h),!(Math.abs(v-r)<o));m++)r>v?l=h:C=h,h=(C-l)*.5+l;return h},solve:function(r,o){return this.sampleCurveY(this.solveCurveX(r,o))}},zg}var JP=YP(),QP=KP(JP);let Rl=class Ay{constructor(r,o,h,m,v){this.type=r,this.operator=o,this.interpolation=h,this.input=m,this.labels=[],this.outputs=[];for(const[f,l]of v)this.labels.push(f),this.outputs.push(l)}static interpolationFactor(r,o,h,m){let v=0;if(r.name==="exponential")v=Rg(o,r.base,h,m);else if(r.name==="linear")v=Rg(o,1,h,m);else if(r.name==="cubic-bezier"){const f=r.controlPoints;v=new QP(f[0],f[1],f[2],f[3]).solve(Rg(o,1,h,m))}return v}static parse(r,o){let[h,m,v,...f]=r;if(!Array.isArray(m)||m.length===0)return o.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){const M=m[1];if(typeof M!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:M}}else if(m[0]==="cubic-bezier"){const M=m.slice(1);if(M.length!==4||M.some(R=>typeof R!="number"||R<0||R>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:M}}else return o.error(`Unknown interpolation type ${String(m[0])}`,1,0);if(r.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!==0)return o.error("Expected an even number of arguments.");if(v=o.parse(v,2,Xe),!v)return null;const l=[];let C=null;(h==="interpolate-hcl"||h==="interpolate-lab")&&o.expectedType!=up?C=ro:o.expectedType&&o.expectedType.kind!=="value"&&(C=o.expectedType);for(let M=0;M<f.length;M+=2){const R=f[M],j=f[M+1],G=M+3,B=M+4;if(typeof R!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',G);if(l.length&&l[l.length-1][0]>=R)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',G);const J=o.parse(j,B,C);if(!J)return null;C=C||J.type,l.push([R,J])}return!Ts(C,Xe)&&!Ts(C,Uf)&&!Ts(C,ro)&&!Ts(C,Gf)&&!Ts(C,Zf)&&!Ts(C,up)&&!Ts(C,Wf)&&!Ts(C,$n(Xe))?o.error(`Type ${zr(C)} is not interpolatable.`):new Ay(C,h,m,v,l)}evaluate(r){const o=this.labels,h=this.outputs;if(o.length===1)return h[0].evaluate(r);const m=this.input.evaluate(r);if(m<=o[0])return h[0].evaluate(r);const v=o.length;if(m>=o[v-1])return h[v-1].evaluate(r);const f=bw(o,m),l=o[f],C=o[f+1],M=Ay.interpolationFactor(this.interpolation,m,l,C),R=h[f].evaluate(r),j=h[f+1].evaluate(r);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return zl(R,j,M);case"color":return pr.interpolate(R,j,M);case"padding":return Ta.interpolate(R,j,M);case"colorArray":return Is.interpolate(R,j,M);case"numberArray":return Sa.interpolate(R,j,M);case"variableAnchorOffsetCollection":return io.interpolate(R,j,M);case"array":return pp(R,j,M);case"projectionDefinition":return Ep.interpolate(R,j,M)}case"interpolate-hcl":switch(this.type.kind){case"color":return pr.interpolate(R,j,M,"hcl");case"colorArray":return Is.interpolate(R,j,M,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return pr.interpolate(R,j,M,"lab");case"colorArray":return Is.interpolate(R,j,M,"lab")}}}eachChild(r){r(this.input);for(const o of this.outputs)r(o)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}};function Rg(i,r,o,h){const m=h-o,v=i-o;return m===0?0:r===1?v/m:(Math.pow(r,v)-1)/(Math.pow(r,m)-1)}let Tw=class Ey{constructor(r,o){this.type=r,this.args=o}static parse(r,o){if(r.length<2)return o.error("Expected at least one argument.");let h=null;const m=o.expectedType;m&&m.kind!=="value"&&(h=m);const v=[];for(const f of r.slice(1)){const l=o.parse(f,1+v.length,h,void 0,{typeAnnotation:"omit"});if(!l)return null;h=h||l.type,v.push(l)}if(!h)throw new Error("No output type");return m&&v.some(f=>hp(m,f.type))?new Ey(Ft,v):new Ey(h,v)}evaluate(r){let o=null,h=0,m;for(const v of this.args)if(h++,o=v.evaluate(r),o&&o instanceof Ls&&!o.available&&(m||(m=o.name),o=null,h===this.args.length&&(o=m)),o!==null)break;return o}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}};function Tb(i,r){return i==="=="||i==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function eM(i,r,o){return r===o}function tM(i,r,o){return r!==o}function rM(i,r,o){return r<o}function iM(i,r,o){return r>o}function nM(i,r,o){return r<=o}function aM(i,r,o){return r>=o}function Sw(i,r,o,h){return h.compare(r,o)===0}function oM(i,r,o,h){return!Sw(i,r,o,h)}function sM(i,r,o,h){return h.compare(r,o)<0}function lM(i,r,o,h){return h.compare(r,o)>0}function cM(i,r,o,h){return h.compare(r,o)<=0}function uM(i,r,o,h){return h.compare(r,o)>=0}function Cu(i,r,o){const h=i!=="=="&&i!=="!=";return class kw{constructor(v,f,l){this.type=Bt,this.lhs=v,this.rhs=f,this.collator=l,this.hasUntypedArgument=v.type.kind==="value"||f.type.kind==="value"}static parse(v,f){if(v.length!==3&&v.length!==4)return f.error("Expected two or three arguments.");const l=v[0];let C=f.parse(v[1],1,Ft);if(!C)return null;if(!Tb(l,C.type))return f.concat(1).error(`"${l}" comparisons are not supported for type '${zr(C.type)}'.`);let M=f.parse(v[2],2,Ft);if(!M)return null;if(!Tb(l,M.type))return f.concat(2).error(`"${l}" comparisons are not supported for type '${zr(M.type)}'.`);if(C.type.kind!==M.type.kind&&C.type.kind!=="value"&&M.type.kind!=="value")return f.error(`Cannot compare types '${zr(C.type)}' and '${zr(M.type)}'.`);h&&(C.type.kind==="value"&&M.type.kind!=="value"?C=new Lo(M.type,[C]):C.type.kind!=="value"&&M.type.kind==="value"&&(M=new Lo(C.type,[M])));let R=null;if(v.length===4){if(C.type.kind!=="string"&&M.type.kind!=="string"&&C.type.kind!=="value"&&M.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(R=f.parse(v[3],3,Vf),!R)return null}return new kw(C,M,R)}evaluate(v){const f=this.lhs.evaluate(v),l=this.rhs.evaluate(v);if(h&&this.hasUntypedArgument){const C=ui(f),M=ui(l);if(C.kind!==M.kind||!(C.kind==="string"||C.kind==="number"))throw new Or(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${C.kind}, ${M.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const C=ui(f),M=ui(l);if(C.kind!=="string"||M.kind!=="string")return r(v,f,l)}return this.collator?o(v,f,l,this.collator.evaluate(v)):r(v,f,l)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}}}const hM=Cu("==",eM,Sw),pM=Cu("!=",tM,oM),dM=Cu("<",rM,sM),fM=Cu(">",iM,lM),mM=Cu("<=",nM,cM),gM=Cu(">=",aM,uM);let Cw=class Pw{constructor(r,o,h){this.type=Vf,this.locale=h,this.caseSensitive=r,this.diacriticSensitive=o}static parse(r,o){if(r.length!==2)return o.error("Expected one argument.");const h=r[1];if(typeof h!="object"||Array.isArray(h))return o.error("Collator options argument must be an object.");const m=o.parse(h["case-sensitive"]===void 0?!1:h["case-sensitive"],1,Bt);if(!m)return null;const v=o.parse(h["diacritic-sensitive"]===void 0?!1:h["diacritic-sensitive"],1,Bt);if(!v)return null;let f=null;return h.locale&&(f=o.parse(h.locale,1,qt),!f)?null:new Pw(m,v,f)}evaluate(r){return new h0(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}},yM=class Mw{constructor(r,o,h,m,v){this.type=qt,this.number=r,this.locale=o,this.currency=h,this.minFractionDigits=m,this.maxFractionDigits=v}static parse(r,o){if(r.length!==3)return o.error("Expected two arguments.");const h=o.parse(r[1],1,Xe);if(!h)return null;const m=r[2];if(typeof m!="object"||Array.isArray(m))return o.error("NumberFormat options argument must be an object.");let v=null;if(m.locale&&(v=o.parse(m.locale,1,qt),!v))return null;let f=null;if(m.currency&&(f=o.parse(m.currency,1,qt),!f))return null;let l=null;if(m["min-fraction-digits"]&&(l=o.parse(m["min-fraction-digits"],1,Xe),!l))return null;let C=null;return m["max-fraction-digits"]&&(C=o.parse(m["max-fraction-digits"],1,Xe),!C)?null:new Mw(h,v,f,l,C)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}},_M=class Aw{constructor(r){this.type=qf,this.sections=r}static parse(r,o){if(r.length<2)return o.error("Expected at least one argument.");const h=r[1];if(!Array.isArray(h)&&typeof h=="object")return o.error("First argument must be an image or text section.");const m=[];let v=!1;for(let f=1;f<=r.length-1;++f){const l=r[f];if(v&&typeof l=="object"&&!Array.isArray(l)){v=!1;let C=null;if(l["font-scale"]&&(C=o.parse(l["font-scale"],1,Xe),!C))return null;let M=null;if(l["text-font"]&&(M=o.parse(l["text-font"],1,$n(qt)),!M))return null;let R=null;if(l["text-color"]&&(R=o.parse(l["text-color"],1,ro),!R))return null;let j=null;if(l["vertical-align"]){if(typeof l["vertical-align"]=="string"&&!NP.includes(l["vertical-align"]))return o.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${l["vertical-align"]}' instead.`);if(j=o.parse(l["vertical-align"],1,qt),!j)return null}const G=m[m.length-1];G.scale=C,G.font=M,G.textColor=R,G.verticalAlign=j}else{const C=o.parse(r[f],1,Ft);if(!C)return null;const M=C.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,m.push({content:C,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Aw(m)}evaluate(r){const o=h=>{const m=h.content.evaluate(r);return ui(m)===Ap?new Cy("",m,null,null,null,h.verticalAlign?h.verticalAlign.evaluate(r):null):new Cy(rp(m),null,h.scale?h.scale.evaluate(r):null,h.font?h.font.evaluate(r).join(","):null,h.textColor?h.textColor.evaluate(r):null,h.verticalAlign?h.verticalAlign.evaluate(r):null)};return new Oo(this.sections.map(o))}eachChild(r){for(const o of this.sections)r(o.content),o.scale&&r(o.scale),o.font&&r(o.font),o.textColor&&r(o.textColor),o.verticalAlign&&r(o.verticalAlign)}outputDefined(){return!1}},vM=class Ew{constructor(r){this.type=Ap,this.input=r}static parse(r,o){if(r.length!==2)return o.error("Expected two arguments.");const h=o.parse(r[1],1,qt);return h?new Ew(h):o.error("No image name provided.")}evaluate(r){const o=this.input.evaluate(r),h=Ls.fromString(o);return h&&r.availableImages&&(h.available=r.availableImages.indexOf(o)>-1),h}eachChild(r){r(this.input)}outputDefined(){return!1}},bM=class Iw{constructor(r){this.type=Xe,this.input=r}static parse(r,o){if(r.length!==2)return o.error(`Expected 1 argument, but found ${r.length-1} instead.`);const h=o.parse(r[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${zr(h.type)} instead.`):new Iw(h):null}evaluate(r){const o=this.input.evaluate(r);if(typeof o=="string")return[...o].length;if(Array.isArray(o))return o.length;throw new Or(`Expected value to be of type string or array, but found ${zr(ui(o))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}};const no=8192;function xM(i,r){const o=wM(i[0]),h=SM(i[1]),m=Math.pow(2,r.z);return[Math.round(o*m*no),Math.round(h*m*no)]}function p0(i,r){const o=Math.pow(2,r.z),h=(i[0]/no+r.x)/o,m=(i[1]/no+r.y)/o;return[TM(h),kM(m)]}function wM(i){return(180+i)/360}function TM(i){return i*360-180}function SM(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function kM(i){return 360/Math.PI*Math.atan(Math.exp((180-i*360)*Math.PI/180))-90}function Ip(i,r){i[0]=Math.min(i[0],r[0]),i[1]=Math.min(i[1],r[1]),i[2]=Math.max(i[2],r[0]),i[3]=Math.max(i[3],r[1])}function fp(i,r){return!(i[0]<=r[0]||i[2]>=r[2]||i[1]<=r[1]||i[3]>=r[3])}function CM(i,r,o){return r[1]>i[1]!=o[1]>i[1]&&i[0]<(o[0]-r[0])*(i[1]-r[1])/(o[1]-r[1])+r[0]}function PM(i,r,o){const h=i[0]-r[0],m=i[1]-r[1],v=i[0]-o[0],f=i[1]-o[1];return h*f-v*m===0&&h*v<=0&&m*f<=0}function Hf(i,r,o,h){const m=[r[0]-i[0],r[1]-i[1]],v=[h[0]-o[0],h[1]-o[1]];return IM(v,m)===0?!1:!!(Sb(i,r,o,h)&&Sb(o,h,i,r))}function MM(i,r,o){for(const h of o)for(let m=0;m<h.length-1;++m)if(Hf(i,r,h[m],h[m+1]))return!0;return!1}function Pu(i,r,o=!1){let h=!1;for(const m of r)for(let v=0;v<m.length-1;v++){if(PM(i,m[v],m[v+1]))return o;CM(i,m[v],m[v+1])&&(h=!h)}return h}function AM(i,r){for(const o of r)if(Pu(i,o))return!0;return!1}function zw(i,r){for(const o of i)if(!Pu(o,r))return!1;for(let o=0;o<i.length-1;++o)if(MM(i[o],i[o+1],r))return!1;return!0}function EM(i,r){for(const o of r)if(zw(i,o))return!0;return!1}function IM(i,r){return i[0]*r[1]-i[1]*r[0]}function Sb(i,r,o,h){const m=i[0]-o[0],v=i[1]-o[1],f=r[0]-o[0],l=r[1]-o[1],C=h[0]-o[0],M=h[1]-o[1],R=m*M-C*v,j=f*M-C*l;return R>0&&j<0||R<0&&j>0}function d0(i,r,o){const h=[];for(let m=0;m<i.length;m++){const v=[];for(let f=0;f<i[m].length;f++){const l=xM(i[m][f],o);Ip(r,l),v.push(l)}h.push(v)}return h}function Rw(i,r,o){const h=[];for(let m=0;m<i.length;m++){const v=d0(i[m],r,o);h.push(v)}return h}function Lw(i,r,o,h){if(i[0]<o[0]||i[0]>o[2]){const m=h*.5;let v=i[0]-o[0]>m?-h:o[0]-i[0]>m?h:0;v===0&&(v=i[0]-o[2]>m?-h:o[2]-i[0]>m?h:0),i[0]+=v}Ip(r,i)}function zM(i){i[0]=i[1]=1/0,i[2]=i[3]=-1/0}function kb(i,r,o,h){const m=Math.pow(2,h.z)*no,v=[h.x*no,h.y*no],f=[];for(const l of i)for(const C of l){const M=[C.x+v[0],C.y+v[1]];Lw(M,r,o,m),f.push(M)}return f}function Cb(i,r,o,h){const m=Math.pow(2,h.z)*no,v=[h.x*no,h.y*no],f=[];for(const l of i){const C=[];for(const M of l){const R=[M.x+v[0],M.y+v[1]];Ip(r,R),C.push(R)}f.push(C)}if(r[2]-r[0]<=m/2){zM(r);for(const l of f)for(const C of l)Lw(C,r,o,m)}return f}function RM(i,r){const o=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(r.type==="Polygon"){const v=d0(r.coordinates,h,m),f=kb(i.geometry(),o,h,m);if(!fp(o,h))return!1;for(const l of f)if(!Pu(l,v))return!1}if(r.type==="MultiPolygon"){const v=Rw(r.coordinates,h,m),f=kb(i.geometry(),o,h,m);if(!fp(o,h))return!1;for(const l of f)if(!AM(l,v))return!1}return!0}function LM(i,r){const o=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(r.type==="Polygon"){const v=d0(r.coordinates,h,m),f=Cb(i.geometry(),o,h,m);if(!fp(o,h))return!1;for(const l of f)if(!zw(l,v))return!1}if(r.type==="MultiPolygon"){const v=Rw(r.coordinates,h,m),f=Cb(i.geometry(),o,h,m);if(!fp(o,h))return!1;for(const l of f)if(!EM(l,v))return!1}return!0}class Ll{constructor(r,o){this.type=Bt,this.geojson=r,this.geometries=o}static parse(r,o){if(r.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(dp(r[1])){const h=r[1];if(h.type==="FeatureCollection"){const m=[];for(const v of h.features){const{type:f,coordinates:l}=v.geometry;f==="Polygon"&&m.push(l),f==="MultiPolygon"&&m.push(...l)}if(m.length){const v={type:"MultiPolygon",coordinates:m};return new Ll(h,v)}}else if(h.type==="Feature"){const m=h.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Ll(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new Ll(h,h)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return RM(r,this.geometries);if(r.geometryType()==="LineString")return LM(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Dw=class{constructor(r=[],o=(h,m)=>h<m?-1:h>m?1:0){if(this.data=r,this.length=this.data.length,this.compare=o,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],o=this.data.pop();return--this.length>0&&(this.data[0]=o,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:o,compare:h}=this,m=o[r];for(;r>0;){const v=r-1>>1,f=o[v];if(h(m,f)>=0)break;o[r]=f,r=v}o[r]=m}_down(r){const{data:o,compare:h}=this,m=this.length>>1,v=o[r];for(;r<m;){let f=(r<<1)+1;const l=f+1;if(l<this.length&&h(o[l],o[f])<0&&(f=l),h(o[f],v)>=0)break;o[r]=o[f],r=f}o[r]=v}};function DM(i,r){if(i.length<=1)return[i];const o=[];let h,m;for(const v of i){const f=FM(v);f!==0&&(v.area=Math.abs(f),m===void 0&&(m=f<0),m===f<0?(h&&o.push(h),h=[v]):h.push(v))}return h&&o.push(h),o}function FM(i){let r=0;for(let o=0,h=i.length,m=h-1,v,f;o<h;m=o++)v=i[o],f=i[m],r+=(f.x-v.x)*(v.y+f.y);return r}const jM=6378.137,Pb=1/298.257223563,Mb=Pb*(2-Pb),Ab=Math.PI/180;let f0=class{constructor(r){const o=Ab*jM*1e3,h=Math.cos(r*Ab),m=1/(1-Mb*(1-h*h)),v=Math.sqrt(m);this.kx=o*v*h,this.ky=o*v*m*(1-Mb)}distance(r,o){const h=this.wrap(r[0]-o[0])*this.kx,m=(r[1]-o[1])*this.ky;return Math.sqrt(h*h+m*m)}pointOnLine(r,o){let h=1/0,m,v,f,l;for(let C=0;C<r.length-1;C++){let M=r[C][0],R=r[C][1],j=this.wrap(r[C+1][0]-M)*this.kx,G=(r[C+1][1]-R)*this.ky,B=0;(j!==0||G!==0)&&(B=(this.wrap(o[0]-M)*this.kx*j+(o[1]-R)*this.ky*G)/(j*j+G*G),B>1?(M=r[C+1][0],R=r[C+1][1]):B>0&&(M+=j/this.kx*B,R+=G/this.ky*B)),j=this.wrap(o[0]-M)*this.kx,G=(o[1]-R)*this.ky;const J=j*j+G*G;J<h&&(h=J,m=M,v=R,f=C,l=B)}return{point:[m,v],index:f,t:Math.max(0,Math.min(1,l))}}wrap(r){for(;r<-180;)r+=360;for(;r>180;)r-=360;return r}};const Iy=100,zy=50;function Fw(i,r){return r[0]-i[0]}function bf(i){return i[1]-i[0]+1}function Uo(i,r){return i[1]>=i[0]&&i[1]<r}function Ry(i,r){if(i[0]>i[1])return[null,null];const o=bf(i);if(r){if(o===2)return[i,null];const m=Math.floor(o/2);return[[i[0],i[0]+m],[i[0]+m,i[1]]]}if(o===1)return[i,null];const h=Math.floor(o/2)-1;return[[i[0],i[0]+h],[i[0]+h+1,i[1]]]}function Ly(i,r){if(!Uo(r,i.length))return[1/0,1/0,-1/0,-1/0];const o=[1/0,1/0,-1/0,-1/0];for(let h=r[0];h<=r[1];++h)Ip(o,i[h]);return o}function Dy(i){const r=[1/0,1/0,-1/0,-1/0];for(const o of i)for(const h of o)Ip(r,h);return r}function Eb(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function m0(i,r,o){if(!Eb(i)||!Eb(r))return NaN;let h=0,m=0;return i[2]<r[0]&&(h=r[0]-i[2]),i[0]>r[2]&&(h=i[0]-r[2]),i[1]>r[3]&&(m=i[1]-r[3]),i[3]<r[1]&&(m=r[1]-i[3]),o.distance([0,0],[h,m])}function Cl(i,r,o){const h=o.pointOnLine(r,i);return o.distance(i,h.point)}function g0(i,r,o,h,m){const v=Math.min(Cl(i,[o,h],m),Cl(r,[o,h],m)),f=Math.min(Cl(o,[i,r],m),Cl(h,[i,r],m));return Math.min(v,f)}function OM(i,r,o,h,m){if(!(Uo(r,i.length)&&Uo(h,o.length)))return 1/0;let v=1/0;for(let f=r[0];f<r[1];++f){const l=i[f],C=i[f+1];for(let M=h[0];M<h[1];++M){const R=o[M],j=o[M+1];if(Hf(l,C,R,j))return 0;v=Math.min(v,g0(l,C,R,j,m))}}return v}function BM(i,r,o,h,m){if(!(Uo(r,i.length)&&Uo(h,o.length)))return NaN;let v=1/0;for(let f=r[0];f<=r[1];++f)for(let l=h[0];l<=h[1];++l)if(v=Math.min(v,m.distance(i[f],o[l])),v===0)return v;return v}function $M(i,r,o){if(Pu(i,r,!0))return 0;let h=1/0;for(const m of r){const v=m[0],f=m[m.length-1];if(v!==f&&(h=Math.min(h,Cl(i,[f,v],o)),h===0))return h;const l=o.pointOnLine(m,i);if(h=Math.min(h,o.distance(i,l.point)),h===0)return h}return h}function NM(i,r,o,h){if(!Uo(r,i.length))return NaN;for(let v=r[0];v<=r[1];++v)if(Pu(i[v],o,!0))return 0;let m=1/0;for(let v=r[0];v<r[1];++v){const f=i[v],l=i[v+1];for(const C of o)for(let M=0,R=C.length,j=R-1;M<R;j=M++){const G=C[j],B=C[M];if(Hf(f,l,G,B))return 0;m=Math.min(m,g0(f,l,G,B,h))}}return m}function Ib(i,r){for(const o of i)for(const h of o)if(Pu(h,r,!0))return!0;return!1}function UM(i,r,o,h=1/0){const m=Dy(i),v=Dy(r);if(h!==1/0&&m0(m,v,o)>=h)return h;if(fp(m,v)){if(Ib(i,r))return 0}else if(Ib(r,i))return 0;let f=1/0;for(const l of i)for(let C=0,M=l.length,R=M-1;C<M;R=C++){const j=l[R],G=l[C];for(const B of r)for(let J=0,le=B.length,we=le-1;J<le;we=J++){const pe=B[we],xe=B[J];if(Hf(j,G,pe,xe))return 0;f=Math.min(f,g0(j,G,pe,xe,o))}}return f}function zb(i,r,o,h,m,v){if(!v)return;const f=m0(Ly(h,v),m,o);f<r&&i.push([f,v,[0,0]])}function Yd(i,r,o,h,m,v,f){if(!v||!f)return;const l=m0(Ly(h,v),Ly(m,f),o);l<r&&i.push([l,v,f])}function xf(i,r,o,h,m=1/0){let v=Math.min(h.distance(i[0],o[0][0]),m);if(v===0)return v;const f=new Dw([[0,[0,i.length-1],[0,0]]],Fw),l=Dy(o);for(;f.length>0;){const C=f.pop();if(C[0]>=v)continue;const M=C[1],R=r?zy:Iy;if(bf(M)<=R){if(!Uo(M,i.length))return NaN;if(r){const j=NM(i,M,o,h);if(isNaN(j)||j===0)return j;v=Math.min(v,j)}else for(let j=M[0];j<=M[1];++j){const G=$M(i[j],o,h);if(v=Math.min(v,G),v===0)return 0}}else{const j=Ry(M,r);zb(f,v,h,i,l,j[0]),zb(f,v,h,i,l,j[1])}}return v}function wf(i,r,o,h,m,v=1/0){let f=Math.min(v,m.distance(i[0],o[0]));if(f===0)return f;const l=new Dw([[0,[0,i.length-1],[0,o.length-1]]],Fw);for(;l.length>0;){const C=l.pop();if(C[0]>=f)continue;const M=C[1],R=C[2],j=r?zy:Iy,G=h?zy:Iy;if(bf(M)<=j&&bf(R)<=G){if(!Uo(M,i.length)&&Uo(R,o.length))return NaN;let B;if(r&&h)B=OM(i,M,o,R,m),f=Math.min(f,B);else if(r&&!h){const J=i.slice(M[0],M[1]+1);for(let le=R[0];le<=R[1];++le)if(B=Cl(o[le],J,m),f=Math.min(f,B),f===0)return f}else if(!r&&h){const J=o.slice(R[0],R[1]+1);for(let le=M[0];le<=M[1];++le)if(B=Cl(i[le],J,m),f=Math.min(f,B),f===0)return f}else B=BM(i,M,o,R,m),f=Math.min(f,B)}else{const B=Ry(M,r),J=Ry(R,h);Yd(l,f,m,i,o,B[0],J[0]),Yd(l,f,m,i,o,B[0],J[1]),Yd(l,f,m,i,o,B[1],J[0]),Yd(l,f,m,i,o,B[1],J[1])}}return f}function VM(i,r){const o=i.geometry(),h=o.flat().map(f=>p0([f.x,f.y],i.canonical));if(o.length===0)return NaN;const m=new f0(h[0][1]);let v=1/0;for(const f of r){switch(f.type){case"Point":v=Math.min(v,wf(h,!1,[f.coordinates],!1,m,v));break;case"LineString":v=Math.min(v,wf(h,!1,f.coordinates,!0,m,v));break;case"Polygon":v=Math.min(v,xf(h,!1,f.coordinates,m,v));break}if(v===0)return v}return v}function qM(i,r){const o=i.geometry(),h=o.flat().map(f=>p0([f.x,f.y],i.canonical));if(o.length===0)return NaN;const m=new f0(h[0][1]);let v=1/0;for(const f of r){switch(f.type){case"Point":v=Math.min(v,wf(h,!0,[f.coordinates],!1,m,v));break;case"LineString":v=Math.min(v,wf(h,!0,f.coordinates,!0,m,v));break;case"Polygon":v=Math.min(v,xf(h,!0,f.coordinates,m,v));break}if(v===0)return v}return v}function GM(i,r){const o=i.geometry();if(o.length===0||o[0].length===0)return NaN;const h=DM(o).map(f=>f.map(l=>l.map(C=>p0([C.x,C.y],i.canonical)))),m=new f0(h[0][0][0][1]);let v=1/0;for(const f of r)for(const l of h){switch(f.type){case"Point":v=Math.min(v,xf([f.coordinates],!1,l,m,v));break;case"LineString":v=Math.min(v,xf(f.coordinates,!0,l,m,v));break;case"Polygon":v=Math.min(v,UM(l,f.coordinates,m,v));break}if(v===0)return v}return v}function Lg(i){return i.type==="MultiPolygon"?i.coordinates.map(r=>({type:"Polygon",coordinates:r})):i.type==="MultiLineString"?i.coordinates.map(r=>({type:"LineString",coordinates:r})):i.type==="MultiPoint"?i.coordinates.map(r=>({type:"Point",coordinates:r})):[i]}let y0=class af{constructor(r,o){this.type=Xe,this.geojson=r,this.geometries=o}static parse(r,o){if(r.length!==2)return o.error(`'distance' expression requires exactly one argument, but found ${r.length-1} instead.`);if(dp(r[1])){const h=r[1];if(h.type==="FeatureCollection")return new af(h,h.features.map(m=>Lg(m.geometry)).flat());if(h.type==="Feature")return new af(h,Lg(h.geometry));if("type"in h&&"coordinates"in h)return new af(h,Lg(h))}return o.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return VM(r,this.geometries);if(r.geometryType()==="LineString")return qM(r,this.geometries);if(r.geometryType()==="Polygon")return GM(r,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}},_0=class jw{constructor(r){this.type=Ft,this.key=r}static parse(r,o){if(r.length!==2)return o.error(`Expected 1 argument, but found ${r.length-1} instead.`);const h=r[1];return h==null?o.error("Global state property must be defined."):typeof h!="string"?o.error(`Global state property must be string, but found ${typeof r[1]} instead.`):new jw(h)}evaluate(r){var o;const h=(o=r.globals)===null||o===void 0?void 0:o.globalState;return!h||Object.keys(h).length===0?null:tp(h,this.key)}eachChild(){}outputDefined(){return!1}};const v0={"==":hM,"!=":pM,">":fM,"<":dM,">=":gM,"<=":mM,array:Lo,at:qP,boolean:Lo,case:HP,coalesce:Tw,collator:Cw,format:_M,image:vM,in:GP,"index-of":ZP,interpolate:Rl,"interpolate-hcl":Rl,"interpolate-lab":Rl,length:bM,let:pw,literal:vf,match:WP,number:Lo,"number-format":yM,object:Lo,slice:XP,step:xw,string:Lo,"to-boolean":au,"to-color":au,"to-number":au,"to-string":au,var:fw,within:Ll,distance:y0,"global-state":_0};class ka{constructor(r,o,h,m){this.name=r,this.type=o,this._evaluate=h,this.args=m}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}static parse(r,o){const h=r[0],m=ka.definitions[h];if(!m)return o.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(m)?m[0]:m.type,f=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,l=f.filter(([M])=>!Array.isArray(M)||M.length===r.length-1);let C=null;for(const[M,R]of l){C=new uw(o.registry,Tf,o.path,null,o.scope);const j=[];let G=!1;for(let B=1;B<r.length;B++){const J=r[B],le=Array.isArray(M)?M[B-1]:M.type,we=C.parse(J,1+j.length,le);if(!we){G=!0;break}j.push(we)}if(!G){if(Array.isArray(M)&&M.length!==j.length){C.error(`Expected ${M.length} arguments, but found ${j.length} instead.`);continue}for(let B=0;B<j.length;B++){const J=Array.isArray(M)?M[B]:M.type,le=j[B];C.concat(B+1).checkSubtype(J,le.type)}if(C.errors.length===0)return new ka(h,v,R,j)}}if(l.length===1)o.errors.push(...C.errors);else{const M=(l.length?l:f).map(([j])=>WM(j)).join(" | "),R=[];for(let j=1;j<r.length;j++){const G=o.parse(r[j],1+R.length);if(!G)return null;R.push(zr(G.type))}o.error(`Expected arguments of type ${M}, but found (${R.join(", ")}) instead.`)}return null}static register(r,o){ka.definitions=o;for(const h in o)r[h]=ka}}function Rb(i,[r,o,h,m]){r=r.evaluate(i),o=o.evaluate(i),h=h.evaluate(i);const v=m?m.evaluate(i):1,f=aw(r,o,h,v);if(f)throw new Or(f);return new pr(r/255,o/255,h/255,v,!1)}function Lb(i,r){return i in r}function Dg(i,r){const o=r[i];return typeof o>"u"?null:o}function ZM(i,r,o,h){for(;o<=h;){const m=o+h>>1;if(r[m]===i)return!0;r[m]>i?h=m-1:o=m+1}return!1}function ml(i){return{type:i}}ka.register(v0,{error:[EP,[qt],(i,[r])=>{throw new Or(r.evaluate(i))}],typeof:[qt,[Ft],(i,[r])=>zr(ui(r.evaluate(i)))],"to-rgba":[$n(Xe,4),[ro],(i,[r])=>{const[o,h,m,v]=r.evaluate(i).rgb;return[o*255,h*255,m*255,v]}],rgb:[ro,[Xe,Xe,Xe],Rb],rgba:[ro,[Xe,Xe,Xe,Xe],Rb],has:{type:Bt,overloads:[[[qt],(i,[r])=>Lb(r.evaluate(i),i.properties())],[[qt,El],(i,[r,o])=>Lb(r.evaluate(i),o.evaluate(i))]]},get:{type:Ft,overloads:[[[qt],(i,[r])=>Dg(r.evaluate(i),i.properties())],[[qt,El],(i,[r,o])=>Dg(r.evaluate(i),o.evaluate(i))]]},"feature-state":[Ft,[qt],(i,[r])=>Dg(r.evaluate(i),i.featureState||{})],properties:[El,[],i=>i.properties()],"geometry-type":[qt,[],i=>i.geometryType()],id:[Ft,[],i=>i.id()],zoom:[Xe,[],i=>i.globals.zoom],"heatmap-density":[Xe,[],i=>i.globals.heatmapDensity||0],elevation:[Xe,[],i=>i.globals.elevation||0],"line-progress":[Xe,[],i=>i.globals.lineProgress||0],accumulated:[Ft,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Xe,ml(Xe),(i,r)=>{let o=0;for(const h of r)o+=h.evaluate(i);return o}],"*":[Xe,ml(Xe),(i,r)=>{let o=1;for(const h of r)o*=h.evaluate(i);return o}],"-":{type:Xe,overloads:[[[Xe,Xe],(i,[r,o])=>r.evaluate(i)-o.evaluate(i)],[[Xe],(i,[r])=>-r.evaluate(i)]]},"/":[Xe,[Xe,Xe],(i,[r,o])=>r.evaluate(i)/o.evaluate(i)],"%":[Xe,[Xe,Xe],(i,[r,o])=>r.evaluate(i)%o.evaluate(i)],ln2:[Xe,[],()=>Math.LN2],pi:[Xe,[],()=>Math.PI],e:[Xe,[],()=>Math.E],"^":[Xe,[Xe,Xe],(i,[r,o])=>Math.pow(r.evaluate(i),o.evaluate(i))],sqrt:[Xe,[Xe],(i,[r])=>Math.sqrt(r.evaluate(i))],log10:[Xe,[Xe],(i,[r])=>Math.log(r.evaluate(i))/Math.LN10],ln:[Xe,[Xe],(i,[r])=>Math.log(r.evaluate(i))],log2:[Xe,[Xe],(i,[r])=>Math.log(r.evaluate(i))/Math.LN2],sin:[Xe,[Xe],(i,[r])=>Math.sin(r.evaluate(i))],cos:[Xe,[Xe],(i,[r])=>Math.cos(r.evaluate(i))],tan:[Xe,[Xe],(i,[r])=>Math.tan(r.evaluate(i))],asin:[Xe,[Xe],(i,[r])=>Math.asin(r.evaluate(i))],acos:[Xe,[Xe],(i,[r])=>Math.acos(r.evaluate(i))],atan:[Xe,[Xe],(i,[r])=>Math.atan(r.evaluate(i))],min:[Xe,ml(Xe),(i,r)=>Math.min(...r.map(o=>o.evaluate(i)))],max:[Xe,ml(Xe),(i,r)=>Math.max(...r.map(o=>o.evaluate(i)))],abs:[Xe,[Xe],(i,[r])=>Math.abs(r.evaluate(i))],round:[Xe,[Xe],(i,[r])=>{const o=r.evaluate(i);return o<0?-Math.round(-o):Math.round(o)}],floor:[Xe,[Xe],(i,[r])=>Math.floor(r.evaluate(i))],ceil:[Xe,[Xe],(i,[r])=>Math.ceil(r.evaluate(i))],"filter-==":[Bt,[qt,Ft],(i,[r,o])=>i.properties()[r.value]===o.value],"filter-id-==":[Bt,[Ft],(i,[r])=>i.id()===r.value],"filter-type-==":[Bt,[qt],(i,[r])=>i.geometryType()===r.value],"filter-<":[Bt,[qt,Ft],(i,[r,o])=>{const h=i.properties()[r.value],m=o.value;return typeof h==typeof m&&h<m}],"filter-id-<":[Bt,[Ft],(i,[r])=>{const o=i.id(),h=r.value;return typeof o==typeof h&&o<h}],"filter->":[Bt,[qt,Ft],(i,[r,o])=>{const h=i.properties()[r.value],m=o.value;return typeof h==typeof m&&h>m}],"filter-id->":[Bt,[Ft],(i,[r])=>{const o=i.id(),h=r.value;return typeof o==typeof h&&o>h}],"filter-<=":[Bt,[qt,Ft],(i,[r,o])=>{const h=i.properties()[r.value],m=o.value;return typeof h==typeof m&&h<=m}],"filter-id-<=":[Bt,[Ft],(i,[r])=>{const o=i.id(),h=r.value;return typeof o==typeof h&&o<=h}],"filter->=":[Bt,[qt,Ft],(i,[r,o])=>{const h=i.properties()[r.value],m=o.value;return typeof h==typeof m&&h>=m}],"filter-id->=":[Bt,[Ft],(i,[r])=>{const o=i.id(),h=r.value;return typeof o==typeof h&&o>=h}],"filter-has":[Bt,[Ft],(i,[r])=>r.value in i.properties()],"filter-has-id":[Bt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Bt,[$n(qt)],(i,[r])=>r.value.indexOf(i.geometryType())>=0],"filter-id-in":[Bt,[$n(Ft)],(i,[r])=>r.value.indexOf(i.id())>=0],"filter-in-small":[Bt,[qt,$n(Ft)],(i,[r,o])=>o.value.indexOf(i.properties()[r.value])>=0],"filter-in-large":[Bt,[qt,$n(Ft)],(i,[r,o])=>ZM(i.properties()[r.value],o.value,0,o.value.length-1)],all:{type:Bt,overloads:[[[Bt,Bt],(i,[r,o])=>r.evaluate(i)&&o.evaluate(i)],[ml(Bt),(i,r)=>{for(const o of r)if(!o.evaluate(i))return!1;return!0}]]},any:{type:Bt,overloads:[[[Bt,Bt],(i,[r,o])=>r.evaluate(i)||o.evaluate(i)],[ml(Bt),(i,r)=>{for(const o of r)if(o.evaluate(i))return!0;return!1}]]},"!":[Bt,[Bt],(i,[r])=>!r.evaluate(i)],"is-supported-script":[Bt,[qt],(i,[r])=>{const o=i.globals&&i.globals.isSupportedScript;return o?o(r.evaluate(i)):!0}],upcase:[qt,[qt],(i,[r])=>r.evaluate(i).toUpperCase()],downcase:[qt,[qt],(i,[r])=>r.evaluate(i).toLowerCase()],concat:[qt,ml(Ft),(i,r)=>r.map(o=>rp(o.evaluate(i))).join("")],"resolved-locale":[qt,[Vf],(i,[r])=>r.evaluate(i).resolvedLocale()]});function WM(i){return Array.isArray(i)?`(${i.map(zr).join(", ")})`:`(${zr(i.type)}...)`}function Tf(i){if(i instanceof fw)return Tf(i.boundExpression);if(i instanceof ka&&i.name==="error"||i instanceof Cw||i instanceof Ll||i instanceof y0||i instanceof _0)return!1;const r=i instanceof au||i instanceof Lo;let o=!0;return i.eachChild(h=>{r?o=o&&Tf(h):o=o&&h instanceof vf}),o?Xf(i)&&Kf(i,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"]):!1}function Xf(i){if(i instanceof ka&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Ll||i instanceof y0)return!1;let r=!0;return i.eachChild(o=>{r&&!Xf(o)&&(r=!1)}),r}function mp(i){if(i instanceof ka&&i.name==="feature-state")return!1;let r=!0;return i.eachChild(o=>{r&&!mp(o)&&(r=!1)}),r}function Kf(i,r){if(i instanceof ka&&r.indexOf(i.name)>=0)return!1;let o=!0;return i.eachChild(h=>{o&&!Kf(h,r)&&(o=!1)}),o}function Fy(i){return{result:"success",value:i}}function tu(i){return{result:"error",value:i}}function Sf(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Ow(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Bw(i){return!!i.expression&&i.expression.interpolated}function Ht(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function b0(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)&&ui(i)===El}class HM{constructor(r,o){this.expression=r,this._warningHistory={},this._evaluator=new cw,this._defaultValue=o?YM(o):null,this._enumValues=o&&o.type==="enum"?o.values:null}evaluateWithoutErrorHandling(r,o,h,m,v,f){return this._evaluator.globals=r,this._evaluator.feature=o,this._evaluator.featureState=h,this._evaluator.canonical=m,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=f,this.expression.evaluate(this._evaluator)}evaluate(r,o,h,m,v,f){this._evaluator.globals=r,this._evaluator.feature=o||null,this._evaluator.featureState=h||null,this._evaluator.canonical=m,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=f||null;try{const l=this.expression.evaluate(this._evaluator);if(l==null||typeof l=="number"&&l!==l)return this._defaultValue;if(this._enumValues&&!(l in this._enumValues))throw new Or(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(l)} instead.`);return l}catch(l){return this._warningHistory[l.message]||(this._warningHistory[l.message]=!0,typeof console<"u"&&console.warn(l.message)),this._defaultValue}}}function $w(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in v0}function Nw(i,r){const o=new uw(v0,Tf,[],r?KM(r):void 0),h=o.parse(i,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Fy(new HM(h,r)):tu(o.errors)}let Db=class{constructor(r,o){this.kind=r,this._styleExpression=o,this.isStateDependent=r!=="constant"&&!mp(o.expression),this.globalStateRefs=x0(o.expression)}evaluateWithoutErrorHandling(r,o,h,m,v,f){return this._styleExpression.evaluateWithoutErrorHandling(r,o,h,m,v,f)}evaluate(r,o,h,m,v,f){return this._styleExpression.evaluate(r,o,h,m,v,f)}},Fb=class{constructor(r,o,h,m){this.kind=r,this.zoomStops=h,this._styleExpression=o,this.isStateDependent=r!=="camera"&&!mp(o.expression),this.globalStateRefs=x0(o.expression),this.interpolationType=m}evaluateWithoutErrorHandling(r,o,h,m,v,f){return this._styleExpression.evaluateWithoutErrorHandling(r,o,h,m,v,f)}evaluate(r,o,h,m,v,f){return this._styleExpression.evaluate(r,o,h,m,v,f)}interpolationFactor(r,o,h){return this.interpolationType?Rl.interpolationFactor(this.interpolationType,r,o,h):0}};function XM(i,r){const o=Nw(i,r);if(o.result==="error")return o;const h=o.value.expression,m=Xf(h);if(!m&&!Sf(r))return tu([new eo("","data expressions not supported")]);const v=Kf(h,["zoom"]);if(!v&&!Ow(r))return tu([new eo("","zoom expressions not supported")]);const f=of(h);if(!f&&!v)return tu([new eo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(f instanceof eo)return tu([f]);if(f instanceof Rl&&!Bw(r))return tu([new eo("",'"interpolate" expressions cannot be used with this property')]);if(!f)return Fy(m?new Db("constant",o.value):new Db("source",o.value));const l=f instanceof Rl?f.interpolation:void 0;return Fy(m?new Fb("camera",o.value,f.labels,l):new Fb("composite",o.value,f.labels,l))}function of(i){let r=null;if(i instanceof pw)r=of(i.result);else if(i instanceof Tw){for(const o of i.args)if(r=of(o),r)break}else(i instanceof xw||i instanceof Rl)&&i.input instanceof ka&&i.input.name==="zoom"&&(r=i);return r instanceof eo||i.eachChild(o=>{const h=of(o);h instanceof eo?r=h:!r&&h?r=new eo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&h&&r!==h&&(r=new eo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}function x0(i,r=new Set){return i instanceof _0&&r.add(i.key),i.eachChild(o=>{x0(o,r)}),r}function KM(i){const r={color:ro,string:qt,number:Xe,enum:qt,boolean:Bt,formatted:qf,padding:Gf,numberArray:Zf,colorArray:up,projectionDefinition:Uf,resolvedImage:Ap,variableAnchorOffsetCollection:Wf};return i.type==="array"?$n(r[i.value]||Ft,i.length):r[i.type]}function YM(i){if(i.type==="color"&&b0(i.default))return new pr(0,0,0,0);switch(i.type){case"color":return pr.parse(i.default)||null;case"padding":return Ta.parse(i.default)||null;case"numberArray":return Sa.parse(i.default)||null;case"colorArray":return Is.parse(i.default)||null;case"variableAnchorOffsetCollection":return io.parse(i.default)||null;case"projectionDefinition":return Ep.parse(i.default)||null;default:return i.default===void 0?null:i.default}}function Uw(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const r of i.slice(1))if(!Uw(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}function Vw(i){const r=i.key,o=i.value;return o?[new Ve(r,o,"constants have been deprecated as of v8")]:[]}function Wr(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Bl(i){if(Array.isArray(i))return i.map(Bl);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const r={};for(const o in i)r[o]=Bl(i[o]);return r}return Wr(i)}function ia(i){const r=i.key,o=i.value,h=i.valueSpec||{},m=i.objectElementValidators||{},v=i.style,f=i.styleSpec,l=i.validateSpec;let C=[];const M=Ht(o);if(M!=="object")return[new Ve(r,o,`object expected, ${M} found`)];for(const R in o){const j=R.split(".")[0],G=tp(h,j)||h["*"];let B;if(tp(m,j))B=m[j];else if(tp(h,j))B=l;else if(m["*"])B=m["*"];else if(h["*"])B=l;else{C.push(new Ve(r,o[R],`unknown property "${R}"`));continue}C=C.concat(B({key:(r&&`${r}.`)+R,value:o[R],valueSpec:G,style:v,styleSpec:f,object:o,objectKey:R,validateSpec:l},o))}for(const R in h)m[R]||h[R].required&&h[R].default===void 0&&o[R]===void 0&&C.push(new Ve(r,o,`missing required property "${R}"`));return C}function w0(i){const r=i.value,o=i.valueSpec,h=i.validateSpec,m=i.style,v=i.styleSpec,f=i.key,l=i.arrayElementValidator||h;if(Ht(r)!=="array")return[new Ve(f,r,`array expected, ${Ht(r)} found`)];if(o.length&&r.length!==o.length)return[new Ve(f,r,`array length ${o.length} expected, length ${r.length} found`)];if(o["min-length"]&&r.length<o["min-length"])return[new Ve(f,r,`array length at least ${o["min-length"]} expected, length ${r.length} found`)];let C={type:o.value,values:o.values};v.$version<7&&(C.function=o.function),Ht(o.value)==="object"&&(C=o.value);let M=[];for(let R=0;R<r.length;R++)M=M.concat(l({array:r,arrayIndex:R,value:r[R],valueSpec:C,validateSpec:i.validateSpec,style:m,styleSpec:v,key:`${f}[${R}]`}));return M}function Yf(i){const r=i.key,o=i.value,h=i.valueSpec;let m=Ht(o);return m==="number"&&o!==o&&(m="NaN"),m!=="number"?[new Ve(r,o,`number expected, ${m} found`)]:"minimum"in h&&o<h.minimum?[new Ve(r,o,`${o} is less than the minimum value ${h.minimum}`)]:"maximum"in h&&o>h.maximum?[new Ve(r,o,`${o} is greater than the maximum value ${h.maximum}`)]:[]}function qw(i){const r=i.valueSpec,o=Wr(i.value.type);let h,m={},v,f;const l=o!=="categorical"&&i.value.property===void 0,C=!l,M=Ht(i.value.stops)==="array"&&Ht(i.value.stops[0])==="array"&&Ht(i.value.stops[0][0])==="object",R=ia({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:j,default:J}});return o==="identity"&&l&&R.push(new Ve(i.key,i.value,'missing required property "property"')),o!=="identity"&&!i.value.stops&&R.push(new Ve(i.key,i.value,'missing required property "stops"')),o==="exponential"&&i.valueSpec.expression&&!Bw(i.valueSpec)&&R.push(new Ve(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(C&&!Sf(i.valueSpec)?R.push(new Ve(i.key,i.value,"property functions not supported")):l&&!Ow(i.valueSpec)&&R.push(new Ve(i.key,i.value,"zoom functions not supported"))),(o==="categorical"||M)&&i.value.property===void 0&&R.push(new Ve(i.key,i.value,'"property" property is required')),R;function j(le){if(o==="identity")return[new Ve(le.key,le.value,'identity function may not have a "stops" property')];let we=[];const pe=le.value;return we=we.concat(w0({key:le.key,value:pe,valueSpec:le.valueSpec,validateSpec:le.validateSpec,style:le.style,styleSpec:le.styleSpec,arrayElementValidator:G})),Ht(pe)==="array"&&pe.length===0&&we.push(new Ve(le.key,pe,"array must have at least one stop")),we}function G(le){let we=[];const pe=le.value,xe=le.key;if(Ht(pe)!=="array")return[new Ve(xe,pe,`array expected, ${Ht(pe)} found`)];if(pe.length!==2)return[new Ve(xe,pe,`array length 2 expected, length ${pe.length} found`)];if(M){if(Ht(pe[0])!=="object")return[new Ve(xe,pe,`object expected, ${Ht(pe[0])} found`)];if(pe[0].zoom===void 0)return[new Ve(xe,pe,"object stop key must have zoom")];if(pe[0].value===void 0)return[new Ve(xe,pe,"object stop key must have value")];if(f&&f>Wr(pe[0].zoom))return[new Ve(xe,pe[0].zoom,"stop zoom values must appear in ascending order")];Wr(pe[0].zoom)!==f&&(f=Wr(pe[0].zoom),v=void 0,m={}),we=we.concat(ia({key:`${xe}[0]`,value:pe[0],valueSpec:{zoom:{}},validateSpec:le.validateSpec,style:le.style,styleSpec:le.styleSpec,objectElementValidators:{zoom:Yf,value:B}}))}else we=we.concat(B({key:`${xe}[0]`,value:pe[0],validateSpec:le.validateSpec,style:le.style,styleSpec:le.styleSpec},pe));return $w(Bl(pe[1]))?we.concat([new Ve(`${xe}[1]`,pe[1],"expressions are not allowed in function stops.")]):we.concat(le.validateSpec({key:`${xe}[1]`,value:pe[1],valueSpec:r,validateSpec:le.validateSpec,style:le.style,styleSpec:le.styleSpec}))}function B(le,we){const pe=Ht(le.value),xe=Wr(le.value),de=le.value!==null?le.value:we;if(!h)h=pe;else if(pe!==h)return[new Ve(le.key,de,`${pe} stop domain type must match previous stop domain type ${h}`)];if(pe!=="number"&&pe!=="string"&&pe!=="boolean")return[new Ve(le.key,de,"stop domain value must be a number, string, or boolean")];if(pe!=="number"&&o!=="categorical"){let he=`number expected, ${pe} found`;return Sf(r)&&o===void 0&&(he+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ve(le.key,de,he)]}return o==="categorical"&&pe==="number"&&(!isFinite(xe)||Math.floor(xe)!==xe)?[new Ve(le.key,de,`integer expected, found ${xe}`)]:o!=="categorical"&&pe==="number"&&v!==void 0&&xe<v?[new Ve(le.key,de,"stop domain values must appear in ascending order")]:(v=xe,o==="categorical"&&xe in m?[new Ve(le.key,de,"stop domain values must be unique")]:(m[xe]=!0,[]))}function J(le){return le.validateSpec({key:le.key,value:le.value,valueSpec:r,validateSpec:le.validateSpec,style:le.style,styleSpec:le.styleSpec})}}function bu(i){const r=(i.expressionContext==="property"?XM:Nw)(Bl(i.value),i.valueSpec);if(r.result==="error")return r.value.map(h=>new Ve(`${i.key}${h.key}`,i.value,h.message));const o=r.value.expression||r.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!o.outputDefined())return[new Ve(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!mp(o))return[new Ve(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!mp(o))return[new Ve(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Kf(o,["zoom","feature-state"]))return[new Ve(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Xf(o))return[new Ve(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function JM(i){const r=i.value,o=i.key,h=Ht(r);return h!=="boolean"?[new Ve(o,r,`boolean expected, ${h} found`)]:[]}function jy(i){const r=i.key,o=i.value,h=Ht(o);return h!=="string"?[new Ve(r,o,`color expected, ${h} found`)]:pr.parse(String(o))?[]:[new Ve(r,o,`color expected, "${o}" found`)]}function gp(i){const r=i.key,o=i.value,h=i.valueSpec,m=[];return Array.isArray(h.values)?h.values.indexOf(Wr(o))===-1&&m.push(new Ve(r,o,`expected one of [${h.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(h.values).indexOf(Wr(o))===-1&&m.push(new Ve(r,o,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(o)} found`)),m}function T0(i){return Uw(Bl(i.value))?bu(_f({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Gw(i)}function Gw(i){const r=i.value,o=i.key;if(Ht(r)!=="array")return[new Ve(o,r,`array expected, ${Ht(r)} found`)];const h=i.styleSpec;let m,v=[];if(r.length<1)return[new Ve(o,r,"filter array must have at least 1 element")];switch(v=v.concat(gp({key:`${o}[0]`,value:r[0],valueSpec:h.filter_operator,style:i.style,styleSpec:i.styleSpec})),Wr(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&Wr(r[1])==="$type"&&v.push(new Ve(o,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&v.push(new Ve(o,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(m=Ht(r[1]),m!=="string"&&v.push(new Ve(`${o}[1]`,r[1],`string expected, ${m} found`)));for(let f=2;f<r.length;f++)m=Ht(r[f]),Wr(r[1])==="$type"?v=v.concat(gp({key:`${o}[${f}]`,value:r[f],valueSpec:h.geometry_type,style:i.style,styleSpec:i.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&v.push(new Ve(`${o}[${f}]`,r[f],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let f=1;f<r.length;f++)v=v.concat(Gw({key:`${o}[${f}]`,value:r[f],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":m=Ht(r[1]),r.length!==2?v.push(new Ve(o,r,`filter array for "${r[0]}" operator must have 2 elements`)):m!=="string"&&v.push(new Ve(`${o}[1]`,r[1],`string expected, ${m} found`));break}return v}function Zw(i,r){const o=i.key,h=i.validateSpec,m=i.style,v=i.styleSpec,f=i.value,l=i.objectKey,C=v[`${r}_${i.layerType}`];if(!C)return[];const M=l.match(/^(.*)-transition$/);if(r==="paint"&&M&&C[M[1]]&&C[M[1]].transition)return h({key:o,value:f,valueSpec:v.transition,style:m,styleSpec:v});const R=i.valueSpec||C[l];if(!R)return[new Ve(o,f,`unknown property "${l}"`)];let j;if(Ht(f)==="string"&&Sf(R)&&!R.tokens&&(j=/^{([^}]+)}$/.exec(f)))return[new Ve(o,f,`"${l}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(j[1])} }\`.`)];const G=[];return i.layerType==="symbol"&&(l==="text-field"&&m&&!m.glyphs&&G.push(new Ve(o,f,'use of "text-field" requires a style "glyphs" property')),l==="text-font"&&b0(Bl(f))&&Wr(f.type)==="identity"&&G.push(new Ve(o,f,'"text-font" does not support identity functions'))),G.concat(h({key:i.key,value:f,valueSpec:R,style:m,styleSpec:v,expressionContext:"property",propertyType:r,propertyKey:l}))}function Ww(i){return Zw(i,"paint")}function Hw(i){return Zw(i,"layout")}function Xw(i){let r=[];const o=i.value,h=i.key,m=i.style,v=i.styleSpec;if(Ht(o)!=="object")return[new Ve(h,o,`object expected, ${Ht(o)} found`)];!o.type&&!o.ref&&r.push(new Ve(h,o,'either "type" or "ref" is required'));let f=Wr(o.type);const l=Wr(o.ref);if(o.id){const C=Wr(o.id);for(let M=0;M<i.arrayIndex;M++){const R=m.layers[M];Wr(R.id)===C&&r.push(new Ve(h,o.id,`duplicate layer id "${o.id}", previously used at line ${R.id.__line__}`))}}if("ref"in o){["type","source","source-layer","filter","layout"].forEach(M=>{M in o&&r.push(new Ve(h,o[M],`"${M}" is prohibited for ref layers`))});let C;m.layers.forEach(M=>{Wr(M.id)===l&&(C=M)}),C?C.ref?r.push(new Ve(h,o.ref,"ref cannot reference another ref layer")):f=Wr(C.type):r.push(new Ve(h,o.ref,`ref layer "${l}" not found`))}else if(f!=="background")if(!o.source)r.push(new Ve(h,o,'missing required property "source"'));else{const C=m.sources&&m.sources[o.source],M=C&&Wr(C.type);C?M==="vector"&&f==="raster"?r.push(new Ve(h,o.source,`layer "${o.id}" requires a raster source`)):M!=="raster-dem"&&f==="hillshade"?r.push(new Ve(h,o.source,`layer "${o.id}" requires a raster-dem source`)):M!=="raster-dem"&&f==="color-relief"?r.push(new Ve(h,o.source,`layer "${o.id}" requires a raster-dem source`)):M==="raster"&&f!=="raster"?r.push(new Ve(h,o.source,`layer "${o.id}" requires a vector source`)):M==="vector"&&!o["source-layer"]?r.push(new Ve(h,o,`layer "${o.id}" must specify a "source-layer"`)):M==="raster-dem"&&f!=="hillshade"&&f!=="color-relief"?r.push(new Ve(h,o.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):f==="line"&&o.paint&&o.paint["line-gradient"]&&(M!=="geojson"||!C.lineMetrics)&&r.push(new Ve(h,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new Ve(h,o.source,`source "${o.source}" not found`))}return r=r.concat(ia({key:h,value:o,valueSpec:v.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*"(){return[]},type(){return i.validateSpec({key:`${h}.type`,value:o.type,valueSpec:v.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:o,objectKey:"type"})},filter:T0,layout(C){return ia({layer:o,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*"(M){return Hw(_f({layerType:f},M))}}})},paint(C){return ia({layer:o,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*"(M){return Ww(_f({layerType:f},M))}}})}}})),r}function $l(i){const r=i.value,o=i.key,h=Ht(r);return h!=="string"?[new Ve(o,r,`string expected, ${h} found`)]:[]}function QM(i){var r;const o=(r=i.sourceName)!==null&&r!==void 0?r:"",h=i.value,m=i.styleSpec,v=m.source_raster_dem,f=i.style;let l=[];const C=Ht(h);if(h===void 0)return l;if(C!=="object")return l.push(new Ve("source_raster_dem",h,`object expected, ${C} found`)),l;const M=Wr(h.encoding)==="custom",R=["redFactor","greenFactor","blueFactor","baseShift"],j=i.value.encoding?`"${i.value.encoding}"`:"Default";for(const G in h)!M&&R.includes(G)?l.push(new Ve(G,h[G],`In "${o}": "${G}" is only valid when "encoding" is set to "custom". ${j} encoding found`)):v[G]?l=l.concat(i.validateSpec({key:G,value:h[G],valueSpec:v[G],validateSpec:i.validateSpec,style:f,styleSpec:m})):l.push(new Ve(G,h[G],`unknown property "${G}"`));return l}const jb={promoteId:eA};function Kw(i){const r=i.value,o=i.key,h=i.styleSpec,m=i.style,v=i.validateSpec;if(!r.type)return[new Ve(o,r,'"type" is required')];const f=Wr(r.type);let l;switch(f){case"vector":case"raster":return l=ia({key:o,value:r,valueSpec:h[`source_${f.replace("-","_")}`],style:i.style,styleSpec:h,objectElementValidators:jb,validateSpec:v}),l;case"raster-dem":return l=QM({sourceName:o,value:r,style:i.style,styleSpec:h,validateSpec:v}),l;case"geojson":if(l=ia({key:o,value:r,valueSpec:h.source_geojson,style:m,styleSpec:h,validateSpec:v,objectElementValidators:jb}),r.cluster)for(const C in r.clusterProperties){const[M,R]=r.clusterProperties[C],j=typeof M=="string"?[M,["accumulated"],["get",C]]:M;l.push(...bu({key:`${o}.${C}.map`,value:R,expressionContext:"cluster-map"})),l.push(...bu({key:`${o}.${C}.reduce`,value:j,expressionContext:"cluster-reduce"}))}return l;case"video":return ia({key:o,value:r,valueSpec:h.source_video,style:m,validateSpec:v,styleSpec:h});case"image":return ia({key:o,value:r,valueSpec:h.source_image,style:m,validateSpec:v,styleSpec:h});case"canvas":return[new Ve(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return gp({key:`${o}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function eA({key:i,value:r}){if(Ht(r)==="string")return $l({key:i,value:r});{const o=[];for(const h in r)o.push(...$l({key:`${i}.${h}`,value:r[h]}));return o}}function Yw(i){const r=i.value,o=i.styleSpec,h=o.light,m=i.style;let v=[];const f=Ht(r);if(r===void 0)return v;if(f!=="object")return v=v.concat([new Ve("light",r,`object expected, ${f} found`)]),v;for(const l in r){const C=l.match(/^(.*)-transition$/);C&&h[C[1]]&&h[C[1]].transition?v=v.concat(i.validateSpec({key:l,value:r[l],valueSpec:o.transition,validateSpec:i.validateSpec,style:m,styleSpec:o})):h[l]?v=v.concat(i.validateSpec({key:l,value:r[l],valueSpec:h[l],validateSpec:i.validateSpec,style:m,styleSpec:o})):v=v.concat([new Ve(l,r[l],`unknown property "${l}"`)])}return v}function Jw(i){const r=i.value,o=i.styleSpec,h=o.sky,m=i.style,v=Ht(r);if(r===void 0)return[];if(v!=="object")return[new Ve("sky",r,`object expected, ${v} found`)];let f=[];for(const l in r)h[l]?f=f.concat(i.validateSpec({key:l,value:r[l],valueSpec:h[l],style:m,styleSpec:o})):f=f.concat([new Ve(l,r[l],`unknown property "${l}"`)]);return f}function Qw(i){const r=i.value,o=i.styleSpec,h=o.terrain,m=i.style;let v=[];const f=Ht(r);if(r===void 0)return v;if(f!=="object")return v=v.concat([new Ve("terrain",r,`object expected, ${f} found`)]),v;for(const l in r)h[l]?v=v.concat(i.validateSpec({key:l,value:r[l],valueSpec:h[l],validateSpec:i.validateSpec,style:m,styleSpec:o})):v=v.concat([new Ve(l,r[l],`unknown property "${l}"`)]);return v}function tA(i){return $l(i).length===0?[]:bu(i)}function rA(i){return $l(i).length===0?[]:bu(i)}function iA(i){const r=i.key,o=i.value;if(Ht(o)==="array"){if(o.length<1||o.length>4)return[new Ve(r,o,`padding requires 1 to 4 values; ${o.length} values found`)];const h={type:"number"};let m=[];for(let v=0;v<o.length;v++)m=m.concat(i.validateSpec({key:`${r}[${v}]`,value:o[v],validateSpec:i.validateSpec,valueSpec:h}));return m}else return Yf({key:r,value:o,valueSpec:{}})}function nA(i){const r=i.key,o=i.value;if(Ht(o)==="array"){const h={type:"number"};if(o.length<1)return[new Ve(r,o,"array length at least 1 expected, length 0 found")];let m=[];for(let v=0;v<o.length;v++)m=m.concat(i.validateSpec({key:`${r}[${v}]`,value:o[v],validateSpec:i.validateSpec,valueSpec:h}));return m}else return Yf({key:r,value:o,valueSpec:{}})}function aA(i){const r=i.key,o=i.value;if(Ht(o)==="array"){if(o.length<1)return[new Ve(r,o,"array length at least 1 expected, length 0 found")];let h=[];for(let m=0;m<o.length;m++)h=h.concat(jy({key:`${r}[${m}]`,value:o[m]}));return h}else return jy({key:r,value:o})}function oA(i){const r=i.key,o=i.value,h=Ht(o),m=i.styleSpec;if(h!=="array"||o.length<1||o.length%2!==0)return[new Ve(r,o,"variableAnchorOffsetCollection requires a non-empty array of even length")];let v=[];for(let f=0;f<o.length;f+=2)v=v.concat(gp({key:`${r}[${f}]`,value:o[f],valueSpec:m.layout_symbol["text-anchor"]})),v=v.concat(w0({key:`${r}[${f+1}]`,value:o[f+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:m}));return v}function e2(i){let r=[];const o=i.value,h=i.key;if(Array.isArray(o)){const m=[],v=[];for(const f in o){o[f].id&&m.includes(o[f].id)&&r.push(new Ve(h,o,`all the sprites' ids must be unique, but ${o[f].id} is duplicated`)),m.push(o[f].id),o[f].url&&v.includes(o[f].url)&&r.push(new Ve(h,o,`all the sprites' URLs must be unique, but ${o[f].url} is duplicated`)),v.push(o[f].url);const l={id:{type:"string",required:!0},url:{type:"string",required:!0}};r=r.concat(ia({key:`${h}[${f}]`,value:o[f],valueSpec:l,validateSpec:i.validateSpec}))}return r}else return $l({key:h,value:o})}function sA(i){const r=i.value,o=i.styleSpec,h=o.projection,m=i.style,v=Ht(r);if(r===void 0)return[];if(v!=="object")return[new Ve("projection",r,`object expected, ${v} found`)];let f=[];for(const l in r)h[l]?f=f.concat(i.validateSpec({key:l,value:r[l],valueSpec:h[l],style:m,styleSpec:o})):f=f.concat([new Ve(l,r[l],`unknown property "${l}"`)]);return f}function lA(i){const r=i.key;let o=i.value;o=o instanceof String?o.valueOf():o;const h=Ht(o);return h==="array"&&!uA(o)&&!cA(o)?[new Ve(r,o,`projection expected, invalid array ${JSON.stringify(o)} found`)]:["array","string"].includes(h)?[]:[new Ve(r,o,`projection expected, invalid type "${h}" found`)]}function cA(i){return!!["interpolate","step","literal"].includes(i[0])}function uA(i){return Array.isArray(i)&&i.length===3&&typeof i[0]=="string"&&typeof i[1]=="string"&&typeof i[2]=="number"}function hA(i){return!!i&&i.constructor===Object}function t2(i){return hA(i.value)?[]:[new Ve(i.key,i.value,`object expected, ${Ht(i.value)} found`)]}const Ob={"*"(){return[]},array:w0,boolean:JM,number:Yf,color:jy,constants:Vw,enum:gp,filter:T0,function:qw,layer:Xw,object:ia,source:Kw,light:Yw,sky:Jw,terrain:Qw,projection:sA,projectionDefinition:lA,string:$l,formatted:tA,resolvedImage:rA,padding:iA,numberArray:nA,colorArray:aA,variableAnchorOffsetCollection:oA,sprite:e2,state:t2};function kf(i){const r=i.value,o=i.valueSpec,h=i.styleSpec;return i.validateSpec=kf,o.expression&&b0(Wr(r))?qw(i):o.expression&&$w(Bl(r))?bu(i):o.type&&Ob[o.type]?Ob[o.type](i):ia(_f({},i,{valueSpec:o.type?h[o.type]:o}))}function r2(i){const r=i.value,o=i.key,h=$l(i);return h.length||(r.indexOf("{fontstack}")===-1&&h.push(new Ve(o,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&h.push(new Ve(o,r,'"glyphs" url must include a "{range}" token'))),h}function Vn(i,r=MP){let o=[];return o=o.concat(kf({key:"",value:i,valueSpec:r.$root,styleSpec:r,style:i,validateSpec:kf,objectElementValidators:{glyphs:r2,"*"(){return[]}}})),i.constants&&(o=o.concat(Vw({key:"constants",value:i.constants}))),i2(o)}Vn.source=Ea(Aa(Kw));Vn.sprite=Ea(Aa(e2));Vn.glyphs=Ea(Aa(r2));Vn.light=Ea(Aa(Yw));Vn.sky=Ea(Aa(Jw));Vn.terrain=Ea(Aa(Qw));Vn.state=Ea(Aa(t2));Vn.layer=Ea(Aa(Xw));Vn.filter=Ea(Aa(T0));Vn.paintProperty=Ea(Aa(Ww));Vn.layoutProperty=Ea(Aa(Hw));function Aa(i){return function(r){return i({...r,validateSpec:kf})}}function i2(i){return[].concat(i).sort((r,o)=>r.line-o.line)}function Ea(i){return function(...r){return i2(i.apply(this,r))}}function Bb(i){if(!i)return{style:ep[Qh[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0};if(typeof i=="string"){const r=dA(i);return r.isValidStyle?{style:r.styleObject,requiresUrlMonitoring:!1,isFallback:!1}:r.isValidJSON?{style:ep[Qh[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}:i.startsWith("http")?{style:i,requiresUrlMonitoring:!0,isFallback:!1}:i.toLowerCase().includes(".json")?{style:pA(i),requiresUrlMonitoring:!0,isFallback:!1}:{style:zx(i),requiresUrlMonitoring:!0,isFallback:!1}}return i instanceof Rx?{style:i.getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:i instanceof Lx?{style:i.getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:Vn(i).length===0?{style:i,requiresUrlMonitoring:!1,isFallback:!1}:{style:ep[Qh[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}}function pA(i){try{return new URL(i).href}catch{}return new URL(i,location.origin).href}function dA(i){try{const r=JSON.parse(i),o=Vn(r);return{isValidJSON:!0,isValidStyle:o.length===0,styleObject:o.length===0?r:null}}catch{return{isValidJSON:!1,isValidStyle:!1,styleObject:null}}}function Bo(i,r,o){const h=window.document.createElement(i);return r!==void 0&&(h.className=r),o&&o.appendChild(h),h}function yp(i){i.parentNode&&i.parentNode.removeChild(i)}class fA{constructor(){tt(this,"_map"),tt(this,"_container"),tt(this,"_terrainButton"),CC(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(r){return this._map=r,this._container=Bo("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Bo("button","maplibregl-ctrl-terrain",this._container),Bo("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){yp(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){n2(this._map),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.hasTerrain()?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))}}function n2(i){i.hasTerrain()?i.disableTerrain():i.enableTerrain()}class mA extends jC{constructor(r={}){super({showCompass:r.showCompass??!0,showZoom:r.showZoom??!0,visualizePitch:r.visualizePitch??!0}),tt(this,"_rotateCompassArrow",()=>{const o=this._map.getBearing(),h=this._map.getPitch(),m=this.options.visualizePitch?`scale(${Math.min(1.5,1/Math.cos(h*(Math.PI/180))**.5)}) rotateX(${Math.min(70,h)}deg) rotateZ(${-o}deg)`:`rotate(${-o}deg)`;this._compassIcon.style.transform=m}),this._compass&&(this._compass.removeEventListener("click",this._compass.clickFunction),this._compass.addEventListener("click",o=>{this._map.getPitch()===0?this._map.easeTo({pitch:Math.min(this._map.getMaxPitch(),80)}):this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}))}_createButton(r,o){const h=super._createButton(r,o);return h.clickFunction=o,h}}const $b=ht.Marker,Nb=ht.LngLat,gA=ht.LngLatBounds;class yA extends OC{constructor(){super(...arguments),tt(this,"lastUpdatedCenter",new Nb(0,0)),tt(this,"_updateCamera",r=>{var o;const h=new Nb(r.coords.longitude,r.coords.latitude),m=r.coords.accuracy,v={bearing:this._map.getBearing(),...this.options.fitBoundsOptions,linear:!0},f=this._map.getZoom();f>(((o=this.options.fitBoundsOptions)==null?void 0:o.maxZoom)??30)&&(v.zoom=f),this._map.fitBounds(gA.fromLngLat(h,m),v,{geolocateSource:!0});let l=!1;const C=()=>{l=!0};this._map.once("click",C),this._map.once("dblclick",C),this._map.once("dragstart",C),this._map.once("mousedown",C),this._map.once("touchstart",C),this._map.once("wheel",C),this._map.once("moveend",()=>{this._map.off("click",C),this._map.off("dblclick",C),this._map.off("dragstart",C),this._map.off("mousedown",C),this._map.off("touchstart",C),this._map.off("wheel",C),!l&&(this.lastUpdatedCenter=this._map.getCenter())})}),tt(this,"_finishSetupUI",r=>{if(this._map){if(r===!1){const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Bo("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new $b({element:this._dotElement}),this._circleElement=Bo("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new $b({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("move",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("moveend",o=>{const h=o.originalEvent&&o.originalEvent.type==="resize",m=this.lastUpdatedCenter.distanceTo(this._map.getCenter());!o.geolocateSource&&this._watchState==="ACTIVE_LOCK"&&!h&&m>1&&(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new Event("trackuserlocationend")))})}}),tt(this,"_onZoom",()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()})}_updateCircleRadius(){if(this._watchState!=="BACKGROUND"&&this._watchState!=="ACTIVE_LOCK")return;const r=[this._lastKnownPosition.coords.longitude,this._lastKnownPosition.coords.latitude],o=this._map.project(r),h=this._map.unproject([o.x,o.y]),m=this._map.unproject([o.x+20,o.y]),v=h.distanceTo(m)/20,f=Math.ceil(2*this._accuracy/v);this._circleElement.style.width=`${f}px`,this._circleElement.style.height=`${f}px`}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;case"BACKGROUND_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}}var _l,Dn,vl,bl,Gh;class _A{constructor(r,o,h){if(fn(this,_l),fn(this,Dn),fn(this,vl),fn(this,bl),fn(this,Gh),typeof r=="string"){const m=document.querySelector(r);if(!m)throw new Error(`No element has been found with selector "${r}" when creating an external control.`);Bn(this,Dn,m)}else Bn(this,Dn,r);o&&Bn(this,vl,m=>{o(pt(this,_l),pt(this,Dn),m)}),h&&Bn(this,bl,m=>{h(pt(this,_l),pt(this,Dn),m)}),Bn(this,Gh,pt(this,Dn).parentElement)}onAdd(r){return Bn(this,_l,r),pt(this,vl)&&pt(this,Dn).addEventListener("click",pt(this,vl)),pt(this,bl)&&pt(this,_l).on("render",pt(this,bl)),yp(pt(this,Dn)),pt(this,Dn)}onRemove(){pt(this,vl)&&pt(this,Dn).removeEventListener("click",pt(this,vl)),pt(this,bl)&&pt(this,_l).off("render",pt(this,bl)),pt(this,Gh)?pt(this,Gh).appendChild(pt(this,Dn)):yp(pt(this,Dn))}}_l=new WeakMap,Dn=new WeakMap,vl=new WeakMap,bl=new WeakMap,Gh=new WeakMap;class vA{constructor(){tt(this,"map"),tt(this,"container"),tt(this,"projectionButton")}onAdd(r){return this.map=r,this.container=Bo("div","maplibregl-ctrl maplibregl-ctrl-group"),this.projectionButton=Bo("button","maplibregl-ctrl-projection",this.container),Bo("span","maplibregl-ctrl-icon",this.projectionButton).setAttribute("aria-hidden","true"),this.projectionButton.type="button",this.projectionButton.addEventListener("click",this.toggleProjection.bind(this)),r.on("projectiontransition",this.updateProjectionIcon.bind(this)),this.updateProjectionIcon(),this.container}onRemove(){yp(this.container),this.map.off("projectiontransition",this.updateProjectionIcon),this.map=void 0}toggleProjection(){a2(this.map),this.updateProjectionIcon()}updateProjectionIcon(){this.projectionButton.classList.remove("maplibregl-ctrl-projection-globe"),this.projectionButton.classList.remove("maplibregl-ctrl-projection-mercator"),this.map.isGlobeProjection()?(this.projectionButton.classList.add("maplibregl-ctrl-projection-mercator"),this.projectionButton.title="Enable Mercator projection"):(this.projectionButton.classList.add("maplibregl-ctrl-projection-globe"),this.projectionButton.title="Enable Globe projection")}}function a2(i){i.getProjection()===void 0&&i.setProjection({type:"mercator"}),i.isGlobeProjection()?i.enableMercatorProjection():i.enableGlobeProjection()}const Zh={"zoom-in":i=>i.zoomIn(),"zoom-out":i=>i.zoomOut(),"toggle-projection":a2,"toggle-terrain":n2,"reset-view":i=>{i.getPitch()===0?i.easeTo({pitch:Math.min(i.getMaxPitch(),80)}):i.resetNorthPitch()},"reset-bearing":i=>{i.rotateTo(0)},"reset-pitch":i=>{i.setPitch(0)},"reset-roll":i=>{i.setRoll(0)}};var sf,Wh;let Oy=class extends _A{constructor(r,o){if(o&&!(o in Zh))throw new Error(`data-maptiler-control value "${o}" is invalid.`);super(r,o&&Zh[o]),fn(this,sf),fn(this,Wh,new Map)}onAdd(r){return Bn(this,sf,r),super.onAdd(r)}onRemove(){for(const[r,o]of pt(this,Wh)){const h=r.deref();h&&h.removeEventListener("click",o)}pt(this,Wh).clear(),super.onRemove()}configureGroupItem(r,o){if(!o)return;if(!(o in Zh))throw new Error(`data-maptiler-control value "${o}" is invalid.`);const h=m=>{Zh[o](pt(this,sf),r,m)};r.addEventListener("click",h),pt(this,Wh).set(new WeakRef(r),h)}};sf=new WeakMap,Wh=new WeakMap,tt(Oy,"controlCallbacks",Zh);var On,Qa,xl,wl,Jn,lf,on,o2,ea,s2;let Fg=class{constructor(r,o){fn(this,on),fn(this,On),tt(this,"map"),fn(this,Qa),fn(this,xl),fn(this,wl),fn(this,Jn,!1),fn(this,lf),r.style!==void 0&&Bn(this,Jn,!0),Bn(this,On,{zoomAdjust:-4,position:"top-right",...o,forceNoAttributionControl:!0,attributionControl:!1,navigationControl:!1,geolocateControl:!1,maptilerLogo:!1,minimap:!1,hash:!1,pitchAdjust:!1,...r,containerStyle:{border:"1px solid #000",width:"400px",height:"300px",...r.containerStyle??{}}}),r.lockZoom!==void 0&&(pt(this,On).minZoom=r.lockZoom,pt(this,On).maxZoom=r.lockZoom)}setStyle(r,o){pt(this,Jn)||this.map.setStyle(r,o),jn(this,on,ea).call(this)}addLayer(r,o){return pt(this,Jn)||this.map.addLayer(r,o),jn(this,on,ea).call(this),this.map}moveLayer(r,o){return pt(this,Jn)||this.map.moveLayer(r,o),jn(this,on,ea).call(this),this.map}removeLayer(r){return pt(this,Jn)||this.map.removeLayer(r),jn(this,on,ea).call(this),this}setLayerZoomRange(r,o,h){return pt(this,Jn)||this.map.setLayerZoomRange(r,o,h),jn(this,on,ea).call(this),this}setFilter(r,o,h){return pt(this,Jn)||this.map.setFilter(r,o,h),jn(this,on,ea).call(this),this}setPaintProperty(r,o,h,m){return pt(this,Jn)||this.map.setPaintProperty(r,o,h,m),jn(this,on,ea).call(this),this}setLayoutProperty(r,o,h,m){return pt(this,Jn)||this.map.setLayoutProperty(r,o,h,m),jn(this,on,ea).call(this),this}setGlyphs(r,o){return pt(this,Jn)||this.map.setGlyphs(r,o),jn(this,on,ea).call(this),this}onAdd(r){Bn(this,Qa,r),Bn(this,xl,Bo("div","maplibregl-ctrl maplibregl-ctrl-group"));for(const[o,h]of Object.entries(pt(this,On).containerStyle))pt(this,xl).style.setProperty(o,h);return pt(this,On).container=pt(this,xl),pt(this,On).zoom=r.getZoom()+pt(this,On).zoomAdjust,this.map=new h2(pt(this,On)),this.map.once("style.load",()=>{this.map.resize()}),this.map.once("load",()=>{jn(this,on,o2).call(this,pt(this,On).parentRect),Bn(this,lf,jn(this,on,s2).call(this))}),pt(this,xl)}onRemove(){var r;(r=pt(this,lf))==null||r.call(this),yp(pt(this,xl))}};On=new WeakMap,Qa=new WeakMap,xl=new WeakMap,wl=new WeakMap,Jn=new WeakMap,lf=new WeakMap,on=new WeakSet,o2=function(i){i===void 0||i.linePaint===void 0&&i.fillPaint===void 0||(Bn(this,wl,{type:"Feature",properties:{name:"parentRect"},geometry:{type:"Polygon",coordinates:[[[],[],[],[],[]]]}}),this.map.addSource("parentRect",{type:"geojson",data:pt(this,wl)}),(i.lineLayout!==void 0||i.linePaint!==void 0)&&this.map.addLayer({id:"parentRectOutline",type:"line",source:"parentRect",layout:{...i.lineLayout},paint:{"line-color":"#FFF","line-width":1,"line-opacity":.85,...i.linePaint}}),i.fillPaint!==void 0&&this.map.addLayer({id:"parentRectFill",type:"fill",source:"parentRect",layout:{},paint:{"fill-color":"#08F","fill-opacity":.135,...i.fillPaint}}),jn(this,on,ea).call(this))},ea=function(){if(pt(this,wl)===void 0)return;const{devicePixelRatio:i}=window,r=pt(this,Qa).getCanvas(),o=r.width/i,h=r.height/i,m=pt(this,Qa).unproject.bind(pt(this,Qa)),v=m([0,0]),f=m([o,0]),l=m([0,h]),C=m([o,h]);pt(this,wl).geometry.coordinates=[[l.toArray(),C.toArray(),f.toArray(),v.toArray(),l.toArray()]];const M=this.map.getSource("parentRect");M!==void 0&&M.setData(pt(this,wl))},s2=function(){const{pitchAdjust:i}=pt(this,On),r=()=>{v("parent")},o=()=>{v("minimap")},h=()=>{pt(this,Qa).on("move",r),this.map.on("move",o)},m=()=>{pt(this,Qa).off("move",r),this.map.off("move",o)},v=f=>{m();const l=f==="parent"?pt(this,Qa):this.map,C=f==="parent"?this.map:pt(this,Qa),M=l.getCenter(),R=l.getZoom()+pt(this,On).zoomAdjust*(f==="parent"?1:-1),j=l.getBearing(),G=l.getPitch();C.jumpTo({center:M,zoom:R,bearing:j,pitch:i?G:0}),jn(this,on,ea).call(this),h()};return h(),()=>{m()}};class bA{constructor(r,o=2e3){tt(this,"map"),tt(this,"registeredModules",new Set),tt(this,"viewerType"),this.map=r,this.viewerType="Map",setTimeout(async()=>{if(!_i.telemetry)return;const h=this.preparePayload();try{(await fetch(h,{method:"POST"})).ok||console.warn("The metrics could not be sent to MapTiler Cloud")}catch(m){console.warn("The metrics could not be sent to MapTiler Cloud",m)}},Math.max(1e3,o))}registerModule(r,o){this.registeredModules.add(`${r}:${o}`)}registerViewerType(r="Map"){this.viewerType=r}preparePayload(){const r=new URL(cn.telemetryURL);return r.searchParams.append("sdk",sE()),r.searchParams.append("key",_i.apiKey),r.searchParams.append("mtsid",c0),r.searchParams.append("session",_i.session?"1":"0"),r.searchParams.append("caching",_i.caching?"1":"0"),r.searchParams.append("lang-updated",this.map.isLanguageUpdated()?"1":"0"),r.searchParams.append("terrain",this.map.getTerrain()?"1":"0"),r.searchParams.append("globe",this.map.isGlobeProjection()?"1":"0"),r.searchParams.append("viewerType",this.viewerType),this.registeredModules.size>0&&r.searchParams.append("modules",Array.from(this.registeredModules).join("|")),r.href}}var _p=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var i=0,r=arguments.length;r--;)i+=arguments[r]*arguments[r];return Math.sqrt(i)});function ip(){var i=new _p(16);return _p!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i}function xA(i,r,o,h,m,v,f,l,C,M,R,j,G,B,J,le,we){return i[0]=r,i[1]=o,i[2]=h,i[3]=m,i[4]=v,i[5]=f,i[6]=l,i[7]=C,i[8]=M,i[9]=R,i[10]=j,i[11]=G,i[12]=B,i[13]=J,i[14]=le,i[15]=we,i}function wA(i,r,o){var h=r[0],m=r[1],v=r[2],f=r[3],l=r[4],C=r[5],M=r[6],R=r[7],j=r[8],G=r[9],B=r[10],J=r[11],le=r[12],we=r[13],pe=r[14],xe=r[15],de=o[0],he=o[1],fe=o[2],Ae=o[3];return i[0]=de*h+he*l+fe*j+Ae*le,i[1]=de*m+he*C+fe*G+Ae*we,i[2]=de*v+he*M+fe*B+Ae*pe,i[3]=de*f+he*R+fe*J+Ae*xe,de=o[4],he=o[5],fe=o[6],Ae=o[7],i[4]=de*h+he*l+fe*j+Ae*le,i[5]=de*m+he*C+fe*G+Ae*we,i[6]=de*v+he*M+fe*B+Ae*pe,i[7]=de*f+he*R+fe*J+Ae*xe,de=o[8],he=o[9],fe=o[10],Ae=o[11],i[8]=de*h+he*l+fe*j+Ae*le,i[9]=de*m+he*C+fe*G+Ae*we,i[10]=de*v+he*M+fe*B+Ae*pe,i[11]=de*f+he*R+fe*J+Ae*xe,de=o[12],he=o[13],fe=o[14],Ae=o[15],i[12]=de*h+he*l+fe*j+Ae*le,i[13]=de*m+he*C+fe*G+Ae*we,i[14]=de*v+he*M+fe*B+Ae*pe,i[15]=de*f+he*R+fe*J+Ae*xe,i}function TA(i,r,o){var h=o[0],m=o[1],v=o[2];return i[0]=r[0]*h,i[1]=r[1]*h,i[2]=r[2]*h,i[3]=r[3]*h,i[4]=r[4]*m,i[5]=r[5]*m,i[6]=r[6]*m,i[7]=r[7]*m,i[8]=r[8]*v,i[9]=r[9]*v,i[10]=r[10]*v,i[11]=r[11]*v,i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],i}function Ub(i,r,o){var h=Math.sin(o),m=Math.cos(o),v=r[4],f=r[5],l=r[6],C=r[7],M=r[8],R=r[9],j=r[10],G=r[11];return r!==i&&(i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15]),i[4]=v*m+M*h,i[5]=f*m+R*h,i[6]=l*m+j*h,i[7]=C*m+G*h,i[8]=M*m-v*h,i[9]=R*m-f*h,i[10]=j*m-l*h,i[11]=G*m-C*h,i}function SA(i,r,o){var h=Math.sin(o),m=Math.cos(o),v=r[0],f=r[1],l=r[2],C=r[3],M=r[8],R=r[9],j=r[10],G=r[11];return r!==i&&(i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15]),i[0]=v*m-M*h,i[1]=f*m-R*h,i[2]=l*m-j*h,i[3]=C*m-G*h,i[8]=v*h+M*m,i[9]=f*h+R*m,i[10]=l*h+j*m,i[11]=C*h+G*m,i}function Vb(i,r,o){var h=Math.sin(o),m=Math.cos(o),v=r[0],f=r[1],l=r[2],C=r[3],M=r[4],R=r[5],j=r[6],G=r[7];return r!==i&&(i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15]),i[0]=v*m+M*h,i[1]=f*m+R*h,i[2]=l*m+j*h,i[3]=C*m+G*h,i[4]=M*m-v*h,i[5]=R*m-f*h,i[6]=j*m-l*h,i[7]=G*m-C*h,i}function kA(i,r,o,h,m){var v=1/Math.tan(r/2),f;return i[0]=v/o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=v,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,m!=null&&m!==1/0?(f=1/(h-m),i[10]=(m+h)*f,i[14]=2*m*h*f):(i[10]=-1,i[14]=-2*h),i}var CA=kA;function cf(){var i=new _p(3);return _p!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function PA(i,r,o){var h=new _p(3);return h[0]=i,h[1]=r,h[2]=o,h}function jg(i,r){var o=r[0],h=r[1],m=r[2],v=o*o+h*h+m*m;return v>0&&(v=1/Math.sqrt(v)),i[0]=r[0]*v,i[1]=r[1]*v,i[2]=r[2]*v,i}function qb(i,r,o){var h=r[0],m=r[1],v=r[2],f=o[0],l=o[1],C=o[2];return i[0]=m*C-v*l,i[1]=v*f-h*C,i[2]=h*l-m*f,i}(function(){var i=cf();return function(r,o,h,m,v,f){var l,C;for(o||(o=3),h||(h=0),m?C=Math.min(m*o+h,r.length):C=r.length,l=h;l<C;l+=o)i[0]=r[l],i[1]=r[l+1],i[2]=r[l+2],v(i,i,f),r[l]=i[0],r[l+1]=i[1],r[l+2]=i[2];return r}})();function MA(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Gb,Zb;function AA(){return Zb||(Zb=1,Gb={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}),Gb}var Og,Wb;function l2(){if(Wb)return Og;Wb=1;const i=AA(),r={};for(const m of Object.keys(i))r[i[m]]=m;const o={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};Og=o;for(const m of Object.keys(o)){if(!("channels"in o[m]))throw new Error("missing channels property: "+m);if(!("labels"in o[m]))throw new Error("missing channel labels property: "+m);if(o[m].labels.length!==o[m].channels)throw new Error("channel and label counts mismatch: "+m);const{channels:v,labels:f}=o[m];delete o[m].channels,delete o[m].labels,Object.defineProperty(o[m],"channels",{value:v}),Object.defineProperty(o[m],"labels",{value:f})}o.rgb.hsl=function(m){const v=m[0]/255,f=m[1]/255,l=m[2]/255,C=Math.min(v,f,l),M=Math.max(v,f,l),R=M-C;let j,G;M===C?j=0:v===M?j=(f-l)/R:f===M?j=2+(l-v)/R:l===M&&(j=4+(v-f)/R),j=Math.min(j*60,360),j<0&&(j+=360);const B=(C+M)/2;return M===C?G=0:B<=.5?G=R/(M+C):G=R/(2-M-C),[j,G*100,B*100]},o.rgb.hsv=function(m){let v,f,l,C,M;const R=m[0]/255,j=m[1]/255,G=m[2]/255,B=Math.max(R,j,G),J=B-Math.min(R,j,G),le=function(we){return(B-we)/6/J+1/2};return J===0?(C=0,M=0):(M=J/B,v=le(R),f=le(j),l=le(G),R===B?C=l-f:j===B?C=1/3+v-l:G===B&&(C=2/3+f-v),C<0?C+=1:C>1&&(C-=1)),[C*360,M*100,B*100]},o.rgb.hwb=function(m){const v=m[0],f=m[1];let l=m[2];const C=o.rgb.hsl(m)[0],M=1/255*Math.min(v,Math.min(f,l));return l=1-1/255*Math.max(v,Math.max(f,l)),[C,M*100,l*100]},o.rgb.cmyk=function(m){const v=m[0]/255,f=m[1]/255,l=m[2]/255,C=Math.min(1-v,1-f,1-l),M=(1-v-C)/(1-C)||0,R=(1-f-C)/(1-C)||0,j=(1-l-C)/(1-C)||0;return[M*100,R*100,j*100,C*100]};function h(m,v){return(m[0]-v[0])**2+(m[1]-v[1])**2+(m[2]-v[2])**2}return o.rgb.keyword=function(m){const v=r[m];if(v)return v;let f=1/0,l;for(const C of Object.keys(i)){const M=i[C],R=h(m,M);R<f&&(f=R,l=C)}return l},o.keyword.rgb=function(m){return i[m]},o.rgb.xyz=function(m){let v=m[0]/255,f=m[1]/255,l=m[2]/255;v=v>.04045?((v+.055)/1.055)**2.4:v/12.92,f=f>.04045?((f+.055)/1.055)**2.4:f/12.92,l=l>.04045?((l+.055)/1.055)**2.4:l/12.92;const C=v*.4124+f*.3576+l*.1805,M=v*.2126+f*.7152+l*.0722,R=v*.0193+f*.1192+l*.9505;return[C*100,M*100,R*100]},o.rgb.lab=function(m){const v=o.rgb.xyz(m);let f=v[0],l=v[1],C=v[2];f/=95.047,l/=100,C/=108.883,f=f>.008856?f**(1/3):7.787*f+16/116,l=l>.008856?l**(1/3):7.787*l+16/116,C=C>.008856?C**(1/3):7.787*C+16/116;const M=116*l-16,R=500*(f-l),j=200*(l-C);return[M,R,j]},o.hsl.rgb=function(m){const v=m[0]/360,f=m[1]/100,l=m[2]/100;let C,M,R;if(f===0)return R=l*255,[R,R,R];l<.5?C=l*(1+f):C=l+f-l*f;const j=2*l-C,G=[0,0,0];for(let B=0;B<3;B++)M=v+1/3*-(B-1),M<0&&M++,M>1&&M--,6*M<1?R=j+(C-j)*6*M:2*M<1?R=C:3*M<2?R=j+(C-j)*(2/3-M)*6:R=j,G[B]=R*255;return G},o.hsl.hsv=function(m){const v=m[0];let f=m[1]/100,l=m[2]/100,C=f;const M=Math.max(l,.01);l*=2,f*=l<=1?l:2-l,C*=M<=1?M:2-M;const R=(l+f)/2,j=l===0?2*C/(M+C):2*f/(l+f);return[v,j*100,R*100]},o.hsv.rgb=function(m){const v=m[0]/60,f=m[1]/100;let l=m[2]/100;const C=Math.floor(v)%6,M=v-Math.floor(v),R=255*l*(1-f),j=255*l*(1-f*M),G=255*l*(1-f*(1-M));switch(l*=255,C){case 0:return[l,G,R];case 1:return[j,l,R];case 2:return[R,l,G];case 3:return[R,j,l];case 4:return[G,R,l];case 5:return[l,R,j]}},o.hsv.hsl=function(m){const v=m[0],f=m[1]/100,l=m[2]/100,C=Math.max(l,.01);let M,R;R=(2-f)*l;const j=(2-f)*C;return M=f*C,M/=j<=1?j:2-j,M=M||0,R/=2,[v,M*100,R*100]},o.hwb.rgb=function(m){const v=m[0]/360;let f=m[1]/100,l=m[2]/100;const C=f+l;let M;C>1&&(f/=C,l/=C);const R=Math.floor(6*v),j=1-l;M=6*v-R,R&1&&(M=1-M);const G=f+M*(j-f);let B,J,le;switch(R){default:case 6:case 0:B=j,J=G,le=f;break;case 1:B=G,J=j,le=f;break;case 2:B=f,J=j,le=G;break;case 3:B=f,J=G,le=j;break;case 4:B=G,J=f,le=j;break;case 5:B=j,J=f,le=G;break}return[B*255,J*255,le*255]},o.cmyk.rgb=function(m){const v=m[0]/100,f=m[1]/100,l=m[2]/100,C=m[3]/100,M=1-Math.min(1,v*(1-C)+C),R=1-Math.min(1,f*(1-C)+C),j=1-Math.min(1,l*(1-C)+C);return[M*255,R*255,j*255]},o.xyz.rgb=function(m){const v=m[0]/100,f=m[1]/100,l=m[2]/100;let C,M,R;return C=v*3.2406+f*-1.5372+l*-.4986,M=v*-.9689+f*1.8758+l*.0415,R=v*.0557+f*-.204+l*1.057,C=C>.0031308?1.055*C**(1/2.4)-.055:C*12.92,M=M>.0031308?1.055*M**(1/2.4)-.055:M*12.92,R=R>.0031308?1.055*R**(1/2.4)-.055:R*12.92,C=Math.min(Math.max(0,C),1),M=Math.min(Math.max(0,M),1),R=Math.min(Math.max(0,R),1),[C*255,M*255,R*255]},o.xyz.lab=function(m){let v=m[0],f=m[1],l=m[2];v/=95.047,f/=100,l/=108.883,v=v>.008856?v**(1/3):7.787*v+16/116,f=f>.008856?f**(1/3):7.787*f+16/116,l=l>.008856?l**(1/3):7.787*l+16/116;const C=116*f-16,M=500*(v-f),R=200*(f-l);return[C,M,R]},o.lab.xyz=function(m){const v=m[0],f=m[1],l=m[2];let C,M,R;M=(v+16)/116,C=f/500+M,R=M-l/200;const j=M**3,G=C**3,B=R**3;return M=j>.008856?j:(M-16/116)/7.787,C=G>.008856?G:(C-16/116)/7.787,R=B>.008856?B:(R-16/116)/7.787,C*=95.047,M*=100,R*=108.883,[C,M,R]},o.lab.lch=function(m){const v=m[0],f=m[1],l=m[2];let C;C=Math.atan2(l,f)*360/2/Math.PI,C<0&&(C+=360);const M=Math.sqrt(f*f+l*l);return[v,M,C]},o.lch.lab=function(m){const v=m[0],f=m[1],l=m[2]/360*2*Math.PI,C=f*Math.cos(l),M=f*Math.sin(l);return[v,C,M]},o.rgb.ansi16=function(m,v=null){const[f,l,C]=m;let M=v===null?o.rgb.hsv(m)[2]:v;if(M=Math.round(M/50),M===0)return 30;let R=30+(Math.round(C/255)<<2|Math.round(l/255)<<1|Math.round(f/255));return M===2&&(R+=60),R},o.hsv.ansi16=function(m){return o.rgb.ansi16(o.hsv.rgb(m),m[2])},o.rgb.ansi256=function(m){const v=m[0],f=m[1],l=m[2];return v===f&&f===l?v<8?16:v>248?231:Math.round((v-8)/247*24)+232:16+36*Math.round(v/255*5)+6*Math.round(f/255*5)+Math.round(l/255*5)},o.ansi16.rgb=function(m){let v=m%10;if(v===0||v===7)return m>50&&(v+=3.5),v=v/10.5*255,[v,v,v];const f=(~~(m>50)+1)*.5,l=(v&1)*f*255,C=(v>>1&1)*f*255,M=(v>>2&1)*f*255;return[l,C,M]},o.ansi256.rgb=function(m){if(m>=232){const M=(m-232)*10+8;return[M,M,M]}m-=16;let v;const f=Math.floor(m/36)/5*255,l=Math.floor((v=m%36)/6)/5*255,C=v%6/5*255;return[f,l,C]},o.rgb.hex=function(m){const v=(((Math.round(m[0])&255)<<16)+((Math.round(m[1])&255)<<8)+(Math.round(m[2])&255)).toString(16).toUpperCase();return"000000".substring(v.length)+v},o.hex.rgb=function(m){const v=m.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!v)return[0,0,0];let f=v[0];v[0].length===3&&(f=f.split("").map(j=>j+j).join(""));const l=parseInt(f,16),C=l>>16&255,M=l>>8&255,R=l&255;return[C,M,R]},o.rgb.hcg=function(m){const v=m[0]/255,f=m[1]/255,l=m[2]/255,C=Math.max(Math.max(v,f),l),M=Math.min(Math.min(v,f),l),R=C-M;let j,G;return R<1?j=M/(1-R):j=0,R<=0?G=0:C===v?G=(f-l)/R%6:C===f?G=2+(l-v)/R:G=4+(v-f)/R,G/=6,G%=1,[G*360,R*100,j*100]},o.hsl.hcg=function(m){const v=m[1]/100,f=m[2]/100,l=f<.5?2*v*f:2*v*(1-f);let C=0;return l<1&&(C=(f-.5*l)/(1-l)),[m[0],l*100,C*100]},o.hsv.hcg=function(m){const v=m[1]/100,f=m[2]/100,l=v*f;let C=0;return l<1&&(C=(f-l)/(1-l)),[m[0],l*100,C*100]},o.hcg.rgb=function(m){const v=m[0]/360,f=m[1]/100,l=m[2]/100;if(f===0)return[l*255,l*255,l*255];const C=[0,0,0],M=v%1*6,R=M%1,j=1-R;let G=0;switch(Math.floor(M)){case 0:C[0]=1,C[1]=R,C[2]=0;break;case 1:C[0]=j,C[1]=1,C[2]=0;break;case 2:C[0]=0,C[1]=1,C[2]=R;break;case 3:C[0]=0,C[1]=j,C[2]=1;break;case 4:C[0]=R,C[1]=0,C[2]=1;break;default:C[0]=1,C[1]=0,C[2]=j}return G=(1-f)*l,[(f*C[0]+G)*255,(f*C[1]+G)*255,(f*C[2]+G)*255]},o.hcg.hsv=function(m){const v=m[1]/100,f=m[2]/100,l=v+f*(1-v);let C=0;return l>0&&(C=v/l),[m[0],C*100,l*100]},o.hcg.hsl=function(m){const v=m[1]/100,f=m[2]/100*(1-v)+.5*v;let l=0;return f>0&&f<.5?l=v/(2*f):f>=.5&&f<1&&(l=v/(2*(1-f))),[m[0],l*100,f*100]},o.hcg.hwb=function(m){const v=m[1]/100,f=m[2]/100,l=v+f*(1-v);return[m[0],(l-v)*100,(1-l)*100]},o.hwb.hcg=function(m){const v=m[1]/100,f=1-m[2]/100,l=f-v;let C=0;return l<1&&(C=(f-l)/(1-l)),[m[0],l*100,C*100]},o.apple.rgb=function(m){return[m[0]/65535*255,m[1]/65535*255,m[2]/65535*255]},o.rgb.apple=function(m){return[m[0]/255*65535,m[1]/255*65535,m[2]/255*65535]},o.gray.rgb=function(m){return[m[0]/100*255,m[0]/100*255,m[0]/100*255]},o.gray.hsl=function(m){return[0,0,m[0]]},o.gray.hsv=o.gray.hsl,o.gray.hwb=function(m){return[0,100,m[0]]},o.gray.cmyk=function(m){return[0,0,0,m[0]]},o.gray.lab=function(m){return[m[0],0,0]},o.gray.hex=function(m){const v=Math.round(m[0]/100*255)&255,f=((v<<16)+(v<<8)+v).toString(16).toUpperCase();return"000000".substring(f.length)+f},o.rgb.gray=function(m){return[(m[0]+m[1]+m[2])/3/255*100]},Og}var Bg,Hb;function EA(){if(Hb)return Bg;Hb=1;const i=l2();function r(){const v={},f=Object.keys(i);for(let l=f.length,C=0;C<l;C++)v[f[C]]={distance:-1,parent:null};return v}function o(v){const f=r(),l=[v];for(f[v].distance=0;l.length;){const C=l.pop(),M=Object.keys(i[C]);for(let R=M.length,j=0;j<R;j++){const G=M[j],B=f[G];B.distance===-1&&(B.distance=f[C].distance+1,B.parent=C,l.unshift(G))}}return f}function h(v,f){return function(l){return f(v(l))}}function m(v,f){const l=[f[v].parent,v];let C=i[f[v].parent][v],M=f[v].parent;for(;f[M].parent;)l.unshift(f[M].parent),C=h(i[f[M].parent][M],C),M=f[M].parent;return C.conversion=l,C}return Bg=function(v){const f=o(v),l={},C=Object.keys(f);for(let M=C.length,R=0;R<M;R++){const j=C[R];f[j].parent!==null&&(l[j]=m(j,f))}return l},Bg}var $g,Xb;function IA(){if(Xb)return $g;Xb=1;const i=l2(),r=EA(),o={},h=Object.keys(i);function m(f){const l=function(...C){const M=C[0];return M==null?M:(M.length>1&&(C=M),f(C))};return"conversion"in f&&(l.conversion=f.conversion),l}function v(f){const l=function(...C){const M=C[0];if(M==null)return M;M.length>1&&(C=M);const R=f(C);if(typeof R=="object")for(let j=R.length,G=0;G<j;G++)R[G]=Math.round(R[G]);return R};return"conversion"in f&&(l.conversion=f.conversion),l}return h.forEach(f=>{o[f]={},Object.defineProperty(o[f],"channels",{value:i[f].channels}),Object.defineProperty(o[f],"labels",{value:i[f].labels});const l=r(f);Object.keys(l).forEach(C=>{const M=l[C];o[f][C]=v(M),o[f][C].raw=m(M)})}),$g=o,$g}var zA=IA();const RA=MA(zA);function Kb({gl:i,type:r,source:o}){const h=i.createShader(r);if(h===null)throw new Error("Cannot create shader");if(i.shaderSource(h,o),i.compileShader(h),!i.getShaderParameter(h,i.COMPILE_STATUS))throw console.error("Shader compilation error:",i.getShaderInfoLog(h)),i.deleteShader(h),new Error("Cannot compile shader");return h}function LA({gl:i,vertexShaderSource:r,fragmentShaderSource:o}){const h=Kb({gl:i,type:i.VERTEX_SHADER,source:r}),m=Kb({gl:i,type:i.FRAGMENT_SHADER,source:o}),v=i.createProgram();if(i.attachShader(v,h),i.attachShader(v,m),i.linkProgram(v),!i.getProgramParameter(v,i.LINK_STATUS))throw console.error("Error: ",i.getProgramInfoLog(v)),new Error("Cannot link shader program");return v}function DA(i,r,o){const h=i.getUniformLocation(r,o);if(h===null)throw new Error(`Cannot get uniform location for ${o}`);return h}function c2({gl:i,vertexShaderSource:r,fragmentShaderSource:o,attributesKeys:h,uniformsKeys:m,vertices:v,indices:f}){const l=LA({gl:i,vertexShaderSource:r,fragmentShaderSource:o}),C=h.reduce((B,J)=>(B[J]=i.getAttribLocation(l,`a_${J}`),B),{}),M=m.reduce((B,J)=>(B[J]=DA(i,l,`u_${J}`),B),{}),R=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,R),i.bufferData(i.ARRAY_BUFFER,new Float32Array(v),i.STATIC_DRAW);let j,G;return f!==void 0&&(j=i.createBuffer(),G=f.length,i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,j),i.bufferData(i.ELEMENT_ARRAY_BUFFER,new Uint16Array(f),i.STATIC_DRAW)),{shaderProgram:l,programInfo:{attributesLocations:C,uniformsLocations:M},positionBuffer:R,indexBuffer:j,indexBufferLength:G}}function uf(i){if(!i)return[1,1,1,0];if(i==="transparent")return[1,1,1,0];try{const r=FA(i),o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i.exec(r);if(o!=null&&o.length){const m=!!o[4];return[...RA.hex.rgb(r).map(v=>v/255),m?parseInt(o[4],16)/255:1]}const h=r.match(/(\d\.\d(\d+)?|\d{3}|\d{2}|\d{1})/gi)??["0","0","0"];if(r.includes("rgb")){const m=r.includes("rgba"),v=[...h.map(f=>parseFloat(f)).map((f,l)=>l<3?f/255:f)];return m||v.push(1),v}}catch{}return console.warn([`[parseColorStringToVec4]: Color ${i} is either not a valid color or its type is not supported, defaulting to black`]),[0,0,0,1]}let Nh;function FA(i){return Nh=Nh??document.createElement("canvas").getContext("2d"),Nh?(Nh.fillStyle=i,Nh.fillStyle):"#000000"}const S0=1,na=S0/2,aa=S0/2,oa=S0/2,jA=[-.5,-.5,oa,na,-.5,oa,na,aa,oa,-.5,aa,oa],OA=[-.5,-.5,-.5,-.5,aa,-.5,na,aa,-.5,na,-.5,-.5],BA=[-.5,aa,-.5,-.5,aa,oa,na,aa,oa,na,aa,-.5],$A=[-.5,-.5,-.5,na,-.5,-.5,na,-.5,oa,-.5,-.5,oa],NA=[na,-.5,-.5,na,aa,-.5,na,aa,oa,na,-.5,oa],UA=[-.5,-.5,-.5,-.5,-.5,oa,-.5,aa,oa,-.5,aa,-.5],VA=[...jA,...OA,...BA,...$A,...NA,...UA],qA=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],GA=`attribute vec3 a_vertexPosition;
varying vec3 vTextureCoord;

uniform mat4 u_projectionMatrix;
uniform mat4 u_modelViewMatrix;
  
void main(void) {
  vTextureCoord = vec3(-a_vertexPosition.x, a_vertexPosition.y, a_vertexPosition.z);
  gl_Position = u_projectionMatrix * u_modelViewMatrix * vec4(a_vertexPosition, 1.0);
}
`,Yb=`precision mediump float;

varying vec3 vTextureCoord;

%USE_TEXTURE_MACRO_MARKER%

# ifdef USE_TEXTURE
uniform samplerCube u_cubeSampler;
uniform float u_fadeOpacity;
# endif

uniform vec4 u_bgColor;

void main(void) {
  #ifdef USE_TEXTURE
  vec4 texColor = textureCube(u_cubeSampler, vTextureCoord);

    gl_FragColor = mix(
      u_bgColor,
      texColor,
      min(texColor.a, u_fadeOpacity)
    );

    gl_FragColor.a = max(gl_FragColor.a, u_fadeOpacity);

  #else
  gl_FragColor = u_bgColor;
  #endif
}
`,Dl={stars:{color:"hsl(233,100%,92%)",preset:"stars"},space:{color:"hsl(210, 100%, 4%)",preset:"space"},milkyway:{color:"hsl(233,100%,92%)",preset:"milkyway"},"milkyway-subtle":{color:"hsl(233,100%,92%)",preset:"milkyway-subtle"},"milkyway-bright":{color:"hsl(233,100%,92%)",preset:"milkyway-bright"},"milkyway-colored":{color:"black",preset:"milkyway-colored"}};var Tl=(i=>(i.POSITIVE_X="pX",i.NEGATIVE_X="nX",i.POSITIVE_Y="pY",i.NEGATIVE_Y="nY",i.POSITIVE_Z="pZ",i.NEGATIVE_Z="nZ",i))(Tl||{});let Jd,Jb,Qb;function ZA({gl:i,faces:r,onReady:o,forceRefresh:h}){Jd&&!h&&Qb===JSON.stringify(r)&&o(Jd,Jb),Qb=JSON.stringify(r);const m=Jd??i.createTexture();if(i.bindTexture(i.TEXTURE_CUBE_MAP,m),!r){console.warn("[CubemapLayer][loadCubemapTexture]: Faces are null");return}const v=Object.keys(r).length;if(v!==6){console.warn(`[CubemapLayer][loadCubemapTexture]: Faces should contain exactly 6 images, but found ${v}`);return}const f=Object.entries(r).map(([l,C])=>new Promise((M,R)=>{const j=l;if(C===void 0){R(new Error(`[CubemapLayer][loadCubemapTexture]: Face ${l} is undefined`));return}const G=new Image;G.crossOrigin="anonymous";const B=()=>{M({image:G,key:j})};G.src=C,G.complete&&G.naturalWidth>0?B():G.onload=B,G.onerror=()=>{R(new Error(`[CubemapLayer][loadCubemapTexture]: Error loading image ${C}`))}}));Promise.all(f).then(l=>{for(let M=0;M<l.length;M++){const R=i.RGBA,j=i.RGBA,G=i.UNSIGNED_BYTE,{image:B,key:J}=l[M]??{};if(!B||!J){console.warn("[CubemapLayer][loadCubemapTexture]: Image or key is null");continue}const le=WA(i,J);i.bindTexture(i.TEXTURE_CUBE_MAP,m),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(le,0,R,j,G,B)}i.bindTexture(i.TEXTURE_CUBE_MAP,m),i.generateMipmap(i.TEXTURE_CUBE_MAP),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_FILTER,i.LINEAR_MIPMAP_LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAG_FILTER,i.LINEAR);const C=l.map(M=>M.image);o(m,C),Jb=C,Jd=m}).catch(l=>{console.error("[CubemapLayer][loadCubemapTexture]: Error loading cubemap texture",l)})}function WA(i,r){if(r===Tl.POSITIVE_X)return i.TEXTURE_CUBE_MAP_POSITIVE_X;if(r===Tl.NEGATIVE_X)return i.TEXTURE_CUBE_MAP_NEGATIVE_X;if(r===Tl.POSITIVE_Y)return i.TEXTURE_CUBE_MAP_POSITIVE_Y;if(r===Tl.NEGATIVE_Y)return i.TEXTURE_CUBE_MAP_NEGATIVE_Y;if(r===Tl.POSITIVE_Z)return i.TEXTURE_CUBE_MAP_POSITIVE_Z;if(r===Tl.NEGATIVE_Z)return i.TEXTURE_CUBE_MAP_NEGATIVE_Z;throw new Error(`[CubemapLayer][loadCubemapTexture]: Invalid key ${r}`)}function HA(i,r,o){return[Ms(i[0],r[0],o),Ms(i[1],r[1],o),Ms(i[2],r[2],o),Ms(i[3],r[3],o)]}function Ms(i,r,o){return i+(r-i)*o}const Xc="https://api.maptiler.com/resources/space",XA=["vertexPosition"],KA=["projectionMatrix","modelViewMatrix","cubeSampler","bgColor","fadeOpacity"],e1="%USE_TEXTURE_MACRO_MARKER%",YA="#define USE_TEXTURE",t1=Dl.stars;function JA(i,r){if(!u2(i))return{color:"transparent"};if(i===!0)return r;const o={...i};if(i.faces||i.path)return delete o.preset,o;const h=i.preset;if(h!==void 0&&!(h in Dl))throw new Error(`[CubemapLayer]: Invalid preset "${h}". Available presets: ${Object.keys(Dl).join(", ")}`);return{...o,color:o.color??Dl[h].color??"hsl(233,100%,92%)"}}let Ng=class{constructor(r){tt(this,"id","Cubemap Layer"),tt(this,"type","custom"),tt(this,"renderingMode","3d"),tt(this,"map"),tt(this,"faces"),tt(this,"useCubemapTexture",!0),tt(this,"currentFadeOpacity",0),tt(this,"cubeMapNeedsUpdate",!1),tt(this,"bgColor"),tt(this,"previousBgColor",[0,0,0,0]),tt(this,"targetBgColor",[0,0,0,0]),tt(this,"transitionDelta",0),tt(this,"gl"),tt(this,"cubemap"),tt(this,"texture"),tt(this,"currentFacesDefinitionKey",""),tt(this,"options"),tt(this,"animationActive",!0),tt(this,"imageIsAnimating",!1),tt(this,"imageFadeInDelta",0);const o=JA(r,t1);this.options=o,this.currentFacesDefinitionKey=JSON.stringify(o.faces??o.preset??o.path),this.bgColor=[0,0,0,0],this.targetBgColor=uf(o.color),this.faces=r1(o),this.useCubemapTexture=this.faces!==null}updateCubemap({facesNeedUpdate:r}={facesNeedUpdate:!0}){this.useCubemapTexture=this.faces!==null;const o=KA.filter(h=>h==="cubeSampler"||h==="fadeOpacity"?this.useCubemapTexture:!0);this.cubemap=c2({gl:this.gl,vertexShaderSource:GA,fragmentShaderSource:this.useCubemapTexture?Yb.replace(e1,YA):Yb.replace(e1,""),attributesKeys:XA,uniformsKeys:o,vertices:VA,indices:qA}),this.cubeMapNeedsUpdate=r,this.useCubemapTexture&&this.updateTexture(this.gl,this.faces),this.animateColorChange()}onAdd(r,o){this.map=r,this.gl=o,this.updateCubemap()}onRemove(r,o){this.cubemap&&(o.deleteProgram(this.cubemap.shaderProgram),o.deleteBuffer(this.cubemap.positionBuffer))}updateTexture(r,o){if(this.cubeMapNeedsUpdate===!0&&!this.imageIsAnimating){if(this.cubeMapNeedsUpdate=!1,!this.useCubemapTexture)return;ZA({gl:r,faces:o,onReady:h=>{this.texture=h,this.animateIn()}})}}prerender(r,o){this.faces&&this.updateTexture(this.gl,this.faces)}animateColorChange(){const r=()=>{this.transitionDelta<1&&(requestAnimationFrame(r),this.bgColor=HA(this.previousBgColor,this.targetBgColor,this.transitionDelta),this.transitionDelta+=.075,this.map.triggerRepaint())};requestAnimationFrame(r)}async animateIn(){if(!this.imageIsAnimating){if(!this.animationActive){this.currentFadeOpacity=1,this.imageFadeInDelta=1,this.map.triggerRepaint();return}return new Promise(r=>{this.imageIsAnimating=!0;const o=()=>{if(this.imageFadeInDelta=Math.min(this.imageFadeInDelta+.05,1),this.currentFadeOpacity=Ms(0,1,this.imageFadeInDelta),this.map.triggerRepaint(),this.imageFadeInDelta<1){requestAnimationFrame(o);return}this.imageIsAnimating=!1,this.imageFadeInDelta=0,r()};requestAnimationFrame(o)})}}async animateOut(){if(!(this.imageIsAnimating||!this.animationActive))return new Promise(r=>{const o=()=>{if(this.imageFadeInDelta=Math.min(this.imageFadeInDelta+.05,1),this.currentFadeOpacity=Ms(1,0,this.imageFadeInDelta),this.map.triggerRepaint(),this.imageFadeInDelta>=1){this.imageIsAnimating=!1,this.imageFadeInDelta=0,r();return}requestAnimationFrame(o)};requestAnimationFrame(o)})}setAnimationActive(r){this.animationActive=r}render(r,o){if(!this.map.isGlobeProjection())return;if(this.map===void 0)throw new Error("[CubemapLayer]: Map is undefined");if(this.cubemap===void 0)throw new Error("[CubemapLayer]: Cubemap is undefined");this.texture,r.disable(r.DEPTH_TEST),r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.DST_ALPHA),r.useProgram(this.cubemap.shaderProgram),r.bindBuffer(r.ARRAY_BUFFER,this.cubemap.positionBuffer),r.vertexAttribPointer(this.cubemap.programInfo.attributesLocations.vertexPosition,3,r.FLOAT,!1,0,0),r.enableVertexAttribArray(this.cubemap.programInfo.attributesLocations.vertexPosition);const h=.1,m=1e4,v=r.canvas,f=v.clientWidth/v.clientHeight,l=this.map.transform,C=l.fov*(Math.PI/180),M=ip();CA(M,C,f,h,m),Vb(M,M,l.rollInRadians),Ub(M,M,-l.pitchInRadians),Vb(M,M,l.bearingInRadians);const R=l.center.lat*Math.PI/180,j=l.center.lng*Math.PI/180;Ub(M,M,R),SA(M,M,-j),r.uniformMatrix4fv(this.cubemap.programInfo.uniformsLocations.projectionMatrix,!1,M);const G=ip();if(r.uniformMatrix4fv(this.cubemap.programInfo.uniformsLocations.modelViewMatrix,!1,G),r.uniform4fv(this.cubemap.programInfo.uniformsLocations.bgColor,new Float32Array(this.bgColor)),r.uniform1f(this.cubemap.programInfo.uniformsLocations.fadeOpacity,this.currentFadeOpacity),this.useCubemapTexture&&this.texture&&(r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_CUBE_MAP,this.texture),r.uniform1i(this.cubemap.programInfo.uniformsLocations.cubeSampler,0)),this.cubemap.indexBuffer===void 0)throw new Error("Index buffer is undefined");if(this.cubemap.indexBufferLength===void 0)throw new Error("Index buffer length is undefined");r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.cubemap.indexBuffer),r.drawElements(r.TRIANGLES,this.cubemap.indexBufferLength,r.UNSIGNED_SHORT,0)}setBgColor(r){this.targetBgColor=r,this.previousBgColor=this.bgColor,this.transitionDelta=0}getConfig(){return this.options}async setCubemapFaces(r){if(await this.animateOut(),!r.faces&&!r.preset&&!r.path){this.faces=null,this.useCubemapTexture=!1,this.currentFacesDefinitionKey="empty",await this.animateIn();return}this.faces=r1(r),this.currentFacesDefinitionKey=JSON.stringify(r.faces??r.preset??r.path)}async setCubemap(r){const o=typeof r=="boolean"?t1:r;this.options=o;const h=JSON.stringify(o.faces??o.preset??o.path),m=this.currentFacesDefinitionKey!==h;m&&(await this.setCubemapFaces(o),this.cubeMapNeedsUpdate=!0);const v=uf(o.color);if(o.color&&this.targetBgColor.toString()!==v.toString())this.setBgColor(v);else if(!o.color&&o.preset&&o.preset in Dl){const f=Dl[o.preset];this.setBgColor(uf(f.color))}this.updateCubemap({facesNeedUpdate:m})}show(){this.map.setLayoutProperty(this.id,"visibility","visible")}hide(){this.map.setLayoutProperty(this.id,"visibility","none")}};function u2(i){return i?typeof i=="boolean"?!0:!(!i.path&&!i.preset&&!i.faces&&!i.color||i.preset&&!(i.preset in Dl)||i.faces&&(!i.faces.pX||!i.faces.nX||!i.faces.pY||!i.faces.nY||!i.faces.pZ||!i.faces.nZ)):!1}function r1(i){if(i.faces)return i.faces;if(i.preset)return{pX:`${Xc}/${i.preset}/px.webp`,nX:`${Xc}/${i.preset}/nx.webp`,pY:`${Xc}/${i.preset}/py.webp`,nY:`${Xc}/${i.preset}/ny.webp`,pZ:`${Xc}/${i.preset}/pz.webp`,nZ:`${Xc}/${i.preset}/nz.webp`};if(i.path){const r=i.path.baseUrl,o=i.path.format??"png";return{pX:`${r}/px.${o}`,nX:`${r}/nx.${o}`,pY:`${r}/py.${o}`,nY:`${r}/ny.${o}`,pZ:`${r}/pz.${o}`,nZ:`${r}/nz.${o}`}}return null}const QA=`attribute vec3 a_position;

uniform mat4 u_matrix;
uniform mat4 u_rotationMatrix;

uniform float u_scale;

varying vec2 v_pos;
varying float v_scale;

void main() {
  v_scale = u_scale;
  v_pos = a_position.xy * u_scale;
  gl_Position = u_matrix * u_rotationMatrix * vec4(a_position, 1.0);
}
`,eE=`precision mediump float;
varying vec2 v_pos;
      
uniform int u_stopsNumber;
uniform float u_stops[100];
uniform vec4 u_colors[100];
uniform float u_maxDistance;

varying float v_scale;

const float EPSILON = 0.000001;

vec2 center = vec2(0.0, 0.0);
void main() {
  float rawDistance = distance(center, v_pos);
  float distanceFromGlobeEdge = rawDistance - 1.0;

    vec4 color = u_colors[0];

  // if we're further than the max distance, we should not render anything.
  // This is to always render a circle, otherwise we end up rendering
  // to the corners of the plane.
  if (distance(center, v_pos) > u_maxDistance * v_scale) {
    discard;
  }

  for (int i = 1; i < 100; i++) {
    // if we're past the last stop
    // we should fill to the end with the last stop color
    if (i >= u_stopsNumber) {
      color = u_colors[i - 1];
      break;
    }

    float scaledStopPosition = u_stops[i] * pow(v_scale, 1.6);
    float lastStopValue = u_stops[i - 1];
    float thisStopValue = u_stops[i];

    // this is to avoid blending errors when the stops are the same
    // eg when you would want a sharp edge between two stops.
    // \`numbersAreEqual\` will be 1.0 if the numbers are equal, 0.0 if they are not.
    // We then subtract EPSILON from the last stop making the stop value _almost_ equal
    // to the next stop but not enough to cause blending issues.
    // It's more efficient to do this than an if / else statement.
    float numbersAreEqual = 1.0 - step(EPSILON, abs(lastStopValue - thisStopValue));
    lastStopValue = lastStopValue - numbersAreEqual * EPSILON;

    float lastScaledStopPosition = lastStopValue * pow(v_scale, 1.6);

    if (distanceFromGlobeEdge <= scaledStopPosition) {
      float stopBlendFactor = (distanceFromGlobeEdge - lastScaledStopPosition) / (scaledStopPosition - lastScaledStopPosition);
      color = mix(u_colors[i - 1], u_colors[i], stopBlendFactor);
      break;
    }
  }
  
  // gl_FragColor = color;
  gl_FragColor = vec4(color.rgb * color.a, color.a);
}
`,Hh=2,tE=["position"],rE=["matrix","rotationMatrix","stopsNumber","stops","colors","maxDistance","scale"],iE=[-2,-2,0,Hh,-2,0,-2,Hh,0,Hh,Hh,0],gl={scale:.9,stops:[[0,"rgba(176, 208, 240, 1)"],[.1,"rgba(98, 168, 229, 0.3)"],[.2,"rgba(98, 168, 229, 0.0)"]]},i1=.06;let Ug=class{constructor(r){if(tt(this,"id","Halo Layer"),tt(this,"type","custom"),tt(this,"renderingMode","3d"),tt(this,"gradient"),tt(this,"scale",0),tt(this,"animationDelta",0),tt(this,"map"),tt(this,"plane"),tt(this,"animationActive",!0),typeof r=="boolean"){this.gradient=gl;return}this.gradient={...gl,...r}}onAdd(r,o){this.map=r,this.plane=c2({gl:o,vertexShaderSource:QA,fragmentShaderSource:eE,attributesKeys:tE,uniformsKeys:rE,vertices:iE}),this.animateIn()}getConfig(){return this.gradient}async animateIn(){if(!this.animationActive){this.scale=this.gradient.scale,this.animationDelta=1,this.map.triggerRepaint();return}return new Promise(r=>{this.animationDelta=0;const o=()=>{if(this.animationDelta<1){this.scale=Ms(0,this.gradient.scale,this.animationDelta),this.animationDelta+=i1,this.map.triggerRepaint(),requestAnimationFrame(o);return}r()};requestAnimationFrame(o)})}async animateOut(){if(this.animationActive)return this.animationDelta=0,new Promise(r=>{const o=()=>{if(this.animationDelta<1){this.scale=Ms(this.gradient.scale,0,this.animationDelta),this.animationDelta+=i1,this.map.triggerRepaint(),requestAnimationFrame(o);return}r()};o()})}onRemove(r,o){this.plane!==void 0&&(o.deleteProgram(this.plane.shaderProgram),o.deleteBuffer(this.plane.positionBuffer))}prerender(r,o){}render(r,o){if(this.map===void 0)throw new Error("[RadialGradientLayer]: Map is undefined");if(!this.map.isGlobeProjection())return;if(this.plane===void 0)throw new Error("[RadialGradientLayer]: Plane is undefined");r.disable(r.DEPTH_TEST),r.enable(r.BLEND),r.useProgram(this.plane.shaderProgram),r.bindBuffer(r.ARRAY_BUFFER,this.plane.positionBuffer);const h=this.plane.programInfo.attributesLocations.position;r.enableVertexAttribArray(h),r.vertexAttribPointer(h,3,r.FLOAT,!1,0,0);const m=ip(),v=this.scale;TA(m,m,[v,v,v]);const f=ip();wA(f,o.defaultProjectionData.mainMatrix,m);const l=this.plane.programInfo.uniformsLocations.matrix;r.uniformMatrix4fv(l,!1,f);const C=ip(),M=this.map.transform.cameraPosition,R=jg(cf(),M),j=PA(0,1,0),G=cf();qb(G,j,R),jg(G,G);const B=cf();qb(B,R,G),jg(B,B),xA(C,G[0],G[1],G[2],0,B[0],B[1],B[2],0,R[0],R[1],R[2],0,0,0,0,1);const J=this.plane.programInfo.uniformsLocations.rotationMatrix;r.uniformMatrix4fv(J,!1,C);const le=this.gradient.stops.length,we=[],pe=[];for(let xe=0;xe<=le;xe++)if(xe<le){we[xe]=this.gradient.stops[xe][0];const de=uf(this.gradient.stops[xe][1]);pe.push(...de)}r.uniform1i(this.plane.programInfo.uniformsLocations.stopsNumber,le),r.uniform1fv(this.plane.programInfo.uniformsLocations.stops,new Float32Array(we)),r.uniform4fv(this.plane.programInfo.uniformsLocations.colors,new Float32Array(pe)),r.uniform1f(this.plane.programInfo.uniformsLocations.maxDistance,Hh),r.uniform1f(this.plane.programInfo.uniformsLocations.scale,v),r.drawArrays(r.TRIANGLE_STRIP,0,4)}async setGradient(r){if(r===!1){await this.animateOut();return}if(await this.animateOut(),!nE(r)){this.gradient.scale=gl.scale,this.gradient.stops=[[0,"transparent"],[1,"transparent"]];return}r===!0?(this.gradient.scale=gl.scale,this.gradient.stops=gl.stops):(this.gradient.scale=r.scale??gl.scale,this.gradient.stops=r.stops??gl.stops),await this.animateIn()}setAnimationActive(r){this.animationActive=r}show(){this.map.setLayoutProperty(this.id,"visibility","visible")}hide(){this.map.setLayoutProperty(this.id,"visibility","none")}};function nE(i){return typeof i=="boolean"?!0:!(typeof i.scale!="number"||!i.stops||i.stops.length===0||i.stops.some(r=>typeof r[0]!="number"||typeof r[1]!="string"))}const aE={POINT:"POINT",COUNTRY:"COUNTRY"};let h2=class p2 extends ht.Map{constructor(r){MC(r.container),r.apiKey&&(_i.apiKey=r.apiKey);const{style:o,requiresUrlMonitoring:h,isFallback:m}=Bb(r.style);m&&console.warn("Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style."),_i.apiKey||console.warn("MapTiler Cloud API key is not set. Visit https://maptiler.com and try Cloud for free!");const v=location.hash;let f={compact:!1};r.customAttribution?f.customAttribution=r.customAttribution:r.attributionControl&&typeof r.attributionControl=="object"&&(f={...f,...r.attributionControl});const l={...r,style:o,maplibreLogo:!1,transformRequest:gb(r.transformRequest),attributionControl:r.forceNoAttributionControl===!0?!1:f};delete l.style,super(l),tt(this,"telemetry"),tt(this,"space"),tt(this,"halo"),tt(this,"options"),tt(this,"isTerrainEnabled",!1),tt(this,"terrainExaggeration",1),tt(this,"primaryLanguage"),tt(this,"terrainGrowing",!1),tt(this,"terrainFlattening",!1),tt(this,"minimap"),tt(this,"forceLanguageUpdate"),tt(this,"languageAlwaysBeenStyle"),tt(this,"isReady",!1),tt(this,"terrainAnimationDuration",1e3),tt(this,"monitoredStyleUrls"),tt(this,"styleInProcess",!1),tt(this,"curentProjection"),tt(this,"originalLabelStyle",new window.Map),tt(this,"isStyleLocalized",!1),tt(this,"languageIsUpdated",!1),tt(this,"spaceboxLoadingState",{styleLoadCallbackSet:!1}),this.options=r,this.setStyle(o),h&&this.monitorStyleUrl(o);const C=()=>{let B="The distant style could not be loaded.";this.getStyle()?B+="Leaving the style as is.":(this.setStyle(ep.STREETS),B+=`Loading default MapTiler Cloud style "${ep.STREETS.getDefaultVariant().getId()}" as a fallback.`),console.warn(B)};if(this.on("style.load",()=>{this.styleInProcess=!1}),this.on("error",B=>{if(B.error instanceof ht.AJAXError){const J=B.error.url,le=new URL(J);le.search="";const we=le.href;this.monitoredStyleUrls&&this.monitoredStyleUrls.has(we)&&(this.monitoredStyleUrls.delete(we),C());return}if(this.styleInProcess){C();return}}),_i.caching&&!ky&&console.warn("The cache API is only available in secure contexts. More info at https://developer.mozilla.org/en-US/docs/Web/API/Cache"),_i.caching&&ky&&SC(),typeof r.language>"u")this.primaryLanguage=_i.primaryLanguage;else{const B=rb(r.language,rr);this.primaryLanguage=B??_i.primaryLanguage}this.forceLanguageUpdate=!(this.primaryLanguage===rr.STYLE||this.primaryLanguage===rr.STYLE_LOCK),this.languageAlwaysBeenStyle=this.primaryLanguage===rr.STYLE,this.terrainExaggeration=r.terrainExaggeration??this.terrainExaggeration,this.curentProjection=r.projection,this.on("styledata",()=>{this.curentProjection==="mercator"?this.setProjection({type:"mercator"}):this.curentProjection==="globe"&&this.setProjection({type:"globe"})}),this.once("styledata",async()=>{if(!r.geolocate||r.center||r.hash&&v)return;try{if(r.geolocate===aE.COUNTRY){await this.fitToIpBounds();return}}catch(J){console.warn(J.message)}let B;try{await this.centerOnIpPoint(r.zoom),B=this.getCameraHash()}catch(J){console.warn(J.message)}(await navigator.permissions.query({name:"geolocation"})).state==="granted"&&navigator.geolocation.getCurrentPosition(J=>{B===this.getCameraHash()&&(this.terrain?this.easeTo({center:[J.coords.longitude,J.coords.latitude],zoom:r.zoom||12,duration:2e3}):this.once("terrain",()=>{this.easeTo({center:[J.coords.longitude,J.coords.latitude],zoom:r.zoom||12,duration:2e3})}))},null,{maximumAge:24*3600*1e3,timeout:5e3,enableHighAccuracy:!1})}),this.on("styledata",()=>{this.setPrimaryLanguage(this.primaryLanguage)}),this.on("styledata",()=>{this.getTerrain()===null&&this.isTerrainEnabled&&this.enableTerrain(this.terrainExaggeration)}),this.once("load",async()=>{let B={logo:null};try{const J=Object.keys(this.style.sourceCaches).map(we=>this.getSource(we)).filter(we=>we&&"url"in we&&typeof we.url=="string"&&we.url.includes("tiles.json")),le=new URL(J[0].url);le.searchParams.has("key")||le.searchParams.append("key",_i.apiKey),B=await(await fetch(le.href)).json()}catch{}if(r.customControls){const J="[data-maptiler-control-group]",le="[data-maptiler-control]",we=fe=>{let Ae=fe.dataset.maptilerControl;return(Ae==="true"||Ae==="")&&(Ae=void 0),Ae},pe=fe=>fe.dataset.maptilerPosition;let xe=[...this._container.ownerDocument.querySelectorAll(J)],de=[...this._container.ownerDocument.querySelectorAll(le)].filter(fe=>fe.closest(J)===null);if(typeof r.customControls=="string"){const fe=r.customControls;xe=xe.filter(Ae=>Ae.matches(fe)||Ae.closest(fe)!==null),de=de.filter(Ae=>Ae.matches(fe)||Ae.closest(fe)!==null)}for(const fe of xe){const Ae=new Oy(fe);this.addControl(Ae,pe(fe));for(const Fe of fe.querySelectorAll(le))Ae.configureGroupItem(Fe,we(Fe))}for(const fe of de)this.addControl(new Oy(fe,we(fe)),pe(fe));const he=()=>{const{lng:fe,lat:Ae}=this.getCenter();this._container.style.setProperty("--maptiler-center-lng",String(fe)),this._container.style.setProperty("--maptiler-center-lat",String(Ae)),this._container.style.setProperty("--maptiler-zoom",String(this.getZoom())),this._container.style.setProperty("--maptiler-bearing",String(this.getBearing())),this._container.style.setProperty("--maptiler-pitch",String(this.getPitch())),this._container.style.setProperty("--maptiler-roll",String(this.getRoll())),this._container.style.setProperty("--maptiler-is-globe-projection",String(this.isGlobeProjection())),this._container.style.setProperty("--maptiler-has-terrain",String(this.hasTerrain()))};he(),this.on("render",he)}if(r.forceNoAttributionControl!==!0)if("logo"in B&&B.logo){const J=B.logo;this.addControl(new _b({logoURL:J}),r.logoPosition)}else r.maptilerLogo&&this.addControl(new _b,r.logoPosition);if(r.scaleControl){const J=r.scaleControl===!0||r.scaleControl===void 0?"bottom-right":r.scaleControl,le=new $C({unit:_i.unit});this.addControl(le,J),_i.on("unit",we=>{le.setUnit(we)})}if(r.navigationControl!==!1){const J=r.navigationControl===!0||r.navigationControl===void 0?"top-right":r.navigationControl;this.addControl(new mA,J)}if(r.geolocateControl!==!1){const J=r.geolocateControl===!0||r.geolocateControl===void 0?"top-right":r.geolocateControl;this.addControl(new yA({positionOptions:{enableHighAccuracy:!0,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!0,showAccuracyCircle:!0,showUserLocation:!0}),J)}if(r.terrainControl){const J=r.terrainControl===!0||r.terrainControl===void 0?"top-right":r.terrainControl;this.addControl(new fA,J)}if(r.projectionControl){const J=r.projectionControl===!0||r.projectionControl===void 0?"top-right":r.projectionControl;this.addControl(new vA,J)}if(r.fullscreenControl){const J=r.fullscreenControl===!0||r.fullscreenControl===void 0?"top-right":r.fullscreenControl;this.addControl(new NC({}),J)}this.isReady=!0,this.fire("ready",{target:this})});let M=!1,R=!1,j;this.once("ready",()=>{M=!0,R&&this.fire("loadWithTerrain",j)}),this.once("style.load",()=>{const{minimap:B}=r;if(typeof B=="object"){const{zoom:J,center:le,style:we,language:pe,apiKey:xe,maptilerLogo:de,canvasContextAttributes:he,refreshExpiredTiles:fe,maxBounds:Ae,scrollZoom:Fe,minZoom:He,maxZoom:rt,boxZoom:et,locale:It,fadeDuration:bt,crossSourceCollisions:er,clickTolerance:dr,bounds:Lr,fitBoundsOptions:hi,pixelRatio:bi,validateStyle:fr}=r;this.minimap=new Fg(B,{zoom:J,center:le,style:we,language:pe,apiKey:xe,container:"null",maptilerLogo:de,canvasContextAttributes:he,refreshExpiredTiles:fe,maxBounds:Ae,scrollZoom:Fe,minZoom:He,maxZoom:rt,boxZoom:et,locale:It,fadeDuration:bt,crossSourceCollisions:er,clickTolerance:dr,bounds:Lr,fitBoundsOptions:hi,pixelRatio:bi,validateStyle:fr}),this.addControl(this.minimap,B.position??"bottom-left")}else B===!0?(this.minimap=new Fg({},r),this.addControl(this.minimap,"bottom-left")):B!==void 0&&B!==!1&&(this.minimap=new Fg({},r),this.addControl(this.minimap,B))});const G=B=>{B.terrain&&(R=!0,j={type:"loadWithTerrain",target:this,terrain:B.terrain},this.off("terrain",G),M&&this.fire("loadWithTerrain",j))};this.on("terrain",G),r.terrain&&this.enableTerrain(r.terrainExaggeration??this.terrainExaggeration),this.once("load",()=>{this.getCanvas().addEventListener("webglcontextlost",J=>{if(this._removed===!0){console.warn("[webglcontextlost]","WebGL context lost after map removal. This is harmless.");return}console.warn("[webglcontextlost]","Unexpected loss of WebGL context!"),this.fire("webglContextLost",J)});const B=this.getLayersOrder()[0];r.space&&this.initSpace({options:r,before:B}),r.halo&&this.initHalo({options:r,before:B})}),this.telemetry=new bA(this)}getSpace(){return this.space}setSpace(r){if(r===!1){this.space=void 0;return}if(this.isGlobeProjection()){if(this.space){this.space.setCubemap(r),this.getLayer(this.space.id)||this.addLayer(this.space,this.getLayersOrder()[0]);return}this.space=new Ng(r),this.once("load",()=>{const o=this.getLayersOrder()[0];this.space&&this.addLayer(this.space,o)})}}enableSpaceAnimations(){this.setSpaceAnimationActive(!0)}disableSpaceAnimations(){this.setSpaceAnimationActive(!1)}enableHaloAnimations(){this.setHaloAnimationActive(!0)}disableHaloAnimations(){this.setHaloAnimationActive(!1)}setHaloAnimationActive(r){this.halo?this.halo.setAnimationActive(r):this.once("load",()=>{var o;(o=this.halo)==null||o.setAnimationActive(r)})}setSpaceAnimationActive(r){this.space?this.space.setAnimationActive(r):this.once("load",()=>{var o;(o=this.space)==null||o.setAnimationActive(r)})}setSpaceFromStyle({style:r}){var o,h,m;if(this.options.space){this.setSpace(this.options.space);return}const v=(h=(o=r.metadata)==null?void 0:o.maptiler)==null?void 0:h.space;if(!v){this.setSpace({color:"transparent"});return}if(!u2(v)){this.setSpace({color:"transparent"});return}if(JSON.stringify((m=this.space)==null?void 0:m.getConfig())===JSON.stringify(v)){if(this.space&&!this.getLayer(this.space.id)){const f=this.getLayersOrder()[0];this.addLayer(this.space,f)}return}(()=>{if(this.space&&this.isGlobeProjection()){if(!this.getLayer(this.space.id)){const f=this.getLayersOrder()[0];this.addLayer(this.space,f)}this.space.setCubemap(v)}})()}setHaloFromStyle({style:r}){var o,h,m;const v=(o=r.metadata)==null?void 0:o.maptiler;if(JSON.stringify((h=this.halo)==null?void 0:h.getConfig())===JSON.stringify(v?.halo)){if(this.halo&&!this.getLayer(this.halo.id)){const f=this.getLayersOrder().indexOf(((m=this.space)==null?void 0:m.id)??"")+1,l=this.getLayersOrder()[f];this.addLayer(this.halo,l)}return}if(!(v!=null&&v.halo)&&!this.options.halo){this.setHalo({stops:[[0,"transparent"],[1,"transparent"]],scale:1});return}(()=>{var f;if(this.halo){if(!this.getLayer(this.halo.id)){const C=this.getLayersOrder().indexOf(((f=this.space)==null?void 0:f.id)??"")+1,M=this.getLayersOrder()[C];this.addLayer(this.halo,M)}const l=v?.halo??this.options.halo;l&&this.halo.setGradient(l)}})()}initSpace({options:r=this.options,before:o,spec:h}){if(this.space){this.getLayer(this.space.id)||this.addLayer(this.space,o);return}if(r.space===!1)return;const m=h;if(r.space){this.space=new Ng(r.space),this.addLayer(this.space,o);return}m&&(this.space=new Ng(m),this.addLayer(this.space,o))}initHalo({options:r=this.options,before:o,spec:h}){if(this.halo&&this.getLayer(this.halo.id)||r.halo===!1)return;const m=h;if(r.halo){this.halo=new Ug(r.halo),this.addLayer(this.halo,o);return}m&&(this.halo=new Ug(m),this.addLayer(this.halo,o))}getHalo(){return this.halo}setHalo(r){if(this.isGlobeProjection()){if(this.halo){this.halo.setGradient(r);return}this.halo=new Ug(r),this.once("load",()=>{var o;const h=this.getLayersOrder(),m=h[0],v=h.indexOf(((o=this.space)==null?void 0:o.id)??"")+2,f=h[v];this.halo&&this.addLayer(this.halo,this.space?f:m)})}}recreate(){const r={center:this.getCenter(),zoom:this.getZoom(),bearing:this.getBearing(),pitch:this.getPitch()};this.remove(),Object.assign(this,new p2({...this.options})),this.once("load",()=>{this.jumpTo(r)})}setTerrainAnimationDuration(r){this.terrainAnimationDuration=Math.max(r,0)}async onLoadAsync(){return new Promise(r=>{if(this.loaded()){r(this);return}this.once("load",()=>{r(this)})})}async onReadyAsync(){return new Promise(r=>{if(this.isReady){r(this);return}this.once("ready",()=>{r(this)})})}async onLoadWithTerrainAsync(){return new Promise(r=>{if(this.isReady&&this.terrain){r(this);return}this.once("loadWithTerrain",()=>{r(this)})})}monitorStyleUrl(r){typeof this.monitoredStyleUrls>"u"&&(this.monitoredStyleUrls=new Set);const o=new URL(r);o.search="",this.monitoredStyleUrls.add(o.href)}setStyle(r,o){var h,m,v,f,l;this.originalLabelStyle.clear(),(h=this.minimap)==null||h.setStyle(r),this.forceLanguageUpdate=!0,this.once("idle",()=>{this.forceLanguageUpdate=!1});const C=Bb(r);if(C.requiresUrlMonitoring&&this.monitorStyleUrl(C.style),C.isFallback){if(this.getStyle())return console.warn("[Map.setStyle]: Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Keeping the curent style instead."),this;console.warn("[Map.setStyle]: Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style.")}const M=this.getStyle(),R=C.style;try{super.setStyle(C.style,o),this.styleInProcess=!0}catch(B){this.styleInProcess=!1,console.error("[Map.setStyle]: Error while setting style:",B)}const j=()=>{const B=C.style;if(!B.projection||B.projection.type==="mercator"){console.warn("[Map.setStyle]: Neither space nor halo is supported for mercator projection. Ignoring...");return}this.setSpaceFromStyle({style:C.style}),this.setHaloFromStyle({style:C.style})},G=B=>{var J,le,we,pe;const xe=B?.target.getStyle()??C.style,de=this.getLayersOrder()[0];this.space?this.setSpaceFromStyle({style:xe}):this.initSpace({before:de,spec:(le=(J=xe.metadata)==null?void 0:J.maptiler)==null?void 0:le.space}),this.halo?this.setHaloFromStyle({style:xe}):this.initHalo({before:de,spec:(pe=(we=xe.metadata)==null?void 0:we.maptiler)==null?void 0:pe.halo})};if(typeof C.style=="string"||C.requiresUrlMonitoring)return this.on("styledata",G),this;if(this.styleInProcess&&!this.spaceboxLoadingState.styleLoadCallbackSet)return this.once("style.load",G),this.once("styledata",G),this.spaceboxLoadingState.styleLoadCallbackSet=!0,this;if(((m=M?.terrain)==null?void 0:m.source)!==((v=R?.terrain)==null?void 0:v.source)||((f=M?.terrain)==null?void 0:f.exaggeration)!==((l=R?.terrain)==null?void 0:l.exaggeration))return this.once("terrain",j),this;try{G()}catch{}return this}addLayer(r,o){var h;return(h=this.minimap)==null||h.addLayer(r,o),super.addLayer(r,o)}moveLayer(r,o){var h;return(h=this.minimap)==null||h.moveLayer(r,o),super.moveLayer(r,o)}removeLayer(r){var o;return(o=this.minimap)==null||o.removeLayer(r),super.removeLayer(r)}setLayerZoomRange(r,o,h){var m;return(m=this.minimap)==null||m.setLayerZoomRange(r,o,h),super.setLayerZoomRange(r,o,h)}setFilter(r,o,h){var m;return(m=this.minimap)==null||m.setFilter(r,o,h),super.setFilter(r,o,h)}setPaintProperty(r,o,h,m){var v;return(v=this.minimap)==null||v.setPaintProperty(r,o,h,m),super.setPaintProperty(r,o,h,m)}setLayoutProperty(r,o,h,m){var v;return(v=this.minimap)==null||v.setLayoutProperty(r,o,h,m),super.setLayoutProperty(r,o,h,m)}setGlyphs(r,o){var h;return(h=this.minimap)==null||h.setGlyphs(r,o),super.setGlyphs(r,o)}getStyleLanguage(){return!this.style||!this.style.stylesheet||!this.style.stylesheet.metadata||typeof this.style.stylesheet.metadata!="object"?null:"maptiler:language"in this.style.stylesheet.metadata&&typeof this.style.stylesheet.metadata["maptiler:language"]=="string"?by(this.style.stylesheet.metadata["maptiler:language"]):null}setLanguage(r){var o;(o=this.minimap)==null||o.map.setLanguage(r),this.onStyleReady(()=>{this.setPrimaryLanguage(r)})}setPrimaryLanguage(r){const o=this.getStyleLanguage(),h=rb(r,rr);if(!h){console.warn(`The language "${h}" is not supported.`);return}if(!(h.flag===rr.STYLE.flag&&o&&(o.flag===rr.AUTO.flag||o.flag===rr.VISITOR.flag))&&(h.flag!==rr.STYLE.flag&&(this.languageAlwaysBeenStyle=!1),this.languageAlwaysBeenStyle||this.primaryLanguage===h&&!this.forceLanguageUpdate))return;if(this.primaryLanguage.flag===rr.STYLE_LOCK.flag){console.warn("The language cannot be changed because this map has been instantiated with the STYLE_LOCK language flag.");return}this.primaryLanguage=h;let m=h;if(h.flag===rr.STYLE.flag){if(!o){console.warn("The style has no default languages or has an invalid one.");return}m=o}let v=rr.LOCAL.flag,f=["get",v];m.flag===rr.VISITOR.flag?(v=pb().flag,f=["case",["all",["has",v],["has",rr.LOCAL.flag]],["case",["==",["get",v],["get",rr.LOCAL.flag]],["get",rr.LOCAL.flag],["format",["get",v],{"font-scale":.8},`
`,["get",rr.LOCAL.flag],{"font-scale":1.1}]],["get",rr.LOCAL.flag]]):m.flag===rr.VISITOR_ENGLISH.flag?(v=rr.ENGLISH.flag,f=["case",["all",["has",v],["has",rr.LOCAL.flag]],["case",["==",["get",v],["get",rr.LOCAL.flag]],["get",rr.LOCAL.flag],["format",["get",v],{"font-scale":.8},`
`,["get",rr.LOCAL.flag],{"font-scale":1.1}]],["get",rr.LOCAL.flag]]):m.flag===rr.AUTO.flag?(v=pb().flag,f=["coalesce",["get",v],["get",rr.LOCAL.flag]]):m===rr.LOCAL?(v=rr.LOCAL.flag,f=["get",v]):(v=m.flag,f=["coalesce",["get",v],["get",rr.LOCAL.flag]]);const{layers:l}=this.getStyle(),C=this.originalLabelStyle.size===0;if(C){const M=DC(l,this);this.isStyleLocalized=Object.keys(M.localized).length>0}for(const M of l){if(M.type!=="symbol")continue;const R=M,j=this.getSource(R.source);if(!j||!("url"in j&&typeof j.url=="string")||new URL(j.url).host!==cn.maptilerApiHost)continue;const{id:G,layout:B}=R;if(!B||!("text-field"in B))continue;let J;if(C?(J=this.getLayoutProperty(G,"text-field"),this.originalLabelStyle.set(G,J)):J=this.originalLabelStyle.get(G),typeof J=="string"){const{contains:le,exactMatch:we}=EC(J,this.isStyleLocalized);if(!le)continue;if(we)this.setLayoutProperty(G,"text-field",f);else{const pe=IC(J,f,this.isStyleLocalized);this.setLayoutProperty(G,"text-field",pe)}}else{const le=AC(J,f,this.isStyleLocalized);this.setLayoutProperty(G,"text-field",le)}}this.languageIsUpdated=!0}getPrimaryLanguage(){return this.primaryLanguage}getTerrainExaggeration(){return this.terrainExaggeration}hasTerrain(){return this.isTerrainEnabled}growTerrain(r){if(!this.terrain)return;const o=performance.now(),h=this.terrain.exaggeration,m=r-h,v=()=>{if(!this.terrain||this.terrainFlattening)return;const f=(performance.now()-o)/this.terrainAnimationDuration;if(f<.99){const l=1-(1-f)**4,C=h+l*m;this.terrain.exaggeration=C,requestAnimationFrame(v)}else this.terrainGrowing=!1,this.terrainFlattening=!1,this.terrain.exaggeration=r,this.fire("terrainAnimationStop",{terrain:this.terrain});this._elevationFreeze=!1,this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!0,this.terrainFlattening=!1,requestAnimationFrame(v)}enableTerrain(r=this.terrainExaggeration){if(r<0){console.warn("Terrain exaggeration cannot be negative.");return}const o=m=>{!this.terrain||m.type!=="data"||m.dataType!=="source"||!("source"in m)||m.sourceId!=="maptiler-terrain"||m.source.type!=="raster-dem"||m.isSourceLoaded&&(this.off("data",o),this.growTerrain(r))},h=()=>{this.isTerrainEnabled=!0,this.terrainExaggeration=r,this.on("data",o),this.addSource(cn.terrainSourceId,{type:"raster-dem",url:cn.terrainSourceURL}),this.setTerrain({source:cn.terrainSourceId,exaggeration:0})};if(this.getTerrain()){this.isTerrainEnabled=!0,this.growTerrain(r);return}if(this.loaded()||this.isTerrainEnabled)h();else{const m=()=>{this.getTerrain()&&this.getSource(cn.terrainSourceId)||h()};this.once("load",()=>{m()}),this.once("moveend",()=>{m()})}}disableTerrain(){if(!this.terrain)return;this.isTerrainEnabled=!1;const r=performance.now(),o=this.terrain.exaggeration,h=()=>{if(!this.terrain||this.terrainGrowing)return;const m=(performance.now()-r)/this.terrainAnimationDuration;if(this._elevationFreeze=!1,m<.99){const v=(1-m)**4,f=o*v;this.terrain.exaggeration=f,requestAnimationFrame(h)}else this.terrain.exaggeration=0,this.terrainGrowing=!1,this.terrainFlattening=!1,this.setTerrain(),this.getSource(cn.terrainSourceId)&&this.removeSource(cn.terrainSourceId),this.fire("terrainAnimationStop",{terrain:null});this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!1,this.terrainFlattening=!0,requestAnimationFrame(h)}setTerrainExaggeration(r,o=!0){!o&&this.terrain?(this.terrainExaggeration=r,this.terrain.exaggeration=r,this.triggerRepaint()):this.enableTerrain(r)}onStyleReady(r){this.isStyleLoaded()?r():this.once("styledata",()=>{r()})}async fitToIpBounds(){const r=await nb.info();this.fitBounds(r.country_bounds,{duration:0,padding:100})}async centerOnIpPoint(r){const o=await nb.info();this.jumpTo({center:[o.longitude??0,o.latitude??0],zoom:r||11})}getCameraHash(){const r=new Float32Array(5),o=this.getCenter();return r[0]=o.lng,r[1]=o.lat,r[2]=this.getZoom(),r[3]=this.getPitch(),r[4]=this.getBearing(),mC.fromUint8Array(new Uint8Array(r.buffer))}getSdkConfig(){return _i}getMaptilerSessionId(){return c0}setTransformRequest(r){return super.setTransformRequest(gb(r)),this}isGlobeProjection(){const r=this.getProjection();return r?r.type==="globe":!1}enableGlobeProjection(){this.isGlobeProjection()!==!0&&(this.setProjection({type:"globe"}),this.curentProjection="globe")}enableMercatorProjection(){this.isGlobeProjection()!==!1&&(this.setProjection({type:"mercator"}),this.curentProjection="mercator")}isLanguageUpdated(){return this.languageIsUpdated}};ht.Evented;function Qd(i){const r=i.toString(16);return r.length===1?`0${r}`:r}function oE(i){return`#${Qd(i[0])}${Qd(i[1])}${Qd(i[2])}${i.length===4?Qd(i[3]):""}`}let Tt=class ru extends Array{constructor(r={}){super(),tt(this,"min",0),tt(this,"max",1),"min"in r&&(this.min=r.min),"max"in r&&(this.max=r.max),"stops"in r&&this.setStops(r.stops,{clone:!1})}static fromArrayDefinition(r){return new ru({stops:r.map(o=>({value:o[0],color:o[1]}))})}setStops(r,o={clone:!0}){const h=o.clone?this.clone():this;h.length=0;let m=Number.POSITIVE_INFINITY,v=Number.NEGATIVE_INFINITY;for(let f=0;f<r.length;f+=1)m=Math.min(m,r[f].value),v=Math.max(v,r[f].value),h.push({value:r[f].value,color:r[f].color.slice()});return h.sort((f,l)=>f.value<l.value?-1:1),this.min=m,this.max=v,h}scale(r,o,h={clone:!0}){const m=h.clone,v=this[0].value,f=this.at(-1).value-v,l=o-r,C=[];for(let M=0;M<this.length;M+=1){const R=(this[M].value-v)/f*l+r;m?C.push({value:R,color:this[M].color.slice()}):this[M].value=R}return m?new ru({stops:C}):this}at(r){return r<0?this[this.length+r]:this[r]}clone(){return new ru({stops:this.getRawColorStops()})}getRawColorStops(){const r=[];for(let o=0;o<this.length;o+=1)r.push({value:this[o].value,color:this[o].color});return r}reverse(r={clone:!0}){const o=r.clone?this.clone():this;for(let h=0;h<~~(o.length/2);h+=1){const m=o[h].color;o[h].color=o.at(-(h+1)).color,o.at(-(h+1)).color=m}return o}getBounds(){return{min:this.min,max:this.max}}getColor(r,o={smooth:!0}){if(r<=this[0].value)return this[0].color;if(r>=this.at(-1).value)return this.at(-1).color;for(let h=0;h<this.length-1;h+=1){if(r>this[h+1].value)continue;const m=this[h].color;if(!o.smooth)return m.slice();const v=this[h].value,f=this[h+1].value,l=this[h+1].color,C=(f-r)/(f-v);return m.map((M,R)=>Math.round(M*C+l[R]*(1-C)))}return[0,0,0]}getColorHex(r,o={smooth:!0,withAlpha:!1}){return oE(this.getColor(r,o))}getColorRelative(r,o={smooth:!0}){const h=this.getBounds();return this.getColor(h.min+r*(h.max-h.min),o)}getCanvasStrip(r={horizontal:!0,size:512,smooth:!0}){const o=document.createElement("canvas");o.width=r.horizontal?r.size:1,o.height=r.horizontal?1:r.size;const h=o.getContext("2d");if(!h)throw new Error("Canvs context is missing");const m=h.getImageData(0,0,o.width,o.height),v=m.data,f=r.size,l=this[0].value,C=(this.at(-1).value-l)/f;for(let M=0;M<f;M+=1){const R=this.getColor(l+M*C,{smooth:r.smooth});v[M*4]=R[0],v[M*4+1]=R[1],v[M*4+2]=R[2],v[M*4+3]=R.length>3?R[3]:255}return h.putImageData(m,0,0),o}resample(r,o=15){const h=this.getBounds(),m=this.scale(0,1),v=1/(o-1);let f;if(r==="ease-in-square")f=Array.from({length:o},(l,C)=>{const M=C*v,R=M**2,j=m.getColor(R);return{value:M,color:j}});else if(r==="ease-out-square")f=Array.from({length:o},(l,C)=>{const M=C*v,R=1-(1-M)**2,j=m.getColor(R);return{value:M,color:j}});else if(r==="ease-out-sqrt")f=Array.from({length:o},(l,C)=>{const M=C*v,R=M**.5,j=m.getColor(R);return{value:M,color:j}});else if(r==="ease-in-sqrt")f=Array.from({length:o},(l,C)=>{const M=C*v,R=1-(1-M)**.5,j=m.getColor(R);return{value:M,color:j}});else if(r==="ease-out-exp")f=Array.from({length:o},(l,C)=>{const M=C*v,R=1-2**(-10*M),j=m.getColor(R);return{value:M,color:j}});else if(r==="ease-in-exp")f=Array.from({length:o},(l,C)=>{const M=C*v,R=2**(10*M-10),j=m.getColor(R);return{value:M,color:j}});else throw new Error("Invalid ressampling method.");return new ru({stops:f}).scale(h.min,h.max)}transparentStart(){const r=this.getRawColorStops();r.unshift({value:r[0].value,color:r[0].color.slice()}),r[1].value+=.001;for(const o of r)o.color.length===3&&o.color.push(255);return r[0].color[3]=0,new ru({stops:r})}hasTransparentStart(){return this[0].color.length===4&&this[0].color[3]===0}};new Tt({stops:[{value:0,color:[0,0,0,0]},{value:1,color:[0,0,0,0]}]}),new Tt({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),new Tt({stops:[{value:0,color:[0,0,131]},{value:.125,color:[0,60,170]},{value:.375,color:[5,255,255]},{value:.625,color:[255,255,0]},{value:.875,color:[250,0,0]},{value:1,color:[128,0,0]}]}),new Tt({stops:[{value:0,color:[255,0,0]},{value:.169,color:[253,255,2]},{value:.173,color:[247,255,2]},{value:.337,color:[0,252,4]},{value:.341,color:[0,252,10]},{value:.506,color:[1,249,255]},{value:.671,color:[2,0,253]},{value:.675,color:[8,0,253]},{value:.839,color:[255,0,251]},{value:.843,color:[255,0,245]},{value:1,color:[255,0,6]}]}),new Tt({stops:[{value:0,color:[0,0,0]},{value:.3,color:[230,0,0]},{value:.6,color:[255,210,0]},{value:1,color:[255,255,255]}]}),new Tt({stops:[{value:0,color:[255,0,255]},{value:1,color:[255,255,0]}]}),new Tt({stops:[{value:0,color:[0,128,102]},{value:1,color:[255,255,102]}]}),new Tt({stops:[{value:0,color:[255,0,0]},{value:1,color:[255,255,0]}]}),new Tt({stops:[{value:0,color:[0,0,255]},{value:1,color:[0,255,128]}]}),new Tt({stops:[{value:0,color:[0,0,0]},{value:.376,color:[84,84,116]},{value:.753,color:[169,200,200]},{value:1,color:[255,255,255]}]}),new Tt({stops:[{value:0,color:[0,0,0]},{value:.804,color:[255,160,102]},{value:1,color:[255,199,127]}]}),new Tt({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),new Tt({stops:[{value:0,color:[8,29,88]},{value:.125,color:[37,52,148]},{value:.25,color:[34,94,168]},{value:.375,color:[29,145,192]},{value:.5,color:[65,182,196]},{value:.625,color:[127,205,187]},{value:.75,color:[199,233,180]},{value:.875,color:[237,248,217]},{value:1,color:[255,255,217]}]}),new Tt({stops:[{value:0,color:[0,68,27]},{value:.125,color:[0,109,44]},{value:.25,color:[35,139,69]},{value:.375,color:[65,171,93]},{value:.5,color:[116,196,118]},{value:.625,color:[161,217,155]},{value:.75,color:[199,233,192]},{value:.875,color:[229,245,224]},{value:1,color:[247,252,245]}]}),new Tt({stops:[{value:0,color:[128,0,38]},{value:.125,color:[189,0,38]},{value:.25,color:[227,26,28]},{value:.375,color:[252,78,42]},{value:.5,color:[253,141,60]},{value:.625,color:[254,178,76]},{value:.75,color:[254,217,118]},{value:.875,color:[255,237,160]},{value:1,color:[255,255,204]}]}),new Tt({stops:[{value:0,color:[0,0,255]},{value:1,color:[255,0,0]}]}),new Tt({stops:[{value:0,color:[5,10,172]},{value:.35,color:[106,137,247]},{value:.5,color:[190,190,190]},{value:.6,color:[220,170,132]},{value:.7,color:[230,145,90]},{value:1,color:[178,10,28]}]}),new Tt({stops:[{value:0,color:[0,0,255]},{value:.1,color:[51,153,255]},{value:.2,color:[102,204,255]},{value:.3,color:[153,204,255]},{value:.4,color:[204,204,255]},{value:.5,color:[255,255,255]},{value:.6,color:[255,204,255]},{value:.7,color:[255,153,255]},{value:.8,color:[255,102,204]},{value:.9,color:[255,102,102]},{value:1,color:[255,0,0]}]}),new Tt({stops:[{value:0,color:[150,0,90]},{value:.125,color:[0,0,200]},{value:.25,color:[0,25,255]},{value:.375,color:[0,152,255]},{value:.5,color:[44,255,150]},{value:.625,color:[151,255,0]},{value:.75,color:[255,234,0]},{value:.875,color:[255,111,0]},{value:1,color:[255,0,0]}]}),new Tt({stops:[{value:0,color:[12,51,131]},{value:.25,color:[10,136,186]},{value:.5,color:[242,211,56]},{value:.75,color:[242,143,56]},{value:1,color:[217,30,30]}]}),new Tt({stops:[{value:0,color:[0,0,0]},{value:.2,color:[230,0,0]},{value:.4,color:[230,210,0]},{value:.7,color:[255,255,255]},{value:1,color:[160,200,255]}]}),new Tt({stops:[{value:0,color:[0,0,130]},{value:.1,color:[0,180,180]},{value:.2,color:[40,210,40]},{value:.4,color:[230,230,50]},{value:.6,color:[120,70,20]},{value:1,color:[255,255,255]}]}),new Tt({stops:[{value:0,color:[0,0,0]},{value:.15,color:[30,0,100]},{value:.4,color:[120,0,100]},{value:.6,color:[160,90,0]},{value:.8,color:[230,200,0]},{value:1,color:[255,250,220]}]}),new Tt({stops:[{value:0,color:[68,1,84]},{value:.13,color:[71,44,122]},{value:.25,color:[59,81,139]},{value:.38,color:[44,113,142]},{value:.5,color:[33,144,141]},{value:.63,color:[39,173,129]},{value:.75,color:[92,200,99]},{value:.88,color:[170,220,50]},{value:1,color:[253,231,37]}]}),new Tt({stops:[{value:0,color:[0,0,4]},{value:.13,color:[31,12,72]},{value:.25,color:[85,15,109]},{value:.38,color:[136,34,106]},{value:.5,color:[186,54,85]},{value:.63,color:[227,89,51]},{value:.75,color:[249,140,10]},{value:.88,color:[249,201,50]},{value:1,color:[252,255,164]}]}),new Tt({stops:[{value:0,color:[0,0,4]},{value:.13,color:[28,16,68]},{value:.25,color:[79,18,123]},{value:.38,color:[129,37,129]},{value:.5,color:[181,54,122]},{value:.63,color:[229,80,100]},{value:.75,color:[251,135,97]},{value:.88,color:[254,194,135]},{value:1,color:[252,253,191]}]}),new Tt({stops:[{value:0,color:[13,8,135]},{value:.13,color:[75,3,161]},{value:.25,color:[125,3,168]},{value:.38,color:[168,34,150]},{value:.5,color:[203,70,121]},{value:.63,color:[229,107,93]},{value:.75,color:[248,148,65]},{value:.88,color:[253,195,40]},{value:1,color:[240,249,33]}]}),new Tt({stops:[{value:0,color:[125,0,179]},{value:.13,color:[172,0,187]},{value:.25,color:[219,0,170]},{value:.38,color:[255,0,130]},{value:.5,color:[255,63,74]},{value:.63,color:[255,123,0]},{value:.75,color:[234,176,0]},{value:.88,color:[190,228,0]},{value:1,color:[147,255,0]}]}),new Tt({stops:[{value:0,color:[125,0,179]},{value:.13,color:[116,0,218]},{value:.25,color:[98,74,237]},{value:.38,color:[68,146,231]},{value:.5,color:[0,204,197]},{value:.63,color:[0,247,146]},{value:.75,color:[0,255,88]},{value:.88,color:[40,255,8]},{value:1,color:[147,255,0]}]}),new Tt({stops:[{value:0,color:[125,0,179]},{value:.1,color:[199,0,180]},{value:.2,color:[255,0,121]},{value:.3,color:[255,108,0]},{value:.4,color:[222,194,0]},{value:.5,color:[150,255,0]},{value:.6,color:[0,255,55]},{value:.7,color:[0,246,150]},{value:.8,color:[50,167,222]},{value:.9,color:[103,51,235]},{value:1,color:[124,0,186]}]}),new Tt({stops:[{value:0,color:[40,26,44]},{value:.13,color:[59,49,90]},{value:.25,color:[64,76,139]},{value:.38,color:[63,110,151]},{value:.5,color:[72,142,158]},{value:.63,color:[85,174,163]},{value:.75,color:[120,206,163]},{value:.88,color:[187,230,172]},{value:1,color:[253,254,204]}]}),new Tt({stops:[{value:0,color:[47,15,62]},{value:.13,color:[87,23,86]},{value:.25,color:[130,28,99]},{value:.38,color:[171,41,96]},{value:.5,color:[206,67,86]},{value:.63,color:[230,106,84]},{value:.75,color:[242,149,103]},{value:.88,color:[249,193,135]},{value:1,color:[254,237,176]}]}),new Tt({stops:[{value:0,color:[18,36,20]},{value:.13,color:[25,63,41]},{value:.25,color:[24,91,59]},{value:.38,color:[13,119,72]},{value:.5,color:[18,148,80]},{value:.63,color:[80,173,89]},{value:.75,color:[132,196,122]},{value:.88,color:[175,221,162]},{value:1,color:[215,249,208]}]}),new Tt({stops:[{value:0,color:[54,14,36]},{value:.13,color:[89,23,80]},{value:.25,color:[110,45,132]},{value:.38,color:[120,77,178]},{value:.5,color:[120,113,213]},{value:.63,color:[115,151,228]},{value:.75,color:[134,185,227]},{value:.88,color:[177,214,227]},{value:1,color:[230,241,241]}]}),new Tt({stops:[{value:0,color:[30,4,110]},{value:.13,color:[47,14,176]},{value:.25,color:[41,45,236]},{value:.38,color:[25,99,212]},{value:.5,color:[68,131,200]},{value:.63,color:[114,156,197]},{value:.75,color:[157,181,203]},{value:.88,color:[200,208,216]},{value:1,color:[241,237,236]}]}),new Tt({stops:[{value:0,color:[60,9,18]},{value:.13,color:[100,17,27]},{value:.25,color:[142,20,29]},{value:.38,color:[177,43,27]},{value:.5,color:[192,87,63]},{value:.63,color:[205,125,105]},{value:.75,color:[216,162,148]},{value:.88,color:[227,199,193]},{value:1,color:[241,237,236]}]}),new Tt({stops:[{value:0,color:[64,5,5]},{value:.13,color:[106,6,15]},{value:.25,color:[144,26,7]},{value:.38,color:[168,64,3]},{value:.5,color:[188,100,4]},{value:.63,color:[206,136,11]},{value:.75,color:[220,174,25]},{value:.88,color:[231,215,44]},{value:1,color:[248,254,105]}]}),new Tt({stops:[{value:0,color:[51,20,24]},{value:.13,color:[90,32,35]},{value:.25,color:[129,44,34]},{value:.38,color:[159,68,25]},{value:.5,color:[182,99,19]},{value:.63,color:[199,134,22]},{value:.75,color:[212,171,35]},{value:.88,color:[221,210,54]},{value:1,color:[225,253,75]}]}),new Tt({stops:[{value:0,color:[145,105,18]},{value:.13,color:[184,71,38]},{value:.25,color:[186,58,115]},{value:.38,color:[160,71,185]},{value:.5,color:[110,97,218]},{value:.63,color:[50,123,164]},{value:.75,color:[31,131,110]},{value:.88,color:[77,129,34]},{value:1,color:[145,105,18]}]}),new Tt({stops:[{value:0,color:[42,24,108]},{value:.13,color:[33,50,162]},{value:.25,color:[15,90,145]},{value:.38,color:[40,118,137]},{value:.5,color:[59,146,135]},{value:.63,color:[79,175,126]},{value:.75,color:[120,203,104]},{value:.88,color:[193,221,100]},{value:1,color:[253,239,154]}]}),new Tt({stops:[{value:0,color:[4,35,51]},{value:.13,color:[23,51,122]},{value:.25,color:[85,59,157]},{value:.38,color:[129,79,143]},{value:.5,color:[175,95,130]},{value:.63,color:[222,112,101]},{value:.75,color:[249,146,66]},{value:.88,color:[249,196,65]},{value:1,color:[232,250,91]}]}),new Tt({stops:[{value:0,color:[34,31,27]},{value:.13,color:[65,50,41]},{value:.25,color:[98,69,52]},{value:.38,color:[131,89,57]},{value:.5,color:[161,112,59]},{value:.63,color:[185,140,66]},{value:.75,color:[202,174,88]},{value:.88,color:[216,209,126]},{value:1,color:[233,246,171]}]}),new Tt({stops:[{value:0,color:[17,32,64]},{value:.13,color:[35,52,116]},{value:.25,color:[29,81,156]},{value:.38,color:[31,113,162]},{value:.5,color:[50,144,169]},{value:.63,color:[87,173,176]},{value:.75,color:[149,196,189]},{value:.88,color:[203,221,211]},{value:1,color:[254,251,230]}]}),new Tt({stops:[{value:0,color:[23,35,19]},{value:.13,color:[24,64,38]},{value:.25,color:[11,95,45]},{value:.38,color:[39,123,35]},{value:.5,color:[95,146,12]},{value:.63,color:[152,165,18]},{value:.75,color:[201,186,69]},{value:.88,color:[233,216,137]},{value:1,color:[255,253,205]}]}),new Tt({stops:[{value:0,color:[0,0,0]},{value:.07,color:[22,5,59]},{value:.13,color:[60,4,105]},{value:.2,color:[109,1,135]},{value:.27,color:[161,0,147]},{value:.33,color:[210,2,142]},{value:.4,color:[251,11,123]},{value:.47,color:[255,29,97]},{value:.53,color:[255,54,69]},{value:.6,color:[255,85,46]},{value:.67,color:[255,120,34]},{value:.73,color:[255,157,37]},{value:.8,color:[241,191,57]},{value:.87,color:[224,220,93]},{value:.93,color:[218,241,142]},{value:1,color:[227,253,198]}]}),new Tt({stops:[{value:0,color:[0,32,77,255]},{value:.125,color:[5,54,110,255]},{value:.25,color:[65,77,108,255]},{value:.375,color:[97,100,111,255]},{value:.5,color:[125,124,121,255]},{value:.625,color:[156,149,120,255]},{value:.75,color:[190,175,111,255]},{value:.875,color:[225,204,94,255]},{value:1,color:[255,235,70,255]}]}),new Tt({stops:[{value:0,color:[48,18,59,255]},{value:.125,color:[70,107,227,255]},{value:.25,color:[40,187,236,255]},{value:.375,color:[49,242,153,255]},{value:.5,color:[162,252,60,255]},{value:.625,color:[237,208,58,255]},{value:.75,color:[251,128,34,255]},{value:.875,color:[210,49,5,255]},{value:1,color:[122,4,3,255]}]}),new Tt({stops:[{value:0,color:[250,235,221,0]},{value:.133,color:[250,235,221,255]},{value:.266,color:[246,170,130,255]},{value:.4,color:[240,96,67,255]},{value:.533,color:[203,27,79,255]},{value:.666,color:[132,30,90,255]},{value:.8,color:[63,27,68,255]},{value:1,color:[3,5,26,255]}]}),new Tt({stops:[{value:0,color:[11,4,5,255]},{value:.125,color:[43,28,53,255]},{value:.25,color:[62,53,107,255]},{value:.375,color:[59,86,152,255]},{value:.5,color:[53,123,162,255]},{value:.625,color:[53,158,170,255]},{value:.75,color:[73,193,173,255]},{value:.875,color:[150,221,181,255]},{value:1,color:[222,245,229,255]}]});kC();function sE(){return"3.8.0"}ht.Map;ht.Marker;ht.Popup;ht.Style;ht.CanvasSource;ht.GeoJSONSource;ht.ImageSource;ht.RasterTileSource;ht.RasterDEMTileSource;ht.VectorTileSource;ht.VideoSource;ht.NavigationControl;ht.GeolocateControl;ht.AttributionControl;ht.LogoControl;ht.ScaleControl;ht.FullscreenControl;ht.TerrainControl;ht.BoxZoomHandler;ht.ScrollZoomHandler;ht.CooperativeGesturesHandler;ht.KeyboardHandler;ht.TwoFingersTouchPitchHandler;ht.MapWheelEvent;ht.MapTouchEvent;ht.MapMouseEvent;ht.config;ht.getVersion;const{setRTLTextPlugin:oL,getRTLTextPluginStatus:sL,LngLat:lL,LngLatBounds:cL,MercatorCoordinate:uL,Evented:hL,AJAXError:pL,prewarm:dL,clearPrewarmedResources:fL,Hash:mL,Point:gL,EdgeInsets:yL,DragRotateHandler:_L,DragPanHandler:vL,TwoFingersTouchZoomRotateHandler:bL,DoubleClickZoomHandler:xL,TwoFingersTouchZoomHandler:wL,TwoFingersTouchRotateHandler:TL,getWorkerCount:SL,setWorkerCount:kL,getMaxParallelImageRequests:CL,setMaxParallelImageRequests:PL,getWorkerUrl:ML,setWorkerUrl:AL,addSourceType:EL,importScriptInWorkers:IL,addProtocol:zL,removeProtocol:RL}=ht;var lE=Object.defineProperty,cE=(i,r,o)=>r in i?lE(i,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[r]=o,va=(i,r,o)=>(cE(i,typeof r!="symbol"?r+"":r,o),o),uE=8,hE={version:{required:!0,type:"enum",values:[8],doc:"Style specification version number. Must be 8.",example:8},name:{type:"string",doc:"A human-readable name for the style.",example:"Bright"},metadata:{type:"*",doc:"Arbitrary properties useful to track with the stylesheet, but do not influence rendering. Properties should be prefixed to avoid collisions, like 'mapbox:'."},center:{type:"array",value:"number",doc:"Default map center in longitude and latitude.  The style center will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:[-73.9749,40.7736]},zoom:{type:"number",doc:"Default zoom level.  The style zoom will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:12.5},bearing:{type:"number",default:0,period:360,units:"degrees",doc:'Default bearing, in degrees. The bearing is the compass direction that is "up"; for example, a bearing of 90Â° orients the map so that east is up. This value will be used only if the map has not been positioned by other means (e.g. map options or user interaction).',example:29},pitch:{type:"number",default:0,units:"degrees",doc:"Default pitch, in degrees. Zero is perpendicular to the surface, for a look straight down at the map, while a greater value like 60 looks ahead towards the horizon. The style pitch will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:50},light:{type:"light",doc:"The global light source.",example:{anchor:"viewport",color:"white",intensity:.4}},terrain:{type:"terrain",doc:"A global modifier that elevates layers and markers based on a DEM data source."},fog:{type:"fog",doc:"A global effect that fades layers and markers based on their distance to the camera. The fog can be used to approximate the effect of atmosphere on distant objects and enhance the depth perception of the map when used with terrain or 3D features. Note: fog is renamed to atmosphere in the Android and iOS SDKs and planned to be changed in GL-JS v.3.0.0."},sources:{required:!0,type:"sources",doc:"Data source specifications.",example:{"mapbox-streets":{type:"vector",url:"mapbox://mapbox.mapbox-streets-v6"}}},sprite:{type:"string",doc:"A base URL for retrieving the sprite image and metadata. The extensions `.png`, `.json` and scale factor `@2x.png` will be automatically appended. This property is required if any layer uses the `background-pattern`, `fill-pattern`, `line-pattern`, `fill-extrusion-pattern`, or `icon-image` properties. The URL must be absolute, containing the [scheme, authority and path components](https://en.wikipedia.org/wiki/URL#Syntax).",example:"mapbox://sprites/mapbox/bright-v8"},glyphs:{type:"string",doc:"A URL template for loading signed-distance-field glyph sets in PBF format. The URL must include `{fontstack}` and `{range}` tokens. This property is required if any layer uses the `text-field` layout property. The URL must be absolute, containing the [scheme, authority and path components](https://en.wikipedia.org/wiki/URL#Syntax).",example:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},transition:{type:"transition",doc:"A global transition definition to use as a default across properties, to be used for timing transitions between one value and the next when no property-specific transition is set. Collision-based symbol fading is controlled independently of the style's `transition` property.",example:{duration:300,delay:0}},projection:{type:"projection",doc:"The projection the map should be rendered in. Supported projections are Mercator, Globe, Albers, Equal Earth, Equirectangular (WGS84), Lambert conformal conic, Natural Earth, and Winkel Tripel. Terrain, sky and fog are supported by only Mercator and globe. CustomLayerInterface is not supported outside of Mercator.",example:{name:"albers",center:[-154,50],parallels:[55,65]}},layers:{required:!0,type:"array",value:"layer",doc:"Layers will be drawn in the order of this array.",example:[{id:"water",source:"mapbox-streets","source-layer":"water",type:"fill",paint:{"fill-color":"#00ffff"}}]}},pE={"*":{type:"source",doc:"Specification of a data source. For vector and raster sources, either TileJSON or a URL to a TileJSON must be provided. For image and video sources, a URL must be provided. For GeoJSON sources, a URL or inline GeoJSON must be provided."}},dE=["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],fE={type:{required:!0,type:"enum",values:{vector:{doc:"A vector tile source."}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},scheme:{type:"enum",values:{xyz:{doc:"Slippy map tilenames scheme."},tms:{doc:"OSGeo spec scheme."}},default:"xyz",doc:"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},promoteId:{type:"promoteId",doc:"A property to use as a feature id (for feature state). Either a property name, or an object of the form `{<sourceLayer>: <propertyName>}`. If specified as a string for a vector tile source, the same property is used across all its source layers. If specified as an object only specified source layers will have id overriden, others will fallback to original feature id"},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},mE={type:{required:!0,type:"enum",values:{raster:{doc:"A raster tile source."}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",default:512,units:"pixels",doc:"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},scheme:{type:"enum",values:{xyz:{doc:"Slippy map tilenames scheme."},tms:{doc:"OSGeo spec scheme."}},default:"xyz",doc:"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},gE={type:{required:!0,type:"enum",values:{"raster-dem":{doc:"A RGB-encoded raster DEM source"}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",default:512,units:"pixels",doc:"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},encoding:{type:"enum",values:{terrarium:{doc:"Terrarium format PNG tiles. See https://aws.amazon.com/es/public-datasets/terrain/ for more info."},mapbox:{doc:"Mapbox Terrain RGB tiles. See https://www.mapbox.com/help/access-elevation-data/#mapbox-terrain-rgb for more info."}},default:"mapbox",doc:"The encoding used by this source. Mapbox Terrain RGB is used by default"},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},yE={type:{required:!0,type:"enum",values:{geojson:{doc:"A GeoJSON data source."}},doc:"The data type of the GeoJSON source."},data:{type:"*",doc:"A URL to a GeoJSON file, or inline GeoJSON."},maxzoom:{type:"number",default:18,doc:"Maximum zoom level at which to create vector tiles (higher means greater detail at high zoom levels)."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},buffer:{type:"number",default:128,maximum:512,minimum:0,doc:"Size of the tile buffer on each side. A value of 0 produces no buffer. A value of 512 produces a buffer as wide as the tile itself. Larger values produce fewer rendering artifacts near tile edges and slower performance."},filter:{type:"*",doc:"An expression for filtering features prior to processing them for rendering."},tolerance:{type:"number",default:.375,doc:"Douglas-Peucker simplification tolerance (higher means simpler geometries and faster performance)."},cluster:{type:"boolean",default:!1,doc:"If the data is a collection of point features, setting this to true clusters the points by radius into groups. Cluster groups become new `Point` features in the source with additional properties:\n * `cluster` Is `true` if the point is a cluster \n * `cluster_id` A unqiue id for the cluster to be used in conjunction with the [cluster inspection methods](https://www.mapbox.com/mapbox-gl-js/api/#geojsonsource#getclusterexpansionzoom)\n * `point_count` Number of original points grouped into this cluster\n * `point_count_abbreviated` An abbreviated point count"},clusterRadius:{type:"number",default:50,minimum:0,doc:"Radius of each cluster if clustering is enabled. A value of 512 indicates a radius equal to the width of a tile."},clusterMaxZoom:{type:"number",doc:"Max zoom on which to cluster points if clustering is enabled. Defaults to one zoom less than maxzoom (so that last zoom features are not clustered). Clusters are re-evaluated at integer zoom levels so setting clusterMaxZoom to 14 means the clusters will be displayed until z15."},clusterMinPoints:{type:"number",doc:"Minimum number of points necessary to form a cluster if clustering is enabled. Defaults to `2`."},clusterProperties:{type:"*",doc:'An object defining custom properties on the generated clusters if clustering is enabled, aggregating values from clustered points. Has the form `{"property_name": [operator, map_expression]}`. `operator` is any expression function that accepts at least 2 operands (e.g. `"+"` or `"max"`) â it accumulates the property value from clusters/points the cluster contains; `map_expression` produces the value of a single point.\n\nExample: `{"sum": ["+", ["get", "scalerank"]]}`.\n\nFor more advanced use cases, in place of `operator`, you can use a custom reduce expression that references a special `["accumulated"]` value, e.g.:\n`{"sum": [["+", ["accumulated"], ["get", "sum"]], ["get", "scalerank"]]}`'},lineMetrics:{type:"boolean",default:!1,doc:"Whether to calculate line distance metrics. This is required for line layers that specify `line-gradient` values."},generateId:{type:"boolean",default:!1,doc:"Whether to generate ids for the geojson features. When enabled, the `feature.id` property will be auto assigned based on its index in the `features` array, over-writing any previous values."},promoteId:{type:"promoteId",doc:"A property to use as a feature id (for feature state). Either a property name, or an object of the form `{<sourceLayer>: <propertyName>}`."}},_E={type:{required:!0,type:"enum",values:{video:{doc:"A video data source."}},doc:"The data type of the video source."},urls:{required:!0,type:"array",value:"string",doc:"URLs to video content in order of preferred format."},coordinates:{required:!0,doc:"Corners of video specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number",doc:"A single longitude, latitude pair."}}},vE={type:{required:!0,type:"enum",values:{image:{doc:"An image data source."}},doc:"The data type of the image source."},url:{required:!0,type:"string",doc:"URL that points to an image."},coordinates:{required:!0,doc:"Corners of image specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number",doc:"A single longitude, latitude pair."}}},bE={id:{type:"string",doc:"Unique layer name.",required:!0},type:{type:"enum",values:{fill:{doc:"A filled polygon with an optional stroked border.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},line:{doc:"A stroked line.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},symbol:{doc:"An icon or a text label.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},circle:{doc:"A filled circle.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},heatmap:{doc:"A heatmap.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"fill-extrusion":{doc:"An extruded (3D) polygon.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},raster:{doc:"Raster map textures such as satellite imagery.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},hillshade:{doc:"Client-side hillshading visualization based on DEM data. Currently, the implementation only supports Mapbox Terrain RGB and Mapzen Terrarium tiles.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},background:{doc:"The background color or pattern of the map.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},sky:{doc:"A spherical dome around the map that is always rendered behind all other layers.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}}},doc:"Rendering type of this layer.",required:!0},metadata:{type:"*",doc:"Arbitrary properties useful to track with the layer, but do not influence rendering. Properties should be prefixed to avoid collisions, like 'mapbox:'."},source:{type:"string",doc:"Name of a source description to be used for this layer. Required for all layer types except `background`."},"source-layer":{type:"string",doc:"Layer to use from a vector tile source. Required for vector tile sources; prohibited for all other source types, including GeoJSON sources."},minzoom:{type:"number",minimum:0,maximum:24,doc:"The minimum zoom level for the layer. At zoom levels less than the minzoom, the layer will be hidden."},maxzoom:{type:"number",minimum:0,maximum:24,doc:"The maximum zoom level for the layer. At zoom levels equal to or greater than the maxzoom, the layer will be hidden."},filter:{type:"filter",doc:'An expression specifying conditions on source features. Only features that match the filter are displayed. Zoom expressions in filters are only evaluated at integer zoom levels. The `["feature-state", ...]` expression is not supported in filter expressions.  The `["pitch"]` and `["distance-from-center"]` expressions are supported only for filter expressions on the symbol layer.'},layout:{type:"layout",doc:"Layout properties for the layer."},paint:{type:"paint",doc:"Default paint properties for this layer."}},xE=["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],wE={visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},TE={visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"constant"}},SE={"fill-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"},"data-driven styling":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},kE={"circle-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.2.0",ios:"5.9.0",macos:"0.16.0"},"data-driven styling":{js:"1.2.0",android:"9.2.0",ios:"5.9.0",macos:"0.16.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},CE={visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},"property-type":"constant"}},PE={"line-cap":{type:"enum",values:{butt:{doc:"A cap with a squared-off end which is drawn to the exact endpoint of the line."},round:{doc:"A cap with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},square:{doc:"A cap with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."}},default:"butt",doc:"The display of line endings.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{doc:"A join with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."},round:{doc:"A join with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},miter:{doc:"A join with a sharp, angled corner which is drawn with the outer sides beyond the endpoint of the path until they meet."}},default:"miter",doc:"The display of lines when joining.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,doc:"Used to automatically convert miter joins to bevel joins for sharp angles.",requires:[{"line-join":"miter"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,doc:"Used to automatically convert round joins to miter joins for shallow angles.",requires:[{"line-join":"round"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"},"data-driven styling":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},ME={"symbol-placement":{type:"enum",values:{point:{doc:"The label is placed at the point where the geometry is located."},line:{doc:"The label is placed along the line of the geometry. Can only be used on `LineString` and `Polygon` geometries."},"line-center":{doc:"The label is placed at the center of the line of the geometry. Can only be used on `LineString` and `Polygon` geometries. Note that a single feature in a vector tile may contain multiple line geometries."}},default:"point",doc:"Label placement relative to its geometry.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`line-center` value":{js:"0.47.0",android:"6.4.0",ios:"4.3.0",macos:"0.10.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",doc:"Distance between two symbol anchors.",requires:[{"symbol-placement":"line"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,doc:"If true, the symbols will not cross tile edges to avoid mutual collisions. Recommended in layers that don't have enough padding in the vector tile to prevent collisions, or if it is a point symbol layer placed after a line symbol layer. When using a client that supports global collision detection, like Mapbox GL JS version 0.42.0 or greater, enabling this property is not needed to prevent clipped labels at tile boundaries.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with lower sort keys are drawn and placed first.  When `icon-allow-overlap` or `text-allow-overlap` is `false`, features with a lower sort key will have priority during placement. When `icon-allow-overlap` or `text-allow-overlap` is set to `true`, features with a higher sort key will overlap over features with a lower sort key.","sdk-support":{"basic functionality":{js:"0.53.0",android:"7.4.0",ios:"4.11.0",macos:"0.14.0"},"data-driven styling":{js:"0.53.0",android:"7.4.0",ios:"4.11.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{doc:"Sorts symbols by `symbol-sort-key` if set. Otherwise, sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},"viewport-y":{doc:"Sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},source:{doc:"Sorts symbols by `symbol-sort-key` if set. Otherwise, no sorting is applied; symbols are rendered in the same order as the source data."}},default:"auto",doc:"Determines whether overlapping symbols in the same layer are rendered in the order that they appear in the data source or by their y-position relative to the viewport. To control the order and prioritization of symbols otherwise, use `symbol-sort-key`.","sdk-support":{"basic functionality":{js:"0.49.0",android:"6.6.0",ios:"4.5.0",macos:"0.12.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,doc:"If true, the icon will be visible even if it collides with other previously drawn symbols.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,doc:"If true, other symbols can be visible even if they collide with the icon.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,doc:"If true, text will display without their corresponding icons when the icon collides with other symbols and the text does not.",requires:["icon-image","text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{doc:"When `symbol-placement` is set to `point`, aligns icons east-west. When `symbol-placement` is set to `line` or `line-center`, aligns icon x-axes with the line."},viewport:{doc:"Produces icons whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{doc:"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto",doc:"In combination with `symbol-placement`, determines the rotation behavior of icons.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",doc:"Scales the original size of the icon by the provided factor. The new pixel size of the image will be the original pixel size multiplied by `icon-size`. 1 is the original size; 3 triples the size of the image.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{doc:"The icon is displayed at its intrinsic aspect ratio."},width:{doc:"The icon is scaled in the x-dimension to fit the width of the text."},height:{doc:"The icon is scaled in the y-dimension to fit the height of the text."},both:{doc:"The icon is scaled in both x- and y-dimensions."}},default:"none",doc:"Scales the icon to fit around the associated text.",requires:["icon-image","text-field"],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"},"stretchable icons":{js:"1.6.0",android:"9.2.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",doc:"Size of the additional area added to dimensions determined by `icon-text-fit`, in clockwise order: top, right, bottom, left.",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",doc:"Name of image in sprite to use for drawing an image background.",tokens:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",doc:"Rotates the icon clockwise.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.21.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",doc:"Size of the additional area around the icon bounding box used for detecting symbol collisions.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,doc:"If true, the icon may be flipped to prevent it from being rendered upside-down.",requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],doc:"Offset distance of icon from its anchor. Positive values indicate right and down, while negative values indicate left and up. Each component is multiplied by the value of `icon-size` to obtain the final offset in pixels. When combined with `icon-rotate` the offset will be as if the rotated direction was up.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{doc:"The center of the icon is placed closest to the anchor."},left:{doc:"The left side of the icon is placed closest to the anchor."},right:{doc:"The right side of the icon is placed closest to the anchor."},top:{doc:"The top of the icon is placed closest to the anchor."},bottom:{doc:"The bottom of the icon is placed closest to the anchor."},"top-left":{doc:"The top left corner of the icon is placed closest to the anchor."},"top-right":{doc:"The top right corner of the icon is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the icon is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the icon is placed closest to the anchor."}},default:"center",doc:"Part of the icon placed closest to the anchor.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{doc:"The icon is aligned to the plane of the map."},viewport:{doc:"The icon is aligned to the plane of the viewport."},auto:{doc:"Automatically matches the value of `icon-rotation-alignment`."}},default:"auto",doc:"Orientation of icon when map is pitched.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{doc:"The text is aligned to the plane of the map."},viewport:{doc:"The text is aligned to the plane of the viewport."},auto:{doc:"Automatically matches the value of `text-rotation-alignment`."}},default:"auto",doc:"Orientation of text when map is pitched.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{doc:"When `symbol-placement` is set to `point`, aligns text east-west. When `symbol-placement` is set to `line` or `line-center`, aligns text x-axes with the line."},viewport:{doc:"Produces glyphs whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{doc:"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto",doc:"In combination with `symbol-placement`, determines the rotation behavior of the individual glyphs forming the text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,doc:"Value to use for a text label. If a plain `string` is provided, it will be treated as a `formatted` with default/inherited formatting options. SDF images are not supported in formatted text and will be ignored.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],doc:"Font stack to use for displaying text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",doc:"Font size.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",doc:"The maximum line width for text wrapping.",requires:["text-field",{"symbol-placement":["point"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",doc:"Text leading value for multi-line text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0",android:"10.0.0",ios:"10.0.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",doc:"Text tracking amount.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{doc:"The text is aligned towards the anchor position."},left:{doc:"The text is aligned to the left."},center:{doc:"The text is centered."},right:{doc:"The text is aligned to the right."}},default:"center",doc:"Text justification options.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"},auto:{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,doc:"Radial offset of text, in the direction of the symbol's anchor. Useful in combination with `text-variable-anchor`, which defaults to using the two-dimensional `text-offset` if present.","sdk-support":{"basic functionality":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"},"data-driven styling":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{doc:"The center of the text is placed closest to the anchor."},left:{doc:"The left side of the text is placed closest to the anchor."},right:{doc:"The right side of the text is placed closest to the anchor."},top:{doc:"The top of the text is placed closest to the anchor."},bottom:{doc:"The bottom of the text is placed closest to the anchor."},"top-left":{doc:"The top left corner of the text is placed closest to the anchor."},"top-right":{doc:"The top right corner of the text is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the text is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the text is placed closest to the anchor."}},requires:["text-field",{"symbol-placement":["point"]}],doc:"To increase the chance of placing high-priority labels on the map, you can provide an array of `text-anchor` locations: the renderer will attempt to place the label at each location, in order, before moving onto the next label. Use `text-justify: auto` to choose justification based on anchor position. To apply an offset, use the `text-radial-offset` or the two-dimensional `text-offset`.","sdk-support":{"basic functionality":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{doc:"The center of the text is placed closest to the anchor."},left:{doc:"The left side of the text is placed closest to the anchor."},right:{doc:"The right side of the text is placed closest to the anchor."},top:{doc:"The top of the text is placed closest to the anchor."},bottom:{doc:"The bottom of the text is placed closest to the anchor."},"top-left":{doc:"The top left corner of the text is placed closest to the anchor."},"top-right":{doc:"The top right corner of the text is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the text is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the text is placed closest to the anchor."}},default:"center",doc:"Part of the text placed closest to the anchor.",requires:["text-field",{"!":"text-variable-anchor"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",doc:"Maximum angle change between adjacent characters.",requires:["text-field",{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{doc:"If a text's language supports horizontal writing mode, symbols would be laid out horizontally."},vertical:{doc:"If a text's language supports vertical writing mode, symbols would be laid out vertically."}},doc:"The property allows control over a symbol's orientation. Note that the property values act as a hint, so that a symbol whose language doesnât support the provided orientation will be laid out in its natural orientation. Example: English point symbol will be rendered horizontally even if array value contains single 'vertical' enum value. For symbol with point placement, the order of elements in an array define priority order for the placement of an orientation variant. For symbol with line placement, the default text writing mode is either ['horizontal', 'vertical'] or ['vertical', 'horizontal'], the order doesn't affect the placement.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"1.3.0",android:"8.3.0",ios:"5.3.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",doc:"Rotates the text clockwise.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",doc:"Size of the additional area around the text bounding box used for detecting symbol collisions.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,doc:"If true, the text may be flipped vertically to prevent it from being rendered upside-down.",requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{doc:"The text is not altered."},uppercase:{doc:"Forces all letters to be displayed in uppercase."},lowercase:{doc:"Forces all letters to be displayed in lowercase."}},default:"none",doc:"Specifies how to capitalize text, similar to the CSS `text-transform` property.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",doc:"Offset distance of text from its anchor. Positive values indicate right and down, while negative values indicate left and up. If used with text-variable-anchor, input values will be taken as absolute values. Offsets along the x- and y-axis will be applied automatically based on the anchor position.",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,doc:"If true, the text will be visible even if it collides with other previously drawn symbols.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,doc:"If true, other symbols can be visible even if they collide with the text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,doc:"If true, icons will display without their corresponding text when the text collides with other symbols and the icon does not.",requires:["text-field","icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},AE={visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},EE={visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},"property-type":"constant"}},IE={type:"array",value:"*",doc:"A filter selects specific features from a layer."},zE={type:"boolean",doc:'Expression which determines whether or not to display a symbol. Symbols support dynamic filtering, meaning this expression can use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature","pitch","distance-from-center"]}},RE={type:"boolean",doc:'Expression which determines whether or not to display a polygon. Fill layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},LE={type:"boolean",doc:'Expression which determines whether or not to display a Polygon or LineString. Line layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},DE={type:"boolean",doc:'Expression which determines whether or not to display a circle. Circle layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},FE={type:"boolean",doc:'Expression used to determine whether a point is being displayed or not. Heatmap layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},jE={type:"enum",values:{"==":{doc:'`["==", key, value]` equality: `feature[key] = value`'},"!=":{doc:'`["!=", key, value]` inequality: `feature[key] â  value`'},">":{doc:'`[">", key, value]` greater than: `feature[key] > value`'},">=":{doc:'`[">=", key, value]` greater than or equal: `feature[key] â¥ value`'},"<":{doc:'`["<", key, value]` less than: `feature[key] < value`'},"<=":{doc:'`["<=", key, value]` less than or equal: `feature[key] â¤ value`'},in:{doc:'`["in", key, v0, ..., vn]` set inclusion: `feature[key] â {v0, ..., vn}`'},"!in":{doc:'`["!in", key, v0, ..., vn]` set exclusion: `feature[key] â {v0, ..., vn}`'},all:{doc:'`["all", f0, ..., fn]` logical `AND`: `f0 â§ ... â§ fn`'},any:{doc:'`["any", f0, ..., fn]` logical `OR`: `f0 â¨ ... â¨ fn`'},none:{doc:'`["none", f0, ..., fn]` logical `NOR`: `Â¬f0 â§ ... â§ Â¬fn`'},has:{doc:'`["has", key]` `feature[key]` exists'},"!has":{doc:'`["!has", key]` `feature[key]` does not exist'},within:{doc:'`["within", object]` feature geometry is within object geometry'}},doc:"The filter operator."},OE={type:"enum",values:{Point:{doc:"Filter to point geometries."},LineString:{doc:"Filter to line geometries."},Polygon:{doc:"Filter to polygon geometries."}},doc:"The geometry type for the filter to select."},BE={type:"array",minimum:0,maximum:24,value:["number","color"],length:2,doc:"Zoom level and value pair."},$E={type:"array",value:"*",minimum:1,doc:"An expression defines a function that can be used for data-driven style properties or feature filters."},NE={doc:"",type:"enum",values:{let:{doc:'Binds expressions to named variables, which can then be referenced in the result expression using ["var", "variable_name"].',group:"Variable binding","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},var:{doc:'References variable bound using "let".',group:"Variable binding","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},literal:{doc:"Provides a literal array or object value.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},array:{doc:"Asserts that the input is an array (optionally with a specific item type and length).  If, when the input expression is evaluated, it is not of the asserted type, then this assertion will cause the whole expression to be aborted.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},at:{doc:"Retrieves an item from an array.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},in:{doc:"Determines whether an item exists in an array or a substring exists in a string. In the specific case when the second and third arguments are string literals, you must wrap at least one of them in a [`literal`](#types-literal) expression to hint correct interpretation to the [type system](#type-system).",group:"Lookup","sdk-support":{"basic functionality":{js:"1.6.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}}},"index-of":{doc:"Returns the first position at which an item can be found in an array or a substring can be found in a string, or `-1` if the input cannot be found. Accepts an optional index from where to begin the search.",group:"Lookup","sdk-support":{"basic functionality":{js:"1.10.0",android:"10.0.0",ios:"10.0.0"}}},slice:{doc:"Returns an item from an array or a substring from a string from a specified start index, or between a start index and an end index if set. The return value is inclusive of the start index but not of the end index.",group:"Lookup","sdk-support":{"basic functionality":{js:"1.10.0",android:"10.0.0",ios:"10.0.0"}}},case:{doc:"Selects the first output whose corresponding test condition evaluates to true, or the fallback value otherwise.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},match:{doc:'Selects the output for which the label value matches the input value, or the fallback value if no match is found. The input can be any expression (for example, `["get", "building_type"]`). Each label must be unique, and must be either:\n - a single literal value; or\n - an array of literal values, the values of which must be all strings or all numbers (for example `[100, 101]` or `["c", "b"]`).\n\nThe input matches if any of the values in the array matches using strict equality, similar to the `"in"` operator.\nIf the input type does not match the type of the labels, the result will be the fallback value.',group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},coalesce:{doc:"Evaluates each expression in turn until the first valid value is obtained. Invalid values are `null` and [`'image'`](#types-image) expressions that are unavailable in the style. If all values are invalid, `coalesce` returns the first value listed.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},step:{doc:'Produces discrete, stepped results by evaluating a piecewise-constant function defined by pairs of input and output values ("stops"). The `input` may be any numeric expression (e.g., `["get", "population"]`). Stop inputs must be numeric literals in strictly ascending order. Returns the output value of the stop just less than the input, or the first output if the input is less than the first stop.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},interpolate:{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). The `input` may be any numeric expression (e.g., `["get", "population"]`). Stop inputs must be numeric literals in strictly ascending order. The output type must be `number`, `array<number>`, or `color`.\n\nInterpolation types:\n- `["linear"]`: Interpolates linearly between the pair of stops just less than and just greater than the input.\n- `["exponential", base]`: Interpolates exponentially between the stops just less than and just greater than the input. `base` controls the rate at which the output increases: higher values make the output increase more towards the high end of the range. With values close to 1 the output increases linearly.\n- `["cubic-bezier", x1, y1, x2, y2]`: Interpolates using the cubic bezier curve defined by the given control points.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"interpolate-hcl":{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). Works like `interpolate`, but the output type must be `color`, and the interpolation is performed in the Hue-Chroma-Luminance color space.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.49.0"}}},"interpolate-lab":{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). Works like `interpolate`, but the output type must be `color`, and the interpolation is performed in the CIELAB color space.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.49.0"}}},ln2:{doc:"Returns mathematical constant ln(2).",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},pi:{doc:"Returns the mathematical constant pi.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},e:{doc:"Returns the mathematical constant e.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},typeof:{doc:"Returns a string describing the type of the given value.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},string:{doc:"Asserts that the input value is a string. If multiple values are provided, each one is evaluated in order until a string is obtained. If none of the inputs are strings, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},number:{doc:"Asserts that the input value is a number. If multiple values are provided, each one is evaluated in order until a number is obtained. If none of the inputs are numbers, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},boolean:{doc:"Asserts that the input value is a boolean. If multiple values are provided, each one is evaluated in order until a boolean is obtained. If none of the inputs are booleans, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},object:{doc:"Asserts that the input value is an object. If multiple values are provided, each one is evaluated in order until an object is obtained. If none of the inputs are objects, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},collator:{doc:"Returns a `collator` for use in locale-dependent comparison operations. The `case-sensitive` and `diacritic-sensitive` options default to `false`. The `locale` argument specifies the IETF language tag of the locale to use. If none is provided, the default locale is used. If the requested locale is not available, the `collator` will use a system-defined fallback locale. Use `resolved-locale` to test the results of locale fallback behavior.",group:"Types","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},format:{doc:'Returns a `formatted` string for displaying mixed-format text in the `text-field` property. The input may contain a string literal or expression, including an [`\'image\'`](#types-image) expression. Strings may be followed by a style override object that supports the following properties:\n- `"text-font"`: Overrides the font stack specified by the root layout property.\n- `"text-color"`: Overrides the color specified by the root paint property.\n- `"font-scale"`: Applies a scaling factor on `text-size` as specified by the root layout property.',group:"Types","sdk-support":{"basic functionality":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"text-font":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"font-scale":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"text-color":{js:"1.3.0",android:"7.3.0",ios:"4.10.0",macos:"0.14.0"},image:{js:"1.6.0",android:"8.6.0",ios:"5.7.0",macos:"0.15.0"}}},image:{doc:"Returns a [`ResolvedImage`](/mapbox-gl-js/style-spec/types/#resolvedimage) for use in [`icon-image`](/mapbox-gl-js/style-spec/layers/#layout-symbol-icon-image), `*-pattern` entries, and as a section in the [`'format'`](#types-format) expression. A [`'coalesce'`](#coalesce) expression containing `image` expressions will evaluate to the first listed image that is currently in the style. This validation process is synchronous and requires the image to have been added to the style before requesting it in the `'image'` argument.",group:"Types","sdk-support":{"basic functionality":{js:"1.4.0",android:"8.6.0",ios:"5.7.0",macos:"0.15.0"}}},"number-format":{doc:"Converts the input number into a string representation using the providing formatting rules. If set, the `locale` argument specifies the locale to use, as a BCP 47 language tag. If set, the `currency` argument specifies an ISO 4217 code to use for currency-style formatting. If set, the `unit` argument specifies a [simple ECMAScript unit](https://tc39.es/proposal-unified-intl-numberformat/section6/locales-currencies-tz_proposed_out.html#sec-issanctionedsimpleunitidentifier) to use for unit-style formatting. If set, the `min-fraction-digits` and `max-fraction-digits` arguments specify the minimum and maximum number of fractional digits to include.",group:"Types","sdk-support":{"basic functionality":{js:"0.54.0",android:"8.4.0",ios:"5.4.0",macos:"0.15.0"}}},"to-string":{doc:'Converts the input value to a string. If the input is `null`, the result is `""`. If the input is a [`boolean`](#types-boolean), the result is `"true"` or `"false"`. If the input is a number, it is converted to a string as specified by the ["NumberToString" algorithm](https://tc39.github.io/ecma262/#sec-tostring-applied-to-the-number-type) of the ECMAScript Language Specification. If the input is a [`color`](#color), it is converted to a string of the form `"rgba(r,g,b,a)"`, where `r`, `g`, and `b` are numerals ranging from 0 to 255, and `a` ranges from 0 to 1. If the input is an [`\'image\'`](#types-image) expression, `\'to-string\'` returns the image name. Otherwise, the input is converted to a string in the format specified by the [`JSON.stringify`](https://tc39.github.io/ecma262/#sec-json.stringify) function of the ECMAScript Language Specification.',group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-number":{doc:'Converts the input value to a number, if possible. If the input is `null` or `false`, the result is 0. If the input is `true`, the result is 1. If the input is a string, it is converted to a number as specified by the ["ToNumber Applied to the String Type" algorithm](https://tc39.github.io/ecma262/#sec-tonumber-applied-to-the-string-type) of the ECMAScript Language Specification. If multiple values are provided, each one is evaluated in order until the first successful conversion is obtained. If none of the inputs can be converted, the expression is an error.',group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-boolean":{doc:"Converts the input value to a boolean. The result is `false` when then input is an empty string, 0, `false`, `null`, or `NaN`; otherwise it is `true`.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-rgba":{doc:"Returns a four-element array containing the input color's red, green, blue, and alpha components, in that order.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-color":{doc:"Converts the input value to a color. If multiple values are provided, each one is evaluated in order until the first successful conversion is obtained. If none of the inputs can be converted, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},rgb:{doc:"Creates a color value from red, green, and blue components, which must range between 0 and 255, and an alpha component of 1. If any component is out of range, the expression is an error.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},rgba:{doc:"Creates a color value from red, green, blue components, which must range between 0 and 255, and an alpha component which must range between 0 and 1. If any component is out of range, the expression is an error.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},get:{doc:"Retrieves a property value from the current feature's properties, or from another object if a second argument is provided. Returns `null` if the requested property is missing.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},has:{doc:"Tests for the presence of an property value in the current feature's properties, or from another object if a second argument is provided.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},length:{doc:"Returns the length of an array or string.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},properties:{doc:'Returns the feature properties object.  Note that in some cases, it may be more efficient to use `["get", "property_name"]` directly.',group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"feature-state":{doc:"Retrieves a property value from the current feature's state. Returns `null` if the requested property is not present on the feature's state. A feature's state is not part of the GeoJSON or vector tile data, and must be set programmatically on each feature. Features are identified by their `id` attribute, which must be an integer or a string that can be cast to an integer. Note that [\"feature-state\"] can only be used with paint properties that support data-driven styling.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.46.0",android:"10.0.0",ios:"10.0.0"}}},"geometry-type":{doc:"Returns the feature's geometry type: `Point`, `LineString` or `Polygon`. `Multi*` feature types return the singular forms.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},id:{doc:"Returns the feature's id, if it has one.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},zoom:{doc:'Returns the current zoom level.  Note that in style layout and paint properties, ["zoom"] may only appear as the input to a top-level "step" or "interpolate" expression.',group:"Camera","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},pitch:{doc:'Returns the current pitch in degrees. `["pitch"]` may only be used in the `filter` expression for a `symbol` layer.',group:"Camera","sdk-support":{"basic functionality":{js:"2.6.0",android:"10.9.0",ios:"10.9.0"}}},"distance-from-center":{doc:'Returns the distance of a `symbol` instance from the center of the map. The distance is measured in pixels divided by the height of the map container. It measures 0 at the center, decreases towards the camera and increase away from the camera. For example, if the height of the map is 1000px, a value of -1 means 1000px away from the center towards the camera, and a value of 1 means a distance of 1000px away from the camera from the center. `["distance-from-center"]` may only be used in the `filter` expression for a `symbol` layer.',group:"Camera","sdk-support":{"basic functionality":{js:"2.6.0",android:"10.9.0",ios:"10.9.0"}}},"heatmap-density":{doc:"Returns the kernel density estimation of a pixel in a heatmap layer, which is a relative measure of how many data points are crowded around a particular pixel. Can only be used in the `heatmap-color` property.",group:"Heatmap","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"line-progress":{doc:"Returns the progress along a gradient line. Can only be used in the `line-gradient` property.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.6.0",macos:"0.12.0"}}},"sky-radial-progress":{doc:"Returns the distance of a point on the sky from the sun position. Returns 0 at sun position and 1 when the distance reaches `sky-gradient-radius`. Can only be used in the `sky-gradient` property.",group:"sky","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}},accumulated:{doc:"Returns the value of a cluster property accumulated so far. Can only be used in the `clusterProperties` option of a clustered GeoJSON source.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.53.0",android:"8.4.0",ios:"5.5.0",macos:"0.15.0"}}},"+":{doc:"Returns the sum of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"*":{doc:"Returns the product of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"-":{doc:"For two inputs, returns the result of subtracting the second input from the first. For a single input, returns the result of subtracting it from 0.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"/":{doc:"Returns the result of floating point division of the first input by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"%":{doc:"Returns the remainder after integer division of the first input by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"^":{doc:"Returns the result of raising the first input to the power specified by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},sqrt:{doc:"Returns the square root of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},log10:{doc:"Returns the base-ten logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},ln:{doc:"Returns the natural logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},log2:{doc:"Returns the base-two logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},sin:{doc:"Returns the sine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},cos:{doc:"Returns the cosine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},tan:{doc:"Returns the tangent of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},asin:{doc:"Returns the arcsine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},acos:{doc:"Returns the arccosine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},atan:{doc:"Returns the arctangent of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},min:{doc:"Returns the minimum value of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},max:{doc:"Returns the maximum value of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},round:{doc:'Rounds the input to the nearest integer. Halfway values are rounded away from zero. For example, `["round", -1.5]` evaluates to -2.',group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},abs:{doc:"Returns the absolute value of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},ceil:{doc:"Returns the smallest integer that is greater than or equal to the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},floor:{doc:"Returns the largest integer that is less than or equal to the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},distance:{doc:"Returns the shortest distance in meters between the evaluated feature and the input geometry. The input value can be a valid GeoJSON of type `Point`, `MultiPoint`, `LineString`, `MultiLineString`, `Polygon`, `MultiPolygon`, `Feature`, or `FeatureCollection`. Distance values returned may vary in precision due to loss in precision from encoding geometries, particularly below zoom level 13.",group:"Math","sdk-support":{"basic functionality":{android:"9.2.0",ios:"5.9.0",macos:"0.16.0"}}},"==":{doc:"Returns `true` if the input values are equal, `false` otherwise. The comparison is strictly typed: values of different runtime types are always considered unequal. Cases where the types are known to be different at parse time are considered invalid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"!=":{doc:"Returns `true` if the input values are not equal, `false` otherwise. The comparison is strictly typed: values of different runtime types are always considered unequal. Cases where the types are known to be different at parse time are considered invalid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},">":{doc:"Returns `true` if the first input is strictly greater than the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"<":{doc:"Returns `true` if the first input is strictly less than the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},">=":{doc:"Returns `true` if the first input is greater than or equal to the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"<=":{doc:"Returns `true` if the first input is less than or equal to the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},all:{doc:"Returns `true` if all the inputs are `true`, `false` otherwise. The inputs are evaluated in order, and evaluation is short-circuiting: once an input expression evaluates to `false`, the result is `false` and no further input expressions are evaluated.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},any:{doc:"Returns `true` if any of the inputs are `true`, `false` otherwise. The inputs are evaluated in order, and evaluation is short-circuiting: once an input expression evaluates to `true`, the result is `true` and no further input expressions are evaluated.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"!":{doc:"Logical negation. Returns `true` if the input is `false`, and `false` if the input is `true`.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},within:{doc:"Returns `true` if the evaluated feature is fully contained inside a boundary of the input geometry, `false` otherwise. The input value can be a valid GeoJSON of type `Polygon`, `MultiPolygon`, `Feature`, or `FeatureCollection`. Supported features for evaluation:\n- `Point`: Returns `false` if a point is on the boundary or falls outside the boundary.\n- `LineString`: Returns `false` if any part of a line falls outside the boundary, the line intersects the boundary, or a line's endpoint is on the boundary.",group:"Decision","sdk-support":{"basic functionality":{js:"1.9.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}}},"is-supported-script":{doc:"Returns `true` if the input string is expected to render legibly. Returns `false` if the input string contains sections that cannot be rendered without potential loss of meaning (e.g. Indic scripts that require complex text shaping, or right-to-left scripts if the the `mapbox-gl-rtl-text` plugin is not in use in Mapbox GL JS).",group:"String","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.6.0",ios:"4.1.0",macos:"0.8.0"}}},upcase:{doc:"Returns the input string converted to uppercase. Follows the Unicode Default Case Conversion algorithm and the locale-insensitive case mappings in the Unicode Character Database.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},downcase:{doc:"Returns the input string converted to lowercase. Follows the Unicode Default Case Conversion algorithm and the locale-insensitive case mappings in the Unicode Character Database.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},concat:{doc:"Returns a `string` consisting of the concatenation of the inputs. Each input is converted to a string as if by `to-string`.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"resolved-locale":{doc:"Returns the IETF language tag of the locale being used by the provided `collator`. This can be used to determine the default system locale, or to determine if a requested locale was successfully loaded.",group:"String","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}}}},UE={range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},doc:"The start and end distance range in which fog fades from fully transparent to fully opaque. The distance to the point at the center of the map is defined as zero, so that negative range values are closer to the camera, and positive values are farther away.",example:[.5,10],"sdk-support":{"basic functionality":{js:"2.3.0",android:"10.6.0",ios:"10.6.0"}}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"The color of the atmosphere region immediately below the horizon and within the `range` and above the horizon and within `horizon-blend`. Using opacity is recommended only for smoothly transitioning fog on/off as anything less than 100% opacity results in more tiles loaded and drawn.","sdk-support":{"basic functionality":{js:"2.3.0",android:"10.6.0",ios:"10.6.0"}}},"high-color":{type:"color","property-type":"data-constant",default:"#245cdf",expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"The color of the atmosphere region above the horizon, `high-color` extends further above the horizon than the `color` property and its spread can be controlled with `horizon-blend`. The opacity can be set to `0` to remove the high atmosphere color contribution.","sdk-support":{"basic functionality":{js:"2.9.0",android:"10.6.0",ios:"10.6.0"}}},"space-color":{type:"color","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"The color of the region above the horizon and after the end of the `horizon-blend` contribution. The opacity can be set to `0` to have a transparent background.","sdk-support":{"basic functionality":{js:"2.9.0",android:"10.6.0",ios:"10.6.0"}}},"horizon-blend":{type:"number","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],4,.2,7,.1],minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Horizon blend applies a smooth fade from the color of the atmosphere to the color of space. A value of zero leaves a sharp transition from atmosphere to space. Increasing the value blends the color of atmosphere into increasingly high angles of the sky.","sdk-support":{"basic functionality":{js:"2.3.0",android:"10.6.0",ios:"10.6.0"}}},"star-intensity":{type:"number","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],5,.35,6,0],minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"A value controlling the star intensity where `0` will show no stars and `1` will show stars at their maximum intensity.","sdk-support":{"basic functionality":{js:"2.9.0",android:"10.6.0",ios:"10.6.0"}}}},VE={anchor:{type:"enum",default:"viewport",values:{map:{doc:"The position of the light source is aligned to the rotation of the map."},viewport:{doc:"The position of the light source is aligned to the rotation of the viewport."}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]},doc:"Whether extruded geometries are lit relative to the map or viewport.",example:"map","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},doc:"Position of the light source relative to lit (extruded) geometries, in [r radial coordinate, a azimuthal angle, p polar angle] where r indicates the distance from the center of the base of an object to its light, a indicates the position of the light relative to 0Â° (0Â° when `light.anchor` is set to `viewport` corresponds to the top of the viewport, or 0Â° when `light.anchor` is set to `map` corresponds to due north, and degrees proceed clockwise), and p indicates the height of the light (from 0Â°, directly above, to 180Â°, directly below).",example:[1.5,90,80],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Color tint for lighting extruded geometries.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Intensity of lighting (on a scale from 0 to 1). Higher numbers will present as more extreme contrast.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}}},qE={name:{type:"enum",values:{albers:{doc:"An Albers equal-area projection centered on the continental United States. You can configure the projection for a different region by setting `center` and `parallels` properties. You may want to set max bounds to constrain the map to the relevant region."},equalEarth:{doc:"An Equal Earth projection."},equirectangular:{doc:"An Equirectangular projection. This projection is very similar to the Plate CarrÃ©e projection."},lambertConformalConic:{doc:"A Lambert conformal conic projection. You can configure the projection for a region by setting `center` and `parallels` properties. You may want to set max bounds to constrain the map to the relevant region."},mercator:{doc:"The Mercator projection is the default projection."},naturalEarth:{doc:"A Natural Earth projection."},winkelTripel:{doc:"A Winkel Tripel projection."},globe:{doc:"A globe projection."}},default:"mercator",doc:"The name of the projection to be used for rendering the map.",required:!0,"sdk-support":{"basic functionality":{js:"2.6.0"}}},center:{type:"array",length:2,value:"number","property-type":"data-constant",minimum:[-180,-90],maximum:[180,90],transition:!1,doc:"The reference longitude and latitude of the projection. `center` takes the form of [lng, lat]. This property is only configurable for conic projections (Albers and Lambert Conformal Conic). All other projections are centered on [0, 0].",example:[-96,37.5],requires:[{name:["albers","lambertConformalConic"]}],"sdk-support":{"basic functionality":{js:"2.6.0"}}},parallels:{type:"array",length:2,value:"number","property-type":"data-constant",minimum:[-90,-90],maximum:[90,90],transition:!1,doc:"The standard parallels of the projection, denoting the desired latitude range with minimal distortion. `parallels` takes the form of [lat0, lat1]. This property is only configurable for conic projections (Albers and Lambert Conformal Conic).",example:[29.5,45.5],requires:[{name:["albers","lambertConformalConic"]}],"sdk-support":{"basic functionality":{js:"2.6.0"}}}},GE={source:{type:"string",doc:"Name of a source of `raster_dem` type to be used for terrain elevation.",required:!0,"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Exaggerates the elevation of the terrain by multiplying the data from the DEM with this value.",requires:["source"],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}}},ZE=["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],WE={"fill-antialias":{type:"boolean",default:!0,doc:"Whether or not the fill should be antialiased.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire fill layer. In contrast to the `fill-color`, this value will also affect the 1px stroke around the fill, if the stroke is used.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.21.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",doc:"The color of the filled part of this layer. This color can be specified as `rgba` with an alpha component and the color's opacity will not affect the opacity of the 1px stroke, if it is used.",transition:!0,requires:[{"!":"fill-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.19.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",doc:"The outline color of the fill. Matches the value of `fill-color` if unspecified.",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.19.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{doc:"The fill is translated relative to the map."},viewport:{doc:"The fill is translated relative to the viewport."}},doc:"Controls the frame of reference for `fill-translate`.",default:"map",requires:["fill-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!1,doc:"Name of image in sprite to use for drawing image fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"}},HE={"line-opacity":{type:"number",doc:"The opacity at which the line will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",doc:"The color with which the line will be drawn.",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.23.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{doc:"The line is translated relative to the map."},viewport:{doc:"The line is translated relative to the viewport."}},doc:"Controls the frame of reference for `line-translate`.",default:"map",requires:["line-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",doc:"Stroke thickness.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,doc:"Draws a line casing outside of a line's actual path. Value indicates the width of the inner gap.",transition:!0,units:"pixels","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,doc:"The line's offset. For linear features, a positive value offsets the line to the right, relative to the direction of the line, and a negative value to the left. For polygon features, a positive value results in an inset, and a negative value results in an outset.",transition:!0,units:"pixels","sdk-support":{"basic functionality":{js:"0.12.1",android:"3.0.0",ios:"3.1.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Blur applied to the line, in pixels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",doc:"Specifies the lengths of the alternating dashes and gaps that form the dash pattern. The lengths are later scaled by the line width. To convert a dash length to pixels, multiply the length by the current line width. Note that GeoJSON sources with `lineMetrics: true` specified won't render dashed lines to the expected scale. Also note that zoom-dependent expressions will be evaluated only at integer zoom levels.",minimum:0,transition:!1,units:"line widths",requires:[{"!":"line-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{type:"resolvedImage",transition:!1,doc:"Name of image in sprite to use for drawing image lines. For seamless patterns, image width must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{type:"color",doc:'Defines a gradient with which to color a line feature. Can only be used with GeoJSON sources that specify `"lineMetrics": true`.',transition:!1,requires:[{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],"sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.4.0",macos:"0.11.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{type:"array",value:"number",doc:"The line part between [trim-start, trim-end] will be marked as transparent to make a route vanishing effect. The line trim-off offset is based on the whole line range [0.0, 1.0].",length:2,default:[0,0],minimum:[0,0],maximum:[1,1],transition:!1,requires:[{source:"geojson",has:{lineMetrics:!0}}],"sdk-support":{"basic functionality":{js:"2.9.0",android:"10.5.0",ios:"10.5.0",macos:"10.5.0"}},"property-type":"constant"}},XE={"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",doc:"Circle radius.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.18.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",doc:"The fill color of the circle.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.18.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,doc:"Amount to blur the circle. 1 blurs the circle such that only the centerpoint is full opacity.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.20.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",doc:"The opacity at which the circle will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.20.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{doc:"The circle is translated relative to the map."},viewport:{doc:"The circle is translated relative to the viewport."}},doc:"Controls the frame of reference for `circle-translate`.",default:"map",requires:["circle-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{doc:"Circles are scaled according to their apparent distance to the camera."},viewport:{doc:"Circles are not scaled."}},default:"map",doc:"Controls the scaling behavior of the circle when the map is pitched.","sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{doc:"The circle is aligned to the plane of the map."},viewport:{doc:"The circle is aligned to the plane of the viewport."}},default:"viewport",doc:"Orientation of circle when map is pitched.","sdk-support":{"basic functionality":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"The width of the circle's stroke. Strokes are placed outside of the `circle-radius`.","sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",doc:"The stroke color of the circle.",transition:!0,"sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",doc:"The opacity of the circle's stroke.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},KE={"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",doc:"Radius of influence of one heatmap point in pixels. Increasing the value makes the heatmap smoother, but less detailed. `queryRenderedFeatures` on heatmap layers will return points within this radius.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,doc:"A measure of how much an individual point contributes to the heatmap. A value of 10 would be equivalent to having 10 points of weight 1 in the same spot. Especially useful when combined with clustering.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,doc:"Similar to `heatmap-weight` but controls the intensity of the heatmap globally. Primarily used for adjusting the heatmap based on zoom level.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],doc:'Defines the color of each pixel based on its density value in a heatmap.  Should be an expression that uses `["heatmap-density"]` as input.',transition:!1,"sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",doc:"The global opacity at which the heatmap layer will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},YE={"icon-opacity":{doc:"The opacity at which the icon will be drawn.",type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,doc:"The color of the icon. This can only be used with [SDF icons](/help/troubleshooting/using-recolorable-images-in-mapbox-maps/).",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,doc:"The color of the icon's halo. Icon halos can only be used with [SDF icons](/help/troubleshooting/using-recolorable-images-in-mapbox-maps/).",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Distance of halo to the icon outline.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Fade out the halo towards the outside.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"Distance that the icon's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{doc:"Icons are translated relative to the map."},viewport:{doc:"Icons are translated relative to the viewport."}},doc:"Controls the frame of reference for `icon-translate`.",default:"map",requires:["icon-image","icon-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",doc:"The opacity at which the text will be drawn.",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",doc:"The color with which the text will be drawn.",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,doc:"The color of the text's halo, which helps it stand out from backgrounds.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Distance of halo to the font outline. Max text halo width is 1/4 of the font-size.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"The halo's fadeout distance towards the outside.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"Distance that the text's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{doc:"The text is translated relative to the map."},viewport:{doc:"The text is translated relative to the viewport."}},doc:"Controls the frame of reference for `text-translate`.",default:"map",requires:["text-field","text-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},JE={"raster-opacity":{type:"number",doc:"The opacity at which the image will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",doc:"Rotates hues around the color wheel.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",doc:"Increase or reduce the brightness of the image. The value is the minimum brightness.",default:0,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",doc:"Increase or reduce the brightness of the image. The value is the maximum brightness.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",doc:"Increase or reduce the saturation of the image.",default:0,minimum:-1,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",doc:"Increase or reduce the contrast of the image.",default:0,minimum:-1,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",doc:"The resampling/interpolation method to use for overscaling, also known as texture magnification filter",values:{linear:{doc:"(Bi)linear filtering interpolates pixel values using the weighted average of the four closest original source pixels creating a smooth but blurry look when overscaled"},nearest:{doc:"Nearest neighbor filtering interpolates pixel values using the nearest original source pixel creating a sharp but pixelated look when overscaled"}},default:"linear","sdk-support":{"basic functionality":{js:"0.47.0",android:"6.3.0",ios:"4.2.0",macos:"0.9.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",doc:"Fade duration when a new tile is added.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},QE={"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,doc:"The direction of the light source used to generate the hillshading with 0 as the top of the viewport if `hillshade-illumination-anchor` is set to `viewport` and due north if `hillshade-illumination-anchor` is set to `map`.",transition:!1,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{doc:"The hillshade illumination is relative to the north direction."},viewport:{doc:"The hillshade illumination is relative to the top of the viewport."}},default:"viewport",doc:"Direction of light source when map is rotated.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",doc:"Intensity of the hillshade",default:.5,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",doc:"The shading color of areas that face away from the light source.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",doc:"The shading color of areas that faces towards the light source.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",doc:"The shading color used to accentuate rugged terrain like sharp cliffs and gorges.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},eI={"background-color":{type:"color",default:"#000000",doc:"The color with which the background will be drawn.",transition:!0,requires:[{"!":"background-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!1,doc:"Name of image in sprite to use for drawing an image background. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity at which the background will be drawn.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},tI={"sky-type":{type:"enum",values:{gradient:{doc:"Renders the sky with a gradient that can be configured with `sky-gradient-radius` and `sky-gradient`."},atmosphere:{doc:"Renders the sky with a simulated atmospheric scattering algorithm, the sun direction can be attached to the light position or explicitly set through `sky-atmosphere-sun`."}},default:"atmosphere",doc:"The type of the sky","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,doc:"Position of the sun center [a azimuthal angle, p polar angle]. The azimuthal angle indicates the position of the sun relative to 0Â° north, where degrees proceed clockwise. The polar angle indicates the height of the sun, where 0Â° is directly above, at zenith, and 90Â° at the horizon. When this property is ommitted, the sun center is directly inherited from the light position.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,doc:"Intensity of the sun as a light source in the atmosphere (on a scale from 0 to a 100). Setting higher values will brighten up the sky.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,doc:"Position of the gradient center [a azimuthal angle, p polar angle]. The azimuthal angle indicates the position of the gradient center relative to 0Â° north, where degrees proceed clockwise. The polar angle indicates the height of the gradient center, where 0Â° is directly above, at zenith, and 90Â° at the horizon.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,doc:"The angular distance (measured in degrees) from `sky-gradient-center` up to which the gradient extends. A value of 180 causes the gradient to wrap around to the opposite direction from `sky-gradient-center`.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],doc:"Defines a radial color gradient with which to color the sky. The color values can be interpolated with an expression using `sky-radial-progress`. The range [0, 1] for the interpolant covers a radial distance (in degrees) of [0, `sky-gradient-radius`] centered at the position specified by `sky-gradient-center`.",transition:!1,requires:[{"sky-type":"gradient"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",doc:"A color applied to the atmosphere sun halo. The alpha channel describes how strongly the sun halo is represented in an atmosphere sky layer.",transition:!1,requires:[{"sky-type":"atmosphere"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",doc:"A color used to tweak the main atmospheric scattering coefficients. Using white applies the default coefficients giving the natural blue color to the atmosphere. This color affects how heavily the corresponding wavelength is represented during scattering. The alpha channel describes the density of the atmosphere, with 1 maximum density and 0 no density.",transition:!1,requires:[{"sky-type":"atmosphere"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire sky layer.",transition:!0,"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},rI={duration:{type:"number",default:300,minimum:0,units:"milliseconds",doc:"Time allotted for transitions to complete."},delay:{type:"number",default:0,minimum:0,units:"milliseconds",doc:"Length of time before a transition begins."}},iI={"*":{type:"string",doc:"A name of a feature property to use as ID for feature state."}},nI={$version:uE,$root:hE,sources:pE,source:dE,source_vector:fE,source_raster:mE,source_raster_dem:gE,source_geojson:yE,source_video:_E,source_image:vE,layer:bE,layout:xE,layout_background:wE,layout_sky:TE,layout_fill:SE,layout_circle:kE,layout_heatmap:CE,"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},"property-type":"constant"},"fill-extrusion-edge-radius":{type:"number",private:!0,default:0,minimum:0,maximum:1,doc:"Radius of a fill extrusion edge in meters. If not zero, rounds extrusion edges for a smoother appearance.","sdk-support":{"basic functionality":{js:"v2.10.0",android:"10.7.0",ios:"10.7.0"}},"property-type":"constant"}},layout_line:PE,layout_symbol:ME,layout_raster:AE,layout_hillshade:EE,filter:IE,filter_symbol:zE,filter_fill:RE,filter_line:LE,filter_circle:DE,"filter_fill-extrusion":{type:"boolean",doc:'Expression which determines whether or not to display a Polygon. Fill-extrusion layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_heatmap:FE,filter_operator:jE,geometry_type:OE,function:{expression:{type:"expression",doc:"An expression."},stops:{type:"array",doc:"An array of stops.",value:"function_stop"},base:{type:"number",default:1,minimum:0,doc:"The exponential base of the interpolation curve. It controls the rate at which the result increases. Higher values make the result increase more towards the high end of the range. With `1` the stops are interpolated linearly."},property:{type:"string",doc:"The name of a feature property to use as the function input.",default:"$zoom"},type:{type:"enum",values:{identity:{doc:"Return the input value as the output value."},exponential:{doc:"Generate an output by interpolating between stops just less than and just greater than the function input."},interval:{doc:"Return the output value of the stop just less than the function input."},categorical:{doc:"Return the output value of the stop equal to the function input."}},doc:"The interpolation strategy to use in function evaluation.",default:"exponential"},colorSpace:{type:"enum",values:{rgb:{doc:"Use the RGB color space to interpolate color values"},lab:{doc:"Use the LAB color space to interpolate color values."},hcl:{doc:"Use the HCL color space to interpolate color values, interpolating the Hue, Chroma, and Luminance channels individually."}},doc:"The color space in which colors interpolated. Interpolating colors in perceptual color spaces like LAB and HCL tend to produce color ramps that look more consistent and produce colors that can be differentiated more easily than those interpolated in RGB space.",default:"rgb"},default:{type:"*",required:!1,doc:`A value to serve as a fallback function result when a value isn't otherwise available. It is used in the following circumstances:
* In categorical functions, when the feature value does not match any of the stop domain values.
* In property and zoom-and-property functions, when a feature does not contain a value for the specified property.
* In identity functions, when the feature value is not valid for the style property (for example, if the function is being used for a \`circle-color\` property but the feature property value is not a string or not a valid color).
* In interval or exponential property and zoom-and-property functions, when the feature value is not numeric.
If no default is provided, the style property's default is used in these circumstances.`}},function_stop:BE,expression:$E,expression_name:NE,fog:UE,light:VE,projection:qE,terrain:GE,paint:ZE,paint_fill:WE,"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire fill extrusion layer. This is rendered on a per-layer, not per-feature, basis, and data-driven styling is not available.",transition:!0,"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",doc:"The base color of the extruded fill. The extrusion's surfaces will be shaded differently based on this color in combination with the root `light` settings. If this color is specified as `rgba` with an alpha component, the alpha component will be ignored; use `fill-extrusion-opacity` to set layer opacity.",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up (on the flat plane), respectively.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{doc:"The fill extrusion is translated relative to the map."},viewport:{doc:"The fill extrusion is translated relative to the viewport."}},doc:"Controls the frame of reference for `fill-extrusion-translate`.",default:"map",requires:["fill-extrusion-translate"],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!1,doc:"Name of image in sprite to use for drawing images on extruded fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",doc:"The height with which to extrude this layer.",transition:!0,"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",doc:"The height with which to extrude the base of this layer. Must be less than or equal to `fill-extrusion-height`.",transition:!0,requires:["fill-extrusion-height"],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,doc:"Whether to apply a vertical gradient to the sides of a fill-extrusion layer. If true, sides will be shaded slightly darker farther down.",transition:!1,"sdk-support":{"basic functionality":{js:"0.50.0",android:"7.0.0",ios:"4.7.0",macos:"0.13.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant",type:"number",private:!0,default:0,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Controls the intensity of shading near ground and concave angles between walls. Default value 0.0 disables ambient occlusion and values around 0.3 provide the most plausible results for buildings.","sdk-support":{"basic functionality":{js:"2.10.0",android:"10.7.0",ios:"10.7.0"}}},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant",type:"number",private:!0,default:3,minimum:0,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Shades area near ground and concave angles between walls where the radius defines only vertical impact. Default value 3.0 corresponds to height of one floor and brings the most plausible results for buildings.",requires:["fill-extrusion-edge-radius"],"sdk-support":{"basic functionality":{js:"2.10.0",android:"10.7.0",ios:"10.7.0"}}}},paint_line:HE,paint_circle:XE,paint_heatmap:KE,paint_symbol:YE,paint_raster:JE,paint_hillshade:QE,paint_background:eI,paint_sky:tI,transition:rI,"property-type":{"data-driven":{type:"property-type",doc:"Property is interpolable and can be represented using a property expression."},"color-ramp":{type:"property-type",doc:"Property should be specified using a color ramp from which the output color can be sampled based on a property calculation."},"data-constant":{type:"property-type",doc:"Property is interpolable but cannot be represented using a property expression."},constant:{type:"property-type",doc:"Property is constant across all zoom levels and property values."}},promoteId:iI},Vg=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},By={exports:{}};/*! https://mths.be/punycode v1.3.2 by @mathias */(function(i,r){(function(o){var h=r&&!r.nodeType&&r,m=i&&!i.nodeType&&i,v=typeof Vg=="object"&&Vg;(v.global===v||v.window===v||v.self===v)&&(o=v);var f,l=2147483647,C=36,M=1,R=26,j=38,G=700,B=72,J=128,le="-",we=/^xn--/,pe=/[^\x20-\x7E]/,xe=/[\x2E\u3002\uFF0E\uFF61]/g,de={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},he=C-M,fe=Math.floor,Ae=String.fromCharCode,Fe;function He(Qe){throw RangeError(de[Qe])}function rt(Qe,lt){for(var xt=Qe.length,gt=[];xt--;)gt[xt]=lt(Qe[xt]);return gt}function et(Qe,lt){var xt=Qe.split("@"),gt="";xt.length>1&&(gt=xt[0]+"@",Qe=xt[1]),Qe=Qe.replace(xe,".");var yt=Qe.split("."),Kt=rt(yt,lt).join(".");return gt+Kt}function It(Qe){for(var lt=[],xt=0,gt=Qe.length,yt,Kt;xt<gt;)yt=Qe.charCodeAt(xt++),yt>=55296&&yt<=56319&&xt<gt?(Kt=Qe.charCodeAt(xt++),(Kt&64512)==56320?lt.push(((yt&1023)<<10)+(Kt&1023)+65536):(lt.push(yt),xt--)):lt.push(yt);return lt}function bt(Qe){return rt(Qe,function(lt){var xt="";return lt>65535&&(lt-=65536,xt+=Ae(lt>>>10&1023|55296),lt=56320|lt&1023),xt+=Ae(lt),xt}).join("")}function er(Qe){return Qe-48<10?Qe-22:Qe-65<26?Qe-65:Qe-97<26?Qe-97:C}function dr(Qe,lt){return Qe+22+75*(Qe<26)-((lt!=0)<<5)}function Lr(Qe,lt,xt){var gt=0;for(Qe=xt?fe(Qe/G):Qe>>1,Qe+=fe(Qe/lt);Qe>he*R>>1;gt+=C)Qe=fe(Qe/he);return fe(gt+(he+1)*Qe/(Qe+j))}function hi(Qe){var lt=[],xt=Qe.length,gt,yt=0,Kt=J,Et=B,br,nr,Mr,xi,Tr,gr,Yt,ar,Hr;for(br=Qe.lastIndexOf(le),br<0&&(br=0),nr=0;nr<br;++nr)Qe.charCodeAt(nr)>=128&&He("not-basic"),lt.push(Qe.charCodeAt(nr));for(Mr=br>0?br+1:0;Mr<xt;){for(xi=yt,Tr=1,gr=C;Mr>=xt&&He("invalid-input"),Yt=er(Qe.charCodeAt(Mr++)),(Yt>=C||Yt>fe((l-yt)/Tr))&&He("overflow"),yt+=Yt*Tr,ar=gr<=Et?M:gr>=Et+R?R:gr-Et,!(Yt<ar);gr+=C)Hr=C-ar,Tr>fe(l/Hr)&&He("overflow"),Tr*=Hr;gt=lt.length+1,Et=Lr(yt-xi,gt,xi==0),fe(yt/gt)>l-Kt&&He("overflow"),Kt+=fe(yt/gt),yt%=gt,lt.splice(yt++,0,Kt)}return bt(lt)}function bi(Qe){var lt,xt,gt,yt,Kt,Et,br,nr,Mr,xi,Tr,gr=[],Yt,ar,Hr,qi;for(Qe=It(Qe),Yt=Qe.length,lt=J,xt=0,Kt=B,Et=0;Et<Yt;++Et)Tr=Qe[Et],Tr<128&&gr.push(Ae(Tr));for(gt=yt=gr.length,yt&&gr.push(le);gt<Yt;){for(br=l,Et=0;Et<Yt;++Et)Tr=Qe[Et],Tr>=lt&&Tr<br&&(br=Tr);for(ar=gt+1,br-lt>fe((l-xt)/ar)&&He("overflow"),xt+=(br-lt)*ar,lt=br,Et=0;Et<Yt;++Et)if(Tr=Qe[Et],Tr<lt&&++xt>l&&He("overflow"),Tr==lt){for(nr=xt,Mr=C;xi=Mr<=Kt?M:Mr>=Kt+R?R:Mr-Kt,!(nr<xi);Mr+=C)qi=nr-xi,Hr=C-xi,gr.push(Ae(dr(xi+qi%Hr,0))),nr=fe(qi/Hr);gr.push(Ae(dr(nr,0))),Kt=Lr(xt,ar,gt==yt),xt=0,++gt}++xt,++lt}return gr.join("")}function fr(Qe){return et(Qe,function(lt){return we.test(lt)?hi(lt.slice(4).toLowerCase()):lt})}function At(Qe){return et(Qe,function(lt){return pe.test(lt)?"xn--"+bi(lt):lt})}if(f={version:"1.3.2",ucs2:{decode:It,encode:bt},decode:hi,encode:bi,toASCII:At,toUnicode:fr},h&&m)if(i.exports==h)m.exports=f;else for(Fe in f)f.hasOwnProperty(Fe)&&(h[Fe]=f[Fe]);else o.punycode=f})(Vg)})(By,By.exports);By.exports;function d2(i,...r){for(const o of r)for(const h in o)i[h]=o[h];return i}class aI extends Error{constructor(r,o){super(o),this.message=o,this.key=r}}var to=aI;class k0{constructor(r,o=[]){this.parent=r,this.bindings={};for(const[h,m]of o)this.bindings[h]=m}concat(r){return new k0(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return this.bindings[r]?!0:this.parent?this.parent.has(r):!1}}var oI=k0;const Jf={kind:"null"},Ke={kind:"number"},Gt={kind:"string"},$t={kind:"boolean"},$o={kind:"color"},fu={kind:"object"},Nt={kind:"value"},sI={kind:"error"},Qf={kind:"collator"},em={kind:"formatted"},zp={kind:"resolvedImage"};function ta(i,r){return{kind:"array",itemType:i,N:r}}function Rr(i){if(i.kind==="array"){const r=Rr(i.itemType);return typeof i.N=="number"?`array<${r}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${r}>`}else return i.kind}const lI=[Jf,Ke,Gt,$t,$o,em,fu,ta(Nt),zp];function vp(i,r){if(r.kind==="error")return null;if(i.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!vp(i.itemType,r.itemType))&&(typeof i.N!="number"||i.N===r.N))return null}else{if(i.kind===r.kind)return null;if(i.kind==="value"){for(const o of lI)if(!vp(o,r))return null}}return`Expected ${Rr(i)} but found ${Rr(r)} instead.`}function C0(i,r){return r.some(o=>o.kind===i.kind)}function bp(i,r){return r.some(o=>o==="null"?i===null:o==="array"?Array.isArray(i):o==="object"?i&&!Array.isArray(i)&&typeof i=="object":o===typeof i)}var cI={},f2,n1={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function np(i){return i=Math.round(i),i<0?0:i>255?255:i}function a1(i){return i<0?0:i>1?1:i}function qg(i){return i[i.length-1]==="%"?np(parseFloat(i)/100*255):np(parseInt(i))}function ef(i){return i[i.length-1]==="%"?a1(parseFloat(i)/100):a1(parseFloat(i))}function Gg(i,r,o){return o<0?o+=1:o>1&&(o-=1),o*6<1?i+(r-i)*o*6:o*2<1?r:o*3<2?i+(r-i)*(2/3-o)*6:i}function uI(i){var r=i.replace(/ /g,"").toLowerCase();if(r in n1)return n1[r].slice();if(r[0]==="#"){if(r.length===4){var o=parseInt(r.substr(1),16);return o>=0&&o<=4095?[(o&3840)>>4|(o&3840)>>8,o&240|(o&240)>>4,o&15|(o&15)<<4,1]:null}else if(r.length===7){var o=parseInt(r.substr(1),16);return o>=0&&o<=16777215?[(o&16711680)>>16,(o&65280)>>8,o&255,1]:null}return null}var h=r.indexOf("("),m=r.indexOf(")");if(h!==-1&&m+1===r.length){var v=r.substr(0,h),f=r.substr(h+1,m-(h+1)).split(","),l=1;switch(v){case"rgba":if(f.length!==4)return null;l=ef(f.pop());case"rgb":return f.length!==3?null:[qg(f[0]),qg(f[1]),qg(f[2]),l];case"hsla":if(f.length!==4)return null;l=ef(f.pop());case"hsl":if(f.length!==3)return null;var C=(parseFloat(f[0])%360+360)%360/360,M=ef(f[1]),R=ef(f[2]),j=R<=.5?R*(M+1):R+M-R*M,G=R*2-j;return[np(Gg(G,j,C+1/3)*255),np(Gg(G,j,C)*255),np(Gg(G,j,C-1/3)*255),l];default:return null}}return null}try{f2=cI.parseCSSColor=uI}catch{}class yn{constructor(r,o,h,m=1){this.r=r,this.g=o,this.b=h,this.a=m}static parse(r){if(!r)return;if(r instanceof yn)return r;if(typeof r!="string")return;const o=f2(r);if(o)return new yn(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3])}toString(){const[r,o,h,m]=this.toArray();return`rgba(${Math.round(r)},${Math.round(o)},${Math.round(h)},${m})`}toArray(){const{r,g:o,b:h,a:m}=this;return m===0?[0,0,0,0]:[r*255/m,o*255/m,h*255/m,m]}toArray01(){const{r,g:o,b:h,a:m}=this;return m===0?[0,0,0,0]:[r/m,o/m,h/m,m]}toArray01PremultipliedAlpha(){const{r,g:o,b:h,a:m}=this;return[r,o,h,m]}}yn.black=new yn(0,0,0,1);yn.white=new yn(1,1,1,1);yn.transparent=new yn(0,0,0,0);yn.red=new yn(1,0,0,1);yn.blue=new yn(0,0,1,1);var Ni=yn;class P0{constructor(r,o,h){r?this.sensitivity=o?"variant":"case":this.sensitivity=o?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,o){return this.collator.compare(r,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class $y{constructor(r,o,h,m,v){this.text=r.normalize?r.normalize():r,this.image=o,this.scale=h,this.fontStack=m,this.textColor=v}}class Pa{constructor(r){this.sections=r}static fromString(r){return new Pa([new $y(r,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(r=>r.text.length!==0||r.image&&r.image.name.length!==0)}static factory(r){return r instanceof Pa?r:Pa.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map(r=>r.text).join("")}serialize(){const r=["format"];for(const o of this.sections){if(o.image){r.push(["image",o.image.name]);continue}r.push(o.text);const h={};o.fontStack&&(h["text-font"]=["literal",o.fontStack.split(",")]),o.scale&&(h["font-scale"]=o.scale),o.textColor&&(h["text-color"]=["rgba"].concat(o.textColor.toArray())),r.push(h)}return r}}class Go{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new Go({name:r,available:!1}):null}serialize(){return["image",this.name]}}function m2(i,r,o,h){return typeof i=="number"&&i>=0&&i<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof o=="number"&&o>=0&&o<=255?typeof h>"u"||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[i,r,o,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[i,r,o,h]:[i,r,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Cf(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Ni||i instanceof P0||i instanceof Pa||i instanceof Go)return!0;if(Array.isArray(i)){for(const r of i)if(!Cf(r))return!1;return!0}else if(typeof i=="object"){for(const r in i)if(!Cf(i[r]))return!1;return!0}else return!1}function vi(i){if(i===null)return Jf;if(typeof i=="string")return Gt;if(typeof i=="boolean")return $t;if(typeof i=="number")return Ke;if(i instanceof Ni)return $o;if(i instanceof P0)return Qf;if(i instanceof Pa)return em;if(i instanceof Go)return zp;if(Array.isArray(i)){const r=i.length;let o;for(const h of i){const m=vi(h);if(!o)o=m;else{if(o===m)continue;o=Nt;break}}return ta(o||Nt,r)}else return fu}function ap(i){const r=typeof i;return i===null?"":r==="string"||r==="number"||r==="boolean"?String(i):i instanceof Ni||i instanceof Pa||i instanceof Go?i.toString():JSON.stringify(i)}class M0{constructor(r,o){this.type=r,this.value=o}static parse(r,o){if(r.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!Cf(r[1]))return o.error("invalid value");const h=r[1];let m=vi(h);const v=o.expectedType;return m.kind==="array"&&m.N===0&&v&&v.kind==="array"&&(typeof v.N!="number"||v.N===0)&&(m=v),new M0(m,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ni?["rgba"].concat(this.value.toArray()):this.value instanceof Pa?this.value.serialize():this.value}}var Pf=M0;class hI{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}var Ui=hI;const Zg={string:Gt,number:Ke,boolean:$t,object:fu};class A0{constructor(r,o){this.type=r,this.args=o}static parse(r,o){if(r.length<2)return o.error("Expected at least one argument.");let h=1,m;const v=r[0];if(v==="array"){let l;if(r.length>2){const M=r[1];if(typeof M!="string"||!(M in Zg)||M==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);l=Zg[M],h++}else l=Nt;let C;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return o.error('The length argument to "array" must be a positive integer literal',2);C=r[2],h++}m=ta(l,C)}else m=Zg[v];const f=[];for(;h<r.length;h++){const l=o.parse(r[h],h,Nt);if(!l)return null;f.push(l)}return new A0(m,f)}evaluate(r){for(let o=0;o<this.args.length;o++){const h=this.args[o].evaluate(r);if(vp(this.type,vi(h))){if(o===this.args.length-1)throw new Ui(`Expected value to be of type ${Rr(this.type)}, but found ${Rr(vi(h))} instead.`)}else return h}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=this.type,o=[r.kind];if(r.kind==="array"){const h=r.itemType;if(h.kind==="string"||h.kind==="number"||h.kind==="boolean"){o.push(h.kind);const m=r.N;(typeof m=="number"||this.args.length>1)&&o.push(m)}}return o.concat(this.args.map(h=>h.serialize()))}}var Do=A0;class tm{constructor(r){this.type=em,this.sections=r}static parse(r,o){if(r.length<2)return o.error("Expected at least one argument.");const h=r[1];if(!Array.isArray(h)&&typeof h=="object")return o.error("First argument must be an image or text section.");const m=[];let v=!1;for(let f=1;f<=r.length-1;++f){const l=r[f];if(v&&typeof l=="object"&&!Array.isArray(l)){v=!1;let C=null;if(l["font-scale"]&&(C=o.parse(l["font-scale"],1,Ke),!C))return null;let M=null;if(l["text-font"]&&(M=o.parse(l["text-font"],1,ta(Gt)),!M))return null;let R=null;if(l["text-color"]&&(R=o.parse(l["text-color"],1,$o),!R))return null;const j=m[m.length-1];j.scale=C,j.font=M,j.textColor=R}else{const C=o.parse(r[f],1,Nt);if(!C)return null;const M=C.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,m.push({content:C,scale:null,font:null,textColor:null})}}return new tm(m)}evaluate(r){const o=h=>{const m=h.content.evaluate(r);return vi(m)===zp?new $y("",m,null,null,null):new $y(ap(m),null,h.scale?h.scale.evaluate(r):null,h.font?h.font.evaluate(r).join(","):null,h.textColor?h.textColor.evaluate(r):null)};return new Pa(this.sections.map(o))}eachChild(r){for(const o of this.sections)r(o.content),o.scale&&r(o.scale),o.font&&r(o.font),o.textColor&&r(o.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const o of this.sections){r.push(o.content.serialize());const h={};o.scale&&(h["font-scale"]=o.scale.serialize()),o.font&&(h["text-font"]=o.font.serialize()),o.textColor&&(h["text-color"]=o.textColor.serialize()),r.push(h)}return r}}class rm{constructor(r){this.type=zp,this.input=r}static parse(r,o){if(r.length!==2)return o.error("Expected two arguments.");const h=o.parse(r[1],1,Gt);return h?new rm(h):o.error("No image name provided.")}evaluate(r){const o=this.input.evaluate(r),h=Go.fromString(o);return h&&r.availableImages&&(h.available=r.availableImages.indexOf(o)>-1),h}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const pI={"to-boolean":$t,"to-color":$o,"to-number":Ke,"to-string":Gt};class E0{constructor(r,o){this.type=r,this.args=o}static parse(r,o){if(r.length<2)return o.error("Expected at least one argument.");const h=r[0];if((h==="to-boolean"||h==="to-string")&&r.length!==2)return o.error("Expected one argument.");const m=pI[h],v=[];for(let f=1;f<r.length;f++){const l=o.parse(r[f],f,Nt);if(!l)return null;v.push(l)}return new E0(m,v)}evaluate(r){if(this.type.kind==="boolean")return!!this.args[0].evaluate(r);if(this.type.kind==="color"){let o,h;for(const m of this.args){if(o=m.evaluate(r),h=null,o instanceof Ni)return o;if(typeof o=="string"){const v=r.parseColor(o);if(v)return v}else if(Array.isArray(o)&&(o.length<3||o.length>4?h=`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:h=m2(o[0],o[1],o[2],o[3]),!h))return new Ni(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new Ui(h||`Could not parse color from value '${typeof o=="string"?o:String(JSON.stringify(o))}'`)}else if(this.type.kind==="number"){let o=null;for(const h of this.args){if(o=h.evaluate(r),o===null)return 0;const m=Number(o);if(!isNaN(m))return m}throw new Ui(`Could not convert ${JSON.stringify(o)} to number.`)}else return this.type.kind==="formatted"?Pa.fromString(ap(this.args[0].evaluate(r))):this.type.kind==="resolvedImage"?Go.fromString(ap(this.args[0].evaluate(r))):ap(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){if(this.type.kind==="formatted")return new tm([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new rm(this.args[0]).serialize();const r=[`to-${this.type.kind}`];return this.eachChild(o=>{r.push(o.serialize())}),r}}var ou=E0;const dI=["Unknown","Point","LineString","Polygon"];class fI{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?dI[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const r=this.featureDistanceData.center,o=this.featureDistanceData.scale,{x:h,y:m}=this.featureTileCoord,v=h*o-r[0],f=m*o-r[1],l=this.featureDistanceData.bearing[0],C=this.featureDistanceData.bearing[1];return l*v+C*f}return 0}parseColor(r){let o=this._parseColorCache[r];return o||(o=this._parseColorCache[r]=Ni.parse(r)),o}}var g2=fI;class su{constructor(r,o,h,m){this.name=r,this.type=o,this._evaluate=h,this.args=m}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(r=>r.serialize()))}static parse(r,o){const h=r[0],m=su.definitions[h];if(!m)return o.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(m)?m[0]:m.type,f=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,l=f.filter(([M])=>!Array.isArray(M)||M.length===r.length-1);let C=null;for(const[M,R]of l){C=new x2(o.registry,o.path,null,o.scope);const j=[];let G=!1;for(let B=1;B<r.length;B++){const J=r[B],le=Array.isArray(M)?M[B-1]:M.type,we=C.parse(J,1+j.length,le);if(!we){G=!0;break}j.push(we)}if(!G){if(Array.isArray(M)&&M.length!==j.length){C.error(`Expected ${M.length} arguments, but found ${j.length} instead.`);continue}for(let B=0;B<j.length;B++){const J=Array.isArray(M)?M[B]:M.type,le=j[B];C.concat(B+1).checkSubtype(J,le.type)}if(C.errors.length===0)return new su(h,v,R,j)}}if(l.length===1)o.errors.push(...C.errors);else{const M=(l.length?l:f).map(([j])=>mI(j)).join(" | "),R=[];for(let j=1;j<r.length;j++){const G=o.parse(r[j],1+R.length);if(!G)return null;R.push(Rr(G.type))}o.error(`Expected arguments of type ${M}, but found (${R.join(", ")}) instead.`)}return null}static register(r,o){su.definitions=o;for(const h in o)r[h]=su}}function mI(i){return Array.isArray(i)?`(${i.map(Rr).join(", ")})`:`(${Rr(i.type)}...)`}var Mu=su;class im{constructor(r,o,h){this.type=Qf,this.locale=h,this.caseSensitive=r,this.diacriticSensitive=o}static parse(r,o){if(r.length!==2)return o.error("Expected one argument.");const h=r[1];if(typeof h!="object"||Array.isArray(h))return o.error("Collator options argument must be an object.");const m=o.parse(h["case-sensitive"]===void 0?!1:h["case-sensitive"],1,$t);if(!m)return null;const v=o.parse(h["diacritic-sensitive"]===void 0?!1:h["diacritic-sensitive"],1,$t);if(!v)return null;let f=null;return h.locale&&(f=o.parse(h.locale,1,Gt),!f)?null:new im(m,v,f)}evaluate(r){return new P0(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}const zs=8192;function I0(i,r){i[0]=Math.min(i[0],r[0]),i[1]=Math.min(i[1],r[1]),i[2]=Math.max(i[2],r[0]),i[3]=Math.max(i[3],r[1])}function gI(i){return(180+i)/360}function yI(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Mf(i,r){return!(i[0]<=r[0]||i[2]>=r[2]||i[1]<=r[1]||i[3]>=r[3])}function _I(i,r){const o=gI(i[0]),h=yI(i[1]),m=Math.pow(2,r.z);return[Math.round(o*m*zs),Math.round(h*m*zs)]}function vI(i,r,o){const h=i[0]-r[0],m=i[1]-r[1],v=i[0]-o[0],f=i[1]-o[1];return h*f-v*m===0&&h*v<=0&&m*f<=0}function bI(i,r,o){return r[1]>i[1]!=o[1]>i[1]&&i[0]<(o[0]-r[0])*(i[1]-r[1])/(o[1]-r[1])+r[0]}function z0(i,r){let o=!1;for(let h=0,m=r.length;h<m;h++){const v=r[h];for(let f=0,l=v.length;f<l-1;f++){if(vI(i,v[f],v[f+1]))return!1;bI(i,v[f],v[f+1])&&(o=!o)}}return o}function xI(i,r){for(let o=0;o<r.length;o++)if(z0(i,r[o]))return!0;return!1}function wI(i,r){return i[0]*r[1]-i[1]*r[0]}function o1(i,r,o,h){const m=i[0]-o[0],v=i[1]-o[1],f=r[0]-o[0],l=r[1]-o[1],C=h[0]-o[0],M=h[1]-o[1],R=m*M-C*v,j=f*M-C*l;return R>0&&j<0||R<0&&j>0}function TI(i,r,o,h){const m=[r[0]-i[0],r[1]-i[1]],v=[h[0]-o[0],h[1]-o[1]];return wI(v,m)===0?!1:!!(o1(i,r,o,h)&&o1(o,h,i,r))}function SI(i,r,o){for(const h of o)for(let m=0;m<h.length-1;++m)if(TI(i,r,h[m],h[m+1]))return!0;return!1}function y2(i,r){for(let o=0;o<i.length;++o)if(!z0(i[o],r))return!1;for(let o=0;o<i.length-1;++o)if(SI(i[o],i[o+1],r))return!1;return!0}function kI(i,r){for(let o=0;o<r.length;o++)if(y2(i,r[o]))return!0;return!1}function R0(i,r,o){const h=[];for(let m=0;m<i.length;m++){const v=[];for(let f=0;f<i[m].length;f++){const l=_I(i[m][f],o);I0(r,l),v.push(l)}h.push(v)}return h}function _2(i,r,o){const h=[];for(let m=0;m<i.length;m++){const v=R0(i[m],r,o);h.push(v)}return h}function v2(i,r,o,h){if(i[0]<o[0]||i[0]>o[2]){const m=h*.5;let v=i[0]-o[0]>m?-h:o[0]-i[0]>m?h:0;v===0&&(v=i[0]-o[2]>m?-h:o[2]-i[0]>m?h:0),i[0]+=v}I0(r,i)}function CI(i){i[0]=i[1]=1/0,i[2]=i[3]=-1/0}function s1(i,r,o,h){const m=Math.pow(2,h.z)*zs,v=[h.x*zs,h.y*zs],f=[];if(!i)return f;for(const l of i)for(const C of l){const M=[C.x+v[0],C.y+v[1]];v2(M,r,o,m),f.push(M)}return f}function l1(i,r,o,h){const m=Math.pow(2,h.z)*zs,v=[h.x*zs,h.y*zs],f=[];if(!i)return f;for(const l of i){const C=[];for(const M of l){const R=[M.x+v[0],M.y+v[1]];I0(r,R),C.push(R)}f.push(C)}if(r[2]-r[0]<=m/2){CI(r);for(const l of f)for(const C of l)v2(C,r,o,m)}return f}function PI(i,r){const o=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(!m)return!1;if(r.type==="Polygon"){const v=R0(r.coordinates,h,m),f=s1(i.geometry(),o,h,m);if(!Mf(o,h))return!1;for(const l of f)if(!z0(l,v))return!1}if(r.type==="MultiPolygon"){const v=_2(r.coordinates,h,m),f=s1(i.geometry(),o,h,m);if(!Mf(o,h))return!1;for(const l of f)if(!xI(l,v))return!1}return!0}function MI(i,r){const o=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(!m)return!1;if(r.type==="Polygon"){const v=R0(r.coordinates,h,m),f=l1(i.geometry(),o,h,m);if(!Mf(o,h))return!1;for(const l of f)if(!y2(l,v))return!1}if(r.type==="MultiPolygon"){const v=_2(r.coordinates,h,m),f=l1(i.geometry(),o,h,m);if(!Mf(o,h))return!1;for(const l of f)if(!kI(l,v))return!1}return!0}class op{constructor(r,o){this.type=$t,this.geojson=r,this.geometries=o}static parse(r,o){if(r.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(Cf(r[1])){const h=r[1];if(h.type==="FeatureCollection")for(let m=0;m<h.features.length;++m){const v=h.features[m].geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new op(h,h.features[m].geometry)}else if(h.type==="Feature"){const m=h.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new op(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new op(h,h)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return PI(r,this.geometries);if(r.geometryType()==="LineString")return MI(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var L0=op;function D0(i){if(i instanceof Mu&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof L0)return!1;let r=!0;return i.eachChild(o=>{r&&!D0(o)&&(r=!1)}),r}function F0(i){if(i instanceof Mu&&i.name==="feature-state")return!1;let r=!0;return i.eachChild(o=>{r&&!F0(o)&&(r=!1)}),r}function j0(i,r){if(i instanceof Mu&&r.indexOf(i.name)>=0)return!1;let o=!0;return i.eachChild(h=>{o&&!j0(h,r)&&(o=!1)}),o}class O0{constructor(r,o){this.type=o.type,this.name=r,this.boundExpression=o}static parse(r,o){if(r.length!==2||typeof r[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const h=r[1];return o.scope.has(h)?new O0(h,o.scope.get(h)):o.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var b2=O0;class B0{constructor(r,o=[],h,m=new oI,v=[]){this.registry=r,this.path=o,this.key=o.map(f=>`[${f}]`).join(""),this.scope=m,this.errors=v,this.expectedType=h}parse(r,o,h,m,v={}){return o?this.concat(o,h,m)._parse(r,v):this._parse(r,v)}_parse(r,o){(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number")&&(r=["literal",r]);function h(m,v,f){return f==="assert"?new Do(v,[m]):f==="coerce"?new ou(v,[m]):m}if(Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=r[0];if(typeof m!="string")return this.error(`Expression name must be a string, but found ${typeof m} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const v=this.registry[m];if(v){let f=v.parse(r,this);if(!f)return null;if(this.expectedType){const l=this.expectedType,C=f.type;if((l.kind==="string"||l.kind==="number"||l.kind==="boolean"||l.kind==="object"||l.kind==="array")&&C.kind==="value")f=h(f,l,o.typeAnnotation||"assert");else if((l.kind==="color"||l.kind==="formatted"||l.kind==="resolvedImage")&&(C.kind==="value"||C.kind==="string"))f=h(f,l,o.typeAnnotation||"coerce");else if(this.checkSubtype(l,C))return null}if(!(f instanceof Pf)&&f.type.kind!=="resolvedImage"&&Ny(f)){const l=new g2;try{f=new Pf(f.type,f.evaluate(l))}catch(C){return this.error(C.message),null}}return f}return this.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof r>"u"?this.error("'undefined' value invalid. Use null instead."):typeof r=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof r} instead.`)}concat(r,o,h){const m=typeof r=="number"?this.path.concat(r):this.path,v=h?this.scope.concat(h):this.scope;return new B0(this.registry,m,o||null,v,this.errors)}error(r,...o){const h=`${this.key}${o.map(m=>`[${m}]`).join("")}`;this.errors.push(new to(h,r))}checkSubtype(r,o){const h=vp(r,o);return h&&this.error(h),h}}var x2=B0;function Ny(i){if(i instanceof b2)return Ny(i.boundExpression);if(i instanceof Mu&&i.name==="error"||i instanceof im||i instanceof L0)return!1;const r=i instanceof ou||i instanceof Do;let o=!0;return i.eachChild(h=>{r?o=o&&Ny(h):o=o&&h instanceof Pf}),o?D0(i)&&j0(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"]):!1}function nm(i,r){const o=i.length-1;let h=0,m=o,v=0,f,l;for(;h<=m;)if(v=Math.floor((h+m)/2),f=i[v],l=i[v+1],f<=r){if(v===o||r<l)return v;h=v+1}else if(f>r)m=v-1;else throw new Ui("Input is not a number.");return 0}class $0{constructor(r,o,h){this.type=r,this.input=o,this.labels=[],this.outputs=[];for(const[m,v]of h)this.labels.push(m),this.outputs.push(v)}static parse(r,o){if(r.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!==0)return o.error("Expected an even number of arguments.");const h=o.parse(r[1],1,Ke);if(!h)return null;const m=[];let v=null;o.expectedType&&o.expectedType.kind!=="value"&&(v=o.expectedType);for(let f=1;f<r.length;f+=2){const l=f===1?-1/0:r[f],C=r[f+1],M=f,R=f+1;if(typeof l!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(m.length&&m[m.length-1][0]>=l)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const j=o.parse(C,R,v);if(!j)return null;v=v||j.type,m.push([l,j])}return new $0(v,h,m)}evaluate(r){const o=this.labels,h=this.outputs;if(o.length===1)return h[0].evaluate(r);const m=this.input.evaluate(r);if(m<=o[0])return h[0].evaluate(r);const v=o.length;if(m>=o[v-1])return h[v-1].evaluate(r);const f=nm(o,m);return h[f].evaluate(r)}eachChild(r){r(this.input);for(const o of this.outputs)r(o)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){const r=["step",this.input.serialize()];for(let o=0;o<this.labels.length;o++)o>0&&r.push(this.labels[o]),r.push(this.outputs[o].serialize());return r}}var w2=$0,AI=T2;function T2(i,r,o,h){this.cx=3*i,this.bx=3*(o-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(h-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=r,this.p2x=o,this.p2y=h}T2.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,r){if(r===void 0&&(r=1e-6),i<0)return 0;if(i>1)return 1;for(var o=i,h=0;h<8;h++){var m=this.sampleCurveX(o)-i;if(Math.abs(m)<r)return o;var v=this.sampleCurveDerivativeX(o);if(Math.abs(v)<1e-6)break;o=o-m/v}var f=0,l=1;for(o=i,h=0;h<20&&(m=this.sampleCurveX(o),!(Math.abs(m-i)<r));h++)i>m?f=o:l=o,o=(l-f)*.5+f;return o},solve:function(i,r){return this.sampleCurveY(this.solveCurveX(i,r))}};function Nn(i,r,o){return i*(1-o)+r*o}function EI(i,r,o){return new Ni(Nn(i.r,r.r,o),Nn(i.g,r.g,o),Nn(i.b,r.b,o),Nn(i.a,r.a,o))}function II(i,r,o){return i.map((h,m)=>Nn(h,r[m],o))}var S2=Object.freeze({__proto__:null,number:Nn,color:EI,array:II});const k2=.95047,C2=1,P2=1.08883,M2=4/29,mu=6/29,A2=3*mu*mu,zI=mu*mu*mu,RI=Math.PI/180,LI=180/Math.PI;function Wg(i){return i>zI?Math.pow(i,1/3):i/A2+M2}function Hg(i){return i>mu?i*i*i:A2*(i-M2)}function Xg(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function Kg(i){return i/=255,i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function E2(i){const r=Kg(i.r),o=Kg(i.g),h=Kg(i.b),m=Wg((.4124564*r+.3575761*o+.1804375*h)/k2),v=Wg((.2126729*r+.7151522*o+.072175*h)/C2),f=Wg((.0193339*r+.119192*o+.9503041*h)/P2);return{l:116*v-16,a:500*(m-v),b:200*(v-f),alpha:i.a}}function I2(i){let r=(i.l+16)/116,o=isNaN(i.a)?r:r+i.a/500,h=isNaN(i.b)?r:r-i.b/200;return r=C2*Hg(r),o=k2*Hg(o),h=P2*Hg(h),new Ni(Xg(3.2404542*o-1.5371385*r-.4985314*h),Xg(-.969266*o+1.8760108*r+.041556*h),Xg(.0556434*o-.2040259*r+1.0572252*h),i.alpha)}function DI(i,r,o){return{l:Nn(i.l,r.l,o),a:Nn(i.a,r.a,o),b:Nn(i.b,r.b,o),alpha:Nn(i.alpha,r.alpha,o)}}function FI(i){const{l:r,a:o,b:h}=E2(i),m=Math.atan2(h,o)*LI;return{h:m<0?m+360:m,c:Math.sqrt(o*o+h*h),l:r,alpha:i.a}}function jI(i){const r=i.h*RI,o=i.c,h=i.l;return I2({l:h,a:Math.cos(r)*o,b:Math.sin(r)*o,alpha:i.alpha})}function OI(i,r,o){const h=r-i;return i+o*(h>180||h<-180?h-360*Math.round(h/360):h)}function BI(i,r,o){return{h:OI(i.h,r.h,o),c:Nn(i.c,r.c,o),l:Nn(i.l,r.l,o),alpha:Nn(i.alpha,r.alpha,o)}}const Xh={forward:E2,reverse:I2,interpolate:DI},Kh={forward:FI,reverse:jI,interpolate:BI};var z2=Object.freeze({__proto__:null,lab:Xh,hcl:Kh});class Af{constructor(r,o,h,m,v){this.type=r,this.operator=o,this.interpolation=h,this.input=m,this.labels=[],this.outputs=[];for(const[f,l]of v)this.labels.push(f),this.outputs.push(l)}static interpolationFactor(r,o,h,m){let v=0;if(r.name==="exponential")v=Yg(o,r.base,h,m);else if(r.name==="linear")v=Yg(o,1,h,m);else if(r.name==="cubic-bezier"){const f=r.controlPoints;v=new AI(f[0],f[1],f[2],f[3]).solve(Yg(o,1,h,m))}return v}static parse(r,o){let[h,m,v,...f]=r;if(!Array.isArray(m)||m.length===0)return o.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){const M=m[1];if(typeof M!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:M}}else if(m[0]==="cubic-bezier"){const M=m.slice(1);if(M.length!==4||M.some(R=>typeof R!="number"||R<0||R>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:M}}else return o.error(`Unknown interpolation type ${String(m[0])}`,1,0);if(r.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!==0)return o.error("Expected an even number of arguments.");if(v=o.parse(v,2,Ke),!v)return null;const l=[];let C=null;h==="interpolate-hcl"||h==="interpolate-lab"?C=$o:o.expectedType&&o.expectedType.kind!=="value"&&(C=o.expectedType);for(let M=0;M<f.length;M+=2){const R=f[M],j=f[M+1],G=M+3,B=M+4;if(typeof R!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',G);if(l.length&&l[l.length-1][0]>=R)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',G);const J=o.parse(j,B,C);if(!J)return null;C=C||J.type,l.push([R,J])}return C.kind!=="number"&&C.kind!=="color"&&!(C.kind==="array"&&C.itemType.kind==="number"&&typeof C.N=="number")?o.error(`Type ${Rr(C)} is not interpolatable.`):new Af(C,h,m,v,l)}evaluate(r){const o=this.labels,h=this.outputs;if(o.length===1)return h[0].evaluate(r);const m=this.input.evaluate(r);if(m<=o[0])return h[0].evaluate(r);const v=o.length;if(m>=o[v-1])return h[v-1].evaluate(r);const f=nm(o,m),l=o[f],C=o[f+1],M=Af.interpolationFactor(this.interpolation,m,l,C),R=h[f].evaluate(r),j=h[f+1].evaluate(r);return this.operator==="interpolate"?S2[this.type.kind.toLowerCase()](R,j,M):this.operator==="interpolate-hcl"?Kh.reverse(Kh.interpolate(Kh.forward(R),Kh.forward(j),M)):Xh.reverse(Xh.interpolate(Xh.forward(R),Xh.forward(j),M))}eachChild(r){r(this.input);for(const o of this.outputs)r(o)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){let r;this.interpolation.name==="linear"?r=["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?r=["linear"]:r=["exponential",this.interpolation.base]:r=["cubic-bezier"].concat(this.interpolation.controlPoints);const o=[this.operator,r,this.input.serialize()];for(let h=0;h<this.labels.length;h++)o.push(this.labels[h],this.outputs[h].serialize());return o}}function Yg(i,r,o,h){const m=h-o,v=i-o;return m===0?0:r===1?v/m:(Math.pow(r,v)-1)/(Math.pow(r,m)-1)}var No=Af;class Ef{constructor(r,o){this.type=r,this.args=o}static parse(r,o){if(r.length<2)return o.error("Expectected at least one argument.");let h=null;const m=o.expectedType;m&&m.kind!=="value"&&(h=m);const v=[];for(const f of r.slice(1)){const l=o.parse(f,1+v.length,h,void 0,{typeAnnotation:"omit"});if(!l)return null;h=h||l.type,v.push(l)}return m&&v.some(f=>vp(m,f.type))?new Ef(Nt,v):new Ef(h,v)}evaluate(r){let o=null,h=0,m;for(const v of this.args){if(h++,o=v.evaluate(r),o&&o instanceof Go&&!o.available&&(m||(m=o),o=null,h===this.args.length))return m;if(o!==null)break}return o}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=["coalesce"];return this.eachChild(o=>{r.push(o.serialize())}),r}}var R2=Ef;class N0{constructor(r,o){this.type=o.type,this.bindings=[].concat(r),this.result=o}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const o of this.bindings)r(o[1]);r(this.result)}static parse(r,o){if(r.length<4)return o.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const h=[];for(let v=1;v<r.length-1;v+=2){const f=r[v];if(typeof f!="string")return o.error(`Expected string, but found ${typeof f} instead.`,v);if(/[^a-zA-Z0-9_]/.test(f))return o.error("Variable names must contain only alphanumeric characters or '_'.",v);const l=o.parse(r[v+1],v+1);if(!l)return null;h.push([f,l])}const m=o.parse(r[r.length-1],r.length-1,o.expectedType,h);return m?new N0(h,m):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[o,h]of this.bindings)r.push(o,h.serialize());return r.push(this.result.serialize()),r}}var L2=N0;class U0{constructor(r,o,h){this.type=r,this.index=o,this.input=h}static parse(r,o){if(r.length!==3)return o.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const h=o.parse(r[1],1,Ke),m=o.parse(r[2],2,ta(o.expectedType||Nt));if(!h||!m)return null;const v=m.type;return new U0(v.itemType,h,m)}evaluate(r){const o=this.index.evaluate(r),h=this.input.evaluate(r);if(o<0)throw new Ui(`Array index out of bounds: ${o} < 0.`);if(o>=h.length)throw new Ui(`Array index out of bounds: ${o} > ${h.length-1}.`);if(o!==Math.floor(o))throw new Ui(`Array index must be an integer, but found ${o} instead.`);return h[o]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var $I=U0;class V0{constructor(r,o){this.type=$t,this.needle=r,this.haystack=o}static parse(r,o){if(r.length!==3)return o.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const h=o.parse(r[1],1,Nt),m=o.parse(r[2],2,Nt);return!h||!m?null:C0(h.type,[$t,Gt,Ke,Jf,Nt])?new V0(h,m):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Rr(h.type)} instead`)}evaluate(r){const o=this.needle.evaluate(r),h=this.haystack.evaluate(r);if(h==null)return!1;if(!bp(o,["boolean","string","number","null"]))throw new Ui(`Expected first argument to be of type boolean, string, number or null, but found ${Rr(vi(o))} instead.`);if(!bp(h,["string","array"]))throw new Ui(`Expected second argument to be of type array or string, but found ${Rr(vi(h))} instead.`);return h.indexOf(o)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var NI=V0;class If{constructor(r,o,h){this.type=Ke,this.needle=r,this.haystack=o,this.fromIndex=h}static parse(r,o){if(r.length<=2||r.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const h=o.parse(r[1],1,Nt),m=o.parse(r[2],2,Nt);if(!h||!m)return null;if(!C0(h.type,[$t,Gt,Ke,Jf,Nt]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Rr(h.type)} instead`);if(r.length===4){const v=o.parse(r[3],3,Ke);return v?new If(h,m,v):null}else return new If(h,m)}evaluate(r){const o=this.needle.evaluate(r),h=this.haystack.evaluate(r);if(!bp(o,["boolean","string","number","null"]))throw new Ui(`Expected first argument to be of type boolean, string, number or null, but found ${Rr(vi(o))} instead.`);if(!bp(h,["string","array"]))throw new Ui(`Expected second argument to be of type array or string, but found ${Rr(vi(h))} instead.`);if(this.fromIndex){const m=this.fromIndex.evaluate(r);return h.indexOf(o,m)}return h.indexOf(o)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var UI=If;class q0{constructor(r,o,h,m,v,f){this.inputType=r,this.type=o,this.input=h,this.cases=m,this.outputs=v,this.otherwise=f}static parse(r,o){if(r.length<5)return o.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!==1)return o.error("Expected an even number of arguments.");let h,m;o.expectedType&&o.expectedType.kind!=="value"&&(m=o.expectedType);const v={},f=[];for(let M=2;M<r.length-1;M+=2){let R=r[M];const j=r[M+1];Array.isArray(R)||(R=[R]);const G=o.concat(M);if(R.length===0)return G.error("Expected at least one branch label.");for(const J of R){if(typeof J!="number"&&typeof J!="string")return G.error("Branch labels must be numbers or strings.");if(typeof J=="number"&&Math.abs(J)>Number.MAX_SAFE_INTEGER)return G.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof J=="number"&&Math.floor(J)!==J)return G.error("Numeric branch labels must be integer values.");if(!h)h=vi(J);else if(G.checkSubtype(h,vi(J)))return null;if(typeof v[String(J)]<"u")return G.error("Branch labels must be unique.");v[String(J)]=f.length}const B=o.parse(j,M,m);if(!B)return null;m=m||B.type,f.push(B)}const l=o.parse(r[1],1,Nt);if(!l)return null;const C=o.parse(r[r.length-1],r.length-1,m);return!C||l.type.kind!=="value"&&o.concat(1).checkSubtype(h,l.type)?null:new q0(h,m,l,v,f,C)}evaluate(r){const o=this.input.evaluate(r);return(vi(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],o=Object.keys(this.cases).sort(),h=[],m={};for(const f of o){const l=m[this.cases[f]];l===void 0?(m[this.cases[f]]=h.length,h.push([this.cases[f],[f]])):h[l][1].push(f)}const v=f=>this.inputType.kind==="number"?Number(f):f;for(const[f,l]of h)l.length===1?r.push(v(l[0])):r.push(l.map(v)),r.push(this.outputs[f].serialize());return r.push(this.otherwise.serialize()),r}}var VI=q0;class G0{constructor(r,o,h){this.type=r,this.branches=o,this.otherwise=h}static parse(r,o){if(r.length<4)return o.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!==0)return o.error("Expected an odd number of arguments.");let h;o.expectedType&&o.expectedType.kind!=="value"&&(h=o.expectedType);const m=[];for(let f=1;f<r.length-1;f+=2){const l=o.parse(r[f],f,$t);if(!l)return null;const C=o.parse(r[f+1],f+1,h);if(!C)return null;m.push([l,C]),h=h||C.type}const v=o.parse(r[r.length-1],r.length-1,h);return v?new G0(h,m,v):null}evaluate(r){for(const[o,h]of this.branches)if(o.evaluate(r))return h.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[o,h]of this.branches)r(o),r(h);r(this.otherwise)}outputDefined(){return this.branches.every(([r,o])=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild(o=>{r.push(o.serialize())}),r}}var qI=G0;class zf{constructor(r,o,h,m){this.type=r,this.input=o,this.beginIndex=h,this.endIndex=m}static parse(r,o){if(r.length<=2||r.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const h=o.parse(r[1],1,Nt),m=o.parse(r[2],2,Ke);if(!h||!m)return null;if(!C0(h.type,[ta(Nt),Gt,Nt]))return o.error(`Expected first argument to be of type array or string, but found ${Rr(h.type)} instead`);if(r.length===4){const v=o.parse(r[3],3,Ke);return v?new zf(h.type,h,m,v):null}else return new zf(h.type,h,m)}evaluate(r){const o=this.input.evaluate(r),h=this.beginIndex.evaluate(r);if(!bp(o,["string","array"]))throw new Ui(`Expected first argument to be of type array or string, but found ${Rr(vi(o))} instead.`);if(this.endIndex){const m=this.endIndex.evaluate(r);return o.slice(h,m)}return o.slice(h)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var GI=zf;function c1(i,r){return i==="=="||i==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function ZI(i,r,o){return r===o}function WI(i,r,o){return r!==o}function HI(i,r,o){return r<o}function XI(i,r,o){return r>o}function KI(i,r,o){return r<=o}function YI(i,r,o){return r>=o}function D2(i,r,o,h){return h.compare(r,o)===0}function JI(i,r,o,h){return!D2(i,r,o,h)}function QI(i,r,o,h){return h.compare(r,o)<0}function ez(i,r,o,h){return h.compare(r,o)>0}function tz(i,r,o,h){return h.compare(r,o)<=0}function rz(i,r,o,h){return h.compare(r,o)>=0}function Au(i,r,o){const h=i!=="=="&&i!=="!=";return class F2{constructor(v,f,l){this.type=$t,this.lhs=v,this.rhs=f,this.collator=l,this.hasUntypedArgument=v.type.kind==="value"||f.type.kind==="value"}static parse(v,f){if(v.length!==3&&v.length!==4)return f.error("Expected two or three arguments.");const l=v[0];let C=f.parse(v[1],1,Nt);if(!C)return null;if(!c1(l,C.type))return f.concat(1).error(`"${l}" comparisons are not supported for type '${Rr(C.type)}'.`);let M=f.parse(v[2],2,Nt);if(!M)return null;if(!c1(l,M.type))return f.concat(2).error(`"${l}" comparisons are not supported for type '${Rr(M.type)}'.`);if(C.type.kind!==M.type.kind&&C.type.kind!=="value"&&M.type.kind!=="value")return f.error(`Cannot compare types '${Rr(C.type)}' and '${Rr(M.type)}'.`);h&&(C.type.kind==="value"&&M.type.kind!=="value"?C=new Do(M.type,[C]):C.type.kind!=="value"&&M.type.kind==="value"&&(M=new Do(C.type,[M])));let R=null;if(v.length===4){if(C.type.kind!=="string"&&M.type.kind!=="string"&&C.type.kind!=="value"&&M.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(R=f.parse(v[3],3,Qf),!R)return null}return new F2(C,M,R)}evaluate(v){const f=this.lhs.evaluate(v),l=this.rhs.evaluate(v);if(h&&this.hasUntypedArgument){const C=vi(f),M=vi(l);if(C.kind!==M.kind||!(C.kind==="string"||C.kind==="number"))throw new Ui(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${C.kind}, ${M.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const C=vi(f),M=vi(l);if(C.kind!=="string"||M.kind!=="string")return r(v,f,l)}return this.collator?o(v,f,l,this.collator.evaluate(v)):r(v,f,l)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}serialize(){const v=[i];return this.eachChild(f=>{v.push(f.serialize())}),v}}}const iz=Au("==",ZI,D2),nz=Au("!=",WI,JI),az=Au("<",HI,QI),oz=Au(">",XI,ez),sz=Au("<=",KI,tz),lz=Au(">=",YI,rz);class Z0{constructor(r,o,h,m,v,f){this.type=Gt,this.number=r,this.locale=o,this.currency=h,this.unit=m,this.minFractionDigits=v,this.maxFractionDigits=f}static parse(r,o){if(r.length!==3)return o.error("Expected two arguments.");const h=o.parse(r[1],1,Ke);if(!h)return null;const m=r[2];if(typeof m!="object"||Array.isArray(m))return o.error("NumberFormat options argument must be an object.");let v=null;if(m.locale&&(v=o.parse(m.locale,1,Gt),!v))return null;let f=null;if(m.currency&&(f=o.parse(m.currency,1,Gt),!f))return null;let l=null;if(m.unit&&(l=o.parse(m.unit,1,Gt),!l))return null;let C=null;if(m["min-fraction-digits"]&&(C=o.parse(m["min-fraction-digits"],1,Ke),!C))return null;let M=null;return m["max-fraction-digits"]&&(M=o.parse(m["max-fraction-digits"],1,Ke),!M)?null:new Z0(h,v,f,l,C,M)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency&&"currency"||this.unit&&"unit"||"decimal",currency:this.currency?this.currency.evaluate(r):void 0,unit:this.unit?this.unit.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.unit&&r(this.unit),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.unit&&(r.unit=this.unit.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class W0{constructor(r){this.type=Ke,this.input=r}static parse(r,o){if(r.length!==2)return o.error(`Expected 1 argument, but found ${r.length-1} instead.`);const h=o.parse(r[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${Rr(h.type)} instead.`):new W0(h):null}evaluate(r){const o=this.input.evaluate(r);if(typeof o=="string"||Array.isArray(o))return o.length;throw new Ui(`Expected value to be of type string or array, but found ${Rr(vi(o))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild(o=>{r.push(o.serialize())}),r}}var cz=W0;const j2={"==":iz,"!=":nz,">":oz,"<":az,">=":lz,"<=":sz,array:Do,at:$I,boolean:Do,case:qI,coalesce:R2,collator:im,format:tm,image:rm,in:NI,"index-of":UI,interpolate:No,"interpolate-hcl":No,"interpolate-lab":No,length:cz,let:L2,literal:Pf,match:VI,number:Do,"number-format":Z0,object:Do,slice:GI,step:w2,string:Do,"to-boolean":ou,"to-color":ou,"to-number":ou,"to-string":ou,var:b2,within:L0};function u1(i,[r,o,h,m]){r=r.evaluate(i),o=o.evaluate(i),h=h.evaluate(i);const v=m?m.evaluate(i):1,f=m2(r,o,h,v);if(f)throw new Ui(f);return new Ni(r/255*v,o/255*v,h/255*v,v)}function h1(i,r){return i in r}function Jg(i,r){const o=r[i];return typeof o>"u"?null:o}function uz(i,r,o,h){for(;o<=h;){const m=o+h>>1;if(r[m]===i)return!0;r[m]>i?h=m-1:o=m+1}return!1}function yl(i){return{type:i}}Mu.register(j2,{error:[sI,[Gt],(i,[r])=>{throw new Ui(r.evaluate(i))}],typeof:[Gt,[Nt],(i,[r])=>Rr(vi(r.evaluate(i)))],"to-rgba":[ta(Ke,4),[$o],(i,[r])=>r.evaluate(i).toArray()],rgb:[$o,[Ke,Ke,Ke],u1],rgba:[$o,[Ke,Ke,Ke,Ke],u1],has:{type:$t,overloads:[[[Gt],(i,[r])=>h1(r.evaluate(i),i.properties())],[[Gt,fu],(i,[r,o])=>h1(r.evaluate(i),o.evaluate(i))]]},get:{type:Nt,overloads:[[[Gt],(i,[r])=>Jg(r.evaluate(i),i.properties())],[[Gt,fu],(i,[r,o])=>Jg(r.evaluate(i),o.evaluate(i))]]},"feature-state":[Nt,[Gt],(i,[r])=>Jg(r.evaluate(i),i.featureState||{})],properties:[fu,[],i=>i.properties()],"geometry-type":[Gt,[],i=>i.geometryType()],id:[Nt,[],i=>i.id()],zoom:[Ke,[],i=>i.globals.zoom],pitch:[Ke,[],i=>i.globals.pitch||0],"distance-from-center":[Ke,[],i=>i.distanceFromCenter()],"heatmap-density":[Ke,[],i=>i.globals.heatmapDensity||0],"line-progress":[Ke,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[Ke,[],i=>i.globals.skyRadialProgress||0],accumulated:[Nt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Ke,yl(Ke),(i,r)=>{let o=0;for(const h of r)o+=h.evaluate(i);return o}],"*":[Ke,yl(Ke),(i,r)=>{let o=1;for(const h of r)o*=h.evaluate(i);return o}],"-":{type:Ke,overloads:[[[Ke,Ke],(i,[r,o])=>r.evaluate(i)-o.evaluate(i)],[[Ke],(i,[r])=>-r.evaluate(i)]]},"/":[Ke,[Ke,Ke],(i,[r,o])=>r.evaluate(i)/o.evaluate(i)],"%":[Ke,[Ke,Ke],(i,[r,o])=>r.evaluate(i)%o.evaluate(i)],ln2:[Ke,[],()=>Math.LN2],pi:[Ke,[],()=>Math.PI],e:[Ke,[],()=>Math.E],"^":[Ke,[Ke,Ke],(i,[r,o])=>Math.pow(r.evaluate(i),o.evaluate(i))],sqrt:[Ke,[Ke],(i,[r])=>Math.sqrt(r.evaluate(i))],log10:[Ke,[Ke],(i,[r])=>Math.log(r.evaluate(i))/Math.LN10],ln:[Ke,[Ke],(i,[r])=>Math.log(r.evaluate(i))],log2:[Ke,[Ke],(i,[r])=>Math.log(r.evaluate(i))/Math.LN2],sin:[Ke,[Ke],(i,[r])=>Math.sin(r.evaluate(i))],cos:[Ke,[Ke],(i,[r])=>Math.cos(r.evaluate(i))],tan:[Ke,[Ke],(i,[r])=>Math.tan(r.evaluate(i))],asin:[Ke,[Ke],(i,[r])=>Math.asin(r.evaluate(i))],acos:[Ke,[Ke],(i,[r])=>Math.acos(r.evaluate(i))],atan:[Ke,[Ke],(i,[r])=>Math.atan(r.evaluate(i))],min:[Ke,yl(Ke),(i,r)=>Math.min(...r.map(o=>o.evaluate(i)))],max:[Ke,yl(Ke),(i,r)=>Math.max(...r.map(o=>o.evaluate(i)))],abs:[Ke,[Ke],(i,[r])=>Math.abs(r.evaluate(i))],round:[Ke,[Ke],(i,[r])=>{const o=r.evaluate(i);return o<0?-Math.round(-o):Math.round(o)}],floor:[Ke,[Ke],(i,[r])=>Math.floor(r.evaluate(i))],ceil:[Ke,[Ke],(i,[r])=>Math.ceil(r.evaluate(i))],"filter-==":[$t,[Gt,Nt],(i,[r,o])=>i.properties()[r.value]===o.value],"filter-id-==":[$t,[Nt],(i,[r])=>i.id()===r.value],"filter-type-==":[$t,[Gt],(i,[r])=>i.geometryType()===r.value],"filter-<":[$t,[Gt,Nt],(i,[r,o])=>{const h=i.properties()[r.value],m=o.value;return typeof h==typeof m&&h<m}],"filter-id-<":[$t,[Nt],(i,[r])=>{const o=i.id(),h=r.value;return typeof o==typeof h&&o<h}],"filter->":[$t,[Gt,Nt],(i,[r,o])=>{const h=i.properties()[r.value],m=o.value;return typeof h==typeof m&&h>m}],"filter-id->":[$t,[Nt],(i,[r])=>{const o=i.id(),h=r.value;return typeof o==typeof h&&o>h}],"filter-<=":[$t,[Gt,Nt],(i,[r,o])=>{const h=i.properties()[r.value],m=o.value;return typeof h==typeof m&&h<=m}],"filter-id-<=":[$t,[Nt],(i,[r])=>{const o=i.id(),h=r.value;return typeof o==typeof h&&o<=h}],"filter->=":[$t,[Gt,Nt],(i,[r,o])=>{const h=i.properties()[r.value],m=o.value;return typeof h==typeof m&&h>=m}],"filter-id->=":[$t,[Nt],(i,[r])=>{const o=i.id(),h=r.value;return typeof o==typeof h&&o>=h}],"filter-has":[$t,[Nt],(i,[r])=>r.value in i.properties()],"filter-has-id":[$t,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[$t,[ta(Gt)],(i,[r])=>r.value.indexOf(i.geometryType())>=0],"filter-id-in":[$t,[ta(Nt)],(i,[r])=>r.value.indexOf(i.id())>=0],"filter-in-small":[$t,[Gt,ta(Nt)],(i,[r,o])=>o.value.indexOf(i.properties()[r.value])>=0],"filter-in-large":[$t,[Gt,ta(Nt)],(i,[r,o])=>uz(i.properties()[r.value],o.value,0,o.value.length-1)],all:{type:$t,overloads:[[[$t,$t],(i,[r,o])=>r.evaluate(i)&&o.evaluate(i)],[yl($t),(i,r)=>{for(const o of r)if(!o.evaluate(i))return!1;return!0}]]},any:{type:$t,overloads:[[[$t,$t],(i,[r,o])=>r.evaluate(i)||o.evaluate(i)],[yl($t),(i,r)=>{for(const o of r)if(o.evaluate(i))return!0;return!1}]]},"!":[$t,[$t],(i,[r])=>!r.evaluate(i)],"is-supported-script":[$t,[Gt],(i,[r])=>{const o=i.globals&&i.globals.isSupportedScript;return o?o(r.evaluate(i)):!0}],upcase:[Gt,[Gt],(i,[r])=>r.evaluate(i).toUpperCase()],downcase:[Gt,[Gt],(i,[r])=>r.evaluate(i).toLowerCase()],concat:[Gt,yl(Nt),(i,r)=>r.map(o=>ap(o.evaluate(i))).join("")],"resolved-locale":[Gt,[Qf],(i,[r])=>r.evaluate(i).resolvedLocale()]});var O2=j2;function Uy(i){return{result:"success",value:i}}function iu(i){return{result:"error",value:i}}function hz(i){return i["property-type"]==="data-driven"}function pz(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function B2(i){return!!i.expression&&i.expression.interpolated}function H0(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function X0(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function dz(i){return i}function K0(i,r){const o=r.type==="color",h=i.stops&&typeof i.stops[0][0]=="object",m=h||i.property!==void 0,v=h||!m,f=i.type||(B2(r)?"exponential":"interval");if(o&&(i=d2({},i),i.stops&&(i.stops=i.stops.map(R=>[R[0],Ni.parse(R[1])])),i.default?i.default=Ni.parse(i.default):i.default=Ni.parse(r.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!z2[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let l,C,M;if(f==="exponential")l=p1;else if(f==="interval")l=mz;else if(f==="categorical"){l=fz,C=Object.create(null);for(const R of i.stops)C[R[0]]=R[1];M=typeof i.stops[0][0]}else if(f==="identity")l=gz;else throw new Error(`Unknown function type "${f}"`);if(h){const R={},j=[];for(let J=0;J<i.stops.length;J++){const le=i.stops[J],we=le[0].zoom;R[we]===void 0&&(R[we]={zoom:we,type:i.type,property:i.property,default:i.default,stops:[]},j.push(we)),R[we].stops.push([le[0].value,le[1]])}const G=[];for(const J of j)G.push([R[J].zoom,K0(R[J],r)]);const B={name:"linear"};return{kind:"composite",interpolationType:B,interpolationFactor:No.interpolationFactor.bind(void 0,B),zoomStops:G.map(J=>J[0]),evaluate({zoom:J},le){return p1({stops:G,base:i.base},r,J).evaluate(J,le)}}}else if(v){const R=f==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:R,interpolationFactor:No.interpolationFactor.bind(void 0,R),zoomStops:i.stops.map(j=>j[0]),evaluate:({zoom:j})=>l(i,r,j,C,M)}}else return{kind:"source",evaluate(R,j){const G=j&&j.properties?j.properties[i.property]:void 0;return G===void 0?Rp(i.default,r.default):l(i,r,G,C,M)}}}function Rp(i,r,o){if(i!==void 0)return i;if(r!==void 0)return r;if(o!==void 0)return o}function fz(i,r,o,h,m){const v=typeof o===m?h[o]:void 0;return Rp(v,i.default,r.default)}function mz(i,r,o){if(H0(o)!=="number")return Rp(i.default,r.default);const h=i.stops.length;if(h===1||o<=i.stops[0][0])return i.stops[0][1];if(o>=i.stops[h-1][0])return i.stops[h-1][1];const m=nm(i.stops.map(v=>v[0]),o);return i.stops[m][1]}function p1(i,r,o){const h=i.base!==void 0?i.base:1;if(H0(o)!=="number")return Rp(i.default,r.default);const m=i.stops.length;if(m===1||o<=i.stops[0][0])return i.stops[0][1];if(o>=i.stops[m-1][0])return i.stops[m-1][1];const v=nm(i.stops.map(R=>R[0]),o),f=yz(o,h,i.stops[v][0],i.stops[v+1][0]),l=i.stops[v][1],C=i.stops[v+1][1];let M=S2[r.type]||dz;if(i.colorSpace&&i.colorSpace!=="rgb"){const R=z2[i.colorSpace];M=(j,G)=>R.reverse(R.interpolate(R.forward(j),R.forward(G),f))}return typeof l.evaluate=="function"?{evaluate(...R){const j=l.evaluate.apply(void 0,R),G=C.evaluate.apply(void 0,R);if(!(j===void 0||G===void 0))return M(j,G,f)}}:M(l,C,f)}function gz(i,r,o){return r.type==="color"?o=Ni.parse(o):r.type==="formatted"?o=Pa.fromString(o.toString()):r.type==="resolvedImage"?o=Go.fromString(o.toString()):H0(o)!==r.type&&(r.type!=="enum"||!r.values[o])&&(o=void 0),Rp(o,i.default,r.default)}function yz(i,r,o,h){const m=h-o,v=i-o;return m===0?0:r===1?v/m:(Math.pow(r,v)-1)/(Math.pow(r,m)-1)}class $2{constructor(r,o){this.expression=r,this._warningHistory={},this._evaluator=new g2,this._defaultValue=o?bz(o):null,this._enumValues=o&&o.type==="enum"?o.values:null}evaluateWithoutErrorHandling(r,o,h,m,v,f,l,C){return this._evaluator.globals=r,this._evaluator.feature=o,this._evaluator.featureState=h,this._evaluator.canonical=m||null,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=f,this._evaluator.featureTileCoord=l||null,this._evaluator.featureDistanceData=C||null,this.expression.evaluate(this._evaluator)}evaluate(r,o,h,m,v,f,l,C){this._evaluator.globals=r,this._evaluator.feature=o||null,this._evaluator.featureState=h||null,this._evaluator.canonical=m||null,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=f||null,this._evaluator.featureTileCoord=l||null,this._evaluator.featureDistanceData=C||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!==M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new Ui(`Expected value to be one of ${Object.keys(this._enumValues).map(R=>JSON.stringify(R)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(M.message)),this._defaultValue}}}function N2(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in O2}function U2(i,r){const o=new x2(O2,[],r?vz(r):void 0),h=o.parse(i,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Uy(new $2(h,r)):iu(o.errors)}class Vy{constructor(r,o){this.kind=r,this._styleExpression=o,this.isStateDependent=r!=="constant"&&!F0(o.expression)}evaluateWithoutErrorHandling(r,o,h,m,v,f){return this._styleExpression.evaluateWithoutErrorHandling(r,o,h,m,v,f)}evaluate(r,o,h,m,v,f){return this._styleExpression.evaluate(r,o,h,m,v,f)}}class qy{constructor(r,o,h,m){this.kind=r,this.zoomStops=h,this._styleExpression=o,this.isStateDependent=r!=="camera"&&!F0(o.expression),this.interpolationType=m}evaluateWithoutErrorHandling(r,o,h,m,v,f){return this._styleExpression.evaluateWithoutErrorHandling(r,o,h,m,v,f)}evaluate(r,o,h,m,v,f){return this._styleExpression.evaluate(r,o,h,m,v,f)}interpolationFactor(r,o,h){return this.interpolationType?No.interpolationFactor(this.interpolationType,r,o,h):0}}function V2(i,r){if(i=U2(i,r),i.result==="error")return i;const o=i.value.expression,h=D0(o);if(!h&&!hz(r))return iu([new to("","data expressions not supported")]);const m=j0(o,["zoom","pitch","distance-from-center"]);if(!m&&!pz(r))return iu([new to("","zoom expressions not supported")]);const v=hf(o);if(!v&&!m)return iu([new to("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(v instanceof to)return iu([v]);if(v instanceof No&&!B2(r))return iu([new to("",'"interpolate" expressions cannot be used with this property')]);if(!v)return Uy(h?new Vy("constant",i.value):new Vy("source",i.value));const f=v instanceof No?v.interpolation:void 0;return Uy(h?new qy("camera",i.value,v.labels,f):new qy("composite",i.value,v.labels,f))}class am{constructor(r,o){this._parameters=r,this._specification=o,d2(this,K0(this._parameters,this._specification))}static deserialize(r){return new am(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function _z(i,r){if(X0(i))return new am(i,r);if(N2(i)){const o=V2(i,r);if(o.result==="error")throw new Error(o.value.map(h=>`${h.key}: ${h.message}`).join(", "));return o.value}else{let o=i;return typeof i=="string"&&r.type==="color"&&(o=Ni.parse(i)),{kind:"constant",evaluate:()=>o}}}function hf(i){let r=null;if(i instanceof L2)r=hf(i.result);else if(i instanceof R2){for(const o of i.args)if(r=hf(o),r)break}else(i instanceof w2||i instanceof No)&&i.input instanceof Mu&&i.input.name==="zoom"&&(r=i);return r instanceof to||i.eachChild(o=>{const h=hf(o);h instanceof to?r=h:!r&&h?r=new to("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&h&&r!==h&&(r=new to("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}function vz(i){const r={color:$o,string:Gt,number:Ke,enum:Gt,boolean:$t,formatted:em,resolvedImage:zp};return i.type==="array"?ta(r[i.value]||Nt,i.length):r[i.type]}function bz(i){return i.type==="color"&&(X0(i.default)||Array.isArray(i.default))?new Ni(0,0,0,0):i.type==="color"?Ni.parse(i.default)||null:i.default===void 0?null:i.default}function xp(i){return typeof i=="object"?["literal",i]:i}function xz(i,r){let o=i.stops;if(!o)return wz(i,r);const h=o&&typeof o[0][0]=="object",m=h||i.property!==void 0,v=h||!m;return o=o.map(f=>!m&&r.tokens&&typeof f[1]=="string"?[f[0],Cz(f[1])]:[f[0],xp(f[1])]),h?Tz(i,r,o):v?kz(i,r,o):Gy(i,r,o)}function wz(i,r){const o=["get",i.property];if(i.default===void 0)return r.type==="string"?["string",o]:o;if(r.type==="enum")return["match",o,Object.keys(r.values),o,i.default];{const h=[r.type==="color"?"to-color":r.type,o,xp(i.default)];return r.type==="array"&&h.splice(1,0,r.value,r.length||null),h}}function Y0(i){switch(i.colorSpace){case"hcl":return"interpolate-hcl";case"lab":return"interpolate-lab";default:return"interpolate"}}function Tz(i,r,o){const h={},m={},v=[];for(let f=0;f<o.length;f++){const l=o[f],C=l[0].zoom;h[C]===void 0&&(h[C]={zoom:C,type:i.type,property:i.property,default:i.default},m[C]=[],v.push(C)),m[C].push([l[0].value,l[1]])}if(Q0({},r)==="exponential"){const f=[Y0(i),["linear"],["zoom"]];for(const l of v){const C=Gy(h[l],r,m[l]);gu(f,l,C,!1)}return f}else{const f=["step",["zoom"]];for(const l of v){const C=Gy(h[l],r,m[l]);gu(f,l,C,!0)}return J0(f),f}}function Sz(i,r){if(i!==void 0)return i;if(r!==void 0)return r}function d1(i,r){const o=xp(Sz(i.default,r.default));return o===void 0&&r.type==="resolvedImage"?"":o}function Gy(i,r,o){const h=Q0(i,r),m=["get",i.property];if(h==="categorical"&&typeof o[0][0]=="boolean"){const v=["case"];for(const f of o)v.push(["==",m,f[0]],f[1]);return v.push(d1(i,r)),v}else if(h==="categorical"){const v=["match",m];for(const f of o)gu(v,f[0],f[1],!1);return v.push(d1(i,r)),v}else if(h==="interval"){const v=["step",["number",m]];for(const f of o)gu(v,f[0],f[1],!0);return J0(v),i.default===void 0?v:["case",["==",["typeof",m],"number"],v,xp(i.default)]}else if(h==="exponential"){const v=i.base!==void 0?i.base:1,f=[Y0(i),v===1?["linear"]:["exponential",v],["number",m]];for(const l of o)gu(f,l[0],l[1],!1);return i.default===void 0?f:["case",["==",["typeof",m],"number"],f,xp(i.default)]}else throw new Error(`Unknown property function type ${h}`)}function kz(i,r,o,h=["zoom"]){const m=Q0(i,r);let v,f=!1;if(m==="interval")v=["step",h],f=!0;else if(m==="exponential"){const l=i.base!==void 0?i.base:1;v=[Y0(i),l===1?["linear"]:["exponential",l],h]}else throw new Error(`Unknown zoom function type "${m}"`);for(const l of o)gu(v,l[0],l[1],f);return J0(v),v}function J0(i){i[0]==="step"&&i.length===3&&(i.push(0),i.push(i[3]))}function gu(i,r,o,h){i.length>3&&r===i[i.length-2]||(h&&i.length===2||i.push(r),i.push(o))}function Q0(i,r){return i.type?i.type:r.expression.interpolated?"exponential":"interval"}function Cz(i){const r=["concat"],o=/{([^{}]+)}/g;let h=0;for(let m=o.exec(i);m!==null;m=o.exec(i)){const v=i.slice(h,o.lastIndex-m[0].length);h=o.lastIndex,v.length>0&&r.push(v),r.push(["get",m[1]])}if(r.length===1)return i;if(h<i.length)r.push(i.slice(h));else if(r.length===2)return["to-string",r[1]];return r}function q2(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const r of i.slice(1))if(!q2(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}function Pz(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Mz={};(function(i){var r=(function(){var o=function(we,pe,xe,de){for(xe=xe||{},de=we.length;de--;xe[we[de]]=pe);return xe},h=[1,12],m=[1,13],v=[1,9],f=[1,10],l=[1,11],C=[1,14],M=[1,15],R=[14,18,22,24],j=[18,22],G=[22,24],B={trace:function(){},yy:{},symbols_:{error:2,JSONString:3,STRING:4,JSONNumber:5,NUMBER:6,JSONNullLiteral:7,NULL:8,JSONBooleanLiteral:9,TRUE:10,FALSE:11,JSONText:12,JSONValue:13,EOF:14,JSONObject:15,JSONArray:16,"{":17,"}":18,JSONMemberList:19,JSONMember:20,":":21,",":22,"[":23,"]":24,JSONElementList:25,$accept:0,$end:1},terminals_:{2:"error",4:"STRING",6:"NUMBER",8:"NULL",10:"TRUE",11:"FALSE",14:"EOF",17:"{",18:"}",21:":",22:",",23:"[",24:"]"},productions_:[0,[3,1],[5,1],[7,1],[9,1],[9,1],[12,2],[13,1],[13,1],[13,1],[13,1],[13,1],[13,1],[15,2],[15,3],[20,3],[19,1],[19,3],[16,2],[16,3],[25,1],[25,3]],performAction:function(we,pe,xe,de,he,fe,Ae){var Fe=fe.length-1;switch(he){case 1:this.$=new String(we.replace(/\\(\\|")/g,"$1").replace(/\\n/g,`
`).replace(/\\r/g,"\r").replace(/\\t/g,"	").replace(/\\v/g,"\v").replace(/\\f/g,"\f").replace(/\\b/g,"\b")),this.$.__line__=this._$.first_line;break;case 2:this.$=new Number(we),this.$.__line__=this._$.first_line;break;case 3:this.$=null;break;case 4:this.$=new Boolean(!0),this.$.__line__=this._$.first_line;break;case 5:this.$=new Boolean(!1),this.$.__line__=this._$.first_line;break;case 6:return this.$=fe[Fe-1];case 13:this.$={},Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 14:case 19:this.$=fe[Fe-1],Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 15:this.$=[fe[Fe-2],fe[Fe]];break;case 16:this.$={},this.$[fe[Fe][0]]=fe[Fe][1];break;case 17:this.$=fe[Fe-2],fe[Fe-2][fe[Fe][0]]=fe[Fe][1];break;case 18:this.$=[],Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 20:this.$=[fe[Fe]];break;case 21:this.$=fe[Fe-2],fe[Fe-2].push(fe[Fe]);break}},table:[{3:5,4:h,5:6,6:m,7:3,8:v,9:4,10:f,11:l,12:1,13:2,15:7,16:8,17:C,23:M},{1:[3]},{14:[1,16]},o(R,[2,7]),o(R,[2,8]),o(R,[2,9]),o(R,[2,10]),o(R,[2,11]),o(R,[2,12]),o(R,[2,3]),o(R,[2,4]),o(R,[2,5]),o([14,18,21,22,24],[2,1]),o(R,[2,2]),{3:20,4:h,18:[1,17],19:18,20:19},{3:5,4:h,5:6,6:m,7:3,8:v,9:4,10:f,11:l,13:23,15:7,16:8,17:C,23:M,24:[1,21],25:22},{1:[2,6]},o(R,[2,13]),{18:[1,24],22:[1,25]},o(j,[2,16]),{21:[1,26]},o(R,[2,18]),{22:[1,28],24:[1,27]},o(G,[2,20]),o(R,[2,14]),{3:20,4:h,20:29},{3:5,4:h,5:6,6:m,7:3,8:v,9:4,10:f,11:l,13:30,15:7,16:8,17:C,23:M},o(R,[2,19]),{3:5,4:h,5:6,6:m,7:3,8:v,9:4,10:f,11:l,13:31,15:7,16:8,17:C,23:M},o(j,[2,17]),o(j,[2,15]),o(G,[2,21])],defaultActions:{16:[2,6]},parseError:function(we,pe){if(pe.recoverable)this.trace(we);else throw new Error(we)},parse:function(we){var pe=this,xe=[0],de=[null],he=[],fe=this.table,Ae="",Fe=0,He=0,rt=2,et=1,It=he.slice.call(arguments,1),bt=Object.create(this.lexer),er={yy:{}};for(var dr in this.yy)Object.prototype.hasOwnProperty.call(this.yy,dr)&&(er.yy[dr]=this.yy[dr]);bt.setInput(we,er.yy),er.yy.lexer=bt,er.yy.parser=this,typeof bt.yylloc>"u"&&(bt.yylloc={});var Lr=bt.yylloc;he.push(Lr);var hi=bt.options&&bt.options.ranges;typeof er.yy.parseError=="function"?this.parseError=er.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;function bi(){var nr;return nr=bt.lex()||et,typeof nr!="number"&&(nr=pe.symbols_[nr]||nr),nr}for(var fr,At,Qe,lt,xt={},gt,yt,Kt,Et;;){if(At=xe[xe.length-1],this.defaultActions[At]?Qe=this.defaultActions[At]:((fr===null||typeof fr>"u")&&(fr=bi()),Qe=fe[At]&&fe[At][fr]),typeof Qe>"u"||!Qe.length||!Qe[0]){var br="";Et=[];for(gt in fe[At])this.terminals_[gt]&&gt>rt&&Et.push("'"+this.terminals_[gt]+"'");bt.showPosition?br="Parse error on line "+(Fe+1)+`:
`+bt.showPosition()+`
Expecting `+Et.join(", ")+", got '"+(this.terminals_[fr]||fr)+"'":br="Parse error on line "+(Fe+1)+": Unexpected "+(fr==et?"end of input":"'"+(this.terminals_[fr]||fr)+"'"),this.parseError(br,{text:bt.match,token:this.terminals_[fr]||fr,line:bt.yylineno,loc:Lr,expected:Et})}if(Qe[0]instanceof Array&&Qe.length>1)throw new Error("Parse Error: multiple actions possible at state: "+At+", token: "+fr);switch(Qe[0]){case 1:xe.push(fr),de.push(bt.yytext),he.push(bt.yylloc),xe.push(Qe[1]),fr=null,He=bt.yyleng,Ae=bt.yytext,Fe=bt.yylineno,Lr=bt.yylloc;break;case 2:if(yt=this.productions_[Qe[1]][1],xt.$=de[de.length-yt],xt._$={first_line:he[he.length-(yt||1)].first_line,last_line:he[he.length-1].last_line,first_column:he[he.length-(yt||1)].first_column,last_column:he[he.length-1].last_column},hi&&(xt._$.range=[he[he.length-(yt||1)].range[0],he[he.length-1].range[1]]),lt=this.performAction.apply(xt,[Ae,He,Fe,er.yy,Qe[1],de,he].concat(It)),typeof lt<"u")return lt;yt&&(xe=xe.slice(0,-1*yt*2),de=de.slice(0,-1*yt),he=he.slice(0,-1*yt)),xe.push(this.productions_[Qe[1]][0]),de.push(xt.$),he.push(xt._$),Kt=fe[xe[xe.length-2]][xe[xe.length-1]],xe.push(Kt);break;case 3:return!0}}return!0}},J=(function(){var we={EOF:1,parseError:function(pe,xe){if(this.yy.parser)this.yy.parser.parseError(pe,xe);else throw new Error(pe)},setInput:function(pe,xe){return this.yy=xe||this.yy||{},this._input=pe,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var pe=this._input[0];this.yytext+=pe,this.yyleng++,this.offset++,this.match+=pe,this.matched+=pe;var xe=pe.match(/(?:\r\n?|\n).*/g);return xe?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),pe},unput:function(pe){var xe=pe.length,de=pe.split(/(?:\r\n?|\n)/g);this._input=pe+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-xe),this.offset-=xe;var he=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),de.length-1&&(this.yylineno-=de.length-1);var fe=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:de?(de.length===he.length?this.yylloc.first_column:0)+he[he.length-de.length].length-de[0].length:this.yylloc.first_column-xe},this.options.ranges&&(this.yylloc.range=[fe[0],fe[0]+this.yyleng-xe]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+`. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).
`+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(pe){this.unput(this.match.slice(pe))},pastInput:function(){var pe=this.matched.substr(0,this.matched.length-this.match.length);return(pe.length>20?"...":"")+pe.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var pe=this.match;return pe.length<20&&(pe+=this._input.substr(0,20-pe.length)),(pe.substr(0,20)+(pe.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var pe=this.pastInput(),xe=new Array(pe.length+1).join("-");return pe+this.upcomingInput()+`
`+xe+"^"},test_match:function(pe,xe){var de,he,fe;if(this.options.backtrack_lexer&&(fe={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(fe.yylloc.range=this.yylloc.range.slice(0))),he=pe[0].match(/(?:\r\n?|\n).*/g),he&&(this.yylineno+=he.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:he?he[he.length-1].length-he[he.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+pe[0].length},this.yytext+=pe[0],this.match+=pe[0],this.matches=pe,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(pe[0].length),this.matched+=pe[0],de=this.performAction.call(this,this.yy,this,xe,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),de)return de;if(this._backtrack){for(var Ae in fe)this[Ae]=fe[Ae];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var pe,xe,de,he;this._more||(this.yytext="",this.match="");for(var fe=this._currentRules(),Ae=0;Ae<fe.length;Ae++)if(de=this._input.match(this.rules[fe[Ae]]),de&&(!xe||de[0].length>xe[0].length)){if(xe=de,he=Ae,this.options.backtrack_lexer){if(pe=this.test_match(de,fe[Ae]),pe!==!1)return pe;if(this._backtrack){xe=!1;continue}else return!1}else if(!this.options.flex)break}return xe?(pe=this.test_match(xe,fe[he]),pe!==!1?pe:!1):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var pe=this.next();return pe||this.lex()},begin:function(pe){this.conditionStack.push(pe)},popState:function(){var pe=this.conditionStack.length-1;return pe>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(pe){return pe=this.conditionStack.length-1-Math.abs(pe||0),pe>=0?this.conditionStack[pe]:"INITIAL"},pushState:function(pe){this.begin(pe)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(pe,xe,de,he){switch(de){case 0:break;case 1:return 6;case 2:return xe.yytext=xe.yytext.substr(1,xe.yyleng-2),4;case 3:return 17;case 4:return 18;case 5:return 23;case 6:return 24;case 7:return 22;case 8:return 21;case 9:return 10;case 10:return 11;case 11:return 8;case 12:return 14;case 13:return"INVALID"}},rules:[/^(?:\s+)/,/^(?:(-?([0-9]|[1-9][0-9]+))(\.[0-9]+)?([eE][-+]?[0-9]+)?\b)/,/^(?:"(?:\\[\\"bfnrt/]|\\u[a-fA-F0-9]{4}|[^\\\0-\x09\x0a-\x1f"])*")/,/^(?:\{)/,/^(?:\})/,/^(?:\[)/,/^(?:\])/,/^(?:,)/,/^(?::)/,/^(?:true\b)/,/^(?:false\b)/,/^(?:null\b)/,/^(?:$)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],inclusive:!0}}};return we})();B.lexer=J;function le(){this.yy={}}return le.prototype=B,B.Parser=le,new le})();typeof Pz<"u"&&(i.parser=r,i.Parser=r.Parser,i.parse=function(){return r.parse.apply(r,arguments)})})(Mz);const Az={StyleExpression:$2,isExpression:N2,isExpressionFilter:q2,createExpression:U2,createPropertyExpression:V2,normalizePropertyExpression:_z,ZoomConstantExpression:Vy,ZoomDependentExpression:qy,StylePropertyFunction:am},Ez={convertFunction:xz,createFunction:K0,isFunction:X0};function Iz(i){var r=i.expr,o=i.layer,h=Math.min(r(o,"paint","circle-radius"),8),m=Math.min(r(o,"paint","circle-stroke-width"),4),v=r(o,"paint","circle-color"),f=r(o,"paint","circle-opacity"),l=r(o,"paint","circle-stroke-color"),C=r(o,"paint","circle-stroke-opacity"),M=h-m/2;return{element:"svg",attributes:{viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",style:{filter:"blur("+r(o,"paint","circle-blur")*M+"px)"}},children:[{element:"circle",attributes:{key:"l1",cx:10,cy:10,fill:v,opacity:f,r:M}},{element:"circle",attributes:{key:"l2",cx:10,cy:10,fill:"transparent",opacity:C,r:h,"stroke-width":m,stroke:l}}]}}function zz(i){var r=i.expr,o=i.layer;return{element:"div",attributes:{style:{width:"100%",height:"100%",backgroundImage:"url("+(0,i.image)(r(o,"paint","fill-pattern"))+")",backgroundColor:r(o,"paint","fill-color"),opacity:r(o,"paint","fill-opacity"),backgroundSize:"66% 66%",backgroundPosition:"center"}}}}function Rz(i){var r=i.layer,o=i.expr,h=(0,i.image)(o(r,"paint","line-pattern")),m={stroke:h?"url(#img1)":o(r,"paint","line-color"),strokeWidth:Math.max(2,Math.min(o(r,"paint","line-width"),8)),strokeOpacity:o(r,"paint","line-opacity"),strokeDasharray:o(r,"paint","line-dasharray")},v=m.strokeWidth,f="stroke: "+m.stroke+";";return m.strokeOpacity&&(f+="stroke-opacity: "+m.strokeOpacity+";"),m.strokeDasharray&&(f+="stroke-dasharray: "+m.strokeDasharray+";"),{element:"svg",attributes:{viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},children:[{element:"defs",attributes:{key:"defs"},children:[{element:"pattern",attributes:{key:"pattern",id:"img1",x:0,y:0,width:m.strokeWidth,height:m.strokeWidth,patternUnits:"userSpaceOnUse",patternTransform:"translate("+-v/2+" "+-v/2+") rotate(45)"},children:[{element:"image",attributes:{key:"img",xlinkHref:h,x:0,y:0,width:m.strokeWidth,height:m.strokeWidth}}]}]},{element:"path",attributes:{key:"path",style:f,d:"M0 20 L 20 0"}}]}}function Lz(i){return(function(l){var C=l.image,M=(0,l.expr)(l.layer,"layout","icon-image");if(!M)return null;var R=C(M);return R?{element:"div",attributes:{style:{backgroundImage:"url("+R+")",backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat",width:"100%",height:"100%"}}}:null})(i)||(m=(o=(r=i).expr)(h=r.layer,"paint","text-color"),v=o(h,"paint","text-opacity"),{element:"svg",attributes:{viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},children:[{element:"path",attributes:{key:"l1",d:f="M 4,4 L 16,4 L 16,7 L 11.5 7 L 11.5 16 L 8.5 16 L 8.5 7 L 4 7 Z",stroke:o(h,"paint","text-halo-color"),"stroke-width":2*o(h,"paint","text-halo-width"),fill:"transparent","stroke-linejoin":"round"}},{element:"path",attributes:{key:"l2",d:f,fill:"white"}},{element:"path",attributes:{key:"l3",d:f,fill:m,opacity:v}}]});var r,o,h,m,v,f}var Dz=[["background"],["circle"],["fill-extrusion"],["fill"],["heatmap"],["hillshade"],["line"],["raster"],["icon","symbol"],["text","symbol"]];function Fz(i){var r,o=i.sprite,h=i.layer,m={circle:Iz,symbol:Lz,line:Rz,fill:zz}[h.type],v=(r=i.zoom,function(f,l,C){var M=(function(J){var le=Dz.find(function(we){return J.startsWith(we[0])});return le?le[1]||le[0]:null})(C),R=nI[l+"_"+M][C];if(!f[l])return R.default;var j=f[l][C];if(j===void 0)return R.default;if(typeof j=="object"){var G;if(Array.isArray(j)){if(R.type==="array")return j;G=Az.createExpression(j).value}else G=Ez.createFunction(j,R);if(!G.evaluate)return null;var B=G.evaluate({zoom:r},{});return B?B.name||B:null}return j});return m?m({layer:h,expr:v,image:function(f){if(o&&o.json){var l=o.json[f];if(l)return C=o.image,R=(M=l).x,j=M.y,G=M.width,B=M.height,(J=document.createElement("canvas")).width=2*G,J.height=2*B,J.getContext("2d").drawImage(C,2*R,2*j,2*G,2*B,0,0,2*G,2*B),J.toDataURL()}var C,M,R,j,G,B,J;return null}}):null}function jz(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var e_={exports:{}},G2=function(i,r){return function(){for(var o=new Array(arguments.length),h=0;h<o.length;h++)o[h]=arguments[h];return i.apply(r,o)}},Oz=G2,t_=Object.prototype.toString,r_=(function(i){return function(r){var o=t_.call(r);return i[o]||(i[o]=o.slice(8,-1).toLowerCase())}})(Object.create(null));function Zl(i){return i=i.toLowerCase(),function(r){return r_(r)===i}}function i_(i){return Array.isArray(i)}function Rf(i){return typeof i>"u"}function Bz(i){return i!==null&&!Rf(i)&&i.constructor!==null&&!Rf(i.constructor)&&typeof i.constructor.isBuffer=="function"&&i.constructor.isBuffer(i)}var Z2=Zl("ArrayBuffer");function $z(i){var r;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?r=ArrayBuffer.isView(i):r=i&&i.buffer&&Z2(i.buffer),r}function Nz(i){return typeof i=="string"}function Uz(i){return typeof i=="number"}function W2(i){return i!==null&&typeof i=="object"}function pf(i){if(r_(i)!=="object")return!1;var r=Object.getPrototypeOf(i);return r===null||r===Object.prototype}var Vz=Zl("Date"),qz=Zl("File"),Gz=Zl("Blob"),Zz=Zl("FileList");function n_(i){return t_.call(i)==="[object Function]"}function Wz(i){return W2(i)&&n_(i.pipe)}function Hz(i){var r="[object FormData]";return i&&(typeof FormData=="function"&&i instanceof FormData||t_.call(i)===r||n_(i.toString)&&i.toString()===r)}var Xz=Zl("URLSearchParams");function Kz(i){return i.trim?i.trim():i.replace(/^\s+|\s+$/g,"")}function Yz(){return typeof navigator<"u"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window<"u"&&typeof document<"u"}function a_(i,r){if(!(i===null||typeof i>"u"))if(typeof i!="object"&&(i=[i]),i_(i))for(var o=0,h=i.length;o<h;o++)r.call(null,i[o],o,i);else for(var m in i)Object.prototype.hasOwnProperty.call(i,m)&&r.call(null,i[m],m,i)}function Zy(){var i={};function r(m,v){pf(i[v])&&pf(m)?i[v]=Zy(i[v],m):pf(m)?i[v]=Zy({},m):i_(m)?i[v]=m.slice():i[v]=m}for(var o=0,h=arguments.length;o<h;o++)a_(arguments[o],r);return i}function Jz(i,r,o){return a_(r,function(h,m){o&&typeof h=="function"?i[m]=Oz(h,o):i[m]=h}),i}function Qz(i){return i.charCodeAt(0)===65279&&(i=i.slice(1)),i}function e3(i,r,o,h){i.prototype=Object.create(r.prototype,h),i.prototype.constructor=i,o&&Object.assign(i.prototype,o)}function t3(i,r,o){var h,m,v,f={};r=r||{};do{for(h=Object.getOwnPropertyNames(i),m=h.length;m-- >0;)v=h[m],f[v]||(r[v]=i[v],f[v]=!0);i=Object.getPrototypeOf(i)}while(i&&(!o||o(i,r))&&i!==Object.prototype);return r}function r3(i,r,o){i=String(i),(o===void 0||o>i.length)&&(o=i.length),o-=r.length;var h=i.indexOf(r,o);return h!==-1&&h===o}function i3(i){if(!i)return null;var r=i.length;if(Rf(r))return null;for(var o=new Array(r);r-- >0;)o[r]=i[r];return o}var n3=(function(i){return function(r){return i&&r instanceof i}})(typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array)),Vi={isArray:i_,isArrayBuffer:Z2,isBuffer:Bz,isFormData:Hz,isArrayBufferView:$z,isString:Nz,isNumber:Uz,isObject:W2,isPlainObject:pf,isUndefined:Rf,isDate:Vz,isFile:qz,isBlob:Gz,isFunction:n_,isStream:Wz,isURLSearchParams:Xz,isStandardBrowserEnv:Yz,forEach:a_,merge:Zy,extend:Jz,trim:Kz,stripBOM:Qz,inherits:e3,toFlatObject:t3,kindOf:r_,kindOfTest:Zl,endsWith:r3,toArray:i3,isTypedArray:n3,isFileList:Zz},Kc=Vi;function f1(i){return encodeURIComponent(i).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var H2=function(i,r,o){if(!r)return i;var h;if(o)h=o(r);else if(Kc.isURLSearchParams(r))h=r.toString();else{var m=[];Kc.forEach(r,function(f,l){f===null||typeof f>"u"||(Kc.isArray(f)?l=l+"[]":f=[f],Kc.forEach(f,function(C){Kc.isDate(C)?C=C.toISOString():Kc.isObject(C)&&(C=JSON.stringify(C)),m.push(f1(l)+"="+f1(C))}))}),h=m.join("&")}if(h){var v=i.indexOf("#");v!==-1&&(i=i.slice(0,v)),i+=(i.indexOf("?")===-1?"?":"&")+h}return i},a3=Vi;function om(){this.handlers=[]}om.prototype.use=function(i,r,o){return this.handlers.push({fulfilled:i,rejected:r,synchronous:o?o.synchronous:!1,runWhen:o?o.runWhen:null}),this.handlers.length-1};om.prototype.eject=function(i){this.handlers[i]&&(this.handlers[i]=null)};om.prototype.forEach=function(i){a3.forEach(this.handlers,function(r){r!==null&&i(r)})};var o3=om,s3=Vi,l3=function(i,r){s3.forEach(i,function(o,h){h!==r&&h.toUpperCase()===r.toUpperCase()&&(i[r]=o,delete i[h])})},X2=Vi;function xu(i,r,o,h,m){Error.call(this),this.message=i,this.name="AxiosError",r&&(this.code=r),o&&(this.config=o),h&&(this.request=h),m&&(this.response=m)}X2.inherits(xu,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var K2=xu.prototype,Y2={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(i){Y2[i]={value:i}});Object.defineProperties(xu,Y2);Object.defineProperty(K2,"isAxiosError",{value:!0});xu.from=function(i,r,o,h,m,v){var f=Object.create(K2);return X2.toFlatObject(i,f,function(l){return l!==Error.prototype}),xu.call(f,i.message,r,o,h,m),f.name=i.name,v&&Object.assign(f,v),f};var Eu=xu,J2={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},ba=Vi;function c3(i,r){r=r||new FormData;var o=[];function h(v){return v===null?"":ba.isDate(v)?v.toISOString():ba.isArrayBuffer(v)||ba.isTypedArray(v)?typeof Blob=="function"?new Blob([v]):Buffer.from(v):v}function m(v,f){if(ba.isPlainObject(v)||ba.isArray(v)){if(o.indexOf(v)!==-1)throw Error("Circular reference detected in "+f);o.push(v),ba.forEach(v,function(l,C){if(!ba.isUndefined(l)){var M=f?f+"."+C:C,R;if(l&&!f&&typeof l=="object"){if(ba.endsWith(C,"{}"))l=JSON.stringify(l);else if(ba.endsWith(C,"[]")&&(R=ba.toArray(l))){R.forEach(function(j){!ba.isUndefined(j)&&r.append(M,h(j))});return}}m(l,M)}}),o.pop()}else r.append(f,h(v))}return m(i),r}var Q2=c3,Qg,m1;function u3(){if(m1)return Qg;m1=1;var i=Eu;return Qg=function(r,o,h){var m=h.config.validateStatus;!h.status||!m||m(h.status)?r(h):o(new i("Request failed with status code "+h.status,[i.ERR_BAD_REQUEST,i.ERR_BAD_RESPONSE][Math.floor(h.status/100)-4],h.config,h.request,h))},Qg}var ey,g1;function h3(){if(g1)return ey;g1=1;var i=Vi;return ey=i.isStandardBrowserEnv()?(function(){return{write:function(r,o,h,m,v,f){var l=[];l.push(r+"="+encodeURIComponent(o)),i.isNumber(h)&&l.push("expires="+new Date(h).toGMTString()),i.isString(m)&&l.push("path="+m),i.isString(v)&&l.push("domain="+v),f===!0&&l.push("secure"),document.cookie=l.join("; ")},read:function(r){var o=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return o?decodeURIComponent(o[3]):null},remove:function(r){this.write(r,"",Date.now()-864e5)}}})():(function(){return{write:function(){},read:function(){return null},remove:function(){}}})(),ey}var p3=function(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)},d3=function(i,r){return r?i.replace(/\/+$/,"")+"/"+r.replace(/^\/+/,""):i},f3=p3,m3=d3,eT=function(i,r){return i&&!f3(r)?m3(i,r):r},ty,y1;function g3(){if(y1)return ty;y1=1;var i=Vi,r=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return ty=function(o){var h={},m,v,f;return o&&i.forEach(o.split(`
`),function(l){if(f=l.indexOf(":"),m=i.trim(l.substr(0,f)).toLowerCase(),v=i.trim(l.substr(f+1)),m){if(h[m]&&r.indexOf(m)>=0)return;m==="set-cookie"?h[m]=(h[m]?h[m]:[]).concat([v]):h[m]=h[m]?h[m]+", "+v:v}}),h},ty}var ry,_1;function y3(){if(_1)return ry;_1=1;var i=Vi;return ry=i.isStandardBrowserEnv()?(function(){var r=/(msie|trident)/i.test(navigator.userAgent),o=document.createElement("a"),h;function m(v){var f=v;return r&&(o.setAttribute("href",f),f=o.href),o.setAttribute("href",f),{href:o.href,protocol:o.protocol?o.protocol.replace(/:$/,""):"",host:o.host,search:o.search?o.search.replace(/^\?/,""):"",hash:o.hash?o.hash.replace(/^#/,""):"",hostname:o.hostname,port:o.port,pathname:o.pathname.charAt(0)==="/"?o.pathname:"/"+o.pathname}}return h=m(window.location.href),function(v){var f=i.isString(v)?m(v):v;return f.protocol===h.protocol&&f.host===h.host}})():(function(){return function(){return!0}})(),ry}var iy,v1;function sm(){if(v1)return iy;v1=1;var i=Eu,r=Vi;function o(h){i.call(this,h??"canceled",i.ERR_CANCELED),this.name="CanceledError"}return r.inherits(o,i,{__CANCEL__:!0}),iy=o,iy}var b1,x1;function _3(){return x1||(x1=1,b1=function(i){var r=/^([-+\w]{1,25})(:?\/\/|:)/.exec(i);return r&&r[1]||""}),b1}var ny,w1;function v3(){if(w1)return ny;w1=1;var i=Vi,r=u3(),o=h3(),h=H2,m=eT,v=g3(),f=y3(),l=J2,C=Eu,M=sm(),R=_3();return ny=function(j){return new Promise(function(G,B){var J=j.data,le=j.headers,we=j.responseType,pe;function xe(){j.cancelToken&&j.cancelToken.unsubscribe(pe),j.signal&&j.signal.removeEventListener("abort",pe)}i.isFormData(J)&&i.isStandardBrowserEnv()&&delete le["Content-Type"];var de=new XMLHttpRequest;if(j.auth){var he=j.auth.username||"",fe=j.auth.password?unescape(encodeURIComponent(j.auth.password)):"";le.Authorization="Basic "+btoa(he+":"+fe)}var Ae=m(j.baseURL,j.url);de.open(j.method.toUpperCase(),h(Ae,j.params,j.paramsSerializer),!0),de.timeout=j.timeout;function Fe(){if(de){var et="getAllResponseHeaders"in de?v(de.getAllResponseHeaders()):null,It=!we||we==="text"||we==="json"?de.responseText:de.response,bt={data:It,status:de.status,statusText:de.statusText,headers:et,config:j,request:de};r(function(er){G(er),xe()},function(er){B(er),xe()},bt),de=null}}if("onloadend"in de?de.onloadend=Fe:de.onreadystatechange=function(){!de||de.readyState!==4||de.status===0&&!(de.responseURL&&de.responseURL.indexOf("file:")===0)||setTimeout(Fe)},de.onabort=function(){de&&(B(new C("Request aborted",C.ECONNABORTED,j,de)),de=null)},de.onerror=function(){B(new C("Network Error",C.ERR_NETWORK,j,de,de)),de=null},de.ontimeout=function(){var et=j.timeout?"timeout of "+j.timeout+"ms exceeded":"timeout exceeded",It=j.transitional||l;j.timeoutErrorMessage&&(et=j.timeoutErrorMessage),B(new C(et,It.clarifyTimeoutError?C.ETIMEDOUT:C.ECONNABORTED,j,de)),de=null},i.isStandardBrowserEnv()){var He=(j.withCredentials||f(Ae))&&j.xsrfCookieName?o.read(j.xsrfCookieName):void 0;He&&(le[j.xsrfHeaderName]=He)}"setRequestHeader"in de&&i.forEach(le,function(et,It){typeof J>"u"&&It.toLowerCase()==="content-type"?delete le[It]:de.setRequestHeader(It,et)}),i.isUndefined(j.withCredentials)||(de.withCredentials=!!j.withCredentials),we&&we!=="json"&&(de.responseType=j.responseType),typeof j.onDownloadProgress=="function"&&de.addEventListener("progress",j.onDownloadProgress),typeof j.onUploadProgress=="function"&&de.upload&&de.upload.addEventListener("progress",j.onUploadProgress),(j.cancelToken||j.signal)&&(pe=function(et){de&&(B(!et||et&&et.type?new M:et),de.abort(),de=null)},j.cancelToken&&j.cancelToken.subscribe(pe),j.signal&&(j.signal.aborted?pe():j.signal.addEventListener("abort",pe))),J||(J=null);var rt=R(Ae);if(rt&&["http","https","file"].indexOf(rt)===-1){B(new C("Unsupported protocol "+rt+":",C.ERR_BAD_REQUEST,j));return}de.send(J)})},ny}var T1,S1;function b3(){return S1||(S1=1,T1=null),T1}var Ai=Vi,k1=l3,C1=Eu,x3=J2,w3=Q2,T3={"Content-Type":"application/x-www-form-urlencoded"};function P1(i,r){!Ai.isUndefined(i)&&Ai.isUndefined(i["Content-Type"])&&(i["Content-Type"]=r)}function S3(){var i;return(typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(i=v3()),i}function k3(i,r,o){if(Ai.isString(i))try{return(r||JSON.parse)(i),Ai.trim(i)}catch(h){if(h.name!=="SyntaxError")throw h}return(o||JSON.stringify)(i)}var lm={transitional:x3,adapter:S3(),transformRequest:[function(i,r){if(k1(r,"Accept"),k1(r,"Content-Type"),Ai.isFormData(i)||Ai.isArrayBuffer(i)||Ai.isBuffer(i)||Ai.isStream(i)||Ai.isFile(i)||Ai.isBlob(i))return i;if(Ai.isArrayBufferView(i))return i.buffer;if(Ai.isURLSearchParams(i))return P1(r,"application/x-www-form-urlencoded;charset=utf-8"),i.toString();var o=Ai.isObject(i),h=r&&r["Content-Type"],m;if((m=Ai.isFileList(i))||o&&h==="multipart/form-data"){var v=this.env&&this.env.FormData;return w3(m?{"files[]":i}:i,v&&new v)}else if(o||h==="application/json")return P1(r,"application/json"),k3(i);return i}],transformResponse:[function(i){var r=this.transitional||lm.transitional,o=r&&r.silentJSONParsing,h=r&&r.forcedJSONParsing,m=!o&&this.responseType==="json";if(m||h&&Ai.isString(i)&&i.length)try{return JSON.parse(i)}catch(v){if(m)throw v.name==="SyntaxError"?C1.from(v,C1.ERR_BAD_RESPONSE,this,null,this.response):v}return i}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:b3()},validateStatus:function(i){return i>=200&&i<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Ai.forEach(["delete","get","head"],function(i){lm.headers[i]={}});Ai.forEach(["post","put","patch"],function(i){lm.headers[i]=Ai.merge(T3)});var o_=lm,C3=Vi,P3=o_,M3=function(i,r,o){var h=this||P3;return C3.forEach(o,function(m){i=m.call(h,i,r)}),i},M1,A1;function tT(){return A1||(A1=1,M1=function(i){return!!(i&&i.__CANCEL__)}),M1}var E1=Vi,ay=M3,A3=tT(),E3=o_,I3=sm();function oy(i){if(i.cancelToken&&i.cancelToken.throwIfRequested(),i.signal&&i.signal.aborted)throw new I3}var z3=function(i){oy(i),i.headers=i.headers||{},i.data=ay.call(i,i.data,i.headers,i.transformRequest),i.headers=E1.merge(i.headers.common||{},i.headers[i.method]||{},i.headers),E1.forEach(["delete","get","head","post","put","patch","common"],function(o){delete i.headers[o]});var r=i.adapter||E3.adapter;return r(i).then(function(o){return oy(i),o.data=ay.call(i,o.data,o.headers,i.transformResponse),o},function(o){return A3(o)||(oy(i),o&&o.response&&(o.response.data=ay.call(i,o.response.data,o.response.headers,i.transformResponse))),Promise.reject(o)})},Ln=Vi,rT=function(i,r){r=r||{};var o={};function h(M,R){return Ln.isPlainObject(M)&&Ln.isPlainObject(R)?Ln.merge(M,R):Ln.isPlainObject(R)?Ln.merge({},R):Ln.isArray(R)?R.slice():R}function m(M){if(Ln.isUndefined(r[M])){if(!Ln.isUndefined(i[M]))return h(void 0,i[M])}else return h(i[M],r[M])}function v(M){if(!Ln.isUndefined(r[M]))return h(void 0,r[M])}function f(M){if(Ln.isUndefined(r[M])){if(!Ln.isUndefined(i[M]))return h(void 0,i[M])}else return h(void 0,r[M])}function l(M){if(M in r)return h(i[M],r[M]);if(M in i)return h(void 0,i[M])}var C={url:v,method:v,data:v,baseURL:f,transformRequest:f,transformResponse:f,paramsSerializer:f,timeout:f,timeoutMessage:f,withCredentials:f,adapter:f,responseType:f,xsrfCookieName:f,xsrfHeaderName:f,onUploadProgress:f,onDownloadProgress:f,decompress:f,maxContentLength:f,maxBodyLength:f,beforeRedirect:f,transport:f,httpAgent:f,httpsAgent:f,cancelToken:f,socketPath:f,responseEncoding:f,validateStatus:l};return Ln.forEach(Object.keys(i).concat(Object.keys(r)),function(M){var R=C[M]||m,j=R(M);Ln.isUndefined(j)&&R!==l||(o[M]=j)}),o},I1,z1;function iT(){return z1||(z1=1,I1={version:"0.27.2"}),I1}var R3=iT().version,ks=Eu,s_={};["object","boolean","number","function","string","symbol"].forEach(function(i,r){s_[i]=function(o){return typeof o===i||"a"+(r<1?"n ":" ")+i}});var R1={};s_.transitional=function(i,r,o){function h(m,v){return"[Axios v"+R3+"] Transitional option '"+m+"'"+v+(o?". "+o:"")}return function(m,v,f){if(i===!1)throw new ks(h(v," has been removed"+(r?" in "+r:"")),ks.ERR_DEPRECATED);return r&&!R1[v]&&(R1[v]=!0,console.warn(h(v," has been deprecated since v"+r+" and will be removed in the near future"))),i?i(m,v,f):!0}};function L3(i,r,o){if(typeof i!="object")throw new ks("options must be an object",ks.ERR_BAD_OPTION_VALUE);for(var h=Object.keys(i),m=h.length;m-- >0;){var v=h[m],f=r[v];if(f){var l=i[v],C=l===void 0||f(l,v,i);if(C!==!0)throw new ks("option "+v+" must be "+C,ks.ERR_BAD_OPTION_VALUE);continue}if(o!==!0)throw new ks("Unknown option "+v,ks.ERR_BAD_OPTION)}}var D3={assertOptions:L3,validators:s_},nT=Vi,F3=H2,L1=o3,D1=z3,cm=rT,j3=eT,aT=D3,Yc=aT.validators;function wu(i){this.defaults=i,this.interceptors={request:new L1,response:new L1}}wu.prototype.request=function(i,r){typeof i=="string"?(r=r||{},r.url=i):r=i||{},r=cm(this.defaults,r),r.method?r.method=r.method.toLowerCase():this.defaults.method?r.method=this.defaults.method.toLowerCase():r.method="get";var o=r.transitional;o!==void 0&&aT.assertOptions(o,{silentJSONParsing:Yc.transitional(Yc.boolean),forcedJSONParsing:Yc.transitional(Yc.boolean),clarifyTimeoutError:Yc.transitional(Yc.boolean)},!1);var h=[],m=!0;this.interceptors.request.forEach(function(j){typeof j.runWhen=="function"&&j.runWhen(r)===!1||(m=m&&j.synchronous,h.unshift(j.fulfilled,j.rejected))});var v=[];this.interceptors.response.forEach(function(j){v.push(j.fulfilled,j.rejected)});var f;if(!m){var l=[D1,void 0];for(Array.prototype.unshift.apply(l,h),l=l.concat(v),f=Promise.resolve(r);l.length;)f=f.then(l.shift(),l.shift());return f}for(var C=r;h.length;){var M=h.shift(),R=h.shift();try{C=M(C)}catch(j){R(j);break}}try{f=D1(C)}catch(j){return Promise.reject(j)}for(;v.length;)f=f.then(v.shift(),v.shift());return f};wu.prototype.getUri=function(i){i=cm(this.defaults,i);var r=j3(i.baseURL,i.url);return F3(r,i.params,i.paramsSerializer)};nT.forEach(["delete","get","head","options"],function(i){wu.prototype[i]=function(r,o){return this.request(cm(o||{},{method:i,url:r,data:(o||{}).data}))}});nT.forEach(["post","put","patch"],function(i){function r(o){return function(h,m,v){return this.request(cm(v||{},{method:i,headers:o?{"Content-Type":"multipart/form-data"}:{},url:h,data:m}))}}wu.prototype[i]=r(),wu.prototype[i+"Form"]=r(!0)});var O3=wu,sy,F1;function B3(){if(F1)return sy;F1=1;var i=sm();function r(o){if(typeof o!="function")throw new TypeError("executor must be a function.");var h;this.promise=new Promise(function(v){h=v});var m=this;this.promise.then(function(v){if(m._listeners){var f,l=m._listeners.length;for(f=0;f<l;f++)m._listeners[f](v);m._listeners=null}}),this.promise.then=function(v){var f,l=new Promise(function(C){m.subscribe(C),f=C}).then(v);return l.cancel=function(){m.unsubscribe(f)},l},o(function(v){m.reason||(m.reason=new i(v),h(m.reason))})}return r.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},r.prototype.subscribe=function(o){if(this.reason){o(this.reason);return}this._listeners?this._listeners.push(o):this._listeners=[o]},r.prototype.unsubscribe=function(o){if(this._listeners){var h=this._listeners.indexOf(o);h!==-1&&this._listeners.splice(h,1)}},r.source=function(){var o,h=new r(function(m){o=m});return{token:h,cancel:o}},sy=r,sy}var j1,O1;function $3(){return O1||(O1=1,j1=function(i){return function(r){return i.apply(null,r)}}),j1}var ly,B1;function N3(){if(B1)return ly;B1=1;var i=Vi;return ly=function(r){return i.isObject(r)&&r.isAxiosError===!0},ly}var $1=Vi,U3=G2,df=O3,V3=rT,q3=o_;function oT(i){var r=new df(i),o=U3(df.prototype.request,r);return $1.extend(o,df.prototype,r),$1.extend(o,r),o.create=function(h){return oT(V3(i,h))},o}var _n=oT(q3);_n.Axios=df;_n.CanceledError=sm();_n.CancelToken=B3();_n.isCancel=tT();_n.VERSION=iT().version;_n.toFormData=Q2;_n.AxiosError=Eu;_n.Cancel=_n.CanceledError;_n.all=function(i){return Promise.all(i)};_n.spread=$3();_n.isAxiosError=N3();e_.exports=_n;e_.exports.default=_n;var G3=e_.exports,Z3=G3;const W3=jz(Z3);class H3{constructor(r,o){va(this,"controlContainer"),va(this,"map"),va(this,"legendContainer"),va(this,"legendButton"),va(this,"closeButton"),va(this,"legendTable"),va(this,"targets"),va(this,"uncheckedLayers",{}),va(this,"onlyRendered"),va(this,"options",{showDefault:!0,showCheckbox:!0,reverseOrder:!0,onlyRendered:!0,title:void 0}),va(this,"sprite",{image:HTMLImageElement,json:JSON}),this.targets=r,o&&(this.options=Object.assign(this.options,o)),this.onlyRendered=this.options.onlyRendered,this.onDocumentClick=this.onDocumentClick.bind(this)}getDefaultPosition(){return"top-right"}createLayerCheckbox(r){var o;if(!this.options.showCheckbox)return;const h=(l,C)=>{var M,R;C?(this.uncheckedLayers[l]&&delete this.uncheckedLayers[l],(M=this.map)==null||M.setLayoutProperty(l,"visibility","visible")):(this.uncheckedLayers[l]=l,(R=this.map)==null||R.setLayoutProperty(l,"visibility","none"));const j=document.getElementsByName(l);for(const G in j)typeof j[G]!="number"&&(j[G].checked=C)},m=document.createElement("TD");m.className="legend-table-td";const v=document.createElement("input");v.setAttribute("type","checkbox"),v.setAttribute("name",r.id),v.setAttribute("value",r.id);const f=(o=this.map)==null?void 0:o.getLayoutProperty(r.id,"visibility");if(!f)v.checked=!0;else{let l=!0;switch(f){case"none":l=!1;break;case"visible":l=!0,v.checked=!0;break}h(r.id,l)}return v.addEventListener("click",function(l){var C,M;const R=(C=l.target)==null?void 0:C.value,j=(M=l.target)==null?void 0:M.checked;h(R,j)}),m.appendChild(v),m}getLayerLegend(r){const o=this.map,h=o?.getZoom(),m=this.sprite,v=Fz({sprite:m,zoom:h,layer:r}),f=document.createElement("TR"),l=this.createLayerCheckbox(r);l&&f.appendChild(l);const C=document.createElement("TD");if(C.className="legend-table-td",v)if(v.element==="div"){if(v.attributes.style.backgroundImage&&!["url(undefined)","url(null)"].includes(v.attributes.style.backgroundImage)){const j=document.createElement("img");j.src=v.attributes.style.backgroundImage.replace("url(","").replace(")",""),j.alt=r.id,j.style.cssText="height: 17px;",C.appendChild(j)}C.style.backgroundColor=v.attributes.style.backgroundColor,C.style.backgroundPosition=v.attributes.style.backgroundPosition,C.style.backgroundSize=v.attributes.style.backgroundSize,C.style.backgroundRepeat=v.attributes.style.backgroundRepeat,C.style.opacity=v.attributes.style.opacity}else if(v.element==="svg"){const j=document.createElementNS("http://www.w3.org/2000/svg","svg");j.style.cssText="height: 17px;",j.setAttributeNS(null,"version","1.1"),Object.keys(v.attributes).forEach(B=>{j.setAttribute(B,v.attributes[B]);const J=document.createElementNS("http://www.w3.org/2000/svg","g");v.children.forEach(le=>{const we=document.createElementNS("http://www.w3.org/2000/svg",le.element);Object.keys(le.attributes).forEach(pe=>{we.setAttributeNS(null,pe,le.attributes[pe])}),J.appendChild(we)}),j.appendChild(J)});const G=document.createElement("label");G.textContent=this.targets&&this.targets[r.id]?this.targets[r.id]:r.id,C.appendChild(j)}else return;else{const j=document.createElementNS("http://www.w3.org/2000/svg","svg"),G=document.createElementNS("http://www.w3.org/2000/svg","path"),B=document.createElementNS("http://www.w3.org/2000/svg","path");j.setAttribute("fill","none"),j.setAttribute("viewBox","0 0 24 24"),j.setAttribute("stroke","black"),j.classList.add("post-icon"),G.setAttribute("d","M21,0H3A3,3,0,0,0,0,3V21a3,3,0,0,0,3,3H21a3,3,0,0,0,3-3V3A3,3,0,0,0,21,0ZM3,2H21a1,1,0,0,1,1,1V15.86L14.18,9.35a5.06,5.06,0,0,0-6.39-.06L2,13.92V3A1,1,0,0,1,3,2ZM21,22H3a1,1,0,0,1-1-1V16.48l7-5.63a3.06,3.06,0,0,1,3.86,0L22,18.47V21A1,1,0,0,1,21,22Z"),G.setAttribute("stroke-linecap","round"),G.setAttribute("stroke-linejoin","round"),G.setAttribute("stroke-width","2"),B.setAttribute("d","M18,9a3,3,0,1,0-3-3A3,3,0,0,0,18,9Zm0-4a1,1,0,1,1-1,1A1,1,0,0,1,18,5Z"),B.setAttribute("stroke-linecap","round"),B.setAttribute("stroke-linejoin","round"),B.setAttribute("stroke-width","2"),j.appendChild(G),j.appendChild(B);const J=document.createElement("label");J.textContent=this.targets&&this.targets[r.id]?this.targets[r.id]:r.id,C.appendChild(j)}const M=document.createElement("TD");M.className="legend-table-td";const R=document.createElement("label");return R.textContent=this.targets&&this.targets[r.id]?this.targets[r.id]:r.id,M.appendChild(R),f.appendChild(C),f.appendChild(M),f}updateLegendControl(){const r=this.map,o={};if(r){const m=r.queryRenderedFeatures();for(const v of m)o[v.layer.id]=v.layer}let h=r?.getStyle().layers;if(h){for(this.legendTable||(this.legendTable=document.createElement("TABLE"),this.legendTable.className="legend-table",this.legendContainer.appendChild(this.legendTable));this.legendTable.firstChild;)this.legendTable.removeChild(this.legendTable.firstChild);this.options.reverseOrder&&(h=h.reverse()),h.forEach(m=>{if(o[m.id]&&this.uncheckedLayers[m.id]?delete this.uncheckedLayers[m.id]:this.uncheckedLayers[m.id]&&(o[m.id]=m),this.targets===void 0||this.targets&&Object.keys(this.targets).length===0||this.targets&&Object.keys(this.targets).map(v=>v).includes(m.id)){if(this.onlyRendered&&!o[m.id])return;const v=this.getLayerLegend(m);if(!v)return;this.legendTable.appendChild(v)}else return})}}onAdd(r){this.map=r,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("maplibregl-ctrl"),this.controlContainer.classList.add("maplibregl-ctrl-group"),this.legendContainer=document.createElement("div"),this.legendContainer.classList.add("maplibregl-legend-list"),this.legendButton=document.createElement("button"),this.legendButton.classList.add("maplibregl-ctrl-icon"),this.legendButton.classList.add("maplibregl-legend-switcher"),this.legendButton.addEventListener("click",()=>{this.legendButton.style.display="none",this.legendContainer.style.display="block"}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.legendButton),this.controlContainer.appendChild(this.legendContainer),this.closeButton=document.createElement("button"),this.closeButton.textContent="x",this.closeButton.classList.add("maplibregl-legend-close-button"),this.closeButton.addEventListener("click",()=>{this.legendButton.style.display="block",this.legendContainer.style.display="none"}),this.legendContainer.appendChild(this.closeButton);const o=document.createElement("label");o.classList.add("maplibregl-legend-title-label"),o.textContent=this.options.title||"Legend",this.legendContainer.appendChild(o),this.legendContainer.appendChild(document.createElement("br"));const h=document.createElement("input");h.setAttribute("type","checkbox");const m=`maplibregl-legend-onlyrendered-checkbox-${Math.random()*100}`;h.setAttribute("id",m),h.classList.add("maplibregl-legend-onlyRendered-checkbox"),h.checked=this.onlyRendered,h.addEventListener("click",this.handleClickOnlyRendered.bind(this)),this.legendContainer.appendChild(h);const v=document.createElement("label");v.classList.add("maplibregl-legend-onlyRendered-label"),v.textContent="Only rendered",v.htmlFor=m,this.legendContainer.appendChild(v),this.legendContainer.appendChild(document.createElement("br")),this.map.on("moveend",()=>{this.updateLegendControl()}),this.map.on("styledata",()=>{this.updateLegendControl()});const f=async()=>{if(r.loaded()){const l=r.getStyle().sprite;l&&await Promise.all([this.loadImage(`${l}@2x.png`),this.loadJson(`${l}.json`)]).then(([C,M])=>{this.setSprite(C,M)}).catch(C=>console.error(C)),this.updateLegendControl(),r.off("idle",f)}};return this.map.on("idle",f),this.options&&this.options.showDefault==!0&&(this.legendContainer.style.display="block",this.legendButton.style.display="none"),this.controlContainer}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.legendButton||(this.legendButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.map=void 0)}redraw(){this.updateLegendControl()}onDocumentClick(r){this.controlContainer&&!this.controlContainer.contains(r.target)&&this.legendContainer&&this.legendButton&&this.options&&this.options.showDefault!==!0&&(this.legendContainer.style.display="none",this.legendButton.style.display="block")}handleClickOnlyRendered(r){var o;const h=(o=r.target)==null?void 0:o.checked;this.onlyRendered=!!h,this.updateLegendControl()}setSprite(r,o){this.sprite={image:r,json:o}}loadImage(r){let o=!1;const h=new Promise((m,v)=>{const f=new Image;f.crossOrigin="Anonymous",f.onload=()=>{o||m(f)},f.onerror=l=>{o||v(l)},f.src=r});return h.cancel=()=>{o=!0},h}loadJson(r){return W3.get(r,{responseType:"json"}).then(o=>o.data)}}function X3(i,r){Vl(r,!0),a0(()=>{if(!r.map)return;const o={"1710-1890":"1710â1889","1890-1900":"1890-1899","1900-1905":"1900-1904","1905-1910":"1905-1909","1910-1920":"1910-1919","1920-1930":"1920-1929","1930-1950":"1930-1949","1950-1975":"1950-1974","1975-2019":"1975-2019",null:"Unknown"},h={showDefault:!0,onlyRendered:!1,showCheckbox:!0,reverseOrder:!0,title:"Buildings by year built"},m=new H3(o,h);r.map.addControl(m,"bottom-left");const v=document.querySelector(".maplibregl-legend-title-label"),f=document.createElement("div"),l=document.createElement("span"),C=document.createElement("a");l.className="legend-subtext",f.className="subtitleHolder",l.textContent="The gray slashes indicate buildings where the year built is uncertain. ",C.textContent="Read more about our methodology.",v.insertAdjacentElement("afterend",f),f.appendChild(l),f.appendChild(C),C.href="https://leventhalmap.org/articles/dating-every-building-in-boston",f.parentNode.removeChild(f.nextSibling),mf(()=>{if(document.querySelectorAll(".legend-table-td.highlight").forEach(R=>R.classList.remove("highlight")),!r.legendArrow)return;function M(R){const j=R.replace("#",""),G=parseInt(j,16),B=G>>16&255,J=G>>8&255,le=G&255;return`rgb(${B}, ${J}, ${le})`}document.querySelectorAll(".legend-table-td[style]").forEach(R=>{const j=R.style.backgroundColor.trim().toLowerCase(),G=r.legendArrow.trim().toLowerCase(),B=M(G);j===B&&R.classList.add("highlight")})})}),ql()}const Mi=kl({long:null,lat:null,zoom:null,form:null});jk();function N1(i,r){r&&r!=="lg"&&r!=="sm"&&r!=="xs"?i.style.fontSize=r.replace("x","em"):i.style.fontSize=""}function K3(i,r,o,h,m,v=1,f="",l=""){let C=1,M=1;m&&(m=="horizontal"?C=-1:m=="vertical"?M=-1:C=M=-1),typeof i=="string"&&(i=parseFloat(i)),typeof r=="string"&&(r=parseFloat(r)),typeof o=="string"&&(o=parseFloat(o));const R=`${r*v}${f}`,j=`${o*v}${f}`;let G=`translate(${R},${j}) scale(${C*i},${M*i})`;return h&&(G+=` rotate(${h}${l})`),G}var Y3=Bf('<title class="svelte-q6zoq1"> </title>'),J3=Bf('<path class="svelte-q6zoq1"></path>'),Q3=Bf('<path class="svelte-q6zoq1"></path><path class="svelte-q6zoq1"></path>',1),eR=Bf('<svg role="img" xmlns="http://www.w3.org/2000/svg"><!><g class="svelte-q6zoq1"><g class="svelte-q6zoq1"><!></g></g></svg>');function sT(i,r){Vl(r,!1);const o=tf(),h=tf();let m=Zr(r,"class",24,()=>{}),v=Zr(r,"id",24,()=>{}),f=Zr(r,"style",24,()=>{}),l=Zr(r,"icon",8),C=Zr(r,"title",24,()=>{}),M=Zr(r,"size",24,()=>{}),R=Zr(r,"color",24,()=>{}),j=Zr(r,"fw",8,!1),G=Zr(r,"pull",24,()=>{}),B=Zr(r,"scale",8,1),J=Zr(r,"translateX",8,0),le=Zr(r,"translateY",8,0),we=Zr(r,"rotate",24,()=>{}),pe=Zr(r,"flip",24,()=>{}),xe=Zr(r,"spin",8,!1),de=Zr(r,"pulse",8,!1),he=Zr(r,"primaryColor",8,""),fe=Zr(r,"secondaryColor",8,""),Ae=Zr(r,"primaryOpacity",8,1),Fe=Zr(r,"secondaryOpacity",8,.4),He=Zr(r,"swapOpacity",8,!1),rt=tf();Sg(()=>(Je(rt),Ss(M()),N1),()=>{Je(rt)&&M()&&N1(Je(rt),M())}),Sg(()=>Ss(l()),()=>{ti(o,l()&&l().icon||[0,0,"",[],""])}),Sg(()=>(Ss(B()),Ss(J()),Ss(le()),Ss(we()),Ss(pe())),()=>{ti(h,K3(B(),J(),le(),we(),pe(),512))}),i5(),R5();var et=g5(),It=fy(et);{var bt=er=>{var dr=eR();let Lr;var hi=ir(dr);{var bi=gt=>{var yt=Y3(),Kt=ir(yt);Fo(()=>yf(Kt,C())),Yi(gt,yt)};Es(hi,gt=>{C()&&gt(bi)})}var fr=ln(hi),At=ir(fr),Qe=ir(At);{var lt=gt=>{var yt=J3();Fo(()=>{yi(yt,"d",(Je(o),jr(()=>Je(o)[4]))),yi(yt,"fill",R()||he()||"currentColor"),yi(yt,"transform",`translate(${Je(o),jr(()=>Je(o)[0]/-2)??""} ${Je(o),jr(()=>Je(o)[1]/-2)??""})`)}),Yi(gt,yt)},xt=gt=>{var yt=Q3(),Kt=fy(yt),Et=ln(Kt);Fo(()=>{yi(Kt,"d",(Je(o),jr(()=>Je(o)[4][0]))),yi(Kt,"fill",fe()||R()||"currentColor"),yi(Kt,"fill-opacity",He()!=!1?Ae():Fe()),yi(Kt,"transform",`translate(${Je(o),jr(()=>Je(o)[0]/-2)??""} ${Je(o),jr(()=>Je(o)[1]/-2)??""})`),yi(Et,"d",(Je(o),jr(()=>Je(o)[4][1]))),yi(Et,"fill",he()||R()||"currentColor"),yi(Et,"fill-opacity",He()!=!1?Fe():Ae()),yi(Et,"transform",`translate(${Je(o),jr(()=>Je(o)[0]/-2)??""} ${Je(o),jr(()=>Je(o)[1]/-2)??""})`)}),Yi(gt,yt)};Es(Qe,gt=>{Je(o),jr(()=>typeof Je(o)[4]=="string")?gt(lt):gt(xt,!1)})}Mx(dr,gt=>ti(rt,gt),()=>Je(rt)),Fo(gt=>{yi(dr,"id",v()),Lr=$f(dr,0,`svelte-fa svelte-fa-base ${m()??""}`,"svelte-q6zoq1",Lr,gt),n0(dr,f()),yi(dr,"viewBox",`0 0 ${Je(o),jr(()=>Je(o)[0])??""} ${Je(o),jr(()=>Je(o)[1])??""}`),yi(dr,"aria-hidden",C()===void 0),yi(fr,"transform",`translate(${Je(o),jr(()=>Je(o)[0]/2)??""} ${Je(o),jr(()=>Je(o)[1]/2)??""})`),yi(fr,"transform-origin",`${Je(o),jr(()=>Je(o)[0]/4)??""} 0`),yi(At,"transform",Je(h))},[()=>({pulse:de(),"svelte-fa-size-lg":M()==="lg","svelte-fa-size-sm":M()==="sm","svelte-fa-size-xs":M()==="xs","svelte-fa-fw":j(),"svelte-fa-pull-left":G()==="left","svelte-fa-pull-right":G()==="right",spin:xe()})]),Yi(er,dr)};Es(It,er=>{Je(o),jr(()=>Je(o)[4])&&er(bt)})}Yi(i,et),ql()}/*!
 * Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com
 * License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License)
 * Copyright 2025 Fonticons, Inc.
 */var lT={prefix:"fas",iconName:"building",icon:[384,512,[127970,61687],"f1ad","M64 0C28.7 0 0 28.7 0 64L0 448c0 35.3 28.7 64 64 64l256 0c35.3 0 64-28.7 64-64l0-384c0-35.3-28.7-64-64-64L64 0zM176 352l32 0c17.7 0 32 14.3 32 32l0 80-96 0 0-80c0-17.7 14.3-32 32-32zM96 112c0-8.8 7.2-16 16-16l32 0c8.8 0 16 7.2 16 16l0 32c0 8.8-7.2 16-16 16l-32 0c-8.8 0-16-7.2-16-16l0-32zM240 96l32 0c8.8 0 16 7.2 16 16l0 32c0 8.8-7.2 16-16 16l-32 0c-8.8 0-16-7.2-16-16l0-32c0-8.8 7.2-16 16-16zM96 240c0-8.8 7.2-16 16-16l32 0c8.8 0 16 7.2 16 16l0 32c0 8.8-7.2 16-16 16l-32 0c-8.8 0-16-7.2-16-16l0-32zm144-16l32 0c8.8 0 16 7.2 16 16l0 32c0 8.8-7.2 16-16 16l-32 0c-8.8 0-16-7.2-16-16l0-32c0-8.8 7.2-16 16-16z"]},tR=Ma("<span> </span>"),rR=Ma('<p class="text-md text-center italic mt-2 mb-4"> </p>'),iR=Ma(`<div><div class="fixed inset-0 z-50 flex items-center justify-center bg-stone-800/90 transition-opacity text-white"><div class="max-h-[500px] !overflow-auto relative transform overflow-hidden rounded-lg bg-stone-900 border-4 border-white px-4 pb-4 pt-5 text-left transition-all my-8 w-full sm:max-w-lg mx-8 sm:p-6 !shadow-red"><div><div><div class="text-center uppercase font-black tracking-widest"><h1 class="text-xl md:text-3xl font-black tracking-widest uppercase"></h1></div></div> <!> <div class="my-6 text-sm mx-6"><p class="my-2 font-black !text-md md:text-lg">Some buildings in the map are dated incorrectly!</p> <p class="my-2">Reasons for this could include significant renovations to a
            structure, errors in the tax assessment records, particular choices
            by the dataset's author(s), and much more.</p> Accurately dating every building in the City of Boston is a very difficult
          task. This map represents our partial attempt, using a dataset created
          and published by the City of Boston. <p class="my-2">Our map simply processes and re-presents publicly available data
            from the City's <a href="https://data.boston.gov/dataset/boston-buildings-inventory">buildings inventory dataset</a>. If you suspect that a building's date of construction is
            incorrect, you can:</p> <ol class="list-disc pl-8 italic"><li>Read our article <a href="https://www.leventhalmap.org/articles/dating-every-building-in-boston/">explaining the methodology</a></li> <li>Double-check this parcel ID against the <a href="https://data.boston.gov/dataset/boston-buildings-inventory">source dataset</a></li> <li>Compare this parcel ID with official <a>tax assessment data</a></li> <li><a>View this building Atlascope</a> to see when it appears</li> <li>Check out BPL's LibGuide about <a href="https://guides.bpl.org/researchyourhome">researching your home</a></li></ol></div> <button type="submit" class="mx-auto flex items-end w-32 ease-in-out transition duration-100 bg-stone-600 hover:cursor-pointer hover:bg-[#3288BD] px-4 py-2 justify-center rounded-md border-2"><!> <p class="mx-2">Go back</p></button></div></div></div></div>`);function nR(i,r){Vl(r,!0);const o="Researching buildings",h=["#D53E4F","#F46D43","#FDAE61","#FEE08B","#FFFFBF","#E6F598","#ABDDA4","#66C2A5","#3288BD"],m=o.split("").map((Fe,He)=>({char:Fe,color:h[He%h.length]}));function v(){Mi.form=!Mi.form}var f=iR(),l=ir(f),C=ir(l),M=ir(C),R=ir(M),j=ir(R),G=ir(j);Sx(G,21,()=>m,Tx,(Fe,He)=>{var rt=tR(),et=ir(rt);Fo(()=>{n0(rt,`color: ${Je(He).color??""}`),yf(et,Je(He).char)}),Yi(Fe,rt)});var B=ln(R,2);{var J=Fe=>{var He=rR(),rt=ir(He);Fo(()=>yf(rt,`Building parcel ID: ${(r.pid.length<10?`0${r.pid}`:r.pid)??""}`)),Yi(Fe,He)};Es(B,Fe=>{r.pid&&Fe(J)})}var le=ln(B,2),we=ln(ir(le),6),pe=ln(ir(we),4),xe=ln(ir(pe)),de=ln(pe,2),he=ir(de),fe=ln(le,2);fe.__click=v;var Ae=ir(fe);sT(Ae,{get icon(){return lT},size:"lg"}),Fo(()=>{$f(f,1,`${Mi.form?"":"hidden"}`),yi(xe,"href",`https://app01.cityofboston.gov/parcelviewer/?center=${r.lnglat.lng??""},${r.lnglat.lat??""}&level=18`),yi(he,"href",`https://atlascope.org/#/view:share$mode:glass$center:${r.lnglat.lng??""},${r.lnglat.lat??""}$zoom:19$base:maptiler-streets$overlay:ark:/76611/al7rtfm98`)}),Yi(i,f),ql()}xx(["click"]);const aR=(i,r,o)=>`
  <div class="space-y-2 text-stone-800">

    <div class="text-[1.3em] font-medium gap-2">
      Estimated Year Built:
      <span class="!font-black text-stone-900">
        ${i.properties.yr_built||"???"}
      </span>
      Parcel ID: 
      <span class="!font-black text-stone-900">
        ${o!=null&&o.length<10?`0${o}`:"???"}
      </span>
    </div>

    <div class="flex gap-2">
    <div class="mt-3 px-3 py-2 bg-stone-100 rounded border border-stone-300 hover:bg-stone-200 hover:border-stone-400">

    <a
      class="block underline font-semibold"
      href="https://atlascope.org/#/view:share$mode:glass$center:${r.lng},${r.lat}$zoom:18.5$base:maptiler-streets$overlay:ark:/76611/al7rtfm98"
    >
      Open in Atlascope
    </a>

    </div>
    
    <div class="mt-3 px-3 py-2 bg-stone-100 rounded border border-stone-300 hover:bg-stone-200 hover:border-stone-400">

    <a
      class="block underline font-semibold"
      href="https://app01.cityofboston.gov/parcelviewer/?center=${r.lng},${r.lat}&level=18"
    >
      Open in Parcel Viewer
    </a>
    </div>

    </div>

        <div class="mt-3 px-3 py-2 bg-stone-100 rounded border border-stone-300 hover:bg-stone-200 hover:border-stone-400">

    <a
      class="block text-blue-700 underline font-semibold ${o==null?"text-black hover:cursor-not-allowed pointer-events-none italic !text-gray-400":""}"
      href="https://www.cityofboston.gov/assessing/search/?pid=${o!=null&&o.length<10?`0${o}`:"???"}"
    >
      View City of Boston tax assessment records
    </a>

    </div>

    <div class="mt-3 px-3 py-2 bg-stone-100 rounded border border-stone-300 hover:bg-stone-200 hover:border-stone-400">

    <p class="text-sm text-stone-700">
      Does this year built look incorrect?
      <button class="inline hover:cursor-pointer underline text-red-600 font-semibold">
        Learn more
      </button>
    </p>
    </div>
      </div>
`;var oR=Ma('<div class="map-wrap h-[85vh] md:h-[90vh]"><!> <div class="map"><!></div></div>');function sR(i,r){Vl(r,!0);let o=Ki(void 0),h,m=Ki(void 0),v=Ki(!1),f=Ki(null),l=Ki(void 0);setTimeout(()=>{ti(v,!0)},500);const C=[{range:{start:1975,end:2019},color:"#3288BD"},{range:{start:1950,end:1975},color:"#66C2A5"},{range:{start:1930,end:1950},color:"#ABDDA4"},{range:{start:1920,end:1930},color:"#E6F598"},{range:{start:1910,end:1920},color:"#FFFFBF"},{range:{start:1905,end:1910},color:"#FEE08B"},{range:{start:1900,end:1905},color:"#FDAE61"},{range:{start:1890,end:1900},color:"#F46D43"},{range:{start:1710,end:1890},color:"#D53E4F"},{range:{start:0,end:0},color:"#2E2E2E"}];function M(we){if(we==null||isNaN(we))return"#2E2E2E";const pe=C.find(({range:xe})=>we>=xe.start&&we<xe.end);return pe?pe.color:"#2E2E2E"}a0(()=>{_i.apiKey="YAlgbo83caczbP46lxYj";const we={lng:Mi.long,lat:Mi.lat,zoom:Mi.zoom};ti(o,new h2({container:h,style:"https://api.maptiler.com/maps/0199a53b-d07e-7d68-afa6-afd2e23ef02c/style.json?key=YAlgbo83caczbP46lxYj",center:[we.lng,we.lat],zoom:we.zoom,minZoom:11}),!0),Je(o).on("load",()=>{Je(o).addSource("buildings",{type:"vector",tiles:["https://api.maptiler.com/tiles/0199c972-a1bc-7fba-a054-bcb64c5c21f9/{z}/{x}/{y}.pbf?key=YAlgbo83caczbP46lxYj"],minzoom:11,maxzoom:20}),Je(o).addLayer({id:"buildings-layer",type:"fill",source:"buildings","source-layer":"all_buildings",paint:{"fill-opacity":0}}),Je(o).on("mousemove","buildings-layer",xe=>{const de=xe.features?.[0];if(de){const he=Number(de.properties.yr_built);ti(m,M(he),!0),Je(o).getCanvas().style.cursor="pointer"}else ti(m,null),Je(o).getCanvas().style.cursor="grab"}),Je(o).on("mouseleave","buildings-layer",()=>{Je(o).getCanvas().style.cursor="",ti(m,null)}),Je(o).on("click","buildings-layer",xe=>{const de=xe.features[0];ti(f,de.properties.pid_long,!0),ti(l,xe.lngLat,!0);const he=document.createElement("div");he.innerHTML=aR(de,Je(l),Je(f)),he.querySelector("button").addEventListener("click",()=>{Mi.form=!Mi.form}),new FC().setLngLat(xe.lngLat).setDOMContent(he).addTo(Je(o))});function pe(){const xe=Je(o).getCenter(),de=Je(o).getZoom().toFixed(1),he={lng:xe.lng.toFixed(4),lat:xe.lat.toFixed(4)};Mi.long=he.lng,Mi.lat=he.lat,Mi.zoom=de,window.location.hash=`/zoom:${Mi.zoom}$long:${Mi.long}$lat:${Mi.lat}`}Je(o).on("dragend",()=>{pe()}),Je(o).on("zoomend",()=>{pe()})})});var R=oR(),j=ir(R);{var G=we=>{nR(we,{get pid(){return Je(f)},get lnglat(){return Je(l)}})};Es(j,we=>{Mi.form&&we(G)})}var B=ln(j,2),J=ir(B);{var le=we=>{X3(we,{get map(){return Je(o)},get legendArrow(){return Je(m)}})};Es(J,we=>{Je(o)&&Je(v)&&we(le)})}Mx(B,we=>h=we,()=>h),Yi(i,R),ql()}var lR=Ma('<div class="absolute top-5 right-3"><button class="bg-white rounded-full w-6 text-center select-none hover:cursor-pointer">?</button></div>');function cR(i,r){let o=Zr(r,"show",12);var h=lR(),m=ir(h);f5("click",m,()=>o(!o())),Yi(i,h)}function uR(i){const r=i-1;return r*r*r+1}function hR(i,{delay:r=0,duration:o=400,easing:h=uR,axis:m="y"}={}){const v=getComputedStyle(i),f=+v.opacity,l=m==="y"?"height":"width",C=parseFloat(v[l]),M=m==="y"?["top","bottom"]:["left","right"],R=M.map(pe=>`${pe[0].toUpperCase()}${pe.slice(1)}`),j=parseFloat(v[`padding${R[0]}`]),G=parseFloat(v[`padding${R[1]}`]),B=parseFloat(v[`margin${R[0]}`]),J=parseFloat(v[`margin${R[1]}`]),le=parseFloat(v[`border${R[0]}Width`]),we=parseFloat(v[`border${R[1]}Width`]);return{delay:r,duration:o,easing:h,css:pe=>`overflow: hidden;opacity: ${Math.min(pe*20,1)*f};${l}: ${pe*C}px;padding-${M[0]}: ${pe*j}px;padding-${M[1]}: ${pe*G}px;margin-${M[0]}: ${pe*B}px;margin-${M[1]}: ${pe*J}px;border-${M[0]}-width: ${pe*le}px;border-${M[1]}-width: ${pe*we}px;min-${l}: 0`}}var pR=Ma(`<div class="absolute z-100 text-white text-sm md:text-md mx-16 bg-black/90 rounded-b-xl border-t border-white shadow-xl"><div class="py-2 px-4 md:px-12 md:py-4"><p>This map shows the year of construction for all buildings in
            Boston as of 2024. The year built data comes from the city's
            comprehensive <a href="https://data.boston.gov/dataset/boston-buildings-inventory">building inventory dataset</a>, which pulls from tax assessor records. Building shapes and
            locations were obtained from a <a href="https://www.mass.gov/info-details/massgis-data-building-structures-2-d#production">MassGIS dataset</a>. The map is useful for identifying citywide patterns in building
            ages, though individual records may contain inaccuracies since the
            data was originally collected for a variety of purposes. Read more
            about the project <a href="https://leventhalmap.org/articles/dating-every-building-in-boston">here</a>.</p> <p class="mt-2">Source code on <a href="https://github.com/bplmaps/boston-buildings">Github</a>. Made with Maptiler, MapLibre, and Svelte 5. Inspired by Bert Spaan's Waag Society <a class="underline text-blue-300" href="https://code.waag.org/buildings/#52.3589,4.894,15">map of the Netherlands</a> and Thomas Rhiel's BKLYNR <a class="underline text-blue-300" href="https://www.bklynr.com/block-by-block-brooklyns-past-and-present/">map of Brooklyn</a>.</p></div></div>`),dR=Ma('<nav class="bg-black font-sans border-b border-white"><div class="max-w-7xl px-4 sm:px-6 lg:px-8"><div><div class="flex items-center space-x-2"><div class="mr-10"><a class="inline font-black text-red-400 hover:underline" href="https://leventhalmap.org" target="_blank">LMEC</a> <p class="inline text-white">â§½</p> <p class="inline font-bold text-blue-400">Digital Projects</p> <p class="inline text-white">â§½</p> <p class="inline italic font-bold text-white">Boston Buildings</p></div></div> <div class="h-16"><!></div></div> <!></div></nav>');function fR(i){let r=Ki(!1);var o=dR(),h=ir(o),m=ir(h);$f(m,1,"flex h-16 items-center justify-between");var v=ln(ir(m),2),f=ir(v);cR(f,{get show(){return Je(r)},set show(M){ti(r,M,!0)}});var l=ln(m,2);{var C=M=>{var R=pR();z5(3,R,()=>hR),Yi(M,R)};Es(l,M=>{Je(r)&&M(C)})}Yi(i,o)}function mR(i,r){ti(r,!Je(r))}var gR=Ma("<span> </span>"),yR=Ma(`<div><div class="fixed inset-0 z-50 flex items-center justify-center bg-stone-800/90 transition-opacity text-white"><div class="relative transform overflow-hidden rounded-lg bg-stone-900 border-4 border-white px-4 pb-4 pt-5 text-left shadow-xl shadow-stone-900/10 transition-all mx-8 md:mx-0 sm:my-8 sm:w-full sm:max-w-md sm:p-6"><div><div><div class="text-center uppercase font-black tracking-widest"><h1 class="text-2xl md:text-4xl font-black tracking-widest uppercase"></h1></div></div> <div class="m-3 text-center text-sm md:text-lg sm:mt-5"><p class="mb-4">This map provides a window into the City of Boston's <a href="https://data.boston.gov/dataset/boston-buildings-inventory">Buildings Inventory</a> dataset, which estimates the date of construction for structures across
            the city.</p> <p class="mb-4">This map is <i>not</i> an authoritative census of building ages. <span class="font-black">Building ages may not be accurate!</span> This means the map is best for <span class="italic">aggregate exploration</span>. You can click on
            any building to learn more about the limits of the source dataset,
            as well as resources for studying building history.</p></div></div> <div class="mt-4 sm:mt-6"><button type="button" class="transition duration-100 ease-in-out inline-flex w-full py-2 justify-center rounded-md bg-stone-600 border-2 hover:cursor-pointer hover:bg-[#66C2A5] hover:text-black hover:border-stone-200"><!> <p class="mx-2">Explore buildings</p></button></div> <div class="py-4 mt-4"><p class="text-xs text-center font-semibold">A project of the <a class="text-blue-900 hover:text-blue-600 transition-colors" href="https://leventhalmap.org" target="_blank">Leventhal Map & Education Center</a> at the <a href="https://bpl.org">Boston Public Library</a></p></div></div></div></div>`);function _R(i,r){Vl(r,!0);let o=Ki(!1);const h="Boston's buildings",m=["#D53E4F","#F46D43","#FDAE61","#FEE08B","#FFFFBF","#E6F598","#ABDDA4","#66C2A5","#3288BD"],v=h.split("").map((pe,xe)=>({char:pe,color:m[xe%m.length]}));var f=yR();let l;var C=ir(f),M=ir(C),R=ir(M),j=ir(R),G=ir(j),B=ir(G);Sx(B,21,()=>v,Tx,(pe,xe)=>{var de=gR(),he=ir(de);Fo(()=>{n0(de,`color: ${Je(xe).color??""}`),yf(he,Je(xe).char)}),Yi(pe,de)});var J=ln(R,2),le=ir(J);le.__click=[mR,o];var we=ir(le);sT(we,{get icon(){return lT},size:"lg"}),Fo(pe=>l=$f(f,1,"",null,l,pe),[()=>({hidden:Je(o)})]),Yi(i,f),ql()}xx(["click"]);var vR=Ma("<!> <!>",1),bR=Ma("<main><!> <!></main>");function xR(i,r){Vl(r,!0);let o=Ki(!1);const h={long:-71.06,lat:42.36,zoom:14};function m(M){let R={};return M.split("$").map(j=>{const G=j.indexOf(":"),B=j.slice(0,G),J=j.slice(G+1);R[B]=J}),{...h,...R}}a0(()=>{const M=m(window.location.hash.substring(2).split("#")[0]);Mi.long=M.long,Mi.lat=M.lat,Mi.zoom=M.zoom,ti(o,!0)});var v=bR(),f=ir(v);fR(f);var l=ln(f,2);{var C=M=>{var R=vR(),j=fy(R);_R(j,{});var G=ln(j,2);sR(G,{}),Yi(M,R)};Es(l,M=>{Je(o)&&M(C)})}Yi(i,v),ql()}y5(xR,{target:document.getElementById("app")});
