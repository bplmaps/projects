(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))p(m);new MutationObserver(m=>{for(const b of m)if(b.type==="childList")for(const f of b.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&p(f)}).observe(document,{childList:!0,subtree:!0});function s(m){const b={};return m.integrity&&(b.integrity=m.integrity),m.referrerPolicy&&(b.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?b.credentials="include":m.crossOrigin==="anonymous"?b.credentials="omit":b.credentials="same-origin",b}function p(m){if(m.ep)return;m.ep=!0;const b=s(m);fetch(m.href,b)}})();const s1=!1;var l1=Array.isArray,pS=Array.prototype.indexOf,dS=Array.from,Og=Object.defineProperty,Gc=Object.getOwnPropertyDescriptor,fS=Object.prototype,mS=Array.prototype,gS=Object.getPrototypeOf,uv=Object.isExtensible;function yS(i){return typeof i=="function"}const Dc=()=>{};function _S(i){for(var r=0;r<i.length;r++)i[r]()}function vS(){var i,r,s=new Promise((p,m)=>{i=p,r=m});return{promise:s,resolve:i,reject:r}}const sn=2,vy=4,c1=8,bs=16,Io=32,Cl=64,by=128,ta=256,qd=512,Ni=1024,Ln=2048,xs=4096,_s=8192,ru=16384,pf=32768,tp=65536,hv=1<<17,bS=1<<18,rp=1<<19,xS=1<<20,Bg=1<<21,xy=1<<22,Gd=1<<23,Ah=Symbol("$state"),wS=Symbol("legacy props"),u1=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function TS(i){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function SS(i){throw new Error("https://svelte.dev/e/effect_in_teardown")}function kS(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function CS(i){throw new Error("https://svelte.dev/e/effect_orphan")}function PS(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function MS(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function AS(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function IS(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function ES(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const zS=2,RS=8,LS=4,DS=2,$i=Symbol();function jS(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function h1(i){return i===this.v}function FS(i,r){return i!=i?r==r:i!==r||i!==null&&typeof i=="object"||typeof i=="function"}function OS(i){return!FS(i,this.v)}let ip=!1,BS=!1;function $S(){ip=!0}let Ui=null;function Zd(i){Ui=i}function df(i,r=!1,s){Ui={p:Ui,c:null,e:null,s:i,x:null,l:ip&&!r?{s:null,u:null,$:[]}:null}}function ff(i){var r=Ui,s=r.e;if(s!==null){r.e=null;for(var p of s)k1(p)}return Ui=r.p,{}}function mf(){return!ip||Ui!==null&&Ui.l===null}let Nc=[];function NS(){var i=Nc;Nc=[],_S(i)}function wl(i){if(Nc.length===0){var r=Nc;queueMicrotask(()=>{r===Nc&&NS()})}Nc.push(i)}const US=new WeakMap;function p1(i){var r=er;if(r===null)return Jt.f|=Gd,i;if((r.f&pf)===0){if((r.f&by)===0)throw!r.parent&&i instanceof Error&&d1(i),i;r.b.error(i)}else Wd(i,r)}function Wd(i,r){for(;r!==null;){if((r.f&by)!==0)try{r.b.error(i);return}catch(s){i=s}r=r.parent}throw i instanceof Error&&d1(i),i}function d1(i){const r=US.get(i);r&&(Og(i,"message",{value:r.message}),Og(i,"stack",{value:r.stack}))}const wd=new Set;let an=null,$g=new Set,hs=[],wy=null,Ng=!1;class Xn{current=new Map;#i=new Map;#r=new Set;#p=0;#a=null;#l=[];#n=[];#t=[];#e=[];#o=[];#c=[];skipped_effects=new Set;process(r){hs=[];var s=Xn.apply(this);for(const b of r)this.#u(b);if(this.#p===0){this.#h();var p=this.#n,m=this.#t;this.#n=[],this.#t=[],this.#e=[],an=null,pv(p),pv(m),this.#a?.resolve()}else this.#s(this.#n),this.#s(this.#t),this.#s(this.#e);s();for(const b of this.#l)Nh(b);this.#l=[]}#u(r){r.f^=Ni;for(var s=r.first;s!==null;){var p=s.f,m=(p&(Io|Cl))!==0,b=m&&(p&Ni)!==0,f=b||(p&_s)!==0||this.skipped_effects.has(s);if(!f&&s.fn!==null){m?s.f^=Ni:(p&vy)!==0?this.#t.push(s):(p&Ni)===0&&((p&xy)!==0&&s.b?.is_pending()?this.#l.push(s):gf(s)&&((s.f&bs)!==0&&this.#e.push(s),Nh(s)));var l=s.first;if(l!==null){s=l;continue}}var C=s.parent;for(s=s.next;s===null&&C!==null;)s=C.next,C=C.parent}}#s(r){for(const s of r)((s.f&Ln)!==0?this.#o:this.#c).push(s),Qi(s,Ni);r.length=0}capture(r,s){this.#i.has(r)||this.#i.set(r,s),this.current.set(r,r.v)}activate(){an=this}deactivate(){an=null}flush(){if(hs.length>0){if(this.activate(),VS(),an!==null&&an!==this)return}else this.#p===0&&this.#h();this.deactivate();for(const r of $g)if($g.delete(r),r(),an!==null)break}#h(){for(const r of this.#r)r();if(this.#r.clear(),wd.size>1){this.#i.clear();let r=!0;for(const s of wd){if(s===this){r=!1;continue}for(const[p,m]of this.current){if(s.current.has(p))if(r)s.current.set(p,m);else continue;f1(p)}if(hs.length>0){an=s;const p=Xn.apply(s);for(const m of hs)s.#u(m);hs=[],p()}}an=null}wd.delete(this)}increment(){this.#p+=1}decrement(){this.#p-=1;for(const r of this.#o)Qi(r,Ln),Tl(r);for(const r of this.#c)Qi(r,xs),Tl(r);this.flush()}add_callback(r){this.#r.add(r)}settled(){return(this.#a??=vS()).promise}static ensure(){if(an===null){const r=an=new Xn;wd.add(an),Xn.enqueue(()=>{an===r&&r.flush()})}return an}static enqueue(r){wl(r)}static apply(r){return Dc}}function VS(){var i=Zc;Ng=!0;try{var r=0;for(fv(!0);hs.length>0;){var s=Xn.ensure();if(r++>1e3){var p,m;qS()}s.process(hs),ms.clear()}}finally{Ng=!1,fv(i),wy=null}}function qS(){try{PS()}catch(i){Wd(i,wy)}}let pl=null;function pv(i){var r=i.length;if(r!==0){for(var s=0;s<r;){var p=i[s++];if((p.f&(ru|_s))===0&&gf(p)&&(pl=[],Nh(p),p.deps===null&&p.first===null&&p.nodes_start===null&&(p.teardown===null&&p.ac===null?E1(p):p.fn=null),pl?.length>0)){ms.clear();for(const m of pl)Nh(m);pl=[]}}pl=null}}function f1(i){if(i.reactions!==null)for(const r of i.reactions){const s=r.f;(s&sn)!==0?f1(r):(s&(xy|bs))!==0&&(Qi(r,Ln),Tl(r))}}function Tl(i){for(var r=wy=i;r.parent!==null;){r=r.parent;var s=r.f;if(Ng&&r===er&&(s&bs)!==0)return;if((s&(Cl|Io))!==0){if((s&Ni)===0)return;r.f^=Ni}}hs.push(r)}function GS(i){let r=0,s=Sy(0),p;return()=>{ik()&&(lr(s),P1(()=>(r===0&&(p=yf(()=>i(()=>Ih(s)))),r+=1,()=>{wl(()=>{r-=1,r===0&&(p?.(),p=void 0,Ih(s))})})))}}var ZS=tp|rp|by;function WS(i,r,s){new HS(i,r,s)}class HS{parent;#i=!1;#r;#p=null;#a;#l;#n;#t=null;#e=null;#o=null;#c=null;#u=0;#s=0;#h=!1;#d=null;#y=()=>{this.#d&&y1(this.#d,this.#u)};#_=GS(()=>(this.#d=Sy(this.#u),()=>{this.#d=null}));constructor(r,s,p){this.#r=r,this.#a=s,this.#l=p,this.parent=er.b,this.#i=!!this.#a.pending,this.#n=M1(()=>{er.b=this;{try{this.#t=bo(()=>p(this.#r))}catch(m){this.error(m)}this.#s>0?this.#m():this.#i=!1}},ZS)}#v(){try{this.#t=bo(()=>this.#l(this.#r))}catch(r){this.error(r)}this.#i=!1}#b(){const r=this.#a.pending;r&&(this.#e=bo(()=>r(this.#r)),Xn.enqueue(()=>{this.#t=this.#f(()=>(Xn.ensure(),bo(()=>this.#l(this.#r)))),this.#s>0?this.#m():(Eh(this.#e,()=>{this.#e=null}),this.#i=!1)}))}is_pending(){return this.#i||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!this.#a.pending}#f(r){var s=er,p=Jt,m=Ui;vs(this.#n),Kn(this.#n),Zd(this.#n.ctx);try{return r()}catch(b){return p1(b),null}finally{vs(s),Kn(p),Zd(m)}}#m(){const r=this.#a.pending;this.#t!==null&&(this.#c=document.createDocumentFragment(),XS(this.#t,this.#c)),this.#e===null&&(this.#e=bo(()=>r(this.#r)))}#g(r){if(!this.has_pending_snippet()){this.parent&&this.parent.#g(r);return}this.#s+=r,this.#s===0&&(this.#i=!1,this.#e&&Eh(this.#e,()=>{this.#e=null}),this.#c&&(this.#r.before(this.#c),this.#c=null),wl(()=>{Xn.ensure().flush()}))}update_pending_count(r){this.#g(r),this.#u+=r,$g.add(this.#y)}get_effect_pending(){return this.#_(),lr(this.#d)}error(r){var s=this.#a.onerror;let p=this.#a.failed;if(this.#h||!s&&!p)throw r;this.#t&&(Ga(this.#t),this.#t=null),this.#e&&(Ga(this.#e),this.#e=null),this.#o&&(Ga(this.#o),this.#o=null);var m=!1,b=!1;const f=()=>{if(m){jS();return}m=!0,b&&ES(),Xn.ensure(),this.#u=0,this.#o!==null&&Eh(this.#o,()=>{this.#o=null}),this.#i=this.has_pending_snippet(),this.#t=this.#f(()=>(this.#h=!1,bo(()=>this.#l(this.#r)))),this.#s>0?this.#m():this.#i=!1};var l=Jt;try{Kn(null),b=!0,s?.(r,f),b=!1}catch(C){Wd(C,this.#n&&this.#n.parent)}finally{Kn(l)}p&&wl(()=>{this.#o=this.#f(()=>{this.#h=!0;try{return bo(()=>{p(this.#r,()=>r,()=>f)})}catch(C){return Wd(C,this.#n.parent),null}finally{this.#h=!1}})})}}function XS(i,r){for(var s=i.nodes_start,p=i.nodes_end;s!==null;){var m=s===p?null:ky(s);r.append(s),s=m}}function KS(i){var r=sn|Ln,s=Jt!==null&&(Jt.f&sn)!==0?Jt:null;return er===null||s!==null&&(s.f&ta)!==0?r|=ta:er.f|=rp,{ctx:Ui,deps:null,effects:null,equals:h1,f:r,fn:i,reactions:null,rv:0,v:$i,wv:0,parent:s??er,ac:null}}function YS(i){const r=KS(i);return r.equals=OS,r}function m1(i){var r=i.effects;if(r!==null){i.effects=null;for(var s=0;s<r.length;s+=1)Ga(r[s])}}function JS(i){for(var r=i.parent;r!==null;){if((r.f&sn)===0)return r;r=r.parent}return null}function Ty(i){var r,s=er;vs(JS(i));try{m1(i),r=F1(i)}finally{vs(s)}return r}function g1(i){var r=Ty(i);if(i.equals(r)||(i.v=r,i.wv=D1()),!Ml){var s=(ds||(i.f&ta)!==0)&&i.deps!==null?xs:Ni;Qi(i,s)}}const ms=new Map;function Sy(i,r){var s={f:0,v:i,reactions:null,equals:h1,rv:0,wv:0};return s}function In(i,r){const s=Sy(i);return uk(s),s}function Ji(i,r,s=!1){Jt!==null&&(!fa||(Jt.f&hv)!==0)&&mf()&&(Jt.f&(sn|bs|xy|hv))!==0&&!So?.includes(i)&&IS();let p=s?dl(r):r;return y1(i,p)}function y1(i,r){if(!i.equals(r)){var s=i.v;Ml?ms.set(i,r):ms.set(i,s),i.v=r;var p=Xn.ensure();p.capture(i,s),(i.f&sn)!==0&&((i.f&Ln)!==0&&Ty(i),Qi(i,(i.f&ta)===0?Ni:xs)),i.wv=D1(),_1(i,Ln),mf()&&er!==null&&(er.f&Ni)!==0&&(er.f&(Io|Cl))===0&&(Gn===null?hk([i]):Gn.push(i))}return r}function Ih(i){Ji(i,i.v+1)}function _1(i,r){var s=i.reactions;if(s!==null)for(var p=mf(),m=s.length,b=0;b<m;b++){var f=s[b],l=f.f;if(!(!p&&f===er)){var C=(l&Ln)===0;C&&Qi(f,r),(l&sn)!==0?_1(f,xs):C&&((l&bs)!==0&&pl!==null&&pl.push(f),Tl(f))}}}function dl(i){if(typeof i!="object"||i===null||Ah in i)return i;const r=gS(i);if(r!==fS&&r!==mS)return i;var s=new Map,p=l1(i),m=In(0),b=ml,f=l=>{if(ml===b)return l();var C=Jt,M=ml;Kn(null),gv(b);var D=l();return Kn(C),gv(M),D};return p&&s.set("length",In(i.length)),new Proxy(i,{defineProperty(l,C,M){(!("value"in M)||M.configurable===!1||M.enumerable===!1||M.writable===!1)&&MS();var D=s.get(C);return D===void 0?D=f(()=>{var O=In(M.value);return s.set(C,O),O}):Ji(D,M.value,!0),!0},deleteProperty(l,C){var M=s.get(C);if(M===void 0){if(C in l){const D=f(()=>In($i));s.set(C,D),Ih(m)}}else Ji(M,$i),Ih(m);return!0},get(l,C,M){if(C===Ah)return i;var D=s.get(C),O=C in l;if(D===void 0&&(!O||Gc(l,C)?.writable)&&(D=f(()=>{var $=dl(O?l[C]:$i),ne=In($);return ne}),s.set(C,D)),D!==void 0){var Z=lr(D);return Z===$i?void 0:Z}return Reflect.get(l,C,M)},getOwnPropertyDescriptor(l,C){var M=Reflect.getOwnPropertyDescriptor(l,C);if(M&&"value"in M){var D=s.get(C);D&&(M.value=lr(D))}else if(M===void 0){var O=s.get(C),Z=O?.v;if(O!==void 0&&Z!==$i)return{enumerable:!0,configurable:!0,value:Z,writable:!0}}return M},has(l,C){if(C===Ah)return!0;var M=s.get(C),D=M!==void 0&&M.v!==$i||Reflect.has(l,C);if(M!==void 0||er!==null&&(!D||Gc(l,C)?.writable)){M===void 0&&(M=f(()=>{var Z=D?dl(l[C]):$i,$=In(Z);return $}),s.set(C,M));var O=lr(M);if(O===$i)return!1}return D},set(l,C,M,D){var O=s.get(C),Z=C in l;if(p&&C==="length")for(var $=M;$<O.v;$+=1){var ne=s.get($+"");ne!==void 0?Ji(ne,$i):$ in l&&(ne=f(()=>In($i)),s.set($+"",ne))}if(O===void 0)(!Z||Gc(l,C)?.writable)&&(O=f(()=>In(void 0)),Ji(O,dl(M)),s.set(C,O));else{Z=O.v!==$i;var fe=f(()=>dl(M));Ji(O,fe)}var Ee=Reflect.getOwnPropertyDescriptor(l,C);if(Ee?.set&&Ee.set.call(D,M),!Z){if(p&&typeof C=="string"){var _e=s.get("length"),Se=Number(C);Number.isInteger(Se)&&Se>=_e.v&&Ji(_e,Se+1)}Ih(m)}return!0},ownKeys(l){lr(m);var C=Reflect.ownKeys(l).filter(O=>{var Z=s.get(O);return Z===void 0||Z.v!==$i});for(var[M,D]of s)D.v!==$i&&!(M in l)&&C.push(M);return C},setPrototypeOf(){AS()}})}var dv,v1,b1,x1;function QS(){if(dv===void 0){dv=window,v1=/Firefox/.test(navigator.userAgent);var i=Element.prototype,r=Node.prototype,s=Text.prototype;b1=Gc(r,"firstChild").get,x1=Gc(r,"nextSibling").get,uv(i)&&(i.__click=void 0,i.__className=void 0,i.__attributes=null,i.__style=void 0,i.__e=void 0),uv(s)&&(s.__t=void 0)}}function w1(i=""){return document.createTextNode(i)}function T1(i){return b1.call(i)}function ky(i){return x1.call(i)}function ps(i,r){return T1(i)}function Ug(i,r=1,s=!1){let p=i;for(;r--;)p=ky(p);return p}function ek(){return!1}function np(i){var r=Jt,s=er;Kn(null),vs(null);try{return i()}finally{Kn(r),vs(s)}}function tk(i){er===null&&Jt===null&&CS(),Jt!==null&&(Jt.f&ta)!==0&&er===null&&kS(),Ml&&SS()}function rk(i,r){var s=r.last;s===null?r.last=r.first=i:(s.next=i,i.prev=s,r.last=i)}function Pl(i,r,s,p=!0){var m=er;m!==null&&(m.f&_s)!==0&&(i|=_s);var b={ctx:Ui,deps:null,nodes_start:null,nodes_end:null,f:i|Ln,first:null,fn:r,last:null,next:null,parent:m,b:m&&m.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(s)try{Nh(b),b.f|=pf}catch(C){throw Ga(b),C}else r!==null&&Tl(b);if(p){var f=b;if(s&&f.deps===null&&f.teardown===null&&f.nodes_start===null&&f.first===f.last&&(f.f&rp)===0&&(f=f.first),f!==null&&(f.parent=m,m!==null&&rk(f,m),Jt!==null&&(Jt.f&sn)!==0&&(i&Cl)===0)){var l=Jt;(l.effects??=[]).push(f)}}return b}function ik(){return Jt!==null&&!fa}function nk(i){const r=Pl(c1,null,!1);return Qi(r,Ni),r.teardown=i,r}function S1(i){tk();var r=er.f,s=!Jt&&(r&Io)!==0&&(r&pf)===0;if(s){var p=Ui;(p.e??=[]).push(i)}else return k1(i)}function k1(i){return Pl(vy|xS,i,!1)}function ak(i){Xn.ensure();const r=Pl(Cl|rp,i,!0);return(s={})=>new Promise(p=>{s.outro?Eh(r,()=>{Ga(r),p(void 0)}):(Ga(r),p(void 0))})}function C1(i){return Pl(vy,i,!1)}function P1(i,r=0){return Pl(c1|r,i,!0)}function M1(i,r=0){var s=Pl(bs|r,i,!0);return s}function bo(i,r=!0){return Pl(Io|rp,i,!0,r)}function A1(i){var r=i.teardown;if(r!==null){const s=Ml,p=Jt;mv(!0),Kn(null);try{r.call(null)}finally{mv(s),Kn(p)}}}function I1(i,r=!1){var s=i.first;for(i.first=i.last=null;s!==null;){const m=s.ac;m!==null&&np(()=>{m.abort(u1)});var p=s.next;(s.f&Cl)!==0?s.parent=null:Ga(s,r),s=p}}function ok(i){for(var r=i.first;r!==null;){var s=r.next;(r.f&Io)===0&&Ga(r),r=s}}function Ga(i,r=!0){var s=!1;(r||(i.f&bS)!==0)&&i.nodes_start!==null&&i.nodes_end!==null&&(sk(i.nodes_start,i.nodes_end),s=!0),I1(i,r&&!s),Hd(i,0),Qi(i,ru);var p=i.transitions;if(p!==null)for(const b of p)b.stop();A1(i);var m=i.parent;m!==null&&m.first!==null&&E1(i),i.next=i.prev=i.teardown=i.ctx=i.deps=i.fn=i.nodes_start=i.nodes_end=i.ac=null}function sk(i,r){for(;i!==null;){var s=i===r?null:ky(i);i.remove(),i=s}}function E1(i){var r=i.parent,s=i.prev,p=i.next;s!==null&&(s.next=p),p!==null&&(p.prev=s),r!==null&&(r.first===i&&(r.first=p),r.last===i&&(r.last=s))}function Eh(i,r){var s=[];z1(i,s,!0),lk(s,()=>{Ga(i),r&&r()})}function lk(i,r){var s=i.length;if(s>0){var p=()=>--s||r();for(var m of i)m.out(p)}else r()}function z1(i,r,s){if((i.f&_s)===0){if(i.f^=_s,i.transitions!==null)for(const f of i.transitions)(f.is_global||s)&&r.push(f);for(var p=i.first;p!==null;){var m=p.next,b=(p.f&tp)!==0||(p.f&Io)!==0;z1(p,r,b?s:!1),p=m}}}function ck(i){R1(i,!0)}function R1(i,r){if((i.f&_s)!==0){i.f^=_s,(i.f&Ni)===0&&(Qi(i,Ln),Tl(i));for(var s=i.first;s!==null;){var p=s.next,m=(s.f&tp)!==0||(s.f&Io)!==0;R1(s,m?r:!1),s=p}if(i.transitions!==null)for(const b of i.transitions)(b.is_global||r)&&b.in()}}let Zc=!1;function fv(i){Zc=i}let Ml=!1;function mv(i){Ml=i}let Jt=null,fa=!1;function Kn(i){Jt=i}let er=null;function vs(i){er=i}let So=null;function uk(i){Jt!==null&&(So===null?So=[i]:So.push(i))}let Ki=null,Pn=0,Gn=null;function hk(i){Gn=i}let L1=1,$h=0,ml=$h;function gv(i){ml=i}let ds=!1;function D1(){return++L1}function gf(i){var r=i.f;if((r&Ln)!==0)return!0;if((r&xs)!==0){var s=i.deps,p=(r&ta)!==0;if(s!==null){var m,b,f=(r&qd)!==0,l=p&&er!==null&&!ds,C=s.length;if((f||l)&&(er===null||(er.f&ru)===0)){var M=i,D=M.parent;for(m=0;m<C;m++)b=s[m],(f||!b?.reactions?.includes(M))&&(b.reactions??=[]).push(M);f&&(M.f^=qd),l&&D!==null&&(D.f&ta)===0&&(M.f^=ta)}for(m=0;m<C;m++)if(b=s[m],gf(b)&&g1(b),b.wv>i.wv)return!0}(!p||er!==null&&!ds)&&Qi(i,Ni)}return!1}function j1(i,r,s=!0){var p=i.reactions;if(p!==null&&!So?.includes(i))for(var m=0;m<p.length;m++){var b=p[m];(b.f&sn)!==0?j1(b,r,!1):r===b&&(s?Qi(b,Ln):(b.f&Ni)!==0&&Qi(b,xs),Tl(b))}}function F1(i){var r=Ki,s=Pn,p=Gn,m=Jt,b=ds,f=So,l=Ui,C=fa,M=ml,D=i.f;Ki=null,Pn=0,Gn=null,ds=(D&ta)!==0&&(fa||!Zc||Jt===null),Jt=(D&(Io|Cl))===0?i:null,So=null,Zd(i.ctx),fa=!1,ml=++$h,i.ac!==null&&(np(()=>{i.ac.abort(u1)}),i.ac=null);try{i.f|=Bg;var O=i.fn,Z=O(),$=i.deps;if(Ki!==null){var ne;if(Hd(i,Pn),$!==null&&Pn>0)for($.length=Pn+Ki.length,ne=0;ne<Ki.length;ne++)$[Pn+ne]=Ki[ne];else i.deps=$=Ki;if(!ds||(D&sn)!==0&&i.reactions!==null)for(ne=Pn;ne<$.length;ne++)($[ne].reactions??=[]).push(i)}else $!==null&&Pn<$.length&&(Hd(i,Pn),$.length=Pn);if(mf()&&Gn!==null&&!fa&&$!==null&&(i.f&(sn|xs|Ln))===0)for(ne=0;ne<Gn.length;ne++)j1(Gn[ne],i);return m!==null&&m!==i&&($h++,Gn!==null&&(p===null?p=Gn:p.push(...Gn))),(i.f&Gd)!==0&&(i.f^=Gd),Z}catch(fe){return p1(fe)}finally{i.f^=Bg,Ki=r,Pn=s,Gn=p,Jt=m,ds=b,So=f,Zd(l),fa=C,ml=M}}function pk(i,r){let s=r.reactions;if(s!==null){var p=pS.call(s,i);if(p!==-1){var m=s.length-1;m===0?s=r.reactions=null:(s[p]=s[m],s.pop())}}s===null&&(r.f&sn)!==0&&(Ki===null||!Ki.includes(r))&&(Qi(r,xs),(r.f&(ta|qd))===0&&(r.f^=qd),m1(r),Hd(r,0))}function Hd(i,r){var s=i.deps;if(s!==null)for(var p=r;p<s.length;p++)pk(i,s[p])}function Nh(i){var r=i.f;if((r&ru)===0){Qi(i,Ni);var s=er,p=Zc;er=i,Zc=!0;try{(r&bs)!==0?ok(i):I1(i),A1(i);var m=F1(i);i.teardown=typeof m=="function"?m:null,i.wv=L1;var b;s1&&BS&&(i.f&Ln)!==0&&i.deps}finally{Zc=p,er=s}}}function lr(i){var r=i.f,s=(r&sn)!==0;if(Jt!==null&&!fa){var p=er!==null&&(er.f&ru)!==0;if(!p&&!So?.includes(i)){var m=Jt.deps;if((Jt.f&Bg)!==0)i.rv<$h&&(i.rv=$h,Ki===null&&m!==null&&m[Pn]===i?Pn++:Ki===null?Ki=[i]:(!ds||!Ki.includes(i))&&Ki.push(i));else{(Jt.deps??=[]).push(i);var b=i.reactions;b===null?i.reactions=[Jt]:b.includes(Jt)||b.push(Jt)}}}else if(s&&i.deps===null&&i.effects===null){var f=i,l=f.parent;l!==null&&(l.f&ta)===0&&(f.f^=ta)}if(Ml){if(ms.has(i))return ms.get(i);if(s){f=i;var C=f.v;return((f.f&Ni)===0&&f.reactions!==null||O1(f))&&(C=Ty(f)),ms.set(f,C),C}}else s&&(f=i,gf(f)&&g1(f));if((i.f&Gd)!==0)throw i.v;return i.v}function O1(i){if(i.v===$i)return!0;if(i.deps===null)return!1;for(const r of i.deps)if(ms.has(r)||(r.f&sn)!==0&&O1(r))return!0;return!1}function yf(i){var r=fa;try{return fa=!0,i()}finally{fa=r}}const dk=-7169;function Qi(i,r){i.f=i.f&dk|r}const fk=["touchstart","touchmove"];function mk(i){return fk.includes(i)}const gk=new Set,yv=new Set;function yk(i,r,s,p={}){function m(b){if(p.capture||bh.call(r,b),!b.cancelBubble)return np(()=>s?.call(this,b))}return i.startsWith("pointer")||i.startsWith("touch")||i==="wheel"?wl(()=>{r.addEventListener(i,m,p)}):r.addEventListener(i,m,p),m}function _k(i,r,s,p,m){var b={capture:p,passive:m},f=yk(i,r,s,b);(r===document.body||r===window||r===document||r instanceof HTMLMediaElement)&&nk(()=>{r.removeEventListener(i,f,b)})}let _v=null;function bh(i){var r=this,s=r.ownerDocument,p=i.type,m=i.composedPath?.()||[],b=m[0]||i.target;_v=i;var f=0,l=_v===i&&i.__root;if(l){var C=m.indexOf(l);if(C!==-1&&(r===document||r===window)){i.__root=r;return}var M=m.indexOf(r);if(M===-1)return;C<=M&&(f=C)}if(b=m[f]||i.target,b!==r){Og(i,"currentTarget",{configurable:!0,get(){return b||s}});var D=Jt,O=er;Kn(null),vs(null);try{for(var Z,$=[];b!==null;){var ne=b.assignedSlot||b.parentNode||b.host||null;try{var fe=b["__"+p];if(fe!=null&&(!b.disabled||i.target===b))if(l1(fe)){var[Ee,..._e]=fe;Ee.apply(b,[i,..._e])}else fe.call(b,i)}catch(Se){Z?$.push(Se):Z=Se}if(i.cancelBubble||ne===r||ne===null)break;b=ne}if(Z){for(let Se of $)queueMicrotask(()=>{throw Se});throw Z}}finally{i.__root=r,delete i.currentTarget,Kn(D),vs(O)}}}function vk(i){var r=document.createElement("template");return r.innerHTML=i.replaceAll("<!>","<!---->"),r.content}function bk(i,r){var s=er;s.nodes_start===null&&(s.nodes_start=i,s.nodes_end=r)}function ap(i,r){var s=(r&DS)!==0,p,m=!i.startsWith("<!>");return()=>{p===void 0&&(p=vk(m?i:"<!>"+i),p=T1(p));var b=s||v1?document.importNode(p,!0):p.cloneNode(!0);return bk(b,b),b}}function Uh(i,r){i!==null&&i.before(r)}let Vg=!0;function xk(i,r){return wk(i,r)}const Ec=new Map;function wk(i,{target:r,anchor:s,props:p={},events:m,context:b,intro:f=!0}){QS();var l=new Set,C=O=>{for(var Z=0;Z<O.length;Z++){var $=O[Z];if(!l.has($)){l.add($);var ne=mk($);r.addEventListener($,bh,{passive:ne});var fe=Ec.get($);fe===void 0?(document.addEventListener($,bh,{passive:ne}),Ec.set($,1)):Ec.set($,fe+1)}}};C(dS(gk)),yv.add(C);var M=void 0,D=ak(()=>{var O=s??r.appendChild(w1());return WS(O,{pending:()=>{}},Z=>{if(b){df({});var $=Ui;$.c=b}m&&(p.$$events=m),Vg=f,M=i(Z,p)||{},Vg=!0,b&&ff()}),()=>{for(var Z of l){r.removeEventListener(Z,bh);var $=Ec.get(Z);--$===0?(document.removeEventListener(Z,bh),Ec.delete(Z)):Ec.set(Z,$)}yv.delete(C),O!==s&&O.parentNode?.removeChild(O)}});return Tk.set(M,D),M}let Tk=new WeakMap;function Cy(i,r,s=!1){var p=i,m=null,b=null,f=$i,l=s?tp:0,C=!1;const M=($,ne=!0)=>{C=!0,Z(ne,$)};var D=null;function O(){D!==null&&(D.lastChild.remove(),p.before(D),D=null);var $=f?m:b,ne=f?b:m;$&&ck($),ne&&Eh(ne,()=>{f?b=null:m=null})}const Z=($,ne)=>{if(f!==(f=$)){var fe=ek(),Ee=p;if(fe&&(D=document.createDocumentFragment(),D.append(Ee=w1())),f?m??=ne&&bo(()=>ne(Ee)):b??=ne&&bo(()=>ne(Ee)),fe){var _e=an,Se=f?m:b,Pe=f?b:m;Se&&_e.skipped_effects.delete(Se),Pe&&_e.skipped_effects.add(Pe),_e.add_callback(O)}else O()}};M1(()=>{C=!1,r(M),C||Z(null,null)},l)}function Sk(i,r,s){var p=""+i;return p}function kk(i,r,s,p,m,b){var f=i.__className;if(f!==s||f===void 0){var l=Sk(s);l==null?i.removeAttribute("class"):i.className=l,i.__className=s}return b}const Ck=()=>performance.now(),xo={tick:i=>requestAnimationFrame(i),now:()=>Ck(),tasks:new Set};function B1(){const i=xo.now();xo.tasks.forEach(r=>{r.c(i)||(xo.tasks.delete(r),r.f())}),xo.tasks.size!==0&&xo.tick(B1)}function Pk(i){let r;return xo.tasks.size===0&&xo.tick(B1),{promise:new Promise(s=>{xo.tasks.add(r={c:i,f:s})}),abort(){xo.tasks.delete(r)}}}function Td(i,r){np(()=>{i.dispatchEvent(new CustomEvent(r))})}function Mk(i){if(i==="float")return"cssFloat";if(i==="offset")return"cssOffset";if(i.startsWith("--"))return i;const r=i.split("-");return r.length===1?r[0]:r[0]+r.slice(1).map(s=>s[0].toUpperCase()+s.slice(1)).join("")}function vv(i){const r={},s=i.split(";");for(const p of s){const[m,b]=p.split(":");if(!m||b===void 0)break;const f=Mk(m.trim());r[f]=b.trim()}return r}const Ak=i=>i;function Ik(i,r,s,p){var m=(i&LS)!==0,b="both",f,l=r.inert,C=r.style.overflow,M,D;function O(){return np(()=>f??=s()(r,p?.()??{},{direction:b}))}var Z={is_global:m,in(){r.inert=l,Td(r,"introstart"),M=qg(r,O(),D,1,()=>{Td(r,"introend"),M?.abort(),M=f=void 0,r.style.overflow=C})},out(Ee){r.inert=!0,Td(r,"outrostart"),D=qg(r,O(),M,0,()=>{Td(r,"outroend"),Ee?.()})},stop:()=>{M?.abort(),D?.abort()}},$=er;if(($.transitions??=[]).push(Z),Vg){var ne=m;if(!ne){for(var fe=$.parent;fe&&(fe.f&tp)!==0;)for(;(fe=fe.parent)&&(fe.f&bs)===0;);ne=!fe||(fe.f&pf)!==0}ne&&C1(()=>{yf(()=>Z.in())})}}function qg(i,r,s,p,m){var b=p===1;if(yS(r)){var f,l=!1;return wl(()=>{if(!l){var Ee=r({direction:b?"in":"out"});f=qg(i,Ee,s,p,m)}}),{abort:()=>{l=!0,f?.abort()},deactivate:()=>f.deactivate(),reset:()=>f.reset(),t:()=>f.t()}}if(s?.deactivate(),!r?.duration)return m(),{abort:Dc,deactivate:Dc,reset:Dc,t:()=>p};const{delay:C=0,css:M,tick:D,easing:O=Ak}=r;var Z=[];if(b&&s===void 0&&(D&&D(0,1),M)){var $=vv(M(0,1));Z.push($,$)}var ne=()=>1-p,fe=i.animate(Z,{duration:C,fill:"forwards"});return fe.onfinish=()=>{fe.cancel();var Ee=s?.t()??1-p;s?.abort();var _e=p-Ee,Se=r.duration*Math.abs(_e),Pe=[];if(Se>0){var ve=!1;if(M)for(var ye=Math.ceil(Se/16.666666666666668),Ae=0;Ae<=ye;Ae+=1){var Ne=Ee+_e*O(Ae/ye),it=vv(M(Ne,1-Ne));Pe.push(it),ve||=it.overflow==="hidden"}ve&&(i.style.overflow="hidden"),ne=()=>{var gt=fe.currentTime;return Ee+_e*O(gt/Se)},D&&Pk(()=>{if(fe.playState!=="running")return!1;var gt=ne();return D(gt,1-gt),!0})}fe=i.animate(Pe,{duration:Se,fill:"forwards"}),fe.onfinish=()=>{ne=()=>p,D?.(p,1-p),m()}},{abort:()=>{fe&&(fe.cancel(),fe.effect=null,fe.onfinish=Dc)},deactivate:()=>{m=Dc},reset:()=>{p===0&&D?.(1,0)},t:()=>ne()}}function bv(i,r){return i===r||i?.[Ah]===r}function Ek(i={},r,s,p){return C1(()=>{var m,b;return P1(()=>{m=b,b=[],yf(()=>{i!==s(...b)&&(r(i,...b),m&&bv(s(...m),i)&&r(null,...m))})}),()=>{wl(()=>{b&&bv(s(...b),i)&&r(null,...b)})}}),i}let Sd=!1;function zk(i){var r=Sd;try{return Sd=!1,[i(),Sd]}finally{Sd=r}}function Rk(i,r,s,p){var m=!ip||(s&zS)!==0,b=(s&RS)!==0,f=p,l=!0,C=()=>(l&&(l=!1,f=p),f),M;{var D=Ah in i||wS in i;M=Gc(i,r)?.set??(D&&r in i?Se=>i[r]=Se:void 0)}var O,Z=!1;[O,Z]=zk(()=>i[r]);var $;if(m?$=()=>{var Se=i[r];return Se===void 0?C():(l=!0,Se)}:$=()=>{var Se=i[r];return Se!==void 0&&(f=void 0),Se===void 0?f:Se},M){var ne=i.$$legacy;return(function(Se,Pe){return arguments.length>0?((!m||!Pe||ne||Z)&&M(Pe?$():Se),Se):$()})}var fe=!1,Ee=YS(()=>(fe=!1,$()));lr(Ee);var _e=er;return(function(Se,Pe){if(arguments.length>0){const ve=Pe?lr(Ee):m&&b?dl(Se):Se;return Ji(Ee,ve),fe=!0,f!==void 0&&(f=ve),Se}return Ml&&fe||(_e.f&ru)!==0?Ee.v:lr(Ee)})}function Py(i){Ui===null&&TS(),ip&&Ui.l!==null?Lk(Ui).m.push(i):S1(()=>{const r=yf(i);if(typeof r=="function")return r})}function Lk(i){var r=i.l;return r.u??={a:[],b:[],m:[]}}const Dk="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(Dk);function $1(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Rd={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.6.2/LICENSE.txt
 */var jk=Rd.exports,xv;function Fk(){return xv||(xv=1,(function(i,r){(function(s,p){i.exports=p()})(jk,(function(){var s={},p={};function m(f,l,C){if(p[f]=C,f==="index"){var M="var sharedModule = {}; ("+p.shared+")(sharedModule); ("+p.worker+")(sharedModule);",D={};return p.shared(D),p.index(s,D),typeof window<"u"&&s.setWorkerUrl(window.URL.createObjectURL(new Blob([M],{type:"text/javascript"}))),s}}m("shared",["exports"],(function(f){function l(a,t,n,c){return new(n||(n=Promise))((function(h,_){function v(P){try{T(c.next(P))}catch(I){_(I)}}function w(P){try{T(c.throw(P))}catch(I){_(I)}}function T(P){var I;P.done?h(P.value):(I=P.value,I instanceof n?I:new n((function(z){z(I)}))).then(v,w)}T((c=c.apply(a,t||[])).next())}))}function C(a,t){this.x=a,this.y=t}function M(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var D,O;typeof SuppressedError=="function"&&SuppressedError,C.prototype={clone(){return new C(this.x,this.y)},add(a){return this.clone()._add(a)},sub(a){return this.clone()._sub(a)},multByPoint(a){return this.clone()._multByPoint(a)},divByPoint(a){return this.clone()._divByPoint(a)},mult(a){return this.clone()._mult(a)},div(a){return this.clone()._div(a)},rotate(a){return this.clone()._rotate(a)},rotateAround(a,t){return this.clone()._rotateAround(a,t)},matMult(a){return this.clone()._matMult(a)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(a){return this.x===a.x&&this.y===a.y},dist(a){return Math.sqrt(this.distSqr(a))},distSqr(a){const t=a.x-this.x,n=a.y-this.y;return t*t+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith(a){return this.angleWithSep(a.x,a.y)},angleWithSep(a,t){return Math.atan2(this.x*t-this.y*a,this.x*a+this.y*t)},_matMult(a){const t=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=t,this},_add(a){return this.x+=a.x,this.y+=a.y,this},_sub(a){return this.x-=a.x,this.y-=a.y,this},_mult(a){return this.x*=a,this.y*=a,this},_div(a){return this.x/=a,this.y/=a,this},_multByPoint(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint(a){return this.x/=a.x,this.y/=a.y,this},_unit(){return this._div(this.mag()),this},_perp(){const a=this.y;return this.y=this.x,this.x=-a,this},_rotate(a){const t=Math.cos(a),n=Math.sin(a),c=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=c,this},_rotateAround(a,t){const n=Math.cos(a),c=Math.sin(a),h=t.y+c*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-c*(this.y-t.y),this.y=h,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:C},C.convert=function(a){if(a instanceof C)return a;if(Array.isArray(a))return new C(+a[0],+a[1]);if(a.x!==void 0&&a.y!==void 0)return new C(+a.x,+a.y);throw new Error("Expected [x, y] or {x, y} point format")};var Z=(function(){if(O)return D;function a(t,n,c,h){this.cx=3*t,this.bx=3*(c-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(h-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=c,this.p2y=h}return O=1,D=a,a.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,n){if(n===void 0&&(n=1e-6),t<0)return 0;if(t>1)return 1;for(var c=t,h=0;h<8;h++){var _=this.sampleCurveX(c)-t;if(Math.abs(_)<n)return c;var v=this.sampleCurveDerivativeX(c);if(Math.abs(v)<1e-6)break;c-=_/v}var w=0,T=1;for(c=t,h=0;h<20&&(_=this.sampleCurveX(c),!(Math.abs(_-t)<n));h++)t>_?w=c:T=c,c=.5*(T-w)+w;return c},solve:function(t,n){return this.sampleCurveY(this.solveCurveX(t,n))}},D})(),$=M(Z);let ne,fe;function Ee(){return ne==null&&(ne=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),ne}function _e(){if(fe==null&&(fe=!1,Ee())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let c=0;c<25;c++){const h=4*c;t.fillStyle=`rgb(${h},${h+1},${h+2})`,t.fillRect(c%5,Math.floor(c/5),1,1)}const n=t.getImageData(0,0,5,5).data;for(let c=0;c<100;c++)if(c%4!=3&&n[c]!==c){fe=!0;break}}}return fe||!1}var Se=1e-6,Pe=typeof Float32Array<"u"?Float32Array:Array;function ve(){var a=new Pe(9);return Pe!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function ye(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Ae(){var a=new Pe(3);return Pe!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function Ne(a){return Math.hypot(a[0],a[1],a[2])}function it(a,t,n){var c=new Pe(3);return c[0]=a,c[1]=t,c[2]=n,c}function gt(a,t,n){return a[0]=t[0]+n[0],a[1]=t[1]+n[1],a[2]=t[2]+n[2],a}function nt(a,t,n){return a[0]=t[0]*n,a[1]=t[1]*n,a[2]=t[2]*n,a}function Zt(a,t,n){var c=t[0],h=t[1],_=t[2],v=n[0],w=n[1],T=n[2];return a[0]=h*T-_*w,a[1]=_*v-c*T,a[2]=c*w-h*v,a}Math.hypot||(Math.hypot=function(){for(var a=0,t=arguments.length;t--;)a+=arguments[t]*arguments[t];return Math.sqrt(a)});var kt,ur=Ne;function hi(a,t,n){var c=t[0],h=t[1],_=t[2],v=t[3];return a[0]=n[0]*c+n[4]*h+n[8]*_+n[12]*v,a[1]=n[1]*c+n[5]*h+n[9]*_+n[13]*v,a[2]=n[2]*c+n[6]*h+n[10]*_+n[14]*v,a[3]=n[3]*c+n[7]*h+n[11]*_+n[15]*v,a}function pi(){var a=new Pe(4);return Pe!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function zi(a,t,n,c){var h=.5*Math.PI/180;t*=h,n*=h,c*=h;var _=Math.sin(t),v=Math.cos(t),w=Math.sin(n),T=Math.cos(n),P=Math.sin(c),I=Math.cos(c);return a[0]=_*T*I-v*w*P,a[1]=v*w*I+_*T*P,a[2]=v*T*P-_*w*I,a[3]=v*T*I+_*w*P,a}function Ri(){var a=new Pe(2);return Pe!=Float32Array&&(a[0]=0,a[1]=0),a}function br(a,t){var n=new Pe(2);return n[0]=a,n[1]=t,n}Ae(),kt=new Pe(4),Pe!=Float32Array&&(kt[0]=0,kt[1]=0,kt[2]=0,kt[3]=0),Ae(),it(1,0,0),it(0,1,0),pi(),pi(),ve(),Ri();const Ft=8192;function Ye(a,t,n){return t*(Ft/(a.tileSize*Math.pow(2,n-a.tileID.overscaledZ)))}function st(a,t){return(a%t+t)%t}function vt(a,t,n){return a*(1-n)+t*n}function Ot(a){if(a<=0)return 0;if(a>=1)return 1;const t=a*a,n=t*a;return 4*(a<.5?n:3*(a-t)+n-.75)}function Et(a,t,n,c){const h=new $(a,t,n,c);return _=>h.solve(_)}const pr=Et(.25,.1,.25,1);function Vt(a,t,n){return Math.min(n,Math.max(t,a))}function yr(a,t,n){const c=n-t,h=((a-t)%c+c)%c+t;return h===t?n:h}function Qt(a,...t){for(const n of t)for(const c in n)a[c]=n[c];return a}let Cr=1;function di(a,t,n){const c={};for(const h in a)c[h]=t.call(this,a[h],h,a);return c}function xr(a,t,n){const c={};for(const h in a)t.call(this,a[h],h,a)&&(c[h]=a[h]);return c}function dr(a){return Array.isArray(a)?a.map(dr):typeof a=="object"&&a?di(a,dr):a}const Ht={};function tr(a){Ht[a]||(typeof console<"u"&&console.warn(a),Ht[a]=!0)}function Ur(a,t,n){return(n.y-a.y)*(t.x-a.x)>(t.y-a.y)*(n.x-a.x)}function Li(a){return typeof WorkerGlobalScope<"u"&&a!==void 0&&a instanceof WorkerGlobalScope}let Xa=null;function jn(a){return typeof ImageBitmap<"u"&&a instanceof ImageBitmap}const Fn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function zo(a,t,n,c,h){return l(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const _=new VideoFrame(a,{timestamp:0});try{const v=_?.format;if(!v||!v.startsWith("BGR")&&!v.startsWith("RGB"))throw new Error(`Unrecognized format ${v}`);const w=v.startsWith("BGR"),T=new Uint8ClampedArray(c*h*4);if(yield _.copyTo(T,(function(P,I,z,j,B){const N=4*Math.max(-I,0),q=(Math.max(0,z)-z)*j*4+N,H=4*j,J=Math.max(0,I),ue=Math.max(0,z);return{rect:{x:J,y:ue,width:Math.min(P.width,I+j)-J,height:Math.min(P.height,z+B)-ue},layout:[{offset:q,stride:H}]}})(a,t,n,c,h)),w)for(let P=0;P<T.length;P+=4){const I=T[P];T[P]=T[P+2],T[P+2]=I}return T}finally{_.close()}}))}let xa,wa;function Ta(a,t,n,c){return a.addEventListener(t,n,c),{unsubscribe:()=>{a.removeEventListener(t,n,c)}}}function Ka(a){return a*Math.PI/180}function Sa(a){return a/Math.PI*180}const ka={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Ca={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},Ro="AbortError";function he(){return new Error(Ro)}const V={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function G(a){return V.REGISTERED_PROTOCOLS[a.substring(0,a.indexOf("://"))]}const W="global-dispatcher";class re extends Error{constructor(t,n,c,h){super(`AJAXError: ${n} (${t}): ${c}`),this.status=t,this.statusText=n,this.url=c,this.body=h}}const ce=()=>Li(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,pe=function(a,t){if(/:\/\//.test(a.url)&&!/^https?:|^file:/.test(a.url)){const c=G(a.url);if(c)return c(a,t);if(Li(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:a,targetMapId:W},t)}if(!(/^file:/.test(n=a.url)||/^file:/.test(ce())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(c,h){return l(this,void 0,void 0,(function*(){const _=new Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,cache:c.cache,referrer:ce(),signal:h.signal});let v,w;c.type!=="json"||_.headers.has("Accept")||_.headers.set("Accept","application/json");try{v=yield fetch(_)}catch(P){throw new re(0,P.message,c.url,new Blob)}if(!v.ok){const P=yield v.blob();throw new re(v.status,v.statusText,c.url,P)}w=c.type==="arrayBuffer"||c.type==="image"?v.arrayBuffer():c.type==="json"?v.json():v.text();const T=yield w;if(h.signal.aborted)throw he();return{data:T,cacheControl:v.headers.get("Cache-Control"),expires:v.headers.get("Expires")}}))})(a,t);if(Li(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:a,mustQueue:!0,targetMapId:W},t)}var n;return(function(c,h){return new Promise(((_,v)=>{var w;const T=new XMLHttpRequest;T.open(c.method||"GET",c.url,!0),c.type!=="arrayBuffer"&&c.type!=="image"||(T.responseType="arraybuffer");for(const P in c.headers)T.setRequestHeader(P,c.headers[P]);c.type==="json"&&(T.responseType="text",!((w=c.headers)===null||w===void 0)&&w.Accept||T.setRequestHeader("Accept","application/json")),T.withCredentials=c.credentials==="include",T.onerror=()=>{v(new Error(T.statusText))},T.onload=()=>{if(!h.signal.aborted)if((T.status>=200&&T.status<300||T.status===0)&&T.response!==null){let P=T.response;if(c.type==="json")try{P=JSON.parse(T.response)}catch(I){return void v(I)}_({data:P,cacheControl:T.getResponseHeader("Cache-Control"),expires:T.getResponseHeader("Expires")})}else{const P=new Blob([T.response],{type:T.getResponseHeader("Content-Type")});v(new re(T.status,T.statusText,c.url,P))}},h.signal.addEventListener("abort",(()=>{T.abort(),v(he())})),T.send(c.body)}))})(a,t)};function Te(a){if(!a||a.indexOf("://")<=0||a.indexOf("data:image/")===0||a.indexOf("blob:")===0)return!0;const t=new URL(a),n=window.location;return t.protocol===n.protocol&&t.host===n.host}function me(a,t,n){n[a]&&n[a].indexOf(t)!==-1||(n[a]=n[a]||[],n[a].push(t))}function Ie(a,t,n){if(n&&n[a]){const c=n[a].indexOf(t);c!==-1&&n[a].splice(c,1)}}class je{constructor(t,n={}){Qt(this,n),this.type=t}}class Re extends je{constructor(t,n={}){super("error",Qt({error:t},n))}}class tt{on(t,n){return this._listeners=this._listeners||{},me(t,n,this._listeners),{unsubscribe:()=>{this.off(t,n)}}}off(t,n){return Ie(t,n,this._listeners),Ie(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},me(t,n,this._oneTimeListeners),this):new Promise((c=>this.once(t,c)))}fire(t,n){typeof t=="string"&&(t=new je(t,n||{}));const c=t.type;if(this.listens(c)){t.target=this;const h=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const w of h)w.call(this,t);const _=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const w of _)Ie(c,w,this._oneTimeListeners),w.call(this,t);const v=this._eventedParent;v&&(Qt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(t))}else t instanceof Re&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var ge={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const mt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ct(a,t){const n={};for(const c in a)c!=="ref"&&(n[c]=a[c]);return mt.forEach((c=>{c in t&&(n[c]=t[c])})),n}function ot(a,t){if(Array.isArray(a)){if(!Array.isArray(t)||a.length!==t.length)return!1;for(let n=0;n<a.length;n++)if(!ot(a[n],t[n]))return!1;return!0}if(typeof a=="object"&&a!==null&&t!==null){if(typeof t!="object"||Object.keys(a).length!==Object.keys(t).length)return!1;for(const n in a)if(!ot(a[n],t[n]))return!1;return!0}return a===t}function bt(a,t){a.push(t)}function hr(a,t,n){bt(n,{command:"addSource",args:[a,t[a]]})}function Vr(a,t,n){bt(t,{command:"removeSource",args:[a]}),n[a]=!0}function qr(a,t,n,c){Vr(a,n,c),hr(a,t,n)}function zr(a,t,n){let c;for(c in a[n])if(Object.prototype.hasOwnProperty.call(a[n],c)&&c!=="data"&&!ot(a[n][c],t[n][c]))return!1;for(c in t[n])if(Object.prototype.hasOwnProperty.call(t[n],c)&&c!=="data"&&!ot(a[n][c],t[n][c]))return!1;return!0}function zt(a,t,n,c,h,_){a=a||{},t=t||{};for(const v in a)Object.prototype.hasOwnProperty.call(a,v)&&(ot(a[v],t[v])||n.push({command:_,args:[c,v,t[v],h]}));for(const v in t)Object.prototype.hasOwnProperty.call(t,v)&&!Object.prototype.hasOwnProperty.call(a,v)&&(ot(a[v],t[v])||n.push({command:_,args:[c,v,t[v],h]}))}function qt(a){return a.id}function Dr(a,t){return a[t.id]=t,a}class Oe{constructor(t,n,c,h){this.message=(t?`${t}: `:"")+c,h&&(this.identifier=h),n!=null&&n.__line__&&(this.line=n.__line__)}}function fi(a,...t){for(const n of t)for(const c in n)a[c]=n[c];return a}class wr extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}class Pa{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[c,h]of n)this.bindings[c]=h}concat(t){return new Pa(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Lo={kind:"null"},We={kind:"number"},Pt={kind:"string"},St={kind:"boolean"},ni={kind:"color"},Ya={kind:"projectionDefinition"},Ma={kind:"object"},wt={kind:"value"},Il={kind:"collator"},Aa={kind:"formatted"},El={kind:"padding"},On={kind:"colorArray"},Do={kind:"numberArray"},Pr={kind:"resolvedImage"},zl={kind:"variableAnchorOffsetCollection"};function Di(a,t){return{kind:"array",itemType:a,N:t}}function or(a){if(a.kind==="array"){const t=or(a.itemType);return typeof a.N=="number"?`array<${t}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${t}>`}return a.kind}const pp=[Lo,We,Pt,St,ni,Ya,Aa,Ma,Di(wt),El,Do,On,Pr,zl];function Ts(a,t){if(t.kind==="error")return null;if(a.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Ts(a.itemType,t.itemType))&&(typeof a.N!="number"||a.N===t.N))return null}else{if(a.kind===t.kind)return null;if(a.kind==="value"){for(const n of pp)if(!Ts(n,t))return null}}return`Expected ${or(a)} but found ${or(t)} instead.`}function cu(a,t){return t.some((n=>n.kind===a.kind))}function Ia(a,t){return t.some((n=>n==="null"?a===null:n==="array"?Array.isArray(a):n==="object"?a&&!Array.isArray(a)&&typeof a=="object":n===typeof a))}function Ea(a,t){return a.kind==="array"&&t.kind==="array"?a.itemType.kind===t.itemType.kind&&typeof a.N=="number":a.kind===t.kind}const uu=.96422,dp=.82521,fp=4/29,jo=6/29,mp=3*jo*jo,Nf=jo*jo*jo,Uf=Math.PI/180,Vf=180/Math.PI;function hu(a){return(a%=360)<0&&(a+=360),a}function Fo([a,t,n,c]){let h,_;const v=du((.2225045*(a=pu(a))+.7168786*(t=pu(t))+.0606169*(n=pu(n)))/1);a===t&&t===n?h=_=v:(h=du((.4360747*a+.3850649*t+.1430804*n)/uu),_=du((.0139322*a+.0971045*t+.7141733*n)/dp));const w=116*v-16;return[w<0?0:w,500*(h-v),200*(v-_),c]}function pu(a){return a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function du(a){return a>Nf?Math.pow(a,1/3):a/mp+fp}function Oo([a,t,n,c]){let h=(a+16)/116,_=isNaN(t)?h:h+t/500,v=isNaN(n)?h:h-n/200;return h=1*mu(h),_=uu*mu(_),v=dp*mu(v),[fu(3.1338561*_-1.6168667*h-.4906146*v),fu(-.9787684*_+1.9161415*h+.033454*v),fu(.0719453*_-.2289914*h+1.4052427*v),c]}function fu(a){return(a=a<=.00304?12.92*a:1.055*Math.pow(a,1/2.4)-.055)<0?0:a>1?1:a}function mu(a){return a>jo?a*a*a:mp*(a-fp)}const qf=Object.hasOwn||function(a,t){return Object.prototype.hasOwnProperty.call(a,t)};function Bo(a,t){return qf(a,t)?a[t]:void 0}function Ss(a){return parseInt(a.padEnd(2,a),16)/255}function un(a,t){return Mt(t?a/100:a,0,1)}function Mt(a,t,n){return Math.min(Math.max(t,a),n)}function Ja(a){return!a.some(Number.isNaN)}const za={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function ra(a,t,n){return a+n*(t-a)}function Qa(a,t,n){return a.map(((c,h)=>ra(c,t[h],n)))}class At{constructor(t,n,c,h=1,_=!0){this.r=t,this.g=n,this.b=c,this.a=h,_||(this.r*=h,this.g*=h,this.b*=h,h||this.overwriteGetter("rgb",[t,n,c,h]))}static parse(t){if(t instanceof At)return t;if(typeof t!="string")return;const n=(function(c){if((c=c.toLowerCase().trim())==="transparent")return[0,0,0,0];const h=Bo(za,c);if(h){const[v,w,T]=h;return[v/255,w/255,T/255,1]}if(c.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(c)){const v=c.length<6?1:2;let w=1;return[Ss(c.slice(w,w+=v)),Ss(c.slice(w,w+=v)),Ss(c.slice(w,w+=v)),Ss(c.slice(w,w+v)||"ff")]}if(c.startsWith("rgb")){const v=c.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[w,T,P,I,z,j,B,N,q,H,J,ue]=v,ae=[I||" ",B||" ",H].join("");if(ae==="  "||ae==="  /"||ae===",,"||ae===",,,"){const se=[P,j,q].join(""),we=se==="%%%"?100:se===""?255:0;if(we){const Me=[Mt(+T/we,0,1),Mt(+z/we,0,1),Mt(+N/we,0,1),J?un(+J,ue):1];if(Ja(Me))return Me}}return}}const _=c.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[v,w,T,P,I,z,j,B,N]=_,q=[T||" ",I||" ",j].join("");if(q==="  "||q==="  /"||q===",,"||q===",,,"){const H=[+w,Mt(+P,0,100),Mt(+z,0,100),B?un(+B,N):1];if(Ja(H))return(function([J,ue,ae,se]){function we(Me){const De=(Me+J/30)%12,Ze=ue*Math.min(ae,1-ae);return ae-Ze*Math.max(-1,Math.min(De-3,9-De,1))}return J=hu(J),ue/=100,ae/=100,[we(0),we(8),we(4),se]})(H)}}})(t);return n?new At(...n,!1):void 0}get rgb(){const{r:t,g:n,b:c,a:h}=this,_=h||1/0;return this.overwriteGetter("rgb",[t/_,n/_,c/_,h])}get hcl(){return this.overwriteGetter("hcl",(function(t){const[n,c,h,_]=Fo(t),v=Math.sqrt(c*c+h*h);return[Math.round(1e4*v)?hu(Math.atan2(h,c)*Vf):NaN,v,n,_]})(this.rgb))}get lab(){return this.overwriteGetter("lab",Fo(this.rgb))}overwriteGetter(t,n){return Object.defineProperty(this,t,{value:n}),n}toString(){const[t,n,c,h]=this.rgb;return`rgba(${[t,n,c].map((_=>Math.round(255*_))).join(",")},${h})`}static interpolate(t,n,c,h="rgb"){switch(h){case"rgb":{const[_,v,w,T]=Qa(t.rgb,n.rgb,c);return new At(_,v,w,T,!1)}case"hcl":{const[_,v,w,T]=t.hcl,[P,I,z,j]=n.hcl;let B,N;if(isNaN(_)||isNaN(P))isNaN(_)?isNaN(P)?B=NaN:(B=P,w!==1&&w!==0||(N=I)):(B=_,z!==1&&z!==0||(N=v));else{let ae=P-_;P>_&&ae>180?ae-=360:P<_&&_-P>180&&(ae+=360),B=_+c*ae}const[q,H,J,ue]=(function([ae,se,we,Me]){return ae=isNaN(ae)?0:ae*Uf,Oo([we,Math.cos(ae)*se,Math.sin(ae)*se,Me])})([B,N??ra(v,I,c),ra(w,z,c),ra(T,j,c)]);return new At(q,H,J,ue,!1)}case"lab":{const[_,v,w,T]=Oo(Qa(t.lab,n.lab,c));return new At(_,v,w,T,!1)}}}}At.black=new At(0,0,0,1),At.white=new At(1,1,1,1),At.transparent=new At(0,0,0,0),At.red=new At(1,0,0,1);class eo{constructor(t,n,c){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Rl=["bottom","center","top"];class Ll{constructor(t,n,c,h,_,v){this.text=t,this.image=n,this.scale=c,this.fontStack=h,this.textColor=_,this.verticalAlign=v}}class bi{constructor(t){this.sections=t}static fromString(t){return new bi([new Ll(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((t=>t.text.length!==0||t.image&&t.image.name.length!==0))}static factory(t){return t instanceof bi?t:bi.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map((t=>t.text)).join("")}}class Xr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Xr)return t;if(typeof t=="number")return new Xr([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const n of t)if(typeof n!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new Xr(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,c){return new Xr(Qa(t.values,n.values,c))}}class xi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof xi)return t;if(typeof t=="number")return new xi([t]);if(Array.isArray(t)){for(const n of t)if(typeof n!="number")return;return new xi(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,c){return new xi(Qa(t.values,n.values,c))}}class jr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof jr)return t;if(typeof t=="string"){const c=At.parse(t);return c?new jr([c]):void 0}if(!Array.isArray(t))return;const n=[];for(const c of t){if(typeof c!="string")return;const h=At.parse(c);if(!h)return;n.push(h)}return new jr(n)}toString(){return JSON.stringify(this.values)}static interpolate(t,n,c,h="rgb"){const _=[];if(t.values.length!=n.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${n.values.length}), cannot interpolate.`);for(let v=0;v<t.values.length;v++)_.push(At.interpolate(t.values[v],n.values[v],c,h));return new jr(_)}}class sr extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}const gp=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class wi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof wi)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let n=0;n<t.length;n+=2){const c=t[n],h=t[n+1];if(typeof c!="string"||!gp.has(c)||!Array.isArray(h)||h.length!==2||typeof h[0]!="number"||typeof h[1]!="number")return}return new wi(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,n,c){const h=t.values,_=n.values;if(h.length!==_.length)throw new sr(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${n.toString()}`);const v=[];for(let w=0;w<h.length;w+=2){if(h[w]!==_[w])throw new sr(`Cannot interpolate values containing mismatched anchors. from[${w}]: ${h[w]}, to[${w}]: ${_[w]}`);v.push(h[w]);const[T,P]=h[w+1],[I,z]=_[w+1];v.push([ra(T,I,c),ra(P,z,c)])}return new wi(v)}}class Vi{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Vi({name:t,available:!1}):null}}class mi{constructor(t,n,c){this.from=t,this.to=n,this.transition=c}static interpolate(t,n,c){return new mi(t,n,c)}static parse(t){return t instanceof mi?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new mi(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new mi(t.from,t.to,t.transition):typeof t=="string"?new mi(t,t,1):void 0}}function fr(a,t,n,c){return typeof a=="number"&&a>=0&&a<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[a,t,n,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[a,t,n,c]:[a,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function to(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof mi||a instanceof At||a instanceof eo||a instanceof bi||a instanceof Xr||a instanceof xi||a instanceof jr||a instanceof wi||a instanceof Vi)return!0;if(Array.isArray(a)){for(const t of a)if(!to(t))return!1;return!0}if(typeof a=="object"){for(const t in a)if(!to(a[t]))return!1;return!0}return!1}function pt(a){if(a===null)return Lo;if(typeof a=="string")return Pt;if(typeof a=="boolean")return St;if(typeof a=="number")return We;if(a instanceof At)return ni;if(a instanceof mi)return Ya;if(a instanceof eo)return Il;if(a instanceof bi)return Aa;if(a instanceof Xr)return El;if(a instanceof xi)return Do;if(a instanceof jr)return On;if(a instanceof wi)return zl;if(a instanceof Vi)return Pr;if(Array.isArray(a)){const t=a.length;let n;for(const c of a){const h=pt(c);if(n){if(n===h)continue;n=wt;break}n=h}return Di(n||wt,t)}return Ma}function yt(a){const t=typeof a;return a===null?"":t==="string"||t==="number"||t==="boolean"?String(a):a instanceof At||a instanceof mi||a instanceof bi||a instanceof Xr||a instanceof xi||a instanceof jr||a instanceof wi||a instanceof Vi?a.toString():JSON.stringify(a)}class ia{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(t.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!to(t[1]))return n.error("invalid value");const c=t[1];let h=pt(c);const _=n.expectedType;return h.kind!=="array"||h.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(h=_),new ia(h,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Gt={string:Pt,number:We,boolean:St,object:Ma};class qi{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let c,h=1;const _=t[0];if(_==="array"){let w,T;if(t.length>2){const P=t[1];if(typeof P!="string"||!(P in Gt)||P==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);w=Gt[P],h++}else w=wt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);T=t[2],h++}c=Di(w,T)}else{if(!Gt[_])throw new Error(`Types doesn't contain name = ${_}`);c=Gt[_]}const v=[];for(;h<t.length;h++){const w=n.parse(t[h],h,wt);if(!w)return null;v.push(w)}return new qi(c,v)}evaluate(t){for(let n=0;n<this.args.length;n++){const c=this.args[n].evaluate(t);if(!Ts(this.type,pt(c)))return c;if(n===this.args.length-1)throw new sr(`Expected value to be of type ${or(this.type)}, but found ${or(pt(c))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const Bn={"to-boolean":St,"to-color":ni,"to-number":We,"to-string":Pt};class $n{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const c=t[0];if(!Bn[c])throw new Error(`Can't parse ${c} as it is not part of the known types`);if((c==="to-boolean"||c==="to-string")&&t.length!==2)return n.error("Expected one argument.");const h=Bn[c],_=[];for(let v=1;v<t.length;v++){const w=n.parse(t[v],v,wt);if(!w)return null;_.push(w)}return new $n(h,_)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let n,c;for(const h of this.args){if(n=h.evaluate(t),c=null,n instanceof At)return n;if(typeof n=="string"){const _=t.parseColor(n);if(_)return _}else if(Array.isArray(n)&&(c=n.length<3||n.length>4?`Invalid rgba value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:fr(n[0],n[1],n[2],n[3]),!c))return new At(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new sr(c||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const c of this.args){n=c.evaluate(t);const h=Xr.parse(n);if(h)return h}throw new sr(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"numberArray":{let n;for(const c of this.args){n=c.evaluate(t);const h=xi.parse(n);if(h)return h}throw new sr(`Could not parse numberArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"colorArray":{let n;for(const c of this.args){n=c.evaluate(t);const h=jr.parse(n);if(h)return h}throw new sr(`Could not parse colorArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const c of this.args){n=c.evaluate(t);const h=wi.parse(n);if(h)return h}throw new sr(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const c of this.args){if(n=c.evaluate(t),n===null)return 0;const h=Number(n);if(!isNaN(h))return h}throw new sr(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return bi.fromString(yt(this.args[0].evaluate(t)));case"resolvedImage":return Vi.fromString(yt(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return yt(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const Dl=["Unknown","Point","LineString","Polygon"];class gu{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Dl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let n=this._parseColorCache.get(t);return n||(n=At.parse(t),this._parseColorCache.set(t,n)),n}}class $o{constructor(t,n,c=[],h,_=new Pa,v=[]){this.registry=t,this.path=c,this.key=c.map((w=>`[${w}]`)).join(""),this.scope=_,this.errors=v,this.expectedType=h,this._isConstant=n}parse(t,n,c,h,_={}){return n?this.concat(n,c,h)._parse(t,_):this._parse(t,_)}_parse(t,n){function c(h,_,v){return v==="assert"?new qi(_,[h]):v==="coerce"?new $n(_,[h]):h}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=t[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const _=this.registry[h];if(_){let v=_.parse(t,this);if(!v)return null;if(this.expectedType){const w=this.expectedType,T=v.type;if(w.kind!=="string"&&w.kind!=="number"&&w.kind!=="boolean"&&w.kind!=="object"&&w.kind!=="array"||T.kind!=="value"){if(w.kind==="projectionDefinition"&&["string","array"].includes(T.kind)||["color","formatted","resolvedImage"].includes(w.kind)&&["value","string"].includes(T.kind)||["padding","numberArray"].includes(w.kind)&&["value","number","array"].includes(T.kind)||w.kind==="colorArray"&&["value","string","array"].includes(T.kind)||w.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(T.kind))v=c(v,w,n.typeAnnotation||"coerce");else if(this.checkSubtype(w,T))return null}else v=c(v,w,n.typeAnnotation||"assert")}if(!(v instanceof ia)&&v.type.kind!=="resolvedImage"&&this._isConstant(v)){const w=new gu;try{v=new ia(v.type,v.evaluate(w))}catch(T){return this.error(T.message),null}}return v}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,c){const h=typeof t=="number"?this.path.concat(t):this.path,_=c?this.scope.concat(c):this.scope;return new $o(this.registry,this._isConstant,h,n||null,_,this.errors)}error(t,...n){const c=`${this.key}${n.map((h=>`[${h}]`)).join("")}`;this.errors.push(new wr(c,t))}checkSubtype(t,n){const c=Ts(t,n);return c&&this.error(c),c}}class ks{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const c=[];for(let _=1;_<t.length-1;_+=2){const v=t[_];if(typeof v!="string")return n.error(`Expected string, but found ${typeof v} instead.`,_);if(/[^a-zA-Z0-9_]/.test(v))return n.error("Variable names must contain only alphanumeric characters or '_'.",_);const w=n.parse(t[_+1],_+1);if(!w)return null;c.push([v,w])}const h=n.parse(t[t.length-1],t.length-1,n.expectedType,c);return h?new ks(c,h):null}outputDefined(){return this.result.outputDefined()}}class jl{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const c=t[1];return n.scope.has(c)?new jl(c,n.scope.get(c)):n.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Fl{constructor(t,n,c){this.type=t,this.index=n,this.input=c}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=n.parse(t[1],1,We),h=n.parse(t[2],2,Di(n.expectedType||wt));return c&&h?new Fl(h.type.itemType,c,h):null}evaluate(t){const n=this.index.evaluate(t),c=this.input.evaluate(t);if(n<0)throw new sr(`Array index out of bounds: ${n} < 0.`);if(n>=c.length)throw new sr(`Array index out of bounds: ${n} > ${c.length-1}.`);if(n!==Math.floor(n))throw new sr(`Array index must be an integer, but found ${n} instead.`);return c[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Ol{constructor(t,n){this.type=St,this.needle=t,this.haystack=n}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const c=n.parse(t[1],1,wt),h=n.parse(t[2],2,wt);return c&&h?cu(c.type,[St,Pt,We,Lo,wt])?new Ol(c,h):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${or(c.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(!c)return!1;if(!Ia(n,["boolean","string","number","null"]))throw new sr(`Expected first argument to be of type boolean, string, number or null, but found ${or(pt(n))} instead.`);if(!Ia(c,["string","array"]))throw new sr(`Expected second argument to be of type array or string, but found ${or(pt(c))} instead.`);return c.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class hn{constructor(t,n,c){this.type=We,this.needle=t,this.haystack=n,this.fromIndex=c}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=n.parse(t[1],1,wt),h=n.parse(t[2],2,wt);if(!c||!h)return null;if(!cu(c.type,[St,Pt,We,Lo,wt]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${or(c.type)} instead`);if(t.length===4){const _=n.parse(t[3],3,We);return _?new hn(c,h,_):null}return new hn(c,h)}evaluate(t){const n=this.needle.evaluate(t),c=this.haystack.evaluate(t);if(!Ia(n,["boolean","string","number","null"]))throw new sr(`Expected first argument to be of type boolean, string, number or null, but found ${or(pt(n))} instead.`);let h;if(this.fromIndex&&(h=this.fromIndex.evaluate(t)),Ia(c,["string"])){const _=c.indexOf(n,h);return _===-1?-1:[...c.slice(0,_)].length}if(Ia(c,["array"]))return c.indexOf(n,h);throw new sr(`Expected second argument to be of type array or string, but found ${or(pt(c))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Kr{constructor(t,n,c,h,_,v){this.inputType=t,this.type=n,this.input=c,this.cases=h,this.outputs=_,this.otherwise=v}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let c,h;n.expectedType&&n.expectedType.kind!=="value"&&(h=n.expectedType);const _={},v=[];for(let P=2;P<t.length-1;P+=2){let I=t[P];const z=t[P+1];Array.isArray(I)||(I=[I]);const j=n.concat(P);if(I.length===0)return j.error("Expected at least one branch label.");for(const N of I){if(typeof N!="number"&&typeof N!="string")return j.error("Branch labels must be numbers or strings.");if(typeof N=="number"&&Math.abs(N)>Number.MAX_SAFE_INTEGER)return j.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof N=="number"&&Math.floor(N)!==N)return j.error("Numeric branch labels must be integer values.");if(c){if(j.checkSubtype(c,pt(N)))return null}else c=pt(N);if(_[String(N)]!==void 0)return j.error("Branch labels must be unique.");_[String(N)]=v.length}const B=n.parse(z,P,h);if(!B)return null;h=h||B.type,v.push(B)}const w=n.parse(t[1],1,wt);if(!w)return null;const T=n.parse(t[t.length-1],t.length-1,h);return T?w.type.kind!=="value"&&n.concat(1).checkSubtype(c,w.type)?null:new Kr(c,h,w,_,v,T):null}evaluate(t){const n=this.input.evaluate(t);return(pt(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}}class No{constructor(t,n,c){this.type=t,this.branches=n,this.otherwise=c}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);const h=[];for(let v=1;v<t.length-1;v+=2){const w=n.parse(t[v],v,St);if(!w)return null;const T=n.parse(t[v+1],v+1,c);if(!T)return null;h.push([w,T]),c=c||T.type}const _=n.parse(t[t.length-1],t.length-1,c);if(!_)return null;if(!c)throw new Error("Can't infer output type");return new No(c,h,_)}evaluate(t){for(const[n,c]of this.branches)if(n.evaluate(t))return c.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,c]of this.branches)t(n),t(c);t(this.otherwise)}outputDefined(){return this.branches.every((([t,n])=>n.outputDefined()))&&this.otherwise.outputDefined()}}class Cs{constructor(t,n,c,h){this.type=t,this.input=n,this.beginIndex=c,this.endIndex=h}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const c=n.parse(t[1],1,wt),h=n.parse(t[2],2,We);if(!c||!h)return null;if(!cu(c.type,[Di(wt),Pt,wt]))return n.error(`Expected first argument to be of type array or string, but found ${or(c.type)} instead`);if(t.length===4){const _=n.parse(t[3],3,We);return _?new Cs(c.type,c,h,_):null}return new Cs(c.type,c,h)}evaluate(t){const n=this.input.evaluate(t),c=this.beginIndex.evaluate(t);let h;if(this.endIndex&&(h=this.endIndex.evaluate(t)),Ia(n,["string"]))return[...n].slice(c,h).join("");if(Ia(n,["array"]))return n.slice(c,h);throw new sr(`Expected first argument to be of type array or string, but found ${or(pt(n))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function ro(a,t){const n=a.length-1;let c,h,_=0,v=n,w=0;for(;_<=v;)if(w=Math.floor((_+v)/2),c=a[w],h=a[w+1],c<=t){if(w===n||t<h)return w;_=w+1}else{if(!(c>t))throw new sr("Input is not a number.");v=w-1}return 0}class Mr{constructor(t,n,c){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[h,_]of c)this.labels.push(h),this.outputs.push(_)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const c=n.parse(t[1],1,We);if(!c)return null;const h=[];let _=null;n.expectedType&&n.expectedType.kind!=="value"&&(_=n.expectedType);for(let v=1;v<t.length;v+=2){const w=v===1?-1/0:t[v],T=t[v+1],P=v,I=v+1;if(typeof w!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(h.length&&h[h.length-1][0]>=w)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const z=n.parse(T,I,_);if(!z)return null;_=_||z.type,h.push([w,z])}return new Mr(_,c,h)}evaluate(t){const n=this.labels,c=this.outputs;if(n.length===1)return c[0].evaluate(t);const h=this.input.evaluate(t);if(h<=n[0])return c[0].evaluate(t);const _=n.length;return h>=n[_-1]?c[_-1].evaluate(t):c[ro(n,h)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function yp(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var Ps,yu,Gf=(function(){if(yu)return Ps;function a(t,n,c,h){this.cx=3*t,this.bx=3*(c-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(h-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=c,this.p2y=h}return yu=1,Ps=a,a.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,n){if(n===void 0&&(n=1e-6),t<0)return 0;if(t>1)return 1;for(var c=t,h=0;h<8;h++){var _=this.sampleCurveX(c)-t;if(Math.abs(_)<n)return c;var v=this.sampleCurveDerivativeX(c);if(Math.abs(v)<1e-6)break;c-=_/v}var w=0,T=1;for(c=t,h=0;h<20&&(_=this.sampleCurveX(c),!(Math.abs(_-t)<n));h++)t>_?w=c:T=c,c=.5*(T-w)+w;return c},solve:function(t,n){return this.sampleCurveY(this.solveCurveX(t,n))}},Ps})(),Uo=yp(Gf);class ai{constructor(t,n,c,h,_){this.type=t,this.operator=n,this.interpolation=c,this.input=h,this.labels=[],this.outputs=[];for(const[v,w]of _)this.labels.push(v),this.outputs.push(w)}static interpolationFactor(t,n,c,h){let _=0;if(t.name==="exponential")_=Ms(n,t.base,c,h);else if(t.name==="linear")_=Ms(n,1,c,h);else if(t.name==="cubic-bezier"){const v=t.controlPoints;_=new Uo(v[0],v[1],v[2],v[3]).solve(Ms(n,1,c,h))}return _}static parse(t,n){let[c,h,_,...v]=t;if(!Array.isArray(h)||h.length===0)return n.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const P=h[1];if(typeof P!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:P}}else{if(h[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const P=h.slice(1);if(P.length!==4||P.some((I=>typeof I!="number"||I<0||I>1)))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:P}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(_=n.parse(_,2,We),!_)return null;const w=[];let T=null;c!=="interpolate-hcl"&&c!=="interpolate-lab"||n.expectedType==On?n.expectedType&&n.expectedType.kind!=="value"&&(T=n.expectedType):T=ni;for(let P=0;P<v.length;P+=2){const I=v[P],z=v[P+1],j=P+3,B=P+4;if(typeof I!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',j);if(w.length&&w[w.length-1][0]>=I)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',j);const N=n.parse(z,B,T);if(!N)return null;T=T||N.type,w.push([I,N])}return Ea(T,We)||Ea(T,Ya)||Ea(T,ni)||Ea(T,El)||Ea(T,Do)||Ea(T,On)||Ea(T,zl)||Ea(T,Di(We))?new ai(T,c,h,_,w):n.error(`Type ${or(T)} is not interpolatable.`)}evaluate(t){const n=this.labels,c=this.outputs;if(n.length===1)return c[0].evaluate(t);const h=this.input.evaluate(t);if(h<=n[0])return c[0].evaluate(t);const _=n.length;if(h>=n[_-1])return c[_-1].evaluate(t);const v=ro(n,h),w=ai.interpolationFactor(this.interpolation,h,n[v],n[v+1]),T=c[v].evaluate(t),P=c[v+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return ra(T,P,w);case"color":return At.interpolate(T,P,w);case"padding":return Xr.interpolate(T,P,w);case"colorArray":return jr.interpolate(T,P,w);case"numberArray":return xi.interpolate(T,P,w);case"variableAnchorOffsetCollection":return wi.interpolate(T,P,w);case"array":return Qa(T,P,w);case"projectionDefinition":return mi.interpolate(T,P,w)}case"interpolate-hcl":switch(this.type.kind){case"color":return At.interpolate(T,P,w,"hcl");case"colorArray":return jr.interpolate(T,P,w,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return At.interpolate(T,P,w,"lab");case"colorArray":return jr.interpolate(T,P,w,"lab")}}}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function Ms(a,t,n,c){const h=c-n,_=a-n;return h===0?0:t===1?_/h:(Math.pow(t,_)-1)/(Math.pow(t,h)-1)}const Nn={color:At.interpolate,number:ra,padding:Xr.interpolate,numberArray:xi.interpolate,colorArray:jr.interpolate,variableAnchorOffsetCollection:wi.interpolate,array:Qa};class As{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let c=null;const h=n.expectedType;h&&h.kind!=="value"&&(c=h);const _=[];for(const w of t.slice(1)){const T=n.parse(w,1+_.length,c,void 0,{typeAnnotation:"omit"});if(!T)return null;c=c||T.type,_.push(T)}if(!c)throw new Error("No output type");const v=h&&_.some((w=>Ts(h,w.type)));return new As(v?wt:c,_)}evaluate(t){let n,c=null,h=0;for(const _ of this.args)if(h++,c=_.evaluate(t),c&&c instanceof Vi&&!c.available&&(n||(n=c.name),c=null,h===this.args.length&&(c=n)),c!==null)break;return c}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}function Is(a,t){return a==="=="||a==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Es(a,t,n,c){return c.compare(t,n)===0}function gi(a,t,n){const c=a!=="=="&&a!=="!=";return class N1{constructor(_,v,w){this.type=St,this.lhs=_,this.rhs=v,this.collator=w,this.hasUntypedArgument=_.type.kind==="value"||v.type.kind==="value"}static parse(_,v){if(_.length!==3&&_.length!==4)return v.error("Expected two or three arguments.");const w=_[0];let T=v.parse(_[1],1,wt);if(!T)return null;if(!Is(w,T.type))return v.concat(1).error(`"${w}" comparisons are not supported for type '${or(T.type)}'.`);let P=v.parse(_[2],2,wt);if(!P)return null;if(!Is(w,P.type))return v.concat(2).error(`"${w}" comparisons are not supported for type '${or(P.type)}'.`);if(T.type.kind!==P.type.kind&&T.type.kind!=="value"&&P.type.kind!=="value")return v.error(`Cannot compare types '${or(T.type)}' and '${or(P.type)}'.`);c&&(T.type.kind==="value"&&P.type.kind!=="value"?T=new qi(P.type,[T]):T.type.kind!=="value"&&P.type.kind==="value"&&(P=new qi(T.type,[P])));let I=null;if(_.length===4){if(T.type.kind!=="string"&&P.type.kind!=="string"&&T.type.kind!=="value"&&P.type.kind!=="value")return v.error("Cannot use collator to compare non-string types.");if(I=v.parse(_[3],3,Il),!I)return null}return new N1(T,P,I)}evaluate(_){const v=this.lhs.evaluate(_),w=this.rhs.evaluate(_);if(c&&this.hasUntypedArgument){const T=pt(v),P=pt(w);if(T.kind!==P.kind||T.kind!=="string"&&T.kind!=="number")throw new sr(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${T.kind}, ${P.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const T=pt(v),P=pt(w);if(T.kind!=="string"||P.kind!=="string")return t(_,v,w)}return this.collator?n(_,v,w,this.collator.evaluate(_)):t(_,v,w)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}}}const _p=gi("==",(function(a,t,n){return t===n}),Es),Bl=gi("!=",(function(a,t,n){return t!==n}),(function(a,t,n,c){return!Es(0,t,n,c)})),Zf=gi("<",(function(a,t,n){return t<n}),(function(a,t,n,c){return c.compare(t,n)<0})),_u=gi(">",(function(a,t,n){return t>n}),(function(a,t,n,c){return c.compare(t,n)>0})),Wf=gi("<=",(function(a,t,n){return t<=n}),(function(a,t,n,c){return c.compare(t,n)<=0})),Hf=gi(">=",(function(a,t,n){return t>=n}),(function(a,t,n,c){return c.compare(t,n)>=0}));class $l{constructor(t,n,c){this.type=Il,this.locale=c,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(t.length!==2)return n.error("Expected one argument.");const c=t[1];if(typeof c!="object"||Array.isArray(c))return n.error("Collator options argument must be an object.");const h=n.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,St);if(!h)return null;const _=n.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,St);if(!_)return null;let v=null;return c.locale&&(v=n.parse(c.locale,1,Pt),!v)?null:new $l(h,_,v)}evaluate(t){return new eo(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class vu{constructor(t,n,c,h,_){this.type=Pt,this.number=t,this.locale=n,this.currency=c,this.minFractionDigits=h,this.maxFractionDigits=_}static parse(t,n){if(t.length!==3)return n.error("Expected two arguments.");const c=n.parse(t[1],1,We);if(!c)return null;const h=t[2];if(typeof h!="object"||Array.isArray(h))return n.error("NumberFormat options argument must be an object.");let _=null;if(h.locale&&(_=n.parse(h.locale,1,Pt),!_))return null;let v=null;if(h.currency&&(v=n.parse(h.currency,1,Pt),!v))return null;let w=null;if(h["min-fraction-digits"]&&(w=n.parse(h["min-fraction-digits"],1,We),!w))return null;let T=null;return h["max-fraction-digits"]&&(T=n.parse(h["max-fraction-digits"],1,We),!T)?null:new vu(c,_,v,w,T)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class io{constructor(t){this.type=Aa,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const c=t[1];if(!Array.isArray(c)&&typeof c=="object")return n.error("First argument must be an image or text section.");const h=[];let _=!1;for(let v=1;v<=t.length-1;++v){const w=t[v];if(_&&typeof w=="object"&&!Array.isArray(w)){_=!1;let T=null;if(w["font-scale"]&&(T=n.parse(w["font-scale"],1,We),!T))return null;let P=null;if(w["text-font"]&&(P=n.parse(w["text-font"],1,Di(Pt)),!P))return null;let I=null;if(w["text-color"]&&(I=n.parse(w["text-color"],1,ni),!I))return null;let z=null;if(w["vertical-align"]){if(typeof w["vertical-align"]=="string"&&!Rl.includes(w["vertical-align"]))return n.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${w["vertical-align"]}' instead.`);if(z=n.parse(w["vertical-align"],1,Pt),!z)return null}const j=h[h.length-1];j.scale=T,j.font=P,j.textColor=I,j.verticalAlign=z}else{const T=n.parse(t[v],1,wt);if(!T)return null;const P=T.type.kind;if(P!=="string"&&P!=="value"&&P!=="null"&&P!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,h.push({content:T,scale:null,font:null,textColor:null,verticalAlign:null})}}return new io(h)}evaluate(t){return new bi(this.sections.map((n=>{const c=n.content.evaluate(t);return pt(c)===Pr?new Ll("",c,null,null,null,n.verticalAlign?n.verticalAlign.evaluate(t):null):new Ll(yt(c),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null,n.verticalAlign?n.verticalAlign.evaluate(t):null)})))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor),n.verticalAlign&&t(n.verticalAlign)}outputDefined(){return!1}}class bu{constructor(t){this.type=Pr,this.input=t}static parse(t,n){if(t.length!==2)return n.error("Expected two arguments.");const c=n.parse(t[1],1,Pt);return c?new bu(c):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),c=Vi.fromString(n);return c&&t.availableImages&&(c.available=t.availableImages.indexOf(n)>-1),c}eachChild(t){t(this.input)}outputDefined(){return!1}}class Nl{constructor(t){this.type=We,this.input=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const c=n.parse(t[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${or(c.type)} instead.`):new Nl(c):null}evaluate(t){const n=this.input.evaluate(t);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new sr(`Expected value to be of type string or array, but found ${or(pt(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const pn=8192;function Xf(a,t){const n=(180+a[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,h=Math.pow(2,t.z);return[Math.round(n*h*pn),Math.round(c*h*pn)]}function Ul(a,t){const n=Math.pow(2,t.z);return[(h=(a[0]/pn+t.x)/n,360*h-180),(c=(a[1]/pn+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90)];var c,h}function zs(a,t){a[0]=Math.min(a[0],t[0]),a[1]=Math.min(a[1],t[1]),a[2]=Math.max(a[2],t[0]),a[3]=Math.max(a[3],t[1])}function Rs(a,t){return!(a[0]<=t[0]||a[2]>=t[2]||a[1]<=t[1]||a[3]>=t[3])}function Kf(a,t,n){const c=a[0]-t[0],h=a[1]-t[1],_=a[0]-n[0],v=a[1]-n[1];return c*v-_*h==0&&c*_<=0&&h*v<=0}function Vl(a,t,n,c){return(h=[c[0]-n[0],c[1]-n[1]])[0]*(_=[t[0]-a[0],t[1]-a[1]])[1]-h[1]*_[0]!=0&&!(!bp(a,t,n,c)||!bp(n,c,a,t));var h,_}function Yf(a,t,n){for(const c of n)for(let h=0;h<c.length-1;++h)if(Vl(a,t,c[h],c[h+1]))return!0;return!1}function no(a,t,n=!1){let c=!1;for(const w of t)for(let T=0;T<w.length-1;T++){if(Kf(a,w[T],w[T+1]))return n;(_=w[T])[1]>(h=a)[1]!=(v=w[T+1])[1]>h[1]&&h[0]<(v[0]-_[0])*(h[1]-_[1])/(v[1]-_[1])+_[0]&&(c=!c)}var h,_,v;return c}function vp(a,t){for(const n of t)if(no(a,n))return!0;return!1}function xu(a,t){for(const n of a)if(!no(n,t))return!1;for(let n=0;n<a.length-1;++n)if(Yf(a[n],a[n+1],t))return!1;return!0}function Jf(a,t){for(const n of t)if(xu(a,n))return!0;return!1}function bp(a,t,n,c){const h=c[0]-n[0],_=c[1]-n[1],v=(a[0]-n[0])*_-h*(a[1]-n[1]),w=(t[0]-n[0])*_-h*(t[1]-n[1]);return v>0&&w<0||v<0&&w>0}function wu(a,t,n){const c=[];for(let h=0;h<a.length;h++){const _=[];for(let v=0;v<a[h].length;v++){const w=Xf(a[h][v],n);zs(t,w),_.push(w)}c.push(_)}return c}function xp(a,t,n){const c=[];for(let h=0;h<a.length;h++){const _=wu(a[h],t,n);c.push(_)}return c}function ql(a,t,n,c){if(a[0]<n[0]||a[0]>n[2]){const h=.5*c;let _=a[0]-n[0]>h?-c:n[0]-a[0]>h?c:0;_===0&&(_=a[0]-n[2]>h?-c:n[2]-a[0]>h?c:0),a[0]+=_}zs(t,a)}function wp(a,t,n,c){const h=Math.pow(2,c.z)*pn,_=[c.x*pn,c.y*pn],v=[];for(const w of a)for(const T of w){const P=[T.x+_[0],T.y+_[1]];ql(P,t,n,h),v.push(P)}return v}function Tp(a,t,n,c){const h=Math.pow(2,c.z)*pn,_=[c.x*pn,c.y*pn],v=[];for(const T of a){const P=[];for(const I of T){const z=[I.x+_[0],I.y+_[1]];zs(t,z),P.push(z)}v.push(P)}if(t[2]-t[0]<=h/2){(w=t)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const T of v)for(const P of T)ql(P,t,n,h)}var w;return v}class ao{constructor(t,n){this.type=St,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(to(t[1])){const c=t[1];if(c.type==="FeatureCollection"){const h=[];for(const _ of c.features){const{type:v,coordinates:w}=_.geometry;v==="Polygon"&&h.push(w),v==="MultiPolygon"&&h.push(...w)}if(h.length)return new ao(c,{type:"MultiPolygon",coordinates:h})}else if(c.type==="Feature"){const h=c.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new ao(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new ao(c,c)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(n,c){const h=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],v=n.canonicalID();if(c.type==="Polygon"){const w=wu(c.coordinates,_,v),T=wp(n.geometry(),h,_,v);if(!Rs(h,_))return!1;for(const P of T)if(!no(P,w))return!1}if(c.type==="MultiPolygon"){const w=xp(c.coordinates,_,v),T=wp(n.geometry(),h,_,v);if(!Rs(h,_))return!1;for(const P of T)if(!vp(P,w))return!1}return!0})(t,this.geometries);if(t.geometryType()==="LineString")return(function(n,c){const h=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],v=n.canonicalID();if(c.type==="Polygon"){const w=wu(c.coordinates,_,v),T=Tp(n.geometry(),h,_,v);if(!Rs(h,_))return!1;for(const P of T)if(!xu(P,w))return!1}if(c.type==="MultiPolygon"){const w=xp(c.coordinates,_,v),T=Tp(n.geometry(),h,_,v);if(!Rs(h,_))return!1;for(const P of T)if(!Jf(P,w))return!1}return!0})(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Tu=class{constructor(a=[],t=(n,c)=>n<c?-1:n>c?1:0){if(this.data=a,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(a){this.data.push(a),this._up(this.length++)}pop(){if(this.length===0)return;const a=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:t,compare:n}=this,c=t[a];for(;a>0;){const h=a-1>>1,_=t[h];if(n(c,_)>=0)break;t[a]=_,a=h}t[a]=c}_down(a){const{data:t,compare:n}=this,c=this.length>>1,h=t[a];for(;a<c;){let _=1+(a<<1);const v=_+1;if(v<this.length&&n(t[v],t[_])<0&&(_=v),n(t[_],h)>=0)break;t[a]=t[_],a=_}t[a]=h}};function Su(a,t,n=0,c=a.length-1,h=Qf){for(;c>n;){if(c-n>600){const T=c-n+1,P=t-n+1,I=Math.log(T),z=.5*Math.exp(2*I/3),j=.5*Math.sqrt(I*z*(T-z)/T)*(P-T/2<0?-1:1);Su(a,t,Math.max(n,Math.floor(t-P*z/T+j)),Math.min(c,Math.floor(t+(T-P)*z/T+j)),h)}const _=a[t];let v=n,w=c;for(Ls(a,n,t),h(a[c],_)>0&&Ls(a,n,c);v<w;){for(Ls(a,v,w),v++,w--;h(a[v],_)<0;)v++;for(;h(a[w],_)>0;)w--}h(a[n],_)===0?Ls(a,n,w):(w++,Ls(a,w,c)),w<=t&&(n=w+1),t<=w&&(c=w-1)}}function Ls(a,t,n){const c=a[t];a[t]=a[n],a[n]=c}function Qf(a,t){return a<t?-1:a>t?1:0}function Ds(a,t){if(a.length<=1)return[a];const n=[];let c,h;for(const _ of a){const v=em(_);v!==0&&(_.area=Math.abs(v),h===void 0&&(h=v<0),h===v<0?(c&&n.push(c),c=[_]):c.push(_))}if(c&&n.push(c),t>1)for(let _=0;_<n.length;_++)n[_].length<=t||(Su(n[_],t,1,n[_].length-1,Sp),n[_]=n[_].slice(0,t));return n}function Sp(a,t){return t.area-a.area}function em(a){let t=0;for(let n,c,h=0,_=a.length,v=_-1;h<_;v=h++)n=a[h],c=a[v],t+=(c.x-n.x)*(n.y+c.y);return t}const kp=1/298.257223563,Cp=kp*(2-kp),ku=Math.PI/180;class Cu{constructor(t){const n=6378.137*ku*1e3,c=Math.cos(t*ku),h=1/(1-Cp*(1-c*c)),_=Math.sqrt(h);this.kx=n*_*c,this.ky=n*_*h*(1-Cp)}distance(t,n){const c=this.wrap(t[0]-n[0])*this.kx,h=(t[1]-n[1])*this.ky;return Math.sqrt(c*c+h*h)}pointOnLine(t,n){let c,h,_,v,w=1/0;for(let T=0;T<t.length-1;T++){let P=t[T][0],I=t[T][1],z=this.wrap(t[T+1][0]-P)*this.kx,j=(t[T+1][1]-I)*this.ky,B=0;z===0&&j===0||(B=(this.wrap(n[0]-P)*this.kx*z+(n[1]-I)*this.ky*j)/(z*z+j*j),B>1?(P=t[T+1][0],I=t[T+1][1]):B>0&&(P+=z/this.kx*B,I+=j/this.ky*B)),z=this.wrap(n[0]-P)*this.kx,j=(n[1]-I)*this.ky;const N=z*z+j*j;N<w&&(w=N,c=P,h=I,_=T,v=B)}return{point:[c,h],index:_,t:Math.max(0,Math.min(1,v))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function Pp(a,t){return t[0]-a[0]}function Gl(a){return a[1]-a[0]+1}function na(a,t){return a[1]>=a[0]&&a[1]<t}function Xt(a,t){if(a[0]>a[1])return[null,null];const n=Gl(a);if(t){if(n===2)return[a,null];const h=Math.floor(n/2);return[[a[0],a[0]+h],[a[0]+h,a[1]]]}if(n===1)return[a,null];const c=Math.floor(n/2)-1;return[[a[0],a[0]+c],[a[0]+c+1,a[1]]]}function Pu(a,t){if(!na(t,a.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let c=t[0];c<=t[1];++c)zs(n,a[c]);return n}function Mu(a){const t=[1/0,1/0,-1/0,-1/0];for(const n of a)for(const c of n)zs(t,c);return t}function Mp(a){return a[0]!==-1/0&&a[1]!==-1/0&&a[2]!==1/0&&a[3]!==1/0}function Au(a,t,n){if(!Mp(a)||!Mp(t))return NaN;let c=0,h=0;return a[2]<t[0]&&(c=t[0]-a[2]),a[0]>t[2]&&(c=a[0]-t[2]),a[1]>t[3]&&(h=a[1]-t[3]),a[3]<t[1]&&(h=t[1]-a[3]),n.distance([0,0],[c,h])}function oo(a,t,n){const c=n.pointOnLine(t,a);return n.distance(a,c.point)}function Iu(a,t,n,c,h){const _=Math.min(oo(a,[n,c],h),oo(t,[n,c],h)),v=Math.min(oo(n,[a,t],h),oo(c,[a,t],h));return Math.min(_,v)}function tm(a,t,n,c,h){if(!na(t,a.length)||!na(c,n.length))return 1/0;let _=1/0;for(let v=t[0];v<t[1];++v){const w=a[v],T=a[v+1];for(let P=c[0];P<c[1];++P){const I=n[P],z=n[P+1];if(Vl(w,T,I,z))return 0;_=Math.min(_,Iu(w,T,I,z,h))}}return _}function rm(a,t,n,c,h){if(!na(t,a.length)||!na(c,n.length))return NaN;let _=1/0;for(let v=t[0];v<=t[1];++v)for(let w=c[0];w<=c[1];++w)if(_=Math.min(_,h.distance(a[v],n[w])),_===0)return _;return _}function im(a,t,n){if(no(a,t,!0))return 0;let c=1/0;for(const h of t){const _=h[0],v=h[h.length-1];if(_!==v&&(c=Math.min(c,oo(a,[v,_],n)),c===0))return c;const w=n.pointOnLine(h,a);if(c=Math.min(c,n.distance(a,w.point)),c===0)return c}return c}function nm(a,t,n,c){if(!na(t,a.length))return NaN;for(let _=t[0];_<=t[1];++_)if(no(a[_],n,!0))return 0;let h=1/0;for(let _=t[0];_<t[1];++_){const v=a[_],w=a[_+1];for(const T of n)for(let P=0,I=T.length,z=I-1;P<I;z=P++){const j=T[z],B=T[P];if(Vl(v,w,j,B))return 0;h=Math.min(h,Iu(v,w,j,B,c))}}return h}function Ap(a,t){for(const n of a)for(const c of n)if(no(c,t,!0))return!0;return!1}function am(a,t,n,c=1/0){const h=Mu(a),_=Mu(t);if(c!==1/0&&Au(h,_,n)>=c)return c;if(Rs(h,_)){if(Ap(a,t))return 0}else if(Ap(t,a))return 0;let v=1/0;for(const w of a)for(let T=0,P=w.length,I=P-1;T<P;I=T++){const z=w[I],j=w[T];for(const B of t)for(let N=0,q=B.length,H=q-1;N<q;H=N++){const J=B[H],ue=B[N];if(Vl(z,j,J,ue))return 0;v=Math.min(v,Iu(z,j,J,ue,n))}}return v}function Ip(a,t,n,c,h,_){if(!_)return;const v=Au(Pu(c,_),h,n);v<t&&a.push([v,_,[0,0]])}function Zl(a,t,n,c,h,_,v){if(!_||!v)return;const w=Au(Pu(c,_),Pu(h,v),n);w<t&&a.push([w,_,v])}function Wl(a,t,n,c,h=1/0){let _=Math.min(c.distance(a[0],n[0][0]),h);if(_===0)return _;const v=new Tu([[0,[0,a.length-1],[0,0]]],Pp),w=Mu(n);for(;v.length>0;){const T=v.pop();if(T[0]>=_)continue;const P=T[1],I=t?50:100;if(Gl(P)<=I){if(!na(P,a.length))return NaN;if(t){const z=nm(a,P,n,c);if(isNaN(z)||z===0)return z;_=Math.min(_,z)}else for(let z=P[0];z<=P[1];++z){const j=im(a[z],n,c);if(_=Math.min(_,j),_===0)return 0}}else{const z=Xt(P,t);Ip(v,_,c,a,w,z[0]),Ip(v,_,c,a,w,z[1])}}return _}function Hl(a,t,n,c,h,_=1/0){let v=Math.min(_,h.distance(a[0],n[0]));if(v===0)return v;const w=new Tu([[0,[0,a.length-1],[0,n.length-1]]],Pp);for(;w.length>0;){const T=w.pop();if(T[0]>=v)continue;const P=T[1],I=T[2],z=t?50:100,j=c?50:100;if(Gl(P)<=z&&Gl(I)<=j){if(!na(P,a.length)&&na(I,n.length))return NaN;let B;if(t&&c)B=tm(a,P,n,I,h),v=Math.min(v,B);else if(t&&!c){const N=a.slice(P[0],P[1]+1);for(let q=I[0];q<=I[1];++q)if(B=oo(n[q],N,h),v=Math.min(v,B),v===0)return v}else if(!t&&c){const N=n.slice(I[0],I[1]+1);for(let q=P[0];q<=P[1];++q)if(B=oo(a[q],N,h),v=Math.min(v,B),v===0)return v}else B=rm(a,P,n,I,h),v=Math.min(v,B)}else{const B=Xt(P,t),N=Xt(I,c);Zl(w,v,h,a,n,B[0],N[0]),Zl(w,v,h,a,n,B[0],N[1]),Zl(w,v,h,a,n,B[1],N[0]),Zl(w,v,h,a,n,B[1],N[1])}}return v}function Eu(a){return a.type==="MultiPolygon"?a.coordinates.map((t=>({type:"Polygon",coordinates:t}))):a.type==="MultiLineString"?a.coordinates.map((t=>({type:"LineString",coordinates:t}))):a.type==="MultiPoint"?a.coordinates.map((t=>({type:"Point",coordinates:t}))):[a]}class so{constructor(t,n){this.type=We,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(to(t[1])){const c=t[1];if(c.type==="FeatureCollection")return new so(c,c.features.map((h=>Eu(h.geometry))).flat());if(c.type==="Feature")return new so(c,Eu(c.geometry));if("type"in c&&"coordinates"in c)return new so(c,Eu(c))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(n,c){const h=n.geometry(),_=h.flat().map((T=>Ul([T.x,T.y],n.canonical)));if(h.length===0)return NaN;const v=new Cu(_[0][1]);let w=1/0;for(const T of c){switch(T.type){case"Point":w=Math.min(w,Hl(_,!1,[T.coordinates],!1,v,w));break;case"LineString":w=Math.min(w,Hl(_,!1,T.coordinates,!0,v,w));break;case"Polygon":w=Math.min(w,Wl(_,!1,T.coordinates,v,w))}if(w===0)return w}return w})(t,this.geometries);if(t.geometryType()==="LineString")return(function(n,c){const h=n.geometry(),_=h.flat().map((T=>Ul([T.x,T.y],n.canonical)));if(h.length===0)return NaN;const v=new Cu(_[0][1]);let w=1/0;for(const T of c){switch(T.type){case"Point":w=Math.min(w,Hl(_,!0,[T.coordinates],!1,v,w));break;case"LineString":w=Math.min(w,Hl(_,!0,T.coordinates,!0,v,w));break;case"Polygon":w=Math.min(w,Wl(_,!0,T.coordinates,v,w))}if(w===0)return w}return w})(t,this.geometries);if(t.geometryType()==="Polygon")return(function(n,c){const h=n.geometry();if(h.length===0||h[0].length===0)return NaN;const _=Ds(h,0).map((T=>T.map((P=>P.map((I=>Ul([I.x,I.y],n.canonical))))))),v=new Cu(_[0][0][0][1]);let w=1/0;for(const T of c)for(const P of _){switch(T.type){case"Point":w=Math.min(w,Wl([T.coordinates],!1,P,v,w));break;case"LineString":w=Math.min(w,Wl(T.coordinates,!0,P,v,w));break;case"Polygon":w=Math.min(w,am(P,T.coordinates,v,w))}if(w===0)return w}return w})(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class js{constructor(t){this.type=wt,this.key=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const c=t[1];return c==null?n.error("Global state property must be defined."):typeof c!="string"?n.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new js(c)}evaluate(t){var n;const c=(n=t.globals)===null||n===void 0?void 0:n.globalState;return c&&Object.keys(c).length!==0?Bo(c,this.key):null}eachChild(){}outputDefined(){return!1}}const Vo={"==":_p,"!=":Bl,">":_u,"<":Zf,">=":Hf,"<=":Wf,array:qi,at:Fl,boolean:qi,case:No,coalesce:As,collator:$l,format:io,image:bu,in:Ol,"index-of":hn,interpolate:ai,"interpolate-hcl":ai,"interpolate-lab":ai,length:Nl,let:ks,literal:ia,match:Kr,number:qi,"number-format":vu,object:qi,slice:Cs,step:Mr,string:qi,"to-boolean":$n,"to-color":$n,"to-number":$n,"to-string":$n,var:jl,within:ao,distance:so,"global-state":js};class en{constructor(t,n,c,h){this.name=t,this.type=n,this._evaluate=c,this.args=h}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,n){const c=t[0],h=en.definitions[c];if(!h)return n.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(h)?h[0]:h.type,v=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,w=v.filter((([P])=>!Array.isArray(P)||P.length===t.length-1));let T=null;for(const[P,I]of w){T=new $o(n.registry,Xl,n.path,null,n.scope);const z=[];let j=!1;for(let B=1;B<t.length;B++){const N=t[B],q=Array.isArray(P)?P[B-1]:P.type,H=T.parse(N,1+z.length,q);if(!H){j=!0;break}z.push(H)}if(!j)if(Array.isArray(P)&&P.length!==z.length)T.error(`Expected ${P.length} arguments, but found ${z.length} instead.`);else{for(let B=0;B<z.length;B++){const N=Array.isArray(P)?P[B]:P.type,q=z[B];T.concat(B+1).checkSubtype(N,q.type)}if(T.errors.length===0)return new en(c,_,I,z)}}if(w.length===1)n.errors.push(...T.errors);else{const P=(w.length?w:v).map((([z])=>{return j=z,Array.isArray(j)?`(${j.map(or).join(", ")})`:`(${or(j.type)}...)`;var j})).join(" | "),I=[];for(let z=1;z<t.length;z++){const j=n.parse(t[z],1+I.length);if(!j)return null;I.push(or(j.type))}n.error(`Expected arguments of type ${P}, but found (${I.join(", ")}) instead.`)}return null}static register(t,n){en.definitions=n;for(const c in n)t[c]=en}}function Ep(a,[t,n,c,h]){t=t.evaluate(a),n=n.evaluate(a),c=c.evaluate(a);const _=h?h.evaluate(a):1,v=fr(t,n,c,_);if(v)throw new sr(v);return new At(t/255,n/255,c/255,_,!1)}function zp(a,t){return a in t}function zu(a,t){const n=t[a];return n===void 0?null:n}function lo(a){return{type:a}}function Xl(a){if(a instanceof jl)return Xl(a.boundExpression);if(a instanceof en&&a.name==="error"||a instanceof $l||a instanceof ao||a instanceof so||a instanceof js)return!1;const t=a instanceof $n||a instanceof qi;let n=!0;return a.eachChild((c=>{n=t?n&&Xl(c):n&&c instanceof ia})),!!n&&Kl(a)&&Yl(a,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Kl(a){if(a instanceof en&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof ao||a instanceof so)return!1;let t=!0;return a.eachChild((n=>{t&&!Kl(n)&&(t=!1)})),t}function Fs(a){if(a instanceof en&&a.name==="feature-state")return!1;let t=!0;return a.eachChild((n=>{t&&!Fs(n)&&(t=!1)})),t}function Yl(a,t){if(a instanceof en&&t.indexOf(a.name)>=0)return!1;let n=!0;return a.eachChild((c=>{n&&!Yl(c,t)&&(n=!1)})),n}function Rp(a){return{result:"success",value:a}}function qo(a){return{result:"error",value:a}}function Ra(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function Lp(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Ru(a){return!!a.expression&&a.expression.interpolated}function Rt(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function Os(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)&&pt(a)===Ma}function om(a){return a}function Dp(a,t){const n=a.stops&&typeof a.stops[0][0]=="object",c=n||!(n||a.property!==void 0),h=a.type||(Ru(t)?"exponential":"interval"),_=(function(I){switch(I.type){case"color":return At.parse;case"padding":return Xr.parse;case"numberArray":return xi.parse;case"colorArray":return jr.parse;default:return null}})(t);if(_&&((a=fi({},a)).stops&&(a.stops=a.stops.map((I=>[I[0],_(I[1])]))),a.default=_(a.default?a.default:t.default)),a.colorSpace&&(v=a.colorSpace)!=="rgb"&&v!=="hcl"&&v!=="lab")throw new Error(`Unknown color space: "${a.colorSpace}"`);var v;const w=(function(I){switch(I){case"exponential":return Fp;case"interval":return sm;case"categorical":return jp;case"identity":return lm;default:throw new Error(`Unknown function type "${I}"`)}})(h);let T,P;if(h==="categorical"){T=Object.create(null);for(const I of a.stops)T[I[0]]=I[1];P=typeof a.stops[0][0]}if(n){const I={},z=[];for(let N=0;N<a.stops.length;N++){const q=a.stops[N],H=q[0].zoom;I[H]===void 0&&(I[H]={zoom:H,type:a.type,property:a.property,default:a.default,stops:[]},z.push(H)),I[H].stops.push([q[0].value,q[1]])}const j=[];for(const N of z)j.push([I[N].zoom,Dp(I[N],t)]);const B={name:"linear"};return{kind:"composite",interpolationType:B,interpolationFactor:ai.interpolationFactor.bind(void 0,B),zoomStops:j.map((N=>N[0])),evaluate:({zoom:N},q)=>Fp({stops:j,base:a.base},t,N).evaluate(N,q)}}if(c){const I=h==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:ai.interpolationFactor.bind(void 0,I),zoomStops:a.stops.map((z=>z[0])),evaluate:({zoom:z})=>w(a,t,z,T,P)}}return{kind:"source",evaluate(I,z){const j=z&&z.properties?z.properties[a.property]:void 0;return j===void 0?La(a.default,t.default):w(a,t,j,T,P)}}}function La(a,t,n){return a!==void 0?a:t!==void 0?t:n!==void 0?n:void 0}function jp(a,t,n,c,h){return La(typeof n===h?c[n]:void 0,a.default,t.default)}function sm(a,t,n){if(Rt(n)!=="number")return La(a.default,t.default);const c=a.stops.length;if(c===1||n<=a.stops[0][0])return a.stops[0][1];if(n>=a.stops[c-1][0])return a.stops[c-1][1];const h=ro(a.stops.map((_=>_[0])),n);return a.stops[h][1]}function Fp(a,t,n){const c=a.base!==void 0?a.base:1;if(Rt(n)!=="number")return La(a.default,t.default);const h=a.stops.length;if(h===1||n<=a.stops[0][0])return a.stops[0][1];if(n>=a.stops[h-1][0])return a.stops[h-1][1];const _=ro(a.stops.map((I=>I[0])),n),v=(function(I,z,j,B){const N=B-j,q=I-j;return N===0?0:z===1?q/N:(Math.pow(z,q)-1)/(Math.pow(z,N)-1)})(n,c,a.stops[_][0],a.stops[_+1][0]),w=a.stops[_][1],T=a.stops[_+1][1],P=Nn[t.type]||om;return typeof w.evaluate=="function"?{evaluate(...I){const z=w.evaluate.apply(void 0,I),j=T.evaluate.apply(void 0,I);if(z!==void 0&&j!==void 0)return P(z,j,v,a.colorSpace)}}:P(w,T,v,a.colorSpace)}function lm(a,t,n){switch(t.type){case"color":n=At.parse(n);break;case"formatted":n=bi.fromString(n.toString());break;case"resolvedImage":n=Vi.fromString(n.toString());break;case"padding":n=Xr.parse(n);break;case"colorArray":n=jr.parse(n);break;case"numberArray":n=xi.parse(n);break;default:Rt(n)===t.type||t.type==="enum"&&t.values[n]||(n=void 0)}return La(n,a.default,t.default)}en.register(Vo,{error:[{kind:"error"},[Pt],(a,[t])=>{throw new sr(t.evaluate(a))}],typeof:[Pt,[wt],(a,[t])=>or(pt(t.evaluate(a)))],"to-rgba":[Di(We,4),[ni],(a,[t])=>{const[n,c,h,_]=t.evaluate(a).rgb;return[255*n,255*c,255*h,_]}],rgb:[ni,[We,We,We],Ep],rgba:[ni,[We,We,We,We],Ep],has:{type:St,overloads:[[[Pt],(a,[t])=>zp(t.evaluate(a),a.properties())],[[Pt,Ma],(a,[t,n])=>zp(t.evaluate(a),n.evaluate(a))]]},get:{type:wt,overloads:[[[Pt],(a,[t])=>zu(t.evaluate(a),a.properties())],[[Pt,Ma],(a,[t,n])=>zu(t.evaluate(a),n.evaluate(a))]]},"feature-state":[wt,[Pt],(a,[t])=>zu(t.evaluate(a),a.featureState||{})],properties:[Ma,[],a=>a.properties()],"geometry-type":[Pt,[],a=>a.geometryType()],id:[wt,[],a=>a.id()],zoom:[We,[],a=>a.globals.zoom],"heatmap-density":[We,[],a=>a.globals.heatmapDensity||0],elevation:[We,[],a=>a.globals.elevation||0],"line-progress":[We,[],a=>a.globals.lineProgress||0],accumulated:[wt,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[We,lo(We),(a,t)=>{let n=0;for(const c of t)n+=c.evaluate(a);return n}],"*":[We,lo(We),(a,t)=>{let n=1;for(const c of t)n*=c.evaluate(a);return n}],"-":{type:We,overloads:[[[We,We],(a,[t,n])=>t.evaluate(a)-n.evaluate(a)],[[We],(a,[t])=>-t.evaluate(a)]]},"/":[We,[We,We],(a,[t,n])=>t.evaluate(a)/n.evaluate(a)],"%":[We,[We,We],(a,[t,n])=>t.evaluate(a)%n.evaluate(a)],ln2:[We,[],()=>Math.LN2],pi:[We,[],()=>Math.PI],e:[We,[],()=>Math.E],"^":[We,[We,We],(a,[t,n])=>Math.pow(t.evaluate(a),n.evaluate(a))],sqrt:[We,[We],(a,[t])=>Math.sqrt(t.evaluate(a))],log10:[We,[We],(a,[t])=>Math.log(t.evaluate(a))/Math.LN10],ln:[We,[We],(a,[t])=>Math.log(t.evaluate(a))],log2:[We,[We],(a,[t])=>Math.log(t.evaluate(a))/Math.LN2],sin:[We,[We],(a,[t])=>Math.sin(t.evaluate(a))],cos:[We,[We],(a,[t])=>Math.cos(t.evaluate(a))],tan:[We,[We],(a,[t])=>Math.tan(t.evaluate(a))],asin:[We,[We],(a,[t])=>Math.asin(t.evaluate(a))],acos:[We,[We],(a,[t])=>Math.acos(t.evaluate(a))],atan:[We,[We],(a,[t])=>Math.atan(t.evaluate(a))],min:[We,lo(We),(a,t)=>Math.min(...t.map((n=>n.evaluate(a))))],max:[We,lo(We),(a,t)=>Math.max(...t.map((n=>n.evaluate(a))))],abs:[We,[We],(a,[t])=>Math.abs(t.evaluate(a))],round:[We,[We],(a,[t])=>{const n=t.evaluate(a);return n<0?-Math.round(-n):Math.round(n)}],floor:[We,[We],(a,[t])=>Math.floor(t.evaluate(a))],ceil:[We,[We],(a,[t])=>Math.ceil(t.evaluate(a))],"filter-==":[St,[Pt,wt],(a,[t,n])=>a.properties()[t.value]===n.value],"filter-id-==":[St,[wt],(a,[t])=>a.id()===t.value],"filter-type-==":[St,[Pt],(a,[t])=>a.geometryType()===t.value],"filter-<":[St,[Pt,wt],(a,[t,n])=>{const c=a.properties()[t.value],h=n.value;return typeof c==typeof h&&c<h}],"filter-id-<":[St,[wt],(a,[t])=>{const n=a.id(),c=t.value;return typeof n==typeof c&&n<c}],"filter->":[St,[Pt,wt],(a,[t,n])=>{const c=a.properties()[t.value],h=n.value;return typeof c==typeof h&&c>h}],"filter-id->":[St,[wt],(a,[t])=>{const n=a.id(),c=t.value;return typeof n==typeof c&&n>c}],"filter-<=":[St,[Pt,wt],(a,[t,n])=>{const c=a.properties()[t.value],h=n.value;return typeof c==typeof h&&c<=h}],"filter-id-<=":[St,[wt],(a,[t])=>{const n=a.id(),c=t.value;return typeof n==typeof c&&n<=c}],"filter->=":[St,[Pt,wt],(a,[t,n])=>{const c=a.properties()[t.value],h=n.value;return typeof c==typeof h&&c>=h}],"filter-id->=":[St,[wt],(a,[t])=>{const n=a.id(),c=t.value;return typeof n==typeof c&&n>=c}],"filter-has":[St,[wt],(a,[t])=>t.value in a.properties()],"filter-has-id":[St,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[St,[Di(Pt)],(a,[t])=>t.value.indexOf(a.geometryType())>=0],"filter-id-in":[St,[Di(wt)],(a,[t])=>t.value.indexOf(a.id())>=0],"filter-in-small":[St,[Pt,Di(wt)],(a,[t,n])=>n.value.indexOf(a.properties()[t.value])>=0],"filter-in-large":[St,[Pt,Di(wt)],(a,[t,n])=>(function(c,h,_,v){for(;_<=v;){const w=_+v>>1;if(h[w]===c)return!0;h[w]>c?v=w-1:_=w+1}return!1})(a.properties()[t.value],n.value,0,n.value.length-1)],all:{type:St,overloads:[[[St,St],(a,[t,n])=>t.evaluate(a)&&n.evaluate(a)],[lo(St),(a,t)=>{for(const n of t)if(!n.evaluate(a))return!1;return!0}]]},any:{type:St,overloads:[[[St,St],(a,[t,n])=>t.evaluate(a)||n.evaluate(a)],[lo(St),(a,t)=>{for(const n of t)if(n.evaluate(a))return!0;return!1}]]},"!":[St,[St],(a,[t])=>!t.evaluate(a)],"is-supported-script":[St,[Pt],(a,[t])=>{const n=a.globals&&a.globals.isSupportedScript;return!n||n(t.evaluate(a))}],upcase:[Pt,[Pt],(a,[t])=>t.evaluate(a).toUpperCase()],downcase:[Pt,[Pt],(a,[t])=>t.evaluate(a).toLowerCase()],concat:[Pt,lo(wt),(a,t)=>t.map((n=>yt(n.evaluate(a)))).join("")],"resolved-locale":[Pt,[Il],(a,[t])=>t.evaluate(a).resolvedLocale()]});class Lu{constructor(t,n){this.expression=t,this._warningHistory={},this._evaluator=new gu,this._defaultValue=n?(function(c){if(c.type==="color"&&Os(c.default))return new At(0,0,0,0);switch(c.type){case"color":return At.parse(c.default)||null;case"padding":return Xr.parse(c.default)||null;case"numberArray":return xi.parse(c.default)||null;case"colorArray":return jr.parse(c.default)||null;case"variableAnchorOffsetCollection":return wi.parse(c.default)||null;case"projectionDefinition":return mi.parse(c.default)||null;default:return c.default===void 0?null:c.default}})(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(t,n,c,h,_,v){return this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=c,this._evaluator.canonical=h,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=v,this.expression.evaluate(this._evaluator)}evaluate(t,n,c,h,_,v){this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=c||null,this._evaluator.canonical=h,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=v||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new sr(`Expected value to be one of ${Object.keys(this._enumValues).map((T=>JSON.stringify(T))).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function Jl(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in Vo}function Bs(a,t){const n=new $o(Vo,Xl,[],t?(function(h){const _={color:ni,string:Pt,number:We,enum:Pt,boolean:St,formatted:Aa,padding:El,numberArray:Do,colorArray:On,projectionDefinition:Ya,resolvedImage:Pr,variableAnchorOffsetCollection:zl};return h.type==="array"?Di(_[h.value]||wt,h.length):_[h.type]})(t):void 0),c=n.parse(a,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?Rp(new Lu(c,t)):qo(n.errors)}class $s{constructor(t,n){this.kind=t,this._styleExpression=n,this.isStateDependent=t!=="constant"&&!Fs(n.expression),this.globalStateRefs=Vs(n.expression)}evaluateWithoutErrorHandling(t,n,c,h,_,v){return this._styleExpression.evaluateWithoutErrorHandling(t,n,c,h,_,v)}evaluate(t,n,c,h,_,v){return this._styleExpression.evaluate(t,n,c,h,_,v)}}class Du{constructor(t,n,c,h){this.kind=t,this.zoomStops=c,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!Fs(n.expression),this.globalStateRefs=Vs(n.expression),this.interpolationType=h}evaluateWithoutErrorHandling(t,n,c,h,_,v){return this._styleExpression.evaluateWithoutErrorHandling(t,n,c,h,_,v)}evaluate(t,n,c,h,_,v){return this._styleExpression.evaluate(t,n,c,h,_,v)}interpolationFactor(t,n,c){return this.interpolationType?ai.interpolationFactor(this.interpolationType,t,n,c):0}}function Op(a,t){const n=Bs(a,t);if(n.result==="error")return n;const c=n.value.expression,h=Kl(c);if(!h&&!Ra(t))return qo([new wr("","data expressions not supported")]);const _=Yl(c,["zoom"]);if(!_&&!Lp(t))return qo([new wr("","zoom expressions not supported")]);const v=Us(c);return v||_?v instanceof wr?qo([v]):v instanceof ai&&!Ru(t)?qo([new wr("",'"interpolate" expressions cannot be used with this property')]):Rp(v?new Du(h?"camera":"composite",n.value,v.labels,v instanceof ai?v.interpolation:void 0):new $s(h?"constant":"source",n.value)):qo([new wr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ns{constructor(t,n){this._parameters=t,this._specification=n,fi(this,Dp(this._parameters,this._specification))}static deserialize(t){return new Ns(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Us(a){let t=null;if(a instanceof ks)t=Us(a.result);else if(a instanceof As){for(const n of a.args)if(t=Us(n),t)break}else(a instanceof Mr||a instanceof ai)&&a.input instanceof en&&a.input.name==="zoom"&&(t=a);return t instanceof wr||a.eachChild((n=>{const c=Us(n);c instanceof wr?t=c:!t&&c?t=new wr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&c&&t!==c&&(t=new wr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function Vs(a,t=new Set){return a instanceof js&&t.add(a.key),a.eachChild((n=>{Vs(n,t)})),t}function Ql(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const t of a.slice(1))if(!Ql(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const ju={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function co(a){if(a==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Ql(a)||(a=uo(a));const t=Bs(a,ju);if(t.result==="error")throw new Error(t.value.map((n=>`${n.key}: ${n.message}`)).join(", "));return{filter:(n,c,h)=>t.value.evaluate(n,c,{},h),needGeometry:ec(a),getGlobalStateRefs:()=>Vs(t.value.expression)}}function Fu(a,t){return a<t?-1:a>t?1:0}function ec(a){if(!Array.isArray(a))return!1;if(a[0]==="within"||a[0]==="distance")return!0;for(let t=1;t<a.length;t++)if(ec(a[t]))return!0;return!1}function uo(a){if(!a)return!0;const t=a[0];return a.length<=1?t!=="any":t==="=="?Ou(a[1],a[2],"=="):t==="!="?tc(Ou(a[1],a[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Ou(a[1],a[2],t):t==="any"?(n=a.slice(1),["any"].concat(n.map(uo))):t==="all"?["all"].concat(a.slice(1).map(uo)):t==="none"?["all"].concat(a.slice(1).map(uo).map(tc)):t==="in"?Bp(a[1],a.slice(2)):t==="!in"?tc(Bp(a[1],a.slice(2))):t==="has"?$p(a[1]):t!=="!has"||tc($p(a[1]));var n}function Ou(a,t,n){switch(a){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,a,t]}}function Bp(a,t){if(t.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((n=>typeof n!=typeof t[0]))?["filter-in-large",a,["literal",t.sort(Fu)]]:["filter-in-small",a,["literal",t]]}}function $p(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function tc(a){return["!",a]}function Bu(a){const t=typeof a;if(t==="number"||t==="boolean"||t==="string"||a==null)return JSON.stringify(a);if(Array.isArray(a)){let h="[";for(const _ of a)h+=`${Bu(_)},`;return`${h}]`}const n=Object.keys(a).sort();let c="{";for(let h=0;h<n.length;h++)c+=`${JSON.stringify(n[h])}:${Bu(a[n[h]])},`;return`${c}}`}function cm(a){let t="";for(const n of mt)t+=`/${Bu(a[n])}`;return t}function $u(a){const t=a.value;return t?[new Oe(a.key,t,"constants have been deprecated as of v8")]:[]}function Tr(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Un(a){if(Array.isArray(a))return a.map(Un);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const t={};for(const n in a)t[n]=Un(a[n]);return t}return Tr(a)}function tn(a){const t=a.key,n=a.value,c=a.valueSpec||{},h=a.objectElementValidators||{},_=a.style,v=a.styleSpec,w=a.validateSpec;let T=[];const P=Rt(n);if(P!=="object")return[new Oe(t,n,`object expected, ${P} found`)];for(const I in n){const z=I.split(".")[0],j=Bo(c,z)||c["*"];let B;if(Bo(h,z))B=h[z];else if(Bo(c,z))B=w;else if(h["*"])B=h["*"];else{if(!c["*"]){T.push(new Oe(t,n[I],`unknown property "${I}"`));continue}B=w}T=T.concat(B({key:(t&&`${t}.`)+I,value:n[I],valueSpec:j,style:_,styleSpec:v,object:n,objectKey:I,validateSpec:w},n))}for(const I in c)h[I]||c[I].required&&c[I].default===void 0&&n[I]===void 0&&T.push(new Oe(t,n,`missing required property "${I}"`));return T}function rc(a){const t=a.value,n=a.valueSpec,c=a.style,h=a.styleSpec,_=a.key,v=a.arrayElementValidator||a.validateSpec;if(Rt(t)!=="array")return[new Oe(_,t,`array expected, ${Rt(t)} found`)];if(n.length&&t.length!==n.length)return[new Oe(_,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new Oe(_,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let w={type:n.value,values:n.values};h.$version<7&&(w.function=n.function),Rt(n.value)==="object"&&(w=n.value);let T=[];for(let P=0;P<t.length;P++)T=T.concat(v({array:t,arrayIndex:P,value:t[P],valueSpec:w,validateSpec:a.validateSpec,style:c,styleSpec:h,key:`${_}[${P}]`}));return T}function qs(a){const t=a.key,n=a.value,c=a.valueSpec;let h=Rt(n);return h==="number"&&n!=n&&(h="NaN"),h!=="number"?[new Oe(t,n,`number expected, ${h} found`)]:"minimum"in c&&n<c.minimum?[new Oe(t,n,`${n} is less than the minimum value ${c.minimum}`)]:"maximum"in c&&n>c.maximum?[new Oe(t,n,`${n} is greater than the maximum value ${c.maximum}`)]:[]}function Np(a){const t=a.valueSpec,n=Tr(a.value.type);let c,h,_,v={};const w=n!=="categorical"&&a.value.property===void 0,T=!w,P=Rt(a.value.stops)==="array"&&Rt(a.value.stops[0])==="array"&&Rt(a.value.stops[0][0])==="object",I=tn({key:a.key,value:a.value,valueSpec:a.styleSpec.function,validateSpec:a.validateSpec,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(B){if(n==="identity")return[new Oe(B.key,B.value,'identity function may not have a "stops" property')];let N=[];const q=B.value;return N=N.concat(rc({key:B.key,value:q,valueSpec:B.valueSpec,validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:z})),Rt(q)==="array"&&q.length===0&&N.push(new Oe(B.key,q,"array must have at least one stop")),N},default:function(B){return B.validateSpec({key:B.key,value:B.value,valueSpec:t,validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec})}}});return n==="identity"&&w&&I.push(new Oe(a.key,a.value,'missing required property "property"')),n==="identity"||a.value.stops||I.push(new Oe(a.key,a.value,'missing required property "stops"')),n==="exponential"&&a.valueSpec.expression&&!Ru(a.valueSpec)&&I.push(new Oe(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(T&&!Ra(a.valueSpec)?I.push(new Oe(a.key,a.value,"property functions not supported")):w&&!Lp(a.valueSpec)&&I.push(new Oe(a.key,a.value,"zoom functions not supported"))),n!=="categorical"&&!P||a.value.property!==void 0||I.push(new Oe(a.key,a.value,'"property" property is required')),I;function z(B){let N=[];const q=B.value,H=B.key;if(Rt(q)!=="array")return[new Oe(H,q,`array expected, ${Rt(q)} found`)];if(q.length!==2)return[new Oe(H,q,`array length 2 expected, length ${q.length} found`)];if(P){if(Rt(q[0])!=="object")return[new Oe(H,q,`object expected, ${Rt(q[0])} found`)];if(q[0].zoom===void 0)return[new Oe(H,q,"object stop key must have zoom")];if(q[0].value===void 0)return[new Oe(H,q,"object stop key must have value")];if(_&&_>Tr(q[0].zoom))return[new Oe(H,q[0].zoom,"stop zoom values must appear in ascending order")];Tr(q[0].zoom)!==_&&(_=Tr(q[0].zoom),h=void 0,v={}),N=N.concat(tn({key:`${H}[0]`,value:q[0],valueSpec:{zoom:{}},validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:qs,value:j}}))}else N=N.concat(j({key:`${H}[0]`,value:q[0],validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec},q));return Jl(Un(q[1]))?N.concat([new Oe(`${H}[1]`,q[1],"expressions are not allowed in function stops.")]):N.concat(B.validateSpec({key:`${H}[1]`,value:q[1],valueSpec:t,validateSpec:B.validateSpec,style:B.style,styleSpec:B.styleSpec}))}function j(B,N){const q=Rt(B.value),H=Tr(B.value),J=B.value!==null?B.value:N;if(c){if(q!==c)return[new Oe(B.key,J,`${q} stop domain type must match previous stop domain type ${c}`)]}else c=q;if(q!=="number"&&q!=="string"&&q!=="boolean")return[new Oe(B.key,J,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&n!=="categorical"){let ue=`number expected, ${q} found`;return Ra(t)&&n===void 0&&(ue+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Oe(B.key,J,ue)]}return n!=="categorical"||q!=="number"||isFinite(H)&&Math.floor(H)===H?n!=="categorical"&&q==="number"&&h!==void 0&&H<h?[new Oe(B.key,J,"stop domain values must appear in ascending order")]:(h=H,n==="categorical"&&H in v?[new Oe(B.key,J,"stop domain values must be unique")]:(v[H]=!0,[])):[new Oe(B.key,J,`integer expected, found ${H}`)]}}function ho(a){const t=(a.expressionContext==="property"?Op:Bs)(Un(a.value),a.valueSpec);if(t.result==="error")return t.value.map((c=>new Oe(`${a.key}${c.key}`,a.value,c.message)));const n=t.value.expression||t.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!n.outputDefined())return[new Oe(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!Fs(n))return[new Oe(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!Fs(n))return[new Oe(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!Yl(n,["zoom","feature-state"]))return[new Oe(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!Kl(n))return[new Oe(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ic(a){const t=a.key,n=a.value,c=Rt(n);return c!=="string"?[new Oe(t,n,`color expected, ${c} found`)]:At.parse(String(n))?[]:[new Oe(t,n,`color expected, "${n}" found`)]}function aa(a){const t=a.key,n=a.value,c=a.valueSpec,h=[];return Array.isArray(c.values)?c.values.indexOf(Tr(n))===-1&&h.push(new Oe(t,n,`expected one of [${c.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(c.values).indexOf(Tr(n))===-1&&h.push(new Oe(t,n,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(n)} found`)),h}function Nu(a){return Ql(Un(a.value))?ho(fi({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Up(a)}function Up(a){const t=a.value,n=a.key;if(Rt(t)!=="array")return[new Oe(n,t,`array expected, ${Rt(t)} found`)];const c=a.styleSpec;let h,_=[];if(t.length<1)return[new Oe(n,t,"filter array must have at least 1 element")];switch(_=_.concat(aa({key:`${n}[0]`,value:t[0],valueSpec:c.filter_operator,style:a.style,styleSpec:a.styleSpec})),Tr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Tr(t[1])==="$type"&&_.push(new Oe(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&_.push(new Oe(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(h=Rt(t[1]),h!=="string"&&_.push(new Oe(`${n}[1]`,t[1],`string expected, ${h} found`)));for(let v=2;v<t.length;v++)h=Rt(t[v]),Tr(t[1])==="$type"?_=_.concat(aa({key:`${n}[${v}]`,value:t[v],valueSpec:c.geometry_type,style:a.style,styleSpec:a.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&_.push(new Oe(`${n}[${v}]`,t[v],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let v=1;v<t.length;v++)_=_.concat(Up({key:`${n}[${v}]`,value:t[v],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":h=Rt(t[1]),t.length!==2?_.push(new Oe(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):h!=="string"&&_.push(new Oe(`${n}[1]`,t[1],`string expected, ${h} found`))}return _}function Vp(a,t){const n=a.key,c=a.validateSpec,h=a.style,_=a.styleSpec,v=a.value,w=a.objectKey,T=_[`${t}_${a.layerType}`];if(!T)return[];const P=w.match(/^(.*)-transition$/);if(t==="paint"&&P&&T[P[1]]&&T[P[1]].transition)return c({key:n,value:v,valueSpec:_.transition,style:h,styleSpec:_});const I=a.valueSpec||T[w];if(!I)return[new Oe(n,v,`unknown property "${w}"`)];let z;if(Rt(v)==="string"&&Ra(I)&&!I.tokens&&(z=/^{([^}]+)}$/.exec(v)))return[new Oe(n,v,`"${w}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(z[1])} }\`.`)];const j=[];return a.layerType==="symbol"&&(w==="text-field"&&h&&!h.glyphs&&j.push(new Oe(n,v,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&Os(Un(v))&&Tr(v.type)==="identity"&&j.push(new Oe(n,v,'"text-font" does not support identity functions'))),j.concat(c({key:a.key,value:v,valueSpec:I,style:h,styleSpec:_,expressionContext:"property",propertyType:t,propertyKey:w}))}function qp(a){return Vp(a,"paint")}function Gp(a){return Vp(a,"layout")}function Zp(a){let t=[];const n=a.value,c=a.key,h=a.style,_=a.styleSpec;if(Rt(n)!=="object")return[new Oe(c,n,`object expected, ${Rt(n)} found`)];n.type||n.ref||t.push(new Oe(c,n,'either "type" or "ref" is required'));let v=Tr(n.type);const w=Tr(n.ref);if(n.id){const T=Tr(n.id);for(let P=0;P<a.arrayIndex;P++){const I=h.layers[P];Tr(I.id)===T&&t.push(new Oe(c,n.id,`duplicate layer id "${n.id}", previously used at line ${I.id.__line__}`))}}if("ref"in n){let T;["type","source","source-layer","filter","layout"].forEach((P=>{P in n&&t.push(new Oe(c,n[P],`"${P}" is prohibited for ref layers`))})),h.layers.forEach((P=>{Tr(P.id)===w&&(T=P)})),T?T.ref?t.push(new Oe(c,n.ref,"ref cannot reference another ref layer")):v=Tr(T.type):t.push(new Oe(c,n.ref,`ref layer "${w}" not found`))}else if(v!=="background")if(n.source){const T=h.sources&&h.sources[n.source],P=T&&Tr(T.type);T?P==="vector"&&v==="raster"?t.push(new Oe(c,n.source,`layer "${n.id}" requires a raster source`)):P!=="raster-dem"&&v==="hillshade"||P!=="raster-dem"&&v==="color-relief"?t.push(new Oe(c,n.source,`layer "${n.id}" requires a raster-dem source`)):P==="raster"&&v!=="raster"?t.push(new Oe(c,n.source,`layer "${n.id}" requires a vector source`)):P!=="vector"||n["source-layer"]?P==="raster-dem"&&v!=="hillshade"&&v!=="color-relief"?t.push(new Oe(c,n.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):v!=="line"||!n.paint||!n.paint["line-gradient"]||P==="geojson"&&T.lineMetrics||t.push(new Oe(c,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Oe(c,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new Oe(c,n.source,`source "${n.source}" not found`))}else t.push(new Oe(c,n,'missing required property "source"'));return t=t.concat(tn({key:c,value:n,valueSpec:_.layer,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,objectElementValidators:{"*":()=>[],type:()=>a.validateSpec({key:`${c}.type`,value:n.type,valueSpec:_.layer.type,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,object:n,objectKey:"type"}),filter:Nu,layout:T=>tn({layer:n,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":P=>Gp(fi({layerType:v},P))}}),paint:T=>tn({layer:n,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":P=>qp(fi({layerType:v},P))}})}})),t}function dn(a){const t=a.value,n=a.key,c=Rt(t);return c!=="string"?[new Oe(n,t,`string expected, ${c} found`)]:[]}const Go={promoteId:function({key:a,value:t}){if(Rt(t)==="string")return dn({key:a,value:t});{const n=[];for(const c in t)n.push(...dn({key:`${a}.${c}`,value:t[c]}));return n}}};function ji(a){const t=a.value,n=a.key,c=a.styleSpec,h=a.style,_=a.validateSpec;if(!t.type)return[new Oe(n,t,'"type" is required')];const v=Tr(t.type);let w;switch(v){case"vector":case"raster":return w=tn({key:n,value:t,valueSpec:c[`source_${v.replace("-","_")}`],style:a.style,styleSpec:c,objectElementValidators:Go,validateSpec:_}),w;case"raster-dem":return w=(function(T){var P;const I=(P=T.sourceName)!==null&&P!==void 0?P:"",z=T.value,j=T.styleSpec,B=j.source_raster_dem,N=T.style;let q=[];const H=Rt(z);if(z===void 0)return q;if(H!=="object")return q.push(new Oe("source_raster_dem",z,`object expected, ${H} found`)),q;const J=Tr(z.encoding)==="custom",ue=["redFactor","greenFactor","blueFactor","baseShift"],ae=T.value.encoding?`"${T.value.encoding}"`:"Default";for(const se in z)!J&&ue.includes(se)?q.push(new Oe(se,z[se],`In "${I}": "${se}" is only valid when "encoding" is set to "custom". ${ae} encoding found`)):B[se]?q=q.concat(T.validateSpec({key:se,value:z[se],valueSpec:B[se],validateSpec:T.validateSpec,style:N,styleSpec:j})):q.push(new Oe(se,z[se],`unknown property "${se}"`));return q})({sourceName:n,value:t,style:a.style,styleSpec:c,validateSpec:_}),w;case"geojson":if(w=tn({key:n,value:t,valueSpec:c.source_geojson,style:h,styleSpec:c,validateSpec:_,objectElementValidators:Go}),t.cluster)for(const T in t.clusterProperties){const[P,I]=t.clusterProperties[T],z=typeof P=="string"?[P,["accumulated"],["get",T]]:P;w.push(...ho({key:`${n}.${T}.map`,value:I,expressionContext:"cluster-map"})),w.push(...ho({key:`${n}.${T}.reduce`,value:z,expressionContext:"cluster-reduce"}))}return w;case"video":return tn({key:n,value:t,valueSpec:c.source_video,style:h,validateSpec:_,styleSpec:c});case"image":return tn({key:n,value:t,valueSpec:c.source_image,style:h,validateSpec:_,styleSpec:c});case"canvas":return[new Oe(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return aa({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Zo(a){const t=a.value,n=a.styleSpec,c=n.light,h=a.style;let _=[];const v=Rt(t);if(t===void 0)return _;if(v!=="object")return _=_.concat([new Oe("light",t,`object expected, ${v} found`)]),_;for(const w in t){const T=w.match(/^(.*)-transition$/);_=_.concat(T&&c[T[1]]&&c[T[1]].transition?a.validateSpec({key:w,value:t[w],valueSpec:n.transition,validateSpec:a.validateSpec,style:h,styleSpec:n}):c[w]?a.validateSpec({key:w,value:t[w],valueSpec:c[w],validateSpec:a.validateSpec,style:h,styleSpec:n}):[new Oe(w,t[w],`unknown property "${w}"`)])}return _}function Uu(a){const t=a.value,n=a.styleSpec,c=n.sky,h=a.style,_=Rt(t);if(t===void 0)return[];if(_!=="object")return[new Oe("sky",t,`object expected, ${_} found`)];let v=[];for(const w in t)v=v.concat(c[w]?a.validateSpec({key:w,value:t[w],valueSpec:c[w],style:h,styleSpec:n}):[new Oe(w,t[w],`unknown property "${w}"`)]);return v}function Wp(a){const t=a.value,n=a.styleSpec,c=n.terrain,h=a.style;let _=[];const v=Rt(t);if(t===void 0)return _;if(v!=="object")return _=_.concat([new Oe("terrain",t,`object expected, ${v} found`)]),_;for(const w in t)_=_.concat(c[w]?a.validateSpec({key:w,value:t[w],valueSpec:c[w],validateSpec:a.validateSpec,style:h,styleSpec:n}):[new Oe(w,t[w],`unknown property "${w}"`)]);return _}function Hp(a){let t=[];const n=a.value,c=a.key;if(Array.isArray(n)){const h=[],_=[];for(const v in n)n[v].id&&h.includes(n[v].id)&&t.push(new Oe(c,n,`all the sprites' ids must be unique, but ${n[v].id} is duplicated`)),h.push(n[v].id),n[v].url&&_.includes(n[v].url)&&t.push(new Oe(c,n,`all the sprites' URLs must be unique, but ${n[v].url} is duplicated`)),_.push(n[v].url),t=t.concat(tn({key:`${c}[${v}]`,value:n[v],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:a.validateSpec}));return t}return dn({key:c,value:n})}function Wo(a){return t=a.value,t&&t.constructor===Object?[]:[new Oe(a.key,a.value,`object expected, ${Rt(a.value)} found`)];var t}const Vu={"*":()=>[],array:rc,boolean:function(a){const t=a.value,n=a.key,c=Rt(t);return c!=="boolean"?[new Oe(n,t,`boolean expected, ${c} found`)]:[]},number:qs,color:ic,constants:$u,enum:aa,filter:Nu,function:Np,layer:Zp,object:tn,source:ji,light:Zo,sky:Uu,terrain:Wp,projection:function(a){const t=a.value,n=a.styleSpec,c=n.projection,h=a.style,_=Rt(t);if(t===void 0)return[];if(_!=="object")return[new Oe("projection",t,`object expected, ${_} found`)];let v=[];for(const w in t)v=v.concat(c[w]?a.validateSpec({key:w,value:t[w],valueSpec:c[w],style:h,styleSpec:n}):[new Oe(w,t[w],`unknown property "${w}"`)]);return v},projectionDefinition:function(a){const t=a.key;let n=a.value;n=n instanceof String?n.valueOf():n;const c=Rt(n);return c!=="array"||(function(h){return Array.isArray(h)&&h.length===3&&typeof h[0]=="string"&&typeof h[1]=="string"&&typeof h[2]=="number"})(n)||(function(h){return!!["interpolate","step","literal"].includes(h[0])})(n)?["array","string"].includes(c)?[]:[new Oe(t,n,`projection expected, invalid type "${c}" found`)]:[new Oe(t,n,`projection expected, invalid array ${JSON.stringify(n)} found`)]},string:dn,formatted:function(a){return dn(a).length===0?[]:ho(a)},resolvedImage:function(a){return dn(a).length===0?[]:ho(a)},padding:function(a){const t=a.key,n=a.value;if(Rt(n)==="array"){if(n.length<1||n.length>4)return[new Oe(t,n,`padding requires 1 to 4 values; ${n.length} values found`)];const c={type:"number"};let h=[];for(let _=0;_<n.length;_++)h=h.concat(a.validateSpec({key:`${t}[${_}]`,value:n[_],validateSpec:a.validateSpec,valueSpec:c}));return h}return qs({key:t,value:n,valueSpec:{}})},numberArray:function(a){const t=a.key,n=a.value;if(Rt(n)==="array"){const c={type:"number"};if(n.length<1)return[new Oe(t,n,"array length at least 1 expected, length 0 found")];let h=[];for(let _=0;_<n.length;_++)h=h.concat(a.validateSpec({key:`${t}[${_}]`,value:n[_],validateSpec:a.validateSpec,valueSpec:c}));return h}return qs({key:t,value:n,valueSpec:{}})},colorArray:function(a){const t=a.key,n=a.value;if(Rt(n)==="array"){if(n.length<1)return[new Oe(t,n,"array length at least 1 expected, length 0 found")];let c=[];for(let h=0;h<n.length;h++)c=c.concat(ic({key:`${t}[${h}]`,value:n[h]}));return c}return ic({key:t,value:n})},variableAnchorOffsetCollection:function(a){const t=a.key,n=a.value,c=Rt(n),h=a.styleSpec;if(c!=="array"||n.length<1||n.length%2!=0)return[new Oe(t,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let _=[];for(let v=0;v<n.length;v+=2)_=_.concat(aa({key:`${t}[${v}]`,value:n[v],valueSpec:h.layout_symbol["text-anchor"]})),_=_.concat(rc({key:`${t}[${v+1}]`,value:n[v+1],valueSpec:{length:2,value:"number"},validateSpec:a.validateSpec,style:a.style,styleSpec:h}));return _},sprite:Hp,state:Wo};function Ho(a){const t=a.value,n=a.valueSpec,c=a.styleSpec;return a.validateSpec=Ho,n.expression&&Os(Tr(t))?Np(a):n.expression&&Jl(Un(t))?ho(a):n.type&&Vu[n.type]?Vu[n.type](a):tn(fi({},a,{valueSpec:n.type?c[n.type]:n}))}function Xp(a){const t=a.value,n=a.key,c=dn(a);return c.length||(t.indexOf("{fontstack}")===-1&&c.push(new Oe(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&c.push(new Oe(n,t,'"glyphs" url must include a "{range}" token'))),c}function Fi(a,t=ge){let n=[];return n=n.concat(Ho({key:"",value:a,valueSpec:t.$root,styleSpec:t,style:a,validateSpec:Ho,objectElementValidators:{glyphs:Xp,"*":()=>[]}})),a.constants&&(n=n.concat($u({key:"constants",value:a.constants}))),Xo(n)}function fn(a){return function(t){return a({...t,validateSpec:Ho})}}function Xo(a){return[].concat(a).sort(((t,n)=>t.line-n.line))}function mn(a){return function(...t){return Xo(a.apply(this,t))}}Fi.source=mn(fn(ji)),Fi.sprite=mn(fn(Hp)),Fi.glyphs=mn(fn(Xp)),Fi.light=mn(fn(Zo)),Fi.sky=mn(fn(Uu)),Fi.terrain=mn(fn(Wp)),Fi.state=mn(fn(Wo)),Fi.layer=mn(fn(Zp)),Fi.filter=mn(fn(Nu)),Fi.paintProperty=mn(fn(qp)),Fi.layoutProperty=mn(fn(Gp));const Ko=Fi,um=Ko.light,Gs=Ko.sky,hm=Ko.paintProperty,pm=Ko.layoutProperty;function Zs(a,t){let n=!1;if(t&&t.length)for(const c of t)a.fire(new Re(new Error(c.message))),n=!0;return n}class Ws{constructor(t,n,c){const h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const v=new Int32Array(this.arrayBuffer);t=v[0],this.d=(n=v[1])+2*(c=v[2]);for(let T=0;T<this.d*this.d;T++){const P=v[3+T],I=v[3+T+1];h.push(P===I?null:v.subarray(P,I))}const w=v[3+h.length+1];this.keys=v.subarray(v[3+h.length],w),this.bboxes=v.subarray(w),this.insert=this._insertReadonly}else{this.d=n+2*c;for(let v=0;v<this.d*this.d;v++)h.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=t,this.padding=c,this.scale=n/t,this.uid=0;const _=c/n*t;this.min=-_,this.max=t+_}insert(t,n,c,h,_){this._forEachCell(n,c,h,_,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(n),this.bboxes.push(c),this.bboxes.push(h),this.bboxes.push(_)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,n,c,h,_,v){this.cells[_].push(v)}query(t,n,c,h,_){const v=this.min,w=this.max;if(t<=v&&n<=v&&w<=c&&w<=h&&!_)return Array.prototype.slice.call(this.keys);{const T=[];return this._forEachCell(t,n,c,h,this._queryCell,T,{},_),T}}_queryCell(t,n,c,h,_,v,w,T){const P=this.cells[_];if(P!==null){const I=this.keys,z=this.bboxes;for(let j=0;j<P.length;j++){const B=P[j];if(w[B]===void 0){const N=4*B;(T?T(z[N+0],z[N+1],z[N+2],z[N+3]):t<=z[N+2]&&n<=z[N+3]&&c>=z[N+0]&&h>=z[N+1])?(w[B]=!0,v.push(I[B])):w[B]=!1}}}}_forEachCell(t,n,c,h,_,v,w,T){const P=this._convertToCellCoord(t),I=this._convertToCellCoord(n),z=this._convertToCellCoord(c),j=this._convertToCellCoord(h);for(let B=P;B<=z;B++)for(let N=I;N<=j;N++){const q=this.d*N+B;if((!T||T(this._convertFromCellCoord(B),this._convertFromCellCoord(N),this._convertFromCellCoord(B+1),this._convertFromCellCoord(N+1)))&&_.call(this,t,n,c,h,q,v,w,T))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,n=3+this.cells.length+1+1;let c=0;for(let v=0;v<this.cells.length;v++)c+=this.cells[v].length;const h=new Int32Array(n+c+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;let _=n;for(let v=0;v<t.length;v++){const w=t[v];h[3+v]=_,h.set(w,_),_+=w.length}return h[3+t.length]=_,h.set(this.keys,_),_+=this.keys.length,h[3+t.length+1]=_,h.set(this.bboxes,_),_+=this.bboxes.length,h.buffer}static serialize(t,n){const c=t.toArrayBuffer();return n&&n.push(c),{buffer:c}}static deserialize(t){return new Ws(t.buffer)}}const gn={};function Ke(a,t,n={}){if(gn[a])throw new Error(`${a} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:a,writeable:!1}),gn[a]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}Ke("Object",Object),Ke("Set",Set),Ke("TransferableGridIndex",Ws),Ke("Color",At),Ke("Error",Error),Ke("AJAXError",re),Ke("ResolvedImage",Vi),Ke("StylePropertyFunction",Ns),Ke("StyleExpression",Lu,{omit:["_evaluator"]}),Ke("ZoomDependentExpression",Du),Ke("ZoomConstantExpression",$s),Ke("CompoundExpression",en,{omit:["_evaluate"]});for(const a in Vo)Vo[a]._classRegistryKey||Ke(`Expression_${a}`,Vo[a]);function qu(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function nc(a){return a.$name||a.constructor._classRegistryKey}function Gu(a){return!(function(t){if(t===null||typeof t!="object")return!1;const n=nc(t);return!(!n||n==="Object")})(a)&&(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob||a instanceof Error||qu(a)||jn(a)||ArrayBuffer.isView(a)||a instanceof ImageData)}function Yo(a,t){if(Gu(a))return(qu(a)||jn(a))&&t&&t.push(a),ArrayBuffer.isView(a)&&t&&t.push(a.buffer),a instanceof ImageData&&t&&t.push(a.data.buffer),a;if(Array.isArray(a)){const _=[];for(const v of a)_.push(Yo(v,t));return _}if(typeof a!="object")throw new Error("can't serialize object of type "+typeof a);const n=nc(a);if(!n)throw new Error(`can't serialize object of unregistered class ${a.constructor.name}`);if(!gn[n])throw new Error(`${n} is not registered.`);const{klass:c}=gn[n],h=c.serialize?c.serialize(a,t):{};if(c.serialize){if(t&&h===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const _ in a){if(!a.hasOwnProperty(_)||gn[n].omit.indexOf(_)>=0)continue;const v=a[_];h[_]=gn[n].shallow.indexOf(_)>=0?v:Yo(v,t)}a instanceof Error&&(h.message=a.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(h.$name=n),h}function po(a){if(Gu(a))return a;if(Array.isArray(a))return a.map(po);if(typeof a!="object")throw new Error("can't deserialize object of type "+typeof a);const t=nc(a)||"Object";if(!gn[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:n}=gn[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(a);const c=Object.create(n.prototype);for(const h of Object.keys(a)){if(h==="$name")continue;const _=a[h];c[h]=gn[t].shallow.indexOf(h)>=0?_:po(_)}return c}class ac{constructor(){this.first=!0}update(t,n){const c=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=n),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=c,!0))}}const Bt={"Latin-1 Supplement":a=>a>=128&&a<=255,"Hangul Jamo":a=>a>=4352&&a<=4607,Khmer:a=>a>=6016&&a<=6143,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Kanbun:a=>a>=12688&&a<=12703,"CJK Strokes":a=>a>=12736&&a<=12783,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Hangul Syllables":a=>a>=44032&&a<=55215,"Private Use Area":a=>a>=57344&&a<=63743,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519};function oc(a){for(const t of a)if(Wu(t.charCodeAt(0)))return!0;return!1}function dm(a){for(const t of a)if(!Kp(t.charCodeAt(0)))return!1;return!0}function sc(a){const t=a.map((n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}})).filter((n=>n));return new RegExp(t.join("|"),"u")}const fm=sc(["Arab","Dupl","Mong","Ougr","Syrc"]);function Kp(a){return!fm.test(String.fromCodePoint(a))}const Zu=sc(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Wu(a){return!(a!==746&&a!==747&&(a<4352||!(Bt["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||Bt["CJK Compatibility"](a)||Bt["CJK Strokes"](a)||!(!Bt["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||Bt["Enclosed CJK Letters and Months"](a)||Bt["Ideographic Description Characters"](a)||Bt.Kanbun(a)||Bt.Katakana(a)&&a!==12540||!(!Bt["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!Bt["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||Bt["Vertical Forms"](a)||Bt["Yijing Hexagram Symbols"](a)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(a))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(a))||Zu.test(String.fromCodePoint(a)))))}function Yp(a){return!(Wu(a)||(function(t){return!!(Bt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Bt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Bt["Letterlike Symbols"](t)||Bt["Number Forms"](t)||Bt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Bt["Control Pictures"](t)&&t!==9251||Bt["Optical Character Recognition"](t)||Bt["Enclosed Alphanumerics"](t)||Bt["Geometric Shapes"](t)||Bt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Bt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Bt["CJK Symbols and Punctuation"](t)||Bt.Katakana(t)||Bt["Private Use Area"](t)||Bt["CJK Compatibility Forms"](t)||Bt["Small Form Variants"](t)||Bt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)})(a))}const Jp=sc(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Hu(a){return Jp.test(String.fromCodePoint(a))}function Qp(a,t){return!(!t&&Hu(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||Bt.Khmer(a))}function ed(a){for(const t of a)if(Hu(t.charCodeAt(0)))return!0;return!1}const yn=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(a){this.pluginStatus=a.pluginStatus,this.pluginURL=a.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(a){if(yn.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=a.applyArabicShaping,this.processBidirectionalText=a.processBidirectionalText,this.processStyledBidirectionalText=a.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(a,t){return l(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(a.pluginStatus!=="loading")return this.setState(a),a;const n=a.pluginURL,c=new Promise((_=>{this.loadScriptResolve=_}));t(n);const h=new Promise((_=>setTimeout((()=>_()),this.TIMEOUT)));if(yield Promise.race([c,h]),this.isParsed()){const _={pluginStatus:"loaded",pluginURL:n};return this.setState(_),_}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${n}`)}))}};class gr{constructor(t,n){this.zoom=t,n?(this.now=n.now||0,this.fadeDuration=n.fadeDuration||0,this.zoomHistory=n.zoomHistory||new ac,this.transition=n.transition||{},this.globalState=n.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ac,this.transition={},this.globalState={})}isSupportedScript(t){return(function(n,c){for(const h of n)if(!Qp(h.charCodeAt(0),c))return!1;return!0})(t,yn.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,n=t-Math.floor(t),c=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*n}}}class Jo{constructor(t,n){this.property=t,this.value=n,this.expression=(function(c,h){if(Os(c))return new Ns(c,h);if(Jl(c)){const _=Op(c,h);if(_.result==="error")throw new Error(_.value.map((v=>`${v.key}: ${v.message}`)).join(", "));return _.value}{let _=c;return h.type==="color"&&typeof c=="string"?_=At.parse(c):h.type!=="padding"||typeof c!="number"&&!Array.isArray(c)?h.type!=="numberArray"||typeof c!="number"&&!Array.isArray(c)?h.type!=="colorArray"||typeof c!="string"&&!Array.isArray(c)?h.type==="variableAnchorOffsetCollection"&&Array.isArray(c)?_=wi.parse(c):h.type==="projectionDefinition"&&typeof c=="string"&&(_=mi.parse(c)):_=jr.parse(c):_=xi.parse(c):_=Xr.parse(c),{globalStateRefs:new Set,kind:"constant",evaluate:()=>_}}})(n===void 0?t.specification.default:n,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(t,n,c){return this.property.possiblyEvaluate(this,t,n,c)}}class Xu{constructor(t){this.property=t,this.value=new Jo(t,void 0)}transitioned(t,n){return new Ku(this.property,this.value,n,Qt({},t.transition,this.transition),t.now)}untransitioned(){return new Ku(this.property,this.value,null,{},0)}}class td{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return dr(this._values[t].value.value)}setValue(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Xu(this._values[t].property)),this._values[t].value=new Jo(this._values[t].property,n===null?void 0:dr(n))}getTransition(t){return dr(this._values[t].transition)}setTransition(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Xu(this._values[t].property)),this._values[t].transition=dr(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const c=this.getValue(n);c!==void 0&&(t[n]=c);const h=this.getTransition(n);h!==void 0&&(t[`${n}-transition`]=h)}return t}transitioned(t,n){const c=new Yu(this._properties);for(const h of Object.keys(this._values))c._values[h]=this._values[h].transitioned(t,n._values[h]);return c}untransitioned(){const t=new Yu(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class Ku{constructor(t,n,c,h,_){this.property=t,this.value=n,this.begin=_+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=c)}possiblyEvaluate(t,n,c){const h=t.now||0,_=this.value.possiblyEvaluate(t,n,c),v=this.prior;if(v){if(h>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(h<this.begin)return v.possiblyEvaluate(t,n,c);{const w=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(t,n,c),_,Ot(w))}}return _}}class Yu{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,c){const h=new lc(this._properties);for(const _ of Object.keys(this._values))h._values[_]=this._values[_].possiblyEvaluate(t,n,c);return h}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class rd{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return dr(this._values[t].value)}setValue(t,n){this._values[t]=new Jo(this._values[t].property,n===null?void 0:dr(n))}serialize(){const t={};for(const n of Object.keys(this._values)){const c=this.getValue(n);c!==void 0&&(t[n]=c)}return t}possiblyEvaluate(t,n,c){const h=new lc(this._properties);for(const _ of Object.keys(this._values))h._values[_]=this._values[_].possiblyEvaluate(t,n,c);return h}}class Vn{constructor(t,n,c){this.property=t,this.value=n,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,n,c,h){return this.property.evaluate(this.value,this.parameters,t,n,c,h)}}class lc{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class rt{constructor(t){this.specification=t}possiblyEvaluate(t,n){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(n)}interpolate(t,n,c){const h=Nn[this.specification.type];return h?h(t,n,c):t}}class ht{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,c,h){return new Vn(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(n,null,{},c,h)}:t.expression,n)}interpolate(t,n,c){if(t.value.kind!=="constant"||n.value.kind!=="constant")return t;if(t.value.value===void 0||n.value.value===void 0)return new Vn(this,{kind:"constant",value:void 0},t.parameters);const h=Nn[this.specification.type];if(h){const _=h(t.value.value,n.value.value,c);return new Vn(this,{kind:"constant",value:_},t.parameters)}return t}evaluate(t,n,c,h,_,v){return t.kind==="constant"?t.value:t.evaluate(n,c,h,_,v)}}class cc extends ht{possiblyEvaluate(t,n,c,h){if(t.value===void 0)return new Vn(this,{kind:"constant",value:void 0},n);if(t.expression.kind==="constant"){const _=t.expression.evaluate(n,null,{},c,h),v=t.property.specification.type==="resolvedImage"&&typeof _!="string"?_.name:_,w=this._calculate(v,v,v,n);return new Vn(this,{kind:"constant",value:w},n)}if(t.expression.kind==="camera"){const _=this._calculate(t.expression.evaluate({zoom:n.zoom-1}),t.expression.evaluate({zoom:n.zoom}),t.expression.evaluate({zoom:n.zoom+1}),n);return new Vn(this,{kind:"constant",value:_},n)}return new Vn(this,t.expression,n)}evaluate(t,n,c,h,_,v){if(t.kind==="source"){const w=t.evaluate(n,c,h,_,v);return this._calculate(w,w,w,n)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(n.zoom)-1},c,h),t.evaluate({zoom:Math.floor(n.zoom)},c,h),t.evaluate({zoom:Math.floor(n.zoom)+1},c,h),n):t.value}_calculate(t,n,c,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:c,to:n}}interpolate(t){return t}}class Da{constructor(t){this.specification=t}possiblyEvaluate(t,n,c,h){if(t.value!==void 0){if(t.expression.kind==="constant"){const _=t.expression.evaluate(n,null,{},c,h);return this._calculate(_,_,_,n)}return this._calculate(t.expression.evaluate(new gr(Math.floor(n.zoom-1),n)),t.expression.evaluate(new gr(Math.floor(n.zoom),n)),t.expression.evaluate(new gr(Math.floor(n.zoom+1),n)),n)}}_calculate(t,n,c,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:c,to:n}}interpolate(t){return t}}class uc{constructor(t){this.specification=t}possiblyEvaluate(t,n,c,h){return!!t.expression.evaluate(n,null,{},c,h)}interpolate(){return!1}}class Ti{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in t){const c=t[n];c.specification.overridable&&this.overridableProperties.push(n);const h=this.defaultPropertyValues[n]=new Jo(c,void 0),_=this.defaultTransitionablePropertyValues[n]=new Xu(c);this.defaultTransitioningPropertyValues[n]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=h.possiblyEvaluate({})}}}Ke("DataDrivenProperty",ht),Ke("DataConstantProperty",rt),Ke("CrossFadedDataDrivenProperty",cc),Ke("CrossFadedProperty",Da),Ke("ColorRampProperty",uc);const id="-transition";class rn extends tt{constructor(t,n){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter,this._featureFilter=co(t.filter)),n.layout&&(this._unevaluatedLayout=new rd(n.layout)),n.paint)){this._transitionablePaint=new td(n.paint);for(const c in t.paint)this.setPaintProperty(c,t.paint[c],{validate:!1});for(const c in t.layout)this.setLayoutProperty(c,t.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new lc(n.paint)}}setFilter(t){this.filter=t,this._featureFilter=co(t)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}getLayoutAffectingGlobalStateRefs(){const t=new Set;if(this._unevaluatedLayout)for(const n in this._unevaluatedLayout._values){const c=this._unevaluatedLayout._values[n];for(const h of c.getGlobalStateRefs())t.add(h)}for(const n of this._featureFilter.getGlobalStateRefs())t.add(n);return t}setLayoutProperty(t,n,c={}){n!=null&&this._validate(pm,`layers.${this.id}.layout.${t}`,t,n,c)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,n):this.visibility=n)}getPaintProperty(t){return t.endsWith(id)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,c={}){if(n!=null&&this._validate(hm,`layers.${this.id}.paint.${t}`,t,n,c))return!1;if(t.endsWith(id))return this._transitionablePaint.setTransition(t.slice(0,-11),n||void 0),!1;{const h=this._transitionablePaint._values[t],_=h.property.specification["property-type"]==="cross-faded-data-driven",v=h.value.isDataDriven(),w=h.value;this._transitionablePaint.setValue(t,n),this._handleSpecialPaintPropertyUpdate(t);const T=this._transitionablePaint._values[t].value;return T.isDataDriven()||v||_||this._handleOverridablePaintPropertyUpdate(t,w,T)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,n,c){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),xr(t,((n,c)=>!(n===void 0||c==="layout"&&!Object.keys(n).length||c==="paint"&&!Object.keys(n).length)))}_validate(t,n,c,h,_={}){return(!_||_.validate!==!1)&&Zs(this,t.call(Ko,{key:n,layerType:this.type,objectKey:c,value:h,styleSpec:ge,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof Vn&&Ra(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const mm={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Hs{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ir{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ar(a,t=1){let n=0,c=0;return{members:a.map((h=>{const _=mm[h.type].BYTES_PER_ELEMENT,v=n=hc(n,Math.max(t,_)),w=h.components||1;return c=Math.max(c,_),n+=_*w,{name:h.name,type:h.type,components:w,offset:v}})),size:hc(n,Math.max(c,t)),alignment:t}}function hc(a,t){return Math.ceil(a/t)*t}class Qo extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const c=this.length;return this.resize(c+1),this.emplace(c,t,n)}emplace(t,n,c){const h=2*t;return this.int16[h+0]=n,this.int16[h+1]=c,t}}Qo.prototype.bytesPerElement=4,Ke("StructArrayLayout2i4",Qo);class es extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,c){const h=this.length;return this.resize(h+1),this.emplace(h,t,n,c)}emplace(t,n,c,h){const _=3*t;return this.int16[_+0]=n,this.int16[_+1]=c,this.int16[_+2]=h,t}}es.prototype.bytesPerElement=6,Ke("StructArrayLayout3i6",es);class Ju extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,c,h){const _=this.length;return this.resize(_+1),this.emplace(_,t,n,c,h)}emplace(t,n,c,h,_){const v=4*t;return this.int16[v+0]=n,this.int16[v+1]=c,this.int16[v+2]=h,this.int16[v+3]=_,t}}Ju.prototype.bytesPerElement=8,Ke("StructArrayLayout4i8",Ju);class ts extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,c,h,_,v){const w=this.length;return this.resize(w+1),this.emplace(w,t,n,c,h,_,v)}emplace(t,n,c,h,_,v,w){const T=6*t;return this.int16[T+0]=n,this.int16[T+1]=c,this.int16[T+2]=h,this.int16[T+3]=_,this.int16[T+4]=v,this.int16[T+5]=w,t}}ts.prototype.bytesPerElement=12,Ke("StructArrayLayout2i4i12",ts);class fo extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,c,h,_,v){const w=this.length;return this.resize(w+1),this.emplace(w,t,n,c,h,_,v)}emplace(t,n,c,h,_,v,w){const T=4*t,P=8*t;return this.int16[T+0]=n,this.int16[T+1]=c,this.uint8[P+4]=h,this.uint8[P+5]=_,this.uint8[P+6]=v,this.uint8[P+7]=w,t}}fo.prototype.bytesPerElement=8,Ke("StructArrayLayout2i4ub8",fo);class Xs extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const c=this.length;return this.resize(c+1),this.emplace(c,t,n)}emplace(t,n,c){const h=2*t;return this.float32[h+0]=n,this.float32[h+1]=c,t}}Xs.prototype.bytesPerElement=8,Ke("StructArrayLayout2f8",Xs);class pc extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,c,h,_,v,w,T,P,I){const z=this.length;return this.resize(z+1),this.emplace(z,t,n,c,h,_,v,w,T,P,I)}emplace(t,n,c,h,_,v,w,T,P,I,z){const j=10*t;return this.uint16[j+0]=n,this.uint16[j+1]=c,this.uint16[j+2]=h,this.uint16[j+3]=_,this.uint16[j+4]=v,this.uint16[j+5]=w,this.uint16[j+6]=T,this.uint16[j+7]=P,this.uint16[j+8]=I,this.uint16[j+9]=z,t}}pc.prototype.bytesPerElement=20,Ke("StructArrayLayout10ui20",pc);class mo extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,c,h,_,v,w,T,P,I,z,j){const B=this.length;return this.resize(B+1),this.emplace(B,t,n,c,h,_,v,w,T,P,I,z,j)}emplace(t,n,c,h,_,v,w,T,P,I,z,j,B){const N=12*t;return this.int16[N+0]=n,this.int16[N+1]=c,this.int16[N+2]=h,this.int16[N+3]=_,this.uint16[N+4]=v,this.uint16[N+5]=w,this.uint16[N+6]=T,this.uint16[N+7]=P,this.int16[N+8]=I,this.int16[N+9]=z,this.int16[N+10]=j,this.int16[N+11]=B,t}}mo.prototype.bytesPerElement=24,Ke("StructArrayLayout4i4ui4i24",mo);class Qu extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,c){const h=this.length;return this.resize(h+1),this.emplace(h,t,n,c)}emplace(t,n,c,h){const _=3*t;return this.float32[_+0]=n,this.float32[_+1]=c,this.float32[_+2]=h,t}}Qu.prototype.bytesPerElement=12,Ke("StructArrayLayout3f12",Qu);class eh extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}eh.prototype.bytesPerElement=4,Ke("StructArrayLayout1ul4",eh);class dc extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,c,h,_,v,w,T,P){const I=this.length;return this.resize(I+1),this.emplace(I,t,n,c,h,_,v,w,T,P)}emplace(t,n,c,h,_,v,w,T,P,I){const z=10*t,j=5*t;return this.int16[z+0]=n,this.int16[z+1]=c,this.int16[z+2]=h,this.int16[z+3]=_,this.int16[z+4]=v,this.int16[z+5]=w,this.uint32[j+3]=T,this.uint16[z+8]=P,this.uint16[z+9]=I,t}}dc.prototype.bytesPerElement=20,Ke("StructArrayLayout6i1ul2ui20",dc);class th extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,c,h,_,v){const w=this.length;return this.resize(w+1),this.emplace(w,t,n,c,h,_,v)}emplace(t,n,c,h,_,v,w){const T=6*t;return this.int16[T+0]=n,this.int16[T+1]=c,this.int16[T+2]=h,this.int16[T+3]=_,this.int16[T+4]=v,this.int16[T+5]=w,t}}th.prototype.bytesPerElement=12,Ke("StructArrayLayout2i2i2i12",th);class g extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,c,h,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,c,h,_)}emplace(t,n,c,h,_,v){const w=4*t,T=8*t;return this.float32[w+0]=n,this.float32[w+1]=c,this.float32[w+2]=h,this.int16[T+6]=_,this.int16[T+7]=v,t}}g.prototype.bytesPerElement=16,Ke("StructArrayLayout2f1f2i16",g);class e extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,c,h,_,v){const w=this.length;return this.resize(w+1),this.emplace(w,t,n,c,h,_,v)}emplace(t,n,c,h,_,v,w){const T=16*t,P=4*t,I=8*t;return this.uint8[T+0]=n,this.uint8[T+1]=c,this.float32[P+1]=h,this.float32[P+2]=_,this.int16[I+6]=v,this.int16[I+7]=w,t}}e.prototype.bytesPerElement=16,Ke("StructArrayLayout2ub2f2i16",e);class o extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,c){const h=this.length;return this.resize(h+1),this.emplace(h,t,n,c)}emplace(t,n,c,h){const _=3*t;return this.uint16[_+0]=n,this.uint16[_+1]=c,this.uint16[_+2]=h,t}}o.prototype.bytesPerElement=6,Ke("StructArrayLayout3ui6",o);class u extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,c,h,_,v,w,T,P,I,z,j,B,N,q,H,J){const ue=this.length;return this.resize(ue+1),this.emplace(ue,t,n,c,h,_,v,w,T,P,I,z,j,B,N,q,H,J)}emplace(t,n,c,h,_,v,w,T,P,I,z,j,B,N,q,H,J,ue){const ae=24*t,se=12*t,we=48*t;return this.int16[ae+0]=n,this.int16[ae+1]=c,this.uint16[ae+2]=h,this.uint16[ae+3]=_,this.uint32[se+2]=v,this.uint32[se+3]=w,this.uint32[se+4]=T,this.uint16[ae+10]=P,this.uint16[ae+11]=I,this.uint16[ae+12]=z,this.float32[se+7]=j,this.float32[se+8]=B,this.uint8[we+36]=N,this.uint8[we+37]=q,this.uint8[we+38]=H,this.uint32[se+10]=J,this.int16[ae+22]=ue,t}}u.prototype.bytesPerElement=48,Ke("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",u);class d extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,c,h,_,v,w,T,P,I,z,j,B,N,q,H,J,ue,ae,se,we,Me,De,Ze,Be,qe,at,Ue){const Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,t,n,c,h,_,v,w,T,P,I,z,j,B,N,q,H,J,ue,ae,se,we,Me,De,Ze,Be,qe,at,Ue)}emplace(t,n,c,h,_,v,w,T,P,I,z,j,B,N,q,H,J,ue,ae,se,we,Me,De,Ze,Be,qe,at,Ue,Ge){const ze=32*t,dt=16*t;return this.int16[ze+0]=n,this.int16[ze+1]=c,this.int16[ze+2]=h,this.int16[ze+3]=_,this.int16[ze+4]=v,this.int16[ze+5]=w,this.int16[ze+6]=T,this.int16[ze+7]=P,this.uint16[ze+8]=I,this.uint16[ze+9]=z,this.uint16[ze+10]=j,this.uint16[ze+11]=B,this.uint16[ze+12]=N,this.uint16[ze+13]=q,this.uint16[ze+14]=H,this.uint16[ze+15]=J,this.uint16[ze+16]=ue,this.uint16[ze+17]=ae,this.uint16[ze+18]=se,this.uint16[ze+19]=we,this.uint16[ze+20]=Me,this.uint16[ze+21]=De,this.uint16[ze+22]=Ze,this.uint32[dt+12]=Be,this.float32[dt+13]=qe,this.float32[dt+14]=at,this.uint16[ze+30]=Ue,this.uint16[ze+31]=Ge,t}}d.prototype.bytesPerElement=64,Ke("StructArrayLayout8i15ui1ul2f2ui64",d);class y extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}y.prototype.bytesPerElement=4,Ke("StructArrayLayout1f4",y);class x extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,c){const h=this.length;return this.resize(h+1),this.emplace(h,t,n,c)}emplace(t,n,c,h){const _=3*t;return this.uint16[6*t+0]=n,this.float32[_+1]=c,this.float32[_+2]=h,t}}x.prototype.bytesPerElement=12,Ke("StructArrayLayout1ui2f12",x);class S extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,c){const h=this.length;return this.resize(h+1),this.emplace(h,t,n,c)}emplace(t,n,c,h){const _=4*t;return this.uint32[2*t+0]=n,this.uint16[_+2]=c,this.uint16[_+3]=h,t}}S.prototype.bytesPerElement=8,Ke("StructArrayLayout1ul2ui8",S);class k extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const c=this.length;return this.resize(c+1),this.emplace(c,t,n)}emplace(t,n,c){const h=2*t;return this.uint16[h+0]=n,this.uint16[h+1]=c,t}}k.prototype.bytesPerElement=4,Ke("StructArrayLayout2ui4",k);class A extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}A.prototype.bytesPerElement=2,Ke("StructArrayLayout1ui2",A);class E extends ir{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,c,h){const _=this.length;return this.resize(_+1),this.emplace(_,t,n,c,h)}emplace(t,n,c,h,_){const v=4*t;return this.float32[v+0]=n,this.float32[v+1]=c,this.float32[v+2]=h,this.float32[v+3]=_,t}}E.prototype.bytesPerElement=16,Ke("StructArrayLayout4f16",E);class L extends Hs{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new C(this.anchorPointX,this.anchorPointY)}}L.prototype.size=20;class R extends dc{get(t){return new L(this,t)}}Ke("CollisionBoxArray",R);class F extends Hs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}F.prototype.size=48;class U extends u{get(t){return new F(this,t)}}Ke("PlacedSymbolArray",U);class K extends Hs{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}K.prototype.size=64;class X extends d{get(t){return new K(this,t)}}Ke("SymbolInstanceArray",X);class Y extends y{getoffsetX(t){return this.float32[1*t+0]}}Ke("GlyphOffsetArray",Y);class Q extends es{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}Ke("SymbolLineVertexArray",Q);class ie extends Hs{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ie.prototype.size=12;class ee extends x{get(t){return new ie(this,t)}}Ke("TextAnchorOffsetArray",ee);class oe extends Hs{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}oe.prototype.size=8;class le extends S{get(t){return new oe(this,t)}}Ke("FeatureIndexArray",le);class te extends Qo{}class de extends Qo{}class Ce extends Qo{}class be extends ts{}class xe extends fo{}class ke extends Xs{}class Fe extends pc{}class $e extends mo{}class Le extends Qu{}class Qe extends eh{}class Tt extends th{}class Kt extends e{}class nr extends o{}class rr extends k{}const _r=Ar([{name:"a_pos",components:2,type:"Int16"}],4),{members:Sr}=_r;class xt{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,n,c,h){const _=this.segments[this.segments.length-1];return t>xt.MAX_VERTEX_ARRAY_LENGTH&&tr(`Max vertices per segment is ${xt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${xt.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!_||_.vertexLength+t>xt.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==h?this.createNewSegment(n,c,h):_}createNewSegment(t,n,c){const h={vertexOffset:t.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0,vaos:{}};return c!==void 0&&(h.sortKey=c),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(h),h}getOrCreateLatestSegment(t,n,c){return this.prepareSegment(0,t,n,c)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,c,h){return new xt([{vertexOffset:t,primitiveOffset:n,vertexLength:c,primitiveLength:h,vaos:{},sortKey:0}])}}function ar(a,t){return 256*(a=Vt(Math.floor(a),0,255))+Vt(Math.floor(t),0,255)}xt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ke("SegmentVector",xt);const Fr=Ar([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Gr,Yr,Si,_n={exports:{}},ja={exports:{}},Fa={exports:{}},rs=(function(){if(Si)return _n.exports;Si=1;var a=(Gr||(Gr=1,ja.exports=function(n,c){var h,_,v,w,T,P,I,z;for(_=n.length-(h=3&n.length),v=c,T=3432918353,P=461845907,z=0;z<_;)I=255&n.charCodeAt(z)|(255&n.charCodeAt(++z))<<8|(255&n.charCodeAt(++z))<<16|(255&n.charCodeAt(++z))<<24,++z,v=27492+(65535&(w=5*(65535&(v=(v^=I=(65535&(I=(I=(65535&I)*T+(((I>>>16)*T&65535)<<16)&4294967295)<<15|I>>>17))*P+(((I>>>16)*P&65535)<<16)&4294967295)<<13|v>>>19))+((5*(v>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(I=0,h){case 3:I^=(255&n.charCodeAt(z+2))<<16;case 2:I^=(255&n.charCodeAt(z+1))<<8;case 1:v^=I=(65535&(I=(I=(65535&(I^=255&n.charCodeAt(z)))*T+(((I>>>16)*T&65535)<<16)&4294967295)<<15|I>>>17))*P+(((I>>>16)*P&65535)<<16)&4294967295}return v^=n.length,v=2246822507*(65535&(v^=v>>>16))+((2246822507*(v>>>16)&65535)<<16)&4294967295,v=3266489909*(65535&(v^=v>>>13))+((3266489909*(v>>>16)&65535)<<16)&4294967295,(v^=v>>>16)>>>0}),ja.exports),t=(Yr||(Yr=1,Fa.exports=function(n,c){for(var h,_=n.length,v=c^_,w=0;_>=4;)h=1540483477*(65535&(h=255&n.charCodeAt(w)|(255&n.charCodeAt(++w))<<8|(255&n.charCodeAt(++w))<<16|(255&n.charCodeAt(++w))<<24))+((1540483477*(h>>>16)&65535)<<16),v=1540483477*(65535&v)+((1540483477*(v>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),_-=4,++w;switch(_){case 3:v^=(255&n.charCodeAt(w+2))<<16;case 2:v^=(255&n.charCodeAt(w+1))<<8;case 1:v=1540483477*(65535&(v^=255&n.charCodeAt(w)))+((1540483477*(v>>>16)&65535)<<16)}return v=1540483477*(65535&(v^=v>>>13))+((1540483477*(v>>>16)&65535)<<16),(v^=v>>>15)>>>0}),Fa.exports);return _n.exports=a,_n.exports.murmur3=a,_n.exports.murmur2=t,_n.exports})(),is=M(rs);class go{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,n,c,h){this.ids.push(yo(t)),this.positions.push(n,c,h)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=yo(t);let c=0,h=this.ids.length-1;for(;c<h;){const v=c+h>>1;this.ids[v]>=n?h=v:c=v+1}const _=[];for(;this.ids[c]===n;)_.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return _}static serialize(t,n){const c=new Float64Array(t.ids),h=new Uint32Array(t.positions);return Oi(c,h,0,c.length-1),n&&n.push(c.buffer,h.buffer),{ids:c,positions:h}}static deserialize(t){const n=new go;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}function yo(a){const t=+a;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:is(String(a))}function Oi(a,t,n,c){for(;n<c;){const h=a[n+c>>1];let _=n-1,v=c+1;for(;;){do _++;while(a[_]<h);do v--;while(a[v]>h);if(_>=v)break;vn(a,_,v),vn(t,3*_,3*v),vn(t,3*_+1,3*v+1),vn(t,3*_+2,3*v+2)}v-n<c-v?(Oi(a,t,n,v),n=v+1):(Oi(a,t,v+1,c),c=v)}}function vn(a,t,n){const c=a[t];a[t]=a[n],a[n]=c}Ke("FeaturePositionMap",go);class ki{constructor(t,n){this.gl=t.gl,this.location=n}}class Oa extends ki{constructor(t,n){super(t,n),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Or extends ki{constructor(t,n){super(t,n),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Zr extends ki{constructor(t,n){super(t,n),this.current=At.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const nn=new Float32Array(16);function Br(a){return[ar(255*a.r,255*a.g),ar(255*a.b,255*a.a)]}class Ks{constructor(t,n,c){this.value=t,this.uniformNames=n.map((h=>`u_${h}`)),this.type=c}setUniform(t,n,c){t.set(c.constantOr(this.value))}getBinding(t,n,c){return this.type==="color"?new Zr(t,n):new Oa(t,n)}}class ns{constructor(t,n){this.uniformNames=n.map((c=>`u_${c}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=t.tlbr}setUniform(t,n,c,h){const _=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;_&&t.set(_)}getBinding(t,n,c){return c.substr(0,9)==="u_pattern"?new Or(t,n):new Oa(t,n)}}class oa{constructor(t,n,c,h){this.expression=t,this.type=c,this.maxValue=0,this.paintVertexAttributes=n.map((_=>({name:`a_${_}`,type:"Float32",components:c==="color"?2:1,offset:0}))),this.paintVertexArray=new h}populatePaintArray(t,n,c,h,_){const v=this.paintVertexArray.length,w=this.expression.evaluate(new gr(0),n,{},h,[],_);this.paintVertexArray.resize(t),this._setPaintValue(v,t,w)}updatePaintArray(t,n,c,h){const _=this.expression.evaluate({zoom:0},c,h);this._setPaintValue(t,n,_)}_setPaintValue(t,n,c){if(this.type==="color"){const h=Br(c);for(let _=t;_<n;_++)this.paintVertexArray.emplace(_,h[0],h[1])}else{for(let h=t;h<n;h++)this.paintVertexArray.emplace(h,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class bn{constructor(t,n,c,h,_,v){this.expression=t,this.uniformNames=n.map((w=>`u_${w}_t`)),this.type=c,this.useIntegerZoom=h,this.zoom=_,this.maxValue=0,this.paintVertexAttributes=n.map((w=>({name:`a_${w}`,type:"Float32",components:c==="color"?4:2,offset:0}))),this.paintVertexArray=new v}populatePaintArray(t,n,c,h,_){const v=this.expression.evaluate(new gr(this.zoom),n,{},h,[],_),w=this.expression.evaluate(new gr(this.zoom+1),n,{},h,[],_),T=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(T,t,v,w)}updatePaintArray(t,n,c,h){const _=this.expression.evaluate({zoom:this.zoom},c,h),v=this.expression.evaluate({zoom:this.zoom+1},c,h);this._setPaintValue(t,n,_,v)}_setPaintValue(t,n,c,h){if(this.type==="color"){const _=Br(c),v=Br(h);for(let w=t;w<n;w++)this.paintVertexArray.emplace(w,_[0],_[1],v[0],v[1])}else{for(let _=t;_<n;_++)this.paintVertexArray.emplace(_,c,h);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n){const c=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,h=Vt(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);t.set(h)}getBinding(t,n,c){return new Oa(t,n)}}class Ba{constructor(t,n,c,h,_,v){this.expression=t,this.type=n,this.useIntegerZoom=c,this.zoom=h,this.layerId=v,this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(t,n,c){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,n.patterns&&n.patterns[this.layerId],c)}updatePaintArray(t,n,c,h,_){this._setPaintValues(t,n,c.patterns&&c.patterns[this.layerId],_)}_setPaintValues(t,n,c,h){if(!h||!c)return;const{min:_,mid:v,max:w}=c,T=h[_],P=h[v],I=h[w];if(T&&P&&I)for(let z=t;z<n;z++)this.zoomInPaintVertexArray.emplace(z,P.tl[0],P.tl[1],P.br[0],P.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],P.pixelRatio,T.pixelRatio),this.zoomOutPaintVertexArray.emplace(z,P.tl[0],P.tl[1],P.br[0],P.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],P.pixelRatio,I.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Fr.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Fr.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class nd{constructor(t,n,c){this.binders={},this._buffers=[];const h=[];for(const _ in t.paint._values){if(!c(_))continue;const v=t.paint.get(_);if(!(v instanceof Vn&&Ra(v.property.specification)))continue;const w=ad(_,t.type),T=v.value,P=v.property.specification.type,I=v.property.useIntegerZoom,z=v.property.specification["property-type"],j=z==="cross-faded"||z==="cross-faded-data-driven";if(T.kind==="constant")this.binders[_]=j?new ns(T.value,w):new Ks(T.value,w,P),h.push(`/u_${_}`);else if(T.kind==="source"||j){const B=rh(_,P,"source");this.binders[_]=j?new Ba(T,P,I,n,B,t.id):new oa(T,w,P,B),h.push(`/a_${_}`)}else{const B=rh(_,P,"composite");this.binders[_]=new bn(T,w,P,I,n,B),h.push(`/z_${_}`)}}this.cacheKey=h.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof oa||n instanceof bn?n.maxValue:0}populatePaintArrays(t,n,c,h,_){for(const v in this.binders){const w=this.binders[v];(w instanceof oa||w instanceof bn||w instanceof Ba)&&w.populatePaintArray(t,n,c,h,_)}}setConstantPatternPositions(t,n){for(const c in this.binders){const h=this.binders[c];h instanceof ns&&h.setConstantPatternPositions(t,n)}}updatePaintArrays(t,n,c,h,_){let v=!1;for(const w in t){const T=n.getPositions(w);for(const P of T){const I=c.feature(P.index);for(const z in this.binders){const j=this.binders[z];if((j instanceof oa||j instanceof bn||j instanceof Ba)&&j.expression.isStateDependent===!0){const B=h.paint.get(z);j.expression=B.value,j.updatePaintArray(P.start,P.end,I,t[w],_),v=!0}}}}return v}defines(){const t=[];for(const n in this.binders){const c=this.binders[n];(c instanceof Ks||c instanceof ns)&&t.push(...c.uniformNames.map((h=>`#define HAS_UNIFORM_${h}`)))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const c=this.binders[n];if(c instanceof oa||c instanceof bn)for(let h=0;h<c.paintVertexAttributes.length;h++)t.push(c.paintVertexAttributes[h].name);else if(c instanceof Ba)for(let h=0;h<Fr.members.length;h++)t.push(Fr.members[h].name)}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const c=this.binders[n];if(c instanceof Ks||c instanceof ns||c instanceof bn)for(const h of c.uniformNames)t.push(h)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,n){const c=[];for(const h in this.binders){const _=this.binders[h];if(_ instanceof Ks||_ instanceof ns||_ instanceof bn){for(const v of _.uniformNames)if(n[v]){const w=_.getBinding(t,n[v],v);c.push({name:v,property:h,binding:w})}}}return c}setUniforms(t,n,c,h){for(const{name:_,property:v,binding:w}of n)this.binders[v].setUniform(w,h,c.get(v),_)}updatePaintBuffers(t){this._buffers=[];for(const n in this.binders){const c=this.binders[n];if(t&&c instanceof Ba){const h=t.fromScale===2?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(c instanceof oa||c instanceof bn)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}}upload(t){for(const n in this.binders){const c=this.binders[n];(c instanceof oa||c instanceof bn||c instanceof Ba)&&c.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof oa||n instanceof bn||n instanceof Ba)&&n.destroy()}}}class Gi{constructor(t,n,c=()=>!0){this.programConfigurations={};for(const h of t)this.programConfigurations[h.id]=new nd(h,n,c);this.needsUpload=!1,this._featureMap=new go,this._bufferOffset=0}populatePaintArrays(t,n,c,h,_,v){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(t,n,h,_,v);n.id!==void 0&&this._featureMap.add(n.id,c,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,c,h){for(const _ of c)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(t,this._featureMap,n,_,h)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function ad(a,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(`${t}-`,"").replace(/-/g,"_")]}function rh(a,t,n){const c={color:{source:Xs,composite:E},number:{source:y,composite:Xs}},h=(function(_){return{"line-pattern":{source:Fe,composite:Fe},"fill-pattern":{source:Fe,composite:Fe},"fill-extrusion-pattern":{source:Fe,composite:Fe}}[_]})(a);return h&&h[n]||c[t][n]}Ke("ConstantBinder",Ks),Ke("CrossFadedConstantBinder",ns),Ke("SourceExpressionBinder",oa),Ke("CrossFadedCompositeBinder",Ba),Ke("CompositeExpressionBinder",bn),Ke("ProgramConfiguration",nd,{omit:["_buffers"]}),Ke("ProgramConfigurationSet",Gi);const fc=Math.pow(2,14)-1,mc=-fc-1;function $a(a){const t=Ft/a.extent,n=a.loadGeometry();for(let c=0;c<n.length;c++){const h=n[c];for(let _=0;_<h.length;_++){const v=h[_],w=Math.round(v.x*t),T=Math.round(v.y*t);v.x=Vt(w,mc,fc),v.y=Vt(T,mc,fc),(w<v.x||w>v.x+1||T<v.y||T>v.y+1)&&tr("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function sa(a,t){return{type:a.type,id:a.id,properties:a.properties,geometry:t?$a(a):[]}}const I0=-32768;function _2(a,t,n,c,h){a.emplaceBack(I0+8*t+c,I0+8*n+h)}class gm{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new de,this.indexArray=new nr,this.segments=new xt,this.programConfigurations=new Gi(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,c){const h=this.layers[0],_=[];let v=null,w=!1,T=h.type==="heatmap";if(h.type==="circle"){const I=h;v=I.layout.get("circle-sort-key"),w=!v.isConstant(),T=T||I.paint.get("circle-pitch-alignment")==="map"}const P=T?n.subdivisionGranularity.circle:1;for(const{feature:I,id:z,index:j,sourceLayerIndex:B}of t){const N=this.layers[0]._featureFilter.needGeometry,q=sa(I,N);if(!this.layers[0]._featureFilter.filter(new gr(this.zoom,{globalState:this.globalState}),q,c))continue;const H=w?v.evaluate(q,{},c):void 0,J={id:z,properties:I.properties,type:I.type,sourceLayerIndex:B,index:j,geometry:N?q.geometry:$a(I),patterns:{},sortKey:H};_.push(J)}w&&_.sort(((I,z)=>I.sortKey-z.sortKey));for(const I of _){const{geometry:z,index:j,sourceLayerIndex:B}=I,N=t[j].feature;this.addFeature(I,z,j,c,P),n.featureIndex.insert(N,z,j,B,this.index)}}update(t,n,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Sr),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,c,h,_=1){let v;switch(_){case 1:v=[0,7];break;case 3:v=[0,2,5,7];break;case 5:v=[0,1,3,4,6,7];break;case 7:v=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${_}; valid values are 1, 3, 5, 7.`)}const w=v.length;for(const T of n)for(const P of T){const I=P.x,z=P.y;if(I<0||I>=Ft||z<0||z>=Ft)continue;const j=this.segments.prepareSegment(w*w,this.layoutVertexArray,this.indexArray,t.sortKey),B=j.vertexLength;for(let N=0;N<w;N++)for(let q=0;q<w;q++)_2(this.layoutVertexArray,I,z,v[q],v[N]);for(let N=0;N<w-1;N++)for(let q=0;q<w-1;q++){const H=B+N*w+q,J=B+(N+1)*w+q;this.indexArray.emplaceBack(H,J+1,H+1),this.indexArray.emplaceBack(H,J,J+1)}j.vertexLength+=w*w,j.primitiveLength+=(w-1)*(w-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,{},h)}}function E0(a,t){for(let n=0;n<a.length;n++)if(gc(t,a[n]))return!0;for(let n=0;n<t.length;n++)if(gc(a,t[n]))return!0;return!!ym(a,t)}function v2(a,t,n){return!!gc(a,t)||!!_m(t,a,n)}function z0(a,t){if(a.length===1)return L0(t,a[0]);for(let n=0;n<t.length;n++){const c=t[n];for(let h=0;h<c.length;h++)if(gc(a,c[h]))return!0}for(let n=0;n<a.length;n++)if(L0(t,a[n]))return!0;for(let n=0;n<t.length;n++)if(ym(a,t[n]))return!0;return!1}function b2(a,t,n){if(a.length>1){if(ym(a,t))return!0;for(let c=0;c<t.length;c++)if(_m(t[c],a,n))return!0}for(let c=0;c<a.length;c++)if(_m(a[c],t,n))return!0;return!1}function ym(a,t){if(a.length===0||t.length===0)return!1;for(let n=0;n<a.length-1;n++){const c=a[n],h=a[n+1];for(let _=0;_<t.length-1;_++)if(x2(c,h,t[_],t[_+1]))return!0}return!1}function x2(a,t,n,c){return Ur(a,n,c)!==Ur(t,n,c)&&Ur(a,t,n)!==Ur(a,t,c)}function _m(a,t,n){const c=n*n;if(t.length===1)return a.distSqr(t[0])<c;for(let h=1;h<t.length;h++)if(R0(a,t[h-1],t[h])<c)return!0;return!1}function R0(a,t,n){const c=t.distSqr(n);if(c===0)return a.distSqr(t);const h=((a.x-t.x)*(n.x-t.x)+(a.y-t.y)*(n.y-t.y))/c;return a.distSqr(h<0?t:h>1?n:n.sub(t)._mult(h)._add(t))}function L0(a,t){let n,c,h,_=!1;for(let v=0;v<a.length;v++){n=a[v];for(let w=0,T=n.length-1;w<n.length;T=w++)c=n[w],h=n[T],c.y>t.y!=h.y>t.y&&t.x<(h.x-c.x)*(t.y-c.y)/(h.y-c.y)+c.x&&(_=!_)}return _}function gc(a,t){let n=!1;for(let c=0,h=a.length-1;c<a.length;h=c++){const _=a[c],v=a[h];_.y>t.y!=v.y>t.y&&t.x<(v.x-_.x)*(t.y-_.y)/(v.y-_.y)+_.x&&(n=!n)}return n}function w2(a,t,n){const c=n[0],h=n[2];if(a.x<c.x&&t.x<c.x||a.x>h.x&&t.x>h.x||a.y<c.y&&t.y<c.y||a.y>h.y&&t.y>h.y)return!1;const _=Ur(a,t,n[0]);return _!==Ur(a,t,n[1])||_!==Ur(a,t,n[2])||_!==Ur(a,t,n[3])}function ih(a,t,n){const c=t.paint.get(a).value;return c.kind==="constant"?c.value:n.programConfigurations.get(t.id).getMaxValue(a)}function od(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function sd(a,t,n,c,h){if(!t[0]&&!t[1])return a;const _=C.convert(t)._mult(h);n==="viewport"&&_._rotate(-c);const v=[];for(let w=0;w<a.length;w++)v.push(a[w].sub(_));return v}let D0,j0;Ke("CircleBucket",gm,{omit:["layers"]});var T2={get paint(){return j0=j0||new Ti({"circle-radius":new ht(ge.paint_circle["circle-radius"]),"circle-color":new ht(ge.paint_circle["circle-color"]),"circle-blur":new ht(ge.paint_circle["circle-blur"]),"circle-opacity":new ht(ge.paint_circle["circle-opacity"]),"circle-translate":new rt(ge.paint_circle["circle-translate"]),"circle-translate-anchor":new rt(ge.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new rt(ge.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new rt(ge.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ht(ge.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ht(ge.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ht(ge.paint_circle["circle-stroke-opacity"])})},get layout(){return D0=D0||new Ti({"circle-sort-key":new ht(ge.layout_circle["circle-sort-key"])})}};class S2 extends rn{constructor(t){super(t,T2)}createBucket(t){return new gm(t)}queryRadius(t){const n=t;return ih("circle-radius",this,n)+ih("circle-stroke-width",this,n)+od(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:c,geometry:h,transform:_,pixelsToTileUnits:v,unwrappedTileID:w,getElevation:T}){const P=sd(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-_.bearingInRadians,v),I=this.paint.get("circle-radius").evaluate(n,c)+this.paint.get("circle-stroke-width").evaluate(n,c),z=this.paint.get("circle-pitch-alignment")==="map",j=z?P:(function(N,q,H,J){return N.map((ue=>F0(ue,q,H,J)))})(P,_,w,T),B=z?I*v:I;for(const N of h)for(const q of N){const H=z?q:F0(q,_,w,T);let J=B;const ue=_.projectTileCoordinates(q.x,q.y,w,T).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?J*=ue/_.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(J*=_.cameraToCenterDistance/ue),v2(j,H,J))return!0}return!1}}function F0(a,t,n,c){const h=t.projectTileCoordinates(a.x,a.y,n,c).point;return new C((.5*h.x+.5)*t.width,(.5*-h.y+.5)*t.height)}class O0 extends gm{}let B0;Ke("HeatmapBucket",O0,{omit:["layers"]});var k2={get paint(){return B0=B0||new Ti({"heatmap-radius":new ht(ge.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ht(ge.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new rt(ge.paint_heatmap["heatmap-intensity"]),"heatmap-color":new uc(ge.paint_heatmap["heatmap-color"]),"heatmap-opacity":new rt(ge.paint_heatmap["heatmap-opacity"])})}};function vm(a,{width:t,height:n},c,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==t*n*c)throw new RangeError(`mismatched image size. expected: ${h.length} but got: ${t*n*c}`)}else h=new Uint8Array(t*n*c);return a.width=t,a.height=n,a.data=h,a}function $0(a,{width:t,height:n},c){if(t===a.width&&n===a.height)return;const h=vm({},{width:t,height:n},c);bm(a,h,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,t),height:Math.min(a.height,n)},c),a.width=t,a.height=n,a.data=h.data}function bm(a,t,n,c,h,_){if(h.width===0||h.height===0)return t;if(h.width>a.width||h.height>a.height||n.x>a.width-h.width||n.y>a.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>t.width||h.height>t.height||c.x>t.width-h.width||c.y>t.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const v=a.data,w=t.data;if(v===w)throw new Error("srcData equals dstData, so image is already copied");for(let T=0;T<h.height;T++){const P=((n.y+T)*a.width+n.x)*_,I=((c.y+T)*t.width+c.x)*_;for(let z=0;z<h.width*_;z++)w[I+z]=v[P+z]}return t}class nh{constructor(t,n){vm(this,t,1,n)}resize(t){$0(this,t,1)}clone(){return new nh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,c,h,_){bm(t,n,c,h,_,1)}}class Zi{constructor(t,n){vm(this,t,4,n)}resize(t){$0(this,t,4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Zi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,c,h,_){bm(t,n,c,h,_,4)}setPixel(t,n,c){const h=4*(t*this.width+n);this.data[h+0]=Math.round(255*c.r/c.a),this.data[h+1]=Math.round(255*c.g/c.a),this.data[h+2]=Math.round(255*c.b/c.a),this.data[h+3]=Math.round(255*c.a)}}function N0(a){const t={},n=a.resolution||256,c=a.clips?a.clips.length:1,h=a.image||new Zi({width:n,height:c});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const _=(v,w,T)=>{t[a.evaluationKey]=T;const P=a.expression.evaluate(t);h.setPixel(v/4/n,w/4,P)};if(a.clips)for(let v=0,w=0;v<c;++v,w+=4*n)for(let T=0,P=0;T<n;T++,P+=4){const I=T/(n-1),{start:z,end:j}=a.clips[v];_(w,P,z*(1-I)+j*I)}else for(let v=0,w=0;v<n;v++,w+=4)_(0,w,v/(n-1));return h}Ke("AlphaImage",nh),Ke("RGBAImage",Zi);const xm="big-fb";class C2 extends rn{createBucket(t){return new O0(t)}constructor(t){super(t,k2),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=N0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(xm)&&this.heatmapFbos.delete(xm)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let U0;var P2={get paint(){return U0=U0||new Ti({"hillshade-illumination-direction":new rt(ge.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new rt(ge.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new rt(ge.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new rt(ge.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new rt(ge.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new rt(ge.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new rt(ge.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new rt(ge.paint_hillshade["hillshade-method"])})}};class M2 extends rn{constructor(t){super(t,P2),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,n=this.paint.get("hillshade-illumination-altitude").values,c=this.paint.get("hillshade-highlight-color").values,h=this.paint.get("hillshade-shadow-color").values;const _=Math.max(t.length,n.length,c.length,h.length);t=t.concat(Array(_-t.length).fill(t.at(-1))),n=n.concat(Array(_-n.length).fill(n.at(-1))),c=c.concat(Array(_-c.length).fill(c.at(-1))),h=h.concat(Array(_-h.length).fill(h.at(-1)));const v=n.map(Ka);return{directionRadians:t.map(Ka),altitudeRadians:v,shadowColor:h,highlightColor:c}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let V0;var A2={get paint(){return V0=V0||new Ti({"color-relief-opacity":new rt(ge["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new uc(ge["paint_color-relief"]["color-relief-color"])})}};class wm{constructor(t,n,c,h){this.context=t,this.format=c,this.texture=t.gl.createTexture(),this.update(n,h)}update(t,n,c){const{width:h,height:_}=t,v=!(this.size&&this.size[0]===h&&this.size[1]===_||c),{context:w}=this,{gl:T}=w;if(this.useMipmap=!!(n&&n.useMipmap),T.bindTexture(T.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!n||n.premultiply!==!1)),v)this.size=[h,_],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||jn(t)?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,t):T.texImage2D(T.TEXTURE_2D,0,this.format,h,_,0,this.format,T.UNSIGNED_BYTE,t.data);else{const{x:P,y:I}=c||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||jn(t)?T.texSubImage2D(T.TEXTURE_2D,0,P,I,T.RGBA,T.UNSIGNED_BYTE,t):T.texSubImage2D(T.TEXTURE_2D,0,P,I,h,_,T.RGBA,T.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&T.generateMipmap(T.TEXTURE_2D),w.pixelStoreUnpackFlipY.setDefault(),w.pixelStoreUnpack.setDefault(),w.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,n,c){const{context:h}=this,{gl:_}=h;_.bindTexture(_.TEXTURE_2D,this.texture),c!==_.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(c=_.LINEAR),t!==this.filter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,t),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,c||t),this.filter=t),n!==this.wrap&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,n),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class q0{constructor(t,n,c,h=1,_=1,v=1,w=0){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(c&&!["mapbox","terrarium","custom"].includes(c))return void tr(`"${c}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const T=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),c){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=h,this.greenFactor=_,this.blueFactor=v,this.baseShift=w;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let P=0;P<T;P++)this.data[this._idx(-1,P)]=this.data[this._idx(0,P)],this.data[this._idx(T,P)]=this.data[this._idx(T-1,P)],this.data[this._idx(P,-1)]=this.data[this._idx(P,0)],this.data[this._idx(P,T)]=this.data[this._idx(P,T-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(T,-1)]=this.data[this._idx(T-1,0)],this.data[this._idx(-1,T)]=this.data[this._idx(0,T-1)],this.data[this._idx(T,T)]=this.data[this._idx(T-1,T-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let P=0;P<T;P++)for(let I=0;I<T;I++){const z=this.get(P,I);z>this.max&&(this.max=z),z<this.min&&(this.min=z)}}get(t,n){const c=new Uint8Array(this.data.buffer),h=4*this._idx(t,n);return this.unpack(c[h],c[h+1],c[h+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}unpack(t,n,c){return t*this.redFactor+n*this.greenFactor+c*this.blueFactor-this.baseShift}pack(t){return G0(t,this.getUnpackVector())}getPixels(){return new Zi({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,n,c){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let h=n*this.dim,_=n*this.dim+this.dim,v=c*this.dim,w=c*this.dim+this.dim;switch(n){case-1:h=_-1;break;case 1:_=h+1}switch(c){case-1:v=w-1;break;case 1:w=v+1}const T=-n*this.dim,P=-c*this.dim;for(let I=v;I<w;I++)for(let z=h;z<_;z++)this.data[this._idx(z,I)]=t.data[this._idx(z+T,I+P)]}}function G0(a,t){const n=t[0],c=t[1],h=t[2],_=t[3],v=Math.min(n,c,h),w=Math.round((a+_)/v);return{r:Math.floor(w*v/n)%256,g:Math.floor(w*v/c)%256,b:Math.floor(w*v/h)%256}}Ke("DEMData",q0);class I2 extends rn{constructor(t){super(t,A2)}_createColorRamp(t){const n={elevationStops:[],colorStops:[]},c=this._transitionablePaint._values["color-relief-color"].value.expression;if(c instanceof $s&&c._styleExpression.expression instanceof ai){this.colorRampExpression=c;const v=c._styleExpression.expression;n.elevationStops=v.labels,n.colorStops=[];for(const w of n.elevationStops)n.colorStops.push(v.evaluate({globals:{elevation:w}}))}if(n.elevationStops.length<1&&(n.elevationStops=[0],n.colorStops=[At.transparent]),n.elevationStops.length<2&&(n.elevationStops.push(n.elevationStops[0]+1),n.colorStops.push(n.colorStops[0])),n.elevationStops.length<=t)return n;const h={elevationStops:[],colorStops:[]},_=(n.elevationStops.length-1)/(t-1);for(let v=0;v<n.elevationStops.length-.5;v+=_)h.elevationStops.push(n.elevationStops[Math.round(v)]),h.colorStops.push(n.colorStops[Math.round(v)]);return tr(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),h}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(t,n,c){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const h=this._createColorRamp(n),_=new Zi({width:h.colorStops.length,height:1}),v=new Zi({width:h.colorStops.length,height:1});for(let w=0;w<h.elevationStops.length;w++){const T=G0(h.elevationStops[w],c);v.setPixel(0,w,new At(T.r/255,T.g/255,T.b/255,1)),_.setPixel(0,w,h.colorStops[w])}return this.colorRampTextures={elevationTexture:new wm(t,v,t.gl.RGBA),colorTexture:new wm(t,_,t.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const E2=Ar([{name:"a_pos",components:2,type:"Int16"}],4),{members:z2}=E2;function Tm(a,t,n){const c=n.patternDependencies;let h=!1;for(const _ of t){const v=_.paint.get(`${a}-pattern`);v.isConstant()||(h=!0);const w=v.constantOr(null);w&&(h=!0,c[w.to]=!0,c[w.from]=!0)}return h}function Sm(a,t,n,c,h){const _=h.patternDependencies;for(const v of t){const w=v.paint.get(`${a}-pattern`).value;if(w.kind!=="constant"){let T=w.evaluate({zoom:c-1},n,{},h.availableImages),P=w.evaluate({zoom:c},n,{},h.availableImages),I=w.evaluate({zoom:c+1},n,{},h.availableImages);T=T&&T.name?T.name:T,P=P&&P.name?P.name:P,I=I&&I.name?I.name:I,_[T]=!0,_[P]=!0,_[I]=!0,n.patterns[v.id]={min:T,mid:P,max:I}}}return n}function Z0(a,t,n,c,h){let _;if(h===(function(v,w,T,P){let I=0;for(let z=w,j=T-P;z<T;z+=P)I+=(v[j]-v[z])*(v[z+1]+v[j+1]),j=z;return I})(a,t,n,c)>0)for(let v=t;v<n;v+=c)_=K0(v/c|0,a[v],a[v+1],_);else for(let v=n-c;v>=t;v-=c)_=K0(v/c|0,a[v],a[v+1],_);return _&&yc(_,_.next)&&(lh(_),_=_.next),_}function Ys(a,t){if(!a)return a;t||(t=a);let n,c=a;do if(n=!1,c.steiner||!yc(c,c.next)&&Rr(c.prev,c,c.next)!==0)c=c.next;else{if(lh(c),c=t=c.prev,c===c.next)break;n=!0}while(n||c!==t);return t}function ah(a,t,n,c,h,_,v){if(!a)return;!v&&_&&(function(T,P,I,z){let j=T;do j.z===0&&(j.z=km(j.x,j.y,P,I,z)),j.prevZ=j.prev,j.nextZ=j.next,j=j.next;while(j!==T);j.prevZ.nextZ=null,j.prevZ=null,(function(B){let N,q=1;do{let H,J=B;B=null;let ue=null;for(N=0;J;){N++;let ae=J,se=0;for(let Me=0;Me<q&&(se++,ae=ae.nextZ,ae);Me++);let we=q;for(;se>0||we>0&&ae;)se!==0&&(we===0||!ae||J.z<=ae.z)?(H=J,J=J.nextZ,se--):(H=ae,ae=ae.nextZ,we--),ue?ue.nextZ=H:B=H,H.prevZ=ue,ue=H;J=ae}ue.nextZ=null,q*=2}while(N>1)})(j)})(a,c,h,_);let w=a;for(;a.prev!==a.next;){const T=a.prev,P=a.next;if(_?L2(a,c,h,_):R2(a))t.push(T.i,a.i,P.i),lh(a),a=P.next,w=P.next;else if((a=P)===w){v?v===1?ah(a=D2(Ys(a),t),t,n,c,h,_,2):v===2&&j2(a,t,n,c,h,_):ah(Ys(a),t,n,c,h,_,1);break}}}function R2(a){const t=a.prev,n=a,c=a.next;if(Rr(t,n,c)>=0)return!1;const h=t.x,_=n.x,v=c.x,w=t.y,T=n.y,P=c.y,I=Math.min(h,_,v),z=Math.min(w,T,P),j=Math.max(h,_,v),B=Math.max(w,T,P);let N=c.next;for(;N!==t;){if(N.x>=I&&N.x<=j&&N.y>=z&&N.y<=B&&oh(h,w,_,T,v,P,N.x,N.y)&&Rr(N.prev,N,N.next)>=0)return!1;N=N.next}return!0}function L2(a,t,n,c){const h=a.prev,_=a,v=a.next;if(Rr(h,_,v)>=0)return!1;const w=h.x,T=_.x,P=v.x,I=h.y,z=_.y,j=v.y,B=Math.min(w,T,P),N=Math.min(I,z,j),q=Math.max(w,T,P),H=Math.max(I,z,j),J=km(B,N,t,n,c),ue=km(q,H,t,n,c);let ae=a.prevZ,se=a.nextZ;for(;ae&&ae.z>=J&&se&&se.z<=ue;){if(ae.x>=B&&ae.x<=q&&ae.y>=N&&ae.y<=H&&ae!==h&&ae!==v&&oh(w,I,T,z,P,j,ae.x,ae.y)&&Rr(ae.prev,ae,ae.next)>=0||(ae=ae.prevZ,se.x>=B&&se.x<=q&&se.y>=N&&se.y<=H&&se!==h&&se!==v&&oh(w,I,T,z,P,j,se.x,se.y)&&Rr(se.prev,se,se.next)>=0))return!1;se=se.nextZ}for(;ae&&ae.z>=J;){if(ae.x>=B&&ae.x<=q&&ae.y>=N&&ae.y<=H&&ae!==h&&ae!==v&&oh(w,I,T,z,P,j,ae.x,ae.y)&&Rr(ae.prev,ae,ae.next)>=0)return!1;ae=ae.prevZ}for(;se&&se.z<=ue;){if(se.x>=B&&se.x<=q&&se.y>=N&&se.y<=H&&se!==h&&se!==v&&oh(w,I,T,z,P,j,se.x,se.y)&&Rr(se.prev,se,se.next)>=0)return!1;se=se.nextZ}return!0}function D2(a,t){let n=a;do{const c=n.prev,h=n.next.next;!yc(c,h)&&H0(c,n,n.next,h)&&sh(c,h)&&sh(h,c)&&(t.push(c.i,n.i,h.i),lh(n),lh(n.next),n=a=h),n=n.next}while(n!==a);return Ys(n)}function j2(a,t,n,c,h,_){let v=a;do{let w=v.next.next;for(;w!==v.prev;){if(v.i!==w.i&&N2(v,w)){let T=X0(v,w);return v=Ys(v,v.next),T=Ys(T,T.next),ah(v,t,n,c,h,_,0),void ah(T,t,n,c,h,_,0)}w=w.next}v=v.next}while(v!==a)}function F2(a,t){let n=a.x-t.x;return n===0&&(n=a.y-t.y,n===0)&&(n=(a.next.y-a.y)/(a.next.x-a.x)-(t.next.y-t.y)/(t.next.x-t.x)),n}function O2(a,t){const n=(function(h,_){let v=_;const w=h.x,T=h.y;let P,I=-1/0;if(yc(h,v))return v;do{if(yc(h,v.next))return v.next;if(T<=v.y&&T>=v.next.y&&v.next.y!==v.y){const q=v.x+(T-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(q<=w&&q>I&&(I=q,P=v.x<v.next.x?v:v.next,q===w))return P}v=v.next}while(v!==_);if(!P)return null;const z=P,j=P.x,B=P.y;let N=1/0;v=P;do{if(w>=v.x&&v.x>=j&&w!==v.x&&W0(T<B?w:I,T,j,B,T<B?I:w,T,v.x,v.y)){const q=Math.abs(T-v.y)/(w-v.x);sh(v,h)&&(q<N||q===N&&(v.x>P.x||v.x===P.x&&B2(P,v)))&&(P=v,N=q)}v=v.next}while(v!==z);return P})(a,t);if(!n)return t;const c=X0(n,a);return Ys(c,c.next),Ys(n,n.next)}function B2(a,t){return Rr(a.prev,a,t.prev)<0&&Rr(t.next,a,a.next)<0}function km(a,t,n,c,h){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-n)*h|0)|a<<8))|a<<4))|a<<2))|a<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-c)*h|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function $2(a){let t=a,n=a;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==a);return n}function W0(a,t,n,c,h,_,v,w){return(h-v)*(t-w)>=(a-v)*(_-w)&&(a-v)*(c-w)>=(n-v)*(t-w)&&(n-v)*(_-w)>=(h-v)*(c-w)}function oh(a,t,n,c,h,_,v,w){return!(a===v&&t===w)&&W0(a,t,n,c,h,_,v,w)}function N2(a,t){return a.next.i!==t.i&&a.prev.i!==t.i&&!(function(n,c){let h=n;do{if(h.i!==n.i&&h.next.i!==n.i&&h.i!==c.i&&h.next.i!==c.i&&H0(h,h.next,n,c))return!0;h=h.next}while(h!==n);return!1})(a,t)&&(sh(a,t)&&sh(t,a)&&(function(n,c){let h=n,_=!1;const v=(n.x+c.x)/2,w=(n.y+c.y)/2;do h.y>w!=h.next.y>w&&h.next.y!==h.y&&v<(h.next.x-h.x)*(w-h.y)/(h.next.y-h.y)+h.x&&(_=!_),h=h.next;while(h!==n);return _})(a,t)&&(Rr(a.prev,a,t.prev)||Rr(a,t.prev,t))||yc(a,t)&&Rr(a.prev,a,a.next)>0&&Rr(t.prev,t,t.next)>0)}function Rr(a,t,n){return(t.y-a.y)*(n.x-t.x)-(t.x-a.x)*(n.y-t.y)}function yc(a,t){return a.x===t.x&&a.y===t.y}function H0(a,t,n,c){const h=cd(Rr(a,t,n)),_=cd(Rr(a,t,c)),v=cd(Rr(n,c,a)),w=cd(Rr(n,c,t));return h!==_&&v!==w||!(h!==0||!ld(a,n,t))||!(_!==0||!ld(a,c,t))||!(v!==0||!ld(n,a,c))||!(w!==0||!ld(n,t,c))}function ld(a,t,n){return t.x<=Math.max(a.x,n.x)&&t.x>=Math.min(a.x,n.x)&&t.y<=Math.max(a.y,n.y)&&t.y>=Math.min(a.y,n.y)}function cd(a){return a>0?1:a<0?-1:0}function sh(a,t){return Rr(a.prev,a,a.next)<0?Rr(a,t,a.next)>=0&&Rr(a,a.prev,t)>=0:Rr(a,t,a.prev)<0||Rr(a,a.next,t)<0}function X0(a,t){const n=Cm(a.i,a.x,a.y),c=Cm(t.i,t.x,t.y),h=a.next,_=t.prev;return a.next=t,t.prev=a,n.next=h,h.prev=n,c.next=n,n.prev=c,_.next=c,c.prev=_,c}function K0(a,t,n,c){const h=Cm(a,t,n);return c?(h.next=c.next,h.prev=c,c.next.prev=h,c.next=h):(h.prev=h,h.next=h),h}function lh(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Cm(a,t,n){return{i:a,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class _c{constructor(t,n){if(n>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=n}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class ud{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}ud.noSubdivision=new ud({fill:new _c(0,0),line:new _c(0,0),tile:new _c(0,0),stencil:new _c(0,0),circle:1}),Ke("SubdivisionGranularityExpression",_c),Ke("SubdivisionGranularitySetting",ud);const vc=-32768,ch=32767;class U2{constructor(t,n){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=Ft/t,this._canonical=n}_getKey(t,n){return(t+=32768)<<16|n+32768}_vertexToIndex(t,n){if(t<-32768||n<-32768||t>32767||n>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const c=0|Math.round(t),h=0|Math.round(n),_=this._getKey(c,h);if(this._vertexDictionary.has(_))return this._vertexDictionary.get(_);const v=this._vertexBuffer.length/2;return this._vertexDictionary.set(_,v),this._vertexBuffer.push(c,h),v}_subdivideTrianglesScanline(t){if(this._granularity<2)return(function(h,_){const v=[];for(let w=0;w<_.length;w+=3){const T=_[w],P=_[w+1],I=_[w+2],z=h[2*T],j=h[2*T+1];(h[2*P]-z)*(h[2*I+1]-j)-(h[2*P+1]-j)*(h[2*I]-z)>0?(v.push(T),v.push(I),v.push(P)):(v.push(T),v.push(P),v.push(I))}return v})(this._vertexBuffer,t);const n=[],c=t.length;for(let h=0;h<c;h+=3){const _=[t[h+0],t[h+1],t[h+2]],v=[this._vertexBuffer[2*t[h+0]+0],this._vertexBuffer[2*t[h+0]+1],this._vertexBuffer[2*t[h+1]+0],this._vertexBuffer[2*t[h+1]+1],this._vertexBuffer[2*t[h+2]+0],this._vertexBuffer[2*t[h+2]+1]];let w=1/0,T=1/0,P=-1/0,I=-1/0;for(let q=0;q<3;q++){const H=v[2*q],J=v[2*q+1];w=Math.min(w,H),P=Math.max(P,H),T=Math.min(T,J),I=Math.max(I,J)}if(w===P||T===I)continue;const z=Math.floor(w/this._granularityCellSize),j=Math.ceil(P/this._granularityCellSize),B=Math.floor(T/this._granularityCellSize),N=Math.ceil(I/this._granularityCellSize);if(z!==j||B!==N)for(let q=B;q<N;q++){const H=this._scanlineGenerateVertexRingForCellRow(q,v,_);V2(this._vertexBuffer,H,n)}else n.push(..._)}return n}_scanlineGenerateVertexRingForCellRow(t,n,c){const h=t*this._granularityCellSize,_=h+this._granularityCellSize,v=[];for(let w=0;w<3;w++){const T=n[2*w],P=n[2*w+1],I=n[2*(w+1)%6],z=n[(2*(w+1)+1)%6],j=n[2*(w+2)%6],B=n[(2*(w+2)+1)%6],N=I-T,q=z-P,H=N===0,J=q===0,ue=(h-P)/q,ae=(_-P)/q,se=Math.min(ue,ae),we=Math.max(ue,ae);if(!J&&(se>=1||we<=0)||J&&(P<h||P>_)){z>=h&&z<=_&&v.push(c[(w+1)%3]);continue}!J&&se>0&&v.push(this._vertexToIndex(T+N*se,P+q*se));const Me=T+N*Math.max(se,0),De=T+N*Math.min(we,1);H||this._generateIntraEdgeVertices(v,T,P,I,z,Me,De),!J&&we<1&&v.push(this._vertexToIndex(T+N*we,P+q*we)),(J||z>=h&&z<=_)&&v.push(c[(w+1)%3]),!J&&(z<=h||z>=_)&&this._generateInterEdgeVertices(v,T,P,I,z,j,B,De,h,_)}return v}_generateIntraEdgeVertices(t,n,c,h,_,v,w){const T=h-n,P=_-c,I=P===0,z=I?Math.min(n,h):Math.min(v,w),j=I?Math.max(n,h):Math.max(v,w),B=Math.floor(z/this._granularityCellSize)+1,N=Math.ceil(j/this._granularityCellSize)-1;if(I?n<h:v<w)for(let q=B;q<=N;q++){const H=q*this._granularityCellSize;t.push(this._vertexToIndex(H,c+P*(H-n)/T))}else for(let q=N;q>=B;q--){const H=q*this._granularityCellSize;t.push(this._vertexToIndex(H,c+P*(H-n)/T))}}_generateInterEdgeVertices(t,n,c,h,_,v,w,T,P,I){const z=_-c,j=v-h,B=w-_,N=(P-_)/B,q=(I-_)/B,H=Math.min(N,q),J=Math.max(N,q),ue=h+j*H;let ae=Math.floor(Math.min(ue,T)/this._granularityCellSize)+1,se=Math.ceil(Math.max(ue,T)/this._granularityCellSize)-1,we=T<ue;const Me=B===0;if(Me&&(w===P||w===I))return;if(Me||H>=1||J<=0){const Ze=c-w,Be=v+(n-v)*Math.min((P-w)/Ze,(I-w)/Ze);ae=Math.floor(Math.min(Be,T)/this._granularityCellSize)+1,se=Math.ceil(Math.max(Be,T)/this._granularityCellSize)-1,we=T<Be}const De=z>0?I:P;if(we)for(let Ze=ae;Ze<=se;Ze++)t.push(this._vertexToIndex(Ze*this._granularityCellSize,De));else for(let Ze=se;Ze>=ae;Ze--)t.push(this._vertexToIndex(Ze*this._granularityCellSize,De))}_generateOutline(t){const n=[];for(const c of t){const h=Js(c,this._granularity,!0),_=this._pointArrayToIndices(h),v=[];for(let w=1;w<_.length;w++)v.push(_[w-1]),v.push(_[w]);n.push(v)}return n}_handlePoles(t){let n=!1,c=!1;this._canonical&&(this._canonical.y===0&&(n=!0),this._canonical.y===(1<<this._canonical.z)-1&&(c=!0)),(n||c)&&this._fillPoles(t,n,c)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let n=0;n<t.length;n+=2){const c=t[n+1];c===vc&&(t[n+1]=-32767),c===ch&&(t[n+1]=32766)}}_generatePoleQuad(t,n,c,h,_,v){h>_!=(v===vc)?(t.push(n),t.push(c),t.push(this._vertexToIndex(h,v)),t.push(c),t.push(this._vertexToIndex(_,v)),t.push(this._vertexToIndex(h,v))):(t.push(c),t.push(n),t.push(this._vertexToIndex(h,v)),t.push(this._vertexToIndex(_,v)),t.push(c),t.push(this._vertexToIndex(h,v)))}_fillPoles(t,n,c){const h=this._vertexBuffer,_=Ft,v=t.length;for(let w=2;w<v;w+=3){const T=t[w-2],P=t[w-1],I=t[w],z=h[2*T],j=h[2*T+1],B=h[2*P],N=h[2*P+1],q=h[2*I],H=h[2*I+1];n&&(j===0&&N===0&&this._generatePoleQuad(t,T,P,z,B,vc),N===0&&H===0&&this._generatePoleQuad(t,P,I,B,q,vc),H===0&&j===0&&this._generatePoleQuad(t,I,T,q,z,vc)),c&&(j===_&&N===_&&this._generatePoleQuad(t,T,P,z,B,ch),N===_&&H===_&&this._generatePoleQuad(t,P,I,B,q,ch),H===_&&j===_&&this._generatePoleQuad(t,I,T,q,z,ch))}}_initializeVertices(t){for(let n=0;n<t.length;n+=2)this._vertexToIndex(t[n],t[n+1])}subdividePolygonInternal(t,n){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:c,holeIndices:h}=(function(w){const T=[],P=[];for(const I of w)if(I.length!==0){I!==w[0]&&T.push(P.length/2);for(let z=0;z<I.length;z++)P.push(I[z].x),P.push(I[z].y)}return{flattened:P,holeIndices:T}})(t);let _;this._initializeVertices(c);try{const w=(function(P,I,z=2){const j=I&&I.length,B=j?I[0]*z:P.length;let N=Z0(P,0,B,z,!0);const q=[];if(!N||N.next===N.prev)return q;let H,J,ue;if(j&&(N=(function(ae,se,we,Me){const De=[];for(let Ze=0,Be=se.length;Ze<Be;Ze++){const qe=Z0(ae,se[Ze]*Me,Ze<Be-1?se[Ze+1]*Me:ae.length,Me,!1);qe===qe.next&&(qe.steiner=!0),De.push($2(qe))}De.sort(F2);for(let Ze=0;Ze<De.length;Ze++)we=O2(De[Ze],we);return we})(P,I,N,z)),P.length>80*z){H=P[0],J=P[1];let ae=H,se=J;for(let we=z;we<B;we+=z){const Me=P[we],De=P[we+1];Me<H&&(H=Me),De<J&&(J=De),Me>ae&&(ae=Me),De>se&&(se=De)}ue=Math.max(ae-H,se-J),ue=ue!==0?32767/ue:0}return ah(N,q,z,H,J,ue,0),q})(c,h),T=this._convertIndices(c,w);_=this._subdivideTrianglesScanline(T)}catch(w){console.error(w)}let v=[];return n&&(v=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(_),{verticesFlattened:this._vertexBuffer,indicesTriangles:_,indicesLineList:v}}_convertIndices(t,n){const c=[];for(let h=0;h<n.length;h++)c.push(this._vertexToIndex(t[2*n[h]],t[2*n[h]+1]));return c}_pointArrayToIndices(t){const n=[];for(let c=0;c<t.length;c++){const h=t[c];n.push(this._vertexToIndex(h.x,h.y))}return n}}function Y0(a,t,n,c=!0){return new U2(n,t).subdividePolygonInternal(a,c)}function Js(a,t,n=!1){if(!a||a.length<1)return[];if(a.length<2)return[];const c=a[0],h=a[a.length-1],_=n&&(c.x!==h.x||c.y!==h.y);if(t<2)return _?[...a,a[0]]:[...a];const v=Math.floor(Ft/t),w=[];w.push(new C(a[0].x,a[0].y));const T=a.length,P=_?T:T-1;for(let I=0;I<P;I++){const z=a[I],j=I<T-1?a[I+1]:a[0],B=z.x,N=z.y,q=j.x,H=j.y,J=B!==q,ue=N!==H;if(!J&&!ue)continue;const ae=q-B,se=H-N,we=Math.abs(ae),Me=Math.abs(se);let De=B,Ze=N;for(;;){const qe=ae>0?(Math.floor(De/v)+1)*v:(Math.ceil(De/v)-1)*v,at=se>0?(Math.floor(Ze/v)+1)*v:(Math.ceil(Ze/v)-1)*v,Ue=Math.abs(De-qe),Ge=Math.abs(Ze-at),ze=Math.abs(De-q),dt=Math.abs(Ze-H),ft=J?Ue/we:Number.POSITIVE_INFINITY,lt=ue?Ge/Me:Number.POSITIVE_INFINITY;if((ze<=Ue||!J)&&(dt<=Ge||!ue))break;if(ft<lt&&J||!ue){De=qe,Ze+=se*ft;const et=new C(De,Math.round(Ze));w[w.length-1].x===et.x&&w[w.length-1].y===et.y||w.push(et)}else{De+=ae*lt,Ze=at;const et=new C(Math.round(De),Ze);w[w.length-1].x===et.x&&w[w.length-1].y===et.y||w.push(et)}}const Be=new C(q,H);w[w.length-1].x===Be.x&&w[w.length-1].y===Be.y||w.push(Be)}return w}function V2(a,t,n){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let c=0,h=a[2*t[0]];for(let T=1;T<t.length;T++){const P=a[2*t[T]];P<h&&(h=P,c=T)}const _=t.length;let v=c,w=(v+1)%_;for(;;){const T=v-1>=0?v-1:_-1,P=(w+1)%_,I=a[2*t[T]],z=a[2*t[P]],j=a[2*t[v]],B=a[2*t[v]+1],N=a[2*t[w]+1];let q=!1;if(I<z)q=!0;else if(I>z)q=!1;else{const H=N-B,J=-(a[2*t[w]]-j),ue=B<N?1:-1;((I-j)*H+(a[2*t[T]+1]-B)*J)*ue>((z-j)*H+(a[2*t[P]+1]-B)*J)*ue&&(q=!0)}if(q){const H=t[T],J=t[v],ue=t[w];H!==J&&H!==ue&&J!==ue&&n.push(ue,J,H),v--,v<0&&(v=_-1)}else{const H=t[P],J=t[v],ue=t[w];H!==J&&H!==ue&&J!==ue&&n.push(ue,J,H),w++,w>=_&&(w=0)}if(T===P)break}}function J0(a,t,n,c,h,_,v,w,T){const P=h.length/2,I=v&&w&&T;if(P<xt.MAX_VERTEX_ARRAY_LENGTH){const z=t.prepareSegment(P,n,c),j=z.vertexLength;for(let q=0;q<_.length;q+=3)c.emplaceBack(j+_[q],j+_[q+1],j+_[q+2]);let B,N;z.vertexLength+=P,z.primitiveLength+=_.length/3,I&&(N=v.prepareSegment(P,n,w),B=N.vertexLength,N.vertexLength+=P);for(let q=0;q<h.length;q+=2)a(h[q],h[q+1]);if(I)for(let q=0;q<T.length;q++){const H=T[q];for(let J=1;J<H.length;J+=2)w.emplaceBack(B+H[J-1],B+H[J]);N.primitiveLength+=H.length/2}}else(function(z,j,B,N,q,H){const J=[];for(let Me=0;Me<N.length/2;Me++)J.push(-1);const ue={count:0};let ae=0,se=z.getOrCreateLatestSegment(j,B),we=se.vertexLength;for(let Me=2;Me<q.length;Me+=3){const De=q[Me-2],Ze=q[Me-1],Be=q[Me];let qe=J[De]<ae,at=J[Ze]<ae,Ue=J[Be]<ae;se.vertexLength+((qe?1:0)+(at?1:0)+(Ue?1:0))>xt.MAX_VERTEX_ARRAY_LENGTH&&(se=z.createNewSegment(j,B),ae=ue.count,qe=!0,at=!0,Ue=!0,we=0);const Ge=uh(J,N,H,ue,De,qe,se),ze=uh(J,N,H,ue,Ze,at,se),dt=uh(J,N,H,ue,Be,Ue,se);B.emplaceBack(we+Ge-ae,we+ze-ae,we+dt-ae),se.primitiveLength++}})(t,n,c,h,_,a),I&&(function(z,j,B,N,q,H){const J=[];for(let Me=0;Me<N.length/2;Me++)J.push(-1);const ue={count:0};let ae=0,se=z.getOrCreateLatestSegment(j,B),we=se.vertexLength;for(let Me=0;Me<q.length;Me++){const De=q[Me];for(let Ze=1;Ze<q[Me].length;Ze+=2){const Be=De[Ze-1],qe=De[Ze];let at=J[Be]<ae,Ue=J[qe]<ae;se.vertexLength+((at?1:0)+(Ue?1:0))>xt.MAX_VERTEX_ARRAY_LENGTH&&(se=z.createNewSegment(j,B),ae=ue.count,at=!0,Ue=!0,we=0);const Ge=uh(J,N,H,ue,Be,at,se),ze=uh(J,N,H,ue,qe,Ue,se);B.emplaceBack(we+Ge-ae,we+ze-ae),se.primitiveLength++}}})(v,n,w,h,T,a),t.forceNewSegmentOnNextPrepare(),v?.forceNewSegmentOnNextPrepare()}function uh(a,t,n,c,h,_,v){if(_){const w=c.count;return n(t[2*h],t[2*h+1]),a[h]=c.count,c.count++,v.vertexLength++,w}return a[h]}class Pm{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ce,this.indexArray=new nr,this.indexArray2=new rr,this.programConfigurations=new Gi(t.layers,t.zoom),this.segments=new xt,this.segments2=new xt,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,c){this.hasPattern=Tm("fill",this.layers,n);const h=this.layers[0].layout.get("fill-sort-key"),_=!h.isConstant(),v=[];for(const{feature:w,id:T,index:P,sourceLayerIndex:I}of t){const z=this.layers[0]._featureFilter.needGeometry,j=sa(w,z);if(!this.layers[0]._featureFilter.filter(new gr(this.zoom,{globalState:this.globalState}),j,c))continue;const B=_?h.evaluate(j,{},c,n.availableImages):void 0,N={id:T,properties:w.properties,type:w.type,sourceLayerIndex:I,index:P,geometry:z?j.geometry:$a(w),patterns:{},sortKey:B};v.push(N)}_&&v.sort(((w,T)=>w.sortKey-T.sortKey));for(const w of v){const{geometry:T,index:P,sourceLayerIndex:I}=w;if(this.hasPattern){const z=Sm("fill",this.layers,w,this.zoom,n);this.patternFeatures.push(z)}else this.addFeature(w,T,P,c,{},n.subdivisionGranularity);n.featureIndex.insert(t[P].feature,T,P,I,this.index)}}update(t,n,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,c)}addFeatures(t,n,c){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,n,c,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,z2),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,c,h,_,v){for(const w of Ds(n,500)){const T=Y0(w,h,v.fill.getGranularityForZoomLevel(h.z)),P=this.layoutVertexArray;J0(((I,z)=>{P.emplaceBack(I,z)}),this.segments,this.layoutVertexArray,this.indexArray,T.verticesFlattened,T.indicesTriangles,this.segments2,this.indexArray2,T.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,_,h)}}let Q0,e_;Ke("FillBucket",Pm,{omit:["layers","patternFeatures"]});var q2={get paint(){return e_=e_||new Ti({"fill-antialias":new rt(ge.paint_fill["fill-antialias"]),"fill-opacity":new ht(ge.paint_fill["fill-opacity"]),"fill-color":new ht(ge.paint_fill["fill-color"]),"fill-outline-color":new ht(ge.paint_fill["fill-outline-color"]),"fill-translate":new rt(ge.paint_fill["fill-translate"]),"fill-translate-anchor":new rt(ge.paint_fill["fill-translate-anchor"]),"fill-pattern":new cc(ge.paint_fill["fill-pattern"])})},get layout(){return Q0=Q0||new Ti({"fill-sort-key":new ht(ge.layout_fill["fill-sort-key"])})}};class G2 extends rn{constructor(t){super(t,q2)}recalculate(t,n){super.recalculate(t,n);const c=this.paint._values["fill-outline-color"];c.value.kind==="constant"&&c.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Pm(t)}queryRadius(){return od(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:n,transform:c,pixelsToTileUnits:h}){return z0(sd(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-c.bearingInRadians,h),n)}isTileClipped(){return!0}}const Z2=Ar([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),W2=Ar([{name:"a_centroid",components:2,type:"Int16"}],4),{members:H2}=Z2;class bc{constructor(t,n,c,h,_){this.properties={},this.extent=c,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=h,this._values=_,t.readFields(X2,this,n)}loadGeometry(){const t=this._pbf;t.pos=this._geometry;const n=t.readVarint()+t.pos,c=[];let h,_=1,v=0,w=0,T=0;for(;t.pos<n;){if(v<=0){const P=t.readVarint();_=7&P,v=P>>3}if(v--,_===1||_===2)w+=t.readSVarint(),T+=t.readSVarint(),_===1&&(h&&c.push(h),h=[]),h&&h.push(new C(w,T));else{if(_!==7)throw new Error(`unknown command ${_}`);h&&h.push(h[0].clone())}}return h&&c.push(h),c}bbox(){const t=this._pbf;t.pos=this._geometry;const n=t.readVarint()+t.pos;let c=1,h=0,_=0,v=0,w=1/0,T=-1/0,P=1/0,I=-1/0;for(;t.pos<n;){if(h<=0){const z=t.readVarint();c=7&z,h=z>>3}if(h--,c===1||c===2)_+=t.readSVarint(),v+=t.readSVarint(),_<w&&(w=_),_>T&&(T=_),v<P&&(P=v),v>I&&(I=v);else if(c!==7)throw new Error(`unknown command ${c}`)}return[w,P,T,I]}toGeoJSON(t,n,c){const h=this.extent*Math.pow(2,c),_=this.extent*t,v=this.extent*n,w=this.loadGeometry();function T(j){return[360*(j.x+_)/h-180,360/Math.PI*Math.atan(Math.exp((1-2*(j.y+v)/h)*Math.PI))-90]}function P(j){return j.map(T)}let I;if(this.type===1){const j=[];for(const N of w)j.push(N[0]);const B=P(j);I=j.length===1?{type:"Point",coordinates:B[0]}:{type:"MultiPoint",coordinates:B}}else if(this.type===2){const j=w.map(P);I=j.length===1?{type:"LineString",coordinates:j[0]}:{type:"MultiLineString",coordinates:j}}else{if(this.type!==3)throw new Error("unknown feature type");{const j=(function(N){const q=N.length;if(q<=1)return[N];const H=[];let J,ue;for(let ae=0;ae<q;ae++){const se=K2(N[ae]);se!==0&&(ue===void 0&&(ue=se<0),ue===se<0?(J&&H.push(J),J=[N[ae]]):J&&J.push(N[ae]))}return J&&H.push(J),H})(w),B=[];for(const N of j)B.push(N.map(P));I=B.length===1?{type:"Polygon",coordinates:B[0]}:{type:"MultiPolygon",coordinates:B}}}const z={type:"Feature",geometry:I,properties:this.properties};return this.id!=null&&(z.id=this.id),z}}function X2(a,t,n){a===1?t.id=n.readVarint():a===2?(function(c,h){const _=c.readVarint()+c.pos;for(;c.pos<_;){const v=h._keys[c.readVarint()],w=h._values[c.readVarint()];h.properties[v]=w}})(n,t):a===3?t.type=n.readVarint():a===4&&(t._geometry=n.pos)}function K2(a){let t=0;for(let n,c,h=0,_=a.length,v=_-1;h<_;v=h++)n=a[h],c=a[v],t+=(c.x-n.x)*(n.y+c.y);return t}bc.types=["Unknown","Point","LineString","Polygon"];class t_{constructor(t,n){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Y2,this,n),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];const n=this._pbf.readVarint()+this._pbf.pos;return new bc(this._pbf,n,this.extent,this._keys,this._values)}}function Y2(a,t,n){a===15?t.version=n.readVarint():a===1?t.name=n.readString():a===5?t.extent=n.readVarint():a===2?t._features.push(n.pos):a===3?t._keys.push(n.readString()):a===4&&t._values.push((function(c){let h=null;const _=c.readVarint()+c.pos;for(;c.pos<_;){const v=c.readVarint()>>3;h=v===1?c.readString():v===2?c.readFloat():v===3?c.readDouble():v===4?c.readVarint64():v===5?c.readVarint():v===6?c.readSVarint():v===7?c.readBoolean():null}if(h==null)throw new Error("unknown feature value");return h})(n))}class r_{constructor(t,n){this.layers=t.readFields(J2,{},n)}}function J2(a,t,n){if(a===3){const c=new t_(n,n.readVarint()+n.pos);c.length&&(t[c.name]=c)}}const Mm=Math.pow(2,13);function hh(a,t,n,c,h,_,v,w){a.emplaceBack(t,n,2*Math.floor(c*Mm)+v,h*Mm*2,_*Mm*2,Math.round(w))}class Am{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new be,this.centroidVertexArray=new te,this.indexArray=new nr,this.programConfigurations=new Gi(t.layers,t.zoom),this.segments=new xt,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,c){this.features=[],this.hasPattern=Tm("fill-extrusion",this.layers,n);for(const{feature:h,id:_,index:v,sourceLayerIndex:w}of t){const T=this.layers[0]._featureFilter.needGeometry,P=sa(h,T);if(!this.layers[0]._featureFilter.filter(new gr(this.zoom,{globalState:this.globalState}),P,c))continue;const I={id:_,sourceLayerIndex:w,index:v,geometry:T?P.geometry:$a(h),properties:h.properties,type:h.type,patterns:{}};this.hasPattern?this.features.push(Sm("fill-extrusion",this.layers,I,this.zoom,n)):this.addFeature(I,I.geometry,v,c,{},n.subdivisionGranularity),n.featureIndex.insert(h,I.geometry,v,w,this.index,!0)}}addFeatures(t,n,c){for(const h of this.features){const{geometry:_}=h;this.addFeature(h,_,h.index,n,c,t.subdivisionGranularity)}}update(t,n,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,c)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,H2),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,W2.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,n,c,h,_,v){for(const w of Ds(n,500)){const T={x:0,y:0,sampleCount:0},P=this.layoutVertexArray.length;this.processPolygon(T,h,t,w,v);const I=this.layoutVertexArray.length-P,z=Math.floor(T.x/T.sampleCount),j=Math.floor(T.y/T.sampleCount);for(let B=0;B<I;B++)this.centroidVertexArray.emplaceBack(z,j)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,_,h)}processPolygon(t,n,c,h,_){if(h.length<1||i_(h[0]))return;for(const z of h)z.length!==0&&Q2(t,z);const v={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},w=_.fill.getGranularityForZoomLevel(n.z),T=bc.types[c.type]==="Polygon";for(const z of h){if(z.length===0||i_(z))continue;const j=Js(z,w,T);this._generateSideFaces(j,v)}if(!T)return;const P=Y0(h,n,w,!1),I=this.layoutVertexArray;J0(((z,j)=>{hh(I,z,j,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,P.verticesFlattened,P.indicesTriangles)}_generateSideFaces(t,n){let c=0;for(let h=1;h<t.length;h++){const _=t[h],v=t[h-1];if(eT(_,v))continue;n.segment.vertexLength+4>xt.MAX_VERTEX_ARRAY_LENGTH&&(n.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const w=_.sub(v)._perp()._unit(),T=v.dist(_);c+T>32768&&(c=0),hh(this.layoutVertexArray,_.x,_.y,w.x,w.y,0,0,c),hh(this.layoutVertexArray,_.x,_.y,w.x,w.y,0,1,c),c+=T,hh(this.layoutVertexArray,v.x,v.y,w.x,w.y,0,0,c),hh(this.layoutVertexArray,v.x,v.y,w.x,w.y,0,1,c);const P=n.segment.vertexLength;this.indexArray.emplaceBack(P,P+2,P+1),this.indexArray.emplaceBack(P+1,P+2,P+3),n.segment.vertexLength+=4,n.segment.primitiveLength+=2}}}function Q2(a,t){for(let n=0;n<t.length;n++){const c=t[n];n===t.length-1&&t[0].x===c.x&&t[0].y===c.y||(a.x+=c.x,a.y+=c.y,a.sampleCount++)}}function eT(a,t){return a.x===t.x&&(a.x<0||a.x>Ft)||a.y===t.y&&(a.y<0||a.y>Ft)}function i_(a){return a.every((t=>t.x<0))||a.every((t=>t.x>Ft))||a.every((t=>t.y<0))||a.every((t=>t.y>Ft))}let n_;Ke("FillExtrusionBucket",Am,{omit:["layers","features"]});var tT={get paint(){return n_=n_||new Ti({"fill-extrusion-opacity":new rt(ge["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ht(ge["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new rt(ge["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new rt(ge["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new cc(ge["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ht(ge["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ht(ge["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new rt(ge["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class rT extends rn{constructor(t){super(t,tT)}createBucket(t){return new Am(t)}queryRadius(){return od(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:c,geometry:h,transform:_,pixelsToTileUnits:v,pixelPosMatrix:w}){const T=sd(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-_.bearingInRadians,v),P=this.paint.get("fill-extrusion-height").evaluate(n,c),I=this.paint.get("fill-extrusion-base").evaluate(n,c),z=(function(B,N){const q=[];for(const H of B){const J=[H.x,H.y,0,1];hi(J,J,N),q.push(new C(J[0]/J[3],J[1]/J[3]))}return q})(T,w),j=(function(B,N,q,H){const J=[],ue=[],ae=H[8]*N,se=H[9]*N,we=H[10]*N,Me=H[11]*N,De=H[8]*q,Ze=H[9]*q,Be=H[10]*q,qe=H[11]*q;for(const at of B){const Ue=[],Ge=[];for(const ze of at){const dt=ze.x,ft=ze.y,lt=H[0]*dt+H[4]*ft+H[12],et=H[1]*dt+H[5]*ft+H[13],$t=H[2]*dt+H[6]*ft+H[14],kr=H[3]*dt+H[7]*ft+H[15],Wr=$t+we,_i=kr+Me,wn=lt+De,Wi=et+Ze,oi=$t+Be,vr=kr+qe,Qr=new C((lt+ae)/_i,(et+se)/_i);Qr.z=Wr/_i,Ue.push(Qr);const si=new C(wn/vr,Wi/vr);si.z=oi/vr,Ge.push(si)}J.push(Ue),ue.push(Ge)}return[J,ue]})(h,I,P,w);return(function(B,N,q){let H=1/0;z0(q,N)&&(H=a_(q,N[0]));for(let J=0;J<N.length;J++){const ue=N[J],ae=B[J];for(let se=0;se<ue.length-1;se++){const we=ue[se],Me=[we,ue[se+1],ae[se+1],ae[se],we];E0(q,Me)&&(H=Math.min(H,a_(q,Me)))}}return H!==1/0&&H})(j[0],j[1],z)}}function ph(a,t){return a.x*t.x+a.y*t.y}function a_(a,t){if(a.length===1){let n=0;const c=t[n++];let h;for(;!h||c.equals(h);)if(h=t[n++],!h)return 1/0;for(;n<t.length;n++){const _=t[n],v=a[0],w=h.sub(c),T=_.sub(c),P=v.sub(c),I=ph(w,w),z=ph(w,T),j=ph(T,T),B=ph(P,w),N=ph(P,T),q=I*j-z*z,H=(j*B-z*N)/q,J=(I*N-z*B)/q,ue=c.z*(1-H-J)+h.z*H+_.z*J;if(isFinite(ue))return ue}return 1/0}{let n=1/0;for(const c of t)n=Math.min(n,c.z);return n}}const iT=Ar([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:nT}=iT,aT=Ar([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:oT}=aT,sT=Math.cos(Math.PI/180*37.5),o_=Math.pow(2,14)/.5;class Im{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((n=>{this.gradients[n.id]={}})),this.layoutVertexArray=new xe,this.layoutVertexArray2=new ke,this.indexArray=new nr,this.programConfigurations=new Gi(t.layers,t.zoom),this.segments=new xt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(t,n,c){this.hasPattern=Tm("line",this.layers,n);const h=this.layers[0].layout.get("line-sort-key"),_=!h.isConstant(),v=[];for(const{feature:w,id:T,index:P,sourceLayerIndex:I}of t){const z=this.layers[0]._featureFilter.needGeometry,j=sa(w,z);if(!this.layers[0]._featureFilter.filter(new gr(this.zoom,{globalState:this.globalState}),j,c))continue;const B=_?h.evaluate(j,{},c):void 0,N={id:T,properties:w.properties,type:w.type,sourceLayerIndex:I,index:P,geometry:z?j.geometry:$a(w),patterns:{},sortKey:B};v.push(N)}_&&v.sort(((w,T)=>w.sortKey-T.sortKey));for(const w of v){const{geometry:T,index:P,sourceLayerIndex:I}=w;if(this.hasPattern){const z=Sm("line",this.layers,w,this.zoom,n);this.patternFeatures.push(z)}else this.addFeature(w,T,P,c,{},n.subdivisionGranularity);n.featureIndex.insert(t[P].feature,T,P,I,this.index)}}update(t,n,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,c)}addFeatures(t,n,c){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,n,c,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,oT)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,nT),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,c,h,_,v){const w=this.layers[0].layout,T=w.get("line-join").evaluate(t,{}),P=w.get("line-cap"),I=w.get("line-miter-limit"),z=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const j of n)this.addLine(j,t,T,P,I,z,h,v);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,c,_,h)}addLine(t,n,c,h,_,v,w,T){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=Js(t,w?T.line.getGranularityForZoomLevel(w.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ae=0;ae<t.length-1;ae++)this.totalDistance+=t[ae].dist(t[ae+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const P=bc.types[n.type]==="Polygon";let I=t.length;for(;I>=2&&t[I-1].equals(t[I-2]);)I--;let z=0;for(;z<I-1&&t[z].equals(t[z+1]);)z++;if(I<(P?3:2))return;c==="bevel"&&(_=1.05);const j=this.overscaling<=16?122880/(512*this.overscaling):0,B=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray);let N,q,H,J,ue;this.e1=this.e2=-1,P&&(N=t[I-2],ue=t[z].sub(N)._unit()._perp());for(let ae=z;ae<I;ae++){if(H=ae===I-1?P?t[z+1]:void 0:t[ae+1],H&&t[ae].equals(H))continue;ue&&(J=ue),N&&(q=N),N=t[ae],ue=H?H.sub(N)._unit()._perp():J,J=J||ue;let se=J.add(ue);se.x===0&&se.y===0||se._unit();const we=J.x*ue.x+J.y*ue.y,Me=se.x*ue.x+se.y*ue.y,De=Me!==0?1/Me:1/0,Ze=2*Math.sqrt(2-2*Me),Be=Me<sT&&q&&H,qe=J.x*ue.y-J.y*ue.x>0;if(Be&&ae>z){const Ge=N.dist(q);if(Ge>2*j){const ze=N.sub(N.sub(q)._mult(j/Ge)._round());this.updateDistance(q,ze),this.addCurrentVertex(ze,J,0,0,B),q=ze}}const at=q&&H;let Ue=at?c:P?"butt":h;if(at&&Ue==="round"&&(De<v?Ue="miter":De<=2&&(Ue="fakeround")),Ue==="miter"&&De>_&&(Ue="bevel"),Ue==="bevel"&&(De>2&&(Ue="flipbevel"),De<_&&(Ue="miter")),q&&this.updateDistance(q,N),Ue==="miter")se._mult(De),this.addCurrentVertex(N,se,0,0,B);else if(Ue==="flipbevel"){if(De>100)se=ue.mult(-1);else{const Ge=De*J.add(ue).mag()/J.sub(ue).mag();se._perp()._mult(Ge*(qe?-1:1))}this.addCurrentVertex(N,se,0,0,B),this.addCurrentVertex(N,se.mult(-1),0,0,B)}else if(Ue==="bevel"||Ue==="fakeround"){const Ge=-Math.sqrt(De*De-1),ze=qe?Ge:0,dt=qe?0:Ge;if(q&&this.addCurrentVertex(N,J,ze,dt,B),Ue==="fakeround"){const ft=Math.round(180*Ze/Math.PI/20);for(let lt=1;lt<ft;lt++){let et=lt/ft;if(et!==.5){const kr=et-.5;et+=et*kr*(et-1)*((1.0904+we*(we*(3.55645-1.43519*we)-3.2452))*kr*kr+(.848013+we*(.215638*we-1.06021)))}const $t=ue.sub(J)._mult(et)._add(J)._unit()._mult(qe?-1:1);this.addHalfVertex(N,$t.x,$t.y,!1,qe,0,B)}}H&&this.addCurrentVertex(N,ue,-ze,-dt,B)}else if(Ue==="butt")this.addCurrentVertex(N,se,0,0,B);else if(Ue==="square"){const Ge=q?1:-1;this.addCurrentVertex(N,se,Ge,Ge,B)}else Ue==="round"&&(q&&(this.addCurrentVertex(N,J,0,0,B),this.addCurrentVertex(N,J,1,1,B,!0)),H&&(this.addCurrentVertex(N,ue,-1,-1,B,!0),this.addCurrentVertex(N,ue,0,0,B)));if(Be&&ae<I-1){const Ge=N.dist(H);if(Ge>2*j){const ze=N.add(H.sub(N)._mult(j/Ge)._round());this.updateDistance(N,ze),this.addCurrentVertex(ze,ue,0,0,B),N=ze}}}}addCurrentVertex(t,n,c,h,_,v=!1){const w=n.y*h-n.x,T=-n.y-n.x*h;this.addHalfVertex(t,n.x+n.y*c,n.y-n.x*c,v,!1,c,_),this.addHalfVertex(t,w,T,v,!0,-h,_),this.distance>o_/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,n,c,h,_,v))}addHalfVertex({x:t,y:n},c,h,_,v,w,T){const P=.5*(this.lineClips?this.scaledDistance*(o_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(_?1:0),(n<<1)+(v?1:0),Math.round(63*c)+128,Math.round(63*h)+128,1+(w===0?0:w<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const I=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,I,this.e2),T.primitiveLength++),v?this.e2=I:this.e1=I}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}}let s_,l_;Ke("LineBucket",Im,{omit:["layers","patternFeatures"]});var c_={get paint(){return l_=l_||new Ti({"line-opacity":new ht(ge.paint_line["line-opacity"]),"line-color":new ht(ge.paint_line["line-color"]),"line-translate":new rt(ge.paint_line["line-translate"]),"line-translate-anchor":new rt(ge.paint_line["line-translate-anchor"]),"line-width":new ht(ge.paint_line["line-width"]),"line-gap-width":new ht(ge.paint_line["line-gap-width"]),"line-offset":new ht(ge.paint_line["line-offset"]),"line-blur":new ht(ge.paint_line["line-blur"]),"line-dasharray":new Da(ge.paint_line["line-dasharray"]),"line-pattern":new cc(ge.paint_line["line-pattern"]),"line-gradient":new uc(ge.paint_line["line-gradient"])})},get layout(){return s_=s_||new Ti({"line-cap":new rt(ge.layout_line["line-cap"]),"line-join":new ht(ge.layout_line["line-join"]),"line-miter-limit":new rt(ge.layout_line["line-miter-limit"]),"line-round-limit":new rt(ge.layout_line["line-round-limit"]),"line-sort-key":new ht(ge.layout_line["line-sort-key"])})}};class lT extends ht{possiblyEvaluate(t,n){return n=new gr(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(t,n)}evaluate(t,n,c,h){return n=Qt({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(t,n,c,h)}}let hd;class cT extends rn{constructor(t){super(t,c_),this.gradientVersion=0,hd||(hd=new lT(c_.paint.properties["line-width"].specification),hd.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!(function(c){return c._styleExpression!==void 0})(n)&&n._styleExpression.expression instanceof Mr,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,n){super.recalculate(t,n),this.paint._values["line-floorwidth"]=hd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Im(t)}queryRadius(t){const n=t,c=u_(ih("line-width",this,n),ih("line-gap-width",this,n)),h=ih("line-offset",this,n);return c/2+Math.abs(h)+od(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:n,featureState:c,geometry:h,transform:_,pixelsToTileUnits:v}){const w=sd(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-_.bearingInRadians,v),T=v/2*u_(this.paint.get("line-width").evaluate(n,c),this.paint.get("line-gap-width").evaluate(n,c)),P=this.paint.get("line-offset").evaluate(n,c);return P&&(h=(function(I,z){const j=[];for(let B=0;B<I.length;B++){const N=I[B],q=[];for(let H=0;H<N.length;H++){const J=N[H-1],ue=N[H],ae=N[H+1],se=H===0?new C(0,0):ue.sub(J)._unit()._perp(),we=H===N.length-1?new C(0,0):ae.sub(ue)._unit()._perp(),Me=se._add(we)._unit(),De=Me.x*we.x+Me.y*we.y;De!==0&&Me._mult(1/De),q.push(Me._mult(z)._add(ue))}j.push(q)}return j})(h,P*v)),(function(I,z,j){for(let B=0;B<z.length;B++){const N=z[B];if(I.length>=3){for(let q=0;q<N.length;q++)if(gc(I,N[q]))return!0}if(b2(I,N,j))return!0}return!1})(w,h,T)}isTileClipped(){return!0}}function u_(a,t){return t>0?t+2*a:a}const uT=Ar([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),hT=Ar([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ar([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const pT=Ar([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Ar([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const h_=Ar([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),dT=Ar([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function fT(a,t,n){return a.sections.forEach((c=>{c.text=(function(h,_,v){const w=_.layout.get("text-transform").evaluate(v,{});return w==="uppercase"?h=h.toLocaleUpperCase():w==="lowercase"&&(h=h.toLocaleLowerCase()),yn.applyArabicShaping&&(h=yn.applyArabicShaping(h)),h})(c.text,t,n)})),a}Ar([{name:"triangle",components:3,type:"Uint16"}]),Ar([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ar([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Ar([{type:"Float32",name:"offsetX"}]),Ar([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Ar([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const dh={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Jr=24;const Em=4294967296,p_=1/Em,d_=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class zm{constructor(t=new Uint8Array(16)){this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(t,n,c=this.length){for(;this.pos<c;){const h=this.readVarint(),_=h>>3,v=this.pos;this.type=7&h,t(_,n,this),this.pos===v&&this.skip(h)}return n}readMessage(t,n){return this.readFields(t,n,this.readVarint()+this.pos)}readFixed32(){const t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){const t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Em;return this.pos+=8,t}readSFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Em;return this.pos+=8,t}readFloat(){const t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){const t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){const n=this.buf;let c,h;return h=n[this.pos++],c=127&h,h<128?c:(h=n[this.pos++],c|=(127&h)<<7,h<128?c:(h=n[this.pos++],c|=(127&h)<<14,h<128?c:(h=n[this.pos++],c|=(127&h)<<21,h<128?c:(h=n[this.pos],c|=(15&h)<<28,(function(_,v,w){const T=w.buf;let P,I;if(I=T[w.pos++],P=(112&I)>>4,I<128||(I=T[w.pos++],P|=(127&I)<<3,I<128)||(I=T[w.pos++],P|=(127&I)<<10,I<128)||(I=T[w.pos++],P|=(127&I)<<17,I<128)||(I=T[w.pos++],P|=(127&I)<<24,I<128)||(I=T[w.pos++],P|=(1&I)<<31,I<128))return xc(_,P,v);throw new Error("Expected varint not more than 10 bytes")})(c,t,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const t=this.readVarint();return t%2==1?(t+1)/-2:t/2}readBoolean(){return!!this.readVarint()}readString(){const t=this.readVarint()+this.pos,n=this.pos;return this.pos=t,t-n>=12&&d_?d_.decode(this.buf.subarray(n,t)):(function(c,h,_){let v="",w=h;for(;w<_;){const T=c[w];let P,I,z,j=null,B=T>239?4:T>223?3:T>191?2:1;if(w+B>_)break;B===1?T<128&&(j=T):B===2?(P=c[w+1],(192&P)==128&&(j=(31&T)<<6|63&P,j<=127&&(j=null))):B===3?(P=c[w+1],I=c[w+2],(192&P)==128&&(192&I)==128&&(j=(15&T)<<12|(63&P)<<6|63&I,(j<=2047||j>=55296&&j<=57343)&&(j=null))):B===4&&(P=c[w+1],I=c[w+2],z=c[w+3],(192&P)==128&&(192&I)==128&&(192&z)==128&&(j=(15&T)<<18|(63&P)<<12|(63&I)<<6|63&z,(j<=65535||j>=1114112)&&(j=null))),j===null?(j=65533,B=1):j>65535&&(j-=65536,v+=String.fromCharCode(j>>>10&1023|55296),j=56320|1023&j),v+=String.fromCharCode(j),w+=B}return v})(this.buf,n,t)}readBytes(){const t=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,t);return this.pos=t,n}readPackedVarint(t=[],n){const c=this.readPackedEnd();for(;this.pos<c;)t.push(this.readVarint(n));return t}readPackedSVarint(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readSVarint());return t}readPackedBoolean(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readBoolean());return t}readPackedFloat(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readFloat());return t}readPackedDouble(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readDouble());return t}readPackedFixed32(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readFixed32());return t}readPackedSFixed32(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readSFixed32());return t}readPackedFixed64(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readFixed64());return t}readPackedSFixed64(t=[]){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readSFixed64());return t}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(t){const n=7&t;if(n===0)for(;this.buf[this.pos++]>127;);else if(n===2)this.pos=this.readVarint()+this.pos;else if(n===5)this.pos+=4;else{if(n!==1)throw new Error(`Unimplemented type: ${n}`);this.pos+=8}}writeTag(t,n){this.writeVarint(t<<3|n)}realloc(t){let n=this.length||16;for(;n<this.pos+t;)n*=2;if(n!==this.length){const c=new Uint8Array(n);c.set(this.buf),this.buf=c,this.dataView=new DataView(c.buffer),this.length=n}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*p_),!0),this.pos+=8}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*p_),!0),this.pos+=8}writeVarint(t){(t=+t||0)>268435455||t<0?(function(n,c){let h,_;if(n>=0?(h=n%4294967296|0,_=n/4294967296|0):(h=~(-n%4294967296),_=~(-n/4294967296),4294967295^h?h=h+1|0:(h=0,_=_+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),(function(v,w,T){T.buf[T.pos++]=127&v|128,v>>>=7,T.buf[T.pos++]=127&v|128,v>>>=7,T.buf[T.pos++]=127&v|128,v>>>=7,T.buf[T.pos++]=127&v|128,T.buf[T.pos]=127&(v>>>=7)})(h,0,c),(function(v,w){const T=(7&v)<<4;w.buf[w.pos++]|=T|((v>>>=3)?128:0),v&&(w.buf[w.pos++]=127&v|((v>>>=7)?128:0),v&&(w.buf[w.pos++]=127&v|((v>>>=7)?128:0),v&&(w.buf[w.pos++]=127&v|((v>>>=7)?128:0),v&&(w.buf[w.pos++]=127&v|((v>>>=7)?128:0),v&&(w.buf[w.pos++]=127&v)))))})(_,c)})(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))}writeSVarint(t){this.writeVarint(t<0?2*-t-1:2*t)}writeBoolean(t){this.writeVarint(+t)}writeString(t){t=String(t),this.realloc(4*t.length),this.pos++;const n=this.pos;this.pos=(function(h,_,v){for(let w,T,P=0;P<_.length;P++){if(w=_.charCodeAt(P),w>55295&&w<57344){if(!T){w>56319||P+1===_.length?(h[v++]=239,h[v++]=191,h[v++]=189):T=w;continue}if(w<56320){h[v++]=239,h[v++]=191,h[v++]=189,T=w;continue}w=T-55296<<10|w-56320|65536,T=null}else T&&(h[v++]=239,h[v++]=191,h[v++]=189,T=null);w<128?h[v++]=w:(w<2048?h[v++]=w>>6|192:(w<65536?h[v++]=w>>12|224:(h[v++]=w>>18|240,h[v++]=w>>12&63|128),h[v++]=w>>6&63|128),h[v++]=63&w|128)}return v})(this.buf,t,this.pos);const c=this.pos-n;c>=128&&f_(n,c,this),this.pos=n-1,this.writeVarint(c),this.pos+=c}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8}writeBytes(t){const n=t.length;this.writeVarint(n),this.realloc(n);for(let c=0;c<n;c++)this.buf[this.pos++]=t[c]}writeRawMessage(t,n){this.pos++;const c=this.pos;t(n,this);const h=this.pos-c;h>=128&&f_(c,h,this),this.pos=c-1,this.writeVarint(h),this.pos+=h}writeMessage(t,n,c){this.writeTag(t,2),this.writeRawMessage(n,c)}writePackedVarint(t,n){n.length&&this.writeMessage(t,mT,n)}writePackedSVarint(t,n){n.length&&this.writeMessage(t,gT,n)}writePackedBoolean(t,n){n.length&&this.writeMessage(t,vT,n)}writePackedFloat(t,n){n.length&&this.writeMessage(t,yT,n)}writePackedDouble(t,n){n.length&&this.writeMessage(t,_T,n)}writePackedFixed32(t,n){n.length&&this.writeMessage(t,bT,n)}writePackedSFixed32(t,n){n.length&&this.writeMessage(t,xT,n)}writePackedFixed64(t,n){n.length&&this.writeMessage(t,wT,n)}writePackedSFixed64(t,n){n.length&&this.writeMessage(t,TT,n)}writeBytesField(t,n){this.writeTag(t,2),this.writeBytes(n)}writeFixed32Field(t,n){this.writeTag(t,5),this.writeFixed32(n)}writeSFixed32Field(t,n){this.writeTag(t,5),this.writeSFixed32(n)}writeFixed64Field(t,n){this.writeTag(t,1),this.writeFixed64(n)}writeSFixed64Field(t,n){this.writeTag(t,1),this.writeSFixed64(n)}writeVarintField(t,n){this.writeTag(t,0),this.writeVarint(n)}writeSVarintField(t,n){this.writeTag(t,0),this.writeSVarint(n)}writeStringField(t,n){this.writeTag(t,2),this.writeString(n)}writeFloatField(t,n){this.writeTag(t,5),this.writeFloat(n)}writeDoubleField(t,n){this.writeTag(t,1),this.writeDouble(n)}writeBooleanField(t,n){this.writeVarintField(t,+n)}}function xc(a,t,n){return n?4294967296*t+(a>>>0):4294967296*(t>>>0)+(a>>>0)}function f_(a,t,n){const c=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(c);for(let h=n.pos-1;h>=a;h--)n.buf[h+c]=n.buf[h]}function mT(a,t){for(let n=0;n<a.length;n++)t.writeVarint(a[n])}function gT(a,t){for(let n=0;n<a.length;n++)t.writeSVarint(a[n])}function yT(a,t){for(let n=0;n<a.length;n++)t.writeFloat(a[n])}function _T(a,t){for(let n=0;n<a.length;n++)t.writeDouble(a[n])}function vT(a,t){for(let n=0;n<a.length;n++)t.writeBoolean(a[n])}function bT(a,t){for(let n=0;n<a.length;n++)t.writeFixed32(a[n])}function xT(a,t){for(let n=0;n<a.length;n++)t.writeSFixed32(a[n])}function wT(a,t){for(let n=0;n<a.length;n++)t.writeFixed64(a[n])}function TT(a,t){for(let n=0;n<a.length;n++)t.writeSFixed64(a[n])}function ST(a,t,n){a===1&&n.readMessage(kT,t)}function kT(a,t,n){if(a===3){const{id:c,bitmap:h,width:_,height:v,left:w,top:T,advance:P}=n.readMessage(CT,{});t.push({id:c,bitmap:new nh({width:_+6,height:v+6},h),metrics:{width:_,height:v,left:w,top:T,advance:P}})}}function CT(a,t,n){a===1?t.id=n.readVarint():a===2?t.bitmap=n.readBytes():a===3?t.width=n.readVarint():a===4?t.height=n.readVarint():a===5?t.left=n.readSVarint():a===6?t.top=n.readSVarint():a===7&&(t.advance=n.readVarint())}function m_(a){let t=0,n=0;for(const v of a)t+=v.w*v.h,n=Math.max(n,v.w);a.sort(((v,w)=>w.h-v.h));const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let h=0,_=0;for(const v of a)for(let w=c.length-1;w>=0;w--){const T=c[w];if(!(v.w>T.w||v.h>T.h)){if(v.x=T.x,v.y=T.y,_=Math.max(_,v.y+v.h),h=Math.max(h,v.x+v.w),v.w===T.w&&v.h===T.h){const P=c.pop();P&&w<c.length&&(c[w]=P)}else v.h===T.h?(T.x+=v.w,T.w-=v.w):v.w===T.w?(T.y+=v.h,T.h-=v.h):(c.push({x:T.x+v.w,y:T.y,w:T.w-v.w,h:v.h}),T.y+=v.h,T.h-=v.h);break}}return{w:h,h:_,fill:t/(h*_)||0}}class Rm{constructor(t,{pixelRatio:n,version:c,stretchX:h,stretchY:_,content:v,textFitWidth:w,textFitHeight:T}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=h,this.stretchY=_,this.content=v,this.version=c,this.textFitWidth=w,this.textFitHeight=T}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class g_{constructor(t,n){const c={},h={};this.haveRenderCallbacks=[];const _=[];this.addImages(t,c,_),this.addImages(n,h,_);const{w:v,h:w}=m_(_),T=new Zi({width:v||1,height:w||1});for(const P in t){const I=t[P],z=c[P].paddedRect;Zi.copy(I.data,T,{x:0,y:0},{x:z.x+1,y:z.y+1},I.data)}for(const P in n){const I=n[P],z=h[P].paddedRect,j=z.x+1,B=z.y+1,N=I.data.width,q=I.data.height;Zi.copy(I.data,T,{x:0,y:0},{x:j,y:B},I.data),Zi.copy(I.data,T,{x:0,y:q-1},{x:j,y:B-1},{width:N,height:1}),Zi.copy(I.data,T,{x:0,y:0},{x:j,y:B+q},{width:N,height:1}),Zi.copy(I.data,T,{x:N-1,y:0},{x:j-1,y:B},{width:1,height:q}),Zi.copy(I.data,T,{x:0,y:0},{x:j+N,y:B},{width:1,height:q})}this.image=T,this.iconPositions=c,this.patternPositions=h}addImages(t,n,c){for(const h in t){const _=t[h],v={x:0,y:0,w:_.data.width+2,h:_.data.height+2};c.push(v),n[h]=new Rm(v,_),_.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(t,n){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in t.updatedImages)this.patchUpdatedImage(this.iconPositions[c],t.getImage(c),n),this.patchUpdatedImage(this.patternPositions[c],t.getImage(c),n)}patchUpdatedImage(t,n,c){if(!t||!n||t.version===n.version)return;t.version=n.version;const[h,_]=t.tl;c.update(n.data,void 0,{x:h,y:_})}}var as;Ke("ImagePosition",Rm),Ke("ImageAtlas",g_),f.ao=void 0,(as=f.ao||(f.ao={}))[as.none=0]="none",as[as.horizontal=1]="horizontal",as[as.vertical=2]="vertical",as[as.horizontalOnly=3]="horizontalOnly";class fh{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,n,c){const h=new fh;return h.scale=t||1,h.fontStack=n,h.verticalAlign=c||"bottom",h}static forImage(t,n){const c=new fh;return c.imageName=t,c.verticalAlign=n||"bottom",c}}class wc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){const c=new wc;for(let h=0;h<t.sections.length;h++){const _=t.sections[h];_.image?c.addImageSection(_):c.addTextSection(_,n)}return c}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=(function(t){let n="";for(let c=0;c<t.length;c++){const h=t.charCodeAt(c+1)||null,_=t.charCodeAt(c-1)||null;n+=h&&Yp(h)&&!dh[t[c+1]]||_&&Yp(_)&&!dh[t[c-1]]||!dh[t[c]]?t[c]:dh[t[c]]}return n})(this.text)}trim(){let t=0;for(let c=0;c<this.text.length&&dd[this.text.charCodeAt(c)];c++)t++;let n=this.text.length;for(let c=this.text.length-1;c>=0&&c>=t&&dd[this.text.charCodeAt(c)];c--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){const c=new wc;return c.text=this.text.substring(t,n),c.sectionIndex=this.sectionIndex.slice(t,n),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,n)=>Math.max(t,this.sections[n].scale)),0)}getMaxImageSize(t){let n=0,c=0;for(let h=0;h<this.length();h++){const _=this.getSection(h);if(_.imageName){const v=t[_.imageName];if(!v)continue;const w=v.displaySize;n=Math.max(n,w[0]),c=Math.max(c,w[1])}}return{maxImageWidth:n,maxImageHeight:c}}addTextSection(t,n){this.text+=t.text,this.sections.push(fh.forText(t.scale,t.fontStack||n,t.verticalAlign));const c=this.sections.length-1;for(let h=0;h<t.text.length;++h)this.sectionIndex.push(c)}addImageSection(t){const n=t.image?t.image.name:"";if(n.length===0)return void tr("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(fh.forImage(n,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):tr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function pd(a,t,n,c,h,_,v,w,T,P,I,z,j,B,N){const q=wc.fromFeature(a,h);let H;z===f.ao.vertical&&q.verticalizePunctuation();const{processBidirectionalText:J,processStyledBidirectionalText:ue}=yn;if(J&&q.sections.length===1){H=[];const we=J(q.toString(),Lm(q,P,_,t,c,B));for(const Me of we){const De=new wc;De.text=Me,De.sections=q.sections;for(let Ze=0;Ze<Me.length;Ze++)De.sectionIndex.push(0);H.push(De)}}else if(ue){H=[];const we=ue(q.text,q.sectionIndex,Lm(q,P,_,t,c,B));for(const Me of we){const De=new wc;De.text=Me[0],De.sectionIndex=Me[1],De.sections=q.sections,H.push(De)}}else H=(function(we,Me){const De=[],Ze=we.text;let Be=0;for(const qe of Me)De.push(we.substring(Be,qe)),Be=qe;return Be<Ze.length&&De.push(we.substring(Be,Ze.length)),De})(q,Lm(q,P,_,t,c,B));const ae=[],se={positionedLines:ae,text:q.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:z,iconsInText:!1,verticalizable:!1};return(function(we,Me,De,Ze,Be,qe,at,Ue,Ge,ze,dt,ft){let lt=0,et=0,$t=0,kr=0;const Wr=Ue==="right"?1:Ue==="left"?0:.5,_i=Jr/ft;let wn=0;for(const vr of Be){vr.trim();const Qr=vr.getMaxScale(),si={positionedGlyphs:[],lineOffset:0};we.positionedLines[wn]=si;const li=si.positionedGlyphs;let Bi=0;if(!vr.length()){et+=qe,++wn;continue}const Tn=IT(Ze,vr,_i);for(let Hi=0;Hi<vr.length();Hi++){const Hr=vr.getSection(Hi),ti=vr.getSectionIndex(Hi),ri=vr.getCharCode(Hi),$r=ET(Ge,dt,ri);let mr;if(Hr.imageName){if(we.iconsInText=!0,Hr.scale=Hr.scale*_i,mr=RT(Hr,$r,Qr,Tn,Ze),!mr)continue;Bi=Math.max(Bi,mr.imageOffset)}else if(mr=zT(Hr,ri,$r,Tn,Me,De),!mr)continue;const{rect:la,metrics:Cc,baselineOffset:ca}=mr;li.push({glyph:ri,imageName:Hr.imageName,x:lt,y:et+ca+-17,vertical:$r,scale:Hr.scale,fontStack:Hr.fontStack,sectionIndex:ti,metrics:Cc,rect:la}),$r?(we.verticalizable=!0,lt+=(Hr.imageName?Cc.advance:Jr)*Hr.scale+ze):lt+=Cc.advance*Hr.scale+ze}li.length!==0&&($t=Math.max(lt-ze,$t),LT(li,0,li.length-1,Wr)),lt=0,si.lineOffset=Math.max(Bi,(Qr-1)*Jr);const ei=qe*Qr+Bi;et+=ei,kr=Math.max(ei,kr),++wn}const{horizontalAlign:Wi,verticalAlign:oi}=Dm(at);(function(vr,Qr,si,li,Bi,Tn,ei,Hi,Hr){const ti=(Qr-si)*Bi;let ri=0;ri=Tn!==ei?-Hi*li- -17:-li*Hr*ei+.5*ei;for(const $r of vr)for(const mr of $r.positionedGlyphs)mr.x+=ti,mr.y+=ri})(we.positionedLines,Wr,Wi,oi,$t,kr,qe,et,Be.length),we.top+=-oi*et,we.bottom=we.top+et,we.left+=-Wi*$t,we.right=we.left+$t})(se,t,n,c,H,v,w,T,z,P,j,N),!(function(we){for(const Me of we)if(Me.positionedGlyphs.length!==0)return!1;return!0})(ae)&&se}const dd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},PT={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},MT={40:!0};function y_(a,t,n,c,h,_){if(t.imageName){const v=c[t.imageName];return v?v.displaySize[0]*t.scale*Jr/_+h:0}{const v=n[t.fontStack],w=v&&v[a];return w?w.metrics.advance*t.scale+h:0}}function __(a,t,n,c){const h=Math.pow(a-t,2);return c?a<t?h/2:2*h:h+Math.abs(n)*n}function AT(a,t,n){let c=0;return a===10&&(c-=1e4),n&&(c+=150),a!==40&&a!==65288||(c+=50),t!==41&&t!==65289||(c+=50),c}function v_(a,t,n,c,h,_){let v=null,w=__(t,n,h,_);for(const T of c){const P=__(t-T.x,n,h,_)+T.badness;P<=w&&(v=T,w=P)}return{index:a,x:t,priorBreak:v,badness:w}}function b_(a){return a?b_(a.priorBreak).concat(a.index):[]}function Lm(a,t,n,c,h,_){if(!a)return[];const v=[],w=(function(z,j,B,N,q,H){let J=0;for(let ue=0;ue<z.length();ue++){const ae=z.getSection(ue);J+=y_(z.getCharCode(ue),ae,N,q,j,H)}return J/Math.max(1,Math.ceil(J/B))})(a,t,n,c,h,_),T=a.text.indexOf("")>=0;let P=0;for(let z=0;z<a.length();z++){const j=a.getSection(z),B=a.getCharCode(z);if(dd[B]||(P+=y_(B,j,c,h,t,_)),z<a.length()-1){const N=!((I=B)<11904)&&(!!Bt["CJK Compatibility Forms"](I)||!!Bt["CJK Compatibility"](I)||!!Bt["CJK Strokes"](I)||!!Bt["CJK Symbols and Punctuation"](I)||!!Bt["Enclosed CJK Letters and Months"](I)||!!Bt["Halfwidth and Fullwidth Forms"](I)||!!Bt["Ideographic Description Characters"](I)||!!Bt["Vertical Forms"](I)||Zu.test(String.fromCodePoint(I)));(PT[B]||N||j.imageName||z!==a.length()-2&&MT[a.getCharCode(z+1)])&&v.push(v_(z+1,P,w,v,AT(B,a.getCharCode(z+1),N&&T),!1))}}var I;return b_(v_(a.length(),P,w,v,0,!0))}function Dm(a){let t=.5,n=.5;switch(a){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function IT(a,t,n){const c=t.getMaxScale()*Jr,{maxImageWidth:h,maxImageHeight:_}=t.getMaxImageSize(a),v=Math.max(c,_*n);return{verticalLineContentWidth:Math.max(c,h*n),horizontalLineContentHeight:v}}function x_(a){switch(a){case"top":return 0;case"center":return .5;default:return 1}}function ET(a,t,n){return!(a===f.ao.horizontal||!t&&!Wu(n)||t&&(dd[n]||(c=n,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(c)))));var c}function zT(a,t,n,c,h,_){const v=_[a.fontStack],w=(function(P,I,z,j){if(P&&P.rect)return P;const B=I[z.fontStack],N=B&&B[j];return N?{rect:null,metrics:N.metrics}:null})(v&&v[t],h,a,t);if(w===null)return null;let T;if(n)T=c.verticalLineContentWidth-a.scale*Jr;else{const P=x_(a.verticalAlign);T=(c.horizontalLineContentHeight-a.scale*Jr)*P}return{rect:w.rect,metrics:w.metrics,baselineOffset:T}}function RT(a,t,n,c,h){const _=h[a.imageName];if(!_)return null;const v=_.paddedRect,w=_.displaySize,T={width:w[0],height:w[1],left:1,top:-3,advance:t?w[1]:w[0]};let P;if(t)P=c.verticalLineContentWidth-w[1]*a.scale;else{const I=x_(a.verticalAlign);P=(c.horizontalLineContentHeight-w[1]*a.scale)*I}return{rect:v,metrics:T,baselineOffset:P,imageOffset:(t?w[0]:w[1])*a.scale-Jr*n}}function LT(a,t,n,c){if(c===0)return;const h=a[n],_=(a[n].x+h.metrics.advance*h.scale)*c;for(let v=t;v<=n;v++)a[v].x-=_}function DT(a,t,n){const{horizontalAlign:c,verticalAlign:h}=Dm(n),_=t[0]-a.displaySize[0]*c,v=t[1]-a.displaySize[1]*h;return{image:a,top:v,bottom:v+a.displaySize[1],left:_,right:_+a.displaySize[0]}}function w_(a){var t,n;let c=a.left,h=a.top,_=a.right-c,v=a.bottom-h;const w=(t=a.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",T=(n=a.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",P=(a.image.content[2]-a.image.content[0])/(a.image.content[3]-a.image.content[1]);if(T==="proportional"){if(w==="stretchOnly"&&_/v<P||w==="proportional"){const I=Math.ceil(v*P);c*=I/_,_=I}}else if(w==="proportional"&&T==="stretchOnly"&&P!==0&&_/v>P){const I=Math.ceil(_/P);h*=I/v,v=I}return{x1:c,y1:h,x2:c+_,y2:h+v}}function T_(a,t,n,c,h,_){const v=a.image;let w;if(v.content){const H=v.content,J=v.pixelRatio||1;w=[H[0]/J,H[1]/J,v.displaySize[0]-H[2]/J,v.displaySize[1]-H[3]/J]}const T=t.left*_,P=t.right*_;let I,z,j,B;n==="width"||n==="both"?(B=h[0]+T-c[3],z=h[0]+P+c[1]):(B=h[0]+(T+P-v.displaySize[0])/2,z=B+v.displaySize[0]);const N=t.top*_,q=t.bottom*_;return n==="height"||n==="both"?(I=h[1]+N-c[0],j=h[1]+q+c[2]):(I=h[1]+(N+q-v.displaySize[1])/2,j=I+v.displaySize[1]),{image:v,top:I,right:z,bottom:j,left:B,collisionPadding:w}}const _o=128,os=32640;function S_(a,t){const{expression:n}=t;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new gr(a+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:h}=n;let _=0;for(;_<c.length&&c[_]<=a;)_++;_=Math.max(0,_-1);let v=_;for(;v<c.length&&c[v]<a+1;)v++;v=Math.min(c.length-1,v);const w=c[_],T=c[v];return n.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:T,interpolationType:h}:{kind:"camera",minZoom:w,maxZoom:T,minSize:n.evaluate(new gr(w)),maxSize:n.evaluate(new gr(T)),interpolationType:h}}}function jm(a,t,n){let c="never";const h=a.get(t);return h?c=h:a.get(n)&&(c="always"),c}const jT=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function fd(a,t,n,c,h,_,v,w,T,P,I,z,j){const B=w?Math.min(os,Math.round(w[0])):0,N=w?Math.min(os,Math.round(w[1])):0;a.emplaceBack(t,n,Math.round(32*c),Math.round(32*h),_,v,(B<<1)+(T?1:0),N,16*P,16*I,256*z,256*j)}function Fm(a,t,n){a.emplaceBack(t.x,t.y,n),a.emplaceBack(t.x,t.y,n),a.emplaceBack(t.x,t.y,n),a.emplaceBack(t.x,t.y,n)}function FT(a){for(const t of a.sections)if(ed(t.text))return!0;return!1}class Om{constructor(t){this.layoutVertexArray=new $e,this.indexArray=new nr,this.programConfigurations=t,this.segments=new xt,this.dynamicLayoutVertexArray=new Le,this.opacityVertexArray=new Qe,this.hasVisibleVertices=!1,this.placedSymbolArray=new U}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,n,c,h){this.isEmpty()||(c&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,uT.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,hT.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,jT,!0),this.opacityVertexBuffer.itemSize=1),(c||h)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ke("SymbolBuffers",Om);class Bm{constructor(t,n,c){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new c,this.segments=new xt,this.collisionVertexArray=new Kt}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,pT.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ke("CollisionBuffers",Bm);class Tc{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((v=>v.id)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=S_(this.zoom,n["text-size"]),this.iconSizeData=S_(this.zoom,n["icon-size"]);const c=this.layers[0].layout,h=c.get("symbol-sort-key"),_=c.get("symbol-z-order");this.canOverlap=jm(c,"text-overlap","text-allow-overlap")!=="never"||jm(c,"icon-overlap","icon-allow-overlap")!=="never"||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&!h.isConstant(),this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,c.get("symbol-placement")==="point"&&(this.writingModes=c.get("text-writing-mode").map((v=>f.ao[v]))),this.stateDependentLayerIds=this.layers.filter((v=>v.isStateDependent())).map((v=>v.id)),this.sourceID=t.sourceID}createArrays(){this.text=new Om(new Gi(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new Om(new Gi(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new Y,this.lineVertexArray=new Q,this.symbolInstances=new X,this.textAnchorOffsets=new ee}calculateGlyphDependencies(t,n,c,h,_){for(let v=0;v<t.length;v++)if(n[t.charCodeAt(v)]=!0,(c||h)&&_){const w=dh[t.charAt(v)];w&&(n[w.charCodeAt(0)]=!0)}}populate(t,n,c){const h=this.layers[0],_=h.layout,v=_.get("text-font"),w=_.get("text-field"),T=_.get("icon-image"),P=(w.value.kind!=="constant"||w.value.value instanceof bi&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),I=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,z=_.get("symbol-sort-key");if(this.features=[],!P&&!I)return;const j=n.iconDependencies,B=n.glyphDependencies,N=n.availableImages,q=new gr(this.zoom,{globalState:this.globalState});for(const{feature:H,id:J,index:ue,sourceLayerIndex:ae}of t){const se=h._featureFilter.needGeometry,we=sa(H,se);if(!h._featureFilter.filter(q,we,c))continue;let Me,De;if(se||(we.geometry=$a(H)),P){const Be=h.getValueAndResolveTokens("text-field",we,c,N),qe=bi.factory(Be),at=this.hasRTLText=this.hasRTLText||FT(qe);(!at||yn.getRTLTextPluginStatus()==="unavailable"||at&&yn.isParsed())&&(Me=fT(qe,h,we))}if(I){const Be=h.getValueAndResolveTokens("icon-image",we,c,N);De=Be instanceof Vi?Be:Vi.fromString(Be)}if(!Me&&!De)continue;const Ze=this.sortFeaturesByKey?z.evaluate(we,{},c):void 0;if(this.features.push({id:J,text:Me,icon:De,index:ue,sourceLayerIndex:ae,geometry:we.geometry,properties:H.properties,type:bc.types[H.type],sortKey:Ze}),De&&(j[De.name]=!0),Me){const Be=v.evaluate(we,{},c).join(","),qe=_.get("text-rotation-alignment")!=="viewport"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(f.ao.vertical)>=0;for(const at of Me.sections)if(at.image)j[at.image.name]=!0;else{const Ue=oc(Me.toString()),Ge=at.fontStack||Be,ze=B[Ge]=B[Ge]||{};this.calculateGlyphDependencies(at.text,ze,qe,this.allowVerticalPlacement,Ue)}}}_.get("symbol-placement")==="line"&&(this.features=(function(H){const J={},ue={},ae=[];let se=0;function we(Be){ae.push(H[Be]),se++}function Me(Be,qe,at){const Ue=ue[Be];return delete ue[Be],ue[qe]=Ue,ae[Ue].geometry[0].pop(),ae[Ue].geometry[0]=ae[Ue].geometry[0].concat(at[0]),Ue}function De(Be,qe,at){const Ue=J[qe];return delete J[qe],J[Be]=Ue,ae[Ue].geometry[0].shift(),ae[Ue].geometry[0]=at[0].concat(ae[Ue].geometry[0]),Ue}function Ze(Be,qe,at){const Ue=at?qe[0][qe[0].length-1]:qe[0][0];return`${Be}:${Ue.x}:${Ue.y}`}for(let Be=0;Be<H.length;Be++){const qe=H[Be],at=qe.geometry,Ue=qe.text?qe.text.toString():null;if(!Ue){we(Be);continue}const Ge=Ze(Ue,at),ze=Ze(Ue,at,!0);if(Ge in ue&&ze in J&&ue[Ge]!==J[ze]){const dt=De(Ge,ze,at),ft=Me(Ge,ze,ae[dt].geometry);delete J[Ge],delete ue[ze],ue[Ze(Ue,ae[ft].geometry,!0)]=ft,ae[dt].geometry=null}else Ge in ue?Me(Ge,ze,at):ze in J?De(Ge,ze,at):(we(Be),J[Ge]=se-1,ue[ze]=se-1)}return ae.filter((Be=>Be.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((H,J)=>H.sortKey-J.sortKey))}update(t,n,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,c),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,c))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const c=this.lineVertexArray.length;if(t.segment!==void 0){let h=t.dist(n[t.segment+1]),_=t.dist(n[t.segment]);const v={};for(let w=t.segment+1;w<n.length;w++)v[w]={x:n[w].x,y:n[w].y,tileUnitDistanceFromAnchor:h},w<n.length-1&&(h+=n[w+1].dist(n[w]));for(let w=t.segment||0;w>=0;w--)v[w]={x:n[w].x,y:n[w].y,tileUnitDistanceFromAnchor:_},w>0&&(_+=n[w-1].dist(n[w]));for(let w=0;w<n.length;w++){const T=v[w];this.lineVertexArray.emplaceBack(T.x,T.y,T.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(t,n,c,h,_,v,w,T,P,I,z,j){const B=t.indexArray,N=t.layoutVertexArray,q=t.segments.prepareSegment(4*n.length,N,B,this.canOverlap?v.sortKey:void 0),H=this.glyphOffsetArray.length,J=q.vertexLength,ue=this.allowVerticalPlacement&&w===f.ao.vertical?Math.PI/2:0,ae=v.text&&v.text.sections;for(let se=0;se<n.length;se++){const{tl:we,tr:Me,bl:De,br:Ze,tex:Be,pixelOffsetTL:qe,pixelOffsetBR:at,minFontScaleX:Ue,minFontScaleY:Ge,glyphOffset:ze,isSDF:dt,sectionIndex:ft}=n[se],lt=q.vertexLength,et=ze[1];fd(N,T.x,T.y,we.x,et+we.y,Be.x,Be.y,c,dt,qe.x,qe.y,Ue,Ge),fd(N,T.x,T.y,Me.x,et+Me.y,Be.x+Be.w,Be.y,c,dt,at.x,qe.y,Ue,Ge),fd(N,T.x,T.y,De.x,et+De.y,Be.x,Be.y+Be.h,c,dt,qe.x,at.y,Ue,Ge),fd(N,T.x,T.y,Ze.x,et+Ze.y,Be.x+Be.w,Be.y+Be.h,c,dt,at.x,at.y,Ue,Ge),Fm(t.dynamicLayoutVertexArray,T,ue),B.emplaceBack(lt,lt+2,lt+1),B.emplaceBack(lt+1,lt+2,lt+3),q.vertexLength+=4,q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ze[0]),se!==n.length-1&&ft===n[se+1].sectionIndex||t.programConfigurations.populatePaintArrays(N.length,v,v.index,{},j,ae&&ae[ft])}t.placedSymbolArray.emplaceBack(T.x,T.y,H,this.glyphOffsetArray.length-H,J,P,I,T.segment,c?c[0]:0,c?c[1]:0,h[0],h[1],w,0,!1,0,z)}_addCollisionDebugVertex(t,n,c,h,_,v){return n.emplaceBack(0,0),t.emplaceBack(c.x,c.y,h,_,Math.round(v.x),Math.round(v.y))}addCollisionDebugVertices(t,n,c,h,_,v,w){const T=_.segments.prepareSegment(4,_.layoutVertexArray,_.indexArray),P=T.vertexLength,I=_.layoutVertexArray,z=_.collisionVertexArray,j=w.anchorX,B=w.anchorY;this._addCollisionDebugVertex(I,z,v,j,B,new C(t,n)),this._addCollisionDebugVertex(I,z,v,j,B,new C(c,n)),this._addCollisionDebugVertex(I,z,v,j,B,new C(c,h)),this._addCollisionDebugVertex(I,z,v,j,B,new C(t,h)),T.vertexLength+=4;const N=_.indexArray;N.emplaceBack(P,P+1),N.emplaceBack(P+1,P+2),N.emplaceBack(P+2,P+3),N.emplaceBack(P+3,P),T.primitiveLength+=4}addDebugCollisionBoxes(t,n,c,h){for(let _=t;_<n;_++){const v=this.collisionBoxArray.get(_);this.addCollisionDebugVertices(v.x1,v.y1,v.x2,v.y2,h?this.textCollisionBox:this.iconCollisionBox,v.anchorPoint,c)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Bm(Tt,h_.members,rr),this.iconCollisionBox=new Bm(Tt,h_.members,rr);for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(t,n,c,h,_,v,w,T,P){const I={};for(let z=n;z<c;z++){const j=t.get(z);I.textBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},I.textFeatureIndex=j.featureIndex;break}for(let z=h;z<_;z++){const j=t.get(z);I.verticalTextBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},I.verticalTextFeatureIndex=j.featureIndex;break}for(let z=v;z<w;z++){const j=t.get(z);I.iconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},I.iconFeatureIndex=j.featureIndex;break}for(let z=T;z<P;z++){const j=t.get(z);I.verticalIconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},I.verticalIconFeatureIndex=j.featureIndex;break}return I}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const c=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,n){const c=t.placedSymbolArray.get(n),h=c.vertexStartIndex+4*c.numGlyphs;for(let _=c.vertexStartIndex;_<h;_+=4)t.indexArray.emplaceBack(_,_+2,_+1),t.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(t),c=Math.cos(t),h=[],_=[],v=[];for(let w=0;w<this.symbolInstances.length;++w){v.push(w);const T=this.symbolInstances.get(w);h.push(0|Math.round(n*T.anchorX+c*T.anchorY)),_.push(T.featureIndex)}return v.sort(((w,T)=>h[w]-h[T]||_[T]-_[w])),v}addToSortKeyRanges(t,n){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===n?c.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const c=this.symbolInstances.get(n);this.featureSortOrder.push(c.featureIndex),[c.rightJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.leftJustifiedTextSymbolIndex].forEach(((h,_,v)=>{h>=0&&v.indexOf(h)===_&&this.addIndicesForPlacedSymbol(this.text,h)})),c.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,c.verticalPlacedTextSymbolIndex),c.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.placedIconSymbolIndex),c.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let k_,C_;Ke("SymbolBucket",Tc,{omit:["layers","collisionBoxArray","features","compareText"]}),Tc.MAX_GLYPHS=65535,Tc.addDynamicAttributes=Fm;var $m={get paint(){return C_=C_||new Ti({"icon-opacity":new ht(ge.paint_symbol["icon-opacity"]),"icon-color":new ht(ge.paint_symbol["icon-color"]),"icon-halo-color":new ht(ge.paint_symbol["icon-halo-color"]),"icon-halo-width":new ht(ge.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ht(ge.paint_symbol["icon-halo-blur"]),"icon-translate":new rt(ge.paint_symbol["icon-translate"]),"icon-translate-anchor":new rt(ge.paint_symbol["icon-translate-anchor"]),"text-opacity":new ht(ge.paint_symbol["text-opacity"]),"text-color":new ht(ge.paint_symbol["text-color"],{runtimeType:ni,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new ht(ge.paint_symbol["text-halo-color"]),"text-halo-width":new ht(ge.paint_symbol["text-halo-width"]),"text-halo-blur":new ht(ge.paint_symbol["text-halo-blur"]),"text-translate":new rt(ge.paint_symbol["text-translate"]),"text-translate-anchor":new rt(ge.paint_symbol["text-translate-anchor"])})},get layout(){return k_=k_||new Ti({"symbol-placement":new rt(ge.layout_symbol["symbol-placement"]),"symbol-spacing":new rt(ge.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new rt(ge.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ht(ge.layout_symbol["symbol-sort-key"]),"symbol-z-order":new rt(ge.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new rt(ge.layout_symbol["icon-allow-overlap"]),"icon-overlap":new rt(ge.layout_symbol["icon-overlap"]),"icon-ignore-placement":new rt(ge.layout_symbol["icon-ignore-placement"]),"icon-optional":new rt(ge.layout_symbol["icon-optional"]),"icon-rotation-alignment":new rt(ge.layout_symbol["icon-rotation-alignment"]),"icon-size":new ht(ge.layout_symbol["icon-size"]),"icon-text-fit":new rt(ge.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new rt(ge.layout_symbol["icon-text-fit-padding"]),"icon-image":new ht(ge.layout_symbol["icon-image"]),"icon-rotate":new ht(ge.layout_symbol["icon-rotate"]),"icon-padding":new ht(ge.layout_symbol["icon-padding"]),"icon-keep-upright":new rt(ge.layout_symbol["icon-keep-upright"]),"icon-offset":new ht(ge.layout_symbol["icon-offset"]),"icon-anchor":new ht(ge.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new rt(ge.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new rt(ge.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new rt(ge.layout_symbol["text-rotation-alignment"]),"text-field":new ht(ge.layout_symbol["text-field"]),"text-font":new ht(ge.layout_symbol["text-font"]),"text-size":new ht(ge.layout_symbol["text-size"]),"text-max-width":new ht(ge.layout_symbol["text-max-width"]),"text-line-height":new rt(ge.layout_symbol["text-line-height"]),"text-letter-spacing":new ht(ge.layout_symbol["text-letter-spacing"]),"text-justify":new ht(ge.layout_symbol["text-justify"]),"text-radial-offset":new ht(ge.layout_symbol["text-radial-offset"]),"text-variable-anchor":new rt(ge.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new ht(ge.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new ht(ge.layout_symbol["text-anchor"]),"text-max-angle":new rt(ge.layout_symbol["text-max-angle"]),"text-writing-mode":new rt(ge.layout_symbol["text-writing-mode"]),"text-rotate":new ht(ge.layout_symbol["text-rotate"]),"text-padding":new rt(ge.layout_symbol["text-padding"]),"text-keep-upright":new rt(ge.layout_symbol["text-keep-upright"]),"text-transform":new ht(ge.layout_symbol["text-transform"]),"text-offset":new ht(ge.layout_symbol["text-offset"]),"text-allow-overlap":new rt(ge.layout_symbol["text-allow-overlap"]),"text-overlap":new rt(ge.layout_symbol["text-overlap"]),"text-ignore-placement":new rt(ge.layout_symbol["text-ignore-placement"]),"text-optional":new rt(ge.layout_symbol["text-optional"])})}};class P_{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Lo,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ke("FormatSectionOverride",P_,{omit:["defaultValue"]});class md extends rn{constructor(t){super(t,$m)}recalculate(t,n){if(super.recalculate(t,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const c=this.layout.get("text-writing-mode");if(c){const h=[];for(const _ of c)h.indexOf(_)<0&&h.push(_);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,n,c,h){const _=this.layout.get(t).evaluate(n,{},c,h),v=this._unevaluatedLayout._values[t];return v.isDataDriven()||Jl(v.value)||!_?_:(function(w,T){return T.replace(/{([^{}]+)}/g,((P,I)=>w&&I in w?String(w[I]):""))})(n.properties,_)}createBucket(t){return new Tc(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of $m.paint.overridableProperties){if(!md.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),c=new P_(n),h=new Lu(c,n.property.specification);let _=null;_=n.value.kind==="constant"||n.value.kind==="source"?new $s("source",h):new Du("composite",h,n.value.zoomStops),this.paint._values[t]=new Vn(n.property,_,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,c){return!(!this.layout||n.isDataDriven()||c.isDataDriven())&&md.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const c=t.get("text-field"),h=$m.paint.properties[n];let _=!1;const v=w=>{for(const T of w)if(h.overrides&&h.overrides.hasOverride(T))return void(_=!0)};if(c.value.kind==="constant"&&c.value.value instanceof bi)v(c.value.value.sections);else if(c.value.kind==="source"){const w=P=>{_||(P instanceof ia&&pt(P.value)===Aa?v(P.value.sections):P instanceof io?v(P.sections):P.eachChild(w))},T=c.value;T._styleExpression&&w(T._styleExpression.expression)}return _}}let M_;var OT={get paint(){return M_=M_||new Ti({"background-color":new rt(ge.paint_background["background-color"]),"background-pattern":new Da(ge.paint_background["background-pattern"]),"background-opacity":new rt(ge.paint_background["background-opacity"])})}};class BT extends rn{constructor(t){super(t,OT)}}let A_;var $T={get paint(){return A_=A_||new Ti({"raster-opacity":new rt(ge.paint_raster["raster-opacity"]),"raster-hue-rotate":new rt(ge.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new rt(ge.paint_raster["raster-brightness-min"]),"raster-brightness-max":new rt(ge.paint_raster["raster-brightness-max"]),"raster-saturation":new rt(ge.paint_raster["raster-saturation"]),"raster-contrast":new rt(ge.paint_raster["raster-contrast"]),"raster-resampling":new rt(ge.paint_raster["raster-resampling"]),"raster-fade-duration":new rt(ge.paint_raster["raster-fade-duration"])})}};class NT extends rn{constructor(t){super(t,$T)}}class UT extends rn{constructor(t){super(t,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class VT{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const qT={once:!0},Nm=63710088e-1;class ss{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ss(yr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,c=this.lat*n,h=t.lat*n,_=Math.sin(c)*Math.sin(h)+Math.cos(c)*Math.cos(h)*Math.cos((t.lng-this.lng)*n);return Nm*Math.acos(Math.min(_,1))}static convert(t){if(t instanceof ss)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new ss(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new ss(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const I_=2*Math.PI*Nm;function E_(a){return I_*Math.cos(a*Math.PI/180)}function z_(a){return(180+a)/360}function R_(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function L_(a,t){return a/E_(t)}function Um(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function D_(a,t){return a*E_(Um(t))}class mh{constructor(t,n,c=0){this.x=+t,this.y=+n,this.z=+c}static fromLngLat(t,n=0){const c=ss.convert(t);return new mh(z_(c.lng),R_(c.lat),L_(n,c.lat))}toLngLat(){return new ss(360*this.x-180,Um(this.y))}toAltitude(){return D_(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/I_*(t=Um(this.y),1/Math.cos(t*Math.PI/180));var t}}function j_(a,t,n){var c=2*Math.PI*6378137/256/Math.pow(2,n);return[a*c-2*Math.PI*6378137/2,t*c-2*Math.PI*6378137/2]}class Vm{constructor(t,n,c){if(!(function(h,_,v){return!(h<0||h>25||v<0||v>=Math.pow(2,h)||_<0||_>=Math.pow(2,h))})(t,n,c))throw new Error(`x=${n}, y=${c}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=n,this.y=c,this.key=Sc(0,t,t,n,c)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n,c){const h=(v=this.y,w=this.z,T=j_(256*(_=this.x),256*(v=Math.pow(2,w)-v-1),w),P=j_(256*(_+1),256*(v+1),w),T[0]+","+T[1]+","+P[0]+","+P[1]);var _,v,w,T,P;const I=(function(z,j,B){let N,q="";for(let H=z;H>0;H--)N=1<<H-1,q+=(j&N?1:0)+(B&N?2:0);return q})(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(c==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,I).replace(/{bbox-epsg-3857}/g,h)}isChildOf(t){const n=this.z-t.z;return n>0&&t.x===this.x>>n&&t.y===this.y>>n}getTilePoint(t){const n=Math.pow(2,this.z);return new C((t.x*n-this.x)*Ft,(t.y*n-this.y)*Ft)}toString(){return`${this.z}/${this.x}/${this.y}`}}class F_{constructor(t,n){this.wrap=t,this.canonical=n,this.key=Sc(t,n.z,n.z,n.x,n.y)}}class xn{constructor(t,n,c,h,_){if(this.terrainRttPosMatrix32f=null,t<c)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${c}`);this.overscaledZ=t,this.wrap=n,this.canonical=new Vm(c,+h,+_),this.key=Sc(n,t,c,h,_)}clone(){return new xn(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-t;return t>this.canonical.z?new xn(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new xn(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(t,n){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-t;return t>this.canonical.z?Sc(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y):Sc(this.wrap*+n,t,t,this.canonical.x>>c,this.canonical.y>>c)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const n=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new xn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,c=2*this.canonical.x,h=2*this.canonical.y;return[new xn(n,this.wrap,n,c,h),new xn(n,this.wrap,n,c+1,h),new xn(n,this.wrap,n,c,h+1),new xn(n,this.wrap,n,c+1,h+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new xn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new xn(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new F_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new mh(t.x-this.wrap,t.y))}}function Sc(a,t,n,c,h){(a*=2)<0&&(a=-1*a-1);const _=1<<n;return(_*_*a+_*h+c).toString(36)+n.toString(36)+t.toString(36)}function gh(a,t){return t?a.properties[t]:a.id}Ke("CanonicalTileID",Vm),Ke("OverscaledTileID",xn,{omit:["terrainRttPosMatrix32f"]});class Qs{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(t){return this.minX=Math.min(this.minX,t.x),this.minY=Math.min(this.minY,t.y),this.maxX=Math.max(this.maxX,t.x),this.maxY=Math.max(this.maxY,t.y),this}expandBy(t){return this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(t){return this.expandBy(-t)}map(t){const n=new Qs;return n.extend(t(new C(this.minX,this.minY))),n.extend(t(new C(this.maxX,this.minY))),n.extend(t(new C(this.minX,this.maxY))),n.extend(t(new C(this.maxX,this.maxY))),n}static fromPoints(t){const n=new Qs;for(const c of t)n.extend(c);return n}contains(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(t){return!this.empty()&&!t.empty()&&t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY}intersects(t){return!this.empty()&&!t.empty()&&t.minX<=this.maxX&&t.maxX>=this.minX&&t.minY<=this.maxY&&t.maxY>=this.minY}}class O_{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const c=t[n];this._stringToNumber[c]=n,this._numberToString[n]=c}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class B_{constructor(t,n,c,h,_){this.type="Feature",this._vectorTileFeature=t,t._z=n,t._x=c,t._y=h,this.properties=t.properties,this.id=_}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(t[n]=this[n]);return t}}class $_{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Ws(Ft,16,0),this.grid3D=new Ws(Ft,16,0),this.featureIndexArray=new le,this.promoteId=n}insert(t,n,c,h,_,v){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,h,_);const T=v?this.grid3D:this.grid;for(let P=0;P<n.length;P++){const I=n[P],z=[1/0,1/0,-1/0,-1/0];for(let j=0;j<I.length;j++){const B=I[j];z[0]=Math.min(z[0],B.x),z[1]=Math.min(z[1],B.y),z[2]=Math.max(z[2],B.x),z[3]=Math.max(z[3],B.y)}z[0]<Ft&&z[1]<Ft&&z[2]>=0&&z[3]>=0&&T.insert(w,z[0],z[1],z[2],z[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new r_(new zm(this.rawTileData)).layers,this.sourceLayerCoder=new O_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,n,c,h){this.loadVTLayers();const _=t.params,v=Ft/t.tileSize/t.scale,w=co(_.filter),T=t.queryGeometry,P=t.queryPadding*v,I=Qs.fromPoints(T),z=this.grid.query(I.minX-P,I.minY-P,I.maxX+P,I.maxY+P),j=Qs.fromPoints(t.cameraQueryGeometry).expandBy(P),B=this.grid3D.query(j.minX,j.minY,j.maxX,j.maxY,((H,J,ue,ae)=>(function(se,we,Me,De,Ze){for(const qe of se)if(we<=qe.x&&Me<=qe.y&&De>=qe.x&&Ze>=qe.y)return!0;const Be=[new C(we,Me),new C(we,Ze),new C(De,Ze),new C(De,Me)];if(se.length>2){for(const qe of Be)if(gc(se,qe))return!0}for(let qe=0;qe<se.length-1;qe++)if(w2(se[qe],se[qe+1],Be))return!0;return!1})(t.cameraQueryGeometry,H-P,J-P,ue+P,ae+P)));for(const H of B)z.push(H);z.sort(GT);const N={};let q;for(let H=0;H<z.length;H++){const J=z[H];if(J===q)continue;q=J;const ue=this.featureIndexArray.get(J);let ae=null;this.loadMatchingFeature(N,ue.bucketIndex,ue.sourceLayerIndex,ue.featureIndex,w,_.layers,_.availableImages,n,c,h,((se,we,Me)=>(ae||(ae=$a(se)),we.queryIntersectsFeature({queryGeometry:T,feature:se,featureState:Me,geometry:ae,zoom:this.z,transform:t.transform,pixelsToTileUnits:v,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation}))))}return N}loadMatchingFeature(t,n,c,h,_,v,w,T,P,I,z){const j=this.bucketLayerIDs[n];if(v&&!j.some((H=>v.has(H))))return;const B=this.sourceLayerCoder.decode(c),N=this.vtLayers[B].feature(h);if(_.needGeometry){const H=sa(N,!0);if(!_.filter(new gr(this.tileID.overscaledZ),H,this.tileID.canonical))return}else if(!_.filter(new gr(this.tileID.overscaledZ),N))return;const q=this.getId(N,B);for(let H=0;H<j.length;H++){const J=j[H];if(v&&!v.has(J))continue;const ue=T[J];if(!ue)continue;let ae={};q&&I&&(ae=I.getState(ue.sourceLayer||"_geojsonTileLayer",q));const se=Qt({},P[J]);se.paint=N_(se.paint,ue.paint,N,ae,w),se.layout=N_(se.layout,ue.layout,N,ae,w);const we=!z||z(N,ue,ae);if(!we)continue;const Me=new B_(N,this.z,this.x,this.y,q);Me.layer=se;let De=t[J];De===void 0&&(De=t[J]=[]),De.push({featureIndex:h,feature:Me,intersectionZ:we})}}lookupSymbolFeatures(t,n,c,h,_,v,w,T){const P={};this.loadVTLayers();const I=co(_);for(const z of t)this.loadMatchingFeature(P,c,h,z,I,v,w,T,n);return P}hasLayer(t){for(const n of this.bucketLayerIDs)for(const c of n)if(t===c)return!0;return!1}getId(t,n){var c;let h=t.id;return this.promoteId&&(h=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof h=="boolean"&&(h=Number(h)),h===void 0&&(!((c=t.properties)===null||c===void 0)&&c.cluster)&&this.promoteId&&(h=Number(t.properties.cluster_id))),h}}function N_(a,t,n,c,h){return di(a,((_,v)=>{const w=t instanceof lc?t.get(v):null;return w&&w.evaluate?w.evaluate(n,c,h):w}))}function GT(a,t){return t-a}function U_(a,t,n,c,h){const _=[];for(let v=0;v<a.length;v++){const w=a[v];let T;for(let P=0;P<w.length-1;P++){let I=w[P],z=w[P+1];I.x<t&&z.x<t||(I.x<t?I=new C(t,I.y+(t-I.x)/(z.x-I.x)*(z.y-I.y))._round():z.x<t&&(z=new C(t,I.y+(t-I.x)/(z.x-I.x)*(z.y-I.y))._round()),I.y<n&&z.y<n||(I.y<n?I=new C(I.x+(n-I.y)/(z.y-I.y)*(z.x-I.x),n)._round():z.y<n&&(z=new C(I.x+(n-I.y)/(z.y-I.y)*(z.x-I.x),n)._round()),I.x>=c&&z.x>=c||(I.x>=c?I=new C(c,I.y+(c-I.x)/(z.x-I.x)*(z.y-I.y))._round():z.x>=c&&(z=new C(c,I.y+(c-I.x)/(z.x-I.x)*(z.y-I.y))._round()),I.y>=h&&z.y>=h||(I.y>=h?I=new C(I.x+(h-I.y)/(z.y-I.y)*(z.x-I.x),h)._round():z.y>=h&&(z=new C(I.x+(h-I.y)/(z.y-I.y)*(z.x-I.x),h)._round()),T&&I.equals(T[T.length-1])||(T=[I],_.push(T)),T.push(z)))))}}return _}Ke("FeatureIndex",$_,{omit:["rawTileData","sourceLayerCoder"]});class ls extends C{constructor(t,n,c,h){super(t,n),this.angle=c,h!==void 0&&(this.segment=h)}clone(){return new ls(this.x,this.y,this.angle,this.segment)}}function V_(a,t,n,c,h){if(t.segment===void 0||n===0)return!0;let _=t,v=t.segment+1,w=0;for(;w>-n/2;){if(v--,v<0)return!1;w-=a[v].dist(_),_=a[v]}w+=a[v].dist(a[v+1]),v++;const T=[];let P=0;for(;w<n/2;){const I=a[v],z=a[v+1];if(!z)return!1;let j=a[v-1].angleTo(I)-I.angleTo(z);for(j=Math.abs((j+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:w,angleDelta:j}),P+=j;w-T[0].distance>c;)P-=T.shift().angleDelta;if(P>h)return!1;v++,w+=I.dist(z)}return!0}function q_(a){let t=0;for(let n=0;n<a.length-1;n++)t+=a[n].dist(a[n+1]);return t}function G_(a,t,n){return a?.6*t*n:0}function Z_(a,t){return Math.max(a?a.right-a.left:0,t?t.right-t.left:0)}function ZT(a,t,n,c,h,_){const v=G_(n,h,_),w=Z_(n,c)*_;let T=0;const P=q_(a)/2;for(let I=0;I<a.length-1;I++){const z=a[I],j=a[I+1],B=z.dist(j);if(T+B>P){const N=(P-T)/B,q=Nn.number(z.x,j.x,N),H=Nn.number(z.y,j.y,N),J=new ls(q,H,j.angleTo(z),I);return J._round(),!v||V_(a,J,w,v,t)?J:void 0}T+=B}}function WT(a,t,n,c,h,_,v,w,T){const P=G_(c,_,v),I=Z_(c,h),z=I*v,j=a[0].x===0||a[0].x===T||a[0].y===0||a[0].y===T;return t-z<t/4&&(t=z+t/4),W_(a,j?t/2*w%t:(I/2+2*_)*v*w%t,t,P,n,z,j,!1,T)}function W_(a,t,n,c,h,_,v,w,T){const P=_/2,I=q_(a);let z=0,j=t-n,B=[];for(let N=0;N<a.length-1;N++){const q=a[N],H=a[N+1],J=q.dist(H),ue=H.angleTo(q);for(;j+n<z+J;){j+=n;const ae=(j-z)/J,se=Nn.number(q.x,H.x,ae),we=Nn.number(q.y,H.y,ae);if(se>=0&&se<T&&we>=0&&we<T&&j-P>=0&&j+P<=I){const Me=new ls(se,we,ue,N);Me._round(),c&&!V_(a,Me,_,c,h)||B.push(Me)}}z+=J}return w||B.length||v||(B=W_(a,z/2,n,c,h,_,v,!0,T)),B}function H_(a,t,n,c){const h=[],_=a.image,v=_.pixelRatio,w=_.paddedRect.w-2,T=_.paddedRect.h-2;let P={x1:a.left,y1:a.top,x2:a.right,y2:a.bottom};const I=_.stretchX||[[0,w]],z=_.stretchY||[[0,T]],j=(ze,dt)=>ze+dt[1]-dt[0],B=I.reduce(j,0),N=z.reduce(j,0),q=w-B,H=T-N;let J=0,ue=B,ae=0,se=N,we=0,Me=q,De=0,Ze=H;if(_.content&&c){const ze=_.content,dt=ze[2]-ze[0],ft=ze[3]-ze[1];(_.textFitWidth||_.textFitHeight)&&(P=w_(a)),J=gd(I,0,ze[0]),ae=gd(z,0,ze[1]),ue=gd(I,ze[0],ze[2]),se=gd(z,ze[1],ze[3]),we=ze[0]-J,De=ze[1]-ae,Me=dt-ue,Ze=ft-se}const Be=P.x1,qe=P.y1,at=P.x2-Be,Ue=P.y2-qe,Ge=(ze,dt,ft,lt)=>{const et=yd(ze.stretch-J,ue,at,Be),$t=_d(ze.fixed-we,Me,ze.stretch,B),kr=yd(dt.stretch-ae,se,Ue,qe),Wr=_d(dt.fixed-De,Ze,dt.stretch,N),_i=yd(ft.stretch-J,ue,at,Be),wn=_d(ft.fixed-we,Me,ft.stretch,B),Wi=yd(lt.stretch-ae,se,Ue,qe),oi=_d(lt.fixed-De,Ze,lt.stretch,N),vr=new C(et,kr),Qr=new C(_i,kr),si=new C(_i,Wi),li=new C(et,Wi),Bi=new C($t/v,Wr/v),Tn=new C(wn/v,oi/v),ei=t*Math.PI/180;if(ei){const ti=Math.sin(ei),ri=Math.cos(ei),$r=[ri,-ti,ti,ri];vr._matMult($r),Qr._matMult($r),li._matMult($r),si._matMult($r)}const Hi=ze.stretch+ze.fixed,Hr=dt.stretch+dt.fixed;return{tl:vr,tr:Qr,bl:li,br:si,tex:{x:_.paddedRect.x+1+Hi,y:_.paddedRect.y+1+Hr,w:ft.stretch+ft.fixed-Hi,h:lt.stretch+lt.fixed-Hr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Bi,pixelOffsetBR:Tn,minFontScaleX:Me/v/at,minFontScaleY:Ze/v/Ue,isSDF:n}};if(c&&(_.stretchX||_.stretchY)){const ze=X_(I,q,B),dt=X_(z,H,N);for(let ft=0;ft<ze.length-1;ft++){const lt=ze[ft],et=ze[ft+1];for(let $t=0;$t<dt.length-1;$t++)h.push(Ge(lt,dt[$t],et,dt[$t+1]))}}else h.push(Ge({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:T+1}));return h}function gd(a,t,n){let c=0;for(const h of a)c+=Math.max(t,Math.min(n,h[1]))-Math.max(t,Math.min(n,h[0]));return c}function X_(a,t,n){const c=[{fixed:-1,stretch:0}];for(const[h,_]of a){const v=c[c.length-1];c.push({fixed:h-v.stretch,stretch:v.stretch}),c.push({fixed:h-v.stretch,stretch:v.stretch+(_-h)})}return c.push({fixed:t+1,stretch:n}),c}function yd(a,t,n,c){return a/t*n+c}function _d(a,t,n,c){return a-t*n/c}Ke("Anchor",ls);class vd{constructor(t,n,c,h,_,v,w,T,P,I){var z;if(this.boxStartIndex=t.length,P){let j=v.top,B=v.bottom;const N=v.collisionPadding;N&&(j-=N[1],B+=N[3]);let q=B-j;q>0&&(q=Math.max(10,q),this.circleDiameter=q)}else{const j=!((z=v.image)===null||z===void 0)&&z.content&&(v.image.textFitWidth||v.image.textFitHeight)?w_(v):{x1:v.left,y1:v.top,x2:v.right,y2:v.bottom};j.y1=j.y1*w-T[0],j.y2=j.y2*w+T[2],j.x1=j.x1*w-T[3],j.x2=j.x2*w+T[1];const B=v.collisionPadding;if(B&&(j.x1-=B[0]*w,j.y1-=B[1]*w,j.x2+=B[2]*w,j.y2+=B[3]*w),I){const N=new C(j.x1,j.y1),q=new C(j.x2,j.y1),H=new C(j.x1,j.y2),J=new C(j.x2,j.y2),ue=I*Math.PI/180;N._rotate(ue),q._rotate(ue),H._rotate(ue),J._rotate(ue),j.x1=Math.min(N.x,q.x,H.x,J.x),j.x2=Math.max(N.x,q.x,H.x,J.x),j.y1=Math.min(N.y,q.y,H.y,J.y),j.y2=Math.max(N.y,q.y,H.y,J.y)}t.emplaceBack(n.x,n.y,j.x1,j.y1,j.x2,j.y2,c,h,_)}this.boxEndIndex=t.length}}class HT{constructor(t=[],n=(c,h)=>c<h?-1:c>h?1:0){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:c}=this,h=n[t];for(;t>0;){const _=t-1>>1,v=n[_];if(c(h,v)>=0)break;n[t]=v,t=_}n[t]=h}_down(t){const{data:n,compare:c}=this,h=this.length>>1,_=n[t];for(;t<h;){let v=1+(t<<1);const w=v+1;if(w<this.length&&c(n[w],n[v])<0&&(v=w),c(n[v],_)>=0)break;n[t]=n[v],t=v}n[t]=_}}function XT(a,t=1,n=!1){const c=Qs.fromPoints(a[0]),h=Math.min(c.width(),c.height());let _=h/2;const v=new HT([],KT),{minX:w,minY:T,maxX:P,maxY:I}=c;if(h===0)return new C(w,T);for(let B=w;B<P;B+=h)for(let N=T;N<I;N+=h)v.push(new kc(B+_,N+_,_,a));let z=(function(B){let N=0,q=0,H=0;const J=B[0];for(let ue=0,ae=J.length,se=ae-1;ue<ae;se=ue++){const we=J[ue],Me=J[se],De=we.x*Me.y-Me.x*we.y;q+=(we.x+Me.x)*De,H+=(we.y+Me.y)*De,N+=3*De}return new kc(q/N,H/N,0,B)})(a),j=v.length;for(;v.length;){const B=v.pop();(B.d>z.d||!z.d)&&(z=B,n&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,j)),B.max-z.d<=t||(_=B.h/2,v.push(new kc(B.p.x-_,B.p.y-_,_,a)),v.push(new kc(B.p.x+_,B.p.y-_,_,a)),v.push(new kc(B.p.x-_,B.p.y+_,_,a)),v.push(new kc(B.p.x+_,B.p.y+_,_,a)),j+=4)}return n&&(console.log(`num probes: ${j}`),console.log(`best distance: ${z.d}`)),z.p}function KT(a,t){return t.max-a.max}function kc(a,t,n,c){this.p=new C(a,t),this.h=n,this.d=(function(h,_){let v=!1,w=1/0;for(let T=0;T<_.length;T++){const P=_[T];for(let I=0,z=P.length,j=z-1;I<z;j=I++){const B=P[I],N=P[j];B.y>h.y!=N.y>h.y&&h.x<(N.x-B.x)*(h.y-B.y)/(N.y-B.y)+B.x&&(v=!v),w=Math.min(w,R0(h,B,N))}}return(v?1:-1)*Math.sqrt(w)})(this.p,c),this.max=this.d+this.h*Math.SQRT2}var yi;f.aE=void 0,(yi=f.aE||(f.aE={}))[yi.center=1]="center",yi[yi.left=2]="left",yi[yi.right=3]="right",yi[yi.top=4]="top",yi[yi.bottom=5]="bottom",yi[yi["top-left"]=6]="top-left",yi[yi["top-right"]=7]="top-right",yi[yi["bottom-left"]=8]="bottom-left",yi[yi["bottom-right"]=9]="bottom-right";const qm=Number.POSITIVE_INFINITY;function K_(a,t){return t[1]!==qm?(function(n,c,h){let _=0,v=0;switch(c=Math.abs(c),h=Math.abs(h),n){case"top-right":case"top-left":case"top":v=h-7;break;case"bottom-right":case"bottom-left":case"bottom":v=7-h}switch(n){case"top-right":case"bottom-right":case"right":_=-c;break;case"top-left":case"bottom-left":case"left":_=c}return[_,v]})(a,t[0],t[1]):(function(n,c){let h=0,_=0;c<0&&(c=0);const v=c/Math.SQRT2;switch(n){case"top-right":case"top-left":_=v-7;break;case"bottom-right":case"bottom-left":_=7-v;break;case"bottom":_=7-c;break;case"top":_=c-7}switch(n){case"top-right":case"bottom-right":h=-v;break;case"top-left":case"bottom-left":h=v;break;case"left":h=c;break;case"right":h=-c}return[h,_]})(a,t[0])}function Y_(a,t,n){var c;const h=a.layout,_=(c=h.get("text-variable-anchor-offset"))===null||c===void 0?void 0:c.evaluate(t,{},n);if(_){const w=_.values,T=[];for(let P=0;P<w.length;P+=2){const I=T[P]=w[P],z=w[P+1].map((j=>j*Jr));I.startsWith("top")?z[1]-=7:I.startsWith("bottom")&&(z[1]+=7),T[P+1]=z}return new wi(T)}const v=h.get("text-variable-anchor");if(v){let w;w=a._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[h.get("text-radial-offset").evaluate(t,{},n)*Jr,qm]:h.get("text-offset").evaluate(t,{},n).map((P=>P*Jr));const T=[];for(const P of v)T.push(P,K_(P,w));return new wi(T)}return null}function Gm(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function YT(a,t,n,c,h,_,v,w,T,P,I,z){let j=_.textMaxSize.evaluate(t,{});j===void 0&&(j=v);const B=a.layers[0].layout,N=B.get("icon-offset").evaluate(t,{},I),q=Q_(n.horizontal),H=v/24,J=a.tilePixelRatio*H,ue=a.tilePixelRatio*j/24,ae=a.tilePixelRatio*w,se=a.tilePixelRatio*B.get("symbol-spacing"),we=B.get("text-padding")*a.tilePixelRatio,Me=(function(ft,lt,et,$t=1){const kr=ft.get("icon-padding").evaluate(lt,{},et),Wr=kr&&kr.values;return[Wr[0]*$t,Wr[1]*$t,Wr[2]*$t,Wr[3]*$t]})(B,t,I,a.tilePixelRatio),De=B.get("text-max-angle")/180*Math.PI,Ze=B.get("text-rotation-alignment")!=="viewport"&&B.get("symbol-placement")!=="point",Be=B.get("icon-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",qe=B.get("symbol-placement"),at=se/2,Ue=B.get("icon-text-fit");let Ge;c&&Ue!=="none"&&(a.allowVerticalPlacement&&n.vertical&&(Ge=T_(c,n.vertical,Ue,B.get("icon-text-fit-padding"),N,H)),q&&(c=T_(c,q,Ue,B.get("icon-text-fit-padding"),N,H)));const ze=I?z.line.getGranularityForZoomLevel(I.z):1,dt=(ft,lt)=>{lt.x<0||lt.x>=Ft||lt.y<0||lt.y>=Ft||(function(et,$t,kr,Wr,_i,wn,Wi,oi,vr,Qr,si,li,Bi,Tn,ei,Hi,Hr,ti,ri,$r,mr,la,Cc,ca,eS){const Pc=et.addToLineVertexArray($t,kr);let el,Mc,Ac,Ic,iv=0,nv=0,av=0,ov=0,Qm=-1,eg=-1;const vo={};let sv=is("");if(et.allowVerticalPlacement&&Wr.vertical){const Ci=oi.layout.get("text-rotate").evaluate(mr,{},ca)+90;Ac=new vd(vr,$t,Qr,si,li,Wr.vertical,Bi,Tn,ei,Ci),Wi&&(Ic=new vd(vr,$t,Qr,si,li,Wi,Hr,ti,ei,Ci))}if(_i){const Ci=oi.layout.get("icon-rotate").evaluate(mr,{}),Sn=oi.layout.get("icon-text-fit")!=="none",tl=H_(_i,Ci,Cc,Sn),ha=Wi?H_(Wi,Ci,Cc,Sn):void 0;Mc=new vd(vr,$t,Qr,si,li,_i,Hr,ti,!1,Ci),iv=4*tl.length;const rl=et.iconSizeData;let Na=null;rl.kind==="source"?(Na=[_o*oi.layout.get("icon-size").evaluate(mr,{})],Na[0]>os&&tr(`${et.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):rl.kind==="composite"&&(Na=[_o*la.compositeIconSizes[0].evaluate(mr,{},ca),_o*la.compositeIconSizes[1].evaluate(mr,{},ca)],(Na[0]>os||Na[1]>os)&&tr(`${et.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),et.addSymbols(et.icon,tl,Na,$r,ri,mr,f.ao.none,$t,Pc.lineStartIndex,Pc.lineLength,-1,ca),Qm=et.icon.placedSymbolArray.length-1,ha&&(nv=4*ha.length,et.addSymbols(et.icon,ha,Na,$r,ri,mr,f.ao.vertical,$t,Pc.lineStartIndex,Pc.lineLength,-1,ca),eg=et.icon.placedSymbolArray.length-1)}const lv=Object.keys(Wr.horizontal);for(const Ci of lv){const Sn=Wr.horizontal[Ci];if(!el){sv=is(Sn.text);const ha=oi.layout.get("text-rotate").evaluate(mr,{},ca);el=new vd(vr,$t,Qr,si,li,Sn,Bi,Tn,ei,ha)}const tl=Sn.positionedLines.length===1;if(av+=J_(et,$t,Sn,wn,oi,ei,mr,Hi,Pc,Wr.vertical?f.ao.horizontal:f.ao.horizontalOnly,tl?lv:[Ci],vo,Qm,la,ca),tl)break}Wr.vertical&&(ov+=J_(et,$t,Wr.vertical,wn,oi,ei,mr,Hi,Pc,f.ao.vertical,["vertical"],vo,eg,la,ca));const tS=el?el.boxStartIndex:et.collisionBoxArray.length,rS=el?el.boxEndIndex:et.collisionBoxArray.length,iS=Ac?Ac.boxStartIndex:et.collisionBoxArray.length,nS=Ac?Ac.boxEndIndex:et.collisionBoxArray.length,aS=Mc?Mc.boxStartIndex:et.collisionBoxArray.length,oS=Mc?Mc.boxEndIndex:et.collisionBoxArray.length,sS=Ic?Ic.boxStartIndex:et.collisionBoxArray.length,lS=Ic?Ic.boxEndIndex:et.collisionBoxArray.length;let ua=-1;const xd=(Ci,Sn)=>Ci&&Ci.circleDiameter?Math.max(Ci.circleDiameter,Sn):Sn;ua=xd(el,ua),ua=xd(Ac,ua),ua=xd(Mc,ua),ua=xd(Ic,ua);const cv=ua>-1?1:0;cv&&(ua*=eS/Jr),et.glyphOffsetArray.length>=Tc.MAX_GLYPHS&&tr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),mr.sortKey!==void 0&&et.addToSortKeyRanges(et.symbolInstances.length,mr.sortKey);const cS=Y_(oi,mr,ca),[uS,hS]=(function(Ci,Sn){const tl=Ci.length,ha=Sn?.values;if(ha?.length>0)for(let rl=0;rl<ha.length;rl+=2){const Na=ha[rl+1];Ci.emplaceBack(f.aE[ha[rl]],Na[0],Na[1])}return[tl,Ci.length]})(et.textAnchorOffsets,cS);et.symbolInstances.emplaceBack($t.x,$t.y,vo.right>=0?vo.right:-1,vo.center>=0?vo.center:-1,vo.left>=0?vo.left:-1,vo.vertical||-1,Qm,eg,sv,tS,rS,iS,nS,aS,oS,sS,lS,Qr,av,ov,iv,nv,cv,0,Bi,ua,uS,hS)})(a,lt,ft,n,c,h,Ge,a.layers[0],a.collisionBoxArray,t.index,t.sourceLayerIndex,a.index,J,[we,we,we,we],Ze,T,ae,Me,Be,N,t,_,P,I,v)};if(qe==="line")for(const ft of U_(t.geometry,0,0,Ft,Ft)){const lt=Js(ft,ze),et=WT(lt,se,De,n.vertical||q,c,24,ue,a.overscaling,Ft);for(const $t of et)q&&JT(a,q.text,at,$t)||dt(lt,$t)}else if(qe==="line-center"){for(const ft of t.geometry)if(ft.length>1){const lt=Js(ft,ze),et=ZT(lt,De,n.vertical||q,c,24,ue);et&&dt(lt,et)}}else if(t.type==="Polygon")for(const ft of Ds(t.geometry,0)){const lt=XT(ft,16);dt(Js(ft[0],ze,!0),new ls(lt.x,lt.y,0))}else if(t.type==="LineString")for(const ft of t.geometry){const lt=Js(ft,ze);dt(lt,new ls(lt[0].x,lt[0].y,0))}else if(t.type==="Point")for(const ft of t.geometry)for(const lt of ft)dt([lt],new ls(lt.x,lt.y,0))}function J_(a,t,n,c,h,_,v,w,T,P,I,z,j,B,N){const q=(function(ue,ae,se,we,Me,De,Ze,Be){const qe=we.layout.get("text-rotate").evaluate(De,{})*Math.PI/180,at=[];for(const Ue of ae.positionedLines)for(const Ge of Ue.positionedGlyphs){if(!Ge.rect)continue;const ze=Ge.rect||{};let dt=4,ft=!0,lt=1,et=0;const $t=(Me||Be)&&Ge.vertical,kr=Ge.metrics.advance*Ge.scale/2;if(Be&&ae.verticalizable&&(et=Ue.lineOffset/2-(Ge.imageName?-(Jr-Ge.metrics.width*Ge.scale)/2:(Ge.scale-1)*Jr)),Ge.imageName){const ti=Ze[Ge.imageName];ft=ti.sdf,lt=ti.pixelRatio,dt=1/lt}const Wr=Me?[Ge.x+kr,Ge.y]:[0,0];let _i=Me?[0,0]:[Ge.x+kr+se[0],Ge.y+se[1]-et],wn=[0,0];$t&&(wn=_i,_i=[0,0]);const Wi=Ge.metrics.isDoubleResolution?2:1,oi=(Ge.metrics.left-dt)*Ge.scale-kr+_i[0],vr=(-Ge.metrics.top-dt)*Ge.scale+_i[1],Qr=oi+ze.w/Wi*Ge.scale/lt,si=vr+ze.h/Wi*Ge.scale/lt,li=new C(oi,vr),Bi=new C(Qr,vr),Tn=new C(oi,si),ei=new C(Qr,si);if($t){const ti=new C(-kr,kr- -17),ri=-Math.PI/2,$r=12-kr,mr=new C(22-$r,-(Ge.imageName?$r:0)),la=new C(...wn);li._rotateAround(ri,ti)._add(mr)._add(la),Bi._rotateAround(ri,ti)._add(mr)._add(la),Tn._rotateAround(ri,ti)._add(mr)._add(la),ei._rotateAround(ri,ti)._add(mr)._add(la)}if(qe){const ti=Math.sin(qe),ri=Math.cos(qe),$r=[ri,-ti,ti,ri];li._matMult($r),Bi._matMult($r),Tn._matMult($r),ei._matMult($r)}const Hi=new C(0,0),Hr=new C(0,0);at.push({tl:li,tr:Bi,bl:Tn,br:ei,tex:ze,writingMode:ae.writingMode,glyphOffset:Wr,sectionIndex:Ge.sectionIndex,isSDF:ft,pixelOffsetTL:Hi,pixelOffsetBR:Hr,minFontScaleX:0,minFontScaleY:0})}return at})(0,n,w,h,_,v,c,a.allowVerticalPlacement),H=a.textSizeData;let J=null;H.kind==="source"?(J=[_o*h.layout.get("text-size").evaluate(v,{})],J[0]>os&&tr(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):H.kind==="composite"&&(J=[_o*B.compositeTextSizes[0].evaluate(v,{},N),_o*B.compositeTextSizes[1].evaluate(v,{},N)],(J[0]>os||J[1]>os)&&tr(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,q,J,w,_,v,P,t,T.lineStartIndex,T.lineLength,j,N);for(const ue of I)z[ue]=a.text.placedSymbolArray.length-1;return 4*q.length}function Q_(a){for(const t in a)return a[t];return null}function JT(a,t,n,c){const h=a.compareText;if(t in h){const _=h[t];for(let v=_.length-1;v>=0;v--)if(c.dist(_[v])<n)return!0}else h[t]=[];return h[t].push(c),!1}const ev=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Zm{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,c]=new Uint8Array(t,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=c>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const _=ev[15&c];if(!_)throw new Error("Unrecognized array type.");const[v]=new Uint16Array(t,2,1),[w]=new Uint32Array(t,4,1);return new Zm(w,v,_,t)}constructor(t,n=64,c=Float64Array,h){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=c,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const _=ev.indexOf(this.ArrayType),v=2*t*this.ArrayType.BYTES_PER_ELEMENT,w=t*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-w%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${c}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+w+T,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+v+w+T),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+w+T,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=t,this.coords[this._pos++]=n,c}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Wm(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,c,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:v,nodeSize:w}=this,T=[0,_.length-1,0],P=[];for(;T.length;){const I=T.pop()||0,z=T.pop()||0,j=T.pop()||0;if(z-j<=w){for(let H=j;H<=z;H++){const J=v[2*H],ue=v[2*H+1];J>=t&&J<=c&&ue>=n&&ue<=h&&P.push(_[H])}continue}const B=j+z>>1,N=v[2*B],q=v[2*B+1];N>=t&&N<=c&&q>=n&&q<=h&&P.push(_[B]),(I===0?t<=N:n<=q)&&(T.push(j),T.push(B-1),T.push(1-I)),(I===0?c>=N:h>=q)&&(T.push(B+1),T.push(z),T.push(1-I))}return P}within(t,n,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:_,nodeSize:v}=this,w=[0,h.length-1,0],T=[],P=c*c;for(;w.length;){const I=w.pop()||0,z=w.pop()||0,j=w.pop()||0;if(z-j<=v){for(let H=j;H<=z;H++)rv(_[2*H],_[2*H+1],t,n)<=P&&T.push(h[H]);continue}const B=j+z>>1,N=_[2*B],q=_[2*B+1];rv(N,q,t,n)<=P&&T.push(h[B]),(I===0?t-c<=N:n-c<=q)&&(w.push(j),w.push(B-1),w.push(1-I)),(I===0?t+c>=N:n+c>=q)&&(w.push(B+1),w.push(z),w.push(1-I))}return T}}function Wm(a,t,n,c,h,_){if(h-c<=n)return;const v=c+h>>1;tv(a,t,v,c,h,_),Wm(a,t,n,c,v-1,1-_),Wm(a,t,n,v+1,h,1-_)}function tv(a,t,n,c,h,_){for(;h>c;){if(h-c>600){const P=h-c+1,I=n-c+1,z=Math.log(P),j=.5*Math.exp(2*z/3),B=.5*Math.sqrt(z*j*(P-j)/P)*(I-P/2<0?-1:1);tv(a,t,n,Math.max(c,Math.floor(n-I*j/P+B)),Math.min(h,Math.floor(n+(P-I)*j/P+B)),_)}const v=t[2*n+_];let w=c,T=h;for(yh(a,t,c,n),t[2*h+_]>v&&yh(a,t,c,h);w<T;){for(yh(a,t,w,T),w++,T--;t[2*w+_]<v;)w++;for(;t[2*T+_]>v;)T--}t[2*c+_]===v?yh(a,t,c,T):(T++,yh(a,t,T,h)),T<=n&&(c=T+1),n<=T&&(h=T-1)}}function yh(a,t,n,c){Hm(a,n,c),Hm(t,2*n,2*c),Hm(t,2*n+1,2*c+1)}function Hm(a,t,n){const c=a[t];a[t]=a[n],a[n]=c}function rv(a,t,n,c){const h=a-n,_=t-c;return h*h+_*_}var Xm;f.cx=void 0,(Xm=f.cx||(f.cx={})).create="create",Xm.load="load",Xm.fullLoad="fullLoad";let bd=null,_h=[];const Km=1e3/60,Ym="loadTime",Jm="fullLoadTime",QT={mark(a){performance.mark(a)},frame(a){const t=a;bd!=null&&_h.push(t-bd),bd=t},clearMetrics(){bd=null,_h=[],performance.clearMeasures(Ym),performance.clearMeasures(Jm);for(const a in f.cx)performance.clearMarks(f.cx[a])},getPerformanceMetrics(){performance.measure(Ym,f.cx.create,f.cx.load),performance.measure(Jm,f.cx.create,f.cx.fullLoad);const a=performance.getEntriesByName(Ym)[0].duration,t=performance.getEntriesByName(Jm)[0].duration,n=_h.length,c=1/(_h.reduce(((_,v)=>_+v),0)/n/1e3),h=_h.filter((_=>_>Km)).reduce(((_,v)=>_+(v-Km)/Km),0);return{loadTime:a,fullLoadTime:t,fps:c,percentDroppedFrames:h/(n+h)*100,totalFrames:n}}};f.$=Ft,f.A=Pe,f.B=function([a,t,n]){return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:a*Math.cos(t)*Math.sin(n),y:a*Math.sin(t)*Math.sin(n),z:a*Math.cos(n)}},f.C=Nn,f.D=rt,f.E=tt,f.F=gr,f.G=Gs,f.H=function(a){if(Xa==null){const t=a.navigator?a.navigator.userAgent:null;Xa=!!a.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Xa},f.I=Rm,f.J=class{constructor(a,t){this.target=a,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new VT((()=>this.process())),this.subscription=Ta(this.target,"message",(n=>this.receive(n)),!1),this.globalScope=Li(self)?a:window}registerMessageHandler(a,t){this.messageHandlers[a]=t}sendAsync(a,t){return new Promise(((n,c)=>{const h=Math.round(1e18*Math.random()).toString(36).substring(0,10),_=t?Ta(t.signal,"abort",(()=>{_?.unsubscribe(),delete this.resolveRejects[h];const T={id:h,type:"<cancel>",origin:location.origin,targetMapId:a.targetMapId,sourceMapId:this.mapId};this.target.postMessage(T)}),qT):null;this.resolveRejects[h]={resolve:T=>{_?.unsubscribe(),n(T)},reject:T=>{_?.unsubscribe(),c(T)}};const v=[],w=Object.assign(Object.assign({},a),{id:h,sourceMapId:this.mapId,origin:location.origin,data:Yo(a.data,v)});this.target.postMessage(w,{transfer:v})}))}receive(a){const t=a.data,n=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[n];const c=this.abortControllers[n];return delete this.abortControllers[n],void(c&&c.abort())}if(Li(self)||t.mustQueue)return this.tasks[n]=t,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,t)}}process(){if(this.taskQueue.length===0)return;const a=this.taskQueue.shift(),t=this.tasks[a];delete this.tasks[a],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(a,t)}processTask(a,t){return l(this,void 0,void 0,(function*(){if(t.type==="<response>"){const h=this.resolveRejects[a];return delete this.resolveRejects[a],h?void(t.error?h.reject(po(t.error)):h.resolve(po(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(a,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=po(t.data),c=new AbortController;this.abortControllers[a]=c;try{const h=yield this.messageHandlers[t.type](t.sourceMapId,n,c);this.completeTask(a,null,h)}catch(h){this.completeTask(a,h)}}))}completeTask(a,t,n){const c=[];delete this.abortControllers[a];const h={id:a,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Yo(t):null,data:Yo(n,c)};this.target.postMessage(h,{transfer:c})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},f.K=W,f.L=function(){var a=new Pe(16);return Pe!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},f.M=function(a,t,n){var c,h,_,v,w,T,P,I,z,j,B,N,q=n[0],H=n[1],J=n[2];return t===a?(a[12]=t[0]*q+t[4]*H+t[8]*J+t[12],a[13]=t[1]*q+t[5]*H+t[9]*J+t[13],a[14]=t[2]*q+t[6]*H+t[10]*J+t[14],a[15]=t[3]*q+t[7]*H+t[11]*J+t[15]):(h=t[1],_=t[2],v=t[3],w=t[4],T=t[5],P=t[6],I=t[7],z=t[8],j=t[9],B=t[10],N=t[11],a[0]=c=t[0],a[1]=h,a[2]=_,a[3]=v,a[4]=w,a[5]=T,a[6]=P,a[7]=I,a[8]=z,a[9]=j,a[10]=B,a[11]=N,a[12]=c*q+w*H+z*J+t[12],a[13]=h*q+T*H+j*J+t[13],a[14]=_*q+P*H+B*J+t[14],a[15]=v*q+I*H+N*J+t[15]),a},f.N=function(a,t,n){var c=n[0],h=n[1],_=n[2];return a[0]=t[0]*c,a[1]=t[1]*c,a[2]=t[2]*c,a[3]=t[3]*c,a[4]=t[4]*h,a[5]=t[5]*h,a[6]=t[6]*h,a[7]=t[7]*h,a[8]=t[8]*_,a[9]=t[9]*_,a[10]=t[10]*_,a[11]=t[11]*_,a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a},f.O=function(a,t,n){var c=t[0],h=t[1],_=t[2],v=t[3],w=t[4],T=t[5],P=t[6],I=t[7],z=t[8],j=t[9],B=t[10],N=t[11],q=t[12],H=t[13],J=t[14],ue=t[15],ae=n[0],se=n[1],we=n[2],Me=n[3];return a[0]=ae*c+se*w+we*z+Me*q,a[1]=ae*h+se*T+we*j+Me*H,a[2]=ae*_+se*P+we*B+Me*J,a[3]=ae*v+se*I+we*N+Me*ue,a[4]=(ae=n[4])*c+(se=n[5])*w+(we=n[6])*z+(Me=n[7])*q,a[5]=ae*h+se*T+we*j+Me*H,a[6]=ae*_+se*P+we*B+Me*J,a[7]=ae*v+se*I+we*N+Me*ue,a[8]=(ae=n[8])*c+(se=n[9])*w+(we=n[10])*z+(Me=n[11])*q,a[9]=ae*h+se*T+we*j+Me*H,a[10]=ae*_+se*P+we*B+Me*J,a[11]=ae*v+se*I+we*N+Me*ue,a[12]=(ae=n[12])*c+(se=n[13])*w+(we=n[14])*z+(Me=n[15])*q,a[13]=ae*h+se*T+we*j+Me*H,a[14]=ae*_+se*P+we*B+Me*J,a[15]=ae*v+se*I+we*N+Me*ue,a},f.P=C,f.Q=function(a,t){const n={};for(let c=0;c<t.length;c++){const h=t[c];h in a&&(n[h]=a[h])}return n},f.R=Zi,f.S=ss,f.T=wm,f.U=R_,f.V=z_,f.W=Ee,f.X=_e,f.Y=zo,f.Z=xn,f._=l,f.a=V,f.a$=ur,f.a0=function(a,t){var n,c,h,_;if(!a)return t??{};if(!t)return a;const v=Object.assign({},a);if(t.removeAll&&(v.removeAll=!0),t.remove){const w=new Set(v.remove?v.remove.concat(t.remove):t.remove);v.remove=Array.from(w.values())}if(t.add){const w=v.add?v.add.concat(t.add):t.add,T=new Map(w.map((P=>[P.id,P])));v.add=Array.from(T.values())}if(t.update){const w=new Map((n=v.update)===null||n===void 0?void 0:n.map((T=>[T.id,T])));for(const T of t.update){const P=(c=w.get(T.id))!==null&&c!==void 0?c:{id:T.id};T.newGeometry&&(P.newGeometry=T.newGeometry),T.addOrUpdateProperties&&(P.addOrUpdateProperties=((h=P.addOrUpdateProperties)!==null&&h!==void 0?h:[]).concat(T.addOrUpdateProperties)),T.removeProperties&&(P.removeProperties=((_=P.removeProperties)!==null&&_!==void 0?_:[]).concat(T.removeProperties)),T.removeAllProperties&&(P.removeAllProperties=!0),w.set(T.id,P)}v.update=Array.from(w.values())}return v},f.a1=mh,f.a2=Qs,f.a3=25,f.a4=Vm,f.a5=a=>{const t=window.document.createElement("video");return t.muted=!0,new Promise((n=>{t.onloadstart=()=>{n(t)};for(const c of a){const h=window.document.createElement("source");Te(c)||(t.crossOrigin="Anonymous"),h.src=c,t.appendChild(h)}}))},f.a6=Oe,f.a7=function(){return Cr++},f.a8=R,f.a9=Tc,f.aA=function(a){let t=1/0,n=1/0,c=-1/0,h=-1/0;for(const _ of a)t=Math.min(t,_.x),n=Math.min(n,_.y),c=Math.max(c,_.x),h=Math.max(h,_.y);return[t,n,c,h]},f.aB=Jr,f.aC=Ye,f.aD=function(a,t,n,c,h=!1){if(!n[0]&&!n[1])return[0,0];const _=h?c==="map"?-a.bearingInRadians:0:c==="viewport"?a.bearingInRadians:0;if(_){const v=Math.sin(_),w=Math.cos(_);n=[n[0]*w-n[1]*v,n[0]*v+n[1]*w]}return[h?n[0]:Ye(t,n[0],a.zoom),h?n[1]:Ye(t,n[1],a.zoom)]},f.aF=jm,f.aG=Gm,f.aH=Dm,f.aI=Zm,f.aJ=Ar,f.aK=ud,f.aL=te,f.aM=xt,f.aN=nr,f.aO=yr,f.aP=Sa,f.aQ=D_,f.aR=nt,f.aS=gt,f.aT=function(a){var t=new Pe(3);return t[0]=a[0],t[1]=a[1],t[2]=a[2],t},f.aU=function(a,t,n){return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],a},f.aV=function(a,t){var n=t[0],c=t[1],h=t[2],_=n*n+c*c+h*h;return _>0&&(_=1/Math.sqrt(_)),a[0]=t[0]*_,a[1]=t[1]*_,a[2]=t[2]*_,a},f.aW=Zt,f.aX=function(a,t){return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]},f.aY=function(a,t,n){return a[0]=t[0]*n[0],a[1]=t[1]*n[1],a[2]=t[2]*n[2],a[3]=t[3]*n[3],a},f.aZ=Ne,f.a_=function(a,t,n){const c=t[0]*n[0]+t[1]*n[1]+t[2]*n[2];return c===0?null:(-(a[0]*n[0]+a[1]*n[1]+a[2]*n[2])-n[3])/c},f.aa=co,f.ab=sa,f.ac=B_,f.ad=function(a){const t={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((n,c,h,_)=>{const v=h||_;return t[c]=!v||v.toLowerCase(),""})),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t},f.ae=Ka,f.af=function(a){return Math.pow(2,a)},f.ag=ye,f.ah=Vt,f.ai=85.051129,f.aj=L_,f.ak=function(a){return Math.log(a)/Math.LN2},f.al=function(a){var t=a[0],n=a[1];return t*t+n*n},f.am=function(a,t){const n=[];for(const c in a)c in t||n.push(c);return n},f.an=function(a,t){let n=0,c=0;if(a.kind==="constant")c=a.layoutSize;else if(a.kind!=="source"){const{interpolationType:h,minZoom:_,maxZoom:v}=a,w=h?Vt(ai.interpolationFactor(h,t,_,v),0,1):0;a.kind==="camera"?c=Nn.number(a.minSize,a.maxSize,w):n=w}return{uSizeT:n,uSize:c}},f.ap=function(a,{uSize:t,uSizeT:n},{lowerSize:c,upperSize:h}){return a.kind==="source"?c/_o:a.kind==="composite"?Nn.number(c/_o,h/_o,n):t},f.aq=function(a,t){var n=t[0],c=t[1],h=t[2],_=t[3],v=t[4],w=t[5],T=t[6],P=t[7],I=t[8],z=t[9],j=t[10],B=t[11],N=t[12],q=t[13],H=t[14],J=t[15],ue=n*w-c*v,ae=n*T-h*v,se=n*P-_*v,we=c*T-h*w,Me=c*P-_*w,De=h*P-_*T,Ze=I*q-z*N,Be=I*H-j*N,qe=I*J-B*N,at=z*H-j*q,Ue=z*J-B*q,Ge=j*J-B*H,ze=ue*Ge-ae*Ue+se*at+we*qe-Me*Be+De*Ze;return ze?(a[0]=(w*Ge-T*Ue+P*at)*(ze=1/ze),a[1]=(h*Ue-c*Ge-_*at)*ze,a[2]=(q*De-H*Me+J*we)*ze,a[3]=(j*Me-z*De-B*we)*ze,a[4]=(T*qe-v*Ge-P*Be)*ze,a[5]=(n*Ge-h*qe+_*Be)*ze,a[6]=(H*se-N*De-J*ae)*ze,a[7]=(I*De-j*se+B*ae)*ze,a[8]=(v*Ue-w*qe+P*Ze)*ze,a[9]=(c*qe-n*Ue-_*Ze)*ze,a[10]=(N*Me-q*se+J*ue)*ze,a[11]=(z*se-I*Me-B*ue)*ze,a[12]=(w*Be-v*at-T*Ze)*ze,a[13]=(n*at-c*Be+h*Ze)*ze,a[14]=(q*ae-N*we-H*ue)*ze,a[15]=(I*we-z*ae+j*ue)*ze,a):null},f.ar=Ri,f.as=function(a){return Math.hypot(a[0],a[1])},f.at=function(a){return a[0]=0,a[1]=0,a},f.au=function(a,t,n){return a[0]=t[0]*n,a[1]=t[1]*n,a},f.av=Fm,f.aw=hi,f.ax=function(a,t,n,c){const h=t.y-a.y,_=t.x-a.x,v=c.y-n.y,w=c.x-n.x,T=v*_-w*h;if(T===0)return null;const P=(w*(a.y-n.y)-v*(a.x-n.x))/T;return new C(a.x+P*_,a.y+P*h)},f.ay=U_,f.az=E0,f.b=jn,f.b$=class extends g{},f.b0=function(a,t,n){return a[0]=t[0]*n,a[1]=t[1]*n,a[2]=t[2]*n,a[3]=t[3]*n,a},f.b1=function(a,t){return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]+a[3]},f.b2=F_,f.b3=Sc,f.b4=function(a,t,n,c,h){var _,v=1/Math.tan(t/2);return a[0]=v/n,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=v,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,h!=null&&h!==1/0?(a[10]=(h+c)*(_=1/(c-h)),a[14]=2*h*c*_):(a[10]=-1,a[14]=-2*c),a},f.b5=function(a){var t=new Pe(16);return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},f.b6=function(a,t,n){var c=Math.sin(n),h=Math.cos(n),_=t[0],v=t[1],w=t[2],T=t[3],P=t[4],I=t[5],z=t[6],j=t[7];return t!==a&&(a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[0]=_*h+P*c,a[1]=v*h+I*c,a[2]=w*h+z*c,a[3]=T*h+j*c,a[4]=P*h-_*c,a[5]=I*h-v*c,a[6]=z*h-w*c,a[7]=j*h-T*c,a},f.b7=function(a,t,n){var c=Math.sin(n),h=Math.cos(n),_=t[4],v=t[5],w=t[6],T=t[7],P=t[8],I=t[9],z=t[10],j=t[11];return t!==a&&(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[4]=_*h+P*c,a[5]=v*h+I*c,a[6]=w*h+z*c,a[7]=T*h+j*c,a[8]=P*h-_*c,a[9]=I*h-v*c,a[10]=z*h-w*c,a[11]=j*h-T*c,a},f.b8=function(){const a=new Float32Array(16);return ye(a),a},f.b9=function(){const a=new Float64Array(16);return ye(a),a},f.bA=function(a,t){const n=st(a,360),c=st(t,360),h=c-n,_=c>n?h-360:h+360;return Math.abs(h)<Math.abs(_)?h:_},f.bB=function(a){return a[0]=0,a[1]=0,a[2]=0,a},f.bC=function(a,t,n,c){const h=Math.sqrt(a*a+t*t),_=Math.sqrt(n*n+c*c);a/=h,t/=h,n/=_,c/=_;const v=Math.acos(a*n+t*c);return-t*n+a*c>0?v:-v},f.bD=function(a,t){const n=st(a,2*Math.PI),c=st(t,2*Math.PI);return Math.min(Math.abs(n-c),Math.abs(n-c+2*Math.PI),Math.abs(n-c-2*Math.PI))},f.bE=function(){const a={},t=ge.$version;for(const n in ge.$root){const c=ge.$root[n];if(c.required){let h=null;h=n==="version"?t:c.type==="array"?[]:{},h!=null&&(a[n]=h)}}return a},f.bF=ac,f.bG=ce,f.bH=function a(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(let c=0;c<t.length;c++)if(!a(t[c],n[c]))return!1;return!0}if(typeof t=="object"&&t!==null&&n!==null){if(typeof n!="object"||Object.keys(t).length!==Object.keys(n).length)return!1;for(const c in t)if(!a(t[c],n[c]))return!1;return!0}return t===n},f.bI=function(a){a=a.slice();const t=Object.create(null);for(let n=0;n<a.length;n++)t[a[n].id]=a[n];for(let n=0;n<a.length;n++)"ref"in a[n]&&(a[n]=Ct(a[n],t[a[n].ref]));return a},f.bJ=function(a){if(a.type==="custom")return new UT(a);switch(a.type){case"background":return new BT(a);case"circle":return new S2(a);case"color-relief":return new I2(a);case"fill":return new G2(a);case"fill-extrusion":return new rT(a);case"heatmap":return new C2(a);case"hillshade":return new M2(a);case"line":return new cT(a);case"raster":return new NT(a);case"symbol":return new md(a)}},f.bK=dr,f.bL=function(a,t){if(!a)return[{command:"setStyle",args:[t]}];let n=[];try{if(!ot(a.version,t.version))return[{command:"setStyle",args:[t]}];ot(a.center,t.center)||n.push({command:"setCenter",args:[t.center]}),ot(a.state,t.state)||n.push({command:"setGlobalState",args:[t.state]}),ot(a.centerAltitude,t.centerAltitude)||n.push({command:"setCenterAltitude",args:[t.centerAltitude]}),ot(a.zoom,t.zoom)||n.push({command:"setZoom",args:[t.zoom]}),ot(a.bearing,t.bearing)||n.push({command:"setBearing",args:[t.bearing]}),ot(a.pitch,t.pitch)||n.push({command:"setPitch",args:[t.pitch]}),ot(a.roll,t.roll)||n.push({command:"setRoll",args:[t.roll]}),ot(a.sprite,t.sprite)||n.push({command:"setSprite",args:[t.sprite]}),ot(a.glyphs,t.glyphs)||n.push({command:"setGlyphs",args:[t.glyphs]}),ot(a.transition,t.transition)||n.push({command:"setTransition",args:[t.transition]}),ot(a.light,t.light)||n.push({command:"setLight",args:[t.light]}),ot(a.terrain,t.terrain)||n.push({command:"setTerrain",args:[t.terrain]}),ot(a.sky,t.sky)||n.push({command:"setSky",args:[t.sky]}),ot(a.projection,t.projection)||n.push({command:"setProjection",args:[t.projection]});const c={},h=[];(function(v,w,T,P){let I;for(I in w=w||{},v=v||{})Object.prototype.hasOwnProperty.call(v,I)&&(Object.prototype.hasOwnProperty.call(w,I)||Vr(I,T,P));for(I in w)Object.prototype.hasOwnProperty.call(w,I)&&(Object.prototype.hasOwnProperty.call(v,I)?ot(v[I],w[I])||(v[I].type==="geojson"&&w[I].type==="geojson"&&zr(v,w,I)?bt(T,{command:"setGeoJSONSourceData",args:[I,w[I].data]}):qr(I,w,T,P)):hr(I,w,T))})(a.sources,t.sources,h,c);const _=[];a.layers&&a.layers.forEach((v=>{"source"in v&&c[v.source]?n.push({command:"removeLayer",args:[v.id]}):_.push(v)})),n=n.concat(h),(function(v,w,T){w=w||[];const P=(v=v||[]).map(qt),I=w.map(qt),z=v.reduce(Dr,{}),j=w.reduce(Dr,{}),B=P.slice(),N=Object.create(null);let q,H,J,ue,ae;for(let se=0,we=0;se<P.length;se++)q=P[se],Object.prototype.hasOwnProperty.call(j,q)?we++:(bt(T,{command:"removeLayer",args:[q]}),B.splice(B.indexOf(q,we),1));for(let se=0,we=0;se<I.length;se++)q=I[I.length-1-se],B[B.length-1-se]!==q&&(Object.prototype.hasOwnProperty.call(z,q)?(bt(T,{command:"removeLayer",args:[q]}),B.splice(B.lastIndexOf(q,B.length-we),1)):we++,ue=B[B.length-se],bt(T,{command:"addLayer",args:[j[q],ue]}),B.splice(B.length-se,0,q),N[q]=!0);for(let se=0;se<I.length;se++)if(q=I[se],H=z[q],J=j[q],!N[q]&&!ot(H,J))if(ot(H.source,J.source)&&ot(H["source-layer"],J["source-layer"])&&ot(H.type,J.type)){for(ae in zt(H.layout,J.layout,T,q,null,"setLayoutProperty"),zt(H.paint,J.paint,T,q,null,"setPaintProperty"),ot(H.filter,J.filter)||bt(T,{command:"setFilter",args:[q,J.filter]}),ot(H.minzoom,J.minzoom)&&ot(H.maxzoom,J.maxzoom)||bt(T,{command:"setLayerZoomRange",args:[q,J.minzoom,J.maxzoom]}),H)Object.prototype.hasOwnProperty.call(H,ae)&&ae!=="layout"&&ae!=="paint"&&ae!=="filter"&&ae!=="metadata"&&ae!=="minzoom"&&ae!=="maxzoom"&&(ae.indexOf("paint.")===0?zt(H[ae],J[ae],T,q,ae.slice(6),"setPaintProperty"):ot(H[ae],J[ae])||bt(T,{command:"setLayerProperty",args:[q,ae,J[ae]]}));for(ae in J)Object.prototype.hasOwnProperty.call(J,ae)&&!Object.prototype.hasOwnProperty.call(H,ae)&&ae!=="layout"&&ae!=="paint"&&ae!=="filter"&&ae!=="metadata"&&ae!=="minzoom"&&ae!=="maxzoom"&&(ae.indexOf("paint.")===0?zt(H[ae],J[ae],T,q,ae.slice(6),"setPaintProperty"):ot(H[ae],J[ae])||bt(T,{command:"setLayerProperty",args:[q,ae,J[ae]]}))}else bt(T,{command:"removeLayer",args:[q]}),ue=B[B.lastIndexOf(q)+1],bt(T,{command:"addLayer",args:[J,ue]})})(_,t.layers,n)}catch(c){console.warn("Unable to compute style diff:",c),n=[{command:"setStyle",args:[t]}]}return n},f.bM=function(a){const t=[],n=a.id;return n===void 0&&t.push({message:`layers.${n}: missing required property "id"`}),a.render===void 0&&t.push({message:`layers.${n}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},f.bN=di,f.bO=xr,f.bP=class extends ki{constructor(a,t){super(a,t),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},f.bQ=Zr,f.bR=class extends ki{constructor(a,t){super(a,t),this.current=nn}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let t=1;t<16;t++)if(a[t]!==this.current[t]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},f.bS=Or,f.bT=class extends ki{constructor(a,t){super(a,t),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},f.bU=class extends ki{constructor(a,t){super(a,t),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},f.bV=ve,f.bW=function(a,t){var n=Math.sin(t),c=Math.cos(t);return a[0]=c,a[1]=n,a[2]=0,a[3]=-n,a[4]=c,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},f.bX=function(a,t,n){var c=t[0],h=t[1],_=t[2];return a[0]=c*n[0]+h*n[3]+_*n[6],a[1]=c*n[1]+h*n[4]+_*n[7],a[2]=c*n[2]+h*n[5]+_*n[8],a},f.bY=function(a,t,n,c,h,_,v){var w=1/(t-n),T=1/(c-h),P=1/(_-v);return a[0]=-2*w,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*T,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*P,a[11]=0,a[12]=(t+n)*w,a[13]=(h+c)*T,a[14]=(v+_)*P,a[15]=1,a},f.bZ=class extends ki{constructor(a,t){super(a,t),this.current=new Array}set(a){if(a!=this.current){this.current=a;const t=new Float32Array(4*a.length);for(let n=0;n<a.length;n++)t[4*n]=a[n].r,t[4*n+1]=a[n].g,t[4*n+2]=a[n].b,t[4*n+3]=a[n].a;this.gl.uniform4fv(this.location,t)}}},f.b_=class extends ki{constructor(a,t){super(a,t),this.current=new Array}set(a){if(a!=this.current){this.current=a;const t=new Float32Array(a);this.gl.uniform1fv(this.location,t)}}},f.ba=function(){return new Float64Array(16)},f.bb=function(a,t,n){const c=new Float64Array(4);return zi(c,a,t-90,n),c},f.bc=function(a,t,n,c){var h,_,v,w,T,P=t[0],I=t[1],z=t[2],j=t[3],B=n[0],N=n[1],q=n[2],H=n[3];return(_=P*B+I*N+z*q+j*H)<0&&(_=-_,B=-B,N=-N,q=-q,H=-H),1-_>Se?(h=Math.acos(_),v=Math.sin(h),w=Math.sin((1-c)*h)/v,T=Math.sin(c*h)/v):(w=1-c,T=c),a[0]=w*P+T*B,a[1]=w*I+T*N,a[2]=w*z+T*q,a[3]=w*j+T*H,a},f.bd=function(a){const t=new Float64Array(9);var n,c,h,_,v,w,T,P,I,z,j,B,N,q,H,J,ue,ae;z=(h=(c=a)[0])*(T=h+h),j=(_=c[1])*T,N=(v=c[2])*T,q=v*(P=_+_),J=(w=c[3])*T,ue=w*P,ae=w*(I=v+v),(n=t)[0]=1-(B=_*P)-(H=v*I),n[3]=j-ae,n[6]=N+ue,n[1]=j+ae,n[4]=1-z-H,n[7]=q-J,n[2]=N-ue,n[5]=q+J,n[8]=1-z-B;const se=Sa(-Math.asin(Vt(t[2],-1,1)));let we,Me;return Math.hypot(t[5],t[8])<.001?(we=0,Me=-Sa(Math.atan2(t[3],t[4]))):(we=Sa(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),Me=Sa(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:we,pitch:se+90,bearing:Me}},f.be=function(a,t){return a.roll==t.roll&&a.pitch==t.pitch&&a.bearing==t.bearing},f.bf=At,f.bg=Oa,f.bh=vc,f.bi=ch,f.bj=_c,f.bk=vt,f.bl=Ot,f.bm=mi,f.bn=function(a,t,n,c,h){return vt(c,h,Vt((a-t)/(n-t),0,1))},f.bo=st,f.bp=function(){return new Float64Array(3)},f.bq=function(a,t,n,c){return a[0]=t[0]+n[0]*c,a[1]=t[1]+n[1]*c,a[2]=t[2]+n[2]*c,a},f.br=zi,f.bs=function(a,t,n){var c=n[0],h=n[1],_=n[2],v=t[0],w=t[1],T=t[2],P=h*T-_*w,I=_*v-c*T,z=c*w-h*v,j=h*z-_*I,B=_*P-c*z,N=c*I-h*P,q=2*n[3];return I*=q,z*=q,B*=2,N*=2,a[0]=v+(P*=q)+(j*=2),a[1]=w+I+B,a[2]=T+z+N,a},f.bt=function(a,t,n){const c=(h=[a[0],a[1],a[2],t[0],t[1],t[2],n[0],n[1],n[2]])[0]*((I=h[8])*(v=h[4])-(w=h[5])*(P=h[7]))+h[1]*(-I*(_=h[3])+w*(T=h[6]))+h[2]*(P*_-v*T);var h,_,v,w,T,P,I;if(c===0)return null;const z=Zt([],[t[0],t[1],t[2]],[n[0],n[1],n[2]]),j=Zt([],[n[0],n[1],n[2]],[a[0],a[1],a[2]]),B=Zt([],[a[0],a[1],a[2]],[t[0],t[1],t[2]]),N=nt([],z,-a[3]);return gt(N,N,nt([],j,-t[3])),gt(N,N,nt([],B,-n[3])),nt(N,N,1/c),N},f.bu=Nm,f.bv=function(){return new Float64Array(4)},f.bw=function(a,t,n,c){var h=[],_=[];return h[0]=t[0]-n[0],h[1]=t[1]-n[1],h[2]=t[2]-n[2],_[0]=h[0]*Math.cos(c)-h[1]*Math.sin(c),_[1]=h[0]*Math.sin(c)+h[1]*Math.cos(c),_[2]=h[2],a[0]=_[0]+n[0],a[1]=_[1]+n[1],a[2]=_[2]+n[2],a},f.bx=function(a,t,n,c){var h=[],_=[];return h[0]=t[0]-n[0],h[1]=t[1]-n[1],h[2]=t[2]-n[2],_[0]=h[0],_[1]=h[1]*Math.cos(c)-h[2]*Math.sin(c),_[2]=h[1]*Math.sin(c)+h[2]*Math.cos(c),a[0]=_[0]+n[0],a[1]=_[1]+n[1],a[2]=_[2]+n[2],a},f.by=function(a,t,n,c){var h=[],_=[];return h[0]=t[0]-n[0],h[1]=t[1]-n[1],h[2]=t[2]-n[2],_[0]=h[2]*Math.sin(c)+h[0]*Math.cos(c),_[1]=h[1],_[2]=h[2]*Math.cos(c)-h[0]*Math.sin(c),a[0]=_[0]+n[0],a[1]=_[1]+n[1],a[2]=_[2]+n[2],a},f.bz=function(a,t,n){var c=Math.sin(n),h=Math.cos(n),_=t[0],v=t[1],w=t[2],T=t[3],P=t[8],I=t[9],z=t[10],j=t[11];return t!==a&&(a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[0]=_*h-P*c,a[1]=v*h-I*c,a[2]=w*h-z*c,a[3]=T*h-j*c,a[8]=_*c+P*h,a[9]=v*c+I*h,a[10]=w*c+z*h,a[11]=T*c+j*h,a},f.c=he,f.c0=dT,f.c1=class extends o{},f.c2=xm,f.c3=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},f.c4=N0,f.c5=function(a,t,n){var c=t[0],h=t[1],_=t[2],v=n[3]*c+n[7]*h+n[11]*_+n[15];return a[0]=(n[0]*c+n[4]*h+n[8]*_+n[12])/(v=v||1),a[1]=(n[1]*c+n[5]*h+n[9]*_+n[13])/v,a[2]=(n[2]*c+n[6]*h+n[10]*_+n[14])/v,a},f.c6=class extends Ju{},f.c7=class extends A{},f.c8=function(a,t){return a[0]===t[0]&&a[1]===t[1]&&a[2]===t[2]&&a[3]===t[3]&&a[4]===t[4]&&a[5]===t[5]&&a[6]===t[6]&&a[7]===t[7]&&a[8]===t[8]&&a[9]===t[9]&&a[10]===t[10]&&a[11]===t[11]&&a[12]===t[12]&&a[13]===t[13]&&a[14]===t[14]&&a[15]===t[15]},f.c9=function(a,t){var n=a[0],c=a[1],h=a[2],_=a[3],v=a[4],w=a[5],T=a[6],P=a[7],I=a[8],z=a[9],j=a[10],B=a[11],N=a[12],q=a[13],H=a[14],J=a[15],ue=t[0],ae=t[1],se=t[2],we=t[3],Me=t[4],De=t[5],Ze=t[6],Be=t[7],qe=t[8],at=t[9],Ue=t[10],Ge=t[11],ze=t[12],dt=t[13],ft=t[14],lt=t[15];return Math.abs(n-ue)<=Se*Math.max(1,Math.abs(n),Math.abs(ue))&&Math.abs(c-ae)<=Se*Math.max(1,Math.abs(c),Math.abs(ae))&&Math.abs(h-se)<=Se*Math.max(1,Math.abs(h),Math.abs(se))&&Math.abs(_-we)<=Se*Math.max(1,Math.abs(_),Math.abs(we))&&Math.abs(v-Me)<=Se*Math.max(1,Math.abs(v),Math.abs(Me))&&Math.abs(w-De)<=Se*Math.max(1,Math.abs(w),Math.abs(De))&&Math.abs(T-Ze)<=Se*Math.max(1,Math.abs(T),Math.abs(Ze))&&Math.abs(P-Be)<=Se*Math.max(1,Math.abs(P),Math.abs(Be))&&Math.abs(I-qe)<=Se*Math.max(1,Math.abs(I),Math.abs(qe))&&Math.abs(z-at)<=Se*Math.max(1,Math.abs(z),Math.abs(at))&&Math.abs(j-Ue)<=Se*Math.max(1,Math.abs(j),Math.abs(Ue))&&Math.abs(B-Ge)<=Se*Math.max(1,Math.abs(B),Math.abs(Ge))&&Math.abs(N-ze)<=Se*Math.max(1,Math.abs(N),Math.abs(ze))&&Math.abs(q-dt)<=Se*Math.max(1,Math.abs(q),Math.abs(dt))&&Math.abs(H-ft)<=Se*Math.max(1,Math.abs(H),Math.abs(ft))&&Math.abs(J-lt)<=Se*Math.max(1,Math.abs(J),Math.abs(lt))},f.cA=function(a,t){V.REGISTERED_PROTOCOLS[a]=t},f.cB=function(a){delete V.REGISTERED_PROTOCOLS[a]},f.cC=function(a,t){const n={};for(let h=0;h<a.length;h++){const _=t&&t[a[h].id]||cm(a[h]);t&&(t[a[h].id]=_);let v=n[_];v||(v=n[_]=[]),v.push(a[h])}const c=[];for(const h in n)c.push(n[h]);return c},f.cD=Ke,f.cE=O_,f.cF=$_,f.cG=g_,f.cH=function(a){a.bucket.createArrays(),a.bucket.tilePixelRatio=Ft/(512*a.bucket.overscaling),a.bucket.compareText={},a.bucket.iconsNeedLinear=!1;const t=a.bucket.layers[0],n=t.layout,c=t._unevaluatedLayout._values,h={layoutIconSize:c["icon-size"].possiblyEvaluate(new gr(a.bucket.zoom+1),a.canonical),layoutTextSize:c["text-size"].possiblyEvaluate(new gr(a.bucket.zoom+1),a.canonical),textMaxSize:c["text-size"].possiblyEvaluate(new gr(18))};if(a.bucket.textSizeData.kind==="composite"){const{minZoom:P,maxZoom:I}=a.bucket.textSizeData;h.compositeTextSizes=[c["text-size"].possiblyEvaluate(new gr(P),a.canonical),c["text-size"].possiblyEvaluate(new gr(I),a.canonical)]}if(a.bucket.iconSizeData.kind==="composite"){const{minZoom:P,maxZoom:I}=a.bucket.iconSizeData;h.compositeIconSizes=[c["icon-size"].possiblyEvaluate(new gr(P),a.canonical),c["icon-size"].possiblyEvaluate(new gr(I),a.canonical)]}const _=n.get("text-line-height")*Jr,v=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",w=n.get("text-keep-upright"),T=n.get("text-size");for(const P of a.bucket.features){const I=n.get("text-font").evaluate(P,{},a.canonical).join(","),z=T.evaluate(P,{},a.canonical),j=h.layoutTextSize.evaluate(P,{},a.canonical),B=h.layoutIconSize.evaluate(P,{},a.canonical),N={horizontal:{},vertical:void 0},q=P.text;let H,J=[0,0];if(q){const se=q.toString(),we=n.get("text-letter-spacing").evaluate(P,{},a.canonical)*Jr,Me=dm(se)?we:0,De=n.get("text-anchor").evaluate(P,{},a.canonical),Ze=Y_(t,P,a.canonical);if(!Ze){const Ue=n.get("text-radial-offset").evaluate(P,{},a.canonical);J=Ue?K_(De,[Ue*Jr,qm]):n.get("text-offset").evaluate(P,{},a.canonical).map((Ge=>Ge*Jr))}let Be=v?"center":n.get("text-justify").evaluate(P,{},a.canonical);const qe=n.get("symbol-placement")==="point"?n.get("text-max-width").evaluate(P,{},a.canonical)*Jr:1/0,at=()=>{a.bucket.allowVerticalPlacement&&oc(se)&&(N.vertical=pd(q,a.glyphMap,a.glyphPositions,a.imagePositions,I,qe,_,De,"left",Me,J,f.ao.vertical,!0,j,z))};if(!v&&Ze){const Ue=new Set;if(Be==="auto")for(let ze=0;ze<Ze.values.length;ze+=2)Ue.add(Gm(Ze.values[ze]));else Ue.add(Be);let Ge=!1;for(const ze of Ue)if(!N.horizontal[ze])if(Ge)N.horizontal[ze]=N.horizontal[0];else{const dt=pd(q,a.glyphMap,a.glyphPositions,a.imagePositions,I,qe,_,"center",ze,Me,J,f.ao.horizontal,!1,j,z);dt&&(N.horizontal[ze]=dt,Ge=dt.positionedLines.length===1)}at()}else{Be==="auto"&&(Be=Gm(De));const Ue=pd(q,a.glyphMap,a.glyphPositions,a.imagePositions,I,qe,_,De,Be,Me,J,f.ao.horizontal,!1,j,z);Ue&&(N.horizontal[Be]=Ue),at(),oc(se)&&v&&w&&(N.vertical=pd(q,a.glyphMap,a.glyphPositions,a.imagePositions,I,qe,_,De,Be,Me,J,f.ao.vertical,!1,j,z))}}let ue=!1;if(P.icon&&P.icon.name){const se=a.imageMap[P.icon.name];se&&(H=DT(a.imagePositions[P.icon.name],n.get("icon-offset").evaluate(P,{},a.canonical),n.get("icon-anchor").evaluate(P,{},a.canonical)),ue=!!se.sdf,a.bucket.sdfIcons===void 0?a.bucket.sdfIcons=ue:a.bucket.sdfIcons!==ue&&tr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(se.pixelRatio!==a.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(a.bucket.iconsNeedLinear=!0))}const ae=Q_(N.horizontal)||N.vertical;a.bucket.iconsInText=!!ae&&ae.iconsInText,(ae||H)&&YT(a.bucket,P,N,H,a.imageMap,h,j,B,J,ue,a.canonical,a.subdivisionGranularity)}a.showCollisionBoxes&&a.bucket.generateCollisionDebugBuffers()},f.cI=Im,f.cJ=Pm,f.cK=Am,f.cL=r_,f.cM=zm,f.cN=class{constructor(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let a=performance.getEntriesByName(this._marks.measure);return a.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),a=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),a}},f.cO=function(a,t,n,c,h){return l(this,void 0,void 0,(function*(){if(_e())try{return yield zo(a,t,n,c,h)}catch{}return(function(_,v,w,T,P){const I=_.width,z=_.height;xa&&wa||(xa=new OffscreenCanvas(I,z),wa=xa.getContext("2d",{willReadFrequently:!0})),xa.width=I,xa.height=z,wa.drawImage(_,0,0,I,z);const j=wa.getImageData(v,w,T,P);return wa.clearRect(0,0,I,z),j.data})(a,t,n,c,h)}))},f.cP=q0,f.cQ=M,f.cR=t_,f.cS=bc,f.cT=Bs,f.cU=function(a,t){const n=new Map;if(a!=null)if(a.type==="Feature")n.set(gh(a,t),a);else for(const c of a.features)n.set(gh(c,t),c);return n},f.cV=function(a,t){if(a==null)return!0;if(a.type==="Feature")return gh(a,t)!=null;if(a.type==="FeatureCollection"){const n=new Set;for(const c of a.features){const h=gh(c,t);if(h==null||n.has(h))return!1;n.add(h)}return!0}return!1},f.cW=function(a,t,n){var c,h,_,v;if(t.removeAll&&a.clear(),t.remove)for(const w of t.remove)a.delete(w);if(t.add)for(const w of t.add){const T=gh(w,n);T!=null&&a.set(T,w)}if(t.update)for(const w of t.update){let T=a.get(w.id);if(T==null)continue;const P=!w.removeAllProperties&&(((c=w.removeProperties)===null||c===void 0?void 0:c.length)>0||((h=w.addOrUpdateProperties)===null||h===void 0?void 0:h.length)>0);if((w.newGeometry||w.removeAllProperties||P)&&(T=Object.assign({},T),a.set(w.id,T),P&&(T.properties=Object.assign({},T.properties))),w.newGeometry&&(T.geometry=w.newGeometry),w.removeAllProperties)T.properties={};else if(((_=w.removeProperties)===null||_===void 0?void 0:_.length)>0)for(const I of w.removeProperties)Object.prototype.hasOwnProperty.call(T.properties,I)&&delete T.properties[I];if(((v=w.addOrUpdateProperties)===null||v===void 0?void 0:v.length)>0)for(const{key:I,value:z}of w.addOrUpdateProperties)T.properties[I]=z}},f.cX=yn,f.ca=function(a,t){return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a},f.cb=a=>a.type==="symbol",f.cc=a=>a.type==="circle",f.cd=a=>a.type==="heatmap",f.ce=a=>a.type==="line",f.cf=a=>a.type==="fill",f.cg=a=>a.type==="fill-extrusion",f.ch=a=>a.type==="hillshade",f.ci=a=>a.type==="color-relief",f.cj=a=>a.type==="raster",f.ck=a=>a.type==="background",f.cl=a=>a.type==="custom",f.cm=Et,f.cn=function(a,t,n){const c=br(t.x-n.x,t.y-n.y),h=br(a.x-n.x,a.y-n.y);var _,v;return Sa(Math.atan2(c[0]*h[1]-c[1]*h[0],(_=c)[0]*(v=h)[0]+_[1]*v[1]))},f.co=pr,f.cp=function(a,t){return Ca[t]&&(a instanceof MouseEvent||a instanceof WheelEvent)},f.cq=function(a,t){return ka[t]&&"touches"in a},f.cr=function(a){return ka[a]||Ca[a]},f.cs=function(a,t,n){var c=t[0],h=t[1];return a[0]=n[0]*c+n[4]*h+n[12],a[1]=n[1]*c+n[5]*h+n[13],a},f.ct=function(a,t){const{x:n,y:c}=mh.fromLngLat(t);return!(a<0||a>25||c<0||c>=1||n<0||n>=1)},f.cu=function(a,t){return a[0]=t[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=t[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=t[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},f.cv=class extends es{},f.cw=QT,f.cy=function(a){return a.message===Ro},f.cz=re,f.d=Te,f.e=Qt,f.f=a=>l(void 0,void 0,void 0,(function*(){if(a.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(a)],{type:"image/png"});try{return createImageBitmap(t)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),f.g=G,f.h=a=>new Promise(((t,n)=>{const c=new Image;c.onload=()=>{t(c),URL.revokeObjectURL(c.src),c.onload=null,window.requestAnimationFrame((()=>{c.src=Fn}))},c.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const h=new Blob([new Uint8Array(a)],{type:"image/png"});c.src=a.byteLength?URL.createObjectURL(h):Fn})),f.i=Li,f.j=(a,t)=>pe(Qt(a,{type:"json"}),t),f.k=Re,f.l=je,f.m=pe,f.n=(a,t)=>pe(Qt(a,{type:"arrayBuffer"}),t),f.o=function(a){return new zm(a).readFields(ST,[])},f.p=m_,f.q=nh,f.r=Ti,f.s=Ta,f.t=td,f.u=Bt,f.v=ge,f.w=tr,f.x=um,f.y=Zs,f.z=Ko})),m("worker",["./shared"],(function(f){class l{constructor(V){this.keyCache={},V&&this.replace(V)}replace(V){this._layerConfigs={},this._layers={},this.update(V,[])}update(V,G){for(const re of V){this._layerConfigs[re.id]=re;const ce=this._layers[re.id]=f.bJ(re);ce._featureFilter=f.aa(ce.filter),this.keyCache[re.id]&&delete this.keyCache[re.id]}for(const re of G)delete this.keyCache[re],delete this._layerConfigs[re],delete this._layers[re];this.familiesBySource={};const W=f.cC(Object.values(this._layerConfigs),this.keyCache);for(const re of W){const ce=re.map((Re=>this._layers[Re.id])),pe=ce[0];if(pe.visibility==="none")continue;const Te=pe.source||"";let me=this.familiesBySource[Te];me||(me=this.familiesBySource[Te]={});const Ie=pe.sourceLayer||"_geojsonTileLayer";let je=me[Ie];je||(je=me[Ie]=[]),je.push(ce)}}}class C{constructor(V){const G={},W=[];for(const Te in V){const me=V[Te],Ie=G[Te]={};for(const je in me){const Re=me[+je];if(!Re||Re.bitmap.width===0||Re.bitmap.height===0)continue;const tt={x:0,y:0,w:Re.bitmap.width+2,h:Re.bitmap.height+2};W.push(tt),Ie[je]={rect:tt,metrics:Re.metrics}}}const{w:re,h:ce}=f.p(W),pe=new f.q({width:re||1,height:ce||1});for(const Te in V){const me=V[Te];for(const Ie in me){const je=me[+Ie];if(!je||je.bitmap.width===0||je.bitmap.height===0)continue;const Re=G[Te][Ie].rect;f.q.copy(je.bitmap,pe,{x:0,y:0},{x:Re.x+1,y:Re.y+1},je.bitmap)}}this.image=pe,this.positions=G}}f.cD("GlyphAtlas",C);class M{constructor(V){this.tileID=new f.Z(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.uid=V.uid,this.zoom=V.zoom,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=V.showCollisionBoxes,this.collectResourceTiming=!!V.collectResourceTiming,this.returnDependencies=!!V.returnDependencies,this.promoteId=V.promoteId,this.inFlightDependencies=[],this.globalState=V.globalState}parse(V,G,W,re,ce){return f._(this,void 0,void 0,(function*(){this.status="parsing",this.data=V,this.collisionBoxArray=new f.a8;const pe=new f.cE(Object.keys(V.layers).sort()),Te=new f.cF(this.tileID,this.promoteId);Te.bucketLayerIDs=[];const me={},Ie={featureIndex:Te,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:W,subdivisionGranularity:ce},je=G.familiesBySource[this.source];for(const zt in je){const qt=V.layers[zt];if(!qt)continue;qt.version===1&&f.w(`Vector tile source "${this.source}" layer "${zt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Dr=pe.encode(zt),Oe=[];for(let fi=0;fi<qt.length;fi++){const wr=qt.feature(fi),Pa=Te.getId(wr,zt);Oe.push({feature:wr,id:Pa,index:fi,sourceLayerIndex:Dr})}for(const fi of je[zt]){const wr=fi[0];wr.source!==this.source&&f.w(`layer.source = ${wr.source} does not equal this.source = ${this.source}`),wr.minzoom&&this.zoom<Math.floor(wr.minzoom)||wr.maxzoom&&this.zoom>=wr.maxzoom||wr.visibility!=="none"&&(D(fi,this.zoom,W),(me[wr.id]=wr.createBucket({index:Te.bucketLayerIDs.length,layers:fi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Dr,sourceID:this.source,globalState:this.globalState})).populate(Oe,Ie,this.tileID.canonical),Te.bucketLayerIDs.push(fi.map((Pa=>Pa.id))))}}const Re=f.bN(Ie.glyphDependencies,(zt=>Object.keys(zt).map(Number)));this.inFlightDependencies.forEach((zt=>zt?.abort())),this.inFlightDependencies=[];let tt=Promise.resolve({});if(Object.keys(Re).length){const zt=new AbortController;this.inFlightDependencies.push(zt),tt=re.sendAsync({type:"GG",data:{stacks:Re,source:this.source,tileID:this.tileID,type:"glyphs"}},zt)}const ge=Object.keys(Ie.iconDependencies);let mt=Promise.resolve({});if(ge.length){const zt=new AbortController;this.inFlightDependencies.push(zt),mt=re.sendAsync({type:"GI",data:{icons:ge,source:this.source,tileID:this.tileID,type:"icons"}},zt)}const Ct=Object.keys(Ie.patternDependencies);let ot=Promise.resolve({});if(Ct.length){const zt=new AbortController;this.inFlightDependencies.push(zt),ot=re.sendAsync({type:"GI",data:{icons:Ct,source:this.source,tileID:this.tileID,type:"patterns"}},zt)}const[bt,hr,Vr]=yield Promise.all([tt,mt,ot]),qr=new C(bt),zr=new f.cG(hr,Vr);for(const zt in me){const qt=me[zt];qt instanceof f.a9?(D(qt.layers,this.zoom,W),f.cH({bucket:qt,glyphMap:bt,glyphPositions:qr.positions,imageMap:hr,imagePositions:zr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Ie.subdivisionGranularity})):qt.hasPattern&&(qt instanceof f.cI||qt instanceof f.cJ||qt instanceof f.cK)&&(D(qt.layers,this.zoom,W),qt.addFeatures(Ie,this.tileID.canonical,zr.patternPositions))}return this.status="done",{buckets:Object.values(me).filter((zt=>!zt.isEmpty())),featureIndex:Te,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:qr.image,imageAtlas:zr,glyphMap:this.returnDependencies?bt:null,iconMap:this.returnDependencies?hr:null,glyphPositions:this.returnDependencies?qr.positions:null}}))}}function D(he,V,G){const W=new f.F(V);for(const re of he)re.recalculate(W,G)}class O{constructor(V,G,W){this.actor=V,this.layerIndex=G,this.availableImages=W,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(V,G){return f._(this,void 0,void 0,(function*(){const W=yield f.n(V.request,G);try{return{vectorTile:new f.cL(new f.cM(W.data)),rawData:W.data,cacheControl:W.cacheControl,expires:W.expires}}catch(re){const ce=new Uint8Array(W.data);let pe=`Unable to parse the tile at ${V.request.url}, `;throw pe+=ce[0]===31&&ce[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${re.message}`,new Error(pe)}}))}loadTile(V){return f._(this,void 0,void 0,(function*(){const G=V.uid,W=!!(V&&V.request&&V.request.collectResourceTiming)&&new f.cN(V.request),re=new M(V);this.loading[G]=re;const ce=new AbortController;re.abort=ce;try{const pe=yield this.loadVectorTile(V,ce);if(delete this.loading[G],!pe)return null;const Te=pe.rawData,me={};pe.expires&&(me.expires=pe.expires),pe.cacheControl&&(me.cacheControl=pe.cacheControl);const Ie={};if(W){const Re=W.finish();Re&&(Ie.resourceTiming=JSON.parse(JSON.stringify(Re)))}re.vectorTile=pe.vectorTile;const je=re.parse(pe.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity);this.loaded[G]=re,this.fetching[G]={rawTileData:Te,cacheControl:me,resourceTiming:Ie};try{const Re=yield je;return f.e({rawTileData:Te.slice(0)},Re,me,Ie)}finally{delete this.fetching[G]}}catch(pe){throw delete this.loading[G],re.status="done",this.loaded[G]=re,pe}}))}reloadTile(V){return f._(this,void 0,void 0,(function*(){const G=V.uid;if(!this.loaded||!this.loaded[G])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const W=this.loaded[G];if(W.showCollisionBoxes=V.showCollisionBoxes,W.globalState=V.globalState,W.status==="parsing"){const re=yield W.parse(W.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity);let ce;if(this.fetching[G]){const{rawTileData:pe,cacheControl:Te,resourceTiming:me}=this.fetching[G];delete this.fetching[G],ce=f.e({rawTileData:pe.slice(0)},re,Te,me)}else ce=re;return ce}if(W.status==="done"&&W.vectorTile)return W.parse(W.vectorTile,this.layerIndex,this.availableImages,this.actor,V.subdivisionGranularity)}))}abortTile(V){return f._(this,void 0,void 0,(function*(){const G=this.loading,W=V.uid;G&&G[W]&&G[W].abort&&(G[W].abort.abort(),delete G[W])}))}removeTile(V){return f._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[V.uid]&&delete this.loaded[V.uid]}))}}class Z{constructor(){this.loaded={}}loadTile(V){return f._(this,void 0,void 0,(function*(){const{uid:G,encoding:W,rawImageData:re,redFactor:ce,greenFactor:pe,blueFactor:Te,baseShift:me}=V,Ie=re.width+2,je=re.height+2,Re=f.b(re)?new f.R({width:Ie,height:je},yield f.cO(re,-1,-1,Ie,je)):re,tt=new f.cP(G,Re,W,ce,pe,Te,me);return this.loaded=this.loaded||{},this.loaded[G]=tt,tt}))}removeTile(V){const G=this.loaded,W=V.uid;G&&G[W]&&delete G[W]}}var $,ne,fe=(function(){if(ne)return $;function he(G,W){if(G.length!==0){V(G[0],W);for(var re=1;re<G.length;re++)V(G[re],!W)}}function V(G,W){for(var re=0,ce=0,pe=0,Te=G.length,me=Te-1;pe<Te;me=pe++){var Ie=(G[pe][0]-G[me][0])*(G[me][1]+G[pe][1]),je=re+Ie;ce+=Math.abs(re)>=Math.abs(Ie)?re-je+Ie:Ie-je+re,re=je}re+ce>=0!=!!W&&G.reverse()}return ne=1,$=function G(W,re){var ce,pe=W&&W.type;if(pe==="FeatureCollection")for(ce=0;ce<W.features.length;ce++)G(W.features[ce],re);else if(pe==="GeometryCollection")for(ce=0;ce<W.geometries.length;ce++)G(W.geometries[ce],re);else if(pe==="Feature")G(W.geometry,re);else if(pe==="Polygon")he(W.coordinates,re);else if(pe==="MultiPolygon")for(ce=0;ce<W.coordinates.length;ce++)he(W.coordinates[ce],re);return W}})(),Ee=f.cQ(fe);class _e extends f.cS{constructor(V,G){super(new f.cM,0,G,[],[]),this.feature=V,this.type=V.type,this.properties=V.tags?V.tags:{},"id"in V&&(typeof V.id=="string"?this.id=parseInt(V.id,10):typeof V.id!="number"||isNaN(V.id)||(this.id=V.id))}loadGeometry(){const V=[],G=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const W of G){const re=[];for(const ce of W)re.push(new f.P(ce[0],ce[1]));V.push(re)}return V}}class Se extends f.cR{constructor(V,G){super(new f.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=G?G.version:1,this.extent=G?G.extent:4096,this.length=V.length,this.features=V}feature(V){return new _e(this.features[V],this.extent)}}function Pe(he,V){V.writeVarintField(15,he.version||1),V.writeStringField(1,he.name||""),V.writeVarintField(5,he.extent||4096);const G={keys:[],values:[],keycache:{},valuecache:{}};for(let ce=0;ce<he.length;ce++)G.feature=he.feature(ce),V.writeMessage(2,ve,G);const W=G.keys;for(const ce of W)V.writeStringField(3,ce);const re=G.values;for(const ce of re)V.writeMessage(4,gt,ce)}function ve(he,V){if(!he.feature)return;const G=he.feature;G.id!==void 0&&V.writeVarintField(1,G.id),V.writeMessage(2,ye,he),V.writeVarintField(3,G.type),V.writeMessage(4,it,G)}function ye(he,V){for(const G in he.feature?.properties){let W=he.feature.properties[G],re=he.keycache[G];if(W===null)continue;re===void 0&&(he.keys.push(G),re=he.keys.length-1,he.keycache[G]=re),V.writeVarint(re),typeof W!="string"&&typeof W!="boolean"&&typeof W!="number"&&(W=JSON.stringify(W));const ce=typeof W+":"+W;let pe=he.valuecache[ce];pe===void 0&&(he.values.push(W),pe=he.values.length-1,he.valuecache[ce]=pe),V.writeVarint(pe)}}function Ae(he,V){return(V<<3)+(7&he)}function Ne(he){return he<<1^he>>31}function it(he,V){const G=he.loadGeometry(),W=he.type;let re=0,ce=0;for(const pe of G){let Te=1;W===1&&(Te=pe.length),V.writeVarint(Ae(1,Te));const me=W===3?pe.length-1:pe.length;for(let Ie=0;Ie<me;Ie++){Ie===1&&W!==1&&V.writeVarint(Ae(2,me-1));const je=pe[Ie].x-re,Re=pe[Ie].y-ce;V.writeVarint(Ne(je)),V.writeVarint(Ne(Re)),re+=je,ce+=Re}he.type===3&&V.writeVarint(Ae(7,1))}}function gt(he,V){const G=typeof he;G==="string"?V.writeStringField(1,he):G==="boolean"?V.writeBooleanField(7,he):G==="number"&&(he%1!=0?V.writeDoubleField(3,he):he<0?V.writeSVarintField(6,he):V.writeVarintField(5,he))}const nt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:he=>he},Zt=Math.fround||(kt=new Float32Array(1),he=>(kt[0]=+he,kt[0]));var kt;class ur{constructor(V){this.options=Object.assign(Object.create(nt),V),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(V){const{log:G,minZoom:W,maxZoom:re}=this.options;G&&console.time("total time");const ce=`prepare ${V.length} points`;G&&console.time(ce),this.points=V;const pe=[];for(let me=0;me<V.length;me++){const Ie=V[me];if(!Ie.geometry)continue;const[je,Re]=Ie.geometry.coordinates,tt=Zt(zi(je)),ge=Zt(Ri(Re));pe.push(tt,ge,1/0,me,-1,1),this.options.reduce&&pe.push(0)}let Te=this.trees[re+1]=this._createTree(pe);G&&console.timeEnd(ce);for(let me=re;me>=W;me--){const Ie=+Date.now();Te=this.trees[me]=this._createTree(this._cluster(Te,me)),G&&console.log("z%d: %d clusters in %dms",me,Te.numItems,+Date.now()-Ie)}return G&&console.timeEnd("total time"),this}getClusters(V,G){let W=((V[0]+180)%360+360)%360-180;const re=Math.max(-90,Math.min(90,V[1]));let ce=V[2]===180?180:((V[2]+180)%360+360)%360-180;const pe=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)W=-180,ce=180;else if(W>ce){const Re=this.getClusters([W,re,180,pe],G),tt=this.getClusters([-180,re,ce,pe],G);return Re.concat(tt)}const Te=this.trees[this._limitZoom(G)],me=Te.range(zi(W),Ri(pe),zi(ce),Ri(re)),Ie=Te.data,je=[];for(const Re of me){const tt=this.stride*Re;je.push(Ie[tt+5]>1?hi(Ie,tt,this.clusterProps):this.points[Ie[tt+3]])}return je}getChildren(V){const G=this._getOriginId(V),W=this._getOriginZoom(V),re="No cluster with the specified id.",ce=this.trees[W];if(!ce)throw new Error(re);const pe=ce.data;if(G*this.stride>=pe.length)throw new Error(re);const Te=this.options.radius/(this.options.extent*Math.pow(2,W-1)),me=ce.within(pe[G*this.stride],pe[G*this.stride+1],Te),Ie=[];for(const je of me){const Re=je*this.stride;pe[Re+4]===V&&Ie.push(pe[Re+5]>1?hi(pe,Re,this.clusterProps):this.points[pe[Re+3]])}if(Ie.length===0)throw new Error(re);return Ie}getLeaves(V,G,W){const re=[];return this._appendLeaves(re,V,G=G||10,W=W||0,0),re}getTile(V,G,W){const re=this.trees[this._limitZoom(V)],ce=Math.pow(2,V),{extent:pe,radius:Te}=this.options,me=Te/pe,Ie=(W-me)/ce,je=(W+1+me)/ce,Re={features:[]};return this._addTileFeatures(re.range((G-me)/ce,Ie,(G+1+me)/ce,je),re.data,G,W,ce,Re),G===0&&this._addTileFeatures(re.range(1-me/ce,Ie,1,je),re.data,ce,W,ce,Re),G===ce-1&&this._addTileFeatures(re.range(0,Ie,me/ce,je),re.data,-1,W,ce,Re),Re.features.length?Re:null}getClusterExpansionZoom(V){let G=this._getOriginZoom(V)-1;for(;G<=this.options.maxZoom;){const W=this.getChildren(V);if(G++,W.length!==1)break;V=W[0].properties.cluster_id}return G}_appendLeaves(V,G,W,re,ce){const pe=this.getChildren(G);for(const Te of pe){const me=Te.properties;if(me&&me.cluster?ce+me.point_count<=re?ce+=me.point_count:ce=this._appendLeaves(V,me.cluster_id,W,re,ce):ce<re?ce++:V.push(Te),V.length===W)break}return ce}_createTree(V){const G=new f.aI(V.length/this.stride|0,this.options.nodeSize,Float32Array);for(let W=0;W<V.length;W+=this.stride)G.add(V[W],V[W+1]);return G.finish(),G.data=V,G}_addTileFeatures(V,G,W,re,ce,pe){for(const Te of V){const me=Te*this.stride,Ie=G[me+5]>1;let je,Re,tt;if(Ie)je=pi(G,me,this.clusterProps),Re=G[me],tt=G[me+1];else{const Ct=this.points[G[me+3]];je=Ct.properties;const[ot,bt]=Ct.geometry.coordinates;Re=zi(ot),tt=Ri(bt)}const ge={type:1,geometry:[[Math.round(this.options.extent*(Re*ce-W)),Math.round(this.options.extent*(tt*ce-re))]],tags:je};let mt;mt=Ie||this.options.generateId?G[me+3]:this.points[G[me+3]].id,mt!==void 0&&(ge.id=mt),pe.features.push(ge)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,G){const{radius:W,extent:re,reduce:ce,minPoints:pe}=this.options,Te=W/(re*Math.pow(2,G)),me=V.data,Ie=[],je=this.stride;for(let Re=0;Re<me.length;Re+=je){if(me[Re+2]<=G)continue;me[Re+2]=G;const tt=me[Re],ge=me[Re+1],mt=V.within(me[Re],me[Re+1],Te),Ct=me[Re+5];let ot=Ct;for(const bt of mt){const hr=bt*je;me[hr+2]>G&&(ot+=me[hr+5])}if(ot>Ct&&ot>=pe){let bt,hr=tt*Ct,Vr=ge*Ct,qr=-1;const zr=(Re/je<<5)+(G+1)+this.points.length;for(const zt of mt){const qt=zt*je;if(me[qt+2]<=G)continue;me[qt+2]=G;const Dr=me[qt+5];hr+=me[qt]*Dr,Vr+=me[qt+1]*Dr,me[qt+4]=zr,ce&&(bt||(bt=this._map(me,Re,!0),qr=this.clusterProps.length,this.clusterProps.push(bt)),ce(bt,this._map(me,qt)))}me[Re+4]=zr,Ie.push(hr/ot,Vr/ot,1/0,zr,-1,ot),ce&&Ie.push(qr)}else{for(let bt=0;bt<je;bt++)Ie.push(me[Re+bt]);if(ot>1)for(const bt of mt){const hr=bt*je;if(!(me[hr+2]<=G)){me[hr+2]=G;for(let Vr=0;Vr<je;Vr++)Ie.push(me[hr+Vr])}}}}return Ie}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,G,W){if(V[G+5]>1){const pe=this.clusterProps[V[G+6]];return W?Object.assign({},pe):pe}const re=this.points[V[G+3]].properties,ce=this.options.map(re);return W&&ce===re?Object.assign({},ce):ce}}function hi(he,V,G){return{type:"Feature",id:he[V+3],properties:pi(he,V,G),geometry:{type:"Point",coordinates:[(W=he[V],360*(W-.5)),br(he[V+1])]}};var W}function pi(he,V,G){const W=he[V+5],re=W>=1e4?`${Math.round(W/1e3)}k`:W>=1e3?Math.round(W/100)/10+"k":W,ce=he[V+6],pe=ce===-1?{}:Object.assign({},G[ce]);return Object.assign(pe,{cluster:!0,cluster_id:he[V+3],point_count:W,point_count_abbreviated:re})}function zi(he){return he/360+.5}function Ri(he){const V=Math.sin(he*Math.PI/180),G=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return G<0?0:G>1?1:G}function br(he){const V=(180-360*he)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function Ft(he,V,G,W){let re=W;const ce=V+(G-V>>1);let pe,Te=G-V;const me=he[V],Ie=he[V+1],je=he[G],Re=he[G+1];for(let tt=V+3;tt<G;tt+=3){const ge=Ye(he[tt],he[tt+1],me,Ie,je,Re);if(ge>re)pe=tt,re=ge;else if(ge===re){const mt=Math.abs(tt-ce);mt<Te&&(pe=tt,Te=mt)}}re>W&&(pe-V>3&&Ft(he,V,pe,W),he[pe+2]=re,G-pe>3&&Ft(he,pe,G,W))}function Ye(he,V,G,W,re,ce){let pe=re-G,Te=ce-W;if(pe!==0||Te!==0){const me=((he-G)*pe+(V-W)*Te)/(pe*pe+Te*Te);me>1?(G=re,W=ce):me>0&&(G+=pe*me,W+=Te*me)}return pe=he-G,Te=V-W,pe*pe+Te*Te}function st(he,V,G,W){const re={id:he??null,type:V,geometry:G,tags:W,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(V==="Point"||V==="MultiPoint"||V==="LineString")vt(re,G);else if(V==="Polygon")vt(re,G[0]);else if(V==="MultiLineString")for(const ce of G)vt(re,ce);else if(V==="MultiPolygon")for(const ce of G)vt(re,ce[0]);return re}function vt(he,V){for(let G=0;G<V.length;G+=3)he.minX=Math.min(he.minX,V[G]),he.minY=Math.min(he.minY,V[G+1]),he.maxX=Math.max(he.maxX,V[G]),he.maxY=Math.max(he.maxY,V[G+1])}function Ot(he,V,G,W){if(!V.geometry)return;const re=V.geometry.coordinates;if(re&&re.length===0)return;const ce=V.geometry.type,pe=Math.pow(G.tolerance/((1<<G.maxZoom)*G.extent),2);let Te=[],me=V.id;if(G.promoteId?me=V.properties[G.promoteId]:G.generateId&&(me=W||0),ce==="Point")Et(re,Te);else if(ce==="MultiPoint")for(const Ie of re)Et(Ie,Te);else if(ce==="LineString")pr(re,Te,pe,!1);else if(ce==="MultiLineString"){if(G.lineMetrics){for(const Ie of re)Te=[],pr(Ie,Te,pe,!1),he.push(st(me,"LineString",Te,V.properties));return}Vt(re,Te,pe,!1)}else if(ce==="Polygon")Vt(re,Te,pe,!0);else{if(ce!=="MultiPolygon"){if(ce==="GeometryCollection"){for(const Ie of V.geometry.geometries)Ot(he,{id:me,geometry:Ie,properties:V.properties},G,W);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ie of re){const je=[];Vt(Ie,je,pe,!0),Te.push(je)}}he.push(st(me,ce,Te,V.properties))}function Et(he,V){V.push(yr(he[0]),Qt(he[1]),0)}function pr(he,V,G,W){let re,ce,pe=0;for(let me=0;me<he.length;me++){const Ie=yr(he[me][0]),je=Qt(he[me][1]);V.push(Ie,je,0),me>0&&(pe+=W?(re*je-Ie*ce)/2:Math.sqrt(Math.pow(Ie-re,2)+Math.pow(je-ce,2))),re=Ie,ce=je}const Te=V.length-3;V[2]=1,Ft(V,0,Te,G),V[Te+2]=1,V.size=Math.abs(pe),V.start=0,V.end=V.size}function Vt(he,V,G,W){for(let re=0;re<he.length;re++){const ce=[];pr(he[re],ce,G,W),V.push(ce)}}function yr(he){return he/360+.5}function Qt(he){const V=Math.sin(he*Math.PI/180),G=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return G<0?0:G>1?1:G}function Cr(he,V,G,W,re,ce,pe,Te){if(W/=V,ce>=(G/=V)&&pe<W)return he;if(pe<G||ce>=W)return null;const me=[];for(const Ie of he){const je=Ie.geometry;let Re=Ie.type;const tt=re===0?Ie.minX:Ie.minY,ge=re===0?Ie.maxX:Ie.maxY;if(tt>=G&&ge<W){me.push(Ie);continue}if(ge<G||tt>=W)continue;let mt=[];if(Re==="Point"||Re==="MultiPoint")di(je,mt,G,W,re);else if(Re==="LineString")xr(je,mt,G,W,re,!1,Te.lineMetrics);else if(Re==="MultiLineString")Ht(je,mt,G,W,re,!1);else if(Re==="Polygon")Ht(je,mt,G,W,re,!0);else if(Re==="MultiPolygon")for(const Ct of je){const ot=[];Ht(Ct,ot,G,W,re,!0),ot.length&&mt.push(ot)}if(mt.length){if(Te.lineMetrics&&Re==="LineString"){for(const Ct of mt)me.push(st(Ie.id,Re,Ct,Ie.tags));continue}Re!=="LineString"&&Re!=="MultiLineString"||(mt.length===1?(Re="LineString",mt=mt[0]):Re="MultiLineString"),Re!=="Point"&&Re!=="MultiPoint"||(Re=mt.length===3?"Point":"MultiPoint"),me.push(st(Ie.id,Re,mt,Ie.tags))}}return me.length?me:null}function di(he,V,G,W,re){for(let ce=0;ce<he.length;ce+=3){const pe=he[ce+re];pe>=G&&pe<=W&&tr(V,he[ce],he[ce+1],he[ce+2])}}function xr(he,V,G,W,re,ce,pe){let Te=dr(he);const me=re===0?Ur:Li;let Ie,je,Re=he.start;for(let ot=0;ot<he.length-3;ot+=3){const bt=he[ot],hr=he[ot+1],Vr=he[ot+2],qr=he[ot+3],zr=he[ot+4],zt=re===0?bt:hr,qt=re===0?qr:zr;let Dr=!1;pe&&(Ie=Math.sqrt(Math.pow(bt-qr,2)+Math.pow(hr-zr,2))),zt<G?qt>G&&(je=me(Te,bt,hr,qr,zr,G),pe&&(Te.start=Re+Ie*je)):zt>W?qt<W&&(je=me(Te,bt,hr,qr,zr,W),pe&&(Te.start=Re+Ie*je)):tr(Te,bt,hr,Vr),qt<G&&zt>=G&&(je=me(Te,bt,hr,qr,zr,G),Dr=!0),qt>W&&zt<=W&&(je=me(Te,bt,hr,qr,zr,W),Dr=!0),!ce&&Dr&&(pe&&(Te.end=Re+Ie*je),V.push(Te),Te=dr(he)),pe&&(Re+=Ie)}let tt=he.length-3;const ge=he[tt],mt=he[tt+1],Ct=re===0?ge:mt;Ct>=G&&Ct<=W&&tr(Te,ge,mt,he[tt+2]),tt=Te.length-3,ce&&tt>=3&&(Te[tt]!==Te[0]||Te[tt+1]!==Te[1])&&tr(Te,Te[0],Te[1],Te[2]),Te.length&&V.push(Te)}function dr(he){const V=[];return V.size=he.size,V.start=he.start,V.end=he.end,V}function Ht(he,V,G,W,re,ce){for(const pe of he)xr(pe,V,G,W,re,ce,!1)}function tr(he,V,G,W){he.push(V,G,W)}function Ur(he,V,G,W,re,ce){const pe=(ce-V)/(W-V);return tr(he,ce,G+(re-G)*pe,1),pe}function Li(he,V,G,W,re,ce){const pe=(ce-G)/(re-G);return tr(he,V+(W-V)*pe,ce,1),pe}function Xa(he,V){const G=[];for(let W=0;W<he.length;W++){const re=he[W],ce=re.type;let pe;if(ce==="Point"||ce==="MultiPoint"||ce==="LineString")pe=jn(re.geometry,V);else if(ce==="MultiLineString"||ce==="Polygon"){pe=[];for(const Te of re.geometry)pe.push(jn(Te,V))}else if(ce==="MultiPolygon"){pe=[];for(const Te of re.geometry){const me=[];for(const Ie of Te)me.push(jn(Ie,V));pe.push(me)}}G.push(st(re.id,ce,pe,re.tags))}return G}function jn(he,V){const G=[];G.size=he.size,he.start!==void 0&&(G.start=he.start,G.end=he.end);for(let W=0;W<he.length;W+=3)G.push(he[W]+V,he[W+1],he[W+2]);return G}function Fn(he,V){if(he.transformed)return he;const G=1<<he.z,W=he.x,re=he.y;for(const ce of he.features){const pe=ce.geometry,Te=ce.type;if(ce.geometry=[],Te===1)for(let me=0;me<pe.length;me+=2)ce.geometry.push(zo(pe[me],pe[me+1],V,G,W,re));else for(let me=0;me<pe.length;me++){const Ie=[];for(let je=0;je<pe[me].length;je+=2)Ie.push(zo(pe[me][je],pe[me][je+1],V,G,W,re));ce.geometry.push(Ie)}}return he.transformed=!0,he}function zo(he,V,G,W,re,ce){return[Math.round(G*(he*W-re)),Math.round(G*(V*W-ce))]}function xa(he,V,G,W,re){const ce=V===re.maxZoom?0:re.tolerance/((1<<V)*re.extent),pe={features:[],numPoints:0,numSimplified:0,numFeatures:he.length,source:null,x:G,y:W,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Te of he)wa(pe,Te,ce,re);return pe}function wa(he,V,G,W){const re=V.geometry,ce=V.type,pe=[];if(he.minX=Math.min(he.minX,V.minX),he.minY=Math.min(he.minY,V.minY),he.maxX=Math.max(he.maxX,V.maxX),he.maxY=Math.max(he.maxY,V.maxY),ce==="Point"||ce==="MultiPoint")for(let Te=0;Te<re.length;Te+=3)pe.push(re[Te],re[Te+1]),he.numPoints++,he.numSimplified++;else if(ce==="LineString")Ta(pe,re,he,G,!1,!1);else if(ce==="MultiLineString"||ce==="Polygon")for(let Te=0;Te<re.length;Te++)Ta(pe,re[Te],he,G,ce==="Polygon",Te===0);else if(ce==="MultiPolygon")for(let Te=0;Te<re.length;Te++){const me=re[Te];for(let Ie=0;Ie<me.length;Ie++)Ta(pe,me[Ie],he,G,!0,Ie===0)}if(pe.length){let Te=V.tags||null;if(ce==="LineString"&&W.lineMetrics){Te={};for(const Ie in V.tags)Te[Ie]=V.tags[Ie];Te.mapbox_clip_start=re.start/re.size,Te.mapbox_clip_end=re.end/re.size}const me={geometry:pe,type:ce==="Polygon"||ce==="MultiPolygon"?3:ce==="LineString"||ce==="MultiLineString"?2:1,tags:Te};V.id!==null&&(me.id=V.id),he.features.push(me)}}function Ta(he,V,G,W,re,ce){const pe=W*W;if(W>0&&V.size<(re?pe:W))return void(G.numPoints+=V.length/3);const Te=[];for(let me=0;me<V.length;me+=3)(W===0||V[me+2]>pe)&&(G.numSimplified++,Te.push(V[me],V[me+1])),G.numPoints++;re&&(function(me,Ie){let je=0;for(let Re=0,tt=me.length,ge=tt-2;Re<tt;ge=Re,Re+=2)je+=(me[Re]-me[ge])*(me[Re+1]+me[ge+1]);if(je>0===Ie)for(let Re=0,tt=me.length;Re<tt/2;Re+=2){const ge=me[Re],mt=me[Re+1];me[Re]=me[tt-2-Re],me[Re+1]=me[tt-1-Re],me[tt-2-Re]=ge,me[tt-1-Re]=mt}})(Te,ce),he.push(Te)}const Ka={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Sa{constructor(V,G){const W=(G=this.options=(function(ce,pe){for(const Te in pe)ce[Te]=pe[Te];return ce})(Object.create(Ka),G)).debug;if(W&&console.time("preprocess data"),G.maxZoom<0||G.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(G.promoteId&&G.generateId)throw new Error("promoteId and generateId cannot be used together.");let re=(function(ce,pe){const Te=[];if(ce.type==="FeatureCollection")for(let me=0;me<ce.features.length;me++)Ot(Te,ce.features[me],pe,me);else Ot(Te,ce.type==="Feature"?ce:{geometry:ce},pe);return Te})(V,G);this.tiles={},this.tileCoords=[],W&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",G.indexMaxZoom,G.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),re=(function(ce,pe){const Te=pe.buffer/pe.extent;let me=ce;const Ie=Cr(ce,1,-1-Te,Te,0,-1,2,pe),je=Cr(ce,1,1-Te,2+Te,0,-1,2,pe);return(Ie||je)&&(me=Cr(ce,1,-Te,1+Te,0,-1,2,pe)||[],Ie&&(me=Xa(Ie,1).concat(me)),je&&(me=me.concat(Xa(je,-1)))),me})(re,G),re.length&&this.splitTile(re,0,0,0),W&&(re.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(V,G,W,re,ce,pe,Te){const me=[V,G,W,re],Ie=this.options,je=Ie.debug;for(;me.length;){re=me.pop(),W=me.pop(),G=me.pop(),V=me.pop();const Re=1<<G,tt=ka(G,W,re);let ge=this.tiles[tt];if(!ge&&(je>1&&console.time("creation"),ge=this.tiles[tt]=xa(V,G,W,re,Ie),this.tileCoords.push({z:G,x:W,y:re}),je)){je>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",G,W,re,ge.numFeatures,ge.numPoints,ge.numSimplified),console.timeEnd("creation"));const Dr=`z${G}`;this.stats[Dr]=(this.stats[Dr]||0)+1,this.total++}if(ge.source=V,ce==null){if(G===Ie.indexMaxZoom||ge.numPoints<=Ie.indexMaxPoints)continue}else{if(G===Ie.maxZoom||G===ce)continue;if(ce!=null){const Dr=ce-G;if(W!==pe>>Dr||re!==Te>>Dr)continue}}if(ge.source=null,V.length===0)continue;je>1&&console.time("clipping");const mt=.5*Ie.buffer/Ie.extent,Ct=.5-mt,ot=.5+mt,bt=1+mt;let hr=null,Vr=null,qr=null,zr=null,zt=Cr(V,Re,W-mt,W+ot,0,ge.minX,ge.maxX,Ie),qt=Cr(V,Re,W+Ct,W+bt,0,ge.minX,ge.maxX,Ie);V=null,zt&&(hr=Cr(zt,Re,re-mt,re+ot,1,ge.minY,ge.maxY,Ie),Vr=Cr(zt,Re,re+Ct,re+bt,1,ge.minY,ge.maxY,Ie),zt=null),qt&&(qr=Cr(qt,Re,re-mt,re+ot,1,ge.minY,ge.maxY,Ie),zr=Cr(qt,Re,re+Ct,re+bt,1,ge.minY,ge.maxY,Ie),qt=null),je>1&&console.timeEnd("clipping"),me.push(hr||[],G+1,2*W,2*re),me.push(Vr||[],G+1,2*W,2*re+1),me.push(qr||[],G+1,2*W+1,2*re),me.push(zr||[],G+1,2*W+1,2*re+1)}}getTile(V,G,W){V=+V,G=+G,W=+W;const re=this.options,{extent:ce,debug:pe}=re;if(V<0||V>24)return null;const Te=1<<V,me=ka(V,G=G+Te&Te-1,W);if(this.tiles[me])return Fn(this.tiles[me],ce);pe>1&&console.log("drilling down to z%d-%d-%d",V,G,W);let Ie,je=V,Re=G,tt=W;for(;!Ie&&je>0;)je--,Re>>=1,tt>>=1,Ie=this.tiles[ka(je,Re,tt)];return Ie&&Ie.source?(pe>1&&(console.log("found parent tile z%d-%d-%d",je,Re,tt),console.time("drilling down")),this.splitTile(Ie.source,je,Re,tt,V,G,W),pe>1&&console.timeEnd("drilling down"),this.tiles[me]?Fn(this.tiles[me],ce):null):null}}function ka(he,V,G){return 32*((1<<he)*G+V)+he}class Ca extends O{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(V,G){return f._(this,void 0,void 0,(function*(){const W=V.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const re=this._geoJSONIndex.getTile(W.z,W.x,W.y);if(!re)return null;const ce=new Se(re.features,{version:2,extent:f.$});let pe=(function(Te){const me=new f.cM;return(function(Ie,je){for(const Re in Ie.layers)je.writeMessage(3,Pe,Ie.layers[Re])})(Te,me),me.finish()})(ce);return pe.byteOffset===0&&pe.byteLength===pe.buffer.byteLength||(pe=new Uint8Array(pe)),{vectorTile:ce,rawData:pe.buffer}}))}loadData(V){return f._(this,void 0,void 0,(function*(){var G;(G=this._pendingRequest)===null||G===void 0||G.abort();const W=!!(V&&V.request&&V.request.collectResourceTiming)&&new f.cN(V.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(V,this._pendingRequest);const re=yield this._pendingData;this._geoJSONIndex=V.cluster?new ur((function({superclusterOptions:pe,clusterProperties:Te}){if(!Te||!pe)return pe;const me={},Ie={},je={accumulated:null,zoom:0},Re={properties:null},tt=Object.keys(Te);for(const ge of tt){const[mt,Ct]=Te[ge],ot=f.cT(Ct),bt=f.cT(typeof mt=="string"?[mt,["accumulated"],["get",ge]]:mt);me[ge]=ot.value,Ie[ge]=bt.value}return pe.map=ge=>{Re.properties=ge;const mt={};for(const Ct of tt)mt[Ct]=me[Ct].evaluate(je,Re);return mt},pe.reduce=(ge,mt)=>{Re.properties=mt;for(const Ct of tt)je.accumulated=ge[Ct],ge[Ct]=Ie[Ct].evaluate(je,Re)},pe})(V)).load(re.features):(function(pe,Te){return new Sa(pe,Te)})(re,V.geojsonVtOptions),this.loaded={};const ce={data:re};if(W){const pe=W.finish();pe&&(ce.resourceTiming={},ce.resourceTiming[V.source]=JSON.parse(JSON.stringify(pe)))}return ce}catch(re){if(delete this._pendingRequest,f.cy(re))return{abandoned:!0};throw re}}))}getData(){return f._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(V){const G=this.loaded;return G&&G[V.uid]?super.reloadTile(V):this.loadTile(V)}loadAndProcessGeoJSON(V,G){return f._(this,void 0,void 0,(function*(){let W=yield this.loadGeoJSON(V,G);if(delete this._pendingRequest,typeof W!="object")throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`);if(Ee(W,!0),V.filter){const re=f.cT(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(re.result==="error")throw new Error(re.value.map((pe=>`${pe.key}: ${pe.message}`)).join(", "));W={type:"FeatureCollection",features:W.features.filter((pe=>re.value.evaluate({zoom:0},pe)))}}return W}))}loadGeoJSON(V,G){return f._(this,void 0,void 0,(function*(){const{promoteId:W}=V;if(V.request){const re=yield f.j(V.request,G);return this._dataUpdateable=f.cV(re.data,W)?f.cU(re.data,W):void 0,re.data}if(typeof V.data=="string")try{const re=JSON.parse(V.data);return this._dataUpdateable=f.cV(re,W)?f.cU(re,W):void 0,re}catch{throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`)}if(!V.dataDiff)throw new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${V.source}`);return f.cW(this._dataUpdateable,V.dataDiff,W),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(V){return f._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(V){return this._geoJSONIndex.getClusterExpansionZoom(V.clusterId)}getClusterChildren(V){return this._geoJSONIndex.getChildren(V.clusterId)}getClusterLeaves(V){return this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset)}}class Ro{constructor(V){this.self=V,this.actor=new f.J(V),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(G,W)=>{if(this.externalWorkerSourceTypes[G])throw new Error(`Worker source with name "${G}" already registered.`);this.externalWorkerSourceTypes[G]=W},this.self.addProtocol=f.cA,this.self.removeProtocol=f.cB,this.self.registerRTLTextPlugin=G=>{f.cX.setMethods(G)},this.actor.registerMessageHandler("LDT",((G,W)=>this._getDEMWorkerSource(G,W.source).loadTile(W))),this.actor.registerMessageHandler("RDT",((G,W)=>f._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(G,W.source).removeTile(W)})))),this.actor.registerMessageHandler("GCEZ",((G,W)=>f._(this,void 0,void 0,(function*(){return this._getWorkerSource(G,W.type,W.source).getClusterExpansionZoom(W)})))),this.actor.registerMessageHandler("GCC",((G,W)=>f._(this,void 0,void 0,(function*(){return this._getWorkerSource(G,W.type,W.source).getClusterChildren(W)})))),this.actor.registerMessageHandler("GCL",((G,W)=>f._(this,void 0,void 0,(function*(){return this._getWorkerSource(G,W.type,W.source).getClusterLeaves(W)})))),this.actor.registerMessageHandler("LD",((G,W)=>this._getWorkerSource(G,W.type,W.source).loadData(W))),this.actor.registerMessageHandler("GD",((G,W)=>this._getWorkerSource(G,W.type,W.source).getData())),this.actor.registerMessageHandler("LT",((G,W)=>this._getWorkerSource(G,W.type,W.source).loadTile(W))),this.actor.registerMessageHandler("RT",((G,W)=>this._getWorkerSource(G,W.type,W.source).reloadTile(W))),this.actor.registerMessageHandler("AT",((G,W)=>this._getWorkerSource(G,W.type,W.source).abortTile(W))),this.actor.registerMessageHandler("RMT",((G,W)=>this._getWorkerSource(G,W.type,W.source).removeTile(W))),this.actor.registerMessageHandler("RS",((G,W)=>f._(this,void 0,void 0,(function*(){if(!this.workerSources[G]||!this.workerSources[G][W.type]||!this.workerSources[G][W.type][W.source])return;const re=this.workerSources[G][W.type][W.source];delete this.workerSources[G][W.type][W.source],re.removeSource!==void 0&&re.removeSource(W)})))),this.actor.registerMessageHandler("RM",(G=>f._(this,void 0,void 0,(function*(){delete this.layerIndexes[G],delete this.availableImages[G],delete this.workerSources[G],delete this.demWorkerSources[G]})))),this.actor.registerMessageHandler("SR",((G,W)=>f._(this,void 0,void 0,(function*(){this.referrer=W})))),this.actor.registerMessageHandler("SRPS",((G,W)=>this._syncRTLPluginState(G,W))),this.actor.registerMessageHandler("IS",((G,W)=>f._(this,void 0,void 0,(function*(){this.self.importScripts(W)})))),this.actor.registerMessageHandler("SI",((G,W)=>this._setImages(G,W))),this.actor.registerMessageHandler("UL",((G,W)=>f._(this,void 0,void 0,(function*(){this._getLayerIndex(G).update(W.layers,W.removedIds)})))),this.actor.registerMessageHandler("SL",((G,W)=>f._(this,void 0,void 0,(function*(){this._getLayerIndex(G).replace(W)}))))}_setImages(V,G){return f._(this,void 0,void 0,(function*(){this.availableImages[V]=G;for(const W in this.workerSources[V]){const re=this.workerSources[V][W];for(const ce in re)re[ce].availableImages=G}}))}_syncRTLPluginState(V,G){return f._(this,void 0,void 0,(function*(){return yield f.cX.syncState(G,this.self.importScripts)}))}_getAvailableImages(V){let G=this.availableImages[V];return G||(G=[]),G}_getLayerIndex(V){let G=this.layerIndexes[V];return G||(G=this.layerIndexes[V]=new l),G}_getWorkerSource(V,G,W){if(this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][G]||(this.workerSources[V][G]={}),!this.workerSources[V][G][W]){const re={sendAsync:(ce,pe)=>(ce.targetMapId=V,this.actor.sendAsync(ce,pe))};switch(G){case"vector":this.workerSources[V][G][W]=new O(re,this._getLayerIndex(V),this._getAvailableImages(V));break;case"geojson":this.workerSources[V][G][W]=new Ca(re,this._getLayerIndex(V),this._getAvailableImages(V));break;default:this.workerSources[V][G][W]=new this.externalWorkerSourceTypes[G](re,this._getLayerIndex(V),this._getAvailableImages(V))}}return this.workerSources[V][G][W]}_getDEMWorkerSource(V,G){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][G]||(this.demWorkerSources[V][G]=new Z),this.demWorkerSources[V][G]}}return f.i(self)&&(self.worker=new Ro(self)),Ro})),m("index",["exports","./shared"],(function(f,l){var C="5.6.2";function M(){var g=new l.A(4);return l.A!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g}let D,O;const Z={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(g,e,o){const u=requestAnimationFrame((y=>{d(),e(y)})),{unsubscribe:d}=l.s(g.signal,"abort",(()=>{d(),cancelAnimationFrame(u),o(l.c())}),!1)},frameAsync(g){return new Promise(((e,o)=>{this.frame(g,e,o)}))},getImageData(g,e=0){return this.getImageCanvasContext(g).getImageData(-e,-e,g.width+2*e,g.height+2*e)},getImageCanvasContext(g){const e=window.document.createElement("canvas"),o=e.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return e.width=g.width,e.height=g.height,o.drawImage(g,0,0,g.width,g.height),o},resolveURL:g=>(D||(D=document.createElement("a")),D.href=g,D.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(O==null&&(O=matchMedia("(prefers-reduced-motion: reduce)")),O.matches)}};class ${static testProp(e){if(!$.docStyle)return e[0];for(let o=0;o<e.length;o++)if(e[o]in $.docStyle)return e[o];return e[0]}static create(e,o,u){const d=window.document.createElement(e);return o!==void 0&&(d.className=o),u&&u.appendChild(d),d}static createNS(e,o){return window.document.createElementNS(e,o)}static disableDrag(){$.docStyle&&$.selectProp&&($.userSelect=$.docStyle[$.selectProp],$.docStyle[$.selectProp]="none")}static enableDrag(){$.docStyle&&$.selectProp&&($.docStyle[$.selectProp]=$.userSelect)}static setTransform(e,o){e.style[$.transformProp]=o}static addEventListener(e,o,u,d={}){e.addEventListener(o,u,"passive"in d?d:d.capture)}static removeEventListener(e,o,u,d={}){e.removeEventListener(o,u,"passive"in d?d:d.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",$.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",$.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",$.suppressClickInternal,!0)}),0)}static getScale(e){const o=e.getBoundingClientRect();return{x:o.width/e.offsetWidth||1,y:o.height/e.offsetHeight||1,boundingClientRect:o}}static getPoint(e,o,u){const d=o.boundingClientRect;return new l.P((u.clientX-d.left)/o.x-e.clientLeft,(u.clientY-d.top)/o.y-e.clientTop)}static mousePos(e,o){const u=$.getScale(e);return $.getPoint(e,u,o)}static touchPos(e,o){const u=[],d=$.getScale(e);for(let y=0;y<o.length;y++)u.push($.getPoint(e,d,o[y]));return u}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const o=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),u=o.querySelectorAll("script");for(const d of u)d.remove();return $.clean(o),o.innerHTML}static isPossiblyDangerous(e,o){const u=o.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!u.includes("javascript:")&&!u.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const o=e.children;for(const u of o)$.removeAttributes(u),$.clean(u)}static removeAttributes(e){for(const{name:o,value:u}of e.attributes)$.isPossiblyDangerous(o,u)&&e.removeAttribute(o)}}$.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,$.selectProp=$.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),$.transformProp=$.testProp(["transform","WebkitTransform"]);const ne={supported:!1,testSupport:function(g){!_e&&Ee&&(Se?Pe(g):fe=g)}};let fe,Ee,_e=!1,Se=!1;function Pe(g){const e=g.createTexture();g.bindTexture(g.TEXTURE_2D,e);try{if(g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,Ee),g.isContextLost())return;ne.supported=!0}catch{}g.deleteTexture(e),_e=!0}var ve;typeof document<"u"&&(Ee=document.createElement("img"),Ee.onload=()=>{fe&&Pe(fe),fe=null,Se=!0},Ee.onerror=()=>{_e=!0,fe=null},Ee.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(g){let e,o,u,d;g.resetRequestQueue=()=>{e=[],o=0,u=0,d={}},g.addThrottleControl=k=>{const A=u++;return d[A]=k,A},g.removeThrottleControl=k=>{delete d[k],x()},g.getImage=(k,A,E=!0)=>new Promise(((L,R)=>{ne.supported&&(k.headers||(k.headers={}),k.headers.accept="image/webp,*/*"),l.e(k,{type:"image"}),e.push({abortController:A,requestParameters:k,supportImageRefresh:E,state:"queued",onError:F=>{R(F)},onSuccess:F=>{L(F)}}),x()}));const y=k=>l._(this,void 0,void 0,(function*(){k.state="running";const{requestParameters:A,supportImageRefresh:E,onError:L,onSuccess:R,abortController:F}=k,U=E===!1&&!l.i(self)&&!l.g(A.url)&&(!A.headers||Object.keys(A.headers).reduce(((Y,Q)=>Y&&Q==="accept"),!0));o++;const K=U?S(A,F):l.m(A,F);try{const Y=yield K;delete k.abortController,k.state="completed",Y.data instanceof HTMLImageElement||l.b(Y.data)?R(Y):Y.data&&R({data:yield(X=Y.data,typeof createImageBitmap=="function"?l.f(X):l.h(X)),cacheControl:Y.cacheControl,expires:Y.expires})}catch(Y){delete k.abortController,L(Y)}finally{o--,x()}var X})),x=()=>{const k=(()=>{for(const A of Object.keys(d))if(d[A]())return!0;return!1})()?l.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let A=o;A<k&&e.length>0;A++){const E=e.shift();E.abortController.signal.aborted?A--:y(E)}},S=(k,A)=>new Promise(((E,L)=>{const R=new Image,F=k.url,U=k.credentials;U&&U==="include"?R.crossOrigin="use-credentials":(U&&U==="same-origin"||!l.d(F))&&(R.crossOrigin="anonymous"),A.signal.addEventListener("abort",(()=>{R.src="",L(l.c())})),R.fetchPriority="high",R.onload=()=>{R.onerror=R.onload=null,E({data:R})},R.onerror=()=>{R.onerror=R.onload=null,A.signal.aborted||L(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},R.src=F}))})(ve||(ve={})),ve.resetRequestQueue();class ye{constructor(e){this._transformRequestFn=e??null}transformRequest(e,o){return this._transformRequestFn&&this._transformRequestFn(e,o)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function Ae(g){const e=[];if(typeof g=="string")e.push({id:"default",url:g});else if(g&&g.length>0){const o=[];for(const{id:u,url:d}of g){const y=`${u}${d}`;o.indexOf(y)===-1&&(o.push(y),e.push({id:u,url:d}))}}return e}function Ne(g,e,o){try{const u=new URL(g);return u.pathname+=`${e}${o}`,u.toString()}catch{throw new Error(`Invalid sprite URL "${g}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function it(g){const{userImage:e}=g;return!!(e&&e.render&&e.render())&&(g.data.replace(new Uint8Array(e.data.buffer)),!0)}class gt extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:o,promiseResolve:u}of this.requestors)u(this._getImagesForIds(o));this.requestors=[]}}getImage(e){const o=this.images[e];if(o&&!o.data&&o.spriteData){const u=o.spriteData;o.data=new l.R({width:u.width,height:u.height},u.context.getImageData(u.x,u.y,u.width,u.height).data),o.spriteData=null}return o}addImage(e,o){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,o)&&(this.images[e]=o)}_validate(e,o){let u=!0;const d=o.data||o.spriteData;return this._validateStretch(o.stretchX,d&&d.width)||(this.fire(new l.k(new Error(`Image "${e}" has invalid "stretchX" value`))),u=!1),this._validateStretch(o.stretchY,d&&d.height)||(this.fire(new l.k(new Error(`Image "${e}" has invalid "stretchY" value`))),u=!1),this._validateContent(o.content,o)||(this.fire(new l.k(new Error(`Image "${e}" has invalid "content" value`))),u=!1),u}_validateStretch(e,o){if(!e)return!0;let u=0;for(const d of e){if(d[0]<u||d[1]<d[0]||o<d[1])return!1;u=d[1]}return!0}_validateContent(e,o){if(!e)return!0;if(e.length!==4)return!1;const u=o.spriteData,d=u&&u.width||o.data.width,y=u&&u.height||o.data.height;return!(e[0]<0||d<e[0]||e[1]<0||y<e[1]||e[2]<0||d<e[2]||e[3]<0||y<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,o,u=!0){const d=this.getImage(e);if(u&&(d.data.width!==o.data.width||d.data.height!==o.data.height))throw new Error(`size mismatch between old image (${d.data.width}x${d.data.height}) and new image (${o.data.width}x${o.data.height}).`);o.version=d.version+1,this.images[e]=o,this.updatedImages[e]=!0}removeImage(e){const o=this.images[e];delete this.images[e],delete this.patterns[e],o.userImage&&o.userImage.onRemove&&o.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise(((o,u)=>{let d=!0;if(!this.isLoaded())for(const y of e)this.images[y]||(d=!1);this.isLoaded()||d?o(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:o})}))}_getImagesForIds(e){const o={};for(const u of e){let d=this.getImage(u);d||(this.fire(new l.l("styleimagemissing",{id:u})),d=this.getImage(u)),d?o[u]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,textFitWidth:d.textFitWidth,textFitHeight:d.textFitHeight,hasRenderCallback:!!(d.userImage&&d.userImage.render)}:l.w(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return o}getPixelSize(){const{width:e,height:o}=this.atlasImage;return{width:e,height:o}}getPattern(e){const o=this.patterns[e],u=this.getImage(e);if(!u)return null;if(o&&o.position.version===u.version)return o.position;if(o)o.position.version=u.version;else{const d={w:u.data.width+2,h:u.data.height+2,x:0,y:0},y=new l.I(d,u);this.patterns[e]={bin:d,position:y}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const o=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new l.T(e,this.atlasImage,o.RGBA),this.atlasTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const y in this.patterns)e.push(this.patterns[y].bin);const{w:o,h:u}=l.p(e),d=this.atlasImage;d.resize({width:o||1,height:u||1});for(const y in this.patterns){const{bin:x}=this.patterns[y],S=x.x+1,k=x.y+1,A=this.getImage(y).data,E=A.width,L=A.height;l.R.copy(A,d,{x:0,y:0},{x:S,y:k},{width:E,height:L}),l.R.copy(A,d,{x:0,y:L-1},{x:S,y:k-1},{width:E,height:1}),l.R.copy(A,d,{x:0,y:0},{x:S,y:k+L},{width:E,height:1}),l.R.copy(A,d,{x:E-1,y:0},{x:S-1,y:k},{width:1,height:L}),l.R.copy(A,d,{x:0,y:0},{x:S+E,y:k},{width:1,height:L})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const o of e){if(this.callbackDispatchedThisFrame[o])continue;this.callbackDispatchedThisFrame[o]=!0;const u=this.getImage(o);u||l.w(`Image with ID: "${o}" was not found`),it(u)&&this.updateImage(o,u)}}}const nt=1e20;function Zt(g,e,o,u,d,y,x,S,k){for(let A=e;A<e+u;A++)kt(g,o*y+A,y,d,x,S,k);for(let A=o;A<o+d;A++)kt(g,A*y+e,1,u,x,S,k)}function kt(g,e,o,u,d,y,x){y[0]=0,x[0]=-nt,x[1]=nt,d[0]=g[e];for(let S=1,k=0,A=0;S<u;S++){d[S]=g[e+S*o];const E=S*S;do{const L=y[k];A=(d[S]-d[L]+E-L*L)/(S-L)/2}while(A<=x[k]&&--k>-1);k++,y[k]=S,x[k]=A,x[k+1]=nt}for(let S=0,k=0;S<u;S++){for(;x[k+1]<S;)k++;const A=y[k],E=S-A;g[e+S*o]=d[A]+E*E}}class ur{constructor(e,o){this.requestManager=e,this.localIdeographFontFamily=o,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return l._(this,void 0,void 0,(function*(){const o=[];for(const y in e)for(const x of e[y])o.push(this._getAndCacheGlyphsPromise(y,x));const u=yield Promise.all(o),d={};for(const{stack:y,id:x,glyph:S}of u)d[y]||(d[y]={}),d[y][x]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics};return d}))}_getAndCacheGlyphsPromise(e,o){return l._(this,void 0,void 0,(function*(){let u=this.entries[e];u||(u=this.entries[e]={glyphs:{},requests:{},ranges:{}});let d=u.glyphs[o];if(d!==void 0)return{stack:e,id:o,glyph:d};if(d=this._tinySDF(u,e,o),d)return u.glyphs[o]=d,{stack:e,id:o,glyph:d};const y=Math.floor(o/256);if(256*y>65535)throw new Error("glyphs > 65535 not supported");if(u.ranges[y])return{stack:e,id:o,glyph:d};if(!this.url)throw new Error("glyphsUrl is not set");if(!u.requests[y]){const S=ur.loadGlyphRange(e,y,this.url,this.requestManager);u.requests[y]=S}const x=yield u.requests[y];for(const S in x)this._doesCharSupportLocalGlyph(+S)||(u.glyphs[+S]=x[+S]);return u.ranges[y]=!0,{stack:e,id:o,glyph:x[o]||null}}))}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))||l.u["CJK Unified Ideographs"](e)||l.u["Hangul Syllables"](e)||l.u.Hiragana(e)||l.u.Katakana(e)||l.u["CJK Symbols and Punctuation"](e)||l.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,o,u){const d=this.localIdeographFontFamily;if(!d||!this._doesCharSupportLocalGlyph(u))return;let y=e.tinySDF;if(!y){let S="400";/bold/i.test(o)?S="900":/medium/i.test(o)?S="500":/light/i.test(o)&&(S="200"),y=e.tinySDF=new ur.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:d,fontWeight:S})}const x=y.draw(String.fromCharCode(u));return{id:u,bitmap:new l.q({width:x.width||60,height:x.height||60},x.data),metrics:{width:x.glyphWidth/2||24,height:x.glyphHeight/2||24,left:x.glyphLeft/2+.5||0,top:x.glyphTop/2-27.5||-8,advance:x.glyphAdvance/2||24,isDoubleResolution:!0}}}}ur.loadGlyphRange=function(g,e,o,u){return l._(this,void 0,void 0,(function*(){const d=256*e,y=d+255,x=u.transformRequest(o.replace("{fontstack}",g).replace("{range}",`${d}-${y}`),"Glyphs"),S=yield l.n(x,new AbortController);if(!S||!S.data)throw new Error(`Could not load glyph range. range: ${e}, ${d}-${y}`);const k={};for(const A of l.o(S.data))k[A.id]=A;return k}))},ur.TinySDF=class{constructor({fontSize:g=24,buffer:e=3,radius:o=8,cutoff:u=.25,fontFamily:d="sans-serif",fontWeight:y="normal",fontStyle:x="normal",lang:S=null}={}){this.buffer=e,this.cutoff=u,this.radius=o,this.lang=S;const k=this.size=g+4*e,A=this._createCanvas(k),E=this.ctx=A.getContext("2d",{willReadFrequently:!0});E.font=`${x} ${y} ${g}px ${d}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(k*k),this.gridInner=new Float64Array(k*k),this.f=new Float64Array(k),this.z=new Float64Array(k+1),this.v=new Uint16Array(k)}_createCanvas(g){const e=document.createElement("canvas");return e.width=e.height=g,e}draw(g){const{width:e,actualBoundingBoxAscent:o,actualBoundingBoxDescent:u,actualBoundingBoxLeft:d,actualBoundingBoxRight:y}=this.ctx.measureText(g),x=Math.ceil(o),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-d))),k=Math.min(this.size-this.buffer,x+Math.ceil(u)),A=S+2*this.buffer,E=k+2*this.buffer,L=Math.max(A*E,0),R=new Uint8ClampedArray(L),F={data:R,width:A,height:E,glyphWidth:S,glyphHeight:k,glyphTop:x,glyphLeft:0,glyphAdvance:e};if(S===0||k===0)return F;const{ctx:U,buffer:K,gridInner:X,gridOuter:Y}=this;this.lang&&(U.lang=this.lang),U.clearRect(K,K,S,k),U.fillText(g,K,K+x);const Q=U.getImageData(K,K,S,k);Y.fill(nt,0,L),X.fill(0,0,L);for(let ie=0;ie<k;ie++)for(let ee=0;ee<S;ee++){const oe=Q.data[4*(ie*S+ee)+3]/255;if(oe===0)continue;const le=(ie+K)*A+ee+K;if(oe===1)Y[le]=0,X[le]=nt;else{const te=.5-oe;Y[le]=te>0?te*te:0,X[le]=te<0?te*te:0}}Zt(Y,0,0,A,E,A,this.f,this.v,this.z),Zt(X,K,K,S,k,A,this.f,this.v,this.z);for(let ie=0;ie<L;ie++){const ee=Math.sqrt(Y[ie])-Math.sqrt(X[ie]);R[ie]=Math.round(255-255*(ee/this.radius+this.cutoff))}return F}};class hi{constructor(){this.specification=l.v.light.position}possiblyEvaluate(e,o){return l.B(e.expression.evaluate(o))}interpolate(e,o,u){return{x:l.C.number(e.x,o.x,u),y:l.C.number(e.y,o.y,u),z:l.C.number(e.z,o.z,u)}}}let pi;class zi extends l.E{constructor(e){super(),pi=pi||new l.r({anchor:new l.D(l.v.light.anchor),position:new hi,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.t(pi),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,o={}){if(!this._validate(l.x,e,o))for(const u in e){const d=e[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),d):this._transitionable.setValue(u,d)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,o,u){return(!u||u.validate!==!1)&&l.y(this,e.call(l.z,{value:o,style:{glyphs:!0,sprite:!0},styleSpec:l.v}))}}const Ri=new l.r({"sky-color":new l.D(l.v.sky["sky-color"]),"horizon-color":new l.D(l.v.sky["horizon-color"]),"fog-color":new l.D(l.v.sky["fog-color"]),"fog-ground-blend":new l.D(l.v.sky["fog-ground-blend"]),"horizon-fog-blend":new l.D(l.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new l.D(l.v.sky["sky-horizon-blend"]),"atmosphere-blend":new l.D(l.v.sky["atmosphere-blend"])});class br extends l.E{constructor(e){super(),this._transitionable=new l.t(Ri),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.F(0))}setSky(e,o={}){if(!this._validate(l.G,e,o)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const u in e){const d=e[u];u.endsWith("-transition")?this._transitionable.setTransition(u.slice(0,-11),d):this._transitionable.setValue(u,d)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,o,u={}){return u?.validate!==!1&&l.y(this,e.call(l.z,l.e({value:o,style:{glyphs:!0,sprite:!0},styleSpec:l.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class Ft{constructor(e,o){this.width=e,this.height=o,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,o){const u=e.join(",")+String(o);return this.dashEntry[u]||(this.dashEntry[u]=this.addDash(e,o)),this.dashEntry[u]}getDashRanges(e,o,u){const d=[];let y=e.length%2==1?-e[e.length-1]*u:0,x=e[0]*u,S=!0;d.push({left:y,right:x,isDash:S,zeroLength:e[0]===0});let k=e[0];for(let A=1;A<e.length;A++){S=!S;const E=e[A];y=k*u,k+=E,x=k*u,d.push({left:y,right:x,isDash:S,zeroLength:E===0})}return d}addRoundDash(e,o,u){const d=o/2;for(let y=-u;y<=u;y++){const x=this.width*(this.nextRow+u+y);let S=0,k=e[S];for(let A=0;A<this.width;A++){A/k.right>1&&(k=e[++S]);const E=Math.abs(A-k.left),L=Math.abs(A-k.right),R=Math.min(E,L);let F;const U=y/u*(d+1);if(k.isDash){const K=d-Math.abs(U);F=Math.sqrt(R*R+K*K)}else F=d-Math.sqrt(R*R+U*U);this.data[x+A]=Math.max(0,Math.min(255,F+128))}}}addRegularDash(e){for(let S=e.length-1;S>=0;--S){const k=e[S],A=e[S+1];k.zeroLength?e.splice(S,1):A&&A.isDash===k.isDash&&(A.left=k.left,e.splice(S,1))}const o=e[0],u=e[e.length-1];o.isDash===u.isDash&&(o.left=u.left-this.width,u.right=o.right+this.width);const d=this.width*this.nextRow;let y=0,x=e[y];for(let S=0;S<this.width;S++){S/x.right>1&&(x=e[++y]);const k=Math.abs(S-x.left),A=Math.abs(S-x.right),E=Math.min(k,A);this.data[d+S]=Math.max(0,Math.min(255,(x.isDash?E:-E)+128))}}addDash(e,o){const u=o?7:0,d=2*u+1;if(this.nextRow+d>this.height)return l.w("LineAtlas out of space"),null;let y=0;for(let S=0;S<e.length;S++)y+=e[S];if(y!==0){const S=this.width/y,k=this.getDashRanges(e,this.width,S);o?this.addRoundDash(k,S,u):this.addRegularDash(k)}const x={y:(this.nextRow+u+.5)/this.height,height:2*u/this.height,width:y};return this.nextRow+=d,this.dirty=!0,x}bind(e){const o=e.gl;this.texture?(o.bindTexture(o.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,o.texSubImage2D(o.TEXTURE_2D,0,0,0,this.width,this.height,o.ALPHA,o.UNSIGNED_BYTE,this.data))):(this.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,this.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.ALPHA,this.width,this.height,0,o.ALPHA,o.UNSIGNED_BYTE,this.data))}}const Ye="maplibre_preloaded_worker_pool";class st{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<st.workerCount;)this.workers.push(new Worker(l.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach((o=>{o.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Ye]}numActive(){return Object.keys(this.active).length}}const vt=Math.floor(Z.hardwareConcurrency/2);let Ot,Et;function pr(){return Ot||(Ot=new st),Ot}st.workerCount=l.H(globalThis)?Math.max(Math.min(vt,3),1):1;class Vt{constructor(e,o){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=o;const u=this.workerPool.acquire(o);for(let d=0;d<u.length;d++){const y=new l.J(u[d],o);y.name=`Worker ${d}`,this.actors.push(y)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,o){const u=[];for(const d of this.actors)u.push(d.sendAsync({type:e,data:o}));return Promise.all(u)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach((o=>{o.remove()})),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,o){for(const u of this.actors)u.registerMessageHandler(e,o)}}function yr(){return Et||(Et=new Vt(pr(),l.K),Et.registerMessageHandler("GR",((g,e,o)=>l.m(e,o)))),Et}function Qt(g,e){const o=l.L();return l.M(o,o,[1,1,0]),l.N(o,o,[.5*g.width,.5*g.height,1]),g.calculatePosMatrix?l.O(o,o,g.calculatePosMatrix(e.toUnwrapped())):o}function Cr(g,e,o,u,d,y,x){var S;const k=(function(R,F,U){if(R)for(const K of R){const X=F[K];if(X&&X.source===U&&X.type==="fill-extrusion")return!0}else for(const K in F){const X=F[K];if(X.source===U&&X.type==="fill-extrusion")return!0}return!1})((S=d?.layers)!==null&&S!==void 0?S:null,e,g.id),A=y.maxPitchScaleFactor(),E=g.tilesIn(u,A,k);E.sort(di);const L=[];for(const R of E)L.push({wrappedTileID:R.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(e,o,g._state,R.queryGeometry,R.cameraQueryGeometry,R.scale,d,y,A,Qt(g.transform,R.tileID),x?(F,U)=>x(R.tileID,F,U):void 0)});return(function(R,F){for(const U in R)for(const K of R[U])xr(K,F);return R})((function(R){const F={},U={};for(const K of R){const X=K.queryResults,Y=K.wrappedTileID,Q=U[Y]=U[Y]||{};for(const ie in X){const ee=X[ie],oe=Q[ie]=Q[ie]||{},le=F[ie]=F[ie]||[];for(const te of ee)oe[te.featureIndex]||(oe[te.featureIndex]=!0,le.push(te))}}return F})(L),g)}function di(g,e){const o=g.tileID,u=e.tileID;return o.overscaledZ-u.overscaledZ||o.canonical.y-u.canonical.y||o.wrap-u.wrap||o.canonical.x-u.canonical.x}function xr(g,e){const o=g.feature,u=e.getFeatureState(o.layer["source-layer"],o.id);o.source=o.layer.source,o.layer["source-layer"]&&(o.sourceLayer=o.layer["source-layer"]),o.state=u}function dr(g,e,o){return l._(this,void 0,void 0,(function*(){let u=g;if(g.url?u=(yield l.j(e.transformRequest(g.url,"Source"),o)).data:yield Z.frameAsync(o),!u)return null;const d=l.Q(l.e(u,g),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in u&&u.vector_layers&&(d.vectorLayerIds=u.vector_layers.map((y=>y.id))),d}))}class Ht{constructor(e,o){e&&(o?this.setSouthWest(e).setNorthEast(o):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof l.S?new l.S(e.lng,e.lat):l.S.convert(e),this}setSouthWest(e){return this._sw=e instanceof l.S?new l.S(e.lng,e.lat):l.S.convert(e),this}extend(e){const o=this._sw,u=this._ne;let d,y;if(e instanceof l.S)d=e,y=e;else{if(!(e instanceof Ht))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ht.convert(e)):this.extend(l.S.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(l.S.convert(e)):this;if(d=e._sw,y=e._ne,!d||!y)return this}return o||u?(o.lng=Math.min(d.lng,o.lng),o.lat=Math.min(d.lat,o.lat),u.lng=Math.max(y.lng,u.lng),u.lat=Math.max(y.lat,u.lat)):(this._sw=new l.S(d.lng,d.lat),this._ne=new l.S(y.lng,y.lat)),this}getCenter(){return new l.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.S(this.getWest(),this.getNorth())}getSouthEast(){return new l.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:o,lat:u}=l.S.convert(e);let d=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&d}static convert(e){return e instanceof Ht?e:e&&new Ht(e)}static fromLngLat(e,o=0){const u=360*o/40075017,d=u/Math.cos(Math.PI/180*e.lat);return new Ht(new l.S(e.lng-d,e.lat-u),new l.S(e.lng+d,e.lat+u))}adjustAntiMeridian(){const e=new l.S(this._sw.lng,this._sw.lat),o=new l.S(this._ne.lng,this._ne.lat);return new Ht(e,e.lng>o.lng?new l.S(o.lng+360,o.lat):o)}}class tr{constructor(e,o,u){this.bounds=Ht.convert(this.validateBounds(e)),this.minzoom=o||0,this.maxzoom=u||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const o=Math.pow(2,e.z),u=Math.floor(l.V(this.bounds.getWest())*o),d=Math.floor(l.U(this.bounds.getNorth())*o),y=Math.ceil(l.V(this.bounds.getEast())*o),x=Math.ceil(l.U(this.bounds.getSouth())*o);return e.x>=u&&e.x<y&&e.y>=d&&e.y<x}}class Ur extends l.E{constructor(e,o,u,d){if(super(),this.id=e,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.Q(o,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d)}load(){return l._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield dr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(l.e(this,e),e.bounds&&(this.tileBounds=new tr(e.bounds,this.minzoom,this.maxzoom)),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new l.k(e))}}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(e){return l._(this,void 0,void 0,(function*(){const o=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u={request:this.map._requestManager.transformRequest(o,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};u.request.collectResourceTiming=this._collectResourceTiming;let d="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise(((y,x)=>{e.reloadPromise={resolve:y,reject:x}}))}else e.actor=this.dispatcher.getActor(),d="LT";e.abortController=new AbortController;try{const y=yield e.actor.sendAsync({type:d,data:u},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,y)}catch(y){if(delete e.abortController,e.aborted)return;if(y&&y.status!==404)throw y;this._afterTileLoadWorkerResponse(e,null)}}))}_afterTileLoadWorkerResponse(e,o){if(o&&o.resourceTiming&&(e.resourceTiming=o.resourceTiming),o&&this.map._refreshExpiredTiles&&e.setExpiryData(o),e.loadVectorData(o,this.map.painter),e.reloadPromise){const u=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(u.resolve).catch(u.reject)}}abortTile(e){return l._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}unloadTile(e){return l._(this,void 0,void 0,(function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class Li extends l.E{constructor(e,o,u,d){super(),this.id=e,this.dispatcher=u,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},o),l.e(this,l.Q(o,["url","scheme","tileSize"]))}load(){return l._(this,arguments,void 0,(function*(e=!1){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const o=yield dr(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,o&&(l.e(this,o),o.bounds&&(this.tileBounds=new tr(o.bounds,this.minzoom,this.maxzoom)),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(o){this._tileJSONRequest=null,this.fire(new l.k(o))}}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}serialize(){return l.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return l._(this,void 0,void 0,(function*(){const o=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const u=yield ve.getImage(this.map._requestManager.transformRequest(o,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(u&&u.data){this.map._refreshExpiredTiles&&(u.cacheControl||u.expires)&&e.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const d=this.map.painter.context,y=d.gl,x=u.data;e.texture=this.map.painter.getTileTexture(x.width),e.texture?e.texture.update(x,{useMipmap:!0}):(e.texture=new l.T(d,x,y.RGBA,{useMipmap:!0}),e.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(u){if(delete e.abortController,e.aborted)e.state="unloaded";else if(u)throw e.state="errored",u}}))}abortTile(e){return l._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)}))}unloadTile(e){return l._(this,void 0,void 0,(function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)}))}hasTransition(){return!1}}class Xa extends Li{constructor(e,o,u,d){super(e,o,u,d),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox",this.redFactor=o.redFactor,this.greenFactor=o.greenFactor,this.blueFactor=o.blueFactor,this.baseShift=o.baseShift}loadTile(e){return l._(this,void 0,void 0,(function*(){const o=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),u=this.map._requestManager.transformRequest(o,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const d=yield ve.getImage(u,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(d&&d.data){const y=d.data;this.map._refreshExpiredTiles&&(d.cacheControl||d.expires)&&e.setExpiryData({cacheControl:d.cacheControl,expires:d.expires});const x=l.b(y)&&l.W()?y:yield this.readImageNow(y),S={type:this.type,uid:e.uid,source:this.id,rawImageData:x,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const k=yield e.actor.sendAsync({type:"LDT",data:S});e.dem=k,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(d){if(delete e.abortController,e.aborted)e.state="unloaded";else if(d)throw e.state="errored",d}}))}readImageNow(e){return l._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&l.X()){const o=e.width+2,u=e.height+2;try{return new l.R({width:o,height:u},yield l.Y(e,-1,-1,o,u))}catch{}}return Z.getImageData(e,1)}))}_getNeighboringTiles(e){const o=e.canonical,u=Math.pow(2,o.z),d=(o.x-1+u)%u,y=o.x===0?e.wrap-1:e.wrap,x=(o.x+1+u)%u,S=o.x+1===u?e.wrap+1:e.wrap,k={};return k[new l.Z(e.overscaledZ,y,o.z,d,o.y).key]={backfilled:!1},k[new l.Z(e.overscaledZ,S,o.z,x,o.y).key]={backfilled:!1},o.y>0&&(k[new l.Z(e.overscaledZ,y,o.z,d,o.y-1).key]={backfilled:!1},k[new l.Z(e.overscaledZ,e.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},k[new l.Z(e.overscaledZ,S,o.z,x,o.y-1).key]={backfilled:!1}),o.y+1<u&&(k[new l.Z(e.overscaledZ,y,o.z,d,o.y+1).key]={backfilled:!1},k[new l.Z(e.overscaledZ,e.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},k[new l.Z(e.overscaledZ,S,o.z,x,o.y+1).key]={backfilled:!1}),k}unloadTile(e){return l._(this,void 0,void 0,(function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))}))}}class jn extends l.E{constructor(e,o,u,d){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:o.data},this.actor=u.getActor(),this.setEventedParent(d),this._data=o.data,this._options=l.e({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId,o.clusterMaxZoom!==void 0&&this.maxzoom<=o.clusterMaxZoom&&l.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${o.clusterMaxZoom}".`),this.workerOptions=l.e({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(o.buffer!==void 0?o.buffer:128),tolerance:this._pixelsToTileUnits(o.tolerance!==void 0?o.tolerance:.375),extent:l.$,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(o.clusterMaxZoom),minPoints:Math.max(2,o.clusterMinPoints||2),extent:l.$,radius:this._pixelsToTileUnits(o.clusterRadius||50),log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(l.$/this.tileSize)}_getClusterMaxZoom(e){const o=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||e===void 0||l.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${o}"`),o}load(){return l._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._pendingWorkerUpdate={data:e},this._updateWorkerData(),this}updateData(e){return this._pendingWorkerUpdate.diff=l.a0(this._pendingWorkerUpdate.diff,e),this._updateWorkerData(),this}getData(){return l._(this,void 0,void 0,(function*(){const e=l.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})}))}getCoordinatesFromGeometry(e){return e.type==="GeometryCollection"?e.geometries.map((o=>o.coordinates)).flat(1/0):e.coordinates.flat(1/0)}getBounds(){return l._(this,void 0,void 0,(function*(){const e=new Ht,o=yield this.getData();let u;switch(o.type){case"FeatureCollection":u=o.features.map((d=>this.getCoordinatesFromGeometry(d.geometry))).flat(1/0);break;case"Feature":u=this.getCoordinatesFromGeometry(o.geometry);break;default:u=this.getCoordinatesFromGeometry(o)}if(u.length==0)return e;for(let d=0;d<u.length-1;d+=2)e.extend([u[d],u[d+1]]);return e}))}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,o,u){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:o,offset:u}})}_updateWorkerData(){return l._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;const{data:e,diff:o}=this._pendingWorkerUpdate;if(!e&&!o)return void l.w(`No data or diff provided to GeoJSONSource ${this.id}.`);const u=l.e({type:this.type},this.workerOptions);e?(typeof e=="string"?(u.request=this.map._requestManager.transformRequest(Z.resolveURL(e),"Source"),u.request.collectResourceTiming=this._collectResourceTiming):u.data=JSON.stringify(e),this._pendingWorkerUpdate.data=void 0):o&&(u.dataDiff=o,this._pendingWorkerUpdate.diff=void 0),this._isUpdatingWorker=!0,this.fire(new l.l("dataloading",{dataType:"source"}));try{const d=yield this.actor.sendAsync({type:"LD",data:u});if(this._isUpdatingWorker=!1,this._removed||d.abandoned)return void this.fire(new l.l("dataabort",{dataType:"source"}));this._data=d.data;let y=null;d.resourceTiming&&d.resourceTiming[this.id]&&(y=d.resourceTiming[this.id].slice(0));const x={dataType:"source"};this._collectResourceTiming&&y&&y.length>0&&l.e(x,{resourceTiming:y}),this.fire(new l.l("data",Object.assign(Object.assign({},x),{sourceDataType:"metadata"}))),this.fire(new l.l("data",Object.assign(Object.assign({},x),{sourceDataType:"content"})))}catch(d){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new l.l("dataabort",{dataType:"source"}));this.fire(new l.k(d))}finally{(this._pendingWorkerUpdate.data||this._pendingWorkerUpdate.diff)&&this._updateWorkerData()}}))}loaded(){return!this._isUpdatingWorker&&this._pendingWorkerUpdate.data===void 0&&this._pendingWorkerUpdate.diff===void 0}loadTile(e){return l._(this,void 0,void 0,(function*(){const o=e.actor?"RT":"LT";e.actor=this.actor;const u={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};e.abortController=new AbortController;const d=yield this.actor.sendAsync({type:o,data:u},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(d,this.map.painter,o==="RT")}))}abortTile(e){return l._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0}))}unloadTile(e){return l._(this,void 0,void 0,(function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class Fn extends l.E{constructor(e,o,u,d){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=u,this.coordinates=o.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(d),this.options=o}load(e){return l._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new l.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const o=yield ve.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,o&&o.data&&(this.image=o.data,e&&(this.coordinates=e),this._finishLoading())}catch(o){this._request=null,this._loaded=!0,this.fire(new l.k(o))}}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const o=e.map(l.a1.fromLngLat);var u;return this.tileID=(function(d){const y=l.a2.fromPoints(d),x=y.width(),S=y.height(),k=Math.max(x,S),A=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),E=Math.pow(2,A);return new l.a4(A,Math.floor((y.minX+y.maxX)/2*E),Math.floor((y.minY+y.maxY)/2*E))})(o),this.terrainTileRanges=this._getOverlappingTileRanges(o),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=o.map((d=>this.tileID.getTilePoint(d)._round())),this.flippedWindingOrder=((u=this.tileCoords)[1].x-u[0].x)*(u[2].y-u[0].y)-(u[1].y-u[0].y)*(u[2].x-u[0].x)<0,this.fire(new l.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,o=e.gl;this.texture||(this.texture=new l.T(e,this.image,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let u=!1;for(const d in this.tiles){const y=this.tiles[d];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,u=!0)}u&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return l._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){const{minX:o,minY:u,maxX:d,maxY:y}=l.a2.fromPoints(e),x={};for(let S=0;S<=l.a3;S++){const k=Math.pow(2,S),A=Math.floor(o*k),E=Math.floor(u*k),L=Math.floor(d*k),R=Math.floor(y*k);x[S]={minTileX:A,minTileY:E,maxTileX:L,maxTileY:R}}return x}}class zo extends Fn{constructor(e,o,u,d){super(e,o,u,d),this.roundZoom=!0,this.type="video",this.options=o}load(){return l._(this,void 0,void 0,(function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const o of e.urls)this.urls.push(this.map._requestManager.transformRequest(o,"Source").url);try{const o=yield l.a5(this.urls);if(this._loaded=!0,!o)return;this.video=o,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(o){this.fire(new l.k(o))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const o=this.video.seekable;e<o.start(0)||e>o.end(0)?this.fire(new l.k(new l.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,o=e.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new l.T(e,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE));let u=!1;for(const d in this.tiles){const y=this.tiles[d];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,u=!0)}u&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class xa extends Fn{constructor(e,o,u,d){super(e,o,u,d),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some((y=>!Array.isArray(y)||y.length!==2||y.some((x=>typeof x!="number"))))||this.fire(new l.k(new l.a6(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.k(new l.a6(`sources.${e}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new l.k(new l.a6(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new l.k(new l.a6(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.k(new l.a6(`sources.${e}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){return l._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context,u=o.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new l.T(o,this.canvas,u.RGBA,{premultiply:!0});let d=!1;for(const y in this.tiles){const x=this.tiles[y];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,d=!0)}d&&this.fire(new l.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const wa={},Ta=g=>{switch(g){case"geojson":return jn;case"image":return Fn;case"raster":return Li;case"raster-dem":return Xa;case"vector":return Ur;case"video":return zo;case"canvas":return xa}return wa[g]},Ka="RTLPluginLoaded";class Sa extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=yr()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch((o=>{throw this.status="error",o}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return l._(this,arguments,void 0,(function*(o,u=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Z.resolveURL(o),!this.url)throw new Error(`requested url ${o} is invalid`);if(this.status==="unavailable"){if(!u)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return l._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.l(Ka))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let ka=null;function Ca(){return ka||(ka=new Sa),ka}class Ro{constructor(e,o){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=l.a7(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const o=e+this.timeAdded;o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,o,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=(function(d,y){const x={};if(!y)return x;for(const S of d){const k=S.layerIds.map((A=>y.getLayer(A))).filter(Boolean);if(k.length!==0){S.layers=k,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map((A=>k.filter((E=>E.id===A))[0])));for(const A of k)x[A.id]=S}}return x})(e.buckets,o?.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const y=this.buckets[d];if(y instanceof l.a9){if(this.hasSymbolBuckets=!0,!u)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const y=this.buckets[d];if(y instanceof l.a9&&y.hasRTLText){this.hasRTLText=!0,Ca().lazyLoad();break}}this.queryPadding=0;for(const d in this.buckets){const y=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(d).queryRadius(y))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new l.a8}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const u in this.buckets){const d=this.buckets[u];d.uploadPending()&&d.upload(e)}const o=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new l.T(e,this.imageAtlas.image,o.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new l.T(e,this.glyphAtlasImage,o.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,o,u,d,y,x,S,k,A,E,L){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:d,cameraQueryGeometry:y,scale:x,tileSize:this.tileSize,pixelPosMatrix:E,transform:k,params:S,queryPadding:this.queryPadding*A,getElevation:L},e,o,u):{}}querySourceFeatures(e,o){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const d=u.loadVTLayers(),y=o&&o.sourceLayer?o.sourceLayer:"",x=d._geojsonTileLayer||d[y];if(!x)return;const S=l.aa(o&&o.filter),{z:k,x:A,y:E}=this.tileID.canonical,L={z:k,x:A,y:E};for(let R=0;R<x.length;R++){const F=x.feature(R);if(S.needGeometry){const X=l.ab(F,!0);if(!S.filter(new l.F(this.tileID.overscaledZ),X,this.tileID.canonical))continue}else if(!S.filter(new l.F(this.tileID.overscaledZ),F))continue;const U=u.getId(F,y),K=new l.ac(F,k,A,E,U);K.tile=L,e.push(K)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const o=this.expirationTime;if(e.cacheControl){const u=l.ad(e.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const u=Date.now();let d=!1;if(this.expirationTime>u)d=!1;else if(o)if(this.expirationTime<o)d=!0;else{const y=this.expirationTime-o;y?this.expirationTime=u+Math.max(y,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const u=this.latestFeatureIndex.loadVTLayers();for(const d in this.buckets){if(!o.style.hasLayer(d))continue;const y=this.buckets[d],x=y.layers[0].sourceLayer||"_geojsonTileLayer",S=u[x],k=e[x];if(!S||!k||Object.keys(k).length===0)continue;y.update(k,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});const A=o&&o.style&&o.style.getLayer(d);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Z.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Z.now()+e}setDependencies(e,o){const u={};for(const d of o)u[d]=!0;this.dependencies[e]=u}hasDependency(e,o){for(const u of e){const d=this.dependencies[u];if(d){for(const y of o)if(d[y])return!0}}return!1}}class he{constructor(e,o){this.max=e,this.onRemove=o,this.reset()}reset(){for(const e in this.data)for(const o of this.data[e])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(e,o,u){const d=e.wrapped().key;this.data[d]===void 0&&(this.data[d]=[]);const y={value:o,timeout:void 0};if(u!==void 0&&(y.timeout=setTimeout((()=>{this.remove(e,y)}),u)),this.data[d].push(y),this.order.push(d),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const o=this.data[e].shift();return o.timeout&&clearTimeout(o.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),o.value}getByKey(e){const o=this.data[e];return o?o[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,o){if(!this.has(e))return this;const u=e.wrapped().key,d=o===void 0?0:this.data[u].indexOf(o),y=this.data[u][d];return this.data[u].splice(d,1),y.timeout&&clearTimeout(y.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(y.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(e){const o=[];for(const u in this.data)for(const d of this.data[u])e(d.value)||o.push(d);for(const u of o)this.remove(u.value.tileID,u)}}class V{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,o,u){const d=String(o);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][d]=this.stateChanges[e][d]||{},l.e(this.stateChanges[e][d],u),this.deletedStates[e]===null){this.deletedStates[e]={};for(const y in this.state[e])y!==d&&(this.deletedStates[e][y]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][d]===null){this.deletedStates[e][d]={};for(const y in this.state[e][d])u[y]||(this.deletedStates[e][d][y]=null)}else for(const y in u)this.deletedStates[e]&&this.deletedStates[e][d]&&this.deletedStates[e][d][y]===null&&delete this.deletedStates[e][d][y]}removeFeatureState(e,o,u){if(this.deletedStates[e]===null)return;const d=String(o);if(this.deletedStates[e]=this.deletedStates[e]||{},u&&o!==void 0)this.deletedStates[e][d]!==null&&(this.deletedStates[e][d]=this.deletedStates[e][d]||{},this.deletedStates[e][d][u]=null);else if(o!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][d])for(u in this.deletedStates[e][d]={},this.stateChanges[e][d])this.deletedStates[e][d][u]=null;else this.deletedStates[e][d]=null;else this.deletedStates[e]=null}getState(e,o){const u=String(o),d=l.e({},(this.state[e]||{})[u],(this.stateChanges[e]||{})[u]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const y=this.deletedStates[e][o];if(y===null)return{};for(const x in y)delete d[x]}return d}initializeTileState(e,o){e.setFeatureState(this.state,o)}coalesceChanges(e,o){const u={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const y={};for(const x in this.stateChanges[d])this.state[d][x]||(this.state[d][x]={}),l.e(this.state[d][x],this.stateChanges[d][x]),y[x]=this.state[d][x];u[d]=y}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const y={};if(this.deletedStates[d]===null)for(const x in this.state[d])y[x]={},this.state[d][x]={};else for(const x in this.deletedStates[d]){if(this.deletedStates[d][x]===null)this.state[d][x]={};else for(const S of Object.keys(this.deletedStates[d][x]))delete this.state[d][x][S];y[x]=this.state[d][x]}u[d]=u[d]||{},l.e(u[d],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const d in e)e[d].setFeatureState(u,o)}}const G=89.25;function W(g,e){const o=l.ah(e.lat,-l.ai,l.ai);return new l.P(l.V(e.lng)*g,l.U(o)*g)}function re(g,e){return new l.a1(e.x/g,e.y/g).toLngLat()}function ce(g){return g.cameraToCenterDistance*Math.min(.85*Math.tan(l.ae(90-g.pitch)),Math.tan(l.ae(G-g.pitch)))}function pe(g,e){const o=g.canonical,u=e/l.af(o.z),d=o.x+Math.pow(2,o.z)*g.wrap,y=l.ag(new Float64Array(16));return l.M(y,y,[d*u,o.y*u,0]),l.N(y,y,[u/l.$,u/l.$,1]),y}function Te(g,e,o,u,d){const y=l.a1.fromLngLat(g,e),x=d*l.aj(1,g.lat),S=x*Math.cos(l.ae(o)),k=Math.sqrt(x*x-S*S),A=k*Math.sin(l.ae(-u)),E=k*Math.cos(l.ae(-u));return new l.a1(y.x+A,y.y+E,y.z+S)}function me(g,e,o){const u=e.intersectsFrustum(g);if(!o||u===0)return u;const d=e.intersectsPlane(o);return d===0?0:u===2&&d===2?2:1}function Ie(g,e,o){let u=0;const d=(o-e)/10;for(let y=0;y<10;y++)u+=d*Math.pow(Math.cos(e+(y+.5)/10*(o-e)),g);return u}function je(g,e){return function(o,u,d,y,x){const S=2*((g-1)/l.ak(Math.cos(l.ae(G-x))/Math.cos(l.ae(G)))-1),k=Math.acos(d/y),A=2*Ie(S-1,0,l.ae(x/2)),E=Math.min(l.ae(G),k+l.ae(x/2)),L=Ie(S-1,Math.min(E,k-l.ae(x/2)),E),R=Math.atan(u/d),F=Math.hypot(u,d);let U=o;return U+=l.ak(y/F/Math.max(.5,Math.cos(l.ae(x/2)))),U+=S*l.ak(Math.cos(R))/2,U-=l.ak(Math.max(1,L/A/e))/2,U}}const Re=je(9.314,3);function tt(g,e){const o=(e.roundZoom?Math.round:Math.floor)(g.zoom+l.ak(g.tileSize/e.tileSize));return Math.max(0,o)}function ge(g,e){const o=g.getCameraFrustum(),u=g.getClippingPlane(),d=g.screenPointToMercatorCoordinate(g.getCameraPoint()),y=l.a1.fromLngLat(g.center,g.elevation);d.z=y.z+Math.cos(g.pitchInRadians)*g.cameraToCenterDistance/g.worldSize;const x=g.getCoveringTilesDetailsProvider(),S=x.allowVariableZoom(g,e),k=tt(g,e),A=e.minzoom||0,E=e.maxzoom!==void 0?e.maxzoom:g.maxZoom,L=Math.min(Math.max(0,k),E),R=Math.pow(2,L),F=[R*d.x,R*d.y,0],U=[R*y.x,R*y.y,0],K=Math.hypot(y.x-d.x,y.y-d.y),X=Math.abs(y.z-d.z),Y=Math.hypot(K,X),Q=oe=>({zoom:0,x:0,y:0,wrap:oe,fullyVisible:!1}),ie=[],ee=[];if(g.renderWorldCopies&&x.allowWorldCopies())for(let oe=1;oe<=3;oe++)ie.push(Q(-oe)),ie.push(Q(oe));for(ie.push(Q(0));ie.length>0;){const oe=ie.pop(),le=oe.x,te=oe.y;let de=oe.fullyVisible;const Ce={x:le,y:te,z:oe.zoom},be=x.getTileBoundingVolume(Ce,oe.wrap,g.elevation,e);if(!de){const $e=me(o,be,u);if($e===0)continue;de=$e===2}const xe=x.distanceToTile2d(d.x,d.y,Ce,be);let ke=k;S&&(ke=(e.calculateTileZoom||Re)(g.zoom+l.ak(g.tileSize/e.tileSize),xe,X,Y,g.fov)),ke=(e.roundZoom?Math.round:Math.floor)(ke),ke=Math.max(0,ke);const Fe=Math.min(ke,E);if(oe.wrap=x.getWrap(y,Ce,oe.wrap),oe.zoom>=Fe){if(oe.zoom<A)continue;const $e=L-oe.zoom,Le=F[0]-.5-(le<<$e),Qe=F[1]-.5-(te<<$e),Tt=e.reparseOverscaled?Math.max(oe.zoom,ke):oe.zoom;ee.push({tileID:new l.Z(oe.zoom===E?Tt:oe.zoom,oe.wrap,oe.zoom,le,te),distanceSq:l.al([U[0]-.5-le,U[1]-.5-te]),tileDistanceToCamera:Math.sqrt(Le*Le+Qe*Qe)})}else for(let $e=0;$e<4;$e++)ie.push({zoom:oe.zoom+1,x:(le<<1)+$e%2,y:(te<<1)+($e>>1),wrap:oe.wrap,fullyVisible:de})}return ee.sort(((oe,le)=>oe.distanceSq-le.distanceSq)).map((oe=>oe.tileID))}const mt=l.a2.fromPoints([new l.P(0,0),new l.P(l.$,l.$)]);class Ct extends l.E{constructor(e,o,u){super(),this.id=e,this.dispatcher=u,this.on("data",(d=>this._dataHandler(d))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((d,y,x,S)=>{const k=new(Ta(y.type))(d,y,x,S);if(k.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${k.id}`);return k})(e,o,u,this),this._tiles={},this._cache=new he(0,(d=>this._unloadTile(d))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new V,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const o=this._tiles[e];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,o,u){return l._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,o,u)}catch(d){e.state="errored",d.status!==404?this._source.fire(new l.k(d,{tile:e})):this.update(this.transform,this.terrain)}}))}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new l.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const u=this._tiles[o];u.upload(e),u.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((e=>e.tileID)).sort(ot).map((e=>e.key))}getRenderableIds(e){const o=[];for(const u in this._tiles)this._isIdRenderable(u,e)&&o.push(this._tiles[u]);return e?o.sort(((u,d)=>{const y=u.tileID,x=d.tileID,S=new l.P(y.canonical.x,y.canonical.y)._rotate(-this.transform.bearingInRadians),k=new l.P(x.canonical.x,x.canonical.y)._rotate(-this.transform.bearingInRadians);return y.overscaledZ-x.overscaledZ||k.y-S.y||k.x-S.x})).map((u=>u.tileID.key)):o.map((u=>u.tileID)).sort(ot).map((u=>u.key))}hasRenderableParent(e){const o=this.findLoadedParent(e,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(e,o){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(o||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)e?this._reloadTile(o,"expired"):this._tiles[o].state!=="errored"&&this._reloadTile(o,"reloading")}}_reloadTile(e,o){return l._(this,void 0,void 0,(function*(){const u=this._tiles[e];u&&(u.state!=="loading"&&(u.state=o),yield this._loadTile(u,e,o))}))}_tileLoaded(e,o,u){e.timeAdded=Z.now(),u==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(o,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new l.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const o=this.getRenderableIds();for(let d=0;d<o.length;d++){const y=o[d];if(e.neighboringTiles&&e.neighboringTiles[y]){const x=this.getTileByID(y);u(e,x),u(x,e)}}function u(d,y){d.needsHillshadePrepare=!0,d.needsTerrainPrepare=!0;let x=y.tileID.canonical.x-d.tileID.canonical.x;const S=y.tileID.canonical.y-d.tileID.canonical.y,k=Math.pow(2,d.tileID.canonical.z),A=y.tileID.key;x===0&&S===0||Math.abs(S)>1||(Math.abs(x)>1&&(Math.abs(x+k)===1?x+=k:Math.abs(x-k)===1&&(x-=k)),y.dem&&d.dem&&(d.dem.backfillBorder(y.dem,x,S),d.neighboringTiles&&d.neighboringTiles[A]&&(d.neighboringTiles[A].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,o,u,d){for(const y in this._tiles){let x=this._tiles[y];if(d[y]||!x.hasData()||x.tileID.overscaledZ<=o||x.tileID.overscaledZ>u)continue;let S=x.tileID;for(;x&&x.tileID.overscaledZ>o+1;){const A=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[A.key],x&&x.hasData()&&(S=A)}let k=S;for(;k.overscaledZ>o;)if(k=k.scaledTo(k.overscaledZ-1),e[k.key]||e[k.canonical.key]){d[S.key]=S;break}}}findLoadedParent(e,o){if(e.key in this._loadedParentTiles){const u=this._loadedParentTiles[e.key];return u&&u.tileID.overscaledZ>=o?u:null}for(let u=e.overscaledZ-1;u>=o;u--){const d=e.scaledTo(u),y=this._getLoadedTile(d);if(y)return y}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const o=this._tiles[e.key];return o&&o.hasData()?o:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const o=Math.ceil(e.width/this._source.tileSize)+1,u=Math.ceil(e.height/this._source.tileSize)+1,d=Math.floor(o*u*(this._maxTileCacheZoomLevels===null?l.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(y)}handleWrapJump(e){const o=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,o){const u={};for(const d in this._tiles){const y=this._tiles[d];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+o),u[y.tileID.key]=y}this._tiles=u;for(const d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(const d in this._tiles)this._setTileReloadTimer(d,this._tiles[d])}}_updateCoveredAndRetainedTiles(e,o,u,d,y,x){const S={},k={},A=Object.keys(e),E=Z.now();for(const L of A){const R=e[L],F=this._tiles[L];if(!F||F.fadeEndTime!==0&&F.fadeEndTime<=E)continue;const U=this.findLoadedParent(R,o),K=this.findLoadedSibling(R),X=U||K||null;X&&(this._addTile(X.tileID),S[X.tileID.key]=X.tileID),k[L]=R}this._retainLoadedChildren(k,d,u,e);for(const L in S)e[L]||(this._coveredTiles[L]=!0,e[L]=S[L]);if(x){const L={},R={};for(const F of y)this._tiles[F.key].hasData()?L[F.key]=F:R[F.key]=F;for(const F in R){const U=R[F].children(this._source.maxzoom);this._tiles[U[0].key]&&this._tiles[U[1].key]&&this._tiles[U[2].key]&&this._tiles[U[3].key]&&(L[U[0].key]=e[U[0].key]=U[0],L[U[1].key]=e[U[1].key]=U[1],L[U[2].key]=e[U[2].key]=U[2],L[U[3].key]=e[U[3].key]=U[3],delete R[F])}for(const F in R){const U=R[F],K=this.findLoadedParent(U,this._source.minzoom),X=this.findLoadedSibling(U),Y=K||X||null;if(Y){L[Y.tileID.key]=e[Y.tileID.key]=Y.tileID;for(const Q in L)L[Q].isChildOf(Y.tileID)&&delete L[Q]}}for(const F in this._tiles)L[F]||(this._coveredTiles[F]=!0)}}update(e,o){if(!this._sourceLoaded||this._paused)return;let u;this.transform=e,this.terrain=o,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((E=>new l.Z(E.canonical.z,E.wrap,E.canonical.z,E.canonical.x,E.canonical.y))):(u=ge(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:o,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(u=u.filter((E=>this._source.hasTile(E))))):u=[];const d=tt(e,this._source),y=Math.max(d-Ct.maxOverzooming,this._source.minzoom),x=Math.max(d+Ct.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const E={};for(const L of u)if(L.canonical.z>this._source.minzoom){const R=L.scaledTo(L.canonical.z-1);E[R.key]=R;const F=L.scaledTo(Math.max(this._source.minzoom,Math.min(L.canonical.z,5)));E[F.key]=F}u=u.concat(Object.values(E))}const S=u.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,S&&this.fire(new l.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const k=this._updateRetainedTiles(u,d);bt(this._source.type)&&this._updateCoveredAndRetainedTiles(k,y,x,d,u,o);for(const E in k)this._tiles[E].clearFadeHold();const A=l.am(this._tiles,k);for(const E of A){const L=this._tiles[E];L.hasSymbolBuckets&&!L.holdingForFade()?L.setHoldDuration(this.map._fadeDuration):L.hasSymbolBuckets&&!L.symbolFadeFinished()||this._removeTile(E)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,o){var u;const d={},y={},x=Math.max(o-Ct.maxOverzooming,this._source.minzoom),S=Math.max(o+Ct.maxUnderzooming,this._source.minzoom),k={};for(const A of e){const E=this._addTile(A);d[A.key]=A,E.hasData()||o<this._source.maxzoom&&(k[A.key]=A)}this._retainLoadedChildren(k,o,S,d);for(const A of e){let E=this._tiles[A.key];if(E.hasData())continue;if(o+1>this._source.maxzoom){const R=A.children(this._source.maxzoom)[0],F=this.getTile(R);if(F&&F.hasData()){d[R.key]=R;continue}}else{const R=A.children(this._source.maxzoom);if(d[R[0].key]&&d[R[1].key]&&d[R[2].key]&&d[R[3].key])continue}let L=E.wasRequested();for(let R=A.overscaledZ-1;R>=x;--R){const F=A.scaledTo(R);if(y[F.key])break;if(y[F.key]=!0,E=this.getTile(F),!E&&L&&(E=this._addTile(F)),E){const U=E.hasData();if((U||!(!((u=this.map)===null||u===void 0)&&u.cancelPendingTileRequestsWhileZooming)||L)&&(d[F.key]=F),L=E.wasRequested(),U)break}}}return d}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const o=[];let u,d=this._tiles[e].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){u=this._loadedParentTiles[d.key];break}o.push(d.key);const y=d.scaledTo(d.overscaledZ-1);if(u=this._getLoadedTile(y),u)break;d=y}for(const y of o)this._loadedParentTiles[y]=u}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const o=this._tiles[e].tileID,u=this._getLoadedTile(o);this._loadedSiblingTiles[o.key]=u}}_addTile(e){let o=this._tiles[e.key];if(o)return o;o=this._cache.getAndRemove(e),o&&(this._setTileReloadTimer(e.key,o),o.tileID=e,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,o)));const u=o;return o||(o=new Ro(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(o,e.key,o.state)),o.uses++,this._tiles[e.key]=o,u||this._source.fire(new l.l("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o}_setTileReloadTimer(e,o){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const u=o.getExpiryTimeout();u&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),u))}refreshTiles(e){for(const o in this._tiles)(this._isIdRenderable(o)||this._tiles[o].state=="errored")&&e.some((u=>u.equals(this._tiles[o].tileID.canonical)))&&this._reloadTile(o,"expired")}_removeTile(e){const o=this._tiles[e];o&&(o.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),o.uses>0||(o.hasData()&&o.state!=="reloading"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}_dataHandler(e){const o=e.sourceDataType;e.dataType==="source"&&o==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&o==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,o,u){const d=[],y=this.transform;if(!y)return d;const x=y.getCoveringTilesDetailsProvider().allowWorldCopies(),S=u?y.getCameraQueryGeometry(e):e,k=F=>y.screenPointToMercatorCoordinate(F,this.terrain),A=this.transformBbox(e,k,!x),E=this.transformBbox(S,k,!x),L=this.getIds(),R=l.a2.fromPoints(E);for(let F=0;F<L.length;F++){const U=this._tiles[L[F]];if(U.holdingForFade())continue;const K=x?[U.tileID]:[U.tileID.unwrapTo(-1),U.tileID.unwrapTo(0)],X=Math.pow(2,y.zoom-U.tileID.overscaledZ),Y=o*U.queryPadding*l.$/U.tileSize/X;for(const Q of K){const ie=R.map((ee=>Q.getTilePoint(new l.a1(ee.x,ee.y))));if(ie.expandBy(Y),ie.intersects(mt)){const ee=A.map((le=>Q.getTilePoint(le))),oe=E.map((le=>Q.getTilePoint(le)));d.push({tile:U,tileID:x?Q:Q.unwrapTo(0),queryGeometry:ee,cameraQueryGeometry:oe,scale:X})}}}return d}transformBbox(e,o,u){let d=e.map(o);if(u){const y=l.a2.fromPoints(e);y.shrinkBy(.001*Math.min(y.width(),y.height()));const x=y.map(o);l.a2.fromPoints(d).covers(x)||(d=d.map((S=>S.x>.5?new l.a1(S.x-1,S.y,S.z):S)))}return d}getVisibleCoordinates(e){const o=this.getRenderableIds(e).map((u=>this._tiles[u].tileID));return this.transform&&this.transform.populateCache(o),o}hasTransition(){if(this._source.hasTransition())return!0;if(bt(this._source.type)){const e=Z.now();for(const o in this._tiles)if(this._tiles[o].fadeEndTime>=e)return!0}return!1}setFeatureState(e,o,u){this._state.updateState(e=e||"_geojsonTileLayer",o,u)}removeFeatureState(e,o,u){this._state.removeFeatureState(e=e||"_geojsonTileLayer",o,u)}getFeatureState(e,o){return this._state.getState(e=e||"_geojsonTileLayer",o)}setDependencies(e,o,u){const d=this._tiles[e];d&&d.setDependencies(o,u)}reloadTilesForDependencies(e,o){for(const u in this._tiles)this._tiles[u].hasDependency(e,o)&&this._reloadTile(u,"reloading");this._cache.filter((u=>!u.hasDependency(e,o)))}}function ot(g,e){const o=Math.abs(2*g.wrap)-+(g.wrap<0),u=Math.abs(2*e.wrap)-+(e.wrap<0);return g.overscaledZ-e.overscaledZ||u-o||e.canonical.y-g.canonical.y||e.canonical.x-g.canonical.x}function bt(g){return g==="raster"||g==="image"||g==="video"}Ct.maxOverzooming=10,Ct.maxUnderzooming=3;class hr{constructor(e,o){this.reset(e,o)}reset(e,o){this.points=e||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=l.ah(e,0,1);let o=1,u=this._distances[o];const d=e*this.paddedLength+this.padding;for(;u<d&&o<this._distances.length;)u=this._distances[++o];const y=o-1,x=this._distances[y],S=u-x,k=S>0?(d-x)/S:0;return this.points[y].mult(1-k).add(this.points[o].mult(k))}}function Vr(g,e){let o=!0;return g==="always"||g!=="never"&&e!=="never"||(o=!1),o}class qr{constructor(e,o,u){const d=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(e/u),this.yCellCount=Math.ceil(o/u);for(let x=0;x<this.xCellCount*this.yCellCount;x++)d.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=o,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,o,u,d,y){this._forEachCell(o,u,d,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(d),this.bboxes.push(y)}insertCircle(e,o,u,d){this._forEachCell(o-d,u-d,o+d,u+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(o),this.circles.push(u),this.circles.push(d)}_insertBoxCell(e,o,u,d,y,x){this.boxCells[y].push(x)}_insertCircleCell(e,o,u,d,y,x){this.circleCells[y].push(x)}_query(e,o,u,d,y,x,S){if(u<0||e>this.width||d<0||o>this.height)return[];const k=[];if(e<=0&&o<=0&&this.width<=u&&this.height<=d){if(y)return[{key:null,x1:e,y1:o,x2:u,y2:d}];for(let A=0;A<this.boxKeys.length;A++)k.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const E=this.circles[3*A],L=this.circles[3*A+1],R=this.circles[3*A+2];k.push({key:this.circleKeys[A],x1:E-R,y1:L-R,x2:E+R,y2:L+R})}}else this._forEachCell(e,o,u,d,this._queryCell,k,{hitTest:y,overlapMode:x,seenUids:{box:{},circle:{}}},S);return k}query(e,o,u,d){return this._query(e,o,u,d,!1,null)}hitTest(e,o,u,d,y,x){return this._query(e,o,u,d,!0,y,x).length>0}hitTestCircle(e,o,u,d,y){const x=e-u,S=e+u,k=o-u,A=o+u;if(S<0||x>this.width||A<0||k>this.height)return!1;const E=[];return this._forEachCell(x,k,S,A,this._queryCellCircle,E,{hitTest:!0,overlapMode:d,circle:{x:e,y:o,radius:u},seenUids:{box:{},circle:{}}},y),E.length>0}_queryCell(e,o,u,d,y,x,S,k){const{seenUids:A,hitTest:E,overlapMode:L}=S,R=this.boxCells[y];if(R!==null){const U=this.bboxes;for(const K of R)if(!A.box[K]){A.box[K]=!0;const X=4*K,Y=this.boxKeys[K];if(e<=U[X+2]&&o<=U[X+3]&&u>=U[X+0]&&d>=U[X+1]&&(!k||k(Y))&&(!E||!Vr(L,Y.overlapMode))&&(x.push({key:Y,x1:U[X],y1:U[X+1],x2:U[X+2],y2:U[X+3]}),E))return!0}}const F=this.circleCells[y];if(F!==null){const U=this.circles;for(const K of F)if(!A.circle[K]){A.circle[K]=!0;const X=3*K,Y=this.circleKeys[K];if(this._circleAndRectCollide(U[X],U[X+1],U[X+2],e,o,u,d)&&(!k||k(Y))&&(!E||!Vr(L,Y.overlapMode))){const Q=U[X],ie=U[X+1],ee=U[X+2];if(x.push({key:Y,x1:Q-ee,y1:ie-ee,x2:Q+ee,y2:ie+ee}),E)return!0}}}return!1}_queryCellCircle(e,o,u,d,y,x,S,k){const{circle:A,seenUids:E,overlapMode:L}=S,R=this.boxCells[y];if(R!==null){const U=this.bboxes;for(const K of R)if(!E.box[K]){E.box[K]=!0;const X=4*K,Y=this.boxKeys[K];if(this._circleAndRectCollide(A.x,A.y,A.radius,U[X+0],U[X+1],U[X+2],U[X+3])&&(!k||k(Y))&&!Vr(L,Y.overlapMode))return x.push(!0),!0}}const F=this.circleCells[y];if(F!==null){const U=this.circles;for(const K of F)if(!E.circle[K]){E.circle[K]=!0;const X=3*K,Y=this.circleKeys[K];if(this._circlesCollide(U[X],U[X+1],U[X+2],A.x,A.y,A.radius)&&(!k||k(Y))&&!Vr(L,Y.overlapMode))return x.push(!0),!0}}}_forEachCell(e,o,u,d,y,x,S,k){const A=this._convertToXCellCoord(e),E=this._convertToYCellCoord(o),L=this._convertToXCellCoord(u),R=this._convertToYCellCoord(d);for(let F=A;F<=L;F++)for(let U=E;U<=R;U++)if(y.call(this,e,o,u,d,this.xCellCount*U+F,x,S,k))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,o,u,d,y,x){const S=d-e,k=y-o,A=u+x;return A*A>S*S+k*k}_circleAndRectCollide(e,o,u,d,y,x,S){const k=(x-d)/2,A=Math.abs(e-(d+k));if(A>k+u)return!1;const E=(S-y)/2,L=Math.abs(o-(y+E));if(L>E+u)return!1;if(A<=k||L<=E)return!0;const R=A-k,F=L-E;return R*R+F*F<=u*u}}function zr(g,e,o){const u=l.L();if(!g){const{vecSouth:L,vecEast:R}=qt(e),F=M();F[0]=R[0],F[1]=R[1],F[2]=L[0],F[3]=L[1],d=F,(E=(x=(y=F)[0])*(A=y[3])-(k=y[2])*(S=y[1]))&&(d[0]=A*(E=1/E),d[1]=-S*E,d[2]=-k*E,d[3]=x*E),u[0]=F[0],u[1]=F[1],u[4]=F[2],u[5]=F[3]}var d,y,x,S,k,A,E;return l.N(u,u,[1/o,1/o,1]),u}function zt(g,e,o,u){if(g){const d=l.L();if(!e){const{vecSouth:y,vecEast:x}=qt(o);d[0]=x[0],d[1]=x[1],d[4]=y[0],d[5]=y[1]}return l.N(d,d,[u,u,1]),d}return o.pixelsToClipSpaceMatrix}function qt(g){const e=Math.cos(g.rollInRadians),o=Math.sin(g.rollInRadians),u=Math.cos(g.pitchInRadians),d=Math.cos(g.bearingInRadians),y=Math.sin(g.bearingInRadians),x=l.ar();x[0]=-d*u*o-y*e,x[1]=-y*u*o+d*e;const S=l.as(x);S<1e-9?l.at(x):l.au(x,x,1/S);const k=l.ar();k[0]=d*u*e-y*o,k[1]=y*u*e+d*o;const A=l.as(k);return A<1e-9?l.at(k):l.au(k,k,1/A),{vecEast:k,vecSouth:x}}function Dr(g,e,o,u){let d;u?(d=[g,e,u(g,e),1],l.aw(d,d,o)):(d=[g,e,0,1],Do(d,d,o));const y=d[3];return{point:new l.P(d[0]/y,d[1]/y),signedDistanceFromCamera:y,isOccluded:!1}}function Oe(g,e){return .5+g/e*.5}function fi(g,e){return g.x>=-e[0]&&g.x<=e[0]&&g.y>=-e[1]&&g.y<=e[1]}function wr(g,e,o,u,d,y,x,S,k,A,E,L,R){const F=o?g.textSizeData:g.iconSizeData,U=l.an(F,e.transform.zoom),K=[256/e.width*2+1,256/e.height*2+1],X=o?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;X.clear();const Y=g.lineVertexArray,Q=o?g.text.placedSymbolArray:g.icon.placedSymbolArray,ie=e.transform.width/e.transform.height;let ee=!1;for(let oe=0;oe<Q.length;oe++){const le=Q.get(oe);if(le.hidden||le.writingMode===l.ao.vertical&&!ee){On(le.numGlyphs,X);continue}ee=!1;const te=new l.P(le.anchorX,le.anchorY),de={getElevation:R,pitchedLabelPlaneMatrix:u,lineVertexArray:Y,pitchWithMap:y,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:te,unwrappedTileID:k,width:A,height:E,translation:L},Ce=Ma(le.anchorX,le.anchorY,de);if(!fi(Ce.point,K)){On(le.numGlyphs,X);continue}const be=Oe(e.transform.cameraToCenterDistance,Ce.signedDistanceFromCamera),xe=l.ap(F,U,le),ke=y?xe*e.transform.getPitchedTextCorrection(le.anchorX,le.anchorY,k)/be:xe*be,Fe=We({projectionContext:de,pitchedLabelPlaneMatrixInverse:d,symbol:le,fontSize:ke,flip:!1,keepUpright:x,glyphOffsetArray:g.glyphOffsetArray,dynamicLayoutVertexArray:X,aspectRatio:ie,rotateToLine:S});ee=Fe.useVertical,(Fe.notEnoughRoom||ee||Fe.needsFlipping&&We({projectionContext:de,pitchedLabelPlaneMatrixInverse:d,symbol:le,fontSize:ke,flip:!0,keepUpright:x,glyphOffsetArray:g.glyphOffsetArray,dynamicLayoutVertexArray:X,aspectRatio:ie,rotateToLine:S}).notEnoughRoom)&&On(le.numGlyphs,X)}o?g.text.dynamicLayoutVertexBuffer.updateData(X):g.icon.dynamicLayoutVertexBuffer.updateData(X)}function Pa(g,e,o,u,d,y,x,S){const k=y.glyphStartIndex+y.numGlyphs,A=y.lineStartIndex,E=y.lineStartIndex+y.lineLength,L=e.getoffsetX(y.glyphStartIndex),R=e.getoffsetX(k-1),F=Aa(g*L,o,u,d,y.segment,A,E,S,x);if(!F)return null;const U=Aa(g*R,o,u,d,y.segment,A,E,S,x);return U?S.projectionCache.anyProjectionOccluded?null:{first:F,last:U}:null}function Lo(g,e,o,u){return g===l.ao.horizontal&&Math.abs(o.y-e.y)>Math.abs(o.x-e.x)*u?{useVertical:!0}:(g===l.ao.vertical?e.y<o.y:e.x>o.x)?{needsFlipping:!0}:null}function We(g){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:o,symbol:u,fontSize:d,flip:y,keepUpright:x,glyphOffsetArray:S,dynamicLayoutVertexArray:k,aspectRatio:A,rotateToLine:E}=g,L=d/24,R=u.lineOffsetX*L,F=u.lineOffsetY*L;let U;if(u.numGlyphs>1){const K=u.glyphStartIndex+u.numGlyphs,X=u.lineStartIndex,Y=u.lineStartIndex+u.lineLength,Q=Pa(L,S,R,F,y,u,E,e);if(!Q)return{notEnoughRoom:!0};const ie=Ya(Q.first.point.x,Q.first.point.y,e,o),ee=Ya(Q.last.point.x,Q.last.point.y,e,o);if(x&&!y){const oe=Lo(u.writingMode,ie,ee,A);if(oe)return oe}U=[Q.first];for(let oe=u.glyphStartIndex+1;oe<K-1;oe++){const le=Aa(L*S.getoffsetX(oe),R,F,y,u.segment,X,Y,e,E);if(!le)return{notEnoughRoom:!0};U.push(le)}U.push(Q.last)}else{if(x&&!y){const X=ni(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,Y=u.lineStartIndex+u.segment+1,Q=new l.P(e.lineVertexArray.getx(Y),e.lineVertexArray.gety(Y)),ie=ni(Q.x,Q.y,e),ee=ie.signedDistanceFromCamera>0?ie.point:Pt(e.tileAnchorPoint,Q,X,1,e),oe=Ya(X.x,X.y,e,o),le=Ya(ee.x,ee.y,e,o),te=Lo(u.writingMode,oe,le,A);if(te)return te}const K=Aa(L*S.getoffsetX(u.glyphStartIndex),R,F,y,u.segment,u.lineStartIndex,u.lineStartIndex+u.lineLength,e,E);if(!K||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};U=[K]}for(const K of U)l.av(k,K.point,K.angle);return{}}function Pt(g,e,o,u,d){const y=g.add(g.sub(e)._unit()),x=ni(y.x,y.y,d).point,S=o.sub(x);return o.add(S._mult(u/S.mag()))}function St(g,e,o){const u=e.projectionCache;if(u.projections[g])return u.projections[g];const d=new l.P(e.lineVertexArray.getx(g),e.lineVertexArray.gety(g)),y=ni(d.x,d.y,e);if(y.signedDistanceFromCamera>0)return u.projections[g]=y.point,u.anyProjectionOccluded=u.anyProjectionOccluded||y.isOccluded,y.point;const x=g-o.direction;return Pt(o.distanceFromAnchor===0?e.tileAnchorPoint:new l.P(e.lineVertexArray.getx(x),e.lineVertexArray.gety(x)),d,o.previousVertex,o.absOffsetX-o.distanceFromAnchor+1,e)}function ni(g,e,o){const u=g+o.translation[0],d=e+o.translation[1];let y;return o.pitchWithMap?(y=Dr(u,d,o.pitchedLabelPlaneMatrix,o.getElevation),y.isOccluded=!1):(y=o.transform.projectTileCoordinates(u,d,o.unwrappedTileID,o.getElevation),y.point.x=(.5*y.point.x+.5)*o.width,y.point.y=(.5*-y.point.y+.5)*o.height),y}function Ya(g,e,o,u){if(o.pitchWithMap){const d=[g,e,0,1];return l.aw(d,d,u),o.transform.projectTileCoordinates(d[0]/d[3],d[1]/d[3],o.unwrappedTileID,o.getElevation).point}return{x:g/o.width*2-1,y:1-e/o.height*2}}function Ma(g,e,o){return o.transform.projectTileCoordinates(g,e,o.unwrappedTileID,o.getElevation)}function wt(g,e,o){return g._unit()._perp()._mult(e*o)}function Il(g,e,o,u,d,y,x,S,k){if(S.projectionCache.offsets[g])return S.projectionCache.offsets[g];const A=o.add(e);if(g+k.direction<u||g+k.direction>=d)return S.projectionCache.offsets[g]=A,A;const E=St(g+k.direction,S,k),L=wt(E.sub(o),x,k.direction),R=o.add(L),F=E.add(L);return S.projectionCache.offsets[g]=l.ax(y,A,R,F)||A,S.projectionCache.offsets[g]}function Aa(g,e,o,u,d,y,x,S,k){const A=u?g-e:g+e;let E=A>0?1:-1,L=0;u&&(E*=-1,L=Math.PI),E<0&&(L+=Math.PI);let R,F=E>0?y+d:y+d+1;S.projectionCache.cachedAnchorPoint?R=S.projectionCache.cachedAnchorPoint:(R=ni(S.tileAnchorPoint.x,S.tileAnchorPoint.y,S).point,S.projectionCache.cachedAnchorPoint=R);let U,K,X=R,Y=R,Q=0,ie=0;const ee=Math.abs(A),oe=[];let le;for(;Q+ie<=ee;){if(F+=E,F<y||F>=x)return null;Q+=ie,Y=X,K=U;const Ce={absOffsetX:ee,direction:E,distanceFromAnchor:Q,previousVertex:Y};if(X=St(F,S,Ce),o===0)oe.push(Y),le=X.sub(Y);else{let be;const xe=X.sub(Y);be=xe.mag()===0?wt(St(F+E,S,Ce).sub(X),o,E):wt(xe,o,E),K||(K=Y.add(be)),U=Il(F,be,X,y,x,K,o,S,Ce),oe.push(K),le=U.sub(K)}ie=le.mag()}const te=le._mult((ee-Q)/ie)._add(K||Y),de=L+Math.atan2(X.y-Y.y,X.x-Y.x);return oe.push(te),{point:te,angle:k?de:0,path:oe}}const El=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function On(g,e){for(let o=0;o<g;o++){const u=e.length;e.resize(u+4),e.float32.set(El,3*u)}}function Do(g,e,o){const u=e[0],d=e[1];return g[0]=o[0]*u+o[4]*d+o[12],g[1]=o[1]*u+o[5]*d+o[13],g[3]=o[3]*u+o[7]*d+o[15],g}const Pr=100;class zl{constructor(e,o=new qr(e.width+200,e.height+200,25),u=new qr(e.width+200,e.height+200,25)){this.transform=e,this.grid=o,this.ignoredGrid=u,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Pr,this.screenBottomBoundary=e.height+Pr,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,o,u,d,y,x,S,k,A,E,L,R){const F=this.projectAndGetPerspectiveRatio(e.anchorPointX+k[0],e.anchorPointY+k[1],y,E,R),U=u*F.perspectiveRatio;let K;if(x||S)K=this._projectCollisionBox(e,U,d,y,x,S,k,F,E,L,R);else{const le=F.x+(L?L.x*U:0),te=F.y+(L?L.y*U:0);K={allPointsOccluded:!1,box:[le+e.x1*U,te+e.y1*U,le+e.x2*U,te+e.y2*U]}}const[X,Y,Q,ie]=K.box,ee=x?K.allPointsOccluded:F.isOccluded;let oe=ee;return oe||(oe=F.perspectiveRatio<this.perspectiveRatioCutoff),oe||(oe=!this.isInsideGrid(X,Y,Q,ie)),oe||o!=="always"&&this.grid.hitTest(X,Y,Q,ie,o,A)?{box:[X,Y,Q,ie],placeable:!1,offscreen:!1,occluded:ee}:{box:[X,Y,Q,ie],placeable:!0,offscreen:this.isOffscreen(X,Y,Q,ie),occluded:ee}}placeCollisionCircles(e,o,u,d,y,x,S,k,A,E,L,R,F,U){const K=[],X=new l.P(o.anchorX,o.anchorY),Y=this.getPerspectiveRatio(X.x,X.y,x,U),Q=(A?y*this.transform.getPitchedTextCorrection(o.anchorX,o.anchorY,x)/Y:y*Y)/l.aB,ie={getElevation:U,pitchedLabelPlaneMatrix:S,lineVertexArray:u,pitchWithMap:A,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:X,unwrappedTileID:x,width:this.transform.width,height:this.transform.height,translation:F},ee=Pa(Q,d,o.lineOffsetX*Q,o.lineOffsetY*Q,!1,o,!1,ie);let oe=!1,le=!1,te=!0;if(ee){const de=.5*L*Y+R,Ce=new l.P(-100,-100),be=new l.P(this.screenRightBoundary,this.screenBottomBoundary),xe=new hr,ke=ee.first,Fe=ee.last;let $e=[];for(let Tt=ke.path.length-1;Tt>=1;Tt--)$e.push(ke.path[Tt]);for(let Tt=1;Tt<Fe.path.length;Tt++)$e.push(Fe.path[Tt]);const Le=2.5*de;if(A){const Tt=this.projectPathToScreenSpace($e,ie);$e=Tt.some((Kt=>Kt.signedDistanceFromCamera<=0))?[]:Tt.map((Kt=>Kt.point))}let Qe=[];if($e.length>0){const Tt=$e[0].clone(),Kt=$e[0].clone();for(let nr=1;nr<$e.length;nr++)Tt.x=Math.min(Tt.x,$e[nr].x),Tt.y=Math.min(Tt.y,$e[nr].y),Kt.x=Math.max(Kt.x,$e[nr].x),Kt.y=Math.max(Kt.y,$e[nr].y);Qe=Tt.x>=Ce.x&&Kt.x<=be.x&&Tt.y>=Ce.y&&Kt.y<=be.y?[$e]:Kt.x<Ce.x||Tt.x>be.x||Kt.y<Ce.y||Tt.y>be.y?[]:l.ay([$e],Ce.x,Ce.y,be.x,be.y)}for(const Tt of Qe){xe.reset(Tt,.25*de);let Kt=0;Kt=xe.length<=.5*de?1:Math.ceil(xe.paddedLength/Le)+1;for(let nr=0;nr<Kt;nr++){const rr=nr/Math.max(Kt-1,1),_r=xe.lerp(rr),Sr=_r.x+Pr,xt=_r.y+Pr;K.push(Sr,xt,de,0);const ar=Sr-de,Fr=xt-de,Gr=Sr+de,Yr=xt+de;if(te=te&&this.isOffscreen(ar,Fr,Gr,Yr),le=le||this.isInsideGrid(ar,Fr,Gr,Yr),e!=="always"&&this.grid.hitTestCircle(Sr,xt,de,e,E)&&(oe=!0,!k))return{circles:[],offscreen:!1,collisionDetected:oe}}}}return{circles:!k&&oe||!le||Y<this.perspectiveRatioCutoff?[]:K,offscreen:te,collisionDetected:oe}}projectPathToScreenSpace(e,o){const u=(function(d,y){const x=l.L();return l.aq(x,y.pitchedLabelPlaneMatrix),d.map((S=>{const k=Dr(S.x,S.y,x,y.getElevation),A=y.transform.projectTileCoordinates(k.point.x,k.point.y,y.unwrappedTileID,y.getElevation);return A.point.x=(.5*A.point.x+.5)*y.width,A.point.y=(.5*-A.point.y+.5)*y.height,A}))})(e,o);return(function(d){let y=0,x=0,S=0,k=0;for(let A=0;A<d.length;A++)d[A].isOccluded?(S=A+1,k=0):(k++,k>x&&(x=k,y=S));return d.slice(y,y+x)})(u)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[],u=new l.a2;for(const L of e){const R=new l.P(L.x+Pr,L.y+Pr);u.extend(R),o.push(R)}const{minX:d,minY:y,maxX:x,maxY:S}=u,k=this.grid.query(d,y,x,S).concat(this.ignoredGrid.query(d,y,x,S)),A={},E={};for(const L of k){const R=L.key;if(A[R.bucketInstanceId]===void 0&&(A[R.bucketInstanceId]={}),A[R.bucketInstanceId][R.featureIndex])continue;const F=[new l.P(L.x1,L.y1),new l.P(L.x2,L.y1),new l.P(L.x2,L.y2),new l.P(L.x1,L.y2)];l.az(o,F)&&(A[R.bucketInstanceId][R.featureIndex]=!0,E[R.bucketInstanceId]===void 0&&(E[R.bucketInstanceId]=[]),E[R.bucketInstanceId].push(R.featureIndex))}return E}insertCollisionBox(e,o,u,d,y,x){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:y,collisionGroupID:x,overlapMode:o},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,o,u,d,y,x){const S=u?this.ignoredGrid:this.grid,k={bucketInstanceId:d,featureIndex:y,collisionGroupID:x,overlapMode:o};for(let A=0;A<e.length;A+=4)S.insertCircle(k,e[A],e[A+1],e[A+2])}projectAndGetPerspectiveRatio(e,o,u,d,y){if(y){let x;d?(x=[e,o,d(e,o),1],l.aw(x,x,y)):(x=[e,o,0,1],Do(x,x,y));const S=x[3];return{x:(x[0]/S+1)/2*this.transform.width+Pr,y:(-x[1]/S+1)/2*this.transform.height+Pr,perspectiveRatio:.5+this.transform.cameraToCenterDistance/S*.5,isOccluded:!1,signedDistanceFromCamera:S}}{const x=this.transform.projectTileCoordinates(e,o,u,d);return{x:(x.point.x+1)/2*this.transform.width+Pr,y:(1-x.point.y)/2*this.transform.height+Pr,perspectiveRatio:.5+this.transform.cameraToCenterDistance/x.signedDistanceFromCamera*.5,isOccluded:x.isOccluded,signedDistanceFromCamera:x.signedDistanceFromCamera}}}getPerspectiveRatio(e,o,u,d){const y=this.transform.projectTileCoordinates(e,o,u,d);return .5+this.transform.cameraToCenterDistance/y.signedDistanceFromCamera*.5}isOffscreen(e,o,u,d){return u<Pr||e>=this.screenRightBoundary||d<Pr||o>this.screenBottomBoundary}isInsideGrid(e,o,u,d){return u>=0&&e<this.gridRightBoundary&&d>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const e=l.ag([]);return l.M(e,e,[-100,-100,0]),e}_projectCollisionBox(e,o,u,d,y,x,S,k,A,E,L){let R=1,F=0,U=0,K=1;const X=e.anchorPointX+S[0],Y=e.anchorPointY+S[1];if(x&&!y){const $e=this.projectAndGetPerspectiveRatio(X+1,Y,d,A,L),Le=$e.x-k.x,Qe=Math.atan(($e.y-k.y)/Le)+(Le<0?Math.PI:0),Tt=Math.sin(Qe),Kt=Math.cos(Qe);R=Kt,F=Tt,U=-Tt,K=Kt}else if(!x&&y){const $e=qt(this.transform);R=$e.vecEast[0],F=$e.vecEast[1],U=$e.vecSouth[0],K=$e.vecSouth[1]}let Q=k.x,ie=k.y,ee=o;y&&(Q=X,ie=Y,ee=Math.pow(2,-(this.transform.zoom-u.overscaledZ)),ee*=this.transform.getPitchedTextCorrection(X,Y,d),E||(ee*=l.ah(.5+k.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),E&&(Q+=R*E.x*ee+U*E.y*ee,ie+=F*E.x*ee+K*E.y*ee);const oe=e.x1*ee,le=e.x2*ee,te=(oe+le)/2,de=e.y1*ee,Ce=e.y2*ee,be=(de+Ce)/2,xe=[{offsetX:oe,offsetY:de},{offsetX:te,offsetY:de},{offsetX:le,offsetY:de},{offsetX:le,offsetY:be},{offsetX:le,offsetY:Ce},{offsetX:te,offsetY:Ce},{offsetX:oe,offsetY:Ce},{offsetX:oe,offsetY:be}];let ke=[];for(const{offsetX:$e,offsetY:Le}of xe)ke.push(new l.P(Q+R*$e+U*Le,ie+F*$e+K*Le));let Fe=!1;if(y){const $e=ke.map((Le=>this.projectAndGetPerspectiveRatio(Le.x,Le.y,d,A,L)));Fe=$e.some((Le=>!Le.isOccluded)),ke=$e.map((Le=>new l.P(Le.x,Le.y)))}else Fe=!0;return{box:l.aA(ke),allPointsOccluded:!Fe}}}class Di{constructor(e,o,u,d){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?o:-o))):d&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class or{constructor(e,o,u,d,y){this.text=new Di(e?e.text:null,o,u,y),this.icon=new Di(e?e.icon:null,o,d,y)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class pp{constructor(e,o,u){this.text=e,this.icon=o,this.skipFade=u}}class Ts{constructor(e,o,u,d,y){this.bucketInstanceId=e,this.featureIndex=o,this.sourceLayerIndex=u,this.bucketIndex=d,this.tileID=y}}class cu{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const o=++this.maxGroupID;this.collisionGroups[e]={ID:o,predicate:u=>u.collisionGroupID===o}}return this.collisionGroups[e]}}function Ia(g,e,o,u,d){const{horizontalAlign:y,verticalAlign:x}=l.aH(g);return new l.P(-(y-.5)*e+u[0]*d,-(x-.5)*o+u[1]*d)}class Ea{constructor(e,o,u,d,y){this.transform=e.clone(),this.terrain=o,this.collisionIndex=new zl(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new cu(d),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const o=this.terrain;return o?(u,d)=>o.getElevation(e,u,d):null}getBucketParts(e,o,u,d){const y=u.getBucket(o),x=u.latestFeatureIndex;if(!y||!x||o.id!==y.layerIds[0])return;const S=u.collisionBoxArray,k=y.layers[0].layout,A=y.layers[0].paint,E=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),L=u.tileSize/l.$,R=u.tileID.toUnwrapped(),F=k.get("text-rotation-alignment")==="map",U=l.aC(u,1,this.transform.zoom),K=l.aD(this.collisionIndex.transform,u,A.get("text-translate"),A.get("text-translate-anchor")),X=l.aD(this.collisionIndex.transform,u,A.get("icon-translate"),A.get("icon-translate-anchor")),Y=zr(F,this.transform,U);this.retainedQueryData[y.bucketInstanceId]=new Ts(y.bucketInstanceId,x,y.sourceLayerIndex,y.index,u.tileID);const Q={bucket:y,layout:k,translationText:K,translationIcon:X,unwrappedTileID:R,pitchedLabelPlaneMatrix:Y,scale:E,textPixelRatio:L,holdingForFade:u.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:l.an(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(d)for(const ie of y.sortKeyRanges){const{sortKey:ee,symbolInstanceStart:oe,symbolInstanceEnd:le}=ie;e.push({sortKey:ee,symbolInstanceStart:oe,symbolInstanceEnd:le,parameters:Q})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:Q})}attemptAnchorPlacement(e,o,u,d,y,x,S,k,A,E,L,R,F,U,K,X,Y,Q,ie,ee){const oe=l.aE[e.textAnchor],le=[e.textOffset0,e.textOffset1],te=Ia(oe,u,d,le,y),de=this.collisionIndex.placeCollisionBox(o,R,k,A,E,S,x,X,L.predicate,ie,te,ee);if((!Q||this.collisionIndex.placeCollisionBox(Q,R,k,A,E,S,x,Y,L.predicate,ie,te,ee).placeable)&&de.placeable){let Ce;if(this.prevPlacement&&this.prevPlacement.variableOffsets[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID].text&&(Ce=this.prevPlacement.variableOffsets[F.crossTileID].anchor),F.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[F.crossTileID]={textOffset:le,width:u,height:d,anchor:oe,textBoxScale:y,prevAnchor:Ce},this.markUsedJustification(U,oe,F,K),U.allowVerticalPlacement&&(this.markUsedOrientation(U,K,F),this.placedOrientations[F.crossTileID]=K),{shift:te,placedGlyphBoxes:de}}}placeLayerBucketPart(e,o,u){const{bucket:d,layout:y,translationText:x,translationIcon:S,unwrappedTileID:k,pitchedLabelPlaneMatrix:A,textPixelRatio:E,holdingForFade:L,collisionBoxArray:R,partiallyEvaluatedTextSize:F,collisionGroup:U}=e.parameters,K=y.get("text-optional"),X=y.get("icon-optional"),Y=l.aF(y,"text-overlap","text-allow-overlap"),Q=Y==="always",ie=l.aF(y,"icon-overlap","icon-allow-overlap"),ee=ie==="always",oe=y.get("text-rotation-alignment")==="map",le=y.get("text-pitch-alignment")==="map",te=y.get("icon-text-fit")!=="none",de=y.get("symbol-z-order")==="viewport-y",Ce=Q&&(ee||!d.hasIconData()||X),be=ee&&(Q||!d.hasTextData()||K);!d.collisionArrays&&R&&d.deserializeCollisionBoxes(R);const xe=this.retainedQueryData[d.bucketInstanceId].tileID,ke=this._getTerrainElevationFunc(xe),Fe=this.transform.getFastPathSimpleProjectionMatrix(xe),$e=(Le,Qe,Tt)=>{var Kt,nr;if(o[Le.crossTileID])return;if(L)return void(this.placements[Le.crossTileID]=new pp(!1,!1,!1));let rr=!1,_r=!1,Sr=!0,xt=null,ar={box:null,placeable:!1,offscreen:null,occluded:!1},Fr={placeable:!1},Gr=null,Yr=null,Si=null,_n=0,ja=0,Fa=0;Qe.textFeatureIndex?_n=Qe.textFeatureIndex:Le.useRuntimeCollisionCircles&&(_n=Le.featureIndex),Qe.verticalTextFeatureIndex&&(ja=Qe.verticalTextFeatureIndex);const rs=Qe.textBox;if(rs){const Oi=Or=>{let Zr=l.ao.horizontal;if(d.allowVerticalPlacement&&!Or&&this.prevPlacement){const nn=this.prevPlacement.placedOrientations[Le.crossTileID];nn&&(this.placedOrientations[Le.crossTileID]=nn,Zr=nn,this.markUsedOrientation(d,Zr,Le))}return Zr},vn=(Or,Zr)=>{if(d.allowVerticalPlacement&&Le.numVerticalGlyphVertices>0&&Qe.verticalTextBox){for(const nn of d.writingModes)if(nn===l.ao.vertical?(ar=Zr(),Fr=ar):ar=Or(),ar&&ar.placeable)break}else ar=Or()},ki=Le.textAnchorOffsetStartIndex,Oa=Le.textAnchorOffsetEndIndex;if(Oa===ki){const Or=(Zr,nn)=>{const Br=this.collisionIndex.placeCollisionBox(Zr,Y,E,xe,k,le,oe,x,U.predicate,ke,void 0,Fe);return Br&&Br.placeable&&(this.markUsedOrientation(d,nn,Le),this.placedOrientations[Le.crossTileID]=nn),Br};vn((()=>Or(rs,l.ao.horizontal)),(()=>{const Zr=Qe.verticalTextBox;return d.allowVerticalPlacement&&Le.numVerticalGlyphVertices>0&&Zr?Or(Zr,l.ao.vertical):{box:null,offscreen:null}})),Oi(ar&&ar.placeable)}else{let Or=l.aE[(nr=(Kt=this.prevPlacement)===null||Kt===void 0?void 0:Kt.variableOffsets[Le.crossTileID])===null||nr===void 0?void 0:nr.anchor];const Zr=(Br,Ks,ns)=>{const oa=Br.x2-Br.x1,bn=Br.y2-Br.y1,Ba=Le.textBoxScale,nd=te&&ie==="never"?Ks:null;let Gi=null,ad=Y==="never"?1:2,rh="never";Or&&ad++;for(let fc=0;fc<ad;fc++){for(let mc=ki;mc<Oa;mc++){const $a=d.textAnchorOffsets.get(mc);if(Or&&$a.textAnchor!==Or)continue;const sa=this.attemptAnchorPlacement($a,Br,oa,bn,Ba,oe,le,E,xe,k,U,rh,Le,d,ns,x,S,nd,ke);if(sa&&(Gi=sa.placedGlyphBoxes,Gi&&Gi.placeable))return rr=!0,xt=sa.shift,Gi}Or?Or=null:rh=Y}return u&&!Gi&&(Gi={box:this.collisionIndex.placeCollisionBox(rs,"always",E,xe,k,le,oe,x,U.predicate,ke,void 0,Fe).box,offscreen:!1,placeable:!1,occluded:!1}),Gi};vn((()=>Zr(rs,Qe.iconBox,l.ao.horizontal)),(()=>{const Br=Qe.verticalTextBox;return d.allowVerticalPlacement&&(!ar||!ar.placeable)&&Le.numVerticalGlyphVertices>0&&Br?Zr(Br,Qe.verticalIconBox,l.ao.vertical):{box:null,occluded:!0,offscreen:null}})),ar&&(rr=ar.placeable,Sr=ar.offscreen);const nn=Oi(ar&&ar.placeable);if(!rr&&this.prevPlacement){const Br=this.prevPlacement.variableOffsets[Le.crossTileID];Br&&(this.variableOffsets[Le.crossTileID]=Br,this.markUsedJustification(d,Br.anchor,Le,nn))}}}if(Gr=ar,rr=Gr&&Gr.placeable,Sr=Gr&&Gr.offscreen,Le.useRuntimeCollisionCircles){const Oi=d.text.placedSymbolArray.get(Le.centerJustifiedTextSymbolIndex),vn=l.ap(d.textSizeData,F,Oi),ki=y.get("text-padding");Yr=this.collisionIndex.placeCollisionCircles(Y,Oi,d.lineVertexArray,d.glyphOffsetArray,vn,k,A,u,le,U.predicate,Le.collisionCircleDiameter,ki,x,ke),Yr.circles.length&&Yr.collisionDetected&&!u&&l.w("Collisions detected, but collision boxes are not shown"),rr=Q||Yr.circles.length>0&&!Yr.collisionDetected,Sr=Sr&&Yr.offscreen}if(Qe.iconFeatureIndex&&(Fa=Qe.iconFeatureIndex),Qe.iconBox){const Oi=vn=>this.collisionIndex.placeCollisionBox(vn,ie,E,xe,k,le,oe,S,U.predicate,ke,te&&xt?xt:void 0,Fe);Fr&&Fr.placeable&&Qe.verticalIconBox?(Si=Oi(Qe.verticalIconBox),_r=Si.placeable):(Si=Oi(Qe.iconBox),_r=Si.placeable),Sr=Sr&&Si.offscreen}const is=K||Le.numHorizontalGlyphVertices===0&&Le.numVerticalGlyphVertices===0,go=X||Le.numIconVertices===0;is||go?go?is||(_r=_r&&rr):rr=_r&&rr:_r=rr=_r&&rr;const yo=_r&&Si.placeable;if(rr&&Gr.placeable&&this.collisionIndex.insertCollisionBox(Gr.box,Y,y.get("text-ignore-placement"),d.bucketInstanceId,Fr&&Fr.placeable&&ja?ja:_n,U.ID),yo&&this.collisionIndex.insertCollisionBox(Si.box,ie,y.get("icon-ignore-placement"),d.bucketInstanceId,Fa,U.ID),Yr&&rr&&this.collisionIndex.insertCollisionCircles(Yr.circles,Y,y.get("text-ignore-placement"),d.bucketInstanceId,_n,U.ID),u&&this.storeCollisionData(d.bucketInstanceId,Tt,Qe,Gr,Si,Yr),Le.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(d.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Le.crossTileID]=new pp((rr||Ce)&&!Gr?.occluded,(_r||be)&&!Si?.occluded,Sr||d.justReloaded),o[Le.crossTileID]=!0};if(de){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Le=d.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Qe=Le.length-1;Qe>=0;--Qe){const Tt=Le[Qe];$e(d.symbolInstances.get(Tt),d.collisionArrays[Tt],Tt)}}else for(let Le=e.symbolInstanceStart;Le<e.symbolInstanceEnd;Le++)$e(d.symbolInstances.get(Le),d.collisionArrays[Le],Le);d.justReloaded=!1}storeCollisionData(e,o,u,d,y,x){if(u.textBox||u.iconBox){let S,k;this.collisionBoxArrays.has(e)?S=this.collisionBoxArrays.get(e):(S=new Map,this.collisionBoxArrays.set(e,S)),S.has(o)?k=S.get(o):(k={text:null,icon:null},S.set(o,k)),u.textBox&&(k.text=d.box),u.iconBox&&(k.icon=y.box)}if(x){let S=this.collisionCircleArrays[e];S===void 0&&(S=this.collisionCircleArrays[e]=[]);for(let k=0;k<x.circles.length;k+=4)S.push(x.circles[k+0]-Pr),S.push(x.circles[k+1]-Pr),S.push(x.circles[k+2]),S.push(x.collisionDetected?1:0)}}markUsedJustification(e,o,u,d){let y;y=d===l.ao.vertical?u.verticalPlacedTextSymbolIndex:{left:u.leftJustifiedTextSymbolIndex,center:u.centerJustifiedTextSymbolIndex,right:u.rightJustifiedTextSymbolIndex}[l.aG(o)];const x=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex,u.verticalPlacedTextSymbolIndex];for(const S of x)S>=0&&(e.text.placedSymbolArray.get(S).crossTileID=y>=0&&S!==y?0:u.crossTileID)}markUsedOrientation(e,o,u){const d=o===l.ao.horizontal||o===l.ao.horizontalOnly?o:0,y=o===l.ao.vertical?o:0,x=[u.leftJustifiedTextSymbolIndex,u.centerJustifiedTextSymbolIndex,u.rightJustifiedTextSymbolIndex];for(const S of x)e.text.placedSymbolArray.get(S).placedOrientation=d;u.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(u.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let u=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const d=o?o.symbolFadeChange(e):1,y=o?o.opacities:{},x=o?o.variableOffsets:{},S=o?o.placedOrientations:{};for(const k in this.placements){const A=this.placements[k],E=y[k];E?(this.opacities[k]=new or(E,d,A.text,A.icon),u=u||A.text!==E.text.placed||A.icon!==E.icon.placed):(this.opacities[k]=new or(null,d,A.text,A.icon,A.skipFade),u=u||A.text||A.icon)}for(const k in y){const A=y[k];if(!this.opacities[k]){const E=new or(A,d,!1,!1);E.isHidden()||(this.opacities[k]=E,u=u||A.text.placed||A.icon.placed)}}for(const k in x)this.variableOffsets[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.variableOffsets[k]=x[k]);for(const k in S)this.placedOrientations[k]||!this.opacities[k]||this.opacities[k].isHidden()||(this.placedOrientations[k]=S[k]);if(o&&o.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");u?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:e)}updateLayerOpacities(e,o){const u={};for(const d of o){const y=d.getBucket(e);y&&d.latestFeatureIndex&&e.id===y.layerIds[0]&&this.updateBucketOpacities(y,d.tileID,u,d.collisionBoxArray)}}updateBucketOpacities(e,o,u,d){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const y=e.layers[0],x=y.layout,S=new or(null,0,!1,!1,!0),k=x.get("text-allow-overlap"),A=x.get("icon-allow-overlap"),E=y._unevaluatedLayout.hasValue("text-variable-anchor")||y._unevaluatedLayout.hasValue("text-variable-anchor-offset"),L=x.get("text-rotation-alignment")==="map",R=x.get("text-pitch-alignment")==="map",F=x.get("icon-text-fit")!=="none",U=new or(null,0,k&&(A||!e.hasIconData()||x.get("icon-optional")),A&&(k||!e.hasTextData()||x.get("text-optional")),!0);!e.collisionArrays&&d&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(d);const K=(Y,Q,ie)=>{for(let ee=0;ee<Q/4;ee++)Y.opacityVertexArray.emplaceBack(ie);Y.hasVisibleVertices=Y.hasVisibleVertices||ie!==Fo},X=this.collisionBoxArrays.get(e.bucketInstanceId);for(let Y=0;Y<e.symbolInstances.length;Y++){const Q=e.symbolInstances.get(Y),{numHorizontalGlyphVertices:ie,numVerticalGlyphVertices:ee,crossTileID:oe}=Q;let le=this.opacities[oe];u[oe]?le=S:le||(le=U,this.opacities[oe]=le),u[oe]=!0;const te=Q.numIconVertices>0,de=this.placedOrientations[Q.crossTileID],Ce=de===l.ao.vertical,be=de===l.ao.horizontal||de===l.ao.horizontalOnly;if(ie>0||ee>0){const ke=hu(le.text);K(e.text,ie,Ce?Fo:ke),K(e.text,ee,be?Fo:ke);const Fe=le.text.isHidden();[Q.rightJustifiedTextSymbolIndex,Q.centerJustifiedTextSymbolIndex,Q.leftJustifiedTextSymbolIndex].forEach((Qe=>{Qe>=0&&(e.text.placedSymbolArray.get(Qe).hidden=Fe||Ce?1:0)})),Q.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(Q.verticalPlacedTextSymbolIndex).hidden=Fe||be?1:0);const $e=this.variableOffsets[Q.crossTileID];$e&&this.markUsedJustification(e,$e.anchor,Q,de);const Le=this.placedOrientations[Q.crossTileID];Le&&(this.markUsedJustification(e,"left",Q,Le),this.markUsedOrientation(e,Le,Q))}if(te){const ke=hu(le.icon),Fe=!(F&&Q.verticalPlacedIconSymbolIndex&&Ce);Q.placedIconSymbolIndex>=0&&(K(e.icon,Q.numIconVertices,Fe?ke:Fo),e.icon.placedSymbolArray.get(Q.placedIconSymbolIndex).hidden=le.icon.isHidden()),Q.verticalPlacedIconSymbolIndex>=0&&(K(e.icon,Q.numVerticalIconVertices,Fe?Fo:ke),e.icon.placedSymbolArray.get(Q.verticalPlacedIconSymbolIndex).hidden=le.icon.isHidden())}const xe=X&&X.has(Y)?X.get(Y):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const ke=e.collisionArrays[Y];if(ke){let Fe=new l.P(0,0);if(ke.textBox||ke.verticalTextBox){let $e=!0;if(E){const Le=this.variableOffsets[oe];Le?(Fe=Ia(Le.anchor,Le.width,Le.height,Le.textOffset,Le.textBoxScale),L&&Fe._rotate(R?-this.transform.bearingInRadians:this.transform.bearingInRadians)):$e=!1}if(ke.textBox||ke.verticalTextBox){let Le;ke.textBox&&(Le=Ce),ke.verticalTextBox&&(Le=be),uu(e.textCollisionBox.collisionVertexArray,le.text.placed,!$e||Le,xe.text,Fe.x,Fe.y)}}if(ke.iconBox||ke.verticalIconBox){const $e=!!(!be&&ke.verticalIconBox);let Le;ke.iconBox&&(Le=$e),ke.verticalIconBox&&(Le=!$e),uu(e.iconCollisionBox.collisionVertexArray,le.icon.placed,Le,xe.icon,F?Fe.x:0,F?Fe.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,o){const u=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*u>e}setStale(){this.stale=!0}}function uu(g,e,o,u,d,y){u&&u.length!==0||(u=[0,0,0,0]);const x=u[0]-Pr,S=u[1]-Pr,k=u[2]-Pr,A=u[3]-Pr;g.emplaceBack(e?1:0,o?1:0,d||0,y||0,x,S),g.emplaceBack(e?1:0,o?1:0,d||0,y||0,k,S),g.emplaceBack(e?1:0,o?1:0,d||0,y||0,k,A),g.emplaceBack(e?1:0,o?1:0,d||0,y||0,x,A)}const dp=Math.pow(2,25),fp=Math.pow(2,24),jo=Math.pow(2,17),mp=Math.pow(2,16),Nf=Math.pow(2,9),Uf=Math.pow(2,8),Vf=Math.pow(2,1);function hu(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const e=g.placed?1:0,o=Math.floor(127*g.opacity);return o*dp+e*fp+o*jo+e*mp+o*Nf+e*Uf+o*Vf+e}const Fo=0;class pu{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,o,u,d,y){const x=this._bucketParts;for(;this._currentTileIndex<e.length;)if(o.getBucketParts(x,d,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort(((S,k)=>S.sortKey-k.sortKey)));this._currentPartIndex<x.length;)if(o.placeLayerBucketPart(x[this._currentPartIndex],this._seenCrossTileIDs,u),this._currentPartIndex++,y())return!0;return!1}}class du{constructor(e,o,u,d,y,x,S,k){this.placement=new Ea(e,o,x,S,k),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(e,o,u){const d=Z.now(),y=()=>!this._forceFullPlacement&&Z.now()-d>2;for(;this._currentPlacementIndex>=0;){const x=o[e[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(x.type==="symbol"&&(!x.minzoom||x.minzoom<=S)&&(!x.maxzoom||x.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new pu(x)),this._inProgressLayer.continuePlacement(u[x.source],this.placement,this._showCollisionBoxes,x,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Oo=512/l.$/2;class fu{constructor(e,o,u){this.tileID=e,this.bucketInstanceId=u,this._symbolsByKey={};const d=new Map;for(let y=0;y<o.length;y++){const x=o.get(y),S=x.key,k=d.get(S);k?k.push(x):d.set(S,[x])}for(const[y,x]of d){const S={positions:x.map((k=>({x:Math.floor(k.anchorX*Oo),y:Math.floor(k.anchorY*Oo)}))),crossTileIDs:x.map((k=>k.crossTileID))};if(S.positions.length>128){const k=new l.aI(S.positions.length,16,Uint16Array);for(const{x:A,y:E}of S.positions)k.add(A,E);k.finish(),delete S.positions,S.index=k}this._symbolsByKey[y]=S}}getScaledCoordinates(e,o){const{x:u,y:d,z:y}=this.tileID.canonical,{x,y:S,z:k}=o.canonical,A=Oo/Math.pow(2,k-y),E=(S*l.$+e.anchorY)*A,L=d*l.$*Oo;return{x:Math.floor((x*l.$+e.anchorX)*A-u*l.$*Oo),y:Math.floor(E-L)}}findMatches(e,o,u){const d=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z);for(let y=0;y<e.length;y++){const x=e.get(y);if(x.crossTileID)continue;const S=this._symbolsByKey[x.key];if(!S)continue;const k=this.getScaledCoordinates(x,o);if(S.index){const A=S.index.range(k.x-d,k.y-d,k.x+d,k.y+d).sort();for(const E of A){const L=S.crossTileIDs[E];if(!u[L]){u[L]=!0,x.crossTileID=L;break}}}else if(S.positions)for(let A=0;A<S.positions.length;A++){const E=S.positions[A],L=S.crossTileIDs[A];if(Math.abs(E.x-k.x)<=d&&Math.abs(E.y-k.y)<=d&&!u[L]){u[L]=!0,x.crossTileID=L;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:e})=>e))}}class mu{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class qf{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const o=Math.round((e-this.lng)/360);if(o!==0)for(const u in this.indexes){const d=this.indexes[u],y={};for(const x in d){const S=d[x];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+o),y[S.tileID.key]=S}this.indexes[u]=y}this.lng=e}addBucket(e,o,u){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let y=0;y<o.symbolInstances.length;y++)o.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const d=this.usedCrossTileIDs[e.overscaledZ];for(const y in this.indexes){const x=this.indexes[y];if(Number(y)>e.overscaledZ)for(const S in x){const k=x[S];k.tileID.isChildOf(e)&&k.findMatches(o.symbolInstances,e,d)}else{const S=x[e.scaledTo(Number(y)).key];S&&S.findMatches(o.symbolInstances,e,d)}}for(let y=0;y<o.symbolInstances.length;y++){const x=o.symbolInstances.get(y);x.crossTileID||(x.crossTileID=u.generate(),d[x.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new fu(e,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(e,o){for(const u of o.getCrossTileIDsLists())for(const d of u)delete this.usedCrossTileIDs[e][d]}removeStaleBuckets(e){let o=!1;for(const u in this.indexes){const d=this.indexes[u];for(const y in d)e[d[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,d[y]),delete d[y],o=!0)}return o}}class Bo{constructor(){this.layerIndexes={},this.crossTileIDs=new mu,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,o,u){let d=this.layerIndexes[e.id];d===void 0&&(d=this.layerIndexes[e.id]=new qf);let y=!1;const x={};d.handleWrapJump(u);for(const S of o){const k=S.getBucket(e);k&&e.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(S.tileID,k,this.crossTileIDs)&&(y=!0),x[k.bucketInstanceId]=!0)}return d.removeStaleBuckets(x)&&(y=!0),y}pruneUnusedLayers(e){const o={};e.forEach((u=>{o[u]=!0}));for(const u in this.layerIndexes)o[u]||delete this.layerIndexes[u]}}var Ss="void main() {fragColor=vec4(1.0);}";const un={prelude:Mt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Mt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Mt("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Mt(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Mt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Mt(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Mt(Ss,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Mt(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Mt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Mt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Mt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Mt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Mt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Mt(Ss,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Mt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Mt(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Mt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Mt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Mt(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Mt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Mt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Mt(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Mt(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Mt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Mt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Mt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Mt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Mt(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Mt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Mt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Mt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Mt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Mt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Mt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Mt(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Mt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Mt(g,e){const o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,u=e.match(/in ([\w]+) ([\w]+)/g),d=g.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=y?y.concat(d):d,S={};return{fragmentSource:g=g.replace(o,((k,A,E,L,R)=>(S[R]=!0,A==="define"?`
#ifndef HAS_UNIFORM_u_${R}
in ${E} ${L} ${R};
#else
uniform ${E} ${L} u_${R};
#endif
`:`
#ifdef HAS_UNIFORM_u_${R}
    ${E} ${L} ${R} = u_${R};
#endif
`))),vertexSource:e=e.replace(o,((k,A,E,L,R)=>{const F=L==="float"?"vec2":"vec4",U=R.match(/color/)?"color":F;return S[R]?A==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
in ${E} ${F} a_${R};
out ${E} ${L} ${R};
#else
uniform ${E} ${L} u_${R};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = a_${R};
#else
    ${E} ${L} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = unpack_mix_${U}(a_${R}, u_${R}_t);
#else
    ${E} ${L} ${R} = u_${R};
#endif
`:A==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
in ${E} ${F} a_${R};
#else
uniform ${E} ${L} u_${R};
#endif
`:U==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${E} ${L} ${R} = a_${R};
#else
    ${E} ${L} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    ${E} ${L} ${R} = unpack_mix_${U}(a_${R}, u_${R}_t);
#else
    ${E} ${L} ${R} = u_${R};
#endif
`})),staticAttributes:u,staticUniforms:x}}class Ja{constructor(e,o,u){this.vertexBuffer=e,this.indexBuffer=o,this.segments=u}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var za=l.aJ([{name:"a_pos",type:"Int16",components:2}]);const ra="#define PROJECTION_MERCATOR",Qa="mercator";class At{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Qa}get shaderDefine(){return ra}get shaderPreludeCode(){return un.projectionMercator}get vertexShaderPreludeCode(){return un.projectionMercator.vertexSource}get subdivisionGranularity(){return l.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,o,u,d,y){if(this._cachedMesh)return this._cachedMesh;const x=new l.aL;x.emplaceBack(0,0),x.emplaceBack(l.$,0),x.emplaceBack(0,l.$),x.emplaceBack(l.$,l.$);const S=e.createVertexBuffer(x,za.members),k=l.aM.simpleSegment(0,0,4,2),A=new l.aN;A.emplaceBack(1,0,2),A.emplaceBack(1,2,3);const E=e.createIndexBuffer(A);return this._cachedMesh=new Ja(S,E,k),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class eo{constructor(e=0,o=0,u=0,d=0){if(isNaN(e)||e<0||isNaN(o)||o<0||isNaN(u)||u<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=o,this.left=u,this.right=d}interpolate(e,o,u){return o.top!=null&&e.top!=null&&(this.top=l.C.number(e.top,o.top,u)),o.bottom!=null&&e.bottom!=null&&(this.bottom=l.C.number(e.bottom,o.bottom,u)),o.left!=null&&e.left!=null&&(this.left=l.C.number(e.left,o.left,u)),o.right!=null&&e.right!=null&&(this.right=l.C.number(e.right,o.right,u)),this}getCenter(e,o){const u=l.ah((this.left+e-this.right)/2,0,e),d=l.ah((this.top+o-this.bottom)/2,0,o);return new l.P(u,d)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new eo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Rl(g,e){if(!g.renderWorldCopies||g.lngRange)return;const o=e.lng-g.center.lng;e.lng+=o>180?-360:o<-180?360:0}function Ll(g){return Math.max(0,Math.floor(g))}class bi{constructor(e,o,u,d,y,x){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=x===void 0||!!x,this._minZoom=o||0,this._maxZoom=u||22,this._minPitch=d??0,this._maxPitch=y??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new l.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Ll(this._zoom),this._scale=l.af(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new eo,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,o,u){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=Ll(this._zoom),this._scale=l.af(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new eo(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!u&&e.autoCalculateNearFarZ,o&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const o=l.aO(e,-180,180)*Math.PI/180;var u,d,y,x,S,k,A,E,L;this._bearingInRadians!==o&&(this._unmodified=!1,this._bearingInRadians=o,this._calcMatrices(),this._rotationMatrix=M(),u=this._rotationMatrix,y=-this._bearingInRadians,x=(d=this._rotationMatrix)[0],S=d[1],k=d[2],A=d[3],E=Math.sin(y),L=Math.cos(y),u[0]=x*L+k*E,u[1]=S*L+A*E,u[2]=x*-E+k*L,u[3]=S*-E+A*L)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const o=l.ah(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==o&&(this._unmodified=!1,this._pitchInRadians=o,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const o=e/180*Math.PI;this._rollInRadians!==o&&(this._unmodified=!1,this._rollInRadians=o,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return l.aP(this._fovInRadians)}setFov(e){e=l.ah(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=l.ae(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const o=this.getConstrained(this._center,e).zoom;this._zoom!==o&&(this._unmodified=!1,this._zoom=o,this._tileZoom=Math.max(0,Math.floor(o)),this._scale=l.af(o),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,o){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=o,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,o,u){this._unmodified=!1,this._edgeInsets.interpolate(e,o,u),this._constrain(),this._calcMatrices()}resize(e,o,u=!0){this._width=e,this._height=o,u&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Ht([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-l.ai,l.ai])}getConstrained(e,o){return this._callbacks.getConstrained(e,o)}getCameraQueryGeometry(e,o){if(o.length===1)return[o[0],e];{const{minX:u,minY:d,maxX:y,maxY:x}=l.a2.fromPoints(o).extend(e);return[new l.P(u,d),new l.P(y,d),new l.P(y,x),new l.P(u,x),new l.P(u,d)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:o,zoom:u}=this.getConstrained(this.center,this.zoom);this.setCenter(o),this.setZoom(u),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=l.ag(new Float64Array(16));l.N(e,e,[this._width/2,-this._height/2,1]),l.M(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=l.ag(new Float64Array(16)),l.N(e,e,[1,-1,1]),l.M(e,e,[-1,-1,0]),l.N(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,o,u,d){const y=u!==void 0?u:this.bearing,x=d=d!==void 0?d:this.pitch,S=l.a1.fromLngLat(e,o),k=-Math.cos(l.ae(x)),A=Math.sin(l.ae(x)),E=A*Math.sin(l.ae(y)),L=-A*Math.cos(l.ae(y));let R=this.elevation;const F=o-R;let U;k*F>=0||Math.abs(k)<.1?(U=1e4,R=o+U*k):U=-F/k;let K,X,Y=l.aQ(1,S.y),Q=0;do{if(Q+=1,Q>10)break;X=U/Y,K=new l.a1(S.x+E*X,S.y+L*X),Y=1/K.meterInMercatorCoordinateUnits()}while(Math.abs(U-X*Y)>1e-12);return{center:K.toLngLat(),elevation:R,zoom:l.ak(this.height/2/Math.tan(this.fovInRadians/2)/X/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const o=l.aj(1,this.center.lat)*this.worldSize,u=this.cameraToCenterDistance/o,d=l.a1.fromLngLat(this.center,this.elevation),y=Te(this.center,this.elevation,this.pitch,this.bearing,u);this._elevation=e;const x=this.calculateCenterFromCameraLngLatAlt(y.toLngLat(),l.aQ(y.z,d.y),this.bearing,this.pitch);this._elevation=x.elevation,this._center=x.center,this.setZoom(x.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=l.aj(1,this.center.lat)*this.worldSize;return Te(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const o=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/o,e.canonical.y/o,1/o/l.$,1/o/l.$]}}class Xr{constructor(e,o){this.min=e,this.max=o,this.center=l.aR([],l.aS([],this.min,this.max),.5)}quadrant(e){const o=[e%2==0,e<2],u=l.aT(this.min),d=l.aT(this.max);for(let y=0;y<o.length;y++)u[y]=o[y]?this.min[y]:this.center[y],d[y]=o[y]?this.center[y]:this.max[y];return d[2]=this.max[2],new Xr(u,d)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let o=!0;for(let u=0;u<e.planes.length;u++){const d=this.intersectsPlane(e.planes[u]);if(d===0)return 0;d===1&&(o=!1)}return o?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let o=e[3],u=e[3];for(let d=0;d<3;d++)e[d]>0?(o+=e[d]*this.min[d],u+=e[d]*this.max[d]):(u+=e[d]*this.min[d],o+=e[d]*this.max[d]);return o>=0?2:u<0?0:1}}class xi{distanceToTile2d(e,o,u,d){const y=d.distanceX([e,o]),x=d.distanceY([e,o]);return Math.hypot(y,x)}getWrap(e,o,u){return u}getTileBoundingVolume(e,o,u,d){var y,x;let S=0,k=0;if(d?.terrain){const E=new l.Z(e.z,o,e.z,e.x,e.y),L=d.terrain.getMinMaxElevation(E);S=(y=L.minElevation)!==null&&y!==void 0?y:Math.min(0,u),k=(x=L.maxElevation)!==null&&x!==void 0?x:Math.max(0,u)}const A=1<<e.z;return new Xr([o+e.x/A,e.y/A,S],[o+(e.x+1)/A,(e.y+1)/A,k])}allowVariableZoom(e,o){const u=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,d=l.ah(78.5-u/2,0,60);return!!o.terrain||e.pitch>d}allowWorldCopies(){return!0}prepareNextFrame(){}}class jr{constructor(e,o,u){this.points=e,this.planes=o,this.aabb=u}static fromInvProjectionMatrix(e,o=1,u=0,d,y){const x=y?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],S=Math.pow(2,u),k=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((R=>(function(F,U,K,X){const Y=l.aw([],F,U),Q=1/Y[3]/K*X;return l.aY(Y,Y,[Q,Q,1/Y[3],Q])})(R,e,o,S)));d&&(function(R,F,U,K){const X=K?4:0,Y=K?0:4;let Q=0;const ie=[],ee=[];for(let te=0;te<4;te++){const de=l.aU([],R[te+Y],R[te+X]),Ce=l.aZ(de);l.aR(de,de,1/Ce),ie.push(Ce),ee.push(de)}for(let te=0;te<4;te++){const de=l.a_(R[te+X],ee[te],U);Q=de!==null&&de>=0?Math.max(Q,de):Math.max(Q,ie[te])}const oe=(function(te,de){const Ce=l.aU([],te[de[0]],te[de[1]]),be=l.aU([],te[de[2]],te[de[1]]),xe=[0,0,0,0];return l.aV(xe,l.aW([],Ce,be)),xe[3]=-l.aX(xe,te[de[0]]),xe})(R,F),le=(function(te,de){const Ce=l.a$(te),be=l.b0([],te,1/Ce),xe=l.aU([],de,l.aR([],be,l.aX(de,be))),ke=l.a$(xe);if(ke>0){const Fe=Math.sqrt(1-be[3]*be[3]),$e=l.aR([],be,-be[3]),Le=l.aS([],$e,l.aR([],xe,Fe/ke));return l.b1(de,Le)}return null})(U,oe);if(le!==null){const te=le/l.aX(ee[0],oe);Q=Math.min(Q,te)}for(let te=0;te<4;te++){const de=Math.min(Q,ie[te]);R[te+Y]=[R[te+X][0]+ee[te][0]*de,R[te+X][1]+ee[te][1]*de,R[te+X][2]+ee[te][2]*de,1]}})(k,x[0],d,y);const A=x.map((R=>{const F=l.aU([],k[R[0]],k[R[1]]),U=l.aU([],k[R[2]],k[R[1]]),K=l.aV([],l.aW([],F,U)),X=-l.aX(K,k[R[1]]);return K.concat(X)})),E=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],L=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const R of k)for(let F=0;F<3;F++)E[F]=Math.min(E[F],R[F]),L[F]=Math.max(L[F],R[F]);return new jr(k,A,new Xr(E,L))}}class sr{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,o,u){return this._helper.interpolatePadding(e,o,u)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,o,u=!0){this._helper.resize(e,o,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,o){this._helper.overrideNearFarZ(e,o)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,o){}constructor(e,o,u,d,y){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new bi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(x,S)=>this.getConstrained(x,S)},e,o,u,d,y),this._coveringTilesDetailsProvider=new xi}clone(){const e=new sr;return e.apply(this),e}apply(e,o,u){this._helper.apply(e,o,u)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const o=[new l.b2(0,e)];if(this._helper._renderWorldCopies){const u=this.screenPointToMercatorCoordinate(new l.P(0,0)),d=this.screenPointToMercatorCoordinate(new l.P(this._helper._width,0)),y=this.screenPointToMercatorCoordinate(new l.P(this._helper._width,this._helper._height)),x=this.screenPointToMercatorCoordinate(new l.P(0,this._helper._height)),S=Math.floor(Math.min(u.x,d.x,y.x,x.x)),k=Math.floor(Math.max(u.x,d.x,y.x,x.x)),A=1;for(let E=S-A;E<=k+A;E++)E!==0&&o.push(new l.b2(E,e))}return o}getCameraFrustum(){return jr.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const o=this.screenPointToLocation(this.centerPoint,e),u=e?e.getElevationForLngLatZoom(o,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(u)}setLocationAtPoint(e,o){const u=l.aj(this.elevation,this.center.lat),d=this.screenPointToMercatorCoordinateAtZ(o,u),y=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,u),x=l.a1.fromLngLat(e),S=new l.a1(x.x-(d.x-y.x),x.y-(d.y-y.y));this.setCenter(S?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,o){return o?this.coordinatePoint(l.a1.fromLngLat(e),o.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(l.a1.fromLngLat(e))}screenPointToLocation(e,o){var u;return(u=this.screenPointToMercatorCoordinate(e,o))===null||u===void 0?void 0:u.toLngLat()}screenPointToMercatorCoordinate(e,o){if(o){const u=o.pointCoordinate(e);if(u!=null)return u}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,o){const u=o||0,d=[e.x,e.y,0,1],y=[e.x,e.y,1,1];l.aw(d,d,this._pixelMatrixInverse),l.aw(y,y,this._pixelMatrixInverse);const x=d[3],S=y[3],k=d[1]/x,A=y[1]/S,E=d[2]/x,L=y[2]/S,R=E===L?0:(u-E)/(L-E);return new l.a1(l.C.number(d[0]/x,y[0]/S,R)/this.worldSize,l.C.number(k,A,R)/this.worldSize,u)}coordinatePoint(e,o=0,u=this._pixelMatrix){const d=[e.x*this.worldSize,e.y*this.worldSize,o,1];return l.aw(d,d,u),new l.P(d[0]/d[3],d[1]/d[3])}getBounds(){const e=Math.max(0,this._helper._height/2-ce(this));return new Ht().extend(this.screenPointToLocation(new l.P(0,e))).extend(this.screenPointToLocation(new l.P(this._helper._width,e))).extend(this.screenPointToLocation(new l.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new l.P(0,this._helper._height)))}isPointOnMapSurface(e,o){return o?o.pointCoordinate(e)!=null:e.y>this.height/2-ce(this)}calculatePosMatrix(e,o=!1,u){var d;const y=(d=e.key)!==null&&d!==void 0?d:l.b3(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),x=o?this._alignedPosMatrixCache:this._posMatrixCache;if(x.has(y)){const A=x.get(y);return u?A.f32:A.f64}const S=pe(e,this.worldSize);l.O(S,o?this._alignedProjMatrix:this._viewProjMatrix,S);const k={f64:S,f32:new Float32Array(S)};return x.set(y,k),u?k.f32:k.f64}calculateFogMatrix(e){const o=e.key,u=this._fogMatrixCacheF32;if(u.has(o))return u.get(o);const d=pe(e,this.worldSize);return l.O(d,this._fogMatrix,d),u.set(o,new Float32Array(d)),u.get(o)}getConstrained(e,o){o=l.ah(+o,this.minZoom,this.maxZoom);const u={center:new l.S(e.lng,e.lat),zoom:o};let d=this._helper._lngRange;if(!this._helper._renderWorldCopies&&d===null){const ie=179.9999999999;d=[-ie,ie]}const y=this.tileSize*l.af(u.zoom);let x=0,S=y,k=0,A=y,E=0,L=0;const{x:R,y:F}=this.size;if(this._helper._latRange){const ie=this._helper._latRange;x=l.U(ie[1])*y,S=l.U(ie[0])*y,S-x<F&&(E=F/(S-x))}d&&(k=l.aO(l.V(d[0])*y,0,y),A=l.aO(l.V(d[1])*y,0,y),A<k&&(A+=y),A-k<R&&(L=R/(A-k)));const{x:U,y:K}=W(y,e);let X,Y;const Q=Math.max(L||0,E||0);if(Q){const ie=new l.P(L?(A+k)/2:U,E?(S+x)/2:K);return u.center=re(y,ie).wrap(),u.zoom+=l.ak(Q),u}if(this._helper._latRange){const ie=F/2;K-ie<x&&(Y=x+ie),K+ie>S&&(Y=S-ie)}if(d){const ie=(k+A)/2;let ee=U;this._helper._renderWorldCopies&&(ee=l.aO(U,ie-y/2,ie+y/2));const oe=R/2;ee-oe<k&&(X=k+oe),ee+oe>A&&(X=A-oe)}if(X!==void 0||Y!==void 0){const ie=new l.P(X??U,Y??K);u.center=re(y,ie).wrap()}return u}calculateCenterFromCameraLngLatAlt(e,o,u,d){return this._helper.calculateCenterFromCameraLngLatAlt(e,o,u,d)}_calculateNearFarZIfNeeded(e,o,u){if(!this._helper.autoCalculateNearFarZ)return;const d=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),y=e-d*this._helper._pixelPerMeter/Math.cos(o),x=d<0?y:e,S=Math.PI/2+this.pitchInRadians,k=l.ae(this.fov)*(Math.abs(Math.cos(l.ae(this.roll)))*this.height+Math.abs(Math.sin(l.ae(this.roll)))*this.width)/this.height*(.5+u.y/this.height),A=Math.sin(k)*x/Math.sin(l.ah(Math.PI-S-k,.01,Math.PI-.01)),E=ce(this),L=Math.atan(E/this._helper.cameraToCenterDistance),R=l.ae(.75),F=L>R?2*L*(.5+u.y/(2*E)):R,U=Math.sin(F)*x/Math.sin(l.ah(Math.PI-S-F,.01,Math.PI-.01)),K=Math.min(A,U);this._helper._farZ=1.01*(Math.cos(Math.PI/2-o)*K+x),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,o=W(this.worldSize,this.center),u=o.x,d=o.y;this._helper._pixelPerMeter=l.aj(1,this.center.lat)*this.worldSize;const y=l.ae(Math.min(this.pitch,G)),x=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(y));let S;this._calculateNearFarZIfNeeded(x,y,e),S=new Float64Array(16),l.b4(S,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),l.aq(this._invProjMatrix,S),S[8]=2*-e.x/this._helper._width,S[9]=2*e.y/this._helper._height,this._projectionMatrix=l.b5(S),l.N(S,S,[1,-1,1]),l.M(S,S,[0,0,-this._helper.cameraToCenterDistance]),l.b6(S,S,-this.rollInRadians),l.b7(S,S,this.pitchInRadians),l.b6(S,S,-this.bearingInRadians),l.M(S,S,[-u,-d,0]),this._mercatorMatrix=l.N([],S,[this.worldSize,this.worldSize,this.worldSize]),l.N(S,S,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=l.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,S),l.M(S,S,[0,0,-this.elevation]),this._viewProjMatrix=S,this._invViewProjMatrix=l.aq([],S);const k=[0,0,-1,1];l.aw(k,k,this._invViewProjMatrix),this._cameraPosition=[k[0]/k[3],k[1]/k[3],k[2]/k[3]],this._fogMatrix=new Float64Array(16),l.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,x,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,l.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),l.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),l.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),l.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),l.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),l.M(this._fogMatrix,this._fogMatrix,[-u,-d,0]),l.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),l.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=l.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,S);const A=this._helper._width%2/2,E=this._helper._height%2/2,L=Math.cos(this.bearingInRadians),R=Math.sin(-this.bearingInRadians),F=u-Math.round(u)+L*A+R*E,U=d-Math.round(d)+L*E+R*A,K=new Float64Array(S);if(l.M(K,K,[F>.5?F-1:F,U>.5?U-1:U,0]),this._alignedProjMatrix=K,S=l.aq(new Float64Array(16),this._pixelMatrix),!S)throw new Error("failed to invert matrix");this._pixelMatrixInverse=S,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new l.P(0,0)),o=[e.x*this.worldSize,e.y*this.worldSize,0,1];return l.aw(o,o,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=l.aj(1,this.center.lat)*this.worldSize;return Te(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,o){const u=l.a1.fromLngLat(e),d=[u.x*this.worldSize,u.y*this.worldSize,o,1];return l.aw(d,d,this._viewProjMatrix),d[2]/d[3]}getProjectionData(e){const{overscaledTileID:o,aligned:u,applyTerrainMatrix:d}=e,y=this._helper.getMercatorTileCoordinates(o),x=o?this.calculatePosMatrix(o,u,!0):null;let S;return S=o&&o.terrainRttPosMatrix32f&&d?o.terrainRttPosMatrix32f:x||l.b8(),{mainMatrix:S,tileMercatorCoords:y,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:S}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,o,u){return 1}transformLightDirection(e){return l.aT(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,o,u,d){const y=this.calculatePosMatrix(u);let x;d?(x=[e,o,d(e,o),1],l.aw(x,x,y)):(x=[e,o,0,1],Do(x,x,y));const S=x[3];return{point:new l.P(x[0]/S,x[1]/S),signedDistanceFromCamera:S,isOccluded:!1}}populateCache(e){for(const o of e)this.calculatePosMatrix(o)}getMatrixForModel(e,o){const u=l.a1.fromLngLat(e,o),d=u.meterInMercatorCoordinateUnits(),y=l.b9();return l.M(y,y,[u.x,u.y,u.z]),l.b6(y,y,Math.PI),l.b7(y,y,Math.PI/2),l.N(y,y,[-d,d,d]),y}getProjectionDataForCustomLayer(e=!0){const o=new l.Z(0,0,0,0,0),u=this.getProjectionData({overscaledTileID:o,applyGlobeMatrix:e}),d=pe(o,this.worldSize);l.O(d,this._viewProjMatrix,d),u.tileMercatorCoords=[0,0,1,1];const y=[l.$,l.$,this.worldSize/this._helper.pixelsPerMeter],x=l.ba();return l.N(x,d,y),u.fallbackMatrix=x,u.mainMatrix=x,u}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function gp(){l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function wi(g){if(g.useSlerp)if(g.k<1){const e=l.bb(g.startEulerAngles.roll,g.startEulerAngles.pitch,g.startEulerAngles.bearing),o=l.bb(g.endEulerAngles.roll,g.endEulerAngles.pitch,g.endEulerAngles.bearing),u=new Float64Array(4);l.bc(u,e,o,g.k);const d=l.bd(u);g.tr.setRoll(d.roll),g.tr.setPitch(d.pitch),g.tr.setBearing(d.bearing)}else g.tr.setRoll(g.endEulerAngles.roll),g.tr.setPitch(g.endEulerAngles.pitch),g.tr.setBearing(g.endEulerAngles.bearing);else g.tr.setRoll(l.C.number(g.startEulerAngles.roll,g.endEulerAngles.roll,g.k)),g.tr.setPitch(l.C.number(g.startEulerAngles.pitch,g.endEulerAngles.pitch,g.k)),g.tr.setBearing(l.C.number(g.startEulerAngles.bearing,g.endEulerAngles.bearing,g.k))}function Vi(g,e,o,u,d){const y=d.padding,x=W(d.worldSize,o.getNorthWest()),S=W(d.worldSize,o.getNorthEast()),k=W(d.worldSize,o.getSouthEast()),A=W(d.worldSize,o.getSouthWest()),E=l.ae(-u),L=x.rotate(E),R=S.rotate(E),F=k.rotate(E),U=A.rotate(E),K=new l.P(Math.max(L.x,R.x,U.x,F.x),Math.max(L.y,R.y,U.y,F.y)),X=new l.P(Math.min(L.x,R.x,U.x,F.x),Math.min(L.y,R.y,U.y,F.y)),Y=K.sub(X),Q=(d.width-(y.left+y.right+e.left+e.right))/Y.x,ie=(d.height-(y.top+y.bottom+e.top+e.bottom))/Y.y;if(ie<0||Q<0)return void gp();const ee=Math.min(l.ak(d.scale*Math.min(Q,ie)),g.maxZoom),oe=l.P.convert(g.offset),le=new l.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(l.ae(u)),te=oe.add(le).mult(d.scale/l.af(ee));return{center:re(d.worldSize,x.add(k).div(2).sub(te)),zoom:ee,bearing:u}}class mi{get useGlobeControls(){return!1}handlePanInertia(e,o){return{easingOffset:e,easingCenter:o.center}}handleMapControlsRollPitchBearingZoom(e,o){e.bearingDelta&&o.setBearing(o.bearing+e.bearingDelta),e.pitchDelta&&o.setPitch(o.pitch+e.pitchDelta),e.rollDelta&&o.setRoll(o.roll+e.rollDelta),e.zoomDelta&&o.setZoom(o.zoom+e.zoomDelta)}handleMapControlsPan(e,o,u){e.around.distSqr(o.centerPoint)<.01||o.setLocationAtPoint(u,e.around)}cameraForBoxAndBearing(e,o,u,d,y){return Vi(e,o,u,d,y)}handleJumpToCenterZoom(e,o){e.zoom!==(o.zoom!==void 0?+o.zoom:e.zoom)&&e.setZoom(+o.zoom),o.center!==void 0&&e.setCenter(l.S.convert(o.center))}handleEaseTo(e,o){const u=e.zoom,d=e.padding,y={roll:e.roll,pitch:e.pitch,bearing:e.bearing},x={roll:o.roll===void 0?e.roll:o.roll,pitch:o.pitch===void 0?e.pitch:o.pitch,bearing:o.bearing===void 0?e.bearing:o.bearing},S=o.zoom!==void 0,k=!e.isPaddingEqual(o.padding);let A=!1;const E=S?+o.zoom:e.zoom;let L=e.centerPoint.add(o.offsetAsPoint);const R=e.screenPointToLocation(L),{center:F,zoom:U}=e.getConstrained(l.S.convert(o.center||R),E??u);Rl(e,F);const K=W(e.worldSize,R),X=W(e.worldSize,F).sub(K),Y=l.af(U-u);return A=U!==u,{easeFunc:Q=>{if(A&&e.setZoom(l.C.number(u,U,Q)),l.be(y,x)||wi({startEulerAngles:y,endEulerAngles:x,tr:e,k:Q,useSlerp:y.roll!=x.roll}),k&&(e.interpolatePadding(d,o.padding,Q),L=e.centerPoint.add(o.offsetAsPoint)),o.around)e.setLocationAtPoint(o.around,o.aroundPoint);else{const ie=l.af(e.zoom-u),ee=U>u?Math.min(2,Y):Math.max(.5,Y),oe=Math.pow(ee,1-Q),le=re(e.worldSize,K.add(X.mult(Q*oe)).mult(ie));e.setLocationAtPoint(e.renderWorldCopies?le.wrap():le,L)}},isZooming:A,elevationCenter:F}}handleFlyTo(e,o){const u=o.zoom!==void 0,d=e.zoom,y=e.getConstrained(l.S.convert(o.center||o.locationAtOffset),u?+o.zoom:d),x=y.center,S=y.zoom;Rl(e,x);const k=W(e.worldSize,o.locationAtOffset),A=W(e.worldSize,x).sub(k),E=A.mag(),L=l.af(S-d);let R;if(o.minZoom!==void 0){const F=Math.min(+o.minZoom,d,S),U=e.getConstrained(x,F).zoom;R=l.af(U-d)}return{easeFunc:(F,U,K,X)=>{e.setZoom(F===1?S:d+l.ak(U));const Y=F===1?x:re(e.worldSize,k.add(A.mult(K)).mult(U));e.setLocationAtPoint(e.renderWorldCopies?Y.wrap():Y,X)},scaleOfZoom:L,targetCenter:x,scaleOfMinZoom:R,pixelPathLength:E}}}class fr{constructor(e,o,u){this.blendFunction=e,this.blendColor=o,this.mask=u}}fr.Replace=[1,0],fr.disabled=new fr(fr.Replace,l.bf.transparent,[!1,!1,!1,!1]),fr.unblended=new fr(fr.Replace,l.bf.transparent,[!0,!0,!0,!0]),fr.alphaBlended=new fr([1,771],l.bf.transparent,[!0,!0,!0,!0]);const to=2305;class pt{constructor(e,o,u){this.enable=e,this.mode=o,this.frontFace=u}}pt.disabled=new pt(!1,1029,to),pt.backCCW=new pt(!0,1029,to),pt.frontCCW=new pt(!0,1028,to);class yt{constructor(e,o,u){this.func=e,this.mask=o,this.range=u}}yt.ReadOnly=!1,yt.ReadWrite=!0,yt.disabled=new yt(519,yt.ReadOnly,[0,1]);const ia=7680;class Gt{constructor(e,o,u,d,y,x){this.test=e,this.ref=o,this.mask=u,this.fail=d,this.depthFail=y,this.pass=x}}Gt.disabled=new Gt({func:519,mask:0},0,0,ia,ia,ia);const qi=new WeakMap;function Bn(g){var e;if(qi.has(g))return qi.get(g);{const o=(e=g.getParameter(g.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return qi.set(g,o),o}}class $n{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const o=e.context,u=o.gl;this._texFormat=u.RGBA,this._texType=u.UNSIGNED_BYTE;const d=new l.aL;d.emplaceBack(-1,-1),d.emplaceBack(2,-1),d.emplaceBack(-1,2);const y=new l.aN;y.emplaceBack(0,1,2),this._fullscreenTriangle=new Ja(o.createVertexBuffer(d,za.members),o.createIndexBuffer(y),l.aM.simpleSegment(0,0,d.length,y.length)),this._resultBuffer=new Uint8Array(4),o.activeTexture.set(u.TEXTURE1);const x=u.createTexture();u.bindTexture(u.TEXTURE_2D,x),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.NEAREST),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.NEAREST),u.texImage2D(u.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=o.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(x),Bn(u)&&(this._pbo=u.createBuffer(),u.bindBuffer(u.PIXEL_PACK_BUFFER,this._pbo),u.bufferData(u.PIXEL_PACK_BUFFER,4,u.STREAM_READ),u.bindBuffer(u.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,o){const u=this._updateCount;return this._readbackQueue?u>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():u>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,o),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,o=e.gl;e.activeTexture.set(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,o){const u=this._cachedRenderContext.context,d=u.gl;if(this._bindFramebuffer(),u.viewport.set([0,0,this._texWidth,this._texHeight]),u.clear({color:l.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(u,d.TRIANGLES,yt.disabled,Gt.disabled,fr.unblended,pt.disabled,((y,x)=>({u_input:y,u_output_expected:x}))(e,o),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Bn(d)){d.bindBuffer(d.PIXEL_PACK_BUFFER,this._pbo),d.readBuffer(d.COLOR_ATTACHMENT0),d.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),d.bindBuffer(d.PIXEL_PACK_BUFFER,null);const y=d.fenceSync(d.SYNC_GPU_COMMANDS_COMPLETE,0);d.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:y}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Bn(e)){const o=e.clientWaitSync(this._readbackQueue.sync,0,0);if(o===e.WAIT_FAILED)return l.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(o===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=$n._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let o=0;return o+=e[0]/256,o+=e[1]/65536,o+=e[2]/16777216,e[3]<127&&(o=-o),o/128}}const Dl=l.$/128;function gu(g,e){const o=g.granularity!==void 0?Math.max(g.granularity,1):1,u=o+(g.generateBorders?2:0),d=o+(g.extendToNorthPole||g.generateBorders?1:0)+(g.extendToSouthPole||g.generateBorders?1:0),y=u+1,x=d+1,S=g.generateBorders?-1:0,k=g.generateBorders||g.extendToNorthPole?-1:0,A=o+(g.generateBorders?1:0),E=o+(g.generateBorders||g.extendToSouthPole?1:0),L=y*x,R=u*d*6,F=y*x>65536;if(F&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const U=F||e==="32bit",K=new Int16Array(2*L);let X=0;for(let ie=k;ie<=E;ie++)for(let ee=S;ee<=A;ee++){let oe=ee/o*l.$;ee===-1&&(oe=-Dl),ee===o+1&&(oe=l.$+Dl);let le=ie/o*l.$;ie===-1&&(le=g.extendToNorthPole?l.bh:-Dl),ie===o+1&&(le=g.extendToSouthPole?l.bi:l.$+Dl),K[X++]=oe,K[X++]=le}const Y=U?new Uint32Array(R):new Uint16Array(R);let Q=0;for(let ie=0;ie<d;ie++)for(let ee=0;ee<u;ee++){const oe=ee+1+ie*y,le=ee+(ie+1)*y,te=ee+1+(ie+1)*y;Y[Q++]=ee+ie*y,Y[Q++]=le,Y[Q++]=oe,Y[Q++]=oe,Y[Q++]=le,Y[Q++]=te}return{vertices:K.buffer.slice(0),indices:Y.buffer.slice(0),uses32bitIndices:U}}const $o=new l.aK({fill:new l.bj(128,2),line:new l.bj(512,0),tile:new l.bj(128,32),stencil:new l.bj(128,1),circle:3});class ks{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return un.projectionGlobe}get vertexShaderPreludeCode(){return un.projectionMercator.vertexSource}get subdivisionGranularity(){return $o}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new $n(e));const o=l.U(this._errorQueryLatitudeDegrees),u=2*Math.atan(Math.exp(Math.PI-o*Math.PI*2))-.5*Math.PI,d=this._errorMeasurement.updateErrorLoop(o,u),y=Z.now();d!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=d,this._errorMeasurementLastChangeTime=y);const x=Math.min(Math.max((y-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=l.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,l.bl(x))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,o,u,d,y){const x=(y==="stencil"?$o.stencil:$o.tile).getGranularityForZoomLevel(o.z);return this._getMesh(e,{granularity:x,generateBorders:u,extendToNorthPole:o.y===0&&d,extendToSouthPole:o.y===(1<<o.z)-1&&d})}_getMesh(e,o){const u=this._getMeshKey(o);if(u in this._tileMeshCache)return this._tileMeshCache[u];const d=(function(y,x){const S=gu(x,"16bit"),k=l.aL.deserialize({arrayBuffer:S.vertices,length:S.vertices.byteLength/2/2}),A=l.aN.deserialize({arrayBuffer:S.indices,length:S.indices.byteLength/2/3});return new Ja(y.createVertexBuffer(k,za.members),y.createIndexBuffer(A),l.aM.simpleSegment(0,0,k.length,A.length))})(e,o);return this._tileMeshCache[u]=d,d}recalculate(e){}hasTransition(){const e=Z.now();let o=!1;return o=o||(e-this._errorMeasurementLastChangeTime)/1e3<.7,o=o||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,o}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const jl=new l.r({type:new l.D(l.v.projection.type)});class Fl extends l.E{constructor(e){super(),this._transitionable=new l.t(jl),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new l.F(0)),this._mercatorProjection=new At,this._verticalPerspectiveProjection=new ks}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof l.bm){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,o,u,d,y){return this.currentProjection.getMeshFromTileID(e,o,u,d,y)}setProjection(e){this._transitionable.setValue("type",e?.type||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function Ol(g){const e=No(g.worldSize,g.center.lat);return 2*Math.PI*e}function hn(g,e,o,u,d){const y=1/(1<<d),x=e/l.$*y+u*y,S=l.bo((g/l.$*y+o*y)*Math.PI*2+Math.PI,2*Math.PI),k=2*Math.atan(Math.exp(Math.PI-x*Math.PI*2))-.5*Math.PI,A=Math.cos(k),E=new Float64Array(3);return E[0]=Math.sin(S)*A,E[1]=Math.sin(k),E[2]=Math.cos(S)*A,E}function Kr(g){return(function(e,o){const u=Math.cos(o),d=new Float64Array(3);return d[0]=Math.sin(e)*u,d[1]=Math.sin(o),d[2]=Math.cos(e)*u,d})(g.lng*Math.PI/180,g.lat*Math.PI/180)}function No(g,e){return g/(2*Math.PI)/Math.cos(e*Math.PI/180)}function Cs(g){const e=Math.asin(g[1])/Math.PI*180,o=Math.sqrt(g[0]*g[0]+g[2]*g[2]);if(o>1e-6){const u=g[0]/o,d=Math.acos(g[2]/o),y=(u>0?d:-d)/Math.PI*180;return new l.S(l.aO(y,-180,180),e)}return new l.S(0,e)}function ro(g){return Math.cos(g*Math.PI/180)}function Mr(g,e){const o=ro(g),u=ro(e);return l.ak(u/o)}function yp(g,e){const o=g.rotate(e.bearingInRadians),u=e.zoom+Mr(e.center.lat,0),d=l.bk(1/ro(e.center.lat),1/ro(Math.min(Math.abs(e.center.lat),60)),l.bn(u,7,3,0,1)),y=360/Ol({worldSize:e.worldSize,center:{lat:e.center.lat}});return new l.S(e.center.lng-o.x*y*d,l.ah(e.center.lat+o.y*y,-l.ai,l.ai))}function Ps(g){const e=.5*g,o=Math.sin(e),u=Math.cos(e);return Math.log(o+u)-Math.log(u-o)}function yu(g,e,o,u){const d=g.lat+o*u;if(Math.abs(o)>1){const y=(Math.sign(g.lat+o)!==Math.sign(g.lat)?-Math.abs(g.lat):Math.abs(g.lat))*Math.PI/180,x=Math.abs(g.lat+o)*Math.PI/180,S=Ps(y+u*(x-y)),k=Ps(y),A=Ps(x);return new l.S(g.lng+e*((S-k)/(A-k)),d)}return new l.S(g.lng+e*u,d)}class Gf{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,o,u,d){const y=`${e.z}_${e.x}_${e.y}_${d?.terrain?"t":""}`,x=this._cache.get(y);if(x)return x;const S=this._cachePrevious.get(y);if(S)return this._cache.set(y,S),S;const k=this._boundingVolumeFactory(e,o,u,d);return this._cache.set(y,k),this._hadAnyChanges=!0,k}}class Uo{constructor(e,o,u,d){this.min=u,this.max=d,this.points=e,this.planes=o}static fromAabb(e,o){const u=[];for(let d=0;d<8;d++)u.push([1&~d?e[0]:o[0],(d>>1&1)==1?o[1]:e[1],(d>>2&1)==1?o[2]:e[2]]);return new Uo(u,[[-1,0,0,o[0]],[1,0,0,-e[0]],[0,-1,0,o[1]],[0,1,0,-e[1]],[0,0,-1,o[2]],[0,0,1,-e[2]]],e,o)}static fromCenterSizeAngles(e,o,u){const d=l.br([],u[0],u[1],u[2]),y=l.bs([],[o[0],0,0],d),x=l.bs([],[0,o[1],0],d),S=l.bs([],[0,0,o[2]],d),k=[...e],A=[...e];for(let L=0;L<8;L++)for(let R=0;R<3;R++){const F=e[R]+y[R]*(1&~L?-1:1)+x[R]*((L>>1&1)==1?1:-1)+S[R]*((L>>2&1)==1?1:-1);k[R]=Math.min(k[R],F),A[R]=Math.max(A[R],F)}const E=[];for(let L=0;L<8;L++){const R=[...e];l.aS(R,R,l.aR([],y,1&~L?-1:1)),l.aS(R,R,l.aR([],x,(L>>1&1)==1?1:-1)),l.aS(R,R,l.aR([],S,(L>>2&1)==1?1:-1)),E.push(R)}return new Uo(E,[[...y,-l.aX(y,E[0])],[...x,-l.aX(x,E[0])],[...S,-l.aX(S,E[0])],[-y[0],-y[1],-y[2],-l.aX(y,E[7])],[-x[0],-x[1],-x[2],-l.aX(x,E[7])],[-S[0],-S[1],-S[2],-l.aX(S,E[7])]],k,A)}intersectsFrustum(e){let o=!0;const u=this.points.length,d=this.planes.length,y=e.planes.length,x=e.points.length;for(let S=0;S<y;S++){const k=e.planes[S];let A=0;for(let E=0;E<u;E++){const L=this.points[E];k[0]*L[0]+k[1]*L[1]+k[2]*L[2]+k[3]>=0&&A++}if(A===0)return 0;A<u&&(o=!1)}if(o)return 2;for(let S=0;S<d;S++){const k=this.planes[S];let A=0;for(let E=0;E<x;E++){const L=e.points[E];k[0]*L[0]+k[1]*L[1]+k[2]*L[2]+k[3]>=0&&A++}if(A===0)return 0}return 1}intersectsPlane(e){const o=this.points.length;let u=0;for(let d=0;d<o;d++){const y=this.points[d];e[0]*y[0]+e[1]*y[1]+e[2]*y[2]+e[3]>=0&&u++}return u===o?2:u===0?0:1}}function ai(g,e,o){const u=g-e;return u<0?-u:Math.max(0,u-o)}function Ms(g,e,o,u,d){const y=g-o;let x;return x=y<0?Math.min(-y,1+y-d):y>1?Math.min(Math.max(y-d,0),1-y):0,Math.max(x,ai(e,u,d))}class Nn{constructor(){this._boundingVolumeCache=new Gf(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,o,u,d){const y=1<<u.z,x=1/y,S=u.x/y,k=u.y/y;let A=2;return A=Math.min(A,Ms(e,o,S,k,x)),A=Math.min(A,Ms(e,o,S+.5,-k-x,x)),A=Math.min(A,Ms(e,o,S+.5,2-k-x,x)),A}getWrap(e,o,u){const d=1<<o.z,y=1/d,x=o.x/d,S=ai(e.x,x,y),k=ai(e.x,x-1,y),A=ai(e.x,x+1,y),E=Math.min(S,k,A);return E===A?1:E===k?-1:0}allowVariableZoom(e,o){return tt(e,o)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,o,u,d){return this._boundingVolumeCache.getTileBoundingVolume(e,o,u,d)}_computeTileBoundingVolume(e,o,u,d){var y,x;let S=0,k=0;if(d?.terrain){const A=new l.Z(e.z,o,e.z,e.x,e.y),E=d.terrain.getMinMaxElevation(A);S=(y=E.minElevation)!==null&&y!==void 0?y:Math.min(0,u),k=(x=E.maxElevation)!==null&&x!==void 0?x:Math.max(0,u)}if(S/=l.bu,k/=l.bu,S+=1,k+=1,e.z<=0)return Uo.fromAabb([-k,-k,-k],[k,k,k]);if(e.z===1)return Uo.fromAabb([e.x===0?-k:0,e.y===0?0:-k,-k],[e.x===0?0:k,e.y===0?k:0,k]);{const A=[hn(0,0,e.x,e.y,e.z),hn(l.$,0,e.x,e.y,e.z),hn(l.$,l.$,e.x,e.y,e.z),hn(0,l.$,e.x,e.y,e.z)],E=[];for(const xe of A)E.push(l.aR([],xe,k));if(k!==S)for(const xe of A)E.push(l.aR([],xe,S));e.y===0&&E.push([0,1,0]),e.y===(1<<e.z)-1&&E.push([0,-1,0]);const L=[1,1,1],R=[-1,-1,-1];for(const xe of E)for(let ke=0;ke<3;ke++)L[ke]=Math.min(L[ke],xe[ke]),R[ke]=Math.max(R[ke],xe[ke]);const F=hn(l.$/2,l.$/2,e.x,e.y,e.z),U=l.aW([],[0,1,0],F);l.aV(U,U);const K=l.aW([],F,U);l.aV(K,K);const X=l.aW([],A[2],A[1]);l.aV(X,X);const Y=l.aW([],A[0],A[3]);l.aV(Y,Y),E.push(l.aR([],F,k)),e.y>=(1<<e.z)/2&&E.push(l.aR([],hn(l.$/2,0,e.x,e.y,e.z),k)),e.y<(1<<e.z)/2&&E.push(l.aR([],hn(l.$/2,l.$,e.x,e.y,e.z),k));const Q=As(F,E),ie=As(K,E),ee=[-F[0],-F[1],-F[2],Q.max],oe=[F[0],F[1],F[2],-Q.min],le=[-K[0],-K[1],-K[2],ie.max],te=[K[0],K[1],K[2],-ie.min],de=[...X,0],Ce=[...Y,0],be=[];return e.y===0?be.push(l.bt(Ce,de,ee),l.bt(Ce,de,oe)):be.push(l.bt(le,de,ee),l.bt(le,de,oe),l.bt(le,Ce,ee),l.bt(le,Ce,oe)),e.y===(1<<e.z)-1?be.push(l.bt(Ce,de,ee),l.bt(Ce,de,oe)):be.push(l.bt(te,de,ee),l.bt(te,de,oe),l.bt(te,Ce,ee),l.bt(te,Ce,oe)),new Uo(be,[ee,oe,le,te,de,Ce],L,R)}}}function As(g,e){let o=1/0,u=-1/0;for(const d of e){const y=l.aX(g,d);o=Math.min(o,y),u=Math.max(u,y)}return{min:o,max:u}}class Is{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,o,u){return this._helper.interpolatePadding(e,o,u)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,o){this._helper.resize(e,o)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,o){this._helper.overrideNearFarZ(e,o)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=l.bv(),this._projectionMatrix=l.b9(),this._globeViewProjMatrix32f=l.b8(),this._globeViewProjMatrixNoCorrection=l.b9(),this._globeViewProjMatrixNoCorrectionInverted=l.b9(),this._globeProjMatrixInverted=l.b9(),this._cameraPosition=l.bp(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new bi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,o)=>this.getConstrained(e,o)}),this._coveringTilesDetailsProvider=new Nn}clone(){const e=new Is;return e.apply(this),e}apply(e,o){this._globeLatitudeErrorCorrectionRadians=o||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=l.bp();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:o,applyGlobeMatrix:u}=e,d=this._helper.getMercatorTileCoordinates(o);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:d,clippingPlane:this._cachedClippingPlane,projectionTransition:u?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const o=this.pitchInRadians,u=this.cameraToCenterDistance/e,d=Math.sin(o)*u,y=Math.cos(o)*u+1,x=1/Math.sqrt(d*d+y*y)*1;let S=-d,k=y;const A=Math.sqrt(S*S+k*k);S/=A,k/=A;const E=[0,S,k];l.bw(E,E,[0,0,0],-this.bearingInRadians),l.bx(E,E,[0,0,0],-1*this.center.lat*Math.PI/180),l.by(E,E,[0,0,0],this.center.lng*Math.PI/180);const L=1/l.aZ(E);return l.aR(E,E,L),[...E,-x*L]}isLocationOccluded(e){return!this.isSurfacePointVisible(Kr(e))}transformLightDirection(e){const o=this._helper._center.lng*Math.PI/180,u=this._helper._center.lat*Math.PI/180,d=Math.cos(u),y=[Math.sin(o)*d,Math.sin(u),Math.cos(o)*d],x=[y[2],0,-y[0]],S=[0,0,0];l.aW(S,x,y),l.aV(x,x),l.aV(S,S);const k=[0,0,0];return l.aV(k,[x[0]*e[0]+S[0]*e[1]+y[0]*e[2],x[1]*e[0]+S[1]*e[1]+y[1]*e[2],x[2]*e[0]+S[2]*e[1]+y[2]*e[2]]),k}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,o,u){const d=(function(S,k,A){const E=1/(1<<A.z);return new l.a1(S/l.$*E+A.x*E,k/l.$*E+A.y*E)})(e,o,u.canonical),y=(x=d.y,[l.bo(d.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-x*Math.PI*2))-.5*Math.PI]);var x;return this.getCircleRadiusCorrection()/Math.cos(y[1])}projectTileCoordinates(e,o,u,d){const y=u.canonical,x=hn(e,o,y.x,y.y,y.z),S=1+(d?d(e,o):0)/l.bu,k=[x[0]*S,x[1]*S,x[2]*S,1];l.aw(k,k,this._globeViewProjMatrixNoCorrection);const A=this._cachedClippingPlane,E=A[0]*x[0]+A[1]*x[1]+A[2]*x[2]+A[3]<0;return{point:new l.P(k[0]/k[3],k[1]/k[3]),signedDistanceFromCamera:k[3],isOccluded:E}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=No(this.worldSize,this.center.lat),o=l.ba(),u=l.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),l.b4(o,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const d=this.centerOffset;o[8]=2*-d.x/this._helper._width,o[9]=2*d.y/this._helper._height,this._projectionMatrix=l.b5(o),this._globeProjMatrixInverted=l.ba(),l.aq(this._globeProjMatrixInverted,o),l.M(o,o,[0,0,-this.cameraToCenterDistance]),l.b6(o,o,this.rollInRadians),l.b7(o,o,-this.pitchInRadians),l.b6(o,o,this.bearingInRadians),l.M(o,o,[0,0,-e]);const y=l.bp();y[0]=e,y[1]=e,y[2]=e,l.b7(u,o,this.center.lat*Math.PI/180),l.bz(u,u,-this.center.lng*Math.PI/180),l.N(u,u,y),this._globeViewProjMatrixNoCorrection=u,l.b7(o,o,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),l.bz(o,o,-this.center.lng*Math.PI/180),l.N(o,o,y),this._globeViewProjMatrix32f=new Float32Array(o),this._globeViewProjMatrixNoCorrectionInverted=l.ba(),l.aq(this._globeViewProjMatrixNoCorrectionInverted,u);const x=l.bp();this._cameraPosition=l.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/e,l.bw(this._cameraPosition,this._cameraPosition,x,-this.rollInRadians),l.bx(this._cameraPosition,this._cameraPosition,x,this.pitchInRadians),l.bw(this._cameraPosition,this._cameraPosition,x,-this.bearingInRadians),l.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),l.bx(this._cameraPosition,this._cameraPosition,x,-this.center.lat*Math.PI/180),l.by(this._cameraPosition,this._cameraPosition,x,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const S=l.b5(this._globeViewProjMatrixNoCorrectionInverted);l.N(S,S,[1,1,-1]),this._cachedFrustum=jr.fromInvProjectionMatrix(S,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){l.w("calculateFogMatrix is not supported on globe projection.");const o=l.ba();return l.ag(o),o}getVisibleUnwrappedCoordinates(e){return[new l.b2(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&l.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,o){if(!this._globeViewProjMatrixNoCorrection)return 1;const u=Kr(e);l.aR(u,u,1+o/l.bu);const d=l.bv();return l.aw(d,[u[0],u[1],u[2],1],this._globeViewProjMatrixNoCorrection),d[2]/d[3]}populateCache(e){}getBounds(){const e=.5*this.width,o=.5*this.height,u=[new l.P(0,0),new l.P(e,0),new l.P(this.width,0),new l.P(this.width,o),new l.P(this.width,this.height),new l.P(e,this.height),new l.P(0,this.height),new l.P(0,o)],d=[];for(const L of u)d.push(this.unprojectScreenPoint(L));let y=0,x=0,S=0,k=0;const A=this.center;for(const L of d){const R=l.bA(A.lng,L.lng),F=l.bA(A.lat,L.lat);R<x&&(x=R),R>y&&(y=R),F<k&&(k=F),F>S&&(S=F)}const E=[A.lng+x,A.lat+k,A.lng+y,A.lat+S];return this.isSurfacePointOnScreen([0,1,0])&&(E[3]=90,E[0]=-180,E[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(E[1]=-90,E[0]=-180,E[2]=180),new Ht(E)}getConstrained(e,o){const u=l.ah(e.lat,-l.ai,l.ai),d=l.ah(+o,this.minZoom+Mr(0,u),this.maxZoom);return{center:new l.S(e.lng,u),zoom:d}}calculateCenterFromCameraLngLatAlt(e,o,u,d){return this._helper.calculateCenterFromCameraLngLatAlt(e,o,u,d)}setLocationAtPoint(e,o){const u=Kr(this.unprojectScreenPoint(o)),d=Kr(e),y=l.bp();l.bB(y);const x=l.bp();l.by(x,u,y,-this.center.lng*Math.PI/180),l.bx(x,x,y,this.center.lat*Math.PI/180);const S=d[0]*d[0]+d[2]*d[2],k=x[0]*x[0];if(S<k)return;const A=Math.sqrt(S-k),E=-A,L=l.bC(d[0],d[2],x[0],A),R=l.bC(d[0],d[2],x[0],E),F=l.bp();l.by(F,d,y,-L);const U=l.bC(F[1],F[2],x[1],x[2]),K=l.bp();l.by(K,d,y,-R);const X=l.bC(K[1],K[2],x[1],x[2]),Y=.5*Math.PI,Q=U>=-Y&&U<=Y,ie=X>=-Y&&X<=Y;let ee,oe;if(Q&&ie){const Ce=this.center.lng*Math.PI/180,be=this.center.lat*Math.PI/180;l.bD(L,Ce)+l.bD(U,be)<l.bD(R,Ce)+l.bD(X,be)?(ee=L,oe=U):(ee=R,oe=X)}else if(Q)ee=L,oe=U;else{if(!ie)return;ee=R,oe=X}const le=ee/Math.PI*180,te=oe/Math.PI*180,de=this.center.lat;this.setCenter(new l.S(le,l.ah(te,-90,90))),this.setZoom(this.zoom+Mr(de,this.center.lat))}locationToScreenPoint(e,o){const u=Kr(e);if(o){const d=o.getElevationForLngLatZoom(e,this._helper._tileZoom);l.aR(u,u,1+d/l.bu)}return this._projectSurfacePointToScreen(u)}_projectSurfacePointToScreen(e){const o=l.bv();return l.aw(o,[...e,1],this._globeViewProjMatrixNoCorrection),o[0]/=o[3],o[1]/=o[3],new l.P((.5*o[0]+.5)*this.width,(.5*-o[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,o){if(o){const u=o.pointCoordinate(e);if(u)return u}return l.a1.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,o){var u;return(u=this.screenPointToMercatorCoordinate(e,o))===null||u===void 0?void 0:u.toLngLat()}isPointOnMapSurface(e,o){const u=this._cameraPosition,d=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(u,d)}getRayDirectionFromPixel(e){const o=l.bv();o[0]=e.x/this.width*2-1,o[1]=-1*(e.y/this.height*2-1),o[2]=1,o[3]=1,l.aw(o,o,this._globeViewProjMatrixNoCorrectionInverted),o[0]/=o[3],o[1]/=o[3],o[2]/=o[3];const u=l.bp();u[0]=o[0]-this._cameraPosition[0],u[1]=o[1]-this._cameraPosition[1],u[2]=o[2]-this._cameraPosition[2];const d=l.bp();return l.aV(d,u),d}isSurfacePointVisible(e){const o=this._cachedClippingPlane;return o[0]*e[0]+o[1]*e[1]+o[2]*e[2]+o[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const o=l.bv();return l.aw(o,[...e,1],this._globeViewProjMatrixNoCorrection),o[0]/=o[3],o[1]/=o[3],o[2]/=o[3],o[0]>-1&&o[0]<1&&o[1]>-1&&o[1]<1&&o[2]>-1&&o[2]<1}rayPlanetIntersection(e,o){const u=l.aX(e,o),d=l.bp(),y=l.bp();l.aR(y,o,u),l.aU(d,e,y);const x=1-l.aX(d,d);if(x<0)return null;const S=l.aX(e,e)-1,k=-u+(u<0?1:-1)*Math.sqrt(x),A=S/k,E=k;return{tMin:Math.min(A,E),tMax:Math.max(A,E)}}unprojectScreenPoint(e){const o=this._cameraPosition,u=this.getRayDirectionFromPixel(e),d=this.rayPlanetIntersection(o,u);if(d){const E=l.bp();l.aS(E,o,[u[0]*d.tMin,u[1]*d.tMin,u[2]*d.tMin]);const L=l.bp();return l.aV(L,E),Cs(L)}const y=this._cachedClippingPlane,x=y[0]*u[0]+y[1]*u[1]+y[2]*u[2],S=-l.b1(y,o)/x,k=l.bp();if(S>0)l.aS(k,o,[u[0]*S,u[1]*S,u[2]*S]);else{const E=l.bp();l.aS(E,o,[2*u[0],2*u[1],2*u[2]]);const L=l.b1(this._cachedClippingPlane,E);l.aU(k,E,[this._cachedClippingPlane[0]*L,this._cachedClippingPlane[1]*L,this._cachedClippingPlane[2]*L])}const A=(function(E){const L=l.bp();return L[0]=E[0]*-E[3],L[1]=E[1]*-E[3],L[2]=E[2]*-E[3],{center:L,radius:Math.sqrt(1-E[3]*E[3])}})(y);return Cs((function(E,L,R){const F=l.bp();l.aU(F,R,E);const U=l.bp();return l.bq(U,E,F,L/l.a$(F)),U})(A.center,A.radius,k))}getMatrixForModel(e,o){const u=l.S.convert(e),d=1/l.bu,y=l.b9();return l.bz(y,y,u.lng/180*Math.PI),l.b7(y,y,-u.lat/180*Math.PI),l.M(y,y,[0,0,1+o/l.bu]),l.b7(y,y,.5*Math.PI),l.N(y,y,[d,d,d]),y}getProjectionDataForCustomLayer(e=!0){const o=this.getProjectionData({overscaledTileID:new l.Z(0,0,0,0,0),applyGlobeMatrix:e});return o.tileMercatorCoords=[0,0,1,1],o}getFastPathSimpleProjectionMatrix(e){}}class Es{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,o,u){return this._helper.interpolatePadding(e,o,u)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,o,u=!0){this._helper.resize(e,o,u)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,o){this._helper.overrideNearFarZ(e,o)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,o){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=o,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new bi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,o)=>this.getConstrained(e,o)}),this._globeness=1,this._mercatorTransform=new sr,this._verticalPerspectiveTransform=new Is}clone(){const e=new Es;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const o=this._mercatorTransform.getProjectionData(e),u=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?u.mainMatrix:o.mainMatrix,clippingPlane:u.clippingPlane,tileMercatorCoords:u.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:o.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return l.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return l.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,o,u){const d=this._mercatorTransform.getPitchedTextCorrection(e,o,u),y=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,o,u);return l.bk(d,y,this._globeness)}projectTileCoordinates(e,o,u,d){return this.currentTransform.projectTileCoordinates(e,o,u,d)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,o){return this.currentTransform.lngLatToCameraDepth(e,o)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,o){return this.currentTransform.getConstrained(e,o)}calculateCenterFromCameraLngLatAlt(e,o,u,d){return this._helper.calculateCenterFromCameraLngLatAlt(e,o,u,d)}setLocationAtPoint(e,o){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,o),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,o),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,o){return this.currentTransform.locationToScreenPoint(e,o)}screenPointToMercatorCoordinate(e,o){return this.currentTransform.screenPointToMercatorCoordinate(e,o)}screenPointToLocation(e,o){return this.currentTransform.screenPointToLocation(e,o)}isPointOnMapSurface(e,o){return this.currentTransform.isPointOnMapSurface(e,o)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,o){return this.currentTransform.getMatrixForModel(e,o)}getProjectionDataForCustomLayer(e=!0){const o=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return o;const u=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return u.fallbackMatrix=o.mainMatrix,u}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class gi{get useGlobeControls(){return!0}handlePanInertia(e,o){const u=yp(e,o);return Math.abs(u.lng-o.center.lng)>180&&(u.lng=o.center.lng+179.5*Math.sign(u.lng-o.center.lng)),{easingCenter:u,easingOffset:new l.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,o){const u=e.around,d=o.screenPointToLocation(u);e.bearingDelta&&o.setBearing(o.bearing+e.bearingDelta),e.pitchDelta&&o.setPitch(o.pitch+e.pitchDelta),e.rollDelta&&o.setRoll(o.roll+e.rollDelta);const y=o.zoom;e.zoomDelta&&o.setZoom(o.zoom+e.zoomDelta);const x=o.zoom-y;if(x===0)return;const S=l.bA(o.center.lng,d.lng),k=S/(Math.abs(S/180)+1),A=l.bA(o.center.lat,d.lat),E=o.getRayDirectionFromPixel(u),L=o.cameraPosition,R=-1*l.aX(L,E),F=l.bp();l.aS(F,L,[E[0]*R,E[1]*R,E[2]*R]);const U=l.aZ(F)-1,K=Math.exp(.5*-Math.max(U-.3,0)),X=No(o.worldSize,o.center.lat)/Math.min(o.width,o.height),Y=l.bn(X,.9,.5,1,.25),Q=(1-l.af(-x))*Math.min(K,Y),ie=o.center.lat,ee=o.zoom,oe=new l.S(o.center.lng+k*Q,l.ah(o.center.lat+A*Q,-l.ai,l.ai));o.setLocationAtPoint(d,u);const le=o.center,te=l.bn(Math.abs(S),45,85,0,1),de=l.bn(X,.75,.35,0,1),Ce=Math.pow(Math.max(te,de),.25),be=l.bA(le.lng,oe.lng),xe=l.bA(le.lat,oe.lat);o.setCenter(new l.S(le.lng+be*Ce,le.lat+xe*Ce).wrap()),o.setZoom(ee+Mr(ie,o.center.lat))}handleMapControlsPan(e,o,u){if(!e.panDelta)return;const d=o.center.lat,y=o.zoom;o.setCenter(yp(e.panDelta,o).wrap()),o.setZoom(y+Mr(d,o.center.lat))}cameraForBoxAndBearing(e,o,u,d,y){const x=Vi(e,o,u,d,y),S=o.left/y.width*2-1,k=(y.width-o.right)/y.width*2-1,A=o.top/y.height*-2+1,E=(y.height-o.bottom)/y.height*-2+1,L=l.bA(u.getWest(),u.getEast())<0,R=L?u.getEast():u.getWest(),F=L?u.getWest():u.getEast(),U=Math.max(u.getNorth(),u.getSouth()),K=Math.min(u.getNorth(),u.getSouth()),X=R+.5*l.bA(R,F),Y=U+.5*l.bA(U,K),Q=y.clone();Q.setCenter(x.center),Q.setBearing(x.bearing),Q.setPitch(0),Q.setRoll(0),Q.setZoom(x.zoom);const ie=Q.modelViewProjectionMatrix,ee=[Kr(u.getNorthWest()),Kr(u.getNorthEast()),Kr(u.getSouthWest()),Kr(u.getSouthEast()),Kr(new l.S(F,Y)),Kr(new l.S(R,Y)),Kr(new l.S(X,U)),Kr(new l.S(X,K))],oe=Kr(x.center);let le=Number.POSITIVE_INFINITY;for(const te of ee)S<0&&(le=gi.getLesserNonNegativeNonNull(le,gi.solveVectorScale(te,oe,ie,"x",S))),k>0&&(le=gi.getLesserNonNegativeNonNull(le,gi.solveVectorScale(te,oe,ie,"x",k))),A>0&&(le=gi.getLesserNonNegativeNonNull(le,gi.solveVectorScale(te,oe,ie,"y",A))),E<0&&(le=gi.getLesserNonNegativeNonNull(le,gi.solveVectorScale(te,oe,ie,"y",E)));if(Number.isFinite(le)&&le!==0)return x.zoom=Q.zoom+l.ak(le),x;gp()}handleJumpToCenterZoom(e,o){const u=e.center.lat,d=e.getConstrained(o.center?l.S.convert(o.center):e.center,e.zoom).center;e.setCenter(d.wrap());const y=o.zoom!==void 0?+o.zoom:e.zoom+Mr(u,d.lat);e.zoom!==y&&e.setZoom(y)}handleEaseTo(e,o){const u=e.zoom,d=e.center,y=e.padding,x={roll:e.roll,pitch:e.pitch,bearing:e.bearing},S={roll:o.roll===void 0?e.roll:o.roll,pitch:o.pitch===void 0?e.pitch:o.pitch,bearing:o.bearing===void 0?e.bearing:o.bearing},k=o.zoom!==void 0,A=!e.isPaddingEqual(o.padding);let E=!1;const L=o.center?l.S.convert(o.center):d,R=e.getConstrained(L,u).center;Rl(e,R);const F=e.clone();F.setCenter(R),F.setZoom(k?+o.zoom:u+Mr(d.lat,L.lat)),F.setBearing(o.bearing);const U=new l.P(l.ah(e.centerPoint.x+o.offsetAsPoint.x,0,e.width),l.ah(e.centerPoint.y+o.offsetAsPoint.y,0,e.height));F.setLocationAtPoint(R,U);const K=(o.offset&&o.offsetAsPoint.mag())>0?F.center:R,X=k?+o.zoom:u+Mr(d.lat,K.lat),Y=u+Mr(d.lat,0),Q=X+Mr(K.lat,0),ie=l.bA(d.lng,K.lng),ee=l.bA(d.lat,K.lat),oe=l.af(Q-Y);return E=X!==u,{easeFunc:le=>{if(l.be(x,S)||wi({startEulerAngles:x,endEulerAngles:S,tr:e,k:le,useSlerp:x.roll!=S.roll}),A&&e.interpolatePadding(y,o.padding,le),o.around)l.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(o.around,o.aroundPoint);else{const te=Q>Y?Math.min(2,oe):Math.max(.5,oe),de=Math.pow(te,1-le),Ce=yu(d,ie,ee,le*de);e.setCenter(Ce.wrap())}if(E){const te=l.C.number(Y,Q,le)+Mr(0,e.center.lat);e.setZoom(te)}},isZooming:E,elevationCenter:K}}handleFlyTo(e,o){const u=o.zoom!==void 0,d=e.center,y=e.zoom,x=e.padding,S=!e.isPaddingEqual(o.padding),k=e.getConstrained(l.S.convert(o.center||o.locationAtOffset),y).center,A=u?+o.zoom:e.zoom+Mr(e.center.lat,k.lat),E=e.clone();E.setCenter(k),E.setZoom(A),E.setBearing(o.bearing);const L=new l.P(l.ah(e.centerPoint.x+o.offsetAsPoint.x,0,e.width),l.ah(e.centerPoint.y+o.offsetAsPoint.y,0,e.height));E.setLocationAtPoint(k,L);const R=E.center;Rl(e,R);const F=(function(ee,oe,le){const te=Kr(oe),de=Kr(le),Ce=l.aX(te,de),be=Math.acos(Ce),xe=Ol(ee);return be/(2*Math.PI)*xe})(e,d,R),U=y+Mr(d.lat,0),K=A+Mr(R.lat,0),X=l.af(K-U);let Y;if(typeof o.minZoom=="number"){const ee=+o.minZoom+Mr(R.lat,0),oe=Math.min(ee,U,K)+Mr(0,R.lat),le=e.getConstrained(R,oe).zoom+Mr(R.lat,0);Y=l.af(le-U)}const Q=l.bA(d.lng,R.lng),ie=l.bA(d.lat,R.lat);return{easeFunc:(ee,oe,le,te)=>{const de=yu(d,Q,ie,le);S&&e.interpolatePadding(x,o.padding,ee);const Ce=ee===1?R:de;e.setCenter(Ce.wrap());const be=U+l.ak(oe);e.setZoom(ee===1?A:be+Mr(0,Ce.lat))},scaleOfZoom:X,targetCenter:R,scaleOfMinZoom:Y,pixelPathLength:F}}static solveVectorScale(e,o,u,d,y){const x=d==="x"?[u[0],u[4],u[8],u[12]]:[u[1],u[5],u[9],u[13]],S=[u[3],u[7],u[11],u[15]],k=e[0]*x[0]+e[1]*x[1]+e[2]*x[2],A=e[0]*S[0]+e[1]*S[1]+e[2]*S[2],E=o[0]*x[0]+o[1]*x[1]+o[2]*x[2],L=o[0]*S[0]+o[1]*S[1]+o[2]*S[2];return E+y*A===k+y*L||S[3]*(k-E)+x[3]*(L-A)+k*L==E*A?null:(E+x[3]-y*L-y*S[3])/(E-k-y*L+y*A)}static getLesserNonNegativeNonNull(e,o){return o!==null&&o>=0&&o<e?o:e}}class _p{constructor(e){this._globe=e,this._mercatorCameraHelper=new mi,this._verticalPerspectiveCameraHelper=new gi}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,o){return this.currentHelper.handlePanInertia(e,o)}handleMapControlsRollPitchBearingZoom(e,o){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,o)}handleMapControlsPan(e,o,u){this.currentHelper.handleMapControlsPan(e,o,u)}cameraForBoxAndBearing(e,o,u,d,y){return this.currentHelper.cameraForBoxAndBearing(e,o,u,d,y)}handleJumpToCenterZoom(e,o){this.currentHelper.handleJumpToCenterZoom(e,o)}handleEaseTo(e,o){return this.currentHelper.handleEaseTo(e,o)}handleFlyTo(e,o){return this.currentHelper.handleFlyTo(e,o)}}const Bl=(g,e)=>l.y(g,e&&e.filter((o=>o.identifier!=="source.canvas"))),Zf=l.bE();class _u extends l.E{constructor(e,o={}){super(),this._rtlPluginLoaded=()=>{for(const u in this.sourceCaches){const d=this.sourceCaches[u].getSource().type;d!=="vector"&&d!=="geojson"||this.sourceCaches[u].reload()}},this.map=e,this.dispatcher=new Vt(pr(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",((u,d)=>this.getGlyphs(u,d))),this.dispatcher.registerMessageHandler("GI",((u,d)=>this.getImages(u,d))),this.imageManager=new gt,this.imageManager.setEventedParent(this),this.glyphManager=new ur(e._requestManager,o.localIdeographFontFamily),this.lineAtlas=new Ft(256,512),this.crossTileSymbolIndex=new Bo,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",l.bG()),Ca().on(Ka,this._rtlPluginLoaded),this.on("data",(u=>{if(u.dataType!=="source"||u.sourceDataType!=="metadata")return;const d=this.sourceCaches[u.sourceId];if(!d)return;const y=d.getSource();if(y&&y.vectorLayerIds)for(const x in this._layers){const S=this._layers[x];S.source===y.id&&this._validateLayer(S)}}))}setGlobalStateProperty(e,o){var u,d,y;this._checkLoaded();const x=o===null?(y=(d=(u=this.stylesheet.state)===null||u===void 0?void 0:u[e])===null||d===void 0?void 0:d.default)!==null&&y!==void 0?y:null:o;if(l.bH(x,this._globalState[e]))return this;this._globalState[e]=x;const S=this._findGlobalStateAffectedSources([e]);for(const k in this.sourceCaches)S.has(k)&&(this._reloadSource(k),this._changed=!0)}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();const o=[];for(const d in e)!l.bH(this._globalState[d],e[d].default)&&(o.push(d),this._globalState[d]=e[d].default);const u=this._findGlobalStateAffectedSources(o);for(const d in this.sourceCaches)u.has(d)&&(this._reloadSource(d),this._changed=!0)}_findGlobalStateAffectedSources(e){if(e.length===0)return new Set;const o=new Set;for(const u in this._layers){const d=this._layers[u],y=d.getLayoutAffectingGlobalStateRefs();for(const x of e)y.has(x)&&o.add(d.source)}return o}loadURL(e,o={},u){this.fire(new l.l("dataloading",{dataType:"style"})),o.validate=typeof o.validate!="boolean"||o.validate;const d=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const y=this._loadStyleRequest;l.j(d,this._loadStyleRequest).then((x=>{this._loadStyleRequest=null,this._load(x.data,o,u)})).catch((x=>{this._loadStyleRequest=null,x&&!y.signal.aborted&&this.fire(new l.k(x))}))}loadJSON(e,o={},u){this.fire(new l.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Z.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,o.validate=o.validate!==!1,this._load(e,o,u)})).catch((()=>{}))}loadEmpty(){this.fire(new l.l("dataloading",{dataType:"style"})),this._load(Zf,{validate:!1})}_load(e,o,u){var d,y,x;const S=o.transformStyle?o.transformStyle(u,e):e;if(!o.validate||!Bl(this,l.z(S))){this._loaded=!0,this.stylesheet=S;for(const k in S.sources)this.addSource(k,S.sources[k],{validate:!1});S.sprite?this._loadSprite(S.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(S.glyphs),this._createLayers(),this.light=new zi(this.stylesheet.light),this._setProjectionInternal(((d=this.stylesheet.projection)===null||d===void 0?void 0:d.type)||"mercator"),this.sky=new br(this.stylesheet.sky),this.map.setTerrain((y=this.stylesheet.terrain)!==null&&y!==void 0?y:null),this.setGlobalState((x=this.stylesheet.state)!==null&&x!==void 0?x:null),this.fire(new l.l("data",{dataType:"style"})),this.fire(new l.l("style.load"))}}_createLayers(){const e=l.bI(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map((o=>o.id)),this._layers={},this._serializedLayers=null;for(const o of e){const u=l.bJ(o);u.setEventedParent(this,{layer:{id:o.id}}),this._layers[o.id]=u}}_loadSprite(e,o=!1,u=void 0){let d;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(y,x,S,k){return l._(this,void 0,void 0,(function*(){const A=Ae(y),E=S>1?"@2x":"",L={},R={};for(const{id:F,url:U}of A){const K=x.transformRequest(Ne(U,E,".json"),"SpriteJSON");L[F]=l.j(K,k);const X=x.transformRequest(Ne(U,E,".png"),"SpriteImage");R[F]=ve.getImage(X,k)}return yield Promise.all([...Object.values(L),...Object.values(R)]),(function(F,U){return l._(this,void 0,void 0,(function*(){const K={};for(const X in F){K[X]={};const Y=Z.getImageCanvasContext((yield U[X]).data),Q=(yield F[X]).data;for(const ie in Q){const{width:ee,height:oe,x:le,y:te,sdf:de,pixelRatio:Ce,stretchX:be,stretchY:xe,content:ke,textFitWidth:Fe,textFitHeight:$e}=Q[ie];K[X][ie]={data:null,pixelRatio:Ce,sdf:de,stretchX:be,stretchY:xe,content:ke,textFitWidth:Fe,textFitHeight:$e,spriteData:{width:ee,height:oe,x:le,y:te,context:Y}}}}return K}))})(L,R)}))})(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((y=>{if(this._spriteRequest=null,y)for(const x in y){this._spritesImagesIds[x]=[];const S=this._spritesImagesIds[x]?this._spritesImagesIds[x].filter((k=>!(k in y))):[];for(const k of S)this.imageManager.removeImage(k),this._changedImages[k]=!0;for(const k in y[x]){const A=x==="default"?k:`${x}:${k}`;this._spritesImagesIds[x].push(A),A in this.imageManager.images?this.imageManager.updateImage(A,y[x][k],!1):this.imageManager.addImage(A,y[x][k]),o&&(this._changedImages[A]=!0)}}})).catch((y=>{this._spriteRequest=null,d=y,this.fire(new l.k(d))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),o&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"})),u&&u(d)}))}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}_validateLayer(e){const o=this.sourceCaches[e.source];if(!o)return;const u=e.sourceLayer;if(!u)return;const d=o.getSource();(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(u)===-1)&&this.fire(new l.k(new Error(`Source layer "${u}" does not exist on source "${d.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,o=!1){const u=this._serializedAllLayers();if(!e||e.length===0)return Object.values(o?l.bK(u):u);const d=[];for(const y of e)if(u[y]){const x=o?l.bK(u[y]):u[y];d.push(x)}return d}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const o=Object.keys(this._layers);for(const u of o){const d=this._layers[u];d.type!=="custom"&&(e[u]=d.serialize())}return e}hasTransitions(){var e,o,u;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((o=this.sky)===null||o===void 0)&&o.hasTransition()||!((u=this.projection)===null||u===void 0)&&u.hasTransition())return!0;for(const d in this.sourceCaches)if(this.sourceCaches[d].hasTransition())return!0;for(const d in this._layers)if(this._layers[d].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const o=this._changed;if(o){const d=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(d.length||y.length)&&this._updateWorkerLayers(d,y);for(const x in this._updatedSources){const S=this._updatedSources[x];if(S==="reload")this._reloadSource(x);else{if(S!=="clear")throw new Error(`Invalid action ${S}`);this._clearSource(x)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const x in this._updatedPaintProps)this._layers[x].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const u={};for(const d in this.sourceCaches){const y=this.sourceCaches[d];u[d]=y.used,y.used=!1}for(const d of this._order){const y=this._layers[d];y.recalculate(e,this._availableImages),!y.isHidden(e.zoom)&&y.source&&(this.sourceCaches[y.source].used=!0)}for(const d in u){const y=this.sourceCaches[d];!!u[d]!=!!y.used&&y.fire(new l.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:d}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,o&&this.fire(new l.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,o){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:o})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,o={}){var u;this._checkLoaded();const d=this.serialize();if(e=o.transformStyle?o.transformStyle(d,e):e,((u=o.validate)===null||u===void 0||u)&&Bl(this,l.z(e)))return!1;(e=l.bK(e)).layers=l.bI(e.layers);const y=l.bL(d,e),x=this._getOperationsToPerform(y);if(x.unimplemented.length>0)throw new Error(`Unimplemented: ${x.unimplemented.join(", ")}.`);if(x.operations.length===0)return!1;for(const S of x.operations)S();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const o=[],u=[];for(const d of e)switch(d.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":o.push((()=>this.addLayer.apply(this,d.args)));break;case"removeLayer":o.push((()=>this.removeLayer.apply(this,d.args)));break;case"setPaintProperty":o.push((()=>this.setPaintProperty.apply(this,d.args)));break;case"setLayoutProperty":o.push((()=>this.setLayoutProperty.apply(this,d.args)));break;case"setFilter":o.push((()=>this.setFilter.apply(this,d.args)));break;case"addSource":o.push((()=>this.addSource.apply(this,d.args)));break;case"removeSource":o.push((()=>this.removeSource.apply(this,d.args)));break;case"setLayerZoomRange":o.push((()=>this.setLayerZoomRange.apply(this,d.args)));break;case"setLight":o.push((()=>this.setLight.apply(this,d.args)));break;case"setGeoJSONSourceData":o.push((()=>this.setGeoJSONSourceData.apply(this,d.args)));break;case"setGlyphs":o.push((()=>this.setGlyphs.apply(this,d.args)));break;case"setSprite":o.push((()=>this.setSprite.apply(this,d.args)));break;case"setTerrain":o.push((()=>this.map.setTerrain.apply(this,d.args)));break;case"setSky":o.push((()=>this.setSky.apply(this,d.args)));break;case"setProjection":this.setProjection.apply(this,d.args);break;case"setGlobalState":o.push((()=>this.setGlobalState.apply(this,d.args)));break;case"setTransition":o.push((()=>{}));break;default:u.push(d.command)}return{operations:o,unimplemented:u}}addImage(e,o){if(this.getImage(e))return this.fire(new l.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,o),this._afterImageUpdated(e)}updateImage(e,o){this.imageManager.updateImage(e,o)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new l.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,o,u={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(l.z.source,`sources.${e}`,o,null,u))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const d=this.sourceCaches[e]=new Ct(e,o,this.dispatcher);d.style=this,d.setEventedParent(this,(()=>({isSourceLoaded:d.loaded(),source:d.serialize(),sourceId:e}))),d.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const u in this._layers)if(this._layers[u].source===e)return this.fire(new l.k(new Error(`Source "${e}" cannot be removed while layer "${u}" is using it.`)));const o=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],o.fire(new l.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),o.setEventedParent(null),o.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,o){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const u=this.sourceCaches[e].getSource();if(u.type!=="geojson")throw new Error(`geojsonSource.type is ${u.type}, which is !== 'geojson`);u.setData(o),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,o,u={}){this._checkLoaded();const d=e.id;if(this.getLayer(d))return void this.fire(new l.k(new Error(`Layer "${d}" already exists on this map.`)));let y;if(e.type==="custom"){if(Bl(this,l.bM(e)))return;y=l.bJ(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(d,e.source),e=l.bK(e),e=l.e(e,{source:d})),this._validate(l.z.layer,`layers.${d}`,e,{arrayIndex:-1},u))return;y=l.bJ(e),this._validateLayer(y),y.setEventedParent(this,{layer:{id:d}})}const x=o?this._order.indexOf(o):this._order.length;if(o&&x===-1)this.fire(new l.k(new Error(`Cannot add layer "${d}" before non-existing layer "${o}".`)));else{if(this._order.splice(x,0,d),this._layerOrderChanged=!0,this._layers[d]=y,this._removedLayers[d]&&y.source&&y.type!=="custom"){const S=this._removedLayers[d];delete this._removedLayers[d],S.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",this.sourceCaches[y.source].pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map)}}moveLayer(e,o){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new l.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===o)return;const u=this._order.indexOf(e);this._order.splice(u,1);const d=o?this._order.indexOf(o):this._order.length;o&&d===-1?this.fire(new l.k(new Error(`Cannot move layer "${e}" before non-existing layer "${o}".`))):(this._order.splice(d,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const o=this._layers[e];if(!o)return void this.fire(new l.k(new Error(`Cannot remove non-existing layer "${e}".`)));o.setEventedParent(null);const u=this._order.indexOf(e);this._order.splice(u,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=o,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],o.onRemove&&o.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,o,u){this._checkLoaded();const d=this.getLayer(e);d?d.minzoom===o&&d.maxzoom===u||(o!=null&&(d.minzoom=o),u!=null&&(d.maxzoom=u),this._updateLayer(d)):this.fire(new l.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,o,u={}){this._checkLoaded();const d=this.getLayer(e);if(d){if(!l.bH(d.filter,o))return o==null?(d.setFilter(void 0),void this._updateLayer(d)):void(this._validate(l.z.filter,`layers.${d.id}.filter`,o,null,u)||(d.setFilter(l.bK(o)),this._updateLayer(d)))}else this.fire(new l.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return l.bK(this.getLayer(e).filter)}setLayoutProperty(e,o,u,d={}){this._checkLoaded();const y=this.getLayer(e);y?l.bH(y.getLayoutProperty(o),u)||(y.setLayoutProperty(o,u,d),this._updateLayer(y)):this.fire(new l.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,o){const u=this.getLayer(e);if(u)return u.getLayoutProperty(o);this.fire(new l.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,o,u,d={}){this._checkLoaded();const y=this.getLayer(e);y?l.bH(y.getPaintProperty(o),u)||(y.setPaintProperty(o,u,d)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new l.k(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,o){return this.getLayer(e).getPaintProperty(o)}setFeatureState(e,o){this._checkLoaded();const u=e.source,d=e.sourceLayer,y=this.sourceCaches[u];if(y===void 0)return void this.fire(new l.k(new Error(`The source '${u}' does not exist in the map's style.`)));const x=y.getSource().type;x==="geojson"&&d?this.fire(new l.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):x!=="vector"||d?(e.id===void 0&&this.fire(new l.k(new Error("The feature id parameter must be provided."))),y.setFeatureState(d,e.id,o)):this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,o){this._checkLoaded();const u=e.source,d=this.sourceCaches[u];if(d===void 0)return void this.fire(new l.k(new Error(`The source '${u}' does not exist in the map's style.`)));const y=d.getSource().type,x=y==="vector"?e.sourceLayer:void 0;y!=="vector"||x?o&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new l.k(new Error("A feature id is required to remove its specific state property."))):d.removeFeatureState(x,e.id,o):this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const o=e.source,u=e.sourceLayer,d=this.sourceCaches[o];if(d!==void 0)return d.getSource().type!=="vector"||u?(e.id===void 0&&this.fire(new l.k(new Error("The feature id parameter must be provided."))),d.getFeatureState(u,e.id)):void this.fire(new l.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.k(new Error(`The source '${o}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=l.bN(this.sourceCaches,(y=>y.serialize())),o=this._serializeByIds(this._order,!0),u=this.map.getTerrain()||void 0,d=this.stylesheet;return l.bO({version:d.version,name:d.name,metadata:d.metadata,light:d.light,sky:d.sky,center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch,sprite:d.sprite,glyphs:d.glyphs,transition:d.transition,projection:d.projection,sources:e,layers:o,terrain:u},(y=>y!==void 0))}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const o=x=>this._layers[x].type==="fill-extrusion",u={},d=[];for(let x=this._order.length-1;x>=0;x--){const S=this._order[x];if(o(S)){u[S]=x;for(const k of e){const A=k[S];if(A)for(const E of A)d.push(E)}}}d.sort(((x,S)=>S.intersectionZ-x.intersectionZ));const y=[];for(let x=this._order.length-1;x>=0;x--){const S=this._order[x];if(o(S))for(let k=d.length-1;k>=0;k--){const A=d[k].feature;if(u[A.layer.id]<x)break;y.push(A),d.pop()}else for(const k of e){const A=k[S];if(A)for(const E of A)y.push(E.feature)}}return y}queryRenderedFeatures(e,o,u){o&&o.filter&&this._validate(l.z.filter,"queryRenderedFeatures.filter",o.filter,null,o);const d={};if(o&&o.layers){if(!(Array.isArray(o.layers)||o.layers instanceof Set))return this.fire(new l.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const A of o.layers){const E=this._layers[A];if(!E)return this.fire(new l.k(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];d[E.source]=!0}}const y=[];o.availableImages=this._availableImages;const x=this._serializedAllLayers(),S=o.layers instanceof Set?o.layers:Array.isArray(o.layers)?new Set(o.layers):null,k=Object.assign(Object.assign({},o),{layers:S});for(const A in this.sourceCaches)o.layers&&!d[A]||y.push(Cr(this.sourceCaches[A],this._layers,x,e,k,u,this.map.terrain?(E,L,R)=>this.map.terrain.getElevation(E,L,R):void 0));return this.placement&&y.push((function(A,E,L,R,F,U,K){const X={},Y=U.queryRenderedSymbols(R),Q=[];for(const ie of Object.keys(Y).map(Number))Q.push(K[ie]);Q.sort(di);for(const ie of Q){const ee=ie.featureIndex.lookupSymbolFeatures(Y[ie.bucketInstanceId],E,ie.bucketIndex,ie.sourceLayerIndex,F.filter,F.layers,F.availableImages,A);for(const oe in ee){const le=X[oe]=X[oe]||[],te=ee[oe];te.sort(((de,Ce)=>{const be=ie.featureSortOrder;if(be){const xe=be.indexOf(de.featureIndex);return be.indexOf(Ce.featureIndex)-xe}return Ce.featureIndex-de.featureIndex}));for(const de of te)le.push(de)}}return(function(ie,ee,oe){for(const le in ie)for(const te of ie[le])xr(te,oe[ee[le].source]);return ie})(X,A,L)})(this._layers,x,this.sourceCaches,e,k,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(e,o){o&&o.filter&&this._validate(l.z.filter,"querySourceFeatures.filter",o.filter,null,o);const u=this.sourceCaches[e];return u?(function(d,y){const x=d.getRenderableIds().map((A=>d.getTileByID(A))),S=[],k={};for(let A=0;A<x.length;A++){const E=x[A],L=E.tileID.canonical.key;k[L]||(k[L]=!0,E.querySourceFeatures(S,y))}return S})(u,o):[]}getLight(){return this.light.getLight()}setLight(e,o={}){this._checkLoaded();const u=this.light.getLight();let d=!1;for(const x in e)if(!l.bH(e[x],u[x])){d=!0;break}if(!d)return;const y={now:Z.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,o),this.light.updateTransitions(y)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,o={}){this._checkLoaded();const u=this.getSky();let d=!1;if(!e&&!u)return;if(e&&!u)d=!0;else if(!e&&u)d=!0;else for(const x in e)if(!l.bH(e[x],u[x])){d=!0;break}if(!d)return;const y={now:Z.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,o),this.sky.updateTransitions(y)}_setProjectionInternal(e){const o=(function(u){if(Array.isArray(u)){const d=new Fl({type:u});return{projection:d,transform:new Es,cameraHelper:new _p(d)}}switch(u){case"mercator":return{projection:new At,transform:new sr,cameraHelper:new mi};case"globe":{const d=new Fl({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:d,transform:new Es,cameraHelper:new _p(d)}}case"vertical-perspective":return{projection:new ks,transform:new Is,cameraHelper:new gi};default:return l.w(`Unknown projection name: ${u}. Falling back to mercator projection.`),{projection:new At,transform:new sr,cameraHelper:new mi}}})(e);this.projection=o.projection,this.map.migrateProjection(o.transform,o.cameraHelper);for(const u in this.sourceCaches)this.sourceCaches[u].reload()}_validate(e,o,u,d,y={}){return(!y||y.validate!==!1)&&Bl(this,e.call(l.z,l.e({key:o,style:this.serialize(),value:u,styleSpec:l.v},d)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Ca().off(Ka,this._rtlPluginLoaded);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this.sourceCaches){const u=this.sourceCaches[o];u.setEventedParent(null),u.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const o in this.sourceCaches)this.sourceCaches[o].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,o,u,d,y=!1){let x=!1,S=!1;const k={};for(const A of this._order){const E=this._layers[A];if(E.type!=="symbol")continue;if(!k[E.source]){const R=this.sourceCaches[E.source];k[E.source]=R.getRenderableIds(!0).map((F=>R.getTileByID(F))).sort(((F,U)=>U.tileID.overscaledZ-F.tileID.overscaledZ||(F.tileID.isLessThan(U.tileID)?-1:1)))}const L=this.crossTileSymbolIndex.addLayer(E,k[E.source],e.center.lng);x=x||L}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((y=y||this._layerOrderChanged||u===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Z.now(),e.zoom))&&(this.pauseablePlacement=new du(e,this.map.terrain,this._order,y,o,u,d,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,k),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Z.now()),S=!0),x&&this.pauseablePlacement.placement.setStale()),S||x)for(const A of this._order){const E=this._layers[A];E.type==="symbol"&&this.placement.updateLayerOpacities(E,k[E.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Z.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,o){return l._(this,void 0,void 0,(function*(){const u=yield this.imageManager.getImages(o.icons);this._updateTilesForChangedImages();const d=this.sourceCaches[o.source];return d&&d.setDependencies(o.tileID.key,o.type,o.icons),u}))}getGlyphs(e,o){return l._(this,void 0,void 0,(function*(){const u=yield this.glyphManager.getGlyphs(o.stacks),d=this.sourceCaches[o.source];return d&&d.setDependencies(o.tileID.key,o.type,[""]),u}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,o={}){this._checkLoaded(),e&&this._validate(l.z.glyphs,"glyphs",e,null,o)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,o,u={},d){this._checkLoaded();const y=[{id:e,url:o}],x=[...Ae(this.stylesheet.sprite),...y];this._validate(l.z.sprite,"sprite",x,null,u)||(this.stylesheet.sprite=x,this._loadSprite(y,!0,d))}removeSprite(e){this._checkLoaded();const o=Ae(this.stylesheet.sprite);if(o.find((u=>u.id===e))){if(this._spritesImagesIds[e])for(const u of this._spritesImagesIds[e])this.imageManager.removeImage(u),this._changedImages[u]=!0;o.splice(o.findIndex((u=>u.id===e)),1),this.stylesheet.sprite=o.length>0?o:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new l.l("data",{dataType:"style"}))}else this.fire(new l.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Ae(this.stylesheet.sprite)}setSprite(e,o={},u){this._checkLoaded(),e&&this._validate(l.z.sprite,"sprite",e,null,o)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,u):(this._unloadSprite(),u&&u(null)))}}var Wf=l.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Hf{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,o,u,d,y,x,S,k,A){this.context=e;let E=this.boundPaintVertexBuffers.length!==d.length;for(let L=0;!E&&L<d.length;L++)this.boundPaintVertexBuffers[L]!==d[L]&&(E=!0);!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==u||E||this.boundIndexBuffer!==y||this.boundVertexOffset!==x||this.boundDynamicVertexBuffer!==S||this.boundDynamicVertexBuffer2!==k||this.boundDynamicVertexBuffer3!==A?this.freshBind(o,u,d,y,x,S,k,A):(e.bindVertexArray.set(this.vao),S&&S.bind(),y&&y.dynamicDraw&&y.bind(),k&&k.bind(),A&&A.bind())}freshBind(e,o,u,d,y,x,S,k){const A=e.numAttributes,E=this.context,L=E.gl;this.vao&&this.destroy(),this.vao=E.createVertexArray(),E.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=d,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=x,this.boundDynamicVertexBuffer2=S,this.boundDynamicVertexBuffer3=k,o.enableAttributes(L,e);for(const R of u)R.enableAttributes(L,e);x&&x.enableAttributes(L,e),S&&S.enableAttributes(L,e),k&&k.enableAttributes(L,e),o.bind(),o.setVertexAttribPointers(L,e,y);for(const R of u)R.bind(),R.setVertexAttribPointers(L,e,y);x&&(x.bind(),x.setVertexAttribPointers(L,e,y)),d&&d.bind(),S&&(S.bind(),S.setVertexAttribPointers(L,e,y)),k&&(k.bind(),k.setVertexAttribPointers(L,e,y)),E.currentNumAttributes=A}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const $l=(g,e,o,u,d)=>({u_texture:0,u_ele_delta:g,u_fog_matrix:e,u_fog_color:o?o.properties.get("fog-color"):l.bf.white,u_fog_ground_blend:o?o.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:d?0:o?o.calculateFogBlendOpacity(u):0,u_horizon_color:o?o.properties.get("horizon-color"):l.bf.white,u_horizon_fog_blend:o?o.properties.get("horizon-fog-blend"):1,u_is_globe_mode:d?1:0}),vu={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function io(g){const e=[];for(let o=0;o<g.length;o++){if(g[o]===null)continue;const u=g[o].split(" ");e.push(u.pop())}return e}class bu{constructor(e,o,u,d,y,x,S,k,A=[]){const E=e.gl;this.program=E.createProgram();const L=io(o.staticAttributes),R=u?u.getBinderAttributes():[],F=L.concat(R),U=un.prelude.staticUniforms?io(un.prelude.staticUniforms):[],K=S.staticUniforms?io(S.staticUniforms):[],X=o.staticUniforms?io(o.staticUniforms):[],Y=u?u.getBinderUniforms():[],Q=U.concat(K).concat(X).concat(Y),ie=[];for(const be of Q)ie.indexOf(be)<0&&ie.push(be);const ee=u?u.defines():[];Bn(E)&&ee.unshift("#version 300 es"),y&&ee.push("#define OVERDRAW_INSPECTOR;"),x&&ee.push("#define TERRAIN3D;"),k&&ee.push(k),A&&ee.push(...A);let oe=ee.concat(un.prelude.fragmentSource,S.fragmentSource,o.fragmentSource).join(`
`),le=ee.concat(un.prelude.vertexSource,S.vertexSource,o.vertexSource).join(`
`);Bn(E)||(oe=(function(be){return be.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(oe),le=(function(be){return be.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(le));const te=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);if(E.shaderSource(te,oe),E.compileShader(te),!E.getShaderParameter(te,E.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${E.getShaderInfoLog(te)}`);E.attachShader(this.program,te);const de=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);if(E.shaderSource(de,le),E.compileShader(de),!E.getShaderParameter(de,E.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${E.getShaderInfoLog(de)}`);E.attachShader(this.program,de),this.attributes={};const Ce={};this.numAttributes=F.length;for(let be=0;be<this.numAttributes;be++)F[be]&&(E.bindAttribLocation(this.program,be,F[be]),this.attributes[F[be]]=be);if(E.linkProgram(this.program),!E.getProgramParameter(this.program,E.LINK_STATUS))throw new Error(`Program failed to link: ${E.getProgramInfoLog(this.program)}`);E.deleteShader(de),E.deleteShader(te);for(let be=0;be<ie.length;be++){const xe=ie[be];if(xe&&!Ce[xe]){const ke=E.getUniformLocation(this.program,xe);ke&&(Ce[xe]=ke)}}this.fixedUniforms=d(e,Ce),this.terrainUniforms=((be,xe)=>({u_depth:new l.bP(be,xe.u_depth),u_terrain:new l.bP(be,xe.u_terrain),u_terrain_dim:new l.bg(be,xe.u_terrain_dim),u_terrain_matrix:new l.bR(be,xe.u_terrain_matrix),u_terrain_unpack:new l.bS(be,xe.u_terrain_unpack),u_terrain_exaggeration:new l.bg(be,xe.u_terrain_exaggeration)}))(e,Ce),this.projectionUniforms=((be,xe)=>({u_projection_matrix:new l.bR(be,xe.u_projection_matrix),u_projection_tile_mercator_coords:new l.bS(be,xe.u_projection_tile_mercator_coords),u_projection_clipping_plane:new l.bS(be,xe.u_projection_clipping_plane),u_projection_transition:new l.bg(be,xe.u_projection_transition),u_projection_fallback_matrix:new l.bR(be,xe.u_projection_fallback_matrix)}))(e,Ce),this.binderUniforms=u?u.getUniforms(e,Ce):[]}draw(e,o,u,d,y,x,S,k,A,E,L,R,F,U,K,X,Y,Q,ie){const ee=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(u),e.setStencilMode(d),e.setColorMode(y),e.setCullFace(x),k){e.activeTexture.set(ee.TEXTURE2),ee.bindTexture(ee.TEXTURE_2D,k.depthTexture),e.activeTexture.set(ee.TEXTURE3),ee.bindTexture(ee.TEXTURE_2D,k.texture);for(const le in this.terrainUniforms)this.terrainUniforms[le].set(k[le])}if(A)for(const le in A)this.projectionUniforms[vu[le]].set(A[le]);if(S)for(const le in this.fixedUniforms)this.fixedUniforms[le].set(S[le]);X&&X.setUniforms(e,this.binderUniforms,U,{zoom:K});let oe=0;switch(o){case ee.LINES:oe=2;break;case ee.TRIANGLES:oe=3;break;case ee.LINE_STRIP:oe=1}for(const le of F.get()){const te=le.vaos||(le.vaos={});(te[E]||(te[E]=new Hf)).bind(e,this,L,X?X.getPaintVertexBuffers():[],R,le.vertexOffset,Y,Q,ie),ee.drawElements(o,le.primitiveLength*oe,ee.UNSIGNED_SHORT,le.primitiveOffset*oe*2)}}}function Nl(g,e,o){const u=1/l.aC(o,1,e.transform.tileZoom),d=Math.pow(2,o.tileID.overscaledZ),y=o.tileSize*Math.pow(2,e.transform.tileZoom)/d,x=y*(o.tileID.canonical.x+o.tileID.wrap*d),S=y*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[u,g.fromScale,g.toScale],u_fade:g.t,u_pixel_coord_upper:[x>>16,S>>16],u_pixel_coord_lower:[65535&x,65535&S]}}const pn=(g,e,o,u)=>{const d=g.style.light,y=d.properties.get("position"),x=[y.x,y.y,y.z],S=l.bV();d.properties.get("anchor")==="viewport"&&l.bW(S,g.transform.bearingInRadians),l.bX(x,x,S);const k=g.transform.transformLightDirection(x),A=d.properties.get("color");return{u_lightpos:x,u_lightpos_globe:k,u_lightintensity:d.properties.get("intensity"),u_lightcolor:[A.r,A.g,A.b],u_vertical_gradient:+e,u_opacity:o,u_fill_translate:u}},Xf=(g,e,o,u,d,y,x)=>l.e(pn(g,e,o,u),Nl(y,g,x),{u_height_factor:-Math.pow(2,d.overscaledZ)/x.tileSize/8}),Ul=(g,e,o,u)=>l.e(Nl(e,g,o),{u_fill_translate:u}),zs=(g,e)=>({u_world:g,u_fill_translate:e}),Rs=(g,e,o,u,d)=>l.e(Ul(g,e,o,d),{u_world:u}),Kf=(g,e,o,u,d)=>{const y=g.transform;let x,S,k=0;if(o.paint.get("circle-pitch-alignment")==="map"){const A=l.aC(e,1,y.zoom);x=!0,S=[A,A],k=A/(l.$*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*d}else x=!1,S=y.pixelsToGLUnits;return{u_camera_to_center_distance:y.cameraToCenterDistance,u_scale_with_map:+(o.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+x,u_device_pixel_ratio:g.pixelRatio,u_extrude_scale:S,u_globe_extrude_scale:k,u_translate:u}},Vl=g=>({u_pixel_extrude_scale:[1/g.width,1/g.height]}),Yf=g=>({u_viewport_size:[g.width,g.height]}),no=(g,e=1)=>({u_color:g,u_overlay:0,u_overlay_scale:e}),vp=(g,e,o,u)=>{const d=l.aC(g,1,e)/(l.$*Math.pow(2,g.tileID.overscaledZ))*2*Math.PI*u;return{u_extrude_scale:l.aC(g,1,e),u_intensity:o,u_globe_extrude_scale:d}},xu=(g,e,o,u)=>{const d=l.L();l.bY(d,0,g.width,g.height,0,0,1);const y=g.context.gl;return{u_matrix:d,u_world:[y.drawingBufferWidth,y.drawingBufferHeight],u_image:o,u_color_ramp:u,u_opacity:e.paint.get("heatmap-opacity")}},Jf=(g,e,o)=>{const u=o.paint.get("hillshade-accent-color");let d;switch(o.paint.get("hillshade-method")){case"basic":d=4;break;case"combined":d=1;break;case"igor":d=2;break;case"multidirectional":d=3;break;default:d=0}const y=o.getIlluminationProperties();for(let x=0;x<y.directionRadians.length;x++)o.paint.get("hillshade-illumination-anchor")==="viewport"&&(y.directionRadians[x]+=g.transform.bearingInRadians);return{u_image:0,u_latrange:wu(0,e.tileID),u_exaggeration:o.paint.get("hillshade-exaggeration"),u_altitudes:y.altitudeRadians,u_azimuths:y.directionRadians,u_accent:u,u_method:d,u_highlights:y.highlightColor,u_shadows:y.shadowColor}},bp=(g,e)=>{const o=e.stride,u=l.L();return l.bY(u,0,l.$,-l.$,0,0,1),l.M(u,u,[0,-l.$,0]),{u_matrix:u,u_image:1,u_dimension:[o,o],u_zoom:g.overscaledZ,u_unpack:e.getUnpackVector()}};function wu(g,e){const o=Math.pow(2,e.canonical.z),u=e.canonical.y;return[new l.a1(0,u/o).toLngLat().lat,new l.a1(0,(u+1)/o).toLngLat().lat]}const xp=(g,e,o=0)=>({u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:o,u_opacity:g.paint.get("color-relief-opacity")}),ql=(g,e,o,u)=>{const d=g.transform;return{u_translation:Su(g,e,o),u_ratio:u/l.aC(e,1,d.zoom),u_device_pixel_ratio:g.pixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},wp=(g,e,o,u,d)=>l.e(ql(g,e,o,u),{u_image:0,u_image_height:d}),Tp=(g,e,o,u,d)=>{const y=g.transform,x=Tu(e,y);return{u_translation:Su(g,e,o),u_texsize:e.imageAtlasTexture.size,u_ratio:u/l.aC(e,1,y.zoom),u_device_pixel_ratio:g.pixelRatio,u_image:0,u_scale:[x,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},ao=(g,e,o,u,d,y)=>{const x=g.lineAtlas,S=Tu(e,g.transform),k=o.layout.get("line-cap")==="round",A=x.getDash(d.from,k),E=x.getDash(d.to,k),L=A.width*y.fromScale,R=E.width*y.toScale;return l.e(ql(g,e,o,u),{u_patternscale_a:[S/L,-A.height/2],u_patternscale_b:[S/R,-E.height/2],u_sdfgamma:x.width/(256*Math.min(L,R)*g.pixelRatio)/2,u_image:0,u_tex_y_a:A.y,u_tex_y_b:E.y,u_mix:y.t})};function Tu(g,e){return 1/l.aC(g,1,e.tileZoom)}function Su(g,e,o){return l.aD(g.transform,e,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}const Ls=(g,e,o,u,d)=>{return{u_tl_parent:g,u_scale_parent:e,u_buffer_scale:1,u_fade_t:o.mix,u_opacity:o.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(x=u.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(y=u.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:Qf(u.paint.get("raster-hue-rotate")),u_coords_top:[d[0].x,d[0].y,d[1].x,d[1].y],u_coords_bottom:[d[3].x,d[3].y,d[2].x,d[2].y]};var y,x};function Qf(g){g*=Math.PI/180;const e=Math.sin(g),o=Math.cos(g);return[(2*o+1)/3,(-Math.sqrt(3)*e-o+1)/3,(Math.sqrt(3)*e-o+1)/3]}const Ds=(g,e,o,u,d,y,x,S,k,A,E,L,R)=>{const F=x.transform;return{u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:F.cameraToCenterDistance,u_pitch:F.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:F.width/F.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_label_plane_matrix:S,u_coord_matrix:k,u_is_text:+E,u_pitch_with_map:+u,u_is_along_line:d,u_is_variable_anchor:y,u_texsize:L,u_texture:0,u_translation:A,u_pitched_scale:R}},Sp=(g,e,o,u,d,y,x,S,k,A,E,L,R,F)=>{const U=x.transform;return l.e(Ds(g,e,o,u,d,y,x,S,k,A,E,L,F),{u_gamma_scale:u?Math.cos(U.pitch*Math.PI/180)*U.cameraToCenterDistance:1,u_device_pixel_ratio:x.pixelRatio,u_is_halo:1})},em=(g,e,o,u,d,y,x,S,k,A,E,L,R)=>l.e(Sp(g,e,o,u,d,y,x,S,k,A,!0,E,0,R),{u_texsize_icon:L,u_texture_icon:1}),kp=(g,e)=>({u_opacity:g,u_color:e}),Cp=(g,e,o,u,d)=>l.e((function(y,x,S,k){const A=S.imageManager.getPattern(y.from.toString()),E=S.imageManager.getPattern(y.to.toString()),{width:L,height:R}=S.imageManager.getPixelSize(),F=Math.pow(2,k.tileID.overscaledZ),U=k.tileSize*Math.pow(2,S.transform.tileZoom)/F,K=U*(k.tileID.canonical.x+k.tileID.wrap*F),X=U*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:A.tl,u_pattern_br_a:A.br,u_pattern_tl_b:E.tl,u_pattern_br_b:E.br,u_texsize:[L,R],u_mix:x.t,u_pattern_size_a:A.displaySize,u_pattern_size_b:E.displaySize,u_scale_a:x.fromScale,u_scale_b:x.toScale,u_tile_units_to_pixels:1/l.aC(k,1,S.transform.tileZoom),u_pixel_coord_upper:[K>>16,X>>16],u_pixel_coord_lower:[65535&K,65535&X]}})(o,d,e,u),{u_opacity:g}),ku=(g,e)=>{},Cu={fillExtrusion:(g,e)=>({u_lightpos:new l.bT(g,e.u_lightpos),u_lightpos_globe:new l.bT(g,e.u_lightpos_globe),u_lightintensity:new l.bg(g,e.u_lightintensity),u_lightcolor:new l.bT(g,e.u_lightcolor),u_vertical_gradient:new l.bg(g,e.u_vertical_gradient),u_opacity:new l.bg(g,e.u_opacity),u_fill_translate:new l.bU(g,e.u_fill_translate)}),fillExtrusionPattern:(g,e)=>({u_lightpos:new l.bT(g,e.u_lightpos),u_lightpos_globe:new l.bT(g,e.u_lightpos_globe),u_lightintensity:new l.bg(g,e.u_lightintensity),u_lightcolor:new l.bT(g,e.u_lightcolor),u_vertical_gradient:new l.bg(g,e.u_vertical_gradient),u_height_factor:new l.bg(g,e.u_height_factor),u_opacity:new l.bg(g,e.u_opacity),u_fill_translate:new l.bU(g,e.u_fill_translate),u_image:new l.bP(g,e.u_image),u_texsize:new l.bU(g,e.u_texsize),u_pixel_coord_upper:new l.bU(g,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.bU(g,e.u_pixel_coord_lower),u_scale:new l.bT(g,e.u_scale),u_fade:new l.bg(g,e.u_fade)}),fill:(g,e)=>({u_fill_translate:new l.bU(g,e.u_fill_translate)}),fillPattern:(g,e)=>({u_image:new l.bP(g,e.u_image),u_texsize:new l.bU(g,e.u_texsize),u_pixel_coord_upper:new l.bU(g,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.bU(g,e.u_pixel_coord_lower),u_scale:new l.bT(g,e.u_scale),u_fade:new l.bg(g,e.u_fade),u_fill_translate:new l.bU(g,e.u_fill_translate)}),fillOutline:(g,e)=>({u_world:new l.bU(g,e.u_world),u_fill_translate:new l.bU(g,e.u_fill_translate)}),fillOutlinePattern:(g,e)=>({u_world:new l.bU(g,e.u_world),u_image:new l.bP(g,e.u_image),u_texsize:new l.bU(g,e.u_texsize),u_pixel_coord_upper:new l.bU(g,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.bU(g,e.u_pixel_coord_lower),u_scale:new l.bT(g,e.u_scale),u_fade:new l.bg(g,e.u_fade),u_fill_translate:new l.bU(g,e.u_fill_translate)}),circle:(g,e)=>({u_camera_to_center_distance:new l.bg(g,e.u_camera_to_center_distance),u_scale_with_map:new l.bP(g,e.u_scale_with_map),u_pitch_with_map:new l.bP(g,e.u_pitch_with_map),u_extrude_scale:new l.bU(g,e.u_extrude_scale),u_device_pixel_ratio:new l.bg(g,e.u_device_pixel_ratio),u_globe_extrude_scale:new l.bg(g,e.u_globe_extrude_scale),u_translate:new l.bU(g,e.u_translate)}),collisionBox:(g,e)=>({u_pixel_extrude_scale:new l.bU(g,e.u_pixel_extrude_scale)}),collisionCircle:(g,e)=>({u_viewport_size:new l.bU(g,e.u_viewport_size)}),debug:(g,e)=>({u_color:new l.bQ(g,e.u_color),u_overlay:new l.bP(g,e.u_overlay),u_overlay_scale:new l.bg(g,e.u_overlay_scale)}),depth:ku,clippingMask:ku,heatmap:(g,e)=>({u_extrude_scale:new l.bg(g,e.u_extrude_scale),u_intensity:new l.bg(g,e.u_intensity),u_globe_extrude_scale:new l.bg(g,e.u_globe_extrude_scale)}),heatmapTexture:(g,e)=>({u_matrix:new l.bR(g,e.u_matrix),u_world:new l.bU(g,e.u_world),u_image:new l.bP(g,e.u_image),u_color_ramp:new l.bP(g,e.u_color_ramp),u_opacity:new l.bg(g,e.u_opacity)}),hillshade:(g,e)=>({u_image:new l.bP(g,e.u_image),u_latrange:new l.bU(g,e.u_latrange),u_exaggeration:new l.bg(g,e.u_exaggeration),u_altitudes:new l.b_(g,e.u_altitudes),u_azimuths:new l.b_(g,e.u_azimuths),u_accent:new l.bQ(g,e.u_accent),u_method:new l.bP(g,e.u_method),u_shadows:new l.bZ(g,e.u_shadows),u_highlights:new l.bZ(g,e.u_highlights)}),hillshadePrepare:(g,e)=>({u_matrix:new l.bR(g,e.u_matrix),u_image:new l.bP(g,e.u_image),u_dimension:new l.bU(g,e.u_dimension),u_zoom:new l.bg(g,e.u_zoom),u_unpack:new l.bS(g,e.u_unpack)}),colorRelief:(g,e)=>({u_image:new l.bP(g,e.u_image),u_unpack:new l.bS(g,e.u_unpack),u_dimension:new l.bU(g,e.u_dimension),u_elevation_stops:new l.bP(g,e.u_elevation_stops),u_color_stops:new l.bP(g,e.u_color_stops),u_color_ramp_size:new l.bP(g,e.u_color_ramp_size),u_opacity:new l.bg(g,e.u_opacity)}),line:(g,e)=>({u_translation:new l.bU(g,e.u_translation),u_ratio:new l.bg(g,e.u_ratio),u_device_pixel_ratio:new l.bg(g,e.u_device_pixel_ratio),u_units_to_pixels:new l.bU(g,e.u_units_to_pixels)}),lineGradient:(g,e)=>({u_translation:new l.bU(g,e.u_translation),u_ratio:new l.bg(g,e.u_ratio),u_device_pixel_ratio:new l.bg(g,e.u_device_pixel_ratio),u_units_to_pixels:new l.bU(g,e.u_units_to_pixels),u_image:new l.bP(g,e.u_image),u_image_height:new l.bg(g,e.u_image_height)}),linePattern:(g,e)=>({u_translation:new l.bU(g,e.u_translation),u_texsize:new l.bU(g,e.u_texsize),u_ratio:new l.bg(g,e.u_ratio),u_device_pixel_ratio:new l.bg(g,e.u_device_pixel_ratio),u_image:new l.bP(g,e.u_image),u_units_to_pixels:new l.bU(g,e.u_units_to_pixels),u_scale:new l.bT(g,e.u_scale),u_fade:new l.bg(g,e.u_fade)}),lineSDF:(g,e)=>({u_translation:new l.bU(g,e.u_translation),u_ratio:new l.bg(g,e.u_ratio),u_device_pixel_ratio:new l.bg(g,e.u_device_pixel_ratio),u_units_to_pixels:new l.bU(g,e.u_units_to_pixels),u_patternscale_a:new l.bU(g,e.u_patternscale_a),u_patternscale_b:new l.bU(g,e.u_patternscale_b),u_sdfgamma:new l.bg(g,e.u_sdfgamma),u_image:new l.bP(g,e.u_image),u_tex_y_a:new l.bg(g,e.u_tex_y_a),u_tex_y_b:new l.bg(g,e.u_tex_y_b),u_mix:new l.bg(g,e.u_mix)}),raster:(g,e)=>({u_tl_parent:new l.bU(g,e.u_tl_parent),u_scale_parent:new l.bg(g,e.u_scale_parent),u_buffer_scale:new l.bg(g,e.u_buffer_scale),u_fade_t:new l.bg(g,e.u_fade_t),u_opacity:new l.bg(g,e.u_opacity),u_image0:new l.bP(g,e.u_image0),u_image1:new l.bP(g,e.u_image1),u_brightness_low:new l.bg(g,e.u_brightness_low),u_brightness_high:new l.bg(g,e.u_brightness_high),u_saturation_factor:new l.bg(g,e.u_saturation_factor),u_contrast_factor:new l.bg(g,e.u_contrast_factor),u_spin_weights:new l.bT(g,e.u_spin_weights),u_coords_top:new l.bS(g,e.u_coords_top),u_coords_bottom:new l.bS(g,e.u_coords_bottom)}),symbolIcon:(g,e)=>({u_is_size_zoom_constant:new l.bP(g,e.u_is_size_zoom_constant),u_is_size_feature_constant:new l.bP(g,e.u_is_size_feature_constant),u_size_t:new l.bg(g,e.u_size_t),u_size:new l.bg(g,e.u_size),u_camera_to_center_distance:new l.bg(g,e.u_camera_to_center_distance),u_pitch:new l.bg(g,e.u_pitch),u_rotate_symbol:new l.bP(g,e.u_rotate_symbol),u_aspect_ratio:new l.bg(g,e.u_aspect_ratio),u_fade_change:new l.bg(g,e.u_fade_change),u_label_plane_matrix:new l.bR(g,e.u_label_plane_matrix),u_coord_matrix:new l.bR(g,e.u_coord_matrix),u_is_text:new l.bP(g,e.u_is_text),u_pitch_with_map:new l.bP(g,e.u_pitch_with_map),u_is_along_line:new l.bP(g,e.u_is_along_line),u_is_variable_anchor:new l.bP(g,e.u_is_variable_anchor),u_texsize:new l.bU(g,e.u_texsize),u_texture:new l.bP(g,e.u_texture),u_translation:new l.bU(g,e.u_translation),u_pitched_scale:new l.bg(g,e.u_pitched_scale)}),symbolSDF:(g,e)=>({u_is_size_zoom_constant:new l.bP(g,e.u_is_size_zoom_constant),u_is_size_feature_constant:new l.bP(g,e.u_is_size_feature_constant),u_size_t:new l.bg(g,e.u_size_t),u_size:new l.bg(g,e.u_size),u_camera_to_center_distance:new l.bg(g,e.u_camera_to_center_distance),u_pitch:new l.bg(g,e.u_pitch),u_rotate_symbol:new l.bP(g,e.u_rotate_symbol),u_aspect_ratio:new l.bg(g,e.u_aspect_ratio),u_fade_change:new l.bg(g,e.u_fade_change),u_label_plane_matrix:new l.bR(g,e.u_label_plane_matrix),u_coord_matrix:new l.bR(g,e.u_coord_matrix),u_is_text:new l.bP(g,e.u_is_text),u_pitch_with_map:new l.bP(g,e.u_pitch_with_map),u_is_along_line:new l.bP(g,e.u_is_along_line),u_is_variable_anchor:new l.bP(g,e.u_is_variable_anchor),u_texsize:new l.bU(g,e.u_texsize),u_texture:new l.bP(g,e.u_texture),u_gamma_scale:new l.bg(g,e.u_gamma_scale),u_device_pixel_ratio:new l.bg(g,e.u_device_pixel_ratio),u_is_halo:new l.bP(g,e.u_is_halo),u_translation:new l.bU(g,e.u_translation),u_pitched_scale:new l.bg(g,e.u_pitched_scale)}),symbolTextAndIcon:(g,e)=>({u_is_size_zoom_constant:new l.bP(g,e.u_is_size_zoom_constant),u_is_size_feature_constant:new l.bP(g,e.u_is_size_feature_constant),u_size_t:new l.bg(g,e.u_size_t),u_size:new l.bg(g,e.u_size),u_camera_to_center_distance:new l.bg(g,e.u_camera_to_center_distance),u_pitch:new l.bg(g,e.u_pitch),u_rotate_symbol:new l.bP(g,e.u_rotate_symbol),u_aspect_ratio:new l.bg(g,e.u_aspect_ratio),u_fade_change:new l.bg(g,e.u_fade_change),u_label_plane_matrix:new l.bR(g,e.u_label_plane_matrix),u_coord_matrix:new l.bR(g,e.u_coord_matrix),u_is_text:new l.bP(g,e.u_is_text),u_pitch_with_map:new l.bP(g,e.u_pitch_with_map),u_is_along_line:new l.bP(g,e.u_is_along_line),u_is_variable_anchor:new l.bP(g,e.u_is_variable_anchor),u_texsize:new l.bU(g,e.u_texsize),u_texsize_icon:new l.bU(g,e.u_texsize_icon),u_texture:new l.bP(g,e.u_texture),u_texture_icon:new l.bP(g,e.u_texture_icon),u_gamma_scale:new l.bg(g,e.u_gamma_scale),u_device_pixel_ratio:new l.bg(g,e.u_device_pixel_ratio),u_is_halo:new l.bP(g,e.u_is_halo),u_translation:new l.bU(g,e.u_translation),u_pitched_scale:new l.bg(g,e.u_pitched_scale)}),background:(g,e)=>({u_opacity:new l.bg(g,e.u_opacity),u_color:new l.bQ(g,e.u_color)}),backgroundPattern:(g,e)=>({u_opacity:new l.bg(g,e.u_opacity),u_image:new l.bP(g,e.u_image),u_pattern_tl_a:new l.bU(g,e.u_pattern_tl_a),u_pattern_br_a:new l.bU(g,e.u_pattern_br_a),u_pattern_tl_b:new l.bU(g,e.u_pattern_tl_b),u_pattern_br_b:new l.bU(g,e.u_pattern_br_b),u_texsize:new l.bU(g,e.u_texsize),u_mix:new l.bg(g,e.u_mix),u_pattern_size_a:new l.bU(g,e.u_pattern_size_a),u_pattern_size_b:new l.bU(g,e.u_pattern_size_b),u_scale_a:new l.bg(g,e.u_scale_a),u_scale_b:new l.bg(g,e.u_scale_b),u_pixel_coord_upper:new l.bU(g,e.u_pixel_coord_upper),u_pixel_coord_lower:new l.bU(g,e.u_pixel_coord_lower),u_tile_units_to_pixels:new l.bg(g,e.u_tile_units_to_pixels)}),terrain:(g,e)=>({u_texture:new l.bP(g,e.u_texture),u_ele_delta:new l.bg(g,e.u_ele_delta),u_fog_matrix:new l.bR(g,e.u_fog_matrix),u_fog_color:new l.bQ(g,e.u_fog_color),u_fog_ground_blend:new l.bg(g,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new l.bg(g,e.u_fog_ground_blend_opacity),u_horizon_color:new l.bQ(g,e.u_horizon_color),u_horizon_fog_blend:new l.bg(g,e.u_horizon_fog_blend),u_is_globe_mode:new l.bg(g,e.u_is_globe_mode)}),terrainDepth:(g,e)=>({u_ele_delta:new l.bg(g,e.u_ele_delta)}),terrainCoords:(g,e)=>({u_texture:new l.bP(g,e.u_texture),u_terrain_coords_id:new l.bg(g,e.u_terrain_coords_id),u_ele_delta:new l.bg(g,e.u_ele_delta)}),projectionErrorMeasurement:(g,e)=>({u_input:new l.bg(g,e.u_input),u_output_expected:new l.bg(g,e.u_output_expected)}),atmosphere:(g,e)=>({u_sun_pos:new l.bT(g,e.u_sun_pos),u_atmosphere_blend:new l.bg(g,e.u_atmosphere_blend),u_globe_position:new l.bT(g,e.u_globe_position),u_globe_radius:new l.bg(g,e.u_globe_radius),u_inv_proj_matrix:new l.bR(g,e.u_inv_proj_matrix)}),sky:(g,e)=>({u_sky_color:new l.bQ(g,e.u_sky_color),u_horizon_color:new l.bQ(g,e.u_horizon_color),u_horizon:new l.bU(g,e.u_horizon),u_horizon_normal:new l.bU(g,e.u_horizon_normal),u_sky_horizon_blend:new l.bg(g,e.u_sky_horizon_blend),u_sky_blend:new l.bg(g,e.u_sky_blend)})};class Pp{constructor(e,o,u){this.context=e;const d=e.gl;this.buffer=d.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const o=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Gl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class na{constructor(e,o,u,d){this.length=o.length,this.attributes=u,this.itemSize=o.bytesPerElement,this.dynamicDraw=d,this.context=e;const y=e.gl;this.buffer=y.createBuffer(),e.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete o.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,o){for(let u=0;u<this.attributes.length;u++){const d=o.attributes[this.attributes[u].name];d!==void 0&&e.enableVertexAttribArray(d)}}setVertexAttribPointers(e,o,u){for(let d=0;d<this.attributes.length;d++){const y=this.attributes[d],x=o.attributes[y.name];x!==void 0&&e.vertexAttribPointer(x,y.components,e[Gl[y.type]],!1,this.itemSize,y.offset+this.itemSize*(u||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Xt{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Pu extends Xt{getDefault(){return l.bf.transparent}set(e){const o=this.current;(e.r!==o.r||e.g!==o.g||e.b!==o.b||e.a!==o.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Mu extends Xt{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Mp extends Xt{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Au extends Xt{getDefault(){return[!0,!0,!0,!0]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||e[3]!==o[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class oo extends Xt{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Iu extends Xt{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class tm extends Xt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const o=this.current;(e.func!==o.func||e.ref!==o.ref||e.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class rm extends Xt{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class im extends Xt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=e,this.dirty=!1}}class nm extends Xt{getDefault(){return[0,1]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Ap extends Xt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=e,this.dirty=!1}}class am extends Xt{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Ip extends Xt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.BLEND):o.disable(o.BLEND),this.current=e,this.dirty=!1}}class Zl extends Xt{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Wl extends Xt{getDefault(){return l.bf.transparent}set(e){const o=this.current;(e.r!==o.r||e.g!==o.g||e.b!==o.b||e.a!==o.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Hl extends Xt{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Eu extends Xt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;e?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=e,this.dirty=!1}}class so extends Xt{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class js extends Xt{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Vo extends Xt{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class en extends Xt{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Ep extends Xt{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const o=this.current;(e[0]!==o[0]||e[1]!==o[1]||e[2]!==o[2]||e[3]!==o[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class zp extends Xt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class zu extends Xt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class lo extends Xt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Xl extends Xt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Kl extends Xt{getDefault(){return null}set(e){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Fs extends Xt{getDefault(){return null}set(e){var o;if(e===this.current&&!this.dirty)return;const u=this.gl;Bn(u)?u.bindVertexArray(e):(o=u.getExtension("OES_vertex_array_object"))===null||o===void 0||o.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Yl extends Xt{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Rp extends Xt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class qo extends Xt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Ra extends Xt{constructor(e,o){super(e),this.context=e,this.parent=o}getDefault(){return null}}class Lp extends Ra{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Ru extends Ra{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Rt extends Ra{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const Os="Framebuffer is not complete";class om{constructor(e,o,u,d,y){this.context=e,this.width=o,this.height=u;const x=e.gl,S=this.framebuffer=x.createFramebuffer();if(this.colorAttachment=new Lp(e,S),d)this.depthAttachment=y?new Rt(e,S):new Ru(e,S);else if(y)throw new Error("Stencil cannot be set without depth");if(x.checkFramebufferStatus(x.FRAMEBUFFER)!==x.FRAMEBUFFER_COMPLETE)throw new Error(Os)}destroy(){const e=this.context.gl,o=this.colorAttachment.get();if(o&&e.deleteTexture(o),this.depthAttachment){const u=this.depthAttachment.get();u&&e.deleteRenderbuffer(u)}e.deleteFramebuffer(this.framebuffer)}}class Dp{constructor(e){var o,u;if(this.gl=e,this.clearColor=new Pu(this),this.clearDepth=new Mu(this),this.clearStencil=new Mp(this),this.colorMask=new Au(this),this.depthMask=new oo(this),this.stencilMask=new Iu(this),this.stencilFunc=new tm(this),this.stencilOp=new rm(this),this.stencilTest=new im(this),this.depthRange=new nm(this),this.depthTest=new Ap(this),this.depthFunc=new am(this),this.blend=new Ip(this),this.blendFunc=new Zl(this),this.blendColor=new Wl(this),this.blendEquation=new Hl(this),this.cullFace=new Eu(this),this.cullFaceSide=new so(this),this.frontFace=new js(this),this.program=new Vo(this),this.activeTexture=new en(this),this.viewport=new Ep(this),this.bindFramebuffer=new zp(this),this.bindRenderbuffer=new zu(this),this.bindTexture=new lo(this),this.bindVertexBuffer=new Xl(this),this.bindElementBuffer=new Kl(this),this.bindVertexArray=new Fs(this),this.pixelStoreUnpack=new Yl(this),this.pixelStoreUnpackPremultiplyAlpha=new Rp(this),this.pixelStoreUnpackFlipY=new qo(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Bn(e)){this.HALF_FLOAT=e.HALF_FLOAT;const d=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(o=e.RGBA16F)!==null&&o!==void 0?o:d?.RGBA16F_EXT,this.RGB16F=(u=e.RGB16F)!==null&&u!==void 0?u:d?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const d=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=d?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,o){return new Pp(this,e,o)}createVertexBuffer(e,o,u){return new na(this,e,o,u)}createRenderbuffer(e,o,u){const d=this.gl,y=d.createRenderbuffer();return this.bindRenderbuffer.set(y),d.renderbufferStorage(d.RENDERBUFFER,e,o,u),this.bindRenderbuffer.set(null),y}createFramebuffer(e,o,u,d){return new om(this,e,o,u,d)}clear({color:e,depth:o,stencil:u}){const d=this.gl;let y=0;e&&(y|=d.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(y|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),u!==void 0&&(y|=d.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),d.clear(y)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){l.bH(e.blendFunction,fr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Bn(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var o;return Bn(this.gl)?this.gl.deleteVertexArray(e):(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let La;function jp(g,e,o,u,d){const y=g.context,x=g.transform,S=y.gl,k=g.useProgram("collisionBox"),A=[];let E=0,L=0;for(let Y=0;Y<u.length;Y++){const Q=u[Y],ie=e.getTile(Q).getBucket(o);if(!ie)continue;const ee=d?ie.textCollisionBox:ie.iconCollisionBox,oe=ie.collisionCircleArray;oe.length>0&&(A.push({circleArray:oe,circleOffset:L,coord:Q}),E+=oe.length/4,L=E),ee&&k.draw(y,S.LINES,yt.disabled,Gt.disabled,g.colorModeForRenderPass(),pt.disabled,Vl(g.transform),g.style.map.terrain&&g.style.map.terrain.getTerrainData(Q),x.getProjectionData({overscaledTileID:Q,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),o.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,null,g.transform.zoom,null,null,ee.collisionVertexBuffer)}if(!d||!A.length)return;const R=g.useProgram("collisionCircle"),F=new l.b$;F.resize(4*E),F._trim();let U=0;for(const Y of A)for(let Q=0;Q<Y.circleArray.length/4;Q++){const ie=4*Q,ee=Y.circleArray[ie+0],oe=Y.circleArray[ie+1],le=Y.circleArray[ie+2],te=Y.circleArray[ie+3];F.emplace(U++,ee,oe,le,te,0),F.emplace(U++,ee,oe,le,te,1),F.emplace(U++,ee,oe,le,te,2),F.emplace(U++,ee,oe,le,te,3)}(!La||La.length<2*E)&&(La=(function(Y){const Q=2*Y,ie=new l.c1;ie.resize(Q),ie._trim();for(let ee=0;ee<Q;ee++){const oe=6*ee;ie.uint16[oe+0]=4*ee+0,ie.uint16[oe+1]=4*ee+1,ie.uint16[oe+2]=4*ee+2,ie.uint16[oe+3]=4*ee+2,ie.uint16[oe+4]=4*ee+3,ie.uint16[oe+5]=4*ee+0}return ie})(E));const K=y.createIndexBuffer(La,!0),X=y.createVertexBuffer(F,l.c0.members,!0);for(const Y of A){const Q=Yf(g.transform);R.draw(y,S.TRIANGLES,yt.disabled,Gt.disabled,g.colorModeForRenderPass(),pt.disabled,Q,g.style.map.terrain&&g.style.map.terrain.getTerrainData(Y.coord),null,o.id,X,K,l.aM.simpleSegment(0,2*Y.circleOffset,Y.circleArray.length,Y.circleArray.length/2),null,g.transform.zoom,null,null,null)}X.destroy(),K.destroy()}const sm=l.ag(new Float32Array(16));function Fp(g,e,o,u,d,y){const{horizontalAlign:x,verticalAlign:S}=l.aH(g);return new l.P((-(x-.5)*e/d+u[0])*y,(-(S-.5)*o/d+u[1])*y)}function lm(g,e,o,u,d,y){const x=e.tileAnchorPoint.add(new l.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let S=u.mult(y);o||(S=S.rotate(-d));const k=x.add(S);return Dr(k.x,k.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(o){const S=ni(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(g),k=Math.atan(S.y/S.x)+(S.x<0?Math.PI:0);return g.add(u.rotate(k))}return g.add(u)}function Lu(g,e,o,u,d,y,x,S,k,A,E,L){const R=g.text.placedSymbolArray,F=g.text.dynamicLayoutVertexArray,U=g.icon.dynamicLayoutVertexArray,K={};F.clear();for(let X=0;X<R.length;X++){const Y=R.get(X),Q=Y.hidden||!Y.crossTileID||g.allowVerticalPlacement&&!Y.placedOrientation?null:u[Y.crossTileID];if(Q){const ie=new l.P(Y.anchorX,Y.anchorY),ee={getElevation:L,width:d.width,height:d.height,pitchedLabelPlaneMatrix:y,pitchWithMap:o,transform:d,tileAnchorPoint:ie,translation:A,unwrappedTileID:E},oe=o?Ma(ie.x,ie.y,ee):ni(ie.x,ie.y,ee),le=Oe(d.cameraToCenterDistance,oe.signedDistanceFromCamera);let te=l.ap(g.textSizeData,S,Y)*le/l.aB;o&&(te*=g.tilePixelRatio/x);const{width:de,height:Ce,anchor:be,textOffset:xe,textBoxScale:ke}=Q,Fe=Fp(be,de,Ce,xe,ke,te),$e=d.getPitchedTextCorrection(ie.x+A[0],ie.y+A[1],E),Le=lm(oe.point,ee,e,Fe,-d.bearingInRadians,$e),Qe=g.allowVerticalPlacement&&Y.placedOrientation===l.ao.vertical?Math.PI/2:0;for(let Tt=0;Tt<Y.numGlyphs;Tt++)l.av(F,Le,Qe);k&&Y.associatedIconIndex>=0&&(K[Y.associatedIconIndex]={shiftedAnchor:Le,angle:Qe})}else On(Y.numGlyphs,F)}if(k){U.clear();const X=g.icon.placedSymbolArray;for(let Y=0;Y<X.length;Y++){const Q=X.get(Y);if(Q.hidden)On(Q.numGlyphs,U);else{const ie=K[Y];if(ie)for(let ee=0;ee<Q.numGlyphs;ee++)l.av(U,ie.shiftedAnchor,ie.angle);else On(Q.numGlyphs,U)}}g.icon.dynamicLayoutVertexBuffer.updateData(U)}g.text.dynamicLayoutVertexBuffer.updateData(F)}function Jl(g,e,o){return o.iconsInText&&e?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function Bs(g,e,o,u,d,y,x,S,k,A,E,L,R){const F=g.context,U=F.gl,K=g.transform,X=S==="map",Y=k==="map",Q=S!=="viewport"&&o.layout.get("symbol-placement")!=="point",ie=X&&!Y&&!Q,ee=!o.layout.get("symbol-sort-key").isConstant();let oe=!1;const le=g.getDepthModeForSublayer(0,yt.ReadOnly),te=o._unevaluatedLayout.hasValue("text-variable-anchor")||o._unevaluatedLayout.hasValue("text-variable-anchor-offset"),de=[],Ce=K.getCircleRadiusCorrection();for(const be of u){const xe=e.getTile(be),ke=xe.getBucket(o);if(!ke)continue;const Fe=d?ke.text:ke.icon;if(!Fe||!Fe.segments.get().length||!Fe.hasVisibleVertices)continue;const $e=Fe.programConfigurations.get(o.id),Le=d||ke.sdfIcons,Qe=d?ke.textSizeData:ke.iconSizeData,Tt=Y||K.pitch!==0,Kt=g.useProgram(Jl(Le,d,ke),$e),nr=l.an(Qe,K.zoom),rr=g.style.map.terrain&&g.style.map.terrain.getTerrainData(be);let _r,Sr,xt,ar,Fr=[0,0],Gr=null;if(d)Sr=xe.glyphAtlasTexture,xt=U.LINEAR,_r=xe.glyphAtlasTexture.size,ke.iconsInText&&(Fr=xe.imageAtlasTexture.size,Gr=xe.imageAtlasTexture,ar=Tt||g.options.rotating||g.options.zooming||Qe.kind==="composite"||Qe.kind==="camera"?U.LINEAR:U.NEAREST);else{const Or=o.layout.get("icon-size").constantOr(0)!==1||ke.iconsNeedLinear;Sr=xe.imageAtlasTexture,xt=Le||g.options.rotating||g.options.zooming||Or||Tt?U.LINEAR:U.NEAREST,_r=xe.imageAtlasTexture.size}const Yr=l.aC(xe,1,g.transform.zoom),Si=zr(X,g.transform,Yr),_n=l.L();l.aq(_n,Si);const ja=zt(Y,X,g.transform,Yr),Fa=l.aD(K,xe,y,x),rs=K.getProjectionData({overscaledTileID:be,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),is=te&&ke.hasTextData(),go=o.layout.get("icon-text-fit")!=="none"&&is&&ke.hasIconData();if(Q){const Or=g.style.map.terrain?(nn,Br)=>g.style.map.terrain.getElevation(be,nn,Br):null,Zr=o.layout.get("text-rotation-alignment")==="map";wr(ke,g,d,Si,_n,Y,A,Zr,be.toUnwrapped(),K.width,K.height,Fa,Or)}const yo=d&&te||go,Oi=Q||yo?sm:Y?Si:g.transform.clipSpaceToPixelsMatrix,vn=Le&&o.paint.get(d?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ki;ki=Le?ke.iconsInText?em(Qe.kind,nr,ie,Y,Q,yo,g,Oi,ja,Fa,_r,Fr,Ce):Sp(Qe.kind,nr,ie,Y,Q,yo,g,Oi,ja,Fa,d,_r,0,Ce):Ds(Qe.kind,nr,ie,Y,Q,yo,g,Oi,ja,Fa,d,_r,Ce);const Oa={program:Kt,buffers:Fe,uniformValues:ki,projectionData:rs,atlasTexture:Sr,atlasTextureIcon:Gr,atlasInterpolation:xt,atlasInterpolationIcon:ar,isSDF:Le,hasHalo:vn};if(ee&&ke.canOverlap){oe=!0;const Or=Fe.segments.get();for(const Zr of Or)de.push({segments:new l.aM([Zr]),sortKey:Zr.sortKey,state:Oa,terrainData:rr})}else de.push({segments:Fe.segments,sortKey:0,state:Oa,terrainData:rr})}oe&&de.sort(((be,xe)=>be.sortKey-xe.sortKey));for(const be of de){const xe=be.state;if(F.activeTexture.set(U.TEXTURE0),xe.atlasTexture.bind(xe.atlasInterpolation,U.CLAMP_TO_EDGE),xe.atlasTextureIcon&&(F.activeTexture.set(U.TEXTURE1),xe.atlasTextureIcon&&xe.atlasTextureIcon.bind(xe.atlasInterpolationIcon,U.CLAMP_TO_EDGE)),xe.isSDF){const ke=xe.uniformValues;xe.hasHalo&&(ke.u_is_halo=1,$s(xe.buffers,be.segments,o,g,xe.program,le,E,L,ke,xe.projectionData,be.terrainData)),ke.u_is_halo=0}$s(xe.buffers,be.segments,o,g,xe.program,le,E,L,xe.uniformValues,xe.projectionData,be.terrainData)}}function $s(g,e,o,u,d,y,x,S,k,A,E){const L=u.context;d.draw(L,L.gl.TRIANGLES,y,x,S,pt.backCCW,k,E,A,o.id,g.layoutVertexBuffer,g.indexBuffer,e,o.paint,u.transform.zoom,g.programConfigurations.get(o.id),g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer)}function Du(g,e,o,u,d){const y=g.context,x=y.gl,S=Gt.disabled,k=new fr([x.ONE,x.ONE],l.bf.transparent,[!0,!0,!0,!0]),A=e.getBucket(o);if(!A)return;const E=u.key;let L=o.heatmapFbos.get(E);L||(L=Ns(y,e.tileSize,e.tileSize),o.heatmapFbos.set(E,L)),y.bindFramebuffer.set(L.framebuffer),y.viewport.set([0,0,e.tileSize,e.tileSize]),y.clear({color:l.bf.transparent});const R=A.programConfigurations.get(o.id),F=g.useProgram("heatmap",R,!d),U=g.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),K=g.style.map.terrain.getTerrainData(u);F.draw(y,x.TRIANGLES,yt.disabled,S,k,pt.disabled,vp(e,g.transform.zoom,o.paint.get("heatmap-intensity"),1),K,U,o.id,A.layoutVertexBuffer,A.indexBuffer,A.segments,o.paint,g.transform.zoom,R)}function Op(g,e,o,u,d){const y=g.context,x=y.gl,S=g.transform;y.setColorMode(g.colorModeForRenderPass());const k=Us(y,e),A=o.key,E=e.heatmapFbos.get(A);if(!E)return;y.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,E.colorAttachment.get()),y.activeTexture.set(x.TEXTURE1),k.bind(x.LINEAR,x.CLAMP_TO_EDGE);const L=S.getProjectionData({overscaledTileID:o,applyTerrainMatrix:d,applyGlobeMatrix:!u});g.useProgram("heatmapTexture").draw(y,x.TRIANGLES,yt.disabled,Gt.disabled,g.colorModeForRenderPass(),pt.disabled,xu(g,e,0,1),null,L,e.id,g.rasterBoundsBuffer,g.quadTriangleIndexBuffer,g.rasterBoundsSegments,e.paint,S.zoom),E.destroy(),e.heatmapFbos.delete(A)}function Ns(g,e,o){var u,d;const y=g.gl,x=y.createTexture();y.bindTexture(y.TEXTURE_2D,x),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,y.CLAMP_TO_EDGE),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,y.LINEAR),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,y.LINEAR);const S=(u=g.HALF_FLOAT)!==null&&u!==void 0?u:y.UNSIGNED_BYTE,k=(d=g.RGBA16F)!==null&&d!==void 0?d:y.RGBA;y.texImage2D(y.TEXTURE_2D,0,k,e,o,0,y.RGBA,S,null);const A=g.createFramebuffer(e,o,!1,!1);return A.colorAttachment.set(x),A}function Us(g,e){return e.colorRampTexture||(e.colorRampTexture=new l.T(g,e.colorRamp,g.gl.RGBA)),e.colorRampTexture}function Vs(g,e,o,u,d){if(!o||!u||!u.imageAtlas)return;const y=u.imageAtlas.patternPositions;let x=y[o.to.toString()],S=y[o.from.toString()];if(!x&&S&&(x=S),!S&&x&&(S=x),!x||!S){const k=d.getPaintProperty(e);x=y[k],S=y[k]}x&&S&&g.setConstantPatternPositions(x,S)}function Ql(g,e,o,u,d,y,x,S){const k=g.context.gl,A="fill-pattern",E=o.paint.get(A),L=E&&E.constantOr(1),R=o.getCrossfadeParameters();let F,U,K,X,Y;const Q=g.transform,ie=o.paint.get("fill-translate"),ee=o.paint.get("fill-translate-anchor");x?(U=L&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=k.LINES):(U=L?"fillPattern":"fill",F=k.TRIANGLES);const oe=E.constantOr(null);for(const le of u){const te=e.getTile(le);if(L&&!te.patternsLoaded())continue;const de=te.getBucket(o);if(!de)continue;const Ce=de.programConfigurations.get(o.id),be=g.useProgram(U,Ce),xe=g.style.map.terrain&&g.style.map.terrain.getTerrainData(le);L&&(g.context.activeTexture.set(k.TEXTURE0),te.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),Ce.updatePaintBuffers(R)),Vs(Ce,A,oe,te,o);const ke=Q.getProjectionData({overscaledTileID:le,applyGlobeMatrix:!S,applyTerrainMatrix:!0}),Fe=l.aD(Q,te,ie,ee);if(x){X=de.indexBuffer2,Y=de.segments2;const Le=[k.drawingBufferWidth,k.drawingBufferHeight];K=U==="fillOutlinePattern"&&L?Rs(g,R,te,Le,Fe):zs(Le,Fe)}else X=de.indexBuffer,Y=de.segments,K=L?Ul(g,R,te,Fe):{u_fill_translate:Fe};const $e=g.stencilModeForClipping(le);be.draw(g.context,F,d,$e,y,pt.backCCW,K,xe,ke,o.id,de.layoutVertexBuffer,X,Y,o.paint,g.transform.zoom,Ce)}}function ju(g,e,o,u,d,y,x,S){const k=g.context,A=k.gl,E="fill-extrusion-pattern",L=o.paint.get(E),R=L.constantOr(1),F=o.getCrossfadeParameters(),U=o.paint.get("fill-extrusion-opacity"),K=L.constantOr(null),X=g.transform;for(const Y of u){const Q=e.getTile(Y),ie=Q.getBucket(o);if(!ie)continue;const ee=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Y),oe=ie.programConfigurations.get(o.id),le=g.useProgram(R?"fillExtrusionPattern":"fillExtrusion",oe);R&&(g.context.activeTexture.set(A.TEXTURE0),Q.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),oe.updatePaintBuffers(F));const te=X.getProjectionData({overscaledTileID:Y,applyGlobeMatrix:!S,applyTerrainMatrix:!0});Vs(oe,E,K,Q,o);const de=l.aD(X,Q,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Ce=o.paint.get("fill-extrusion-vertical-gradient"),be=R?Xf(g,Ce,U,de,Y,F,Q):pn(g,Ce,U,de);le.draw(k,k.gl.TRIANGLES,d,y,x,pt.backCCW,be,ee,te,o.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,o.paint,g.transform.zoom,oe,g.style.map.terrain&&ie.centroidVertexBuffer)}}function co(g,e,o,u,d,y,x,S,k){var A;const E=g.style.projection,L=g.context,R=g.transform,F=L.gl,U=[`#define NUM_ILLUMINATION_SOURCES ${o.paint.get("hillshade-highlight-color").values.length}`],K=g.useProgram("hillshade",null,!1,U),X=!g.options.moving;for(const Y of u){const Q=e.getTile(Y),ie=Q.fbo;if(!ie)continue;const ee=E.getMeshFromTileID(L,Y.canonical,S,!0,"raster"),oe=(A=g.style.map.terrain)===null||A===void 0?void 0:A.getTerrainData(Y);L.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,ie.colorAttachment.get());const le=R.getProjectionData({overscaledTileID:Y,aligned:X,applyGlobeMatrix:!k,applyTerrainMatrix:!0});K.draw(L,F.TRIANGLES,y,d[Y.overscaledZ],x,pt.backCCW,Jf(g,Q,o),oe,le,o.id,ee.vertexBuffer,ee.indexBuffer,ee.segments)}}function Fu(g,e,o,u,d,y,x,S,k){var A;const E=g.style.projection,L=g.context,R=g.transform,F=L.gl,U=g.useProgram("colorRelief"),K=!g.options.moving;let X=!0,Y=0;for(const Q of u){const ie=e.getTile(Q),ee=ie.dem;if(X){const be=F.getParameter(F.MAX_TEXTURE_SIZE),{elevationTexture:xe,colorTexture:ke}=o.getColorRampTextures(L,be,ee.getUnpackVector());L.activeTexture.set(F.TEXTURE1),xe.bind(F.NEAREST,F.CLAMP_TO_EDGE),L.activeTexture.set(F.TEXTURE4),ke.bind(F.LINEAR,F.CLAMP_TO_EDGE),X=!1,Y=xe.size[0]}if(!ee||!ee.data)continue;const oe=ee.stride,le=ee.getPixels();if(L.activeTexture.set(F.TEXTURE0),L.pixelStoreUnpackPremultiplyAlpha.set(!1),ie.demTexture=ie.demTexture||g.getTileTexture(oe),ie.demTexture){const be=ie.demTexture;be.update(le,{premultiply:!1}),be.bind(F.LINEAR,F.CLAMP_TO_EDGE)}else ie.demTexture=new l.T(L,le,F.RGBA,{premultiply:!1}),ie.demTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const te=E.getMeshFromTileID(L,Q.canonical,S,!0,"raster"),de=(A=g.style.map.terrain)===null||A===void 0?void 0:A.getTerrainData(Q),Ce=R.getProjectionData({overscaledTileID:Q,aligned:K,applyGlobeMatrix:!k,applyTerrainMatrix:!0});U.draw(L,F.TRIANGLES,y,d[Q.overscaledZ],x,pt.backCCW,xp(o,ie.dem,Y),de,Ce,o.id,te.vertexBuffer,te.indexBuffer,te.segments)}}const ec=[new l.P(0,0),new l.P(l.$,0),new l.P(l.$,l.$),new l.P(0,l.$)];function uo(g,e,o,u,d,y,x,S,k=!1,A=!1){const E=u[u.length-1].overscaledZ,L=g.context,R=L.gl,F=g.useProgram("raster"),U=g.transform,K=g.style.projection,X=g.colorModeForRenderPass(),Y=!g.options.moving;for(const Q of u){const ie=g.getDepthModeForSublayer(Q.overscaledZ-E,o.paint.get("raster-opacity")===1?yt.ReadWrite:yt.ReadOnly,R.LESS),ee=e.getTile(Q);ee.registerFadeDuration(o.paint.get("raster-fade-duration"));const oe=e.findLoadedParent(Q,0),le=e.findLoadedSibling(Q),te=Ou(ee,oe||le||null,e,o,g.transform,g.style.map.terrain);let de,Ce;const be=o.paint.get("raster-resampling")==="nearest"?R.NEAREST:R.LINEAR;L.activeTexture.set(R.TEXTURE0),ee.texture.bind(be,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),L.activeTexture.set(R.TEXTURE1),oe?(oe.texture.bind(be,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),de=Math.pow(2,oe.tileID.overscaledZ-ee.tileID.overscaledZ),Ce=[ee.tileID.canonical.x*de%1,ee.tileID.canonical.y*de%1]):ee.texture.bind(be,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST),ee.texture.useMipmap&&L.extTextureFilterAnisotropic&&g.transform.pitch>20&&R.texParameterf(R.TEXTURE_2D,L.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,L.extTextureFilterAnisotropicMax);const xe=g.style.map.terrain&&g.style.map.terrain.getTerrainData(Q),ke=U.getProjectionData({overscaledTileID:Q,aligned:Y,applyGlobeMatrix:!A,applyTerrainMatrix:!0}),Fe=Ls(Ce||[0,0],de||1,te,o,S),$e=K.getMeshFromTileID(L,Q.canonical,y,x,"raster");F.draw(L,R.TRIANGLES,ie,d?d[Q.overscaledZ]:Gt.disabled,X,k?pt.frontCCW:pt.backCCW,Fe,xe,ke,o.id,$e.vertexBuffer,$e.indexBuffer,$e.segments)}}function Ou(g,e,o,u,d,y){const x=u.paint.get("raster-fade-duration");if(!y&&x>0){const S=Z.now(),k=(S-g.timeAdded)/x,A=e?(S-e.timeAdded)/x:-1,E=o.getSource(),L=tt(d,{tileSize:E.tileSize,roundZoom:E.roundZoom}),R=!e||Math.abs(e.tileID.overscaledZ-L)>Math.abs(g.tileID.overscaledZ-L),F=R&&g.refreshedUponExpiration?1:l.ah(R?k:1-A,0,1);return g.refreshedUponExpiration&&k>=1&&(g.refreshedUponExpiration=!1),e?{opacity:1,mix:1-F}:{opacity:F,mix:0}}return{opacity:1,mix:0}}const Bp=new l.bf(1,0,0,1),$p=new l.bf(0,1,0,1),tc=new l.bf(0,0,1,1),Bu=new l.bf(1,0,1,1),cm=new l.bf(0,1,1,1);function $u(g,e,o,u){Un(g,0,e+o/2,g.transform.width,o,u)}function Tr(g,e,o,u){Un(g,e-o/2,0,o,g.transform.height,u)}function Un(g,e,o,u,d,y){const x=g.context,S=x.gl;S.enable(S.SCISSOR_TEST),S.scissor(e*g.pixelRatio,o*g.pixelRatio,u*g.pixelRatio,d*g.pixelRatio),x.clear({color:y}),S.disable(S.SCISSOR_TEST)}function tn(g,e,o){const u=g.context,d=u.gl,y=g.useProgram("debug"),x=yt.disabled,S=Gt.disabled,k=g.colorModeForRenderPass(),A="$debug",E=g.style.map.terrain&&g.style.map.terrain.getTerrainData(o);u.activeTexture.set(d.TEXTURE0);const L=e.getTileByID(o.key).latestRawTileData,R=Math.floor((L&&L.byteLength||0)/1024),F=e.getTile(o).tileSize,U=512/Math.min(F,512)*(o.overscaledZ/g.transform.zoom)*.5;let K=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(K+=` => ${o.overscaledZ}`),(function(Y,Q){Y.initDebugOverlayCanvas();const ie=Y.debugOverlayCanvas,ee=Y.context.gl,oe=Y.debugOverlayCanvas.getContext("2d");oe.clearRect(0,0,ie.width,ie.height),oe.shadowColor="white",oe.shadowBlur=2,oe.lineWidth=1.5,oe.strokeStyle="white",oe.textBaseline="top",oe.font="bold 36px Open Sans, sans-serif",oe.fillText(Q,5,5),oe.strokeText(Q,5,5),Y.debugOverlayTexture.update(ie),Y.debugOverlayTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE)})(g,`${K} ${R}kB`);const X=g.transform.getProjectionData({overscaledTileID:o,applyGlobeMatrix:!0,applyTerrainMatrix:!0});y.draw(u,d.TRIANGLES,x,S,fr.alphaBlended,pt.disabled,no(l.bf.transparent,U),null,X,A,g.debugBuffer,g.quadTriangleIndexBuffer,g.debugSegments),y.draw(u,d.LINE_STRIP,x,S,k,pt.disabled,no(l.bf.red),E,X,A,g.debugBuffer,g.tileBorderIndexBuffer,g.debugSegments)}function rc(g,e,o,u){const{isRenderingGlobe:d}=u,y=g.context,x=y.gl,S=g.transform,k=g.colorModeForRenderPass(),A=g.getDepthModeFor3D(),E=g.useProgram("terrain");y.bindFramebuffer.set(null),y.viewport.set([0,0,g.width,g.height]);for(const L of o){const R=e.getTerrainMesh(L.tileID),F=g.renderToTexture.getTexture(L),U=e.getTerrainData(L.tileID);y.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,F.texture);const K=e.getMeshFrameDelta(S.zoom),X=S.calculateFogMatrix(L.tileID.toUnwrapped()),Y=$l(K,X,g.style.sky,S.pitch,d),Q=S.getProjectionData({overscaledTileID:L.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});E.draw(y,x.TRIANGLES,A,Gt.disabled,k,pt.backCCW,Y,U,Q,"terrain",R.vertexBuffer,R.indexBuffer,R.segments)}}function qs(g,e){if(!e.mesh){const o=new l.aL;o.emplaceBack(-1,-1),o.emplaceBack(1,-1),o.emplaceBack(1,1),o.emplaceBack(-1,1);const u=new l.aN;u.emplaceBack(0,1,2),u.emplaceBack(0,2,3),e.mesh=new Ja(g.createVertexBuffer(o,za.members),g.createIndexBuffer(u),l.aM.simpleSegment(0,0,o.length,u.length))}return e.mesh}class Np{constructor(e,o){this.context=new Dp(e),this.transform=o,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.ag(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ct.maxUnderzooming+Ct.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Bo}resize(e,o,u){if(this.width=Math.floor(e*u),this.height=Math.floor(o*u),this.pixelRatio=u,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style._order)this.style._layers[d].resize()}setup(){const e=this.context,o=new l.aL;o.emplaceBack(0,0),o.emplaceBack(l.$,0),o.emplaceBack(0,l.$),o.emplaceBack(l.$,l.$),this.tileExtentBuffer=e.createVertexBuffer(o,za.members),this.tileExtentSegments=l.aM.simpleSegment(0,0,4,2);const u=new l.aL;u.emplaceBack(0,0),u.emplaceBack(l.$,0),u.emplaceBack(0,l.$),u.emplaceBack(l.$,l.$),this.debugBuffer=e.createVertexBuffer(u,za.members),this.debugSegments=l.aM.simpleSegment(0,0,4,5);const d=new l.c6;d.emplaceBack(0,0,0,0),d.emplaceBack(l.$,0,l.$,0),d.emplaceBack(0,l.$,0,l.$),d.emplaceBack(l.$,l.$,l.$,l.$),this.rasterBoundsBuffer=e.createVertexBuffer(d,Wf.members),this.rasterBoundsSegments=l.aM.simpleSegment(0,0,4,2);const y=new l.aL;y.emplaceBack(0,0),y.emplaceBack(l.$,0),y.emplaceBack(0,l.$),y.emplaceBack(l.$,l.$),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(y,za.members),this.rasterBoundsSegmentsPosOnly=l.aM.simpleSegment(0,0,4,5);const x=new l.aL;x.emplaceBack(0,0),x.emplaceBack(1,0),x.emplaceBack(0,1),x.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(x,za.members),this.viewportSegments=l.aM.simpleSegment(0,0,4,2);const S=new l.c7;S.emplaceBack(0),S.emplaceBack(1),S.emplaceBack(3),S.emplaceBack(2),S.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(S);const k=new l.aN;k.emplaceBack(1,0,2),k.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(k);const A=this.context.gl;this.stencilClearMode=new Gt({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.tileExtentMesh=new Ja(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,o=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const u=l.L();l.bY(u,0,this.width,this.height,0,0,1),l.N(u,u,[o.drawingBufferWidth,o.drawingBufferHeight,0]);const d={mainMatrix:u,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:u};this.useProgram("clippingMask",null,!0).draw(e,o.TRIANGLES,yt.disabled,this.stencilClearMode,fr.disabled,pt.disabled,null,null,d,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,o,u){if(this.currentStencilSource===e.source||!e.isTileClipped()||!o||!o.length)return;this.currentStencilSource=e.source,this.nextStencilID+o.length>256&&this.clearStencil();const d=this.context;d.setColorMode(fr.disabled),d.setDepthMode(yt.disabled);const y={};for(const x of o)y[x.key]=this.nextStencilID++;this._renderTileMasks(y,o,u,!0),this._renderTileMasks(y,o,u,!1),this._tileClippingMaskIDs=y}_renderTileMasks(e,o,u,d){const y=this.context,x=y.gl,S=this.style.projection,k=this.transform,A=this.useProgram("clippingMask");for(const E of o){const L=e[E.key],R=this.style.map.terrain&&this.style.map.terrain.getTerrainData(E),F=S.getMeshFromTileID(this.context,E.canonical,d,!0,"stencil"),U=k.getProjectionData({overscaledTileID:E,applyGlobeMatrix:!u,applyTerrainMatrix:!0});A.draw(y,x.TRIANGLES,yt.disabled,new Gt({func:x.ALWAYS,mask:0},L,255,x.KEEP,x.KEEP,x.REPLACE),fr.disabled,u?pt.disabled:pt.backCCW,null,R,U,"$clipping",F.vertexBuffer,F.indexBuffer,F.segments)}}_renderTilesDepthBuffer(){const e=this.context,o=e.gl,u=this.style.projection,d=this.transform,y=this.useProgram("depth"),x=this.getDepthModeFor3D(),S=ge(d,{tileSize:d.tileSize});for(const k of S){const A=this.style.map.terrain&&this.style.map.terrain.getTerrainData(k),E=u.getMeshFromTileID(this.context,k.canonical,!0,!0,"raster"),L=d.getProjectionData({overscaledTileID:k,applyGlobeMatrix:!0,applyTerrainMatrix:!0});y.draw(e,o.TRIANGLES,x,Gt.disabled,fr.disabled,pt.backCCW,null,A,L,"$clipping",E.vertexBuffer,E.indexBuffer,E.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,o=this.context.gl;return new Gt({func:o.NOTEQUAL,mask:255},e,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(e){const o=this.context.gl;return new Gt({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,o.KEEP,o.KEEP,o.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const o=this.context.gl,u=e.sort(((x,S)=>S.overscaledZ-x.overscaledZ)),d=u[u.length-1].overscaledZ,y=u[0].overscaledZ-d+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const x={};for(let S=0;S<y;S++)x[S+d]=new Gt({func:o.GEQUAL,mask:255},S+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=y,[x,u]}return[{[d]:Gt.disabled},u]}stencilConfigForOverlapTwoPass(e){const o=this.context.gl,u=e.sort(((x,S)=>S.overscaledZ-x.overscaledZ)),d=u[u.length-1].overscaledZ,y=u[0].overscaledZ-d+1;if(this.clearStencil(),y>1){const x={},S={};for(let k=0;k<y;k++)x[k+d]=new Gt({func:o.GREATER,mask:255},y+1+k,255,o.KEEP,o.KEEP,o.REPLACE),S[k+d]=new Gt({func:o.GREATER,mask:255},1+k,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID=2*y+1,[x,S,u]}return this.nextStencilID=3,[{[d]:new Gt({func:o.GREATER,mask:255},2,255,o.KEEP,o.KEEP,o.REPLACE)},{[d]:new Gt({func:o.GREATER,mask:255},1,255,o.KEEP,o.KEEP,o.REPLACE)},u]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new fr([e.CONSTANT_COLOR,e.ONE],new l.bf(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?fr.unblended:fr.alphaBlended}getDepthModeForSublayer(e,o,u){if(!this.opaquePassEnabledForLayer())return yt.disabled;const d=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new yt(u||this.context.gl.LEQUAL,o,[d,d])}getDepthModeFor3D(){return new yt(this.context.gl.LEQUAL,yt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,o){var u,d;this.style=e,this.options=o,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(Z.now()),this.imageManager.beginFrame();const y=this.style._order,x=this.style.sourceCaches,S={},k={},A={},E={isRenderingToTexture:!1,isRenderingGlobe:((u=e.projection)===null||u===void 0?void 0:u.transitionState)>0};for(const R in x){const F=x[R];F.used&&F.prepare(this.context),S[R]=F.getVisibleCoordinates(!1),k[R]=S[R].slice().reverse(),A[R]=F.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let R=0;R<y.length;R++)if(this.style._layers[y[R]].is3D()){this.opaquePassCutoff=R;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const R of y){const F=this.style._layers[R];if(!F.hasOffscreenPass()||F.isHidden(this.transform.zoom))continue;const U=k[F.source];(F.type==="custom"||U.length)&&this.renderLayer(this,x[F.source],F,U,E)}if((d=this.style.projection)===null||d===void 0||d.updateGPUdependent({context:this.context,useProgram:R=>this.useProgram(R)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:o.showOverdrawInspector?l.bf.black:l.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(R,F){const U=R.context,K=U.gl,X=((le,te,de)=>{const Ce=Math.cos(te.rollInRadians),be=Math.sin(te.rollInRadians),xe=ce(te),ke=te.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:le.properties.get("sky-color"),u_horizon_color:le.properties.get("horizon-color"),u_horizon:[(te.width/2-xe*be)*de,(te.height/2+xe*Ce)*de],u_horizon_normal:[-be,Ce],u_sky_horizon_blend:le.properties.get("sky-horizon-blend")*te.height/2*de,u_sky_blend:ke}})(F,R.style.map.transform,R.pixelRatio),Y=new yt(K.LEQUAL,yt.ReadWrite,[0,1]),Q=Gt.disabled,ie=R.colorModeForRenderPass(),ee=R.useProgram("sky"),oe=qs(U,F);ee.draw(U,K.TRIANGLES,Y,Q,ie,pt.disabled,X,null,void 0,"sky",oe.vertexBuffer,oe.indexBuffer,oe.segments)})(this,this.style.sky),this._showOverdrawInspector=o.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){const R=this.style._layers[y[this.currentLayer]],F=x[R.source],U=S[R.source];this._renderTileClippingMasks(R,U,!1),this.renderLayer(this,F,R,U,E)}this.renderPass="translucent";let L=!1;for(this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){const R=this.style._layers[y[this.currentLayer]],F=x[R.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(R,E))continue;this.opaquePassEnabledForLayer()||L||(L=!0,E.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const U=(R.type==="symbol"?A:k)[R.source];this._renderTileClippingMasks(R,S[R.source],!!this.renderToTexture),this.renderLayer(this,F,R,U,E)}if(E.isRenderingGlobe&&(function(R,F,U){const K=R.context,X=K.gl,Y=R.useProgram("atmosphere"),Q=new yt(X.LEQUAL,yt.ReadOnly,[0,1]),ie=R.transform,ee=(function(ke,Fe){const $e=ke.properties.get("position"),Le=[-$e.x,-$e.y,-$e.z],Qe=l.ag(new Float64Array(16));return ke.properties.get("anchor")==="map"&&(l.b6(Qe,Qe,Fe.rollInRadians),l.b7(Qe,Qe,-Fe.pitchInRadians),l.b6(Qe,Qe,Fe.bearingInRadians),l.b7(Qe,Qe,Fe.center.lat*Math.PI/180),l.bz(Qe,Qe,-Fe.center.lng*Math.PI/180)),l.c5(Le,Le,Qe),Le})(U,R.transform),oe=ie.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),le=F.properties.get("atmosphere-blend")*oe.projectionTransition;if(le===0)return;const te=No(ie.worldSize,ie.center.lat),de=ie.inverseProjectionMatrix,Ce=new Float64Array(4);Ce[3]=1,l.aw(Ce,Ce,ie.modelViewProjectionMatrix),Ce[0]/=Ce[3],Ce[1]/=Ce[3],Ce[2]/=Ce[3],Ce[3]=1,l.aw(Ce,Ce,de),Ce[0]/=Ce[3],Ce[1]/=Ce[3],Ce[2]/=Ce[3],Ce[3]=1;const be=((ke,Fe,$e,Le,Qe)=>({u_sun_pos:ke,u_atmosphere_blend:Fe,u_globe_position:$e,u_globe_radius:Le,u_inv_proj_matrix:Qe}))(ee,le,[Ce[0],Ce[1],Ce[2]],te,de),xe=qs(K,F);Y.draw(K,X.TRIANGLES,Q,Gt.disabled,fr.alphaBlended,pt.disabled,be,null,null,"atmosphere",xe.vertexBuffer,xe.indexBuffer,xe.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const R=(function(F,U){let K=null;const X=Object.values(F._layers).flatMap((ee=>ee.source&&!ee.isHidden(U)?[F.sourceCaches[ee.source]]:[])),Y=X.filter((ee=>ee.getSource().type==="vector")),Q=X.filter((ee=>ee.getSource().type!=="vector")),ie=ee=>{(!K||K.getSource().maxzoom<ee.getSource().maxzoom)&&(K=ee)};return Y.forEach((ee=>ie(ee))),K||Q.forEach((ee=>ie(ee))),K})(this.style,this.transform.zoom);R&&(function(F,U,K){for(let X=0;X<K.length;X++)tn(F,U,K[X])})(this,R,R.getVisibleCoordinates())}this.options.showPadding&&(function(R){const F=R.transform.padding;$u(R,R.transform.height-(F.top||0),3,Bp),$u(R,F.bottom||0,3,$p),Tr(R,F.left||0,3,tc),Tr(R,R.transform.width-(F.right||0),3,Bu);const U=R.transform.centerPoint;(function(K,X,Y,Q){Un(K,X-1,Y-10,2,20,Q),Un(K,X-10,Y-1,20,2,Q)})(R,U.x,R.transform.height-U.y,cm)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const o=this.terrainFacilitator.matrix,u=this.transform.modelViewProjectionMatrix;let d=this.terrainFacilitator.dirty;d||(d=e?!l.c8(o,u):!l.c9(o,u)),d||(d=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),d&&(l.ca(o,u),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(y,x){const S=y.context,k=S.gl,A=y.transform,E=fr.unblended,L=new yt(k.LEQUAL,yt.ReadWrite,[0,1]),R=x.sourceCache.getRenderableTiles(),F=y.useProgram("terrainDepth");S.bindFramebuffer.set(x.getFramebuffer("depth").framebuffer),S.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),S.clear({color:l.bf.transparent,depth:1});for(const U of R){const K=x.getTerrainMesh(U.tileID),X=x.getTerrainData(U.tileID),Y=A.getProjectionData({overscaledTileID:U.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),Q={u_ele_delta:x.getMeshFrameDelta(A.zoom)};F.draw(S,k.TRIANGLES,L,Gt.disabled,E,pt.backCCW,Q,X,Y,"terrain",K.vertexBuffer,K.indexBuffer,K.segments)}S.bindFramebuffer.set(null),S.viewport.set([0,0,y.width,y.height])})(this,this.style.map.terrain),(function(y,x){const S=y.context,k=S.gl,A=y.transform,E=fr.unblended,L=new yt(k.LEQUAL,yt.ReadWrite,[0,1]),R=x.getCoordsTexture(),F=x.sourceCache.getRenderableTiles(),U=y.useProgram("terrainCoords");S.bindFramebuffer.set(x.getFramebuffer("coords").framebuffer),S.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),S.clear({color:l.bf.transparent,depth:1}),x.coordsIndex=[];for(const K of F){const X=x.getTerrainMesh(K.tileID),Y=x.getTerrainData(K.tileID);S.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,R.texture);const Q={u_terrain_coords_id:(255-x.coordsIndex.length)/255,u_texture:0,u_ele_delta:x.getMeshFrameDelta(A.zoom)},ie=A.getProjectionData({overscaledTileID:K.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});U.draw(S,k.TRIANGLES,L,Gt.disabled,E,pt.backCCW,Q,Y,ie,"terrain",X.vertexBuffer,X.indexBuffer,X.segments),x.coordsIndex.push(K.tileID.key)}S.bindFramebuffer.set(null),S.viewport.set([0,0,y.width,y.height])})(this,this.style.map.terrain))}renderLayer(e,o,u,d,y){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="custom"||(d||[]).length)&&(this.id=u.id,l.cb(u)?(function(x,S,k,A,E,L){if(x.renderPass!=="translucent")return;const{isRenderingToTexture:R}=L,F=Gt.disabled,U=x.colorModeForRenderPass();(k._unevaluatedLayout.hasValue("text-variable-anchor")||k._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(K,X,Y,Q,ie,ee,oe,le,te){const de=X.transform,Ce=X.style.map.terrain,be=ie==="map",xe=ee==="map";for(const ke of K){const Fe=Q.getTile(ke),$e=Fe.getBucket(Y);if(!$e||!$e.text||!$e.text.segments.get().length)continue;const Le=l.an($e.textSizeData,de.zoom),Qe=l.aC(Fe,1,X.transform.zoom),Tt=zr(be,X.transform,Qe),Kt=Y.layout.get("icon-text-fit")!=="none"&&$e.hasIconData();if(Le){const nr=Math.pow(2,de.zoom-Fe.tileID.overscaledZ),rr=Ce?(_r,Sr)=>Ce.getElevation(ke,_r,Sr):null;Lu($e,be,xe,te,de,Tt,nr,Le,Kt,l.aD(de,Fe,oe,le),ke.toUnwrapped(),rr)}}})(A,x,k,S,k.layout.get("text-rotation-alignment"),k.layout.get("text-pitch-alignment"),k.paint.get("text-translate"),k.paint.get("text-translate-anchor"),E),k.paint.get("icon-opacity").constantOr(1)!==0&&Bs(x,S,k,A,!1,k.paint.get("icon-translate"),k.paint.get("icon-translate-anchor"),k.layout.get("icon-rotation-alignment"),k.layout.get("icon-pitch-alignment"),k.layout.get("icon-keep-upright"),F,U,R),k.paint.get("text-opacity").constantOr(1)!==0&&Bs(x,S,k,A,!0,k.paint.get("text-translate"),k.paint.get("text-translate-anchor"),k.layout.get("text-rotation-alignment"),k.layout.get("text-pitch-alignment"),k.layout.get("text-keep-upright"),F,U,R),S.map.showCollisionBoxes&&(jp(x,S,k,A,!0),jp(x,S,k,A,!1))})(e,o,u,d,this.style.placement.variableOffsets,y):l.cc(u)?(function(x,S,k,A,E){if(x.renderPass!=="translucent")return;const{isRenderingToTexture:L}=E,R=k.paint.get("circle-opacity"),F=k.paint.get("circle-stroke-width"),U=k.paint.get("circle-stroke-opacity"),K=!k.layout.get("circle-sort-key").isConstant();if(R.constantOr(1)===0&&(F.constantOr(1)===0||U.constantOr(1)===0))return;const X=x.context,Y=X.gl,Q=x.transform,ie=x.getDepthModeForSublayer(0,yt.ReadOnly),ee=Gt.disabled,oe=x.colorModeForRenderPass(),le=[],te=Q.getCircleRadiusCorrection();for(let de=0;de<A.length;de++){const Ce=A[de],be=S.getTile(Ce),xe=be.getBucket(k);if(!xe)continue;const ke=k.paint.get("circle-translate"),Fe=k.paint.get("circle-translate-anchor"),$e=l.aD(Q,be,ke,Fe),Le=xe.programConfigurations.get(k.id),Qe=x.useProgram("circle",Le),Tt=xe.layoutVertexBuffer,Kt=xe.indexBuffer,nr=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Ce),rr={programConfiguration:Le,program:Qe,layoutVertexBuffer:Tt,indexBuffer:Kt,uniformValues:Kf(x,be,k,$e,te),terrainData:nr,projectionData:Q.getProjectionData({overscaledTileID:Ce,applyGlobeMatrix:!L,applyTerrainMatrix:!0})};if(K){const _r=xe.segments.get();for(const Sr of _r)le.push({segments:new l.aM([Sr]),sortKey:Sr.sortKey,state:rr})}else le.push({segments:xe.segments,sortKey:0,state:rr})}K&&le.sort(((de,Ce)=>de.sortKey-Ce.sortKey));for(const de of le){const{programConfiguration:Ce,program:be,layoutVertexBuffer:xe,indexBuffer:ke,uniformValues:Fe,terrainData:$e,projectionData:Le}=de.state;be.draw(X,Y.TRIANGLES,ie,ee,oe,pt.backCCW,Fe,$e,Le,k.id,xe,ke,de.segments,k.paint,x.transform.zoom,Ce)}})(e,o,u,d,y):l.cd(u)?(function(x,S,k,A,E){if(k.paint.get("heatmap-opacity")===0)return;const L=x.context,{isRenderingToTexture:R,isRenderingGlobe:F}=E;if(x.style.map.terrain){for(const U of A){const K=S.getTile(U);S.hasRenderableParent(U)||(x.renderPass==="offscreen"?Du(x,K,k,U,F):x.renderPass==="translucent"&&Op(x,k,U,R,F))}L.viewport.set([0,0,x.width,x.height])}else x.renderPass==="offscreen"?(function(U,K,X,Y){const Q=U.context,ie=Q.gl,ee=U.transform,oe=Gt.disabled,le=new fr([ie.ONE,ie.ONE],l.bf.transparent,[!0,!0,!0,!0]);(function(te,de,Ce){const be=te.gl;te.activeTexture.set(be.TEXTURE1),te.viewport.set([0,0,de.width/4,de.height/4]);let xe=Ce.heatmapFbos.get(l.c2);xe?(be.bindTexture(be.TEXTURE_2D,xe.colorAttachment.get()),te.bindFramebuffer.set(xe.framebuffer)):(xe=Ns(te,de.width/4,de.height/4),Ce.heatmapFbos.set(l.c2,xe))})(Q,U,X),Q.clear({color:l.bf.transparent});for(let te=0;te<Y.length;te++){const de=Y[te];if(K.hasRenderableParent(de))continue;const Ce=K.getTile(de),be=Ce.getBucket(X);if(!be)continue;const xe=be.programConfigurations.get(X.id),ke=U.useProgram("heatmap",xe),Fe=ee.getProjectionData({overscaledTileID:de,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),$e=ee.getCircleRadiusCorrection();ke.draw(Q,ie.TRIANGLES,yt.disabled,oe,le,pt.backCCW,vp(Ce,ee.zoom,X.paint.get("heatmap-intensity"),$e),null,Fe,X.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,X.paint,ee.zoom,xe)}Q.viewport.set([0,0,U.width,U.height])})(x,S,k,A):x.renderPass==="translucent"&&(function(U,K){const X=U.context,Y=X.gl;X.setColorMode(U.colorModeForRenderPass());const Q=K.heatmapFbos.get(l.c2);Q&&(X.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_2D,Q.colorAttachment.get()),X.activeTexture.set(Y.TEXTURE1),Us(X,K).bind(Y.LINEAR,Y.CLAMP_TO_EDGE),U.useProgram("heatmapTexture").draw(X,Y.TRIANGLES,yt.disabled,Gt.disabled,U.colorModeForRenderPass(),pt.disabled,xu(U,K,0,1),null,null,K.id,U.viewportBuffer,U.quadTriangleIndexBuffer,U.viewportSegments,K.paint,U.transform.zoom))})(x,k)})(e,o,u,d,y):l.ce(u)?(function(x,S,k,A,E){if(x.renderPass!=="translucent")return;const{isRenderingToTexture:L}=E,R=k.paint.get("line-opacity"),F=k.paint.get("line-width");if(R.constantOr(1)===0||F.constantOr(1)===0)return;const U=x.getDepthModeForSublayer(0,yt.ReadOnly),K=x.colorModeForRenderPass(),X=k.paint.get("line-dasharray"),Y=k.paint.get("line-pattern"),Q=Y.constantOr(1),ie=k.paint.get("line-gradient"),ee=k.getCrossfadeParameters(),oe=Q?"linePattern":X?"lineSDF":ie?"lineGradient":"line",le=x.context,te=le.gl,de=x.transform;let Ce=!0;for(const be of A){const xe=S.getTile(be);if(Q&&!xe.patternsLoaded())continue;const ke=xe.getBucket(k);if(!ke)continue;const Fe=ke.programConfigurations.get(k.id),$e=x.context.program.get(),Le=x.useProgram(oe,Fe),Qe=Ce||Le.program!==$e,Tt=x.style.map.terrain&&x.style.map.terrain.getTerrainData(be),Kt=Y.constantOr(null);if(Kt&&xe.imageAtlas){const xt=xe.imageAtlas,ar=xt.patternPositions[Kt.to.toString()],Fr=xt.patternPositions[Kt.from.toString()];ar&&Fr&&Fe.setConstantPatternPositions(ar,Fr)}const nr=de.getProjectionData({overscaledTileID:be,applyGlobeMatrix:!L,applyTerrainMatrix:!0}),rr=de.getPixelScale(),_r=Q?Tp(x,xe,k,rr,ee):X?ao(x,xe,k,rr,X,ee):ie?wp(x,xe,k,rr,ke.lineClipsArray.length):ql(x,xe,k,rr);if(Q)le.activeTexture.set(te.TEXTURE0),xe.imageAtlasTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE),Fe.updatePaintBuffers(ee);else if(X&&(Qe||x.lineAtlas.dirty))le.activeTexture.set(te.TEXTURE0),x.lineAtlas.bind(le);else if(ie){const xt=ke.gradients[k.id];let ar=xt.texture;if(k.gradientVersion!==xt.version){let Fr=256;if(k.stepInterpolant){const Gr=S.getSource().maxzoom,Yr=be.canonical.z===Gr?Math.ceil(1<<x.transform.maxZoom-be.canonical.z):1;Fr=l.ah(l.c3(ke.maxLineLength/l.$*1024*Yr),256,le.maxTextureSize)}xt.gradient=l.c4({expression:k.gradientExpression(),evaluationKey:"lineProgress",resolution:Fr,image:xt.gradient||void 0,clips:ke.lineClipsArray}),xt.texture?xt.texture.update(xt.gradient):xt.texture=new l.T(le,xt.gradient,te.RGBA),xt.version=k.gradientVersion,ar=xt.texture}le.activeTexture.set(te.TEXTURE0),ar.bind(k.stepInterpolant?te.NEAREST:te.LINEAR,te.CLAMP_TO_EDGE)}const Sr=x.stencilModeForClipping(be);Le.draw(le,te.TRIANGLES,U,Sr,K,pt.disabled,_r,Tt,nr,k.id,ke.layoutVertexBuffer,ke.indexBuffer,ke.segments,k.paint,x.transform.zoom,Fe,ke.layoutVertexBuffer2),Ce=!1}})(e,o,u,d,y):l.cf(u)?(function(x,S,k,A,E){const L=k.paint.get("fill-color"),R=k.paint.get("fill-opacity");if(R.constantOr(1)===0)return;const{isRenderingToTexture:F}=E,U=x.colorModeForRenderPass(),K=k.paint.get("fill-pattern"),X=x.opaquePassEnabledForLayer()&&!K.constantOr(1)&&L.constantOr(l.bf.transparent).a===1&&R.constantOr(0)===1?"opaque":"translucent";if(x.renderPass===X){const Y=x.getDepthModeForSublayer(1,x.renderPass==="opaque"?yt.ReadWrite:yt.ReadOnly);Ql(x,S,k,A,Y,U,!1,F)}if(x.renderPass==="translucent"&&k.paint.get("fill-antialias")){const Y=x.getDepthModeForSublayer(k.getPaintProperty("fill-outline-color")?2:0,yt.ReadOnly);Ql(x,S,k,A,Y,U,!0,F)}})(e,o,u,d,y):l.cg(u)?(function(x,S,k,A,E){const L=k.paint.get("fill-extrusion-opacity");if(L===0)return;const{isRenderingToTexture:R}=E;if(x.renderPass==="translucent"){const F=new yt(x.context.gl.LEQUAL,yt.ReadWrite,x.depthRangeFor3D);if(L!==1||k.paint.get("fill-extrusion-pattern").constantOr(1))ju(x,S,k,A,F,Gt.disabled,fr.disabled,R),ju(x,S,k,A,F,x.stencilModeFor3D(),x.colorModeForRenderPass(),R);else{const U=x.colorModeForRenderPass();ju(x,S,k,A,F,Gt.disabled,U,R)}}})(e,o,u,d,y):l.ch(u)?(function(x,S,k,A,E){if(x.renderPass!=="offscreen"&&x.renderPass!=="translucent")return;const{isRenderingToTexture:L}=E,R=x.context,F=x.style.projection.useSubdivision,U=x.getDepthModeForSublayer(0,yt.ReadOnly),K=x.colorModeForRenderPass();if(x.renderPass==="offscreen")(function(X,Y,Q,ie,ee,oe,le){const te=X.context,de=te.gl;for(const Ce of Q){const be=Y.getTile(Ce),xe=be.dem;if(!xe||!xe.data||!be.needsHillshadePrepare)continue;const ke=xe.dim,Fe=xe.stride,$e=xe.getPixels();if(te.activeTexture.set(de.TEXTURE1),te.pixelStoreUnpackPremultiplyAlpha.set(!1),be.demTexture=be.demTexture||X.getTileTexture(Fe),be.demTexture){const Qe=be.demTexture;Qe.update($e,{premultiply:!1}),Qe.bind(de.NEAREST,de.CLAMP_TO_EDGE)}else be.demTexture=new l.T(te,$e,de.RGBA,{premultiply:!1}),be.demTexture.bind(de.NEAREST,de.CLAMP_TO_EDGE);te.activeTexture.set(de.TEXTURE0);let Le=be.fbo;if(!Le){const Qe=new l.T(te,{width:ke,height:ke,data:null},de.RGBA);Qe.bind(de.LINEAR,de.CLAMP_TO_EDGE),Le=be.fbo=te.createFramebuffer(ke,ke,!0,!1),Le.colorAttachment.set(Qe.texture)}te.bindFramebuffer.set(Le.framebuffer),te.viewport.set([0,0,ke,ke]),X.useProgram("hillshadePrepare").draw(te,de.TRIANGLES,ee,oe,le,pt.disabled,bp(be.tileID,xe),null,null,ie.id,X.rasterBoundsBuffer,X.quadTriangleIndexBuffer,X.rasterBoundsSegments),be.needsHillshadePrepare=!1}})(x,S,A,k,U,Gt.disabled,K),R.viewport.set([0,0,x.width,x.height]);else if(x.renderPass==="translucent")if(F){const[X,Y,Q]=x.stencilConfigForOverlapTwoPass(A);co(x,S,k,Q,X,U,K,!1,L),co(x,S,k,Q,Y,U,K,!0,L)}else{const[X,Y]=x.getStencilConfigForOverlapAndUpdateStencilID(A);co(x,S,k,Y,X,U,K,!1,L)}})(e,o,u,d,y):l.ci(u)?(function(x,S,k,A,E){if(x.renderPass!=="translucent"||!A.length)return;const{isRenderingToTexture:L}=E,R=x.style.projection.useSubdivision,F=x.getDepthModeForSublayer(0,yt.ReadOnly),U=x.colorModeForRenderPass();if(R){const[K,X,Y]=x.stencilConfigForOverlapTwoPass(A);Fu(x,S,k,Y,K,F,U,!1,L),Fu(x,S,k,Y,X,F,U,!0,L)}else{const[K,X]=x.getStencilConfigForOverlapAndUpdateStencilID(A);Fu(x,S,k,X,K,F,U,!1,L)}})(e,o,u,d,y):l.cj(u)?(function(x,S,k,A,E){if(x.renderPass!=="translucent"||k.paint.get("raster-opacity")===0||!A.length)return;const{isRenderingToTexture:L}=E,R=S.getSource(),F=x.style.projection.useSubdivision;if(R instanceof Fn)uo(x,S,k,A,null,!1,!1,R.tileCoords,R.flippedWindingOrder,L);else if(F){const[U,K,X]=x.stencilConfigForOverlapTwoPass(A);uo(x,S,k,X,U,!1,!0,ec,!1,L),uo(x,S,k,X,K,!0,!0,ec,!1,L)}else{const[U,K]=x.getStencilConfigForOverlapAndUpdateStencilID(A);uo(x,S,k,K,U,!1,!0,ec,!1,L)}})(e,o,u,d,y):l.ck(u)?(function(x,S,k,A,E){const L=k.paint.get("background-color"),R=k.paint.get("background-opacity");if(R===0)return;const{isRenderingToTexture:F}=E,U=x.context,K=U.gl,X=x.style.projection,Y=x.transform,Q=Y.tileSize,ie=k.paint.get("background-pattern");if(x.isPatternMissing(ie))return;const ee=!ie&&L.a===1&&R===1&&x.opaquePassEnabledForLayer()?"opaque":"translucent";if(x.renderPass!==ee)return;const oe=Gt.disabled,le=x.getDepthModeForSublayer(0,ee==="opaque"?yt.ReadWrite:yt.ReadOnly),te=x.colorModeForRenderPass(),de=x.useProgram(ie?"backgroundPattern":"background"),Ce=A||ge(Y,{tileSize:Q,terrain:x.style.map.terrain});ie&&(U.activeTexture.set(K.TEXTURE0),x.imageManager.bind(x.context));const be=k.getCrossfadeParameters();for(const xe of Ce){const ke=Y.getProjectionData({overscaledTileID:xe,applyGlobeMatrix:!F,applyTerrainMatrix:!0}),Fe=ie?Cp(R,x,ie,{tileID:xe,tileSize:Q},be):kp(R,L),$e=x.style.map.terrain&&x.style.map.terrain.getTerrainData(xe),Le=X.getMeshFromTileID(U,xe.canonical,!1,!0,"raster");de.draw(U,K.TRIANGLES,le,oe,te,pt.backCCW,Fe,$e,ke,k.id,Le.vertexBuffer,Le.indexBuffer,Le.segments)}})(e,0,u,d,y):l.cl(u)&&(function(x,S,k,A){const{isRenderingGlobe:E}=A,L=x.context,R=k.implementation,F=x.style.projection,U=x.transform,K=U.getProjectionDataForCustomLayer(E),X={farZ:U.farZ,nearZ:U.nearZ,fov:U.fov*Math.PI/180,modelViewProjectionMatrix:U.modelViewProjectionMatrix,projectionMatrix:U.projectionMatrix,shaderData:{variantName:F.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${F.shaderPreludeCode.vertexSource}`,define:F.shaderDefine},defaultProjectionData:K},Y=R.renderingMode?R.renderingMode:"2d";if(x.renderPass==="offscreen"){const Q=R.prerender;Q&&(x.setCustomLayerDefaults(),L.setColorMode(x.colorModeForRenderPass()),Q.call(R,L.gl,X),L.setDirty(),x.setBaseState())}else if(x.renderPass==="translucent"){x.setCustomLayerDefaults(),L.setColorMode(x.colorModeForRenderPass()),L.setStencilMode(Gt.disabled);const Q=Y==="3d"?x.getDepthModeFor3D():x.getDepthModeForSublayer(0,yt.ReadOnly);L.setDepthMode(Q),R.render(L.gl,X),L.setDirty(),x.setBaseState(),L.bindFramebuffer.set(null)}})(e,0,u,y))}saveTileTexture(e){const o=this._tileTextures[e.size[0]];o?o.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const o=this._tileTextures[e];return o&&o.length>0?o.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const o=this.imageManager.getPattern(e.from.toString()),u=this.imageManager.getPattern(e.to.toString());return!o||!u}useProgram(e,o,u=!1,d=[]){this.cache=this.cache||{};const y=!!this.style.map.terrain,x=this.style.projection,S=u?un.projectionMercator:x.shaderPreludeCode,k=u?ra:x.shaderDefine,A=e+(o?o.cacheKey:"")+`/${u?Qa:x.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(y?"/terrain":"")+(d?`/${d.join("/")}`:"");return this.cache[A]||(this.cache[A]=new bu(this.context,un[e],o,Cu[e],this._showOverdrawInspector,y,S,k,d)),this.cache[A]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new l.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:o}=this.context.gl;return this.width!==e||this.height!==o}}function ho(g,e){let o,u=!1,d=null,y=null;const x=()=>{d=null,u&&(g.apply(y,o),d=setTimeout(x,e),u=!1)};return(...S)=>(u=!0,y=this,o=S,d||x(),d)}class ic{constructor(e){this._getCurrentHash=()=>{const o=window.location.hash.replace("#","");if(this._hashName){let u;return o.split("&").map((d=>d.split("="))).forEach((d=>{d[0]===this._hashName&&(u=d)})),(u&&u[1]||"").split("/")}return o.split("/")},this._onHashChange=()=>{const o=this._getCurrentHash();if(!this._isValidHash(o))return!1;const u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(o[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:u,pitch:+(o[4]||0)}),!0},this._updateHashUnthrottled=()=>{const o=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,o)},this._removeHash=()=>{const o=this._getCurrentHash();if(o.length===0)return;const u=o.join("/");let d=u;d.split("&").length>0&&(d=d.split("&")[0]),this._hashName&&(d=`${this._hashName}=${u}`);let y=window.location.hash.replace(d,"");y.startsWith("#&")?y=y.slice(0,1)+y.slice(2):y==="#"&&(y="");let x=window.location.href.replace(/(#.+)?$/,y);x=x.replace("&&","&"),window.history.replaceState(window.history.state,null,x)},this._updateHash=ho(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const o=this._map.getCenter(),u=Math.round(100*this._map.getZoom())/100,d=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,d),x=Math.round(o.lng*y)/y,S=Math.round(o.lat*y)/y,k=this._map.getBearing(),A=this._map.getPitch();let E="";if(E+=e?`/${x}/${S}/${u}`:`${u}/${S}/${x}`,(k||A)&&(E+="/"+Math.round(10*k)/10),A&&(E+=`/${Math.round(A)}`),this._hashName){const L=this._hashName;let R=!1;const F=window.location.hash.slice(1).split("&").map((U=>{const K=U.split("=")[0];return K===L?(R=!0,`${K}=${E}`):U})).filter((U=>U));return R||F.push(`${L}=${E}`),`#${F.join("&")}`}return`#${E}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new l.S(+e[2],+e[1])}catch{return!1}const o=+e[0],u=+(e[3]||0),d=+(e[4]||0);return o>=this._map.getMinZoom()&&o<=this._map.getMaxZoom()&&u>=-180&&u<=180&&d>=this._map.getMinPitch()&&d<=this._map.getMaxPitch()}}const aa={linearity:.3,easing:l.cm(0,0,.3,1)},Nu=l.e({deceleration:2500,maxSpeed:1400},aa),Up=l.e({deceleration:20,maxSpeed:1400},aa),Vp=l.e({deceleration:1e3,maxSpeed:360},aa),qp=l.e({deceleration:1e3,maxSpeed:90},aa),Gp=l.e({deceleration:1e3,maxSpeed:360},aa);class Zp{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Z.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,o=Z.now();for(;e.length>0&&o-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const o={zoom:0,bearing:0,pitch:0,roll:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)o.zoom+=y.zoomDelta||0,o.bearing+=y.bearingDelta||0,o.pitch+=y.pitchDelta||0,o.roll+=y.rollDelta||0,y.panDelta&&o.pan._add(y.panDelta),y.around&&(o.around=y.around),y.pinchAround&&(o.pinchAround=y.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,d={};if(o.pan.mag()){const y=Go(o.pan.mag(),u,l.e({},Nu,e||{})),x=o.pan.mult(y.amount/o.pan.mag()),S=this._map.cameraHelper.handlePanInertia(x,this._map.transform);d.center=S.easingCenter,d.offset=S.easingOffset,dn(d,y)}if(o.zoom){const y=Go(o.zoom,u,Up);d.zoom=this._map.transform.zoom+y.amount,dn(d,y)}if(o.bearing){const y=Go(o.bearing,u,Vp);d.bearing=this._map.transform.bearing+l.ah(y.amount,-179,179),dn(d,y)}if(o.pitch){const y=Go(o.pitch,u,qp);d.pitch=this._map.transform.pitch+y.amount,dn(d,y)}if(o.roll){const y=Go(o.roll,u,Gp);d.roll=this._map.transform.roll+l.ah(y.amount,-179,179),dn(d,y)}if(d.zoom||d.bearing){const y=o.pinchAround===void 0?o.around:o.pinchAround;d.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),l.e(d,{noMoveStart:!0})}}function dn(g,e){(!g.duration||g.duration<e.duration)&&(g.duration=e.duration,g.easing=e.easing)}function Go(g,e,o){const{maxSpeed:u,linearity:d,deceleration:y}=o,x=l.ah(g*d/(e/1e3),-u,u),S=Math.abs(x)/(y*d);return{easing:o.easing,duration:1e3*S,amount:x*(S/2)}}class ji extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,u,d={}){u=u instanceof MouseEvent?u:new MouseEvent(e,u);const y=$.mousePos(o.getCanvas(),u),x=o.unproject(y);super(e,l.e({point:y,lngLat:x,originalEvent:u},d)),this._defaultPrevented=!1,this.target=o}}class Zo extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,u){const d=e==="touchend"?u.changedTouches:u.touches,y=$.touchPos(o.getCanvasContainer(),d),x=y.map((k=>o.unproject(k))),S=y.reduce(((k,A,E,L)=>k.add(A.div(L.length))),new l.P(0,0));super(e,{points:y,point:S,lngLats:x,lngLat:o.unproject(S),originalEvent:u}),this._defaultPrevented=!1}}class Uu extends l.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,o,u){super(e,{originalEvent:u}),this._defaultPrevented=!1}}class Wp{constructor(e,o){this._map=e,this._clickTolerance=o.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Uu(e.type,this._map,e))}mousedown(e,o){return this._mousedownPos=o,this._firePreventable(new ji(e.type,this._map,e))}mouseup(e){this._map.fire(new ji(e.type,this._map,e))}click(e,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||this._map.fire(new ji(e.type,this._map,e))}dblclick(e){return this._firePreventable(new ji(e.type,this._map,e))}mouseover(e){this._map.fire(new ji(e.type,this._map,e))}mouseout(e){this._map.fire(new ji(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Zo(e.type,this._map,e))}touchmove(e){this._map.fire(new Zo(e.type,this._map,e))}touchend(e){this._map.fire(new Zo(e.type,this._map,e))}touchcancel(e){this._map.fire(new Zo(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hp{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new ji(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ji("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new ji(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Wo{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(l.P.convert(e),this._map.terrain)}}class Vu{constructor(e,o){this._map=e,this._tr=new Wo(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,o){this.isEnabled()&&e.shiftKey&&e.button===0&&($.disableDrag(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(e,o){if(!this._active)return;const u=o;if(this._lastPos.equals(u)||!this._box&&u.dist(this._startPos)<this._clickTolerance)return;const d=this._startPos;this._lastPos=u,this._box||(this._box=$.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const y=Math.min(d.x,u.x),x=Math.max(d.x,u.x),S=Math.min(d.y,u.y),k=Math.max(d.y,u.y);$.setTransform(this._box,`translate(${y}px,${S}px)`),this._box.style.width=x-y+"px",this._box.style.height=k-S+"px"}mouseupWindow(e,o){if(!this._active||e.button!==0)return;const u=this._startPos,d=o;if(this.reset(),$.suppressClick(),u.x!==d.x||u.y!==d.y)return this._map.fire(new l.l("boxzoomend",{originalEvent:e})),{cameraAnimation:y=>y.fitScreenCoordinates(u,d,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&($.remove(this._box),this._box=null),$.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,o){return this._map.fire(new l.l(e,{originalEvent:o}))}}function Ho(g,e){if(g.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${g.length}, points ${e.length}`);const o={};for(let u=0;u<g.length;u++)o[g[u].identifier]=e[u];return o}class Xp{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,o,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),u.length===this.numTouches&&(this.centroid=(function(d){const y=new l.P(0,0);for(const x of d)y._add(x);return y.div(d.length)})(o),this.touches=Ho(u,o)))}touchmove(e,o,u){if(this.aborted||!this.centroid)return;const d=Ho(u,o);for(const y in this.touches){const x=d[y];(!x||x.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(e,o,u){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const d=!this.aborted&&this.centroid;if(this.reset(),d)return d}}}class Fi{constructor(e){this.singleTap=new Xp(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,o,u){this.singleTap.touchstart(e,o,u)}touchmove(e,o,u){this.singleTap.touchmove(e,o,u)}touchend(e,o,u){const d=this.singleTap.touchend(e,o,u);if(d){const y=e.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(d)<30;if(y&&x||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}}}class fn{constructor(e){this._tr=new Wo(e),this._zoomIn=new Fi({numTouches:1,numTaps:2}),this._zoomOut=new Fi({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,o,u){this._zoomIn.touchstart(e,o,u),this._zoomOut.touchstart(e,o,u)}touchmove(e,o,u){this._zoomIn.touchmove(e,o,u),this._zoomOut.touchmove(e,o,u)}touchend(e,o,u){const d=this._zoomIn.touchend(e,o,u),y=this._zoomOut.touchend(e,o,u),x=this._tr;return d?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:x.zoom+1,around:x.unproject(d)},{originalEvent:e})}):y?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:x.zoom-1,around:x.unproject(y)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xo{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const o=this._moveFunction(...e);if(o.bearingDelta||o.pitchDelta||o.rollDelta||o.around||o.panDelta)return this._active=!0,o}dragStart(e,o){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(o)?o[0]:o,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,o){if(!this.isEnabled())return;const u=this._lastPoint;if(!u)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const d=Array.isArray(o)?o[0]:o;return!this._moved&&d.dist(u)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=d,this._move(u,d))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&$.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const mn=0,Ko=2,um={[mn]:1,[Ko]:2};class Gs{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const o=$.mouseButton(e);this._eventButton=o}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!(function(o,u){const d=um[u];return o.buttons===void 0||(o.buttons&d)!==d})(e,this._eventButton)}isValidEndEvent(e){return $.mouseButton(e)===this._eventButton}}class hm{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class pm{constructor(e=new Gs({checkCorrectEvent:()=>!0}),o=new hm){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=o}_executeRelevantHandler(e,o,u){return e instanceof MouseEvent?o(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?u(e):void 0}startMove(e){this._executeRelevantHandler(e,(o=>this.mouseMoveStateManager.startMove(o)),(o=>this.oneFingerTouchMoveStateManager.startMove(o)))}endMove(e){this._executeRelevantHandler(e,(o=>this.mouseMoveStateManager.endMove(o)),(o=>this.oneFingerTouchMoveStateManager.endMove(o)))}isValidStartEvent(e){return this._executeRelevantHandler(e,(o=>this.mouseMoveStateManager.isValidStartEvent(o)),(o=>this.oneFingerTouchMoveStateManager.isValidStartEvent(o)))}isValidMoveEvent(e){return this._executeRelevantHandler(e,(o=>this.mouseMoveStateManager.isValidMoveEvent(o)),(o=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(o)))}isValidEndEvent(e){return this._executeRelevantHandler(e,(o=>this.mouseMoveStateManager.isValidEndEvent(o)),(o=>this.oneFingerTouchMoveStateManager.isValidEndEvent(o)))}}const Zs=g=>{g.mousedown=g.dragStart,g.mousemoveWindow=g.dragMove,g.mouseup=g.dragEnd,g.contextmenu=e=>{e.preventDefault()}};class Ws{constructor(e,o){this._clickTolerance=e.clickTolerance||1,this._map=o,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,o,u){return this._calculateTransform(e,o,u)}touchmove(e,o,u){if(this._active){if(!this._shouldBePrevented(u.length))return e.preventDefault(),this._calculateTransform(e,o,u);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,o,u){this._calculateTransform(e,o,u),this._active&&this._shouldBePrevented(u.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,o,u){u.length>0&&(this._active=!0);const d=Ho(u,o),y=new l.P(0,0),x=new l.P(0,0);let S=0;for(const A in d){const E=d[A],L=this._touches[A];L&&(y._add(E),x._add(E.sub(L)),S++,d[A]=E)}if(this._touches=d,this._shouldBePrevented(S)||!x.mag())return;const k=x.div(S);return this._sum._add(k),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(S),panDelta:k}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gn{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,o,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([o[0],o[1]]))}touchmove(e,o,u){if(!this._firstTwoTouches)return;e.preventDefault();const[d,y]=this._firstTwoTouches,x=Ke(u,o,d),S=Ke(u,o,y);if(!x||!S)return;const k=this._aroundCenter?null:x.add(S).div(2);return this._move([x,S],k,e)}touchend(e,o,u){if(!this._firstTwoTouches)return;const[d,y]=this._firstTwoTouches,x=Ke(u,o,d),S=Ke(u,o,y);x&&S||(this._active&&$.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ke(g,e,o){for(let u=0;u<g.length;u++)if(g[u].identifier===o)return e[u]}function qu(g,e){return Math.log(g/e)/Math.LN2}class nc extends gn{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,o){const u=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(qu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:qu(this._distance,u),pinchAround:o}}}function Gu(g,e){return 180*g.angleWith(e)/Math.PI}class Yo extends gn{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,o,u){const d=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Gu(this._vector,d),pinchAround:o}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const o=25/(Math.PI*this._minDiameter)*360,u=Gu(e,this._startVector);return Math.abs(u)<o}}function po(g){return Math.abs(g.y)>Math.abs(g.x)}class ac extends gn{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,o,u){super.touchstart(e,o,u),this._currentTouchCount=u.length}_start(e){this._lastPoints=e,po(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,o,u){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const d=e[0].sub(this._lastPoints[0]),y=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(d,y,u.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(d.y+y.y)/2*-.5}):void 0}gestureBeginsVertically(e,o,u){if(this._valid!==void 0)return this._valid;const d=e.mag()>=2,y=o.mag()>=2;if(!d&&!y)return;if(!d||!y)return this._firstMove===void 0&&(this._firstMove=u),u-this._firstMove<100&&void 0;const x=e.y>0==o.y>0;return po(e)&&po(o)&&x}}const Bt={panStep:100,bearingStep:15,pitchStep:10};class oc{constructor(e){this._tr=new Wo(e);const o=Bt;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let o=0,u=0,d=0,y=0,x=0;switch(e.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:e.shiftKey?u=-1:(e.preventDefault(),y=-1);break;case 39:e.shiftKey?u=1:(e.preventDefault(),y=1);break;case 38:e.shiftKey?d=1:(e.preventDefault(),x=-1);break;case 40:e.shiftKey?d=-1:(e.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(u=0,d=0),{cameraAnimation:S=>{const k=this._tr;S.easeTo({duration:300,easeId:"keyboardHandler",easing:dm,zoom:o?Math.round(k.zoom)+o*(e.shiftKey?2:1):k.zoom,bearing:k.bearing+u*this._bearingStep,pitch:k.pitch+d*this._pitchStep,offset:[-y*this._panStep,-x*this._panStep],center:k.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function dm(g){return g*(2-g)}const sc=4.000244140625,fm=1/450;class Kp{constructor(e,o){this._onTimeout=u=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)},this._map=e,this._tr=new Wo(e),this._triggerRenderFrame=o,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=fm}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let o=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const u=Z.now(),d=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,o!==0&&o%sc==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=o,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(d*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),e.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=e,this._delta-=o,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=$.mousePos(this._map.getCanvas(),e),u=this._tr;this._aroundPoint=this._aroundCenter?u.transform.locationToScreenPoint(l.S.convert(u.center)):o,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const S=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=S),typeof this._targetZoom=="number"&&(this._targetZoom+=S)}if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>sc?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&k!==0&&(k=1/k);const A=typeof this._targetZoom!="number"?e.scale:l.af(this._targetZoom);this._targetZoom=e.getConstrained(e.getCameraLngLat(),l.ak(A*k)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const o=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,u=this._startZoom,d=this._easing;let y,x=!1;if(this._type==="wheel"&&u&&d){const S=Z.now()-this._lastWheelEventTime,k=Math.min((S+5)/200,1),A=d(k);y=l.C.number(u,o,A),k<1?this._frameId||(this._frameId=!0):x=!0}else y=o,x=!0;return this._active=!0,x&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=y,{noInertia:!0,needsRenderFrame:!x,zoomDelta:y-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let o=l.co;if(this._prevEase){const u=this._prevEase,d=(Z.now()-u.start)/u.duration,y=u.easing(d+.01)-u.easing(d),x=.27/Math.sqrt(y*y+1e-4)*.01,S=Math.sqrt(.0729-x*x);o=l.cm(x,S,.25,1)}return this._prevEase={start:Z.now(),duration:e,easing:o},o}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Zu{constructor(e,o){this._clickZoom=e,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Wu{constructor(e){this._tr=new Wo(e),this.reset()}reset(){this._active=!1}dblclick(e,o){return e.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(o)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yp{constructor(){this._tap=new Fi({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,o,u){if(!this._swipePoint)if(this._tapTime){const d=o[0],y=e.timeStamp-this._tapTime<500,x=this._tapPoint.dist(d)<30;y&&x?u.length>0&&(this._swipePoint=d,this._swipeTouch=u[0].identifier):this.reset()}else this._tap.touchstart(e,o,u)}touchmove(e,o,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const d=o[0],y=d.y-this._swipePoint.y;return this._swipePoint=d,e.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(e,o,u)}touchend(e,o,u){if(this._tapTime)this._swipePoint&&u.length===0&&this.reset();else{const d=this._tap.touchend(e,o,u);d&&(this._tapTime=e.timeStamp,this._tapPoint=d)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jp{constructor(e,o,u){this._el=e,this._mousePan=o,this._touchPan=u}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Hu{constructor(e,o,u,d){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=o,this._mousePitch=u,this._mouseRoll=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Qp{constructor(e,o,u,d){this._el=e,this._touchZoom=o,this._touchRotate=u,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class ed{constructor(e,o){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=o,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=$.create("div","maplibregl-cooperative-gesture-screen",e);let o=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(o=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const u=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),d=document.createElement("div");d.className="maplibregl-desktop-message",d.textContent=o,this._container.appendChild(d);const y=document.createElement("div");y.className="maplibregl-mobile-message",y.textContent=u,this._container.appendChild(y),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&($.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,o){this._enabled&&(this._map.fire(new l.l("cooperativegestureprevented",{gestureType:e,originalEvent:o})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const yn=g=>g.zoom||g.drag||g.roll||g.pitch||g.rotate;class gr extends l.l{}function Jo(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta||g.rollDelta}class Xu{constructor(e,o){this.handleWindowEvent=d=>{this.handleEvent(d,`${d.type}Window`)},this.handleEvent=(d,y)=>{if(d.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const x=d.type==="renderFrame"?void 0:d,S={needsRenderFrame:!1},k={},A={};for(const{handlerName:R,handler:F,allowed:U}of this._handlers){if(!F.isEnabled())continue;let K;if(this._blockedByActive(A,U,R))F.reset();else if(F[y||d.type]){if(l.cp(d,y||d.type)){const X=$.mousePos(this._map.getCanvas(),d);K=F[y||d.type](d,X)}else if(l.cq(d,y||d.type)){const X=this._getMapTouches(d.touches),Y=$.touchPos(this._map.getCanvas(),X);K=F[y||d.type](d,Y,X)}else l.cr(y||d.type)||(K=F[y||d.type](d));this.mergeHandlerResult(S,k,K,R,x),K&&K.needsRenderFrame&&this._triggerRenderFrame()}(K||F.isActive())&&(A[R]=F)}const E={};for(const R in this._previousActiveHandlers)A[R]||(E[R]=x);this._previousActiveHandlers=A,(Object.keys(E).length||Jo(S))&&(this._changes.push([S,k,E]),this._triggerRenderFrame()),(Object.keys(A).length||Jo(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:L}=S;L&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],L(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Zp(e),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(o);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[d,y,x]of this._listeners)$.addEventListener(d,y,d===document?this.handleWindowEvent:this.handleEvent,x)}destroy(){for(const[e,o,u]of this._listeners)$.removeEventListener(e,o,e===document?this.handleWindowEvent:this.handleEvent,u)}_addDefaultHandlers(e){const o=this._map,u=o.getCanvasContainer();this._add("mapEvent",new Wp(o,e));const d=o.boxZoom=new Vu(o,e);this._add("boxZoom",d),e.interactive&&e.boxZoom&&d.enable();const y=o.cooperativeGestures=new ed(o,e.cooperativeGestures);this._add("cooperativeGestures",y),e.cooperativeGestures&&y.enable();const x=new fn(o),S=new Wu(o);o.doubleClickZoom=new Zu(S,x),this._add("tapZoom",x),this._add("clickZoom",S),e.interactive&&e.doubleClickZoom&&o.doubleClickZoom.enable();const k=new Yp;this._add("tapDragZoom",k);const A=o.touchPitch=new ac(o);this._add("touchPitch",A),e.interactive&&e.touchPitch&&o.touchPitch.enable(e.touchPitch);const E=()=>o.project(o.getCenter()),L=(function({enable:ee,clickTolerance:oe,aroundCenter:le=!0,minPixelCenterThreshold:te=100,rotateDegreesPerPixelMoved:de=.8},Ce){const be=new Gs({checkCorrectEvent:xe=>$.mouseButton(xe)===0&&xe.ctrlKey||$.mouseButton(xe)===2&&!xe.ctrlKey});return new Xo({clickTolerance:oe,move:(xe,ke)=>{const Fe=Ce();if(le&&Math.abs(Fe.y-xe.y)>te)return{bearingDelta:l.cn(new l.P(xe.x,ke.y),ke,Fe)};let $e=(ke.x-xe.x)*de;return le&&ke.y<Fe.y&&($e=-$e),{bearingDelta:$e}},moveStateManager:be,enable:ee,assignEvents:Zs})})(e,E),R=(function({enable:ee,clickTolerance:oe,pitchDegreesPerPixelMoved:le=-.5}){const te=new Gs({checkCorrectEvent:de=>$.mouseButton(de)===0&&de.ctrlKey||$.mouseButton(de)===2});return new Xo({clickTolerance:oe,move:(de,Ce)=>({pitchDelta:(Ce.y-de.y)*le}),moveStateManager:te,enable:ee,assignEvents:Zs})})(e),F=(function({enable:ee,clickTolerance:oe,rollDegreesPerPixelMoved:le=.3},te){const de=new Gs({checkCorrectEvent:Ce=>$.mouseButton(Ce)===2&&Ce.ctrlKey});return new Xo({clickTolerance:oe,move:(Ce,be)=>{const xe=te();let ke=(be.x-Ce.x)*le;return be.y<xe.y&&(ke=-ke),{rollDelta:ke}},moveStateManager:de,enable:ee,assignEvents:Zs})})(e,E);o.dragRotate=new Hu(e,L,R,F),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",R,["mouseRotate","mouseRoll"]),this._add("mouseRoll",F,["mousePitch"]),e.interactive&&e.dragRotate&&o.dragRotate.enable();const U=(function({enable:ee,clickTolerance:oe}){const le=new Gs({checkCorrectEvent:te=>$.mouseButton(te)===0&&!te.ctrlKey});return new Xo({clickTolerance:oe,move:(te,de)=>({around:de,panDelta:de.sub(te)}),activateOnStart:!0,moveStateManager:le,enable:ee,assignEvents:Zs})})(e),K=new Ws(e,o);o.dragPan=new Jp(u,U,K),this._add("mousePan",U),this._add("touchPan",K,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&o.dragPan.enable(e.dragPan);const X=new Yo,Y=new nc;o.touchZoomRotate=new Qp(u,Y,X,k),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",Y,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&o.touchZoomRotate.enable(e.touchZoomRotate);const Q=o.scrollZoom=new Kp(o,(()=>this._triggerRenderFrame()));this._add("scrollZoom",Q,["mousePan"]),e.interactive&&e.scrollZoom&&o.scrollZoom.enable(e.scrollZoom);const ie=o.keyboard=new oc(o);this._add("keyboard",ie),e.interactive&&e.keyboard&&o.keyboard.enable(),this._add("blockableMapEvent",new Hp(o))}_add(e,o,u){this._handlers.push({handlerName:e,handler:o,allowed:u}),this._handlersById[e]=o}stop(e){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!yn(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,o,u){for(const d in e)if(d!==u&&(!o||o.indexOf(d)<0))return!0;return!1}_getMapTouches(e){const o=[];for(const u of e)this._el.contains(u.target)&&o.push(u);return o}mergeHandlerResult(e,o,u,d,y){if(!u)return;l.e(e,u);const x={handlerName:d,originalEvent:u.originalEvent||y};u.zoomDelta!==void 0&&(o.zoom=x),u.panDelta!==void 0&&(o.drag=x),u.rollDelta!==void 0&&(o.roll=x),u.pitchDelta!==void 0&&(o.pitch=x),u.bearingDelta!==void 0&&(o.rotate=x)}_applyChanges(){const e={},o={},u={};for(const[d,y,x]of this._changes)d.panDelta&&(e.panDelta=(e.panDelta||new l.P(0,0))._add(d.panDelta)),d.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+d.zoomDelta),d.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+d.bearingDelta),d.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+d.pitchDelta),d.rollDelta&&(e.rollDelta=(e.rollDelta||0)+d.rollDelta),d.around!==void 0&&(e.around=d.around),d.pinchAround!==void 0&&(e.pinchAround=d.pinchAround),d.noInertia&&(e.noInertia=d.noInertia),l.e(o,y),l.e(u,x);this._updateMapTransform(e,o,u),this._changes=[]}_updateMapTransform(e,o,u){const d=this._map,y=d._getTransformForUpdate(),x=d.terrain;if(!(Jo(e)||x&&this._terrainMovement))return this._fireEvents(o,u,!0);d._stop(!0);let{panDelta:S,zoomDelta:k,bearingDelta:A,pitchDelta:E,rollDelta:L,around:R,pinchAround:F}=e;F!==void 0&&(R=F),R=R||d.transform.centerPoint,x&&!y.isPointOnMapSurface(R)&&(R=y.centerPoint);const U={panDelta:S,zoomDelta:k,rollDelta:L,pitchDelta:E,bearingDelta:A,around:R};this._map.cameraHelper.useGlobeControls&&!y.isPointOnMapSurface(R)&&(R=y.centerPoint);const K=R.distSqr(y.centerPoint)<.01?y.center:y.screenPointToLocation(S?R.sub(S):R);x?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(U,y),this._terrainMovement||!o.drag&&!o.zoom?o.drag&&this._terrainMovement?y.setCenter(y.screenPointToLocation(y.centerPoint.sub(S))):this._map.cameraHelper.handleMapControlsPan(U,y,K):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(U,y,K))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(U,y),this._map.cameraHelper.handleMapControlsPan(U,y,K)),d._applyUpdatedTransform(y),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(o,u,!0)}_fireEvents(e,o,u){const d=yn(this._eventsInProgress),y=yn(e),x={};for(const L in e){const{originalEvent:R}=e[L];this._eventsInProgress[L]||(x[`${L}start`]=R),this._eventsInProgress[L]=e[L]}!d&&y&&this._fireEvent("movestart",y.originalEvent);for(const L in x)this._fireEvent(L,x[L]);y&&this._fireEvent("move",y.originalEvent);for(const L in e){const{originalEvent:R}=e[L];this._fireEvent(L,R)}const S={};let k;for(const L in this._eventsInProgress){const{handlerName:R,originalEvent:F}=this._eventsInProgress[L];this._handlersById[R].isActive()||(delete this._eventsInProgress[L],k=o[R]||F,S[`${L}end`]=k)}for(const L in S)this._fireEvent(L,S[L]);const A=yn(this._eventsInProgress),E=(d||y)&&!A;if(E&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const L=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&L.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(L)}if(u&&E){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),R=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;!L||!L.essential&&Z.prefersReducedMotion?(this._map.fire(new l.l("moveend",{originalEvent:k})),R(this._map.getBearing())&&this._map.resetNorth()):(R(L.bearing||this._map.getBearing())&&(L.bearing=0),L.freezeElevation=!0,this._map.easeTo(L,{originalEvent:k})),this._updatingCamera=!1}}_fireEvent(e,o){this._map.fire(new l.l(e,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new gr("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class td extends l.E{constructor(e,o,u){super(),this._renderFrameCallback=()=>{const d=Math.min((Z.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(d)),d<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=u.bearingSnap,this.cameraHelper=o,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(e,o){e.apply(this.transform),this.transform=e,this.cameraHelper=o}getCenter(){return new l.S(this.transform.center.lng,this.transform.center.lat)}setCenter(e,o){return this.jumpTo({center:e},o)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,o){return this.jumpTo({elevation:e},o),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,o,u){return e=l.P.convert(e).mult(-1),this.panTo(this.transform.center,l.e({offset:e},o),u)}panTo(e,o,u){return this.easeTo(l.e({center:e},o),u)}getZoom(){return this.transform.zoom}setZoom(e,o){return this.jumpTo({zoom:e},o),this}zoomTo(e,o,u){return this.easeTo(l.e({zoom:e},o),u)}zoomIn(e,o){return this.zoomTo(this.getZoom()+1,e,o),this}zoomOut(e,o){return this.zoomTo(this.getZoom()-1,e,o),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,o){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new l.l("movestart",o)).fire(new l.l("move",o)).fire(new l.l("moveend",o))),this}getBearing(){return this.transform.bearing}setBearing(e,o){return this.jumpTo({bearing:e},o),this}getPadding(){return this.transform.padding}setPadding(e,o){return this.jumpTo({padding:e},o),this}rotateTo(e,o,u){return this.easeTo(l.e({bearing:e},o),u)}resetNorth(e,o){return this.rotateTo(0,l.e({duration:1e3},e),o),this}resetNorthPitch(e,o){return this.easeTo(l.e({bearing:0,pitch:0,roll:0,duration:1e3},e),o),this}snapToNorth(e,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,o):this}getPitch(){return this.transform.pitch}setPitch(e,o){return this.jumpTo({pitch:e},o),this}getRoll(){return this.transform.roll}setRoll(e,o){return this.jumpTo({roll:e},o),this}cameraForBounds(e,o){e=Ht.convert(e).adjustAntiMeridian();const u=o&&o.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),u,o)}_cameraForBoxAndBearing(e,o,u,d){const y={top:0,bottom:0,right:0,left:0};if(typeof(d=l.e({padding:y,offset:[0,0],maxZoom:this.transform.maxZoom},d)).padding=="number"){const A=d.padding;d.padding={top:A,bottom:A,right:A,left:A}}const x=l.e(y,d.padding);d.padding=x;const S=this.transform,k=new Ht(e,o);return this.cameraHelper.cameraForBoxAndBearing(d,x,k,u,S)}fitBounds(e,o,u){return this._fitInternal(this.cameraForBounds(e,o),o,u)}fitScreenCoordinates(e,o,u,d,y){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(l.P.convert(e)),this.transform.screenPointToLocation(l.P.convert(o)),u,d),d,y)}_fitInternal(e,o,u){return e?(delete(o=l.e(e,o)).padding,o.linear?this.easeTo(o,u):this.flyTo(o,u)):this}jumpTo(e,o){this.stop();const u=this._getTransformForUpdate();let d=!1,y=!1,x=!1;const S=u.zoom;this.cameraHelper.handleJumpToCenterZoom(u,e);const k=u.zoom!==S;return"elevation"in e&&u.elevation!==+e.elevation&&u.setElevation(+e.elevation),"bearing"in e&&u.bearing!==+e.bearing&&(d=!0,u.setBearing(+e.bearing)),"pitch"in e&&u.pitch!==+e.pitch&&(y=!0,u.setPitch(+e.pitch)),"roll"in e&&u.roll!==+e.roll&&(x=!0,u.setRoll(+e.roll)),e.padding==null||u.isPaddingEqual(e.padding)||u.setPadding(e.padding),this._applyUpdatedTransform(u),this.fire(new l.l("movestart",o)).fire(new l.l("move",o)),k&&this.fire(new l.l("zoomstart",o)).fire(new l.l("zoom",o)).fire(new l.l("zoomend",o)),d&&this.fire(new l.l("rotatestart",o)).fire(new l.l("rotate",o)).fire(new l.l("rotateend",o)),y&&this.fire(new l.l("pitchstart",o)).fire(new l.l("pitch",o)).fire(new l.l("pitchend",o)),x&&this.fire(new l.l("rollstart",o)).fire(new l.l("roll",o)).fire(new l.l("rollend",o)),this.fire(new l.l("moveend",o))}calculateCameraOptionsFromTo(e,o,u,d=0){const y=l.a1.fromLngLat(e,o),x=l.a1.fromLngLat(u,d),S=x.x-y.x,k=x.y-y.y,A=x.z-y.z,E=Math.hypot(S,k,A);if(E===0)throw new Error("Can't calculate camera options with same From and To");const L=Math.hypot(S,k),R=l.ak(this.transform.cameraToCenterDistance/E/this.transform.tileSize),F=180*Math.atan2(S,-k)/Math.PI;let U=180*Math.acos(L/E)/Math.PI;return U=A<0?90-U:90+U,{center:x.toLngLat(),elevation:d,zoom:R,pitch:U,bearing:F}}calculateCameraOptionsFromCameraLngLatAltRotation(e,o,u,d,y){const x=this.transform.calculateCenterFromCameraLngLatAlt(e,o,u,d);return{center:x.center,elevation:x.elevation,zoom:x.zoom,bearing:u,pitch:d,roll:y}}easeTo(e,o){this._stop(!1,e.easeId),((e=l.e({offset:[0,0],duration:500,easing:l.co},e)).animate===!1||!e.essential&&Z.prefersReducedMotion)&&(e.duration=0);const u=this._getTransformForUpdate(),d=this.getBearing(),y=u.pitch,x=u.roll,S="bearing"in e?this._normalizeBearing(e.bearing,d):d,k="pitch"in e?+e.pitch:y,A="roll"in e?this._normalizeBearing(e.roll,x):x,E="padding"in e?e.padding:u.padding,L=l.P.convert(e.offset);let R,F;e.around&&(R=l.S.convert(e.around),F=u.locationToScreenPoint(R));const U={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},K=this.cameraHelper.handleEaseTo(u,{bearing:S,pitch:k,roll:A,padding:E,around:R,aroundPoint:F,offsetAsPoint:L,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||d!==S,this._pitching=this._pitching||k!==y,this._rolling=this._rolling||A!==x,this._padding=!u.isPaddingEqual(E),this._zooming=this._zooming||K.isZooming,this._easeId=e.easeId,this._prepareEase(o,e.noMoveStart,U),this.terrain&&this._prepareElevation(K.elevationCenter),this._ease((X=>{K.easeFunc(X),this.terrain&&!e.freezeElevation&&this._updateElevation(X),this._applyUpdatedTransform(u),this._fireMoveEvents(o)}),(X=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(o,X)}),e),this}_prepareEase(e,o,u={}){this._moving=!0,o||u.moving||this.fire(new l.l("movestart",e)),this._zooming&&!u.zooming&&this.fire(new l.l("zoomstart",e)),this._rotating&&!u.rotating&&this.fire(new l.l("rotatestart",e)),this._pitching&&!u.pitching&&this.fire(new l.l("pitchstart",e)),this._rolling&&!u.rolling&&this.fire(new l.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const o=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&o!==this._elevationTarget){const u=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(u-(o-(u*e+this._elevationStart))/(1-e)),this._elevationTarget=o}this.transform.setElevation(l.C.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const o=e.getCameraLngLat(),u=e.getCameraAltitude(),d=this.terrain?this.terrain.getElevationForLngLatZoom(o,e.zoom):0;if(u<d){const y=this.calculateCameraOptionsFromTo(o,d,e.center,e.elevation);return{pitch:y.pitch,zoom:y.zoom}}return{}}_applyUpdatedTransform(e){const o=[];if(o.push((d=>this._elevateCameraIfInsideTerrain(d))),this.transformCameraUpdate&&o.push((d=>this.transformCameraUpdate(d))),!o.length)return;const u=e.clone();for(const d of o){const y=u.clone(),{center:x,zoom:S,roll:k,pitch:A,bearing:E,elevation:L}=d(y);x&&y.setCenter(x),L!==void 0&&y.setElevation(L),S!==void 0&&y.setZoom(S),k!==void 0&&y.setRoll(k),A!==void 0&&y.setPitch(A),E!==void 0&&y.setBearing(E),u.apply(y)}this.transform.apply(u)}_fireMoveEvents(e){this.fire(new l.l("move",e)),this._zooming&&this.fire(new l.l("zoom",e)),this._rotating&&this.fire(new l.l("rotate",e)),this._pitching&&this.fire(new l.l("pitch",e)),this._rolling&&this.fire(new l.l("roll",e))}_afterEase(e,o){if(this._easeId&&o&&this._easeId===o)return;delete this._easeId;const u=this._zooming,d=this._rotating,y=this._pitching,x=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,u&&this.fire(new l.l("zoomend",e)),d&&this.fire(new l.l("rotateend",e)),y&&this.fire(new l.l("pitchend",e)),x&&this.fire(new l.l("rollend",e)),this.fire(new l.l("moveend",e))}flyTo(e,o){if(!e.essential&&Z.prefersReducedMotion){const ke=l.Q(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(ke,o)}this.stop(),e=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.co},e);const u=this._getTransformForUpdate(),d=u.bearing,y=u.pitch,x=u.roll,S=u.padding,k="bearing"in e?this._normalizeBearing(e.bearing,d):d,A="pitch"in e?+e.pitch:y,E="roll"in e?this._normalizeBearing(e.roll,x):x,L="padding"in e?e.padding:u.padding,R=l.P.convert(e.offset);let F=u.centerPoint.add(R);const U=u.screenPointToLocation(F),K=this.cameraHelper.handleFlyTo(u,{bearing:k,pitch:A,roll:E,padding:L,locationAtOffset:U,offsetAsPoint:R,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let X=e.curve;const Y=Math.max(u.width,u.height),Q=Y/K.scaleOfZoom,ie=K.pixelPathLength;typeof K.scaleOfMinZoom=="number"&&(X=Math.sqrt(Y/K.scaleOfMinZoom/ie*2));const ee=X*X;function oe(ke){const Fe=(Q*Q-Y*Y+(ke?-1:1)*ee*ee*ie*ie)/(2*(ke?Q:Y)*ee*ie);return Math.log(Math.sqrt(Fe*Fe+1)-Fe)}function le(ke){return(Math.exp(ke)-Math.exp(-ke))/2}function te(ke){return(Math.exp(ke)+Math.exp(-ke))/2}const de=oe(!1);let Ce=function(ke){return te(de)/te(de+X*ke)},be=function(ke){return Y*((te(de)*(le(Fe=de+X*ke)/te(Fe))-le(de))/ee)/ie;var Fe},xe=(oe(!0)-de)/X;if(Math.abs(ie)<2e-6||!isFinite(xe)){if(Math.abs(Y-Q)<1e-6)return this.easeTo(e,o);const ke=Q<Y?-1:1;xe=Math.abs(Math.log(Q/Y))/X,be=()=>0,Ce=Fe=>Math.exp(ke*X*Fe)}return e.duration="duration"in e?+e.duration:1e3*xe/("screenSpeed"in e?+e.screenSpeed/X:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=d!==k,this._pitching=A!==y,this._rolling=E!==x,this._padding=!u.isPaddingEqual(L),this._prepareEase(o,!1),this.terrain&&this._prepareElevation(K.targetCenter),this._ease((ke=>{const Fe=ke*xe,$e=1/Ce(Fe),Le=be(Fe);this._rotating&&u.setBearing(l.C.number(d,k,ke)),this._pitching&&u.setPitch(l.C.number(y,A,ke)),this._rolling&&u.setRoll(l.C.number(x,E,ke)),this._padding&&(u.interpolatePadding(S,L,ke),F=u.centerPoint.add(R)),K.easeFunc(ke,$e,Le,F),this.terrain&&!e.freezeElevation&&this._updateElevation(ke),this._applyUpdatedTransform(u),this._fireMoveEvents(o)}),(()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(o)}),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,o){var u;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const d=this._onEaseEnd;delete this._onEaseEnd,d.call(this,o)}return e||(u=this.handlers)===null||u===void 0||u.stop(!1),this}_ease(e,o,u){u.animate===!1||u.duration===0?(e(1),o()):(this._easeStart=Z.now(),this._easeOptions=u,this._onEaseFrame=e,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,o){e=l.aO(e,-180,180);const u=Math.abs(e-o);return Math.abs(e-360-o)<u&&(e-=360),Math.abs(e+360-o)<u&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(l.S.convert(e),this.transform.tileZoom):null}}const Ku={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Yu{constructor(e=Ku){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=o=>{!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"&&o.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=$.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=$.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=$.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){$.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,o){const u=this._map._getUIString(`AttributionControl.${o}`);e.title=u,e.setAttribute("aria-label",u)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((d=>typeof d!="string"?"":d))):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}const o=this._map.style.sourceCaches;for(const d in o){const y=o[d];if(y.used||y.usedForTerrain){const x=y.getSource();x.attribution&&e.indexOf(x.attribution)<0&&e.push(x.attribution)}}e=e.filter((d=>String(d).trim())),e.sort(((d,y)=>d.length-y.length)),e=e.filter(((d,y)=>{for(let x=y+1;x<e.length;x++)if(e[x].indexOf(d)>=0)return!1;return!0}));const u=e.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,e.length?(this._innerContainer.innerHTML=$.sanitize(u),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class rd{constructor(e={}){this._updateCompact=()=>{const o=this._container.children;if(o.length){const u=o[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&u.classList.add("maplibregl-compact"):u.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=$.create("div","maplibregl-ctrl");const o=$.create("a","maplibregl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://maplibre.org/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){$.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Vn{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const o=++this._id;return this._queue.push({callback:e,id:o,cancelled:!1}),o}remove(e){const o=this._currentlyRunning,u=o?this._queue.concat(o):this._queue;for(const d of u)if(d.id===e)return void(d.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const o=this._currentlyRunning=this._queue;this._queue=[];for(const u of o)if(!u.cancelled&&(u.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var lc=l.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class rt extends l.E{constructor(e){super(),this._lastTilesetChange=Z.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,o){this.sourceCache.update(e,o),this._renderableTilesKeys=[];const u={};for(const d of ge(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:o,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))u[d.key]=!0,this._renderableTilesKeys.push(d.key),this._tiles[d.key]||(d.terrainRttPosMatrix32f=new Float64Array(16),l.bY(d.terrainRttPosMatrix32f,0,l.$,l.$,0,0,1),this._tiles[d.key]=new Ro(d,this.tileSize),this._lastTilesetChange=Z.now());for(const d in this._tiles)u[d]||delete this._tiles[d]}freeRtt(e){for(const o in this._tiles){const u=this._tiles[o];(!e||u.tileID.equals(e)||u.tileID.isChildOf(e)||e.isChildOf(u.tileID))&&(u.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((e=>this.getTileByID(e)))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,o){return o?this._getTerrainCoordsForTileRanges(e,o):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const o={};for(const u of this._renderableTilesKeys){const d=this._tiles[u].tileID,y=e.clone(),x=l.ba();if(d.canonical.equals(e.canonical))l.bY(x,0,l.$,l.$,0,0,1);else if(d.canonical.isChildOf(e.canonical)){const S=d.canonical.z-e.canonical.z,k=d.canonical.x-(d.canonical.x>>S<<S),A=d.canonical.y-(d.canonical.y>>S<<S),E=l.$>>S;l.bY(x,0,E,E,0,0,1),l.M(x,x,[-k*E,-A*E,0])}else{if(!e.canonical.isChildOf(d.canonical))continue;{const S=e.canonical.z-d.canonical.z,k=e.canonical.x-(e.canonical.x>>S<<S),A=e.canonical.y-(e.canonical.y>>S<<S),E=l.$>>S;l.bY(x,0,l.$,l.$,0,0,1),l.M(x,x,[k*E,A*E,0]),l.N(x,x,[1/2**S,1/2**S,0])}}y.terrainRttPosMatrix32f=new Float32Array(x),o[u]=y}return o}_getTerrainCoordsForTileRanges(e,o){const u={};for(const d of this._renderableTilesKeys){const y=this._tiles[d].tileID;if(!this._isWithinTileRanges(y,o))continue;const x=e.clone(),S=l.ba();if(y.canonical.z===e.canonical.z){const k=e.canonical.x-y.canonical.x,A=e.canonical.y-y.canonical.y;l.bY(S,0,l.$,l.$,0,0,1),l.M(S,S,[k*l.$,A*l.$,0])}else if(y.canonical.z>e.canonical.z){const k=y.canonical.z-e.canonical.z,A=y.canonical.x-(y.canonical.x>>k<<k),E=y.canonical.y-(y.canonical.y>>k<<k),L=e.canonical.x-(y.canonical.x>>k),R=e.canonical.y-(y.canonical.y>>k),F=l.$>>k;l.bY(S,0,F,F,0,0,1),l.M(S,S,[-A*F+L*l.$,-E*F+R*l.$,0])}else{const k=e.canonical.z-y.canonical.z,A=e.canonical.x-(e.canonical.x>>k<<k),E=e.canonical.y-(e.canonical.y>>k<<k),L=(e.canonical.x>>k)-y.canonical.x,R=(e.canonical.y>>k)-y.canonical.y,F=l.$<<k;l.bY(S,0,F,F,0,0,1),l.M(S,S,[A*l.$+L*F,E*l.$+R*F,0])}x.terrainRttPosMatrix32f=new Float32Array(S),u[d]=x}return u}getSourceTile(e,o){const u=this.sourceCache._source;let d=e.overscaledZ-this.deltaZoom;if(d>u.maxzoom&&(d=u.maxzoom),d<u.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(d).key);let y=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!y||!y.dem)&&o)for(;d>=u.minzoom&&(!y||!y.dem);)y=this.sourceCache.getTileByID(e.scaledTo(d--).key);return y}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,o){return o[e.canonical.z]&&e.canonical.x>=o[e.canonical.z].minTileX&&e.canonical.x<=o[e.canonical.z].maxTileX&&e.canonical.y>=o[e.canonical.z].minTileY&&e.canonical.y<=o[e.canonical.z].maxTileY}}class ht{constructor(e,o,u){this._meshCache={},this.painter=e,this.sourceCache=new rt(o),this.options=u,this.exaggeration=typeof u.exaggeration=="number"?u.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,o,u,d=l.$){var y;if(!(o>=0&&o<d&&u>=0&&u<d))return 0;const x=this.getTerrainData(e),S=(y=x.tile)===null||y===void 0?void 0:y.dem;if(!S)return 0;const k=l.cs([],[o/d*l.$,u/d*l.$],x.u_terrain_matrix),A=[k[0]*S.dim,k[1]*S.dim],E=Math.floor(A[0]),L=Math.floor(A[1]),R=A[0]-E,F=A[1]-L;return S.get(E,L)*(1-R)*(1-F)+S.get(E+1,L)*R*(1-F)+S.get(E,L+1)*(1-R)*F+S.get(E+1,L+1)*R*F}getElevationForLngLatZoom(e,o){if(!l.ct(o,e.wrap()))return 0;const{tileID:u,mercatorX:d,mercatorY:y}=this._getOverscaledTileIDFromLngLatZoom(e,o);return this.getElevation(u,d%l.$,y%l.$,l.$)}getElevation(e,o,u,d=l.$){return this.getDEMElevation(e,o,u,d)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const d=this.painter.context,y=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new l.T(d,y,d.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new l.T(d,new l.R({width:1,height:1}),d.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.ag([])}const o=this.sourceCache.getSourceTile(e,!0);if(o&&o.dem&&(!o.demTexture||o.needsTerrainPrepare)){const d=this.painter.context;o.demTexture=this.painter.getTileTexture(o.dem.stride),o.demTexture?o.demTexture.update(o.dem.getPixels(),{premultiply:!1}):o.demTexture=new l.T(d,o.dem.getPixels(),d.gl.RGBA,{premultiply:!1}),o.demTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),o.needsTerrainPrepare=!1}const u=o&&o+o.tileID.key+e.key;if(u&&!this._demMatrixCache[u]){const d=this.sourceCache.sourceCache._source.maxzoom;let y=e.canonical.z-o.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=d?y=e.canonical.z-d:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const x=e.canonical.x-(e.canonical.x>>y<<y),S=e.canonical.y-(e.canonical.y>>y<<y),k=l.cu(new Float64Array(16),[1/(l.$<<y),1/(l.$<<y),0]);l.M(k,k,[x*l.$,S*l.$,0]),this._demMatrixCache[e.key]={matrix:k,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:o&&o.dem&&o.dem.dim||1,u_terrain_matrix:u?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:o&&o.dem&&o.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(o&&o.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:o}}getFramebuffer(e){const o=this.painter,u=o.width/devicePixelRatio,d=o.height/devicePixelRatio;return!this._fbo||this._fbo.width===u&&this._fbo.height===d||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new l.T(o.context,{width:u,height:d,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new l.T(o.context,{width:u,height:d,data:null},o.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(o.context.gl.NEAREST,o.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=o.context.createFramebuffer(u,d,!0,!1),this._fbo.depthAttachment.set(o.context.createRenderbuffer(o.context.gl.DEPTH_COMPONENT16,u,d))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const o=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let y=0,x=0;y<this._coordsTextureSize;y++)for(let S=0;S<this._coordsTextureSize;S++,x+=4)o[x+0]=255&S,o[x+1]=255&y,o[x+2]=S>>8<<4|y>>8,o[x+3]=0;const u=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(o.buffer)),d=new l.T(e,u,e.gl.RGBA,{premultiply:!1});return d.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=d,d}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const o=new Uint8Array(4),u=this.painter.context,d=u.gl,y=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),x=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),S=Math.round(this.painter.height/devicePixelRatio);u.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),d.readPixels(y,S-x-1,1,1,d.RGBA,d.UNSIGNED_BYTE,o),u.bindFramebuffer.set(null);const k=o[0]+(o[2]>>4<<8),A=o[1]+((15&o[2])<<8),E=this.coordsIndex[255-o[3]],L=E&&this.sourceCache.getTileByID(E);if(!L)return null;const R=this._coordsTextureSize,F=(1<<L.tileID.canonical.z)*R;return new l.a1((L.tileID.canonical.x*R+k)/F+L.tileID.wrap,(L.tileID.canonical.y*R+A)/F,this.getElevation(L.tileID,k,A,R))}depthAtPoint(e){const o=new Uint8Array(4),u=this.painter.context,d=u.gl;return u.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),d.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,d.RGBA,d.UNSIGNED_BYTE,o),u.bindFramebuffer.set(null),(o[0]/16777216+o[1]/65536+o[2]/256+o[3])/256}getTerrainMesh(e){var o;const u=((o=this.painter.style.projection)===null||o===void 0?void 0:o.transitionState)>0,d=u&&e.canonical.y===0,y=u&&e.canonical.y===(1<<e.canonical.z)-1,x=`m_${d?"n":""}_${y?"s":""}`;if(this._meshCache[x])return this._meshCache[x];const S=this.painter.context,k=new l.cv,A=new l.aN,E=this.meshSize,L=l.$/E,R=E*E;for(let te=0;te<=E;te++)for(let de=0;de<=E;de++)k.emplaceBack(de*L,te*L,0);for(let te=0;te<R;te+=E+1)for(let de=0;de<E;de++)A.emplaceBack(de+te,E+de+te+1,E+de+te+2),A.emplaceBack(de+te,E+de+te+2,de+te+1);const F=k.length,U=F+(E+1),K=(E+1)*E,X=d?l.bh:0,Y=d?0:1,Q=y?l.bi:l.$,ie=y?0:1;for(let te=0;te<=E;te++)k.emplaceBack(te*L,X,Y);for(let te=0;te<=E;te++)k.emplaceBack(te*L,Q,ie);for(let te=0;te<E;te++)A.emplaceBack(K+te,U+te,U+te+1),A.emplaceBack(K+te,U+te+1,K+te+1),A.emplaceBack(0+te,F+te+1,F+te),A.emplaceBack(0+te,0+te+1,F+te+1);const ee=k.length,oe=ee+2*(E+1);for(const te of[0,1])for(let de=0;de<=E;de++)for(const Ce of[0,1])k.emplaceBack(te*l.$,de*L,Ce);for(let te=0;te<2*E;te+=2)A.emplaceBack(ee+te,ee+te+1,ee+te+3),A.emplaceBack(ee+te,ee+te+3,ee+te+2),A.emplaceBack(oe+te,oe+te+3,oe+te+1),A.emplaceBack(oe+te,oe+te+2,oe+te+3);const le=new Ja(S.createVertexBuffer(k,lc.members),S.createIndexBuffer(A),l.aM.simpleSegment(0,0,k.length,A.length));return this._meshCache[x]=le,le}getMeshFrameDelta(e){return 2*Math.PI*l.bu/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,o){var u;const{tileID:d}=this._getOverscaledTileIDFromLngLatZoom(e,o);return(u=this.getMinMaxElevation(d).minElevation)!==null&&u!==void 0?u:0}getMinMaxElevation(e){const o=this.getTerrainData(e).tile,u={minElevation:null,maxElevation:null};return o&&o.dem&&(u.minElevation=o.dem.min*this.exaggeration,u.maxElevation=o.dem.max*this.exaggeration),u}_getOverscaledTileIDFromLngLatZoom(e,o){const u=l.a1.fromLngLat(e.wrap()),d=(1<<o)*l.$,y=u.x*d,x=u.y*d,S=Math.floor(y/l.$),k=Math.floor(x/l.$);return{tileID:new l.Z(o,0,o,S,k),mercatorX:y,mercatorY:x}}}class cc{constructor(e,o,u){this._context=e,this._size=o,this._tileSize=u,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const o=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),u=new l.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return u.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),o.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),o.colorAttachment.set(u.texture),{id:e,fbo:o,texture:u,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((o=>e.id!==o)),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const o of this._recentlyUsed)if(!this._objects[o].inUse)return this._objects[o];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((e=>!e.inUse))===!1}}const Da={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class uc{constructor(e,o){this.painter=e,this.terrain=o,this.pool=new cc(e.context,30,o.sourceCache.tileSize*o.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,o){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter((u=>!e._layers[u].isHidden(o))),this._coordsAscending={};for(const u in e.sourceCaches){this._coordsAscending[u]={};const d=e.sourceCaches[u].getVisibleCoordinates(),y=e.sourceCaches[u].getSource(),x=y instanceof Fn?y.terrainTileRanges:null;for(const S of d){const k=this.terrain.sourceCache.getTerrainCoords(S,x);for(const A in k)this._coordsAscending[u][A]||(this._coordsAscending[u][A]=[]),this._coordsAscending[u][A].push(k[A])}}this._coordsAscendingStr={};for(const u of e._order){const d=e._layers[u],y=d.source;if(Da[d.type]&&!this._coordsAscendingStr[y]){this._coordsAscendingStr[y]={};for(const x in this._coordsAscending[y])this._coordsAscendingStr[y][x]=this._coordsAscending[y][x].map((S=>S.key)).sort().join()}}for(const u of this._renderableTiles)for(const d in this._coordsAscendingStr){const y=this._coordsAscendingStr[d][u.tileID.key];y&&y!==u.rttCoords[d]&&(u.rtt=[])}}renderLayer(e,o){if(e.isHidden(this.painter.transform.zoom))return!1;const u=Object.assign(Object.assign({},o),{isRenderingToTexture:!0}),d=e.type,y=this.painter,x=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(Da[d]&&(this._prevType&&Da[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(e.id),!x))return!0;if(Da[this._prevType]||Da[d]&&x){this._prevType=d;const S=this._stacks.length-1,k=this._stacks[S]||[];for(const A of this._renderableTiles){if(this.pool.isFull()&&(rc(this.painter,this.terrain,this._rttTiles,u),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(A),A.rtt[S]){const L=this.pool.getObjectForId(A.rtt[S].id);if(L.stamp===A.rtt[S].stamp){this.pool.useObject(L);continue}}const E=this.pool.getOrCreateFreeObject();this.pool.useObject(E),this.pool.stampObject(E),A.rtt[S]={id:E.id,stamp:E.stamp},y.context.bindFramebuffer.set(E.fbo.framebuffer),y.context.clear({color:l.bf.transparent,stencil:0}),y.currentStencilSource=void 0;for(let L=0;L<k.length;L++){const R=y.style._layers[k[L]],F=R.source?this._coordsAscending[R.source][A.tileID.key]:[A.tileID];y.context.viewport.set([0,0,E.fbo.width,E.fbo.height]),y._renderTileClippingMasks(R,F,!0),y.renderLayer(y,y.style.sourceCaches[R.source],R,F,u),R.source&&(A.rttCoords[R.source]=this._coordsAscendingStr[R.source][A.tileID.key])}}return rc(this.painter,this.terrain,this._rttTiles,u),this._rttTiles=[],this.pool.freeAllObjects(),Da[d]}return!1}}const Ti={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},id=C,rn={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Ku,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},mm={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Hs{constructor(e,o,u=!1){this.mousedown=y=>{this.startMove(y,$.mousePos(this.element,y)),$.addEventListener(window,"mousemove",this.mousemove),$.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=y=>{this.move(y,$.mousePos(this.element,y))},this.mouseup=y=>{this._rotatePitchHandler.dragEnd(y),this.offTemp()},this.touchstart=y=>{y.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=$.touchPos(this.element,y.targetTouches)[0],this.startMove(y,this._startPos),$.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),$.addEventListener(window,"touchend",this.touchend))},this.touchmove=y=>{y.targetTouches.length!==1?this.reset():(this._lastPos=$.touchPos(this.element,y.targetTouches)[0],this.move(y,this._lastPos))},this.touchend=y=>{y.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=o;const d=new pm;this._rotatePitchHandler=new Xo({clickTolerance:3,move:(y,x)=>{const S=o.getBoundingClientRect(),k=new l.P((S.bottom-S.top)/2,(S.right-S.left)/2);return{bearingDelta:l.cn(new l.P(y.x,x.y),x,k),pitchDelta:u?-.5*(x.y-y.y):void 0}},moveStateManager:d,enable:!0,assignEvents:()=>{}}),this.map=e,$.addEventListener(o,"mousedown",this.mousedown),$.addEventListener(o,"touchstart",this.touchstart,{passive:!1}),$.addEventListener(o,"touchcancel",this.reset)}startMove(e,o){this._rotatePitchHandler.dragStart(e,o),$.disableDrag()}move(e,o){const u=this.map,{bearingDelta:d,pitchDelta:y}=this._rotatePitchHandler.dragMove(e,o)||{};d&&u.setBearing(u.getBearing()+d),y&&u.setPitch(u.getPitch()+y)}off(){const e=this.element;$.removeEventListener(e,"mousedown",this.mousedown),$.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),$.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),$.removeEventListener(window,"touchend",this.touchend),$.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){$.enableDrag(),$.removeEventListener(window,"mousemove",this.mousemove),$.removeEventListener(window,"mouseup",this.mouseup),$.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),$.removeEventListener(window,"touchend",this.touchend)}}let ir;function Ar(g,e,o,u=!1){if(u||!o.getCoveringTilesDetailsProvider().allowWorldCopies())return g?.wrap();const d=new l.S(g.lng,g.lat);if(g=new l.S(g.lng,g.lat),e){const y=new l.S(g.lng-360,g.lat),x=new l.S(g.lng+360,g.lat),S=o.locationToScreenPoint(g).distSqr(e);o.locationToScreenPoint(y).distSqr(e)<S?g=y:o.locationToScreenPoint(x).distSqr(e)<S&&(g=x)}for(;Math.abs(g.lng-o.center.lng)>180;){const y=o.locationToScreenPoint(g);if(y.x>=0&&y.y>=0&&y.x<=o.width&&y.y<=o.height)break;g.lng>o.center.lng?g.lng-=360:g.lng+=360}return g.lng!==d.lng&&o.isPointOnMapSurface(o.locationToScreenPoint(g))?g:d}const hc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Qo(g,e,o){const u=g.classList;for(const d in hc)u.remove(`maplibregl-${o}-anchor-${d}`);u.add(`maplibregl-${o}-anchor-${e}`)}class es extends l.E{constructor(e){if(super(),this._onKeyPress=o=>{const u=o.code,d=o.charCode||o.keyCode;u!=="Space"&&u!=="Enter"&&d!==32&&d!==13||this.togglePopup()},this._onMapClick=o=>{const u=o.originalEvent.target,d=this._element;this._popup&&(u===d||d.contains(u))&&this.togglePopup()},this._update=o=>{if(!this._map)return;const u=this._map.loaded()&&!this._map.isMoving();(o?.type==="terrain"||o?.type==="render"&&!u)&&this._map.once("render",this._update),this._lngLat=Ar(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(d=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let y="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?y="rotateX(0deg)":this._pitchAlignment==="map"&&(y=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||o&&o.type!=="moveend"||(this._pos=this._pos.round()),$.setTransform(this._element,`${hc[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${y} ${d}`),Z.frameAsync(new AbortController).then((()=>{this._updateOpacity(o&&o.type==="moveend")})).catch((()=>{}))},this._onMove=o=>{if(!this._isDragging){const u=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=u}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.l("dragstart"))),this.fire(new l.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.l("dragend")),this._state="inactive"},this._addDragHandler=o=>{this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=l.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=$.create("div");const o=$.createNS("http://www.w3.org/2000/svg","svg"),u=41,d=27;o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height",`${u}px`),o.setAttributeNS(null,"width",`${d}px`),o.setAttributeNS(null,"viewBox",`0 0 ${d} ${u}`);const y=$.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd");const x=$.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"fill-rule","nonzero");const S=$.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"transform","translate(3.0, 29.0)"),S.setAttributeNS(null,"fill","#000000");const k=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Y of k){const Q=$.createNS("http://www.w3.org/2000/svg","ellipse");Q.setAttributeNS(null,"opacity","0.04"),Q.setAttributeNS(null,"cx","10.5"),Q.setAttributeNS(null,"cy","5.80029008"),Q.setAttributeNS(null,"rx",Y.rx),Q.setAttributeNS(null,"ry",Y.ry),S.appendChild(Q)}const A=$.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill",this._color);const E=$.createNS("http://www.w3.org/2000/svg","path");E.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),A.appendChild(E);const L=$.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"opacity","0.25"),L.setAttributeNS(null,"fill","#000000");const R=$.createNS("http://www.w3.org/2000/svg","path");R.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),L.appendChild(R);const F=$.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"transform","translate(6.0, 7.0)"),F.setAttributeNS(null,"fill","#FFFFFF");const U=$.createNS("http://www.w3.org/2000/svg","g");U.setAttributeNS(null,"transform","translate(8.0, 8.0)");const K=$.createNS("http://www.w3.org/2000/svg","circle");K.setAttributeNS(null,"fill","#000000"),K.setAttributeNS(null,"opacity","0.25"),K.setAttributeNS(null,"cx","5.5"),K.setAttributeNS(null,"cy","5.5"),K.setAttributeNS(null,"r","5.4999962");const X=$.createNS("http://www.w3.org/2000/svg","circle");X.setAttributeNS(null,"fill","#FFFFFF"),X.setAttributeNS(null,"cx","5.5"),X.setAttributeNS(null,"cy","5.5"),X.setAttributeNS(null,"r","5.4999962"),U.appendChild(K),U.appendChild(X),x.appendChild(S),x.appendChild(A),x.appendChild(L),x.appendChild(F),x.appendChild(U),o.appendChild(x),o.setAttributeNS(null,"height",u*this._scale+"px"),o.setAttributeNS(null,"width",d*this._scale+"px"),this._element.appendChild(o),this._offset=l.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(o=>{o.preventDefault()})),this._element.addEventListener("mousedown",(o=>{o.preventDefault()})),Qo(this._element,this._anchor,"marker"),e&&e.className)for(const o of e.className.split(" "))this._element.classList.add(o);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),$.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=l.S.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const d=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(38.1-13.5+d)],"bottom-right":[-d,-1*(38.1-13.5+d)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var o,u;const d=(o=this._map)===null||o===void 0?void 0:o.terrain,y=this._map.transform.isLocationOccluded(this._lngLat);if(!d||y){const F=y?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==F&&(this._element.style.opacity=F))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const x=this._map,S=x.terrain.depthAtPoint(this._pos),k=x.terrain.getElevationForLngLatZoom(this._lngLat,x.transform.tileZoom);if(x.transform.lngLatToCameraDepth(this._lngLat,k)-S<.006)return void(this._element.style.opacity=this._opacity);const A=-this._offset.y/x.transform.pixelsPerMeter,E=Math.sin(x.getPitch()*Math.PI/180)*A,L=x.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),R=x.transform.lngLatToCameraDepth(this._lngLat,k+E)-L>.006;!((u=this._popup)===null||u===void 0)&&u.isOpen()&&R&&this._popup.remove(),this._element.style.opacity=R?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=l.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,o){return(this._opacity===void 0||e===void 0&&o===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),o!==void 0&&(this._opacityWhenCovered=o),this._map&&this._updateOpacity(!0),this}}const Ju={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ts=0,fo=!1;const Xs={maxWidth:100,unit:"metric"};function pc(g,e,o){const u=o&&o.maxWidth||100,d=g._container.clientHeight/2,y=g._container.clientWidth/2,x=g.unproject([y-u/2,d]),S=g.unproject([y+u/2,d]),k=Math.round(g.project(S).x-g.project(x).x),A=Math.min(u,k,g._container.clientWidth),E=x.distanceTo(S);if(o&&o.unit==="imperial"){const L=3.2808*E;L>5280?mo(e,A,L/5280,g._getUIString("ScaleControl.Miles")):mo(e,A,L,g._getUIString("ScaleControl.Feet"))}else o&&o.unit==="nautical"?mo(e,A,E/1852,g._getUIString("ScaleControl.NauticalMiles")):E>=1e3?mo(e,A,E/1e3,g._getUIString("ScaleControl.Kilometers")):mo(e,A,E,g._getUIString("ScaleControl.Meters"))}function mo(g,e,o,u){const d=(function(y){const x=Math.pow(10,`${Math.floor(y)}`.length-1);let S=y/x;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:(function(k){const A=Math.pow(10,Math.ceil(-Math.log(k)/Math.LN10));return Math.round(k*A)/A})(S),x*S})(o);g.style.width=e*(d/o)+"px",g.innerHTML=`${d}&nbsp;${u}`}const Qu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},eh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function dc(g){if(g){if(typeof g=="number"){const e=Math.round(Math.abs(g)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,g),"top-left":new l.P(e,e),"top-right":new l.P(-e,e),bottom:new l.P(0,-g),"bottom-left":new l.P(e,-e),"bottom-right":new l.P(-e,-e),left:new l.P(g,0),right:new l.P(-g,0)}}if(g instanceof l.P||Array.isArray(g)){const e=l.P.convert(g);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:l.P.convert(g.center||[0,0]),top:l.P.convert(g.top||[0,0]),"top-left":l.P.convert(g["top-left"]||[0,0]),"top-right":l.P.convert(g["top-right"]||[0,0]),bottom:l.P.convert(g.bottom||[0,0]),"bottom-left":l.P.convert(g["bottom-left"]||[0,0]),"bottom-right":l.P.convert(g["bottom-right"]||[0,0]),left:l.P.convert(g.left||[0,0]),right:l.P.convert(g.right||[0,0])}}return dc(new l.P(0,0))}const th=C;f.AJAXError=l.cz,f.Event=l.l,f.Evented=l.E,f.LngLat=l.S,f.MercatorCoordinate=l.a1,f.Point=l.P,f.addProtocol=l.cA,f.config=l.a,f.removeProtocol=l.cB,f.AttributionControl=Yu,f.BoxZoomHandler=Vu,f.CanvasSource=xa,f.CooperativeGesturesHandler=ed,f.DoubleClickZoomHandler=Zu,f.DragPanHandler=Jp,f.DragRotateHandler=Hu,f.EdgeInsets=eo,f.FullscreenControl=class extends l.E{constructor(g={}){super(),this._onFullscreenChange=()=>{var e;let o=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=o?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)o=o.shadowRoot.fullscreenElement;o===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){$.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const g=this._fullscreenButton=$.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);$.create("span","maplibregl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.title=g}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},f.GeoJSONSource=jn,f.GeolocateControl=class extends l.E{constructor(g){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new l.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const o=new l.S(e.coords.longitude,e.coords.latitude),u=e.coords.accuracy,d=this._map.getBearing(),y=l.e({bearing:d},this.options.fitBoundsOptions),x=Ht.fromLngLat(o,u);this._map.fitBounds(x,y,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const o=new l.S(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&fo)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=$.create("button","maplibregl-ctrl-geolocate",this._container),$.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=$.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new es({element:this._dotElement}),this._circleElement=$.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new es({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(o=>{const u=o?.[0]instanceof ResizeObserverEntry;o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||u||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.l("trackuserlocationend")),this.fire(new l.l("userlocationlostfocus")))}))}},this.options=l.e({},Ju,g)}onAdd(g){return this._map=g,this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return l._(this,arguments,void 0,(function*(e=!1){if(ir!==void 0&&!e)return ir;if(window.navigator.permissions===void 0)return ir=!!window.navigator.geolocation,ir;try{ir=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ir=!!window.navigator.geolocation}return ir}))})().then((e=>this._finishSetupUI(e))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),$.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ts=0,fo=!1}_isOutOfMapMaxBounds(g){const e=this._map.getMaxBounds(),o=g.coords;return e&&(o.longitude<e.getWest()||o.longitude>e.getEast()||o.latitude<e.getSouth()||o.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const g=this._map.getBounds(),e=g.getSouthEast(),o=g.getNorthEast(),u=e.distanceTo(o),d=Math.ceil(this._accuracy/(u/this._map._container.clientHeight)*2);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ts--,fo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.l("trackuserlocationstart")),this.fire(new l.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ts++,ts>1?(g={maximumAge:6e5,timeout:0},fo=!0):(g=this.options.positionOptions,fo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,g)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},f.GlobeControl=class{constructor(){this._toggleProjection=()=>{var g;const e=(g=this._map.getProjection())===null||g===void 0?void 0:g.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var g;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((g=this._map.getProjection())===null||g===void 0?void 0:g.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(g){return this._map=g,this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=$.create("button","maplibregl-ctrl-globe",this._container),$.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){$.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},f.Hash=ic,f.ImageSource=Fn,f.KeyboardHandler=oc,f.LngLatBounds=Ht,f.LogoControl=rd,f.Map=class extends td{constructor(g){var e,o;l.cw.mark(l.cx.create);const u=Object.assign(Object.assign(Object.assign({},rn),g),{canvasContextAttributes:Object.assign(Object.assign({},rn.canvasContextAttributes),g.canvasContextAttributes)});if(u.minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const d=new sr,y=new mi;if(u.minZoom!==void 0&&d.setMinZoom(u.minZoom),u.maxZoom!==void 0&&d.setMaxZoom(u.maxZoom),u.minPitch!==void 0&&d.setMinPitch(u.minPitch),u.maxPitch!==void 0&&d.setMaxPitch(u.maxPitch),u.renderWorldCopies!==void 0&&d.setRenderWorldCopies(u.renderWorldCopies),super(d,y,{bearingSnap:u.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Vn,this._controls=[],this._mapId=l.a7(),this._contextLost=S=>{S.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new l.l("webglcontextlost",{originalEvent:S}))},this._contextRestored=S=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.l("webglcontextrestored",{originalEvent:S}))},this._onMapScroll=S=>{if(S.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=u.interactive,this._maxTileCacheSize=u.maxTileCacheSize,this._maxTileCacheZoomLevels=u.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},u.canvasContextAttributes),this._trackResize=u.trackResize===!0,this._bearingSnap=u.bearingSnap,this._centerClampedToGround=u.centerClampedToGround,this._refreshExpiredTiles=u.refreshExpiredTiles===!0,this._fadeDuration=u.fadeDuration,this._crossSourceCollisions=u.crossSourceCollisions===!0,this._collectResourceTiming=u.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Ti),u.locale),this._clickTolerance=u.clickTolerance,this._overridePixelRatio=u.pixelRatio,this._maxCanvasSize=u.maxCanvasSize,this.transformCameraUpdate=u.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=u.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=ve.addThrottleControl((()=>this.isMoving())),this._requestManager=new ye(u.transformRequest),typeof u.container=="string"){if(this._container=document.getElementById(u.container),!this._container)throw new Error(`Container '${u.container}' not found.`)}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(u.maxBounds&&this.setMaxBounds(u.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let S=!1;const k=ho((A=>{this._trackResize&&!this._removed&&(this.resize(A),this.redraw())}),50);this._resizeObserver=new ResizeObserver((A=>{S?k(A):S=!0})),this._resizeObserver.observe(this._container)}this.handlers=new Xu(this,u),this._hash=u.hash&&new ic(typeof u.hash=="string"&&u.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:u.center,elevation:u.elevation,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch,roll:u.roll}),u.bounds&&(this.resize(),this.fitBounds(u.bounds,l.e({},u.fitBoundsOptions,{duration:0}))));const x=typeof u.style=="string"||((o=(e=u.style)===null||e===void 0?void 0:e.projection)===null||o===void 0?void 0:o.type)!=="globe";this.resize(null,x),this._localIdeographFontFamily=u.localIdeographFontFamily,this._validateStyle=u.validateStyle,u.style&&this.setStyle(u.style,{localIdeographFontFamily:u.localIdeographFontFamily}),u.attributionControl&&this.addControl(new Yu(typeof u.attributionControl=="boolean"?void 0:u.attributionControl)),u.maplibreLogo&&this.addControl(new rd,u.logoPosition),this.on("style.load",(()=>{if(x||this._resizeTransform(),this.transform.unmodified){const S=l.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(S)}})),this.on("data",(S=>{this._update(S.dataType==="style"),this.fire(new l.l(`${S.dataType}data`,S))})),this.on("dataloading",(S=>{this.fire(new l.l(`${S.dataType}dataloading`,S))})),this.on("dataabort",(S=>{this.fire(new l.l("sourcedataabort",S))}))}_getMapId(){return this._mapId}setGlobalStateProperty(g,e){return this.style.setGlobalStateProperty(g,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(g,e){if(e===void 0&&(e=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new l.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=g.onAdd(this);this._controls.push(g);const u=this._controlPositions[e];return e.indexOf("bottom")!==-1?u.insertBefore(o,u.firstChild):u.appendChild(o),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new l.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(g);return e>-1&&this._controls.splice(e,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}calculateCameraOptionsFromTo(g,e,o,u){return u==null&&this.terrain&&(u=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(g,e,o,u)}resize(g,e=!0){const[o,u]=this._containerDimensions(),d=this._getClampedPixelRatio(o,u);if(this._resizeCanvas(o,u,d),this.painter.resize(o,u,d),this.painter.overLimit()){const x=this.painter.context.gl;this._maxCanvasSize=[x.drawingBufferWidth,x.drawingBufferHeight];const S=this._getClampedPixelRatio(o,u);this._resizeCanvas(o,u,S),this.painter.resize(o,u,S)}this._resizeTransform(e);const y=!this._moving;return y&&(this.stop(),this.fire(new l.l("movestart",g)).fire(new l.l("move",g))),this.fire(new l.l("resize",g)),y&&this.fire(new l.l("moveend",g)),this}_resizeTransform(g=!0){var e;const[o,u]=this._containerDimensions();this.transform.resize(o,u,g),(e=this._requestedCameraState)===null||e===void 0||e.resize(o,u,g)}_getClampedPixelRatio(g,e){const{0:o,1:u}=this._maxCanvasSize,d=this.getPixelRatio(),y=g*d,x=e*d;return Math.min(y>o?o/y:1,x>u?u/x:1)*d}getPixelRatio(){var g;return(g=this._overridePixelRatio)!==null&&g!==void 0?g:devicePixelRatio}setPixelRatio(g){this._overridePixelRatio=g,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(g){return this.transform.setMaxBounds(Ht.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.setMinZoom(g),this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.setMaxZoom(g),this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.setMinPitch(g),this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(g>=this.transform.minPitch)return this.transform.setMaxPitch(g),this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.setRenderWorldCopies(g),this._update()}project(g){return this.transform.locationToScreenPoint(l.S.convert(g),this.style&&this.terrain)}unproject(g){return this.transform.screenPointToLocation(l.P.convert(g),this.terrain)}isMoving(){var g;return this._moving||((g=this.handlers)===null||g===void 0?void 0:g.isMoving())}isZooming(){var g;return this._zooming||((g=this.handlers)===null||g===void 0?void 0:g.isZooming())}isRotating(){var g;return this._rotating||((g=this.handlers)===null||g===void 0?void 0:g.isRotating())}_createDelegatedListener(g,e,o){if(g==="mouseenter"||g==="mouseover"){let u=!1;return{layers:e,listener:o,delegates:{mousemove:y=>{const x=e.filter((k=>this.getLayer(k))),S=x.length!==0?this.queryRenderedFeatures(y.point,{layers:x}):[];S.length?u||(u=!0,o.call(this,new ji(g,this,y.originalEvent,{features:S}))):u=!1},mouseout:()=>{u=!1}}}}if(g==="mouseleave"||g==="mouseout"){let u=!1;return{layers:e,listener:o,delegates:{mousemove:x=>{const S=e.filter((k=>this.getLayer(k)));(S.length!==0?this.queryRenderedFeatures(x.point,{layers:S}):[]).length?u=!0:u&&(u=!1,o.call(this,new ji(g,this,x.originalEvent)))},mouseout:x=>{u&&(u=!1,o.call(this,new ji(g,this,x.originalEvent)))}}}}{const u=d=>{const y=e.filter((S=>this.getLayer(S))),x=y.length!==0?this.queryRenderedFeatures(d.point,{layers:y}):[];x.length&&(d.features=x,o.call(this,d),delete d.features)};return{layers:e,listener:o,delegates:{[g]:u}}}}_saveDelegatedListener(g,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(e)}_removeDelegatedListener(g,e,o){if(!this._delegatedListeners||!this._delegatedListeners[g])return;const u=this._delegatedListeners[g];for(let d=0;d<u.length;d++){const y=u[d];if(y.listener===o&&y.layers.length===e.length&&y.layers.every((x=>e.includes(x)))){for(const x in y.delegates)this.off(x,y.delegates[x]);return void u.splice(d,1)}}}on(g,e,o){if(o===void 0)return super.on(g,e);const u=typeof e=="string"?[e]:e,d=this._createDelegatedListener(g,u,o);this._saveDelegatedListener(g,d);for(const y in d.delegates)this.on(y,d.delegates[y]);return{unsubscribe:()=>{this._removeDelegatedListener(g,u,o)}}}once(g,e,o){if(o===void 0)return super.once(g,e);const u=typeof e=="string"?[e]:e,d=this._createDelegatedListener(g,u,o);for(const y in d.delegates){const x=d.delegates[y];d.delegates[y]=(...S)=>{this._removeDelegatedListener(g,u,o),x(...S)}}this._saveDelegatedListener(g,d);for(const y in d.delegates)this.once(y,d.delegates[y]);return this}off(g,e,o){return o===void 0?super.off(g,e):(this._removeDelegatedListener(g,typeof e=="string"?[e]:e,o),this)}queryRenderedFeatures(g,e){if(!this.style)return[];let o;const u=g instanceof l.P||Array.isArray(g),d=u?g:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(u?{}:g)||{},d instanceof l.P||typeof d[0]=="number")o=[l.P.convert(d)];else{const y=l.P.convert(d[0]),x=l.P.convert(d[1]);o=[y,new l.P(x.x,y.y),x,new l.P(y.x,x.y),y]}return this.style.queryRenderedFeatures(o,e,this.transform)}querySourceFeatures(g,e){return this.style.querySourceFeatures(g,e)}setStyle(g,e){return(e=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(g,e))}setTransformRequest(g){return this._requestManager.setTransformRequest(g),this}_getUIString(g){const e=this._locale[g];if(e==null)throw new Error(`Missing UI string '${g}'`);return e}_updateStyle(g,e){var o,u;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(g,e)));const d=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!g)),g?(this.style=new _u(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g,e,d):this.style.loadJSON(g,e,d),this):((u=(o=this.style)===null||o===void 0?void 0:o.projection)===null||u===void 0||u.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new _u(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,e){if(typeof g=="string"){const o=this._requestManager.transformRequest(g,"Style");l.j(o,new AbortController).then((u=>{this._updateDiff(u.data,e)})).catch((u=>{u&&this.fire(new l.k(u))}))}else typeof g=="object"&&this._updateDiff(g,e)}_updateDiff(g,e){try{this.style.setState(g,e)&&this._update(!0)}catch(o){l.w(`Unable to perform style diff: ${o.message||o.error||o}.  Rebuilding the style from scratch.`),this._updateStyle(g,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(g,e){return this._lazyInitEmptyStyle(),this.style.addSource(g,e),this._update(!0)}isSourceLoaded(g){const e=this.style&&this.style.sourceCaches[g];if(e!==void 0)return e.loaded();this.fire(new l.k(new Error(`There is no source with ID '${g}'`)))}setTerrain(g){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),g){const e=this.style.sourceCaches[g.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${g.source}`);this.terrain===null&&e.reload();for(const o in this.style._layers){const u=this.style._layers[o];u.type==="hillshade"&&u.source===g.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),u.type==="color-relief"&&u.source===g.source&&l.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new ht(this.painter,e,g),this.painter.renderToTexture=new uc(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=o=>{var u;o.dataType==="style"?this.terrain.sourceCache.freeRtt():o.dataType==="source"&&o.tile&&(o.sourceId!==g.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((u=o.source)===null||u===void 0?void 0:u.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(o.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new l.l("terrain",{terrain:g})),this}getTerrain(){var g,e;return(e=(g=this.terrain)===null||g===void 0?void 0:g.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const g=this.style&&this.style.sourceCaches;for(const e in g){const o=g[e]._tiles;for(const u in o){const d=o[u];if(d.state!=="loaded"&&d.state!=="errored")return!1}}return!0}removeSource(g){return this.style.removeSource(g),this._update(!0)}getSource(g){return this.style.getSource(g)}setSourceTileLodParams(g,e,o){if(o){const u=this.getSource(o);if(!u)throw new Error(`There is no source with ID "${o}", cannot set LOD parameters`);u.calculateTileZoom=je(Math.max(1,g),Math.max(1,e))}else for(const u in this.style.sourceCaches)this.style.sourceCaches[u].getSource().calculateTileZoom=je(Math.max(1,g),Math.max(1,e));return this._update(!0),this}refreshTiles(g,e){const o=this.style.sourceCaches[g];if(!o)throw new Error(`There is no source cache with ID "${g}", cannot refresh tile`);e===void 0?o.reload(!0):o.refreshTiles(e.map((u=>new l.a4(u.z,u.x,u.y))))}addImage(g,e,o={}){const{pixelRatio:u=1,sdf:d=!1,stretchX:y,stretchY:x,content:S,textFitWidth:k,textFitHeight:A}=o;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||l.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new l.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:E,height:L,data:R}=e,F=e;return this.style.addImage(g,{data:new l.R({width:E,height:L},new Uint8Array(R)),pixelRatio:u,stretchX:y,stretchY:x,content:S,textFitWidth:k,textFitHeight:A,sdf:d,version:0,userImage:F}),F.onAdd&&F.onAdd(this,g),this}}{const{width:E,height:L,data:R}=Z.getImageData(e);this.style.addImage(g,{data:new l.R({width:E,height:L},R),pixelRatio:u,stretchX:y,stretchY:x,content:S,textFitWidth:k,textFitHeight:A,sdf:d,version:0})}}updateImage(g,e){const o=this.style.getImage(g);if(!o)return this.fire(new l.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const u=e instanceof HTMLImageElement||l.b(e)?Z.getImageData(e):e,{width:d,height:y,data:x}=u;if(d===void 0||y===void 0)return this.fire(new l.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(d!==o.data.width||y!==o.data.height)return this.fire(new l.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const S=!(e instanceof HTMLImageElement||l.b(e));return o.data.replace(x,S),this.style.updateImage(g,o),this}getImage(g){return this.style.getImage(g)}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new l.k(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g){return ve.getImage(this._requestManager.transformRequest(g,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(g,e){return this._lazyInitEmptyStyle(),this.style.addLayer(g,e),this._update(!0)}moveLayer(g,e){return this.style.moveLayer(g,e),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(g,e,o){return this.style.setLayerZoomRange(g,e,o),this._update(!0)}setFilter(g,e,o={}){return this.style.setFilter(g,e,o),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,e,o,u={}){return this.style.setPaintProperty(g,e,o,u),this._update(!0)}getPaintProperty(g,e){return this.style.getPaintProperty(g,e)}setLayoutProperty(g,e,o,u={}){return this.style.setLayoutProperty(g,e,o,u),this._update(!0)}getLayoutProperty(g,e){return this.style.getLayoutProperty(g,e)}setGlyphs(g,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(g,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(g,e,o={}){return this._lazyInitEmptyStyle(),this.style.addSprite(g,e,o,(u=>{u||this._update(!0)})),this}removeSprite(g){return this._lazyInitEmptyStyle(),this.style.removeSprite(g),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(g,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(g,e,(o=>{o||this._update(!0)})),this}setLight(g,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(g,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(g,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(g,e){return this.style.setFeatureState(g,e),this._update()}removeFeatureState(g,e){return this.style.removeFeatureState(g,e),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let g=0,e=0;return this._container&&(g=this._container.clientWidth||400,e=this._container.clientHeight||300),[g,e]}_setupContainer(){const g=this._container;g.classList.add("maplibregl-map");const e=this._canvasContainer=$.create("div","maplibregl-canvas-container",g);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=$.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const o=this._containerDimensions(),u=this._getClampedPixelRatio(o[0],o[1]);this._resizeCanvas(o[0],o[1],u);const d=this._controlContainer=$.create("div","maplibregl-control-container",g),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((x=>{y[x]=$.create("div",`maplibregl-ctrl-${x} `,d)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,e,o){this._canvas.width=Math.floor(o*g),this._canvas.height=Math.floor(o*e),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const g=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",(u=>{e={requestedAttributes:g},u&&(e.statusMessage=u.statusMessage,e.type=u.type)}),{once:!0});let o=null;if(o=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,g):this._canvas.getContext("webgl2",g)||this._canvas.getContext("webgl",g),!o){const u="Failed to initialize WebGL";throw e?(e.message=u,new Error(JSON.stringify(e))):new Error(u)}this.painter=new Np(o,this.transform),ne.testSupport(o)}migrateProjection(g,e){super.migrateProjection(g,e),this.painter.transform=g,this.fire(new l.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_render(g){var e,o,u,d,y;const x=this._idleTriggered?this._fadeDuration:0,S=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),this._removed)return;let k=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const L=this.transform.zoom,R=Z.now();this.style.zoomHistory.update(L,R);const F=new l.F(L,{now:R,fadeDuration:x,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),U=F.crossFadingFactor();U===1&&U===this._crossFadingFactor||(k=!0,this._crossFadingFactor=U),this.style.update(F)}const A=((o=this.style.projection)===null||o===void 0?void 0:o.transitionState)>0!==S;(u=this.style.projection)===null||u===void 0||u.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((d=this.style.projection)===null||d===void 0?void 0:d.transitionState,(y=this.style.projection)===null||y===void 0?void 0:y.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||A)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,x,this._crossSourceCollisions,A),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,showPadding:this.showPadding}),this.fire(new l.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.cw.mark(l.cx.load),this.fire(new l.l("load"))),this.style&&(this.style.hasTransitions()||k)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const E=this._sourcesDirty||this._styleDirty||this._placementDirty;return E||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.l("idle")),!this._loaded||this._fullyLoaded||E||(this._fullyLoaded=!0,l.cw.mark(l.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var g;this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ve.removeThrottleControl(this._imageQueueHandle),(g=this._resizeObserver)===null||g===void 0||g.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),$.remove(this._canvasContainer),$.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),l.cw.clearMetrics(),this._removed=!0,this.fire(new l.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Z.frame(this._frameRequest,(g=>{l.cw.frame(g),this._frameRequest=null;try{this._render(g)}catch(e){if(!l.cy(e)&&!(function(o){return o.message===Os})(e))throw e}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get version(){return id}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(g){return this._lazyInitEmptyStyle(),this.style.setProjection(g),this._update(!0)}},f.MapMouseEvent=ji,f.MapTouchEvent=Zo,f.MapWheelEvent=Uu,f.Marker=es,f.NavigationControl=class{constructor(g){this._updateZoomButtons=()=>{const e=this._map.getZoom(),o=e===this._map.getMaxZoom(),u=e===this._map.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,o)=>{const u=this._map._getUIString(`NavigationControl.${o}`);e.title=u,e.setAttribute("aria-label",u)},this.options=l.e({},mm,g),this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),$.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),$.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})),this._compassIcon=$.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Hs(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){$.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(g,e){const o=$.create("button",g,this._container);return o.type="button",o.addEventListener("click",e),o}},f.Popup=class extends l.E{constructor(g){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&$.remove(this._content),this._container&&($.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=$.create("div","maplibregl-popup",this._map.getContainer()),this._tip=$.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const x of this.options.className.split(" "))this._container.classList.add(x);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Ar(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const o=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let u=this.options.anchor;const d=dc(this.options.offset);if(!u){const x=this._container.offsetWidth,S=this._container.offsetHeight;let k;k=o.y+d.bottom.y<S?["top"]:o.y>this._map.transform.height-S?["bottom"]:[],o.x<x/2?k.push("left"):o.x>this._map.transform.width-x/2&&k.push("right"),u=k.length===0?"bottom":k.join("-")}let y=o.add(d[u]);this.options.subpixelPositioning||(y=y.round()),$.setTransform(this._container,`${hc[u]} translate(${y.x}px,${y.y}px)`),Qo(this._container,u,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(Qu),g)}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(g){return this._lngLat=l.S.convert(g),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const e=document.createDocumentFragment(),o=document.createElement("body");let u;for(o.innerHTML=g;u=o.firstChild,u;)e.appendChild(u);return this.setDOMContent(e)}getMaxWidth(){var g;return(g=this._container)===null||g===void 0?void 0:g.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=$.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(g),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(g){return this._container&&this._container.classList.add(g),this}removeClassName(g){return this._container&&this._container.classList.remove(g),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){if(this._container)return this._container.classList.toggle(g)}setSubpixelPositioning(g){this.options.subpixelPositioning=g}_createCloseButton(){this.options.closeButton&&(this._closeButton=$.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(eh);g&&g.focus()}},f.RasterDEMTileSource=Xa,f.RasterTileSource=Li,f.ScaleControl=class{constructor(g){this._onMove=()=>{pc(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,pc(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Xs),g)}getDefaultPosition(){return"bottom-left"}onAdd(g){return this._map=g,this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-scale",g.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){$.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},f.ScrollZoomHandler=Kp,f.Style=_u,f.TerrainControl=class{constructor(g){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=g}onAdd(g){return this._map=g,this._container=$.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=$.create("button","maplibregl-ctrl-terrain",this._container),$.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){$.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},f.TwoFingersTouchPitchHandler=ac,f.TwoFingersTouchRotateHandler=Yo,f.TwoFingersTouchZoomHandler=nc,f.TwoFingersTouchZoomRotateHandler=Qp,f.VectorTileSource=Ur,f.VideoSource=zo,f.addSourceType=(g,e)=>l._(void 0,void 0,void 0,(function*(){if(Ta(g))throw new Error(`A source type called "${g}" already exists.`);((o,u)=>{wa[o]=u})(g,e)})),f.clearPrewarmedResources=function(){const g=Ot;g&&(g.isPreloaded()&&g.numActive()===1?(g.release(Ye),Ot=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},f.createTileMesh=gu,f.getMaxParallelImageRequests=function(){return l.a.MAX_PARALLEL_IMAGE_REQUESTS},f.getRTLTextPluginStatus=function(){return Ca().getRTLTextPluginStatus()},f.getVersion=function(){return th},f.getWorkerCount=function(){return st.workerCount},f.getWorkerUrl=function(){return l.a.WORKER_URL},f.importScriptInWorkers=function(g){return yr().broadcast("IS",g)},f.prewarm=function(){pr().acquire(Ye)},f.setMaxParallelImageRequests=function(g){l.a.MAX_PARALLEL_IMAGE_REQUESTS=g},f.setRTLTextPlugin=function(g,e){return Ca().setRTLTextPlugin(g,e)},f.setWorkerCount=function(g){st.workerCount=g},f.setWorkerUrl=function(g){l.a.WORKER_URL=g}}));var b=s;return b}))})(Rd)),Rd.exports}var Ok=Fk();const ct=$1(Ok);function Bk(){return typeof self<"u"?fetch.bind(self):typeof global<"u"&&global.fetch?global.fetch:null}class $k{constructor(){this._apiKey="",this._fetch=Bk(),this.tileCacheSize=200}set apiKey(r){this._apiKey=r}get apiKey(){return this._apiKey}set fetch(r){this._fetch=r}get fetch(){return this._fetch}}const Wc=new $k,Nk={AUTO:{code:null,flag:"auto",name:"Auto",latin:!1,isMode:!0,geocoding:!0},LATIN:{code:"latin",flag:"name:latin",name:"Latin",latin:!0,isMode:!1,geocoding:!1},NON_LATIN:{code:"nonlatin",flag:"name:nonlatin",name:"Non Latin",latin:!1,isMode:!1,geocoding:!1},LOCAL:{code:null,flag:"name",name:"Local",latin:!0,isMode:!1,geocoding:!1}},Uk={ALBANIAN:{code:"sq",flag:"name:sq",name:"Albanian",latin:!0,isMode:!1,geocoding:!0},AMHARIC:{code:"am",flag:"name:am",name:"Amharic",latin:!1,isMode:!1,geocoding:!0},ARABIC:{code:"ar",flag:"name:ar",name:"Arabic",latin:!1,isMode:!1,geocoding:!0},ARMENIAN:{code:"hy",flag:"name:hy",name:"Armenian",latin:!1,isMode:!1,geocoding:!0},AZERBAIJANI:{code:"az",flag:"name:az",name:"Azerbaijani",latin:!0,isMode:!1,geocoding:!0},BASQUE:{code:"eu",flag:"name:eu",name:"Basque",latin:!0,isMode:!1,geocoding:!0},BELARUSIAN:{code:"be",flag:"name:be",name:"Belarusian",latin:!1,isMode:!1,geocoding:!0},BENGALI:{code:"bn",flag:"name:bn",name:"Bengali",latin:!0,isMode:!1,geocoding:!0},BOSNIAN:{code:"bs",flag:"name:bs",name:"Bosnian",latin:!0,isMode:!1,geocoding:!0},BRETON:{code:"br",flag:"name:br",name:"Breton",latin:!0,isMode:!1,geocoding:!0},BULGARIAN:{code:"bg",flag:"bg",name:"Bulgarian",latin:!1,isMode:!1,geocoding:!0},CATALAN:{code:"ca",flag:"name:ca",name:"Catalan",latin:!0,isMode:!1,geocoding:!0},CHINESE:{code:"zh",flag:"name:zh",name:"Chinese",latin:!1,isMode:!1,geocoding:!0},TRADITIONAL_CHINESE:{code:"zh-Hant",flag:"name:zh-Hant",name:"Chinese (traditional)",latin:!1,isMode:!1,geocoding:!1},SIMPLIFIED_CHINESE:{code:"zh-Hans",flag:"name:zh-Hans",name:"Chinese (simplified)",latin:!1,isMode:!1,geocoding:!1},CORSICAN:{code:"co",flag:"name:co",name:"Corsican",latin:!0,isMode:!1,geocoding:!0},CROATIAN:{code:"hr",flag:"name:hr",name:"Croatian",latin:!0,isMode:!1,geocoding:!0},CZECH:{code:"cs",flag:"name:cs",name:"Czech",latin:!0,isMode:!1,geocoding:!0},DANISH:{code:"da",flag:"name:da",name:"Danish",latin:!0,isMode:!1,geocoding:!0},DUTCH:{code:"nl",flag:"name:nl",name:"Dutch",latin:!0,isMode:!1,geocoding:!0},GERMAN:{code:"de",flag:"name:de",name:"German",latin:!0,isMode:!1,geocoding:!0},GREEK:{code:"el",flag:"name:el",name:"Greek",latin:!1,isMode:!1,geocoding:!0},ENGLISH:{code:"en",flag:"name:en",name:"English",latin:!0,isMode:!1,geocoding:!0},ESPERANTO:{code:"eo",flag:"name:eo",name:"Esperanto",latin:!0,isMode:!1,geocoding:!0},ESTONIAN:{code:"et",flag:"name:et",name:"Estonian",latin:!0,isMode:!1,geocoding:!0},FINNISH:{code:"fi",flag:"name:fi",name:"Finnish",latin:!0,isMode:!1,geocoding:!0},FRENCH:{code:"fr",flag:"name:fr",name:"French",latin:!0,isMode:!1,geocoding:!0},FRISIAN:{code:"fy",flag:"name:fy",name:"Frisian (West)",latin:!0,isMode:!1,geocoding:!0},GEORGIAN:{code:"ka",flag:"name:ka",name:"Georgian",latin:!1,isMode:!1,geocoding:!0},HEBREW:{code:"he",flag:"name:he",name:"Hebrew",latin:!1,isMode:!1,geocoding:!0},HINDI:{code:"hi",flag:"name:hi",name:"Hindi",latin:!1,isMode:!1,geocoding:!0},HUNGARIAN:{code:"hu",flag:"name:hu",name:"Hungarian",latin:!0,isMode:!1,geocoding:!0},ICELANDIC:{code:"is",flag:"name:is",name:"Icelandic",latin:!0,isMode:!1,geocoding:!0},INDONESIAN:{code:"id",flag:"name:id",name:"Indonesian",latin:!0,isMode:!1,geocoding:!0},IRISH:{code:"ga",flag:"name:ga",name:"Irish",latin:!0,isMode:!1,geocoding:!0},ITALIAN:{code:"it",flag:"name:it",name:"Italian",latin:!0,isMode:!1,geocoding:!0},JAPANESE:{code:"ja",flag:"name:ja",name:"Japanese",latin:!1,isMode:!1,geocoding:!0},JAPANESE_HIRAGANA:{code:"ja-Hira",flag:"name:ja-Hira",name:"Japanese Hiragana form",latin:!1,isMode:!1,geocoding:!1},JAPANESE_2018:{code:"ja-Latn",flag:"name:ja-Latn",name:"Japanese (Latin 2018)",latin:!0,isMode:!1,geocoding:!1},JAPANESE_KANA:{code:"ja_kana",flag:"name:ja_kana",name:"Japanese (Kana)",latin:!1,isMode:!1,geocoding:!1},JAPANESE_LATIN:{code:"ja_rm",flag:"name:ja_rm",name:"Japanese (Latin script)",latin:!0,isMode:!1,geocoding:!1},KANNADA:{code:"kn",flag:"name:kn",name:"Kannada",latin:!0,isMode:!1,geocoding:!0},KAZAKH:{code:"kk",flag:"name:kk",name:"Kazakh",latin:!1,isMode:!1,geocoding:!0},KOREAN:{code:"ko",flag:"name:ko",name:"Korean",latin:!1,isMode:!1,geocoding:!0},KOREAN_LATIN:{code:"ko-Latn",flag:"name:ko-Latn",name:"Korean (Latin script)",latin:!0,isMode:!1,geocoding:!1},KURDISH:{code:"ku",flag:"name:ku",name:"Kurdish",latin:!0,isMode:!1,geocoding:!0},CLASSICAL_LATIN:{code:"la",flag:"name:la",name:"Latin",latin:!0,isMode:!1,geocoding:!0},LATVIAN:{code:"lv",flag:"name:lv",name:"Latvian",latin:!0,isMode:!1,geocoding:!0},LITHUANIAN:{code:"lt",flag:"name:lt",name:"Lithuanian",latin:!0,isMode:!1,geocoding:!0},LUXEMBOURGISH:{code:"lb",flag:"name:lb",name:"Luxembourgish",latin:!0,isMode:!1,geocoding:!0},MACEDONIAN:{code:"mk",flag:"name:mk",name:"Macedonian",latin:!1,isMode:!1,geocoding:!0},MALAYALAM:{code:"ml",flag:"name:ml",name:"Malayalam",latin:!1,isMode:!1,geocoding:!0},MALTESE:{code:"mt",flag:"name:mt",name:"Maltese",latin:!0,isMode:!1,geocoding:!0},NORWEGIAN:{code:"no",flag:"name:no",name:"Norwegian",latin:!0,isMode:!1,geocoding:!0},OCCITAN:{code:"oc",flag:"name:oc",name:"Occitan",latin:!0,isMode:!1,geocoding:!0},PERSIAN:{code:"fa",flag:"name:fa",name:"Persian",latin:!1,isMode:!1,geocoding:!0},POLISH:{code:"pl",flag:"name:pl",name:"Polish",latin:!0,isMode:!1,geocoding:!0},PORTUGUESE:{code:"pt",flag:"name:pt",name:"Portuguese",latin:!0,isMode:!1,geocoding:!0},PUNJABI:{code:"pa",flag:"name:pa",name:"Punjabi",latin:!1,isMode:!1,geocoding:!0},WESTERN_PUNJABI:{code:"pnb",flag:"name:pnb",name:"Western Punjabi",latin:!1,isMode:!1,geocoding:!1},ROMANIAN:{code:"ro",flag:"name:ro",name:"Romanian",latin:!0,isMode:!1,geocoding:!0},ROMANSH:{code:"rm",flag:"name:rm",name:"Romansh",latin:!0,isMode:!1,geocoding:!0},RUSSIAN:{code:"ru",flag:"name:ru",name:"Russian",latin:!1,isMode:!1,geocoding:!0},SERBIAN_CYRILLIC:{code:"sr",flag:"name:sr",name:"Serbian (Cyrillic script)",latin:!1,isMode:!1,geocoding:!0},SERBIAN_LATIN:{code:"sr-Latn",flag:"name:sr-Latn",name:"Serbian (Latin script)",latin:!0,isMode:!1,geocoding:!1},SCOTTISH_GAELIC:{code:"gd",flag:"name:gd",name:"Scottish Gaelic",latin:!0,isMode:!1,geocoding:!0},SLOVAK:{code:"sk",flag:"name:sk",name:"Slovak",latin:!0,isMode:!1,geocoding:!0},SLOVENE:{code:"sl",flag:"name:sl",name:"Slovene",latin:!0,isMode:!1,geocoding:!0},SPANISH:{code:"es",flag:"name:es",name:"Spanish",latin:!0,isMode:!1,geocoding:!0},SWEDISH:{code:"sv",flag:"name:sv",name:"Swedish",latin:!0,isMode:!1,geocoding:!0},TAMIL:{code:"ta",flag:"name:ta",name:"Tamil",latin:!1,isMode:!1,geocoding:!0},TELUGU:{code:"te",flag:"name:te",name:"Telugu",latin:!1,isMode:!1,geocoding:!0},THAI:{code:"th",flag:"name:th",name:"Thai",latin:!1,isMode:!1,geocoding:!0},TURKISH:{code:"tr",flag:"name:tr",name:"Turkish",latin:!0,isMode:!1,geocoding:!0},UKRAINIAN:{code:"uk",flag:"name:uk",name:"Ukrainian",latin:!1,isMode:!1,geocoding:!0},VIETNAMESE:{code:"vi",flag:"name:vi",name:"Vietnamese (Latin script)",latin:!0,isMode:!1,geocoding:!0},WELSH:{code:"cy",flag:"name:cy",name:"Welsh",latin:!0,isMode:!1,geocoding:!0}},op={...Nk,...Uk};function Vk(i,r=op){return i in r?i[i]:null}function Gg(i,r=op){for(const s of Object.values(r))if(s.code===i)return s;return null}function Zg(i,r=op){for(const s of Object.values(r))if(s.flag===i)return s;return null}function qk(i){return i!==null&&typeof i=="object"&&"code"in i&&"flag"in i&&"name"in i&&"latin"in i&&"isMode"in i&&"geocoding"in i&&(typeof i.code=="string"||i.code===null)&&typeof i.flag=="string"&&typeof i.name=="string"&&typeof i.latin=="boolean"&&typeof i.isMode=="boolean"&&typeof i.geocoding=="boolean"}function wv(i,r=op){return qk(i)?Zg(i.flag,r):typeof i!="string"?null:Vk(i,r)||Gg(i,r)||Zg(i,r)||null}async function Gk(i,r={}){if(Wc.fetch===null)throw new Error("The fetch function was not found. If on NodeJS < 18 please specify the fetch function with config.fetch");if(new URL(i).searchParams.get("key").trim()==="")throw new Error("The MapTiler Cloud API key is missing. Set it in `config.apiKey` or get one for free at https://maptiler.com");return Wc.fetch(i,r)}const U1={maptilerApiURL:"https://api.maptiler.com/",mapStyle:"streets-v2"};Object.freeze(U1);class Zk extends Error{constructor(r,s=""){super(`Call to enpoint ${r.url} failed with the status code ${r.status}. ${s}`),this.res=r}}const Tv={403:"Key is missing, invalid or restricted"};async function Wk(i={}){const r=new URL("geolocation/ip.json",U1.maptilerApiURL);r.searchParams.set("key",i.apiKey??Wc.apiKey),"elevation"in i&&r.searchParams.set("elevation",i.elevation?"true":"false");const s=r.toString(),p=await Gk(s);if(!p.ok)throw new Zk(p,p.status in Tv?Tv[p.status]:"");return await p.json()}const Sv={info:Wk};function V1(i){const r=/^maptiler:\/\/(.*)/;let s;const p=i.trim();let m;return p.startsWith("http://")||p.startsWith("https://")?m=p:(s=r.exec(p))!==null?m=`https://api.maptiler.com/maps/${s[1]}/style.json`:m=`https://api.maptiler.com/maps/${p}/style.json`,m}class q1{constructor(r,s,p,m,b,f,l=!1){this.name=r,this.variantType=s,this.id=p,this.referenceStyle=m,this.description=b,this.imageURL=f,this.deprecated=l}getName(){return this.name}getFullName(){return`${this.referenceStyle.getName()} ${this.name}`}getType(){return this.variantType}getId(){return this.id}getDescription(){return this.description}getReferenceStyle(){return this.referenceStyle}hasVariant(r){return this.referenceStyle.hasVariant(r)}getVariant(r){const s=this.referenceStyle.getVariant(r);return this.warnIfDeprecated(s),s}getVariants(){return this.referenceStyle.getVariants().filter(r=>r!==this).map(r=>(this.warnIfDeprecated(r),r))}getImageURL(){return this.imageURL}getExpandedStyleURL(){return V1(this.getId())}warnIfDeprecated(r=this){if(!r.deprecated)return r;const s=r.getFullName();return console.warn(`Style "${s}" is deprecated and will be removed in a future version.`),r}}class G1{constructor(r,s){this.name=r,this.id=s,this.variants={},this.orderedVariants=[]}getName(){return this.name}getId(){return this.id}addVariant(r){this.variants[r.getType()]=r,this.orderedVariants.push(r)}hasVariant(r){return r in this.variants}getVariant(r){return r in this.variants?this.variants[r]:this.orderedVariants[0]}getVariants(){return Object.values(this.variants)}getDefaultVariant(){return this.orderedVariants[0].warnIfDeprecated()}}const zh=[{referenceStyleID:"STREETS",name:"Streets",description:"",variants:[{id:"streets-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"streets-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"streets-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"streets-v2-night",name:"Night",variantType:"NIGHT",description:"",imageURL:""},{id:"streets-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OUTDOOR",name:"Outdoor",description:"",variants:[{id:"outdoor-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"outdoor-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"WINTER",name:"Winter",description:"",variants:[{id:"winter-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"winter-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""}]},{referenceStyleID:"SATELLITE",name:"Satellite",description:"",variants:[{id:"satellite",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"HYBRID",name:"Hybrid",description:"",variants:[{id:"hybrid",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"BASIC",name:"Basic",description:"",variants:[{id:"basic-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"basic-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"basic-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BRIGHT",name:"Bright",description:"",variants:[{id:"bright-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"bright-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"bright-v2-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""},{id:"bright-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""}]},{referenceStyleID:"OPENSTREETMAP",name:"OpenStreetMap",description:"",variants:[{id:"openstreetmap",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"TOPO",name:"Topo",description:"",variants:[{id:"topo-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"topo-v2-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"topo-v2-shiny",name:"Shiny",deprecated:!0,variantType:"SHINY",description:"",imageURL:""},{id:"topo-v2-pastel",name:"Pastel",variantType:"PASTEL",description:"",imageURL:""},{id:"topo-v2-topographique",name:"Topographique",variantType:"TOPOGRAPHIQUE",description:"",imageURL:""}]},{referenceStyleID:"VOYAGER",name:"Voyager",description:"",variants:[{id:"voyager-v2",name:"Default",deprecated:!0,variantType:"DEFAULT",description:"",imageURL:""},{id:"voyager-v2-darkmatter",name:"Darkmatter",deprecated:!0,variantType:"DARK",description:"",imageURL:""},{id:"voyager-v2-positron",name:"Positron",deprecated:!0,variantType:"LIGHT",description:"",imageURL:""},{id:"voyager-v2-vintage",name:"Vintage",deprecated:!0,variantType:"VINTAGE",description:"",imageURL:""}]},{referenceStyleID:"TONER",name:"Toner",description:"",variants:[{id:"toner-v2",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"toner-v2-background",name:"Background",variantType:"BACKGROUND",deprecated:!0,description:"",imageURL:""},{id:"toner-v2-lite",name:"Lite",variantType:"LITE",description:"",imageURL:""},{id:"toner-v2-lines",name:"Lines",variantType:"LINES",deprecated:!0,description:"",imageURL:""}]},{referenceStyleID:"DATAVIZ",name:"Dataviz",description:"",variants:[{id:"dataviz",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"dataviz-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"dataviz-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"BACKDROP",name:"Backdrop",description:"",variants:[{id:"backdrop",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"backdrop-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"backdrop-light",name:"Light",variantType:"LIGHT",description:"",imageURL:""}]},{referenceStyleID:"OCEAN",name:"Ocean",description:"",variants:[{id:"ocean",name:"Default",variantType:"DEFAULT",description:"",imageURL:""}]},{referenceStyleID:"AQUARELLE",name:"Aquarelle",description:"Watercolor map for creative use",variants:[{id:"aquarelle",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"aquarelle-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"aquarelle-vivid",name:"Vivid",variantType:"VIVID",description:"",imageURL:""}]},{referenceStyleID:"LANDSCAPE",name:"Landscape",description:"Terrain map for data overlays and visualisations",variants:[{id:"landscape",name:"Default",variantType:"DEFAULT",description:"",imageURL:""},{id:"landscape-dark",name:"Dark",variantType:"DARK",description:"",imageURL:""},{id:"landscape-vivid",name:"Vivid",variantType:"VIVID",description:"",imageURL:""}]}];function Hk(i){return new Proxy(i,{get(r,s,p){return r.hasVariant(s)?r.getVariant(s):s.toString().toUpperCase()===s?i.getDefaultVariant():Reflect.get(r,s,p)}})}function Xk(){const i={};for(let r=0;r<zh.length;r+=1){const s=zh[r],p=Hk(new G1(s.name,s.referenceStyleID));for(let m=0;m<s.variants.length;m+=1){const b=s.variants[m],f=new q1(b.name,b.variantType,b.id,p,b.description,b.imageURL,b.deprecated);p.addVariant(f)}i[s.referenceStyleID]=p}return i}const Rh=Xk();var kd={exports:{}},kv;function Kk(){if(kv)return kd.exports;kv=1;var i=typeof Reflect=="object"?Reflect:null,r=i&&typeof i.apply=="function"?i.apply:function(ye,Ae,Ne){return Function.prototype.apply.call(ye,Ae,Ne)},s;i&&typeof i.ownKeys=="function"?s=i.ownKeys:Object.getOwnPropertySymbols?s=function(ye){return Object.getOwnPropertyNames(ye).concat(Object.getOwnPropertySymbols(ye))}:s=function(ye){return Object.getOwnPropertyNames(ye)};function p(ve){console&&console.warn&&console.warn(ve)}var m=Number.isNaN||function(ye){return ye!==ye};function b(){b.init.call(this)}kd.exports=b,kd.exports.once=_e,b.EventEmitter=b,b.prototype._events=void 0,b.prototype._eventsCount=0,b.prototype._maxListeners=void 0;var f=10;function l(ve){if(typeof ve!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof ve)}Object.defineProperty(b,"defaultMaxListeners",{enumerable:!0,get:function(){return f},set:function(ve){if(typeof ve!="number"||ve<0||m(ve))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+ve+".");f=ve}}),b.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},b.prototype.setMaxListeners=function(ye){if(typeof ye!="number"||ye<0||m(ye))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+ye+".");return this._maxListeners=ye,this};function C(ve){return ve._maxListeners===void 0?b.defaultMaxListeners:ve._maxListeners}b.prototype.getMaxListeners=function(){return C(this)},b.prototype.emit=function(ye){for(var Ae=[],Ne=1;Ne<arguments.length;Ne++)Ae.push(arguments[Ne]);var it=ye==="error",gt=this._events;if(gt!==void 0)it=it&&gt.error===void 0;else if(!it)return!1;if(it){var nt;if(Ae.length>0&&(nt=Ae[0]),nt instanceof Error)throw nt;var Zt=new Error("Unhandled error."+(nt?" ("+nt.message+")":""));throw Zt.context=nt,Zt}var kt=gt[ye];if(kt===void 0)return!1;if(typeof kt=="function")r(kt,this,Ae);else for(var ur=kt.length,hi=ne(kt,ur),Ne=0;Ne<ur;++Ne)r(hi[Ne],this,Ae);return!0};function M(ve,ye,Ae,Ne){var it,gt,nt;if(l(Ae),gt=ve._events,gt===void 0?(gt=ve._events=Object.create(null),ve._eventsCount=0):(gt.newListener!==void 0&&(ve.emit("newListener",ye,Ae.listener?Ae.listener:Ae),gt=ve._events),nt=gt[ye]),nt===void 0)nt=gt[ye]=Ae,++ve._eventsCount;else if(typeof nt=="function"?nt=gt[ye]=Ne?[Ae,nt]:[nt,Ae]:Ne?nt.unshift(Ae):nt.push(Ae),it=C(ve),it>0&&nt.length>it&&!nt.warned){nt.warned=!0;var Zt=new Error("Possible EventEmitter memory leak detected. "+nt.length+" "+String(ye)+" listeners added. Use emitter.setMaxListeners() to increase limit");Zt.name="MaxListenersExceededWarning",Zt.emitter=ve,Zt.type=ye,Zt.count=nt.length,p(Zt)}return ve}b.prototype.addListener=function(ye,Ae){return M(this,ye,Ae,!1)},b.prototype.on=b.prototype.addListener,b.prototype.prependListener=function(ye,Ae){return M(this,ye,Ae,!0)};function D(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function O(ve,ye,Ae){var Ne={fired:!1,wrapFn:void 0,target:ve,type:ye,listener:Ae},it=D.bind(Ne);return it.listener=Ae,Ne.wrapFn=it,it}b.prototype.once=function(ye,Ae){return l(Ae),this.on(ye,O(this,ye,Ae)),this},b.prototype.prependOnceListener=function(ye,Ae){return l(Ae),this.prependListener(ye,O(this,ye,Ae)),this},b.prototype.removeListener=function(ye,Ae){var Ne,it,gt,nt,Zt;if(l(Ae),it=this._events,it===void 0)return this;if(Ne=it[ye],Ne===void 0)return this;if(Ne===Ae||Ne.listener===Ae)--this._eventsCount===0?this._events=Object.create(null):(delete it[ye],it.removeListener&&this.emit("removeListener",ye,Ne.listener||Ae));else if(typeof Ne!="function"){for(gt=-1,nt=Ne.length-1;nt>=0;nt--)if(Ne[nt]===Ae||Ne[nt].listener===Ae){Zt=Ne[nt].listener,gt=nt;break}if(gt<0)return this;gt===0?Ne.shift():fe(Ne,gt),Ne.length===1&&(it[ye]=Ne[0]),it.removeListener!==void 0&&this.emit("removeListener",ye,Zt||Ae)}return this},b.prototype.off=b.prototype.removeListener,b.prototype.removeAllListeners=function(ye){var Ae,Ne,it;if(Ne=this._events,Ne===void 0)return this;if(Ne.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):Ne[ye]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete Ne[ye]),this;if(arguments.length===0){var gt=Object.keys(Ne),nt;for(it=0;it<gt.length;++it)nt=gt[it],nt!=="removeListener"&&this.removeAllListeners(nt);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(Ae=Ne[ye],typeof Ae=="function")this.removeListener(ye,Ae);else if(Ae!==void 0)for(it=Ae.length-1;it>=0;it--)this.removeListener(ye,Ae[it]);return this};function Z(ve,ye,Ae){var Ne=ve._events;if(Ne===void 0)return[];var it=Ne[ye];return it===void 0?[]:typeof it=="function"?Ae?[it.listener||it]:[it]:Ae?Ee(it):ne(it,it.length)}b.prototype.listeners=function(ye){return Z(this,ye,!0)},b.prototype.rawListeners=function(ye){return Z(this,ye,!1)},b.listenerCount=function(ve,ye){return typeof ve.listenerCount=="function"?ve.listenerCount(ye):$.call(ve,ye)},b.prototype.listenerCount=$;function $(ve){var ye=this._events;if(ye!==void 0){var Ae=ye[ve];if(typeof Ae=="function")return 1;if(Ae!==void 0)return Ae.length}return 0}b.prototype.eventNames=function(){return this._eventsCount>0?s(this._events):[]};function ne(ve,ye){for(var Ae=new Array(ye),Ne=0;Ne<ye;++Ne)Ae[Ne]=ve[Ne];return Ae}function fe(ve,ye){for(;ye+1<ve.length;ye++)ve[ye]=ve[ye+1];ve.pop()}function Ee(ve){for(var ye=new Array(ve.length),Ae=0;Ae<ye.length;++Ae)ye[Ae]=ve[Ae].listener||ve[Ae];return ye}function _e(ve,ye){return new Promise(function(Ae,Ne){function it(nt){ve.removeListener(ye,gt),Ne(nt)}function gt(){typeof ve.removeListener=="function"&&ve.removeListener("error",it),Ae([].slice.call(arguments))}Pe(ve,ye,gt,{once:!0}),ye!=="error"&&Se(ve,it,{once:!0})})}function Se(ve,ye,Ae){typeof ve.on=="function"&&Pe(ve,"error",ye,Ae)}function Pe(ve,ye,Ae,Ne){if(typeof ve.on=="function")Ne.once?ve.once(ye,Ae):ve.on(ye,Ae);else if(typeof ve.addEventListener=="function")ve.addEventListener(ye,function it(gt){Ne.once&&ve.removeEventListener(ye,it),Ae(gt)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof ve)}return kd.exports}var Yk=Kk();const Jk=$1(Yk),Pi=[];for(let i=0;i<256;++i)Pi.push((i+256).toString(16).slice(1));function Qk(i,r=0){return(Pi[i[r+0]]+Pi[i[r+1]]+Pi[i[r+2]]+Pi[i[r+3]]+"-"+Pi[i[r+4]]+Pi[i[r+5]]+"-"+Pi[i[r+6]]+Pi[i[r+7]]+"-"+Pi[i[r+8]]+Pi[i[r+9]]+"-"+Pi[i[r+10]]+Pi[i[r+11]]+Pi[i[r+12]]+Pi[i[r+13]]+Pi[i[r+14]]+Pi[i[r+15]]).toLowerCase()}let tg;const e5=new Uint8Array(16);function t5(){if(!tg){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");tg=crypto.getRandomValues.bind(crypto)}return tg(e5)}const r5=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Cv={randomUUID:r5};function i5(i,r,s){if(Cv.randomUUID&&!i)return Cv.randomUUID();i=i||{};const p=i.random??i.rng?.()??t5();if(p.length<16)throw new Error("Random bytes length must be >= 16");return p[6]=p[6]&15|64,p[8]=p[8]&63|128,Qk(p)}const Z1="3.7.8",n5=Z1,iu=typeof Buffer=="function",Pv=typeof TextDecoder=="function"?new TextDecoder:void 0,Mv=typeof TextEncoder=="function"?new TextEncoder:void 0,a5="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",xh=Array.prototype.slice.call(a5),Cd=(i=>{let r={};return i.forEach((s,p)=>r[s]=p),r})(xh),o5=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,Mi=String.fromCharCode.bind(String),Av=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):i=>new Uint8Array(Array.prototype.slice.call(i,0)),W1=i=>i.replace(/=/g,"").replace(/[+\/]/g,r=>r=="+"?"-":"_"),H1=i=>i.replace(/[^A-Za-z0-9\+\/]/g,""),X1=i=>{let r,s,p,m,b="";const f=i.length%3;for(let l=0;l<i.length;){if((s=i.charCodeAt(l++))>255||(p=i.charCodeAt(l++))>255||(m=i.charCodeAt(l++))>255)throw new TypeError("invalid character found");r=s<<16|p<<8|m,b+=xh[r>>18&63]+xh[r>>12&63]+xh[r>>6&63]+xh[r&63]}return f?b.slice(0,f-3)+"===".substring(f):b},My=typeof btoa=="function"?i=>btoa(i):iu?i=>Buffer.from(i,"binary").toString("base64"):X1,Wg=iu?i=>Buffer.from(i).toString("base64"):i=>{let s=[];for(let p=0,m=i.length;p<m;p+=4096)s.push(Mi.apply(null,i.subarray(p,p+4096)));return My(s.join(""))},Ld=(i,r=!1)=>r?W1(Wg(i)):Wg(i),s5=i=>{if(i.length<2){var r=i.charCodeAt(0);return r<128?i:r<2048?Mi(192|r>>>6)+Mi(128|r&63):Mi(224|r>>>12&15)+Mi(128|r>>>6&63)+Mi(128|r&63)}else{var r=65536+(i.charCodeAt(0)-55296)*1024+(i.charCodeAt(1)-56320);return Mi(240|r>>>18&7)+Mi(128|r>>>12&63)+Mi(128|r>>>6&63)+Mi(128|r&63)}},l5=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,K1=i=>i.replace(l5,s5),Iv=iu?i=>Buffer.from(i,"utf8").toString("base64"):Mv?i=>Wg(Mv.encode(i)):i=>My(K1(i)),Hc=(i,r=!1)=>r?W1(Iv(i)):Iv(i),Ev=i=>Hc(i,!0),c5=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,u5=i=>{switch(i.length){case 4:var r=(7&i.charCodeAt(0))<<18|(63&i.charCodeAt(1))<<12|(63&i.charCodeAt(2))<<6|63&i.charCodeAt(3),s=r-65536;return Mi((s>>>10)+55296)+Mi((s&1023)+56320);case 3:return Mi((15&i.charCodeAt(0))<<12|(63&i.charCodeAt(1))<<6|63&i.charCodeAt(2));default:return Mi((31&i.charCodeAt(0))<<6|63&i.charCodeAt(1))}},Y1=i=>i.replace(c5,u5),J1=i=>{if(i=i.replace(/\s+/g,""),!o5.test(i))throw new TypeError("malformed base64.");i+="==".slice(2-(i.length&3));let r,s,p,m=[];for(let b=0;b<i.length;)r=Cd[i.charAt(b++)]<<18|Cd[i.charAt(b++)]<<12|(s=Cd[i.charAt(b++)])<<6|(p=Cd[i.charAt(b++)]),s===64?m.push(Mi(r>>16&255)):p===64?m.push(Mi(r>>16&255,r>>8&255)):m.push(Mi(r>>16&255,r>>8&255,r&255));return m.join("")},Ay=typeof atob=="function"?i=>atob(H1(i)):iu?i=>Buffer.from(i,"base64").toString("binary"):J1,Q1=iu?i=>Av(Buffer.from(i,"base64")):i=>Av(Ay(i).split("").map(r=>r.charCodeAt(0))),ex=i=>Q1(tx(i)),h5=iu?i=>Buffer.from(i,"base64").toString("utf8"):Pv?i=>Pv.decode(Q1(i)):i=>Y1(Ay(i)),tx=i=>H1(i.replace(/[-_]/g,r=>r=="-"?"+":"/")),Hg=i=>h5(tx(i)),p5=i=>{if(typeof i!="string")return!1;const r=i.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(r)||!/[^\s0-9a-zA-Z\-_]/.test(r)},rx=i=>({value:i,enumerable:!1,writable:!0,configurable:!0}),ix=function(){const i=(r,s)=>Object.defineProperty(String.prototype,r,rx(s));i("fromBase64",function(){return Hg(this)}),i("toBase64",function(r){return Hc(this,r)}),i("toBase64URI",function(){return Hc(this,!0)}),i("toBase64URL",function(){return Hc(this,!0)}),i("toUint8Array",function(){return ex(this)})},nx=function(){const i=(r,s)=>Object.defineProperty(Uint8Array.prototype,r,rx(s));i("toBase64",function(r){return Ld(this,r)}),i("toBase64URI",function(){return Ld(this,!0)}),i("toBase64URL",function(){return Ld(this,!0)})},d5=()=>{ix(),nx()},f5={version:Z1,VERSION:n5,atob:Ay,atobPolyfill:J1,btoa:My,btoaPolyfill:X1,fromBase64:Hg,toBase64:Hc,encode:Hc,encodeURI:Ev,encodeURL:Ev,utob:K1,btou:Y1,decode:Hg,isValid:p5,fromUint8Array:Ld,toUint8Array:ex,extendString:ix,extendUint8Array:nx,extendBuiltins:d5};var m5=Object.defineProperty,ax=i=>{throw TypeError(i)},g5=(i,r,s)=>r in i?m5(i,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[r]=s,Je=(i,r,s)=>g5(i,typeof r!="symbol"?r+"":r,s),Iy=(i,r,s)=>r.has(i)||ax("Cannot "+s),ut=(i,r,s)=>(Iy(i,r,"read from private field"),s?s.call(i):r.get(i)),on=(i,r,s)=>r.has(i)?ax("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(i):r.set(i,s),En=(i,r,s,p)=>(Iy(i,r,"write to private field"),r.set(i,s),s),Mn=(i,r,s)=>(Iy(i,r,"access private method"),s);const Yt={VISITOR:{code:null,flag:"visitor",name:"Visitor",latin:!0,isMode:!0,geocoding:!1},VISITOR_ENGLISH:{code:null,flag:"visitor_en",name:"Visitor English",latin:!0,isMode:!0,geocoding:!1},STYLE:{code:null,flag:"style",name:"Style",latin:!1,isMode:!0,geocoding:!1},STYLE_LOCK:{code:null,flag:"style_lock",name:"Style Lock",latin:!1,isMode:!0,geocoding:!1},...op};function zv(){if(typeof navigator>"u"){const i=Intl.DateTimeFormat().resolvedOptions().locale.split("-")[0];return Gg(i)||Yt.ENGLISH}return Array.from(new Set(navigator.languages.map(i=>i.split("-")[0]))).map(i=>Gg(i)).filter(i=>i)[0]??Yt.LOCAL}const Yi={maptilerLogoURL:"https://api.maptiler.com/resources/logo.svg",maptilerURL:"https://www.maptiler.com/",maptilerApiHost:"api.maptiler.com",telemetryURL:"https://api.maptiler.com/metrics",rtlPluginURL:"https://cdn.maptiler.com/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.min.js",primaryLanguage:Yt.STYLE,secondaryLanguage:Yt.LOCAL,terrainSourceURL:"https://api.maptiler.com/tiles/terrain-rgb-v2/tiles.json",terrainSourceId:"maptiler-terrain"};Object.freeze(Yi);const Ey=i5();let y5=class extends Jk{constructor(){super(...arguments),Je(this,"primaryLanguage",Yi.primaryLanguage),Je(this,"secondaryLanguage"),Je(this,"session",!0),Je(this,"caching",!0),Je(this,"telemetry",!0),Je(this,"_unit","metric"),Je(this,"_apiKey","")}set unit(r){this._unit=r,this.emit("unit",r)}get unit(){return this._unit}set apiKey(r){this._apiKey=r,Wc.apiKey=r,this.emit("apiKey",r)}get apiKey(){return this._apiKey}set fetch(r){Wc.fetch=r}get fetch(){return Wc.fetch}};const ci=new y5,Xg="localcache_source",Kg="localcache",_5="maptiler_sdk",v5=1e3,b5=100,Yg=typeof caches<"u",{addProtocol:Rv}=ct;function x5(i,r){if(Yg&&ci.caching&&ci.session&&i.host===Yi.maptilerApiHost){if(r==="Source"&&i.href.includes("tiles.json"))return i.href.replace("https://",`${Xg}://`);if(r==="Tile"||r==="Glyphs")return i.href.replace("https://",`${Kg}://`)}return i.href}let rg;async function ox(){return rg||(rg=await caches.open(_5)),rg}let Lv=0;async function w5(){const i=await ox(),r=await i.keys(),s=r.slice(0,Math.max(r.length-v5,0));for(const p of s)i.delete(p)}function T5(){Rv(Xg,async(i,r)=>{if(!i.url)throw new Error("");i.url=i.url.replace(`${Xg}://`,"https://");const s=i;s.signal=r.signal;const p=await fetch(i.url,s),m=await p.json();return m.tiles&&m.tiles.length>0&&(m.tiles[0]+=`&last-modified=${p.headers.get("Last-Modified")}`),{data:m,cacheControl:p.headers.get("Cache-Control"),expires:p.headers.get("Expires")}}),Rv(Kg,async(i,r)=>{if(!i.url)throw new Error("");i.url=i.url.replace(`${Kg}://`,"https://");const s=new URL(i.url),p=new URL(s);p.searchParams.delete("mtsid"),p.searchParams.delete("key");const m=p.toString(),b=new URL(s);b.searchParams.delete("last-modified");const f=b.toString(),l=async Z=>({data:await Z.arrayBuffer(),cacheControl:Z.headers.get("Cache-Control"),expires:Z.headers.get("Expires")}),C=await ox(),M=await C.match(m);if(M)return l(M);const D=i;D.signal=r.signal;const O=await fetch(f,D);return O.status>=200&&O.status<300&&(C.put(m,O.clone()).catch(()=>{}),++Lv>b5&&(w5(),Lv=0)),l(O)})}function S5(){if(typeof window>"u")return;const i=ct.getRTLTextPluginStatus();if(i==="unavailable"||i==="requested")try{ct.setRTLTextPlugin(Yi.rtlPluginURL,!0)}catch{}}function k5(i,r){for(const s of i)typeof r[s]=="function"&&(r[s]=r[s].bind(r))}function Dv(i,r){let s=null;try{s=new URL(i)}catch{return{url:i}}return s.host===Yi.maptilerApiHost&&(s.searchParams.has("key")||s.searchParams.append("key",ci.apiKey),ci.session&&s.searchParams.append("mtsid",Ey)),{url:x5(s,r)}}function jv(i){return(r,s)=>{if(i!=null){const p=i(r,s),m=Dv(p?.url??"",s);return{...p,...m}}return Dv(r,s)}}function C5(){return document.createElement("canvas").getContext("webgl2")?null:typeof WebGL2RenderingContext<"u"?"Graphic rendering with WebGL2 has been disabled or is not supported by your graphic card. The map cannot be displayed.":"Your browser does not support graphic rendering with WebGL2. The map cannot be displayed."}function P5(i){const r=C5();if(!r)return;let s=null;if(typeof i=="string"?s=document.getElementById(i):i instanceof HTMLElement&&(s=i),!s)throw new Error("The Map container must be provided.");const p=document.createElement("div");throw p.innerHTML=r,p.classList.add("webgl-warning-div"),s.appendChild(p),new Error(r)}function Fv(i,r){return!(!Array.isArray(i)||i.length!==2||i[0]!=="get"||typeof i[1]!="string"||r&&!i[1].startsWith("name:")||!r&&i[1]!=="name")}function M5(i,r,s){const p=structuredClone(i),m=b=>{if(typeof b!="string")for(let f=0;f<b.length;f+=1)Fv(b[f],s)?b[f]=structuredClone(r):m(b[f])};return Fv(p,s)?r:(m(p),p)}function A5(i,r){const s=r?/\{name:\S+\}/:/\{name\}/;return{contains:s.test(i),exactMatch:new RegExp(`^${s.source}$`).test(i)}}function I5(i,r,s){const p=s?/\{name:\S+\}/:/\{name\}/,m=i.split(p);return["concat",...m.flatMap((b,f)=>f===m.length-1?[b]:[b,r])]}function E5(i){var r;const s=/\{name(?::(?<language>\S+))?\}/g,p=[];for(;;){const m=s.exec(i);if(!m)break;const b=((r=m.groups)==null?void 0:r.language)??null;p.push(b)}return p}function z5(i){return!Array.isArray(i)||i.length!==2||i[0]!=="get"||typeof i[1]!="string"?null:i[1].trim()==="name"?{isLanguage:!0,localization:null}:i[1].trim().startsWith("name:")?{isLanguage:!0,localization:i[1].trim().split(":").pop()}:null}function R5(i){const r=[],s=structuredClone(i),p=m=>{if(typeof m!="string")for(let b=0;b<m.length;b+=1){const f=z5(m[b]);f?r.push(f.localization):p(m[b])}};return p([s]),r}function L5(i,r){const s=[];for(const b of i){if(b.type!=="symbol")continue;const f=b,{id:l,layout:C}=f;if(!C||!("text-field"in C))continue;const M=r.getLayoutProperty(l,"text-field");if(M)if(typeof M=="string"){const D=E5(M);s.push(D)}else{const D=R5(M);s.push(D)}}const p=s.flat(),m={unlocalized:0,localized:{}};for(const b of p)b===null?m.unlocalized+=1:(b in m.localized||(m.localized[b]=0),m.localized[b]+=1);return m}(class extends ct.Marker{addTo(i){return super.addTo(i)}});class D5 extends ct.Popup{addTo(r){return super.addTo(r)}}class l3 extends ct.Style{constructor(r,s={}){super(r,s)}}class c3 extends ct.CanvasSource{onAdd(r){super.onAdd(r)}}class u3 extends ct.GeoJSONSource{onAdd(r){super.onAdd(r)}}class h3 extends ct.ImageSource{onAdd(r){super.onAdd(r)}}class p3 extends ct.RasterTileSource{onAdd(r){super.onAdd(r)}}class d3 extends ct.RasterDEMTileSource{onAdd(r){super.onAdd(r)}}class f3 extends ct.VectorTileSource{onAdd(r){super.onAdd(r)}}class m3 extends ct.VideoSource{onAdd(r){super.onAdd(r)}}let j5=class extends ct.NavigationControl{onAdd(r){return super.onAdd(r)}},F5=class extends ct.GeolocateControl{onAdd(r){return super.onAdd(r)}};class _3 extends ct.AttributionControl{onAdd(r){return super.onAdd(r)}}let O5=class extends ct.LogoControl{onAdd(r){return super.onAdd(r)}},B5=class extends ct.ScaleControl{onAdd(r){return super.onAdd(r)}},$5=class extends ct.FullscreenControl{onAdd(r){return super.onAdd(r)}};class w3 extends ct.TerrainControl{onAdd(r){return super.onAdd(r)}}class T3 extends ct.BoxZoomHandler{constructor(r,s){super(r,s)}}class S3 extends ct.ScrollZoomHandler{constructor(r,s){super(r,s)}}class k3 extends ct.CooperativeGesturesHandler{constructor(r,s){super(r,s)}}class C3 extends ct.KeyboardHandler{constructor(r){super(r)}}class P3 extends ct.TwoFingersTouchPitchHandler{constructor(r){super(r)}}class M3 extends ct.MapWheelEvent{constructor(r,s,p){super(r,s,p)}}class A3 extends ct.MapTouchEvent{constructor(r,s,p){super(r,s,p)}}class I3 extends ct.MapMouseEvent{constructor(r,s,p,m={}){super(r,s,p,m)}}let Ov=class extends O5{constructor(r={}){super(r),Je(this,"logoURL",""),Je(this,"linkURL",""),this.logoURL=r.logoURL??Yi.maptilerLogoURL,this.linkURL=r.linkURL??Yi.maptilerURL}onAdd(r){this._map=r,this._compact=this.options.compact??!1,this._container=window.document.createElement("div"),this._container.className="maplibregl-ctrl";const s=window.document.createElement("a");return s.style.backgroundRepeat="no-repeat",s.style.cursor="pointer",s.style.display="block",s.style.height="23px",s.style.margin="0 0 -4px -4px",s.style.overflow="hidden",s.style.width="88px",s.style.backgroundImage=`url(${this.logoURL})`,s.style.backgroundSize="100px 30px",s.style.width="100px",s.style.height="30px",s.target="_blank",s.rel="noopener",s.href=this.linkURL,s.setAttribute("aria-label","MapTiler logo"),s.setAttribute("rel","noopener"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}};var N5=8,U5={version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},V5={"*":{type:"source"}},q5=["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],G5={type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},Z5={type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},W5={type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},H5={type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},X5={type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},K5={type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},Y5={id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},J5=["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],Q5={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},eC={"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},tC={"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},rC={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},iC={"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},nC={"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},aC={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},oC={visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},sC={type:"array",value:"*"},lC={type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},cC={type:"enum",values:{Point:{},LineString:{},Polygon:{}}},uC={type:"array",minimum:0,maximum:24,value:["number","color"],length:2},hC={type:"array",value:"*",minimum:1},pC={anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},dC={"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},fC={source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},mC={type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},gC=["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],yC={"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},_C={"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},vC={"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},bC={"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},xC={"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},wC={"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},TC={"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},SC={"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},kC={duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},CC={"*":{type:"string"}},PC={$version:N5,$root:U5,sources:V5,source:q5,source_vector:G5,source_raster:Z5,source_raster_dem:W5,source_geojson:H5,source_video:X5,source_image:K5,layer:Y5,layout:J5,layout_background:Q5,layout_fill:eC,layout_circle:tC,layout_heatmap:rC,"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:iC,layout_symbol:nC,layout_raster:aC,layout_hillshade:oC,"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:sC,filter_operator:lC,geometry_type:cC,function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:uC,expression:hC,light:pC,sky:dC,terrain:fC,projection:mC,paint:gC,paint_fill:yC,"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:_C,paint_circle:vC,paint_heatmap:bC,paint_symbol:xC,paint_raster:wC,paint_hillshade:TC,"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:SC,transition:kC,"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:CC};class Ve{constructor(r,s,p,m){this.message=(r?`${r}: `:"")+p,m&&(this.identifier=m),s!=null&&s.__line__&&(this.line=s.__line__)}}function Xd(i,...r){for(const s of r)for(const p in s)i[p]=s[p];return i}let Va=class extends Error{constructor(r,s){super(s),this.message=s,this.key=r}},MC=class sx{constructor(r,s=[]){this.parent=r,this.bindings={};for(const[p,m]of s)this.bindings[p]=m}concat(r){return new sx(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return this.bindings[r]?!0:this.parent?this.parent.has(r):!1}};const _f={kind:"null"},He={kind:"number"},Nt={kind:"string"},Lt={kind:"boolean"},Za={kind:"color"},vf={kind:"projectionDefinition"},gl={kind:"object"},It={kind:"value"},AC={kind:"error"},bf={kind:"collator"},xf={kind:"formatted"},wf={kind:"padding"},Vh={kind:"colorArray"},Tf={kind:"numberArray"},sp={kind:"resolvedImage"},Sf={kind:"variableAnchorOffsetCollection"};function zn(i,r){return{kind:"array",itemType:i,N:r}}function Ir(i){if(i.kind==="array"){const r=Ir(i.itemType);return typeof i.N=="number"?`array<${r}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${r}>`}else return i.kind}const IC=[_f,He,Nt,Lt,Za,vf,xf,gl,zn(It),wf,Tf,Vh,sp,Sf];function qh(i,r){if(r.kind==="error")return null;if(i.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!qh(i.itemType,r.itemType))&&(typeof i.N!="number"||i.N===r.N))return null}else{if(i.kind===r.kind)return null;if(i.kind==="value"){for(const s of IC)if(!qh(s,r))return null}}return`Expected ${Ir(i)} but found ${Ir(r)} instead.`}function zy(i,r){return r.some(s=>s.kind===i.kind)}function yl(i,r){return r.some(s=>s==="null"?i===null:s==="array"?Array.isArray(i):s==="object"?i&&!Array.isArray(i)&&typeof i=="object":s===typeof i)}function cs(i,r){return i.kind==="array"&&r.kind==="array"?i.itemType.kind===r.itemType.kind&&typeof i.N=="number":i.kind===r.kind}const lx=.96422,cx=1,ux=.82521,hx=4/29,Xc=6/29,px=3*Xc*Xc,EC=Xc*Xc*Xc,zC=Math.PI/180,RC=180/Math.PI;function dx(i){return i=i%360,i<0&&(i+=360),i}function fx([i,r,s,p]){i=ig(i),r=ig(r),s=ig(s);let m,b;const f=ng((.2225045*i+.7168786*r+.0606169*s)/cx);i===r&&r===s?m=b=f:(m=ng((.4360747*i+.3850649*r+.1430804*s)/lx),b=ng((.0139322*i+.0971045*r+.7141733*s)/ux));const l=116*f-16;return[l<0?0:l,500*(m-f),200*(f-b),p]}function ig(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function ng(i){return i>EC?Math.pow(i,1/3):i/px+hx}function mx([i,r,s,p]){let m=(i+16)/116,b=isNaN(r)?m:m+r/500,f=isNaN(s)?m:m-s/200;return m=cx*og(m),b=lx*og(b),f=ux*og(f),[ag(3.1338561*b-1.6168667*m-.4906146*f),ag(-.9787684*b+1.9161415*m+.033454*f),ag(.0719453*b-.2289914*m+1.4052427*f),p]}function ag(i){return i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055,i<0?0:i>1?1:i}function og(i){return i>Xc?i*i*i:px*(i-hx)}function LC(i){const[r,s,p,m]=fx(i),b=Math.sqrt(s*s+p*p);return[Math.round(b*1e4)?dx(Math.atan2(p,s)*RC):NaN,b,r,m]}function DC([i,r,s,p]){return i=isNaN(i)?0:i*zC,mx([s,Math.cos(i)*r,Math.sin(i)*r,p])}function jC([i,r,s,p]){i=dx(i),r/=100,s/=100;function m(b){const f=(b+i/30)%12,l=r*Math.min(s,1-s);return s-l*Math.max(-1,Math.min(f-3,9-f,1))}return[m(0),m(8),m(4),p]}const FC=Object.hasOwn||function(i,r){return Object.prototype.hasOwnProperty.call(i,r)};function Lh(i,r){return FC(i,r)?i[r]:void 0}function OC(i){if(i=i.toLowerCase().trim(),i==="transparent")return[0,0,0,0];const r=Lh(BC,i);if(r){const[m,b,f]=r;return[m/255,b/255,f/255,1]}if(i.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(i)){const m=i.length<6?1:2;let b=1;return[Pd(i.slice(b,b+=m)),Pd(i.slice(b,b+=m)),Pd(i.slice(b,b+=m)),Pd(i.slice(b,b+m)||"ff")]}if(i.startsWith("rgb")){const m=/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,b=i.match(m);if(b){const[f,l,C,M,D,O,Z,$,ne,fe,Ee,_e]=b,Se=[M||" ",Z||" ",fe].join("");if(Se==="  "||Se==="  /"||Se===",,"||Se===",,,"){const Pe=[C,O,ne].join(""),ve=Pe==="%%%"?100:Pe===""?255:0;if(ve){const ye=[jc(+l/ve,0,1),jc(+D/ve,0,1),jc(+$/ve,0,1),Ee?Bv(+Ee,_e):1];if($v(ye))return ye}}return}}const s=/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/,p=i.match(s);if(p){const[m,b,f,l,C,M,D,O,Z]=p,$=[f||" ",C||" ",D].join("");if($==="  "||$==="  /"||$===",,"||$===",,,"){const ne=[+b,jc(+l,0,100),jc(+M,0,100),O?Bv(+O,Z):1];if($v(ne))return jC(ne)}}}function Pd(i){return parseInt(i.padEnd(2,i),16)/255}function Bv(i,r){return jc(r?i/100:i,0,1)}function jc(i,r,s){return Math.min(Math.max(r,i),s)}function $v(i){return!i.some(Number.isNaN)}const BC={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function _l(i,r,s){return i+s*(r-i)}function Gh(i,r,s){return i.map((p,m)=>_l(p,r[m],s))}class cr{constructor(r,s,p,m=1,b=!0){this.r=r,this.g=s,this.b=p,this.a=m,b||(this.r*=m,this.g*=m,this.b*=m,m||this.overwriteGetter("rgb",[r,s,p,m]))}static parse(r){if(r instanceof cr)return r;if(typeof r!="string")return;const s=OC(r);if(s)return new cr(...s,!1)}get rgb(){const{r,g:s,b:p,a:m}=this,b=m||1/0;return this.overwriteGetter("rgb",[r/b,s/b,p/b,m])}get hcl(){return this.overwriteGetter("hcl",LC(this.rgb))}get lab(){return this.overwriteGetter("lab",fx(this.rgb))}overwriteGetter(r,s){return Object.defineProperty(this,r,{value:s}),s}toString(){const[r,s,p,m]=this.rgb;return`rgba(${[r,s,p].map(b=>Math.round(b*255)).join(",")},${m})`}static interpolate(r,s,p,m="rgb"){switch(m){case"rgb":{const[b,f,l,C]=Gh(r.rgb,s.rgb,p);return new cr(b,f,l,C,!1)}case"hcl":{const[b,f,l,C]=r.hcl,[M,D,O,Z]=s.hcl;let $,ne;if(!isNaN(b)&&!isNaN(M)){let Pe=M-b;M>b&&Pe>180?Pe-=360:M<b&&b-M>180&&(Pe+=360),$=b+p*Pe}else isNaN(b)?isNaN(M)?$=NaN:($=M,(l===1||l===0)&&(ne=D)):($=b,(O===1||O===0)&&(ne=f));const[fe,Ee,_e,Se]=DC([$,ne??_l(f,D,p),_l(l,O,p),_l(C,Z,p)]);return new cr(fe,Ee,_e,Se,!1)}case"lab":{const[b,f,l,C]=mx(Gh(r.lab,s.lab,p));return new cr(b,f,l,C,!1)}}}}cr.black=new cr(0,0,0,1);cr.white=new cr(1,1,1,1);cr.transparent=new cr(0,0,0,0);cr.red=new cr(1,0,0,1);let Ry=class{constructor(r,s,p){r?this.sensitivity=s?"variant":"case":this.sensitivity=s?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,s){return this.collator.compare(r,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}};const $C=["bottom","center","top"];let Jg=class{constructor(r,s,p,m,b,f){this.text=r,this.image=s,this.scale=p,this.fontStack=m,this.textColor=b,this.verticalAlign=f}};class ko{constructor(r){this.sections=r}static fromString(r){return new ko([new Jg(r,null,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(r=>r.text.length!==0||r.image&&r.image.name.length!==0)}static factory(r){return r instanceof ko?r:ko.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map(r=>r.text).join("")}}class ma{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof ma)return r;if(typeof r=="number")return new ma([r,r,r,r]);if(Array.isArray(r)&&!(r.length<1||r.length>4)){for(const s of r)if(typeof s!="number")return;switch(r.length){case 1:r=[r[0],r[0],r[0],r[0]];break;case 2:r=[r[0],r[1],r[0],r[1]];break;case 3:r=[r[0],r[1],r[2],r[1]];break}return new ma(r)}}toString(){return JSON.stringify(this.values)}static interpolate(r,s,p){return new ma(Gh(r.values,s.values,p))}}class ga{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof ga)return r;if(typeof r=="number")return new ga([r]);if(Array.isArray(r)){for(const s of r)if(typeof s!="number")return;return new ga(r)}}toString(){return JSON.stringify(this.values)}static interpolate(r,s,p){return new ga(Gh(r.values,s.values,p))}}let gs=class wh{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof wh)return r;if(typeof r=="string"){const p=cr.parse(r);return p?new wh([p]):void 0}if(!Array.isArray(r))return;const s=[];for(const p of r){if(typeof p!="string")return;const m=cr.parse(p);if(!m)return;s.push(m)}return new wh(s)}toString(){return JSON.stringify(this.values)}static interpolate(r,s,p,m="rgb"){const b=[];if(r.values.length!=s.values.length)throw new Error(`colorArray: Arrays have mismatched length (${r.values.length} vs. ${s.values.length}), cannot interpolate.`);for(let f=0;f<r.values.length;f++)b.push(cr.interpolate(r.values[f],s.values[f],p,m));return new wh(b)}};class Lr extends Error{constructor(r){super(r),this.name="RuntimeError"}toJSON(){return this.message}}const NC=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Wa{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof Wa)return r;if(!(!Array.isArray(r)||r.length<1||r.length%2!==0)){for(let s=0;s<r.length;s+=2){const p=r[s],m=r[s+1];if(typeof p!="string"||!NC.has(p)||!Array.isArray(m)||m.length!==2||typeof m[0]!="number"||typeof m[1]!="number")return}return new Wa(r)}}toString(){return JSON.stringify(this.values)}static interpolate(r,s,p){const m=r.values,b=s.values;if(m.length!==b.length)throw new Lr(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${s.toString()}`);const f=[];for(let l=0;l<m.length;l+=2){if(m[l]!==b[l])throw new Lr(`Cannot interpolate values containing mismatched anchors. from[${l}]: ${m[l]}, to[${l}]: ${b[l]}`);f.push(m[l]);const[C,M]=m[l+1],[D,O]=b[l+1];f.push([_l(C,D,p),_l(M,O,p)])}return new Wa(f)}}class ws{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new ws({name:r,available:!1}):null}}let lp=class Fc{constructor(r,s,p){this.from=r,this.to=s,this.transition=p}static interpolate(r,s,p){return new Fc(r,s,p)}static parse(r){if(r instanceof Fc)return r;if(Array.isArray(r)&&r.length===3&&typeof r[0]=="string"&&typeof r[1]=="string"&&typeof r[2]=="number")return new Fc(r[0],r[1],r[2]);if(typeof r=="object"&&typeof r.from=="string"&&typeof r.to=="string"&&typeof r.transition=="number")return new Fc(r.from,r.to,r.transition);if(typeof r=="string")return new Fc(r,r,1)}};function gx(i,r,s,p){return typeof i=="number"&&i>=0&&i<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof s=="number"&&s>=0&&s<=255?typeof p>"u"||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[i,r,s,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[i,r,s,p]:[i,r,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Zh(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof lp||i instanceof cr||i instanceof Ry||i instanceof ko||i instanceof ma||i instanceof ga||i instanceof gs||i instanceof Wa||i instanceof ws)return!0;if(Array.isArray(i)){for(const r of i)if(!Zh(r))return!1;return!0}else if(typeof i=="object"){for(const r in i)if(!Zh(i[r]))return!1;return!0}else return!1}function ii(i){if(i===null)return _f;if(typeof i=="string")return Nt;if(typeof i=="boolean")return Lt;if(typeof i=="number")return He;if(i instanceof cr)return Za;if(i instanceof lp)return vf;if(i instanceof Ry)return bf;if(i instanceof ko)return xf;if(i instanceof ma)return wf;if(i instanceof ga)return Tf;if(i instanceof gs)return Vh;if(i instanceof Wa)return Sf;if(i instanceof ws)return sp;if(Array.isArray(i)){const r=i.length;let s;for(const p of i){const m=ii(p);if(!s)s=m;else{if(s===m)continue;s=It;break}}return zn(s||It,r)}else return gl}function Dh(i){const r=typeof i;return i===null?"":r==="string"||r==="number"||r==="boolean"?String(i):i instanceof cr||i instanceof lp||i instanceof ko||i instanceof ma||i instanceof ga||i instanceof gs||i instanceof Wa||i instanceof ws?i.toString():JSON.stringify(i)}let Kd=class yx{constructor(r,s){this.type=r,this.value=s}static parse(r,s){if(r.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!Zh(r[1]))return s.error("invalid value");const p=r[1];let m=ii(p);const b=s.expectedType;return m.kind==="array"&&m.N===0&&b&&b.kind==="array"&&(typeof b.N!="number"||b.N===0)&&(m=b),new yx(m,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}};const Md={string:Nt,number:He,boolean:Lt,object:gl};let wo=class _x{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");let p=1,m;const b=r[0];if(b==="array"){let l;if(r.length>2){const M=r[1];if(typeof M!="string"||!(M in Md)||M==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);l=Md[M],p++}else l=It;let C;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return s.error('The length argument to "array" must be a positive integer literal',2);C=r[2],p++}m=zn(l,C)}else{if(!Md[b])throw new Error(`Types doesn't contain name = ${b}`);m=Md[b]}const f=[];for(;p<r.length;p++){const l=s.parse(r[p],p,It);if(!l)return null;f.push(l)}return new _x(m,f)}evaluate(r){for(let s=0;s<this.args.length;s++){const p=this.args[s].evaluate(r);if(qh(this.type,ii(p))){if(s===this.args.length-1)throw new Lr(`Expected value to be of type ${Ir(this.type)}, but found ${Ir(ii(p))} instead.`)}else return p}throw new Error}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}};const Nv={"to-boolean":Lt,"to-color":Za,"to-number":He,"to-string":Nt};let Uc=class vx{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");const p=r[0];if(!Nv[p])throw new Error(`Can't parse ${p} as it is not part of the known types`);if((p==="to-boolean"||p==="to-string")&&r.length!==2)return s.error("Expected one argument.");const m=Nv[p],b=[];for(let f=1;f<r.length;f++){const l=s.parse(r[f],f,It);if(!l)return null;b.push(l)}return new vx(m,b)}evaluate(r){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(r);case"color":{let s,p;for(const m of this.args){if(s=m.evaluate(r),p=null,s instanceof cr)return s;if(typeof s=="string"){const b=r.parseColor(s);if(b)return b}else if(Array.isArray(s)&&(s.length<3||s.length>4?p=`Invalid rgba value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:p=gx(s[0],s[1],s[2],s[3]),!p))return new cr(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Lr(p||`Could not parse color from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"padding":{let s;for(const p of this.args){s=p.evaluate(r);const m=ma.parse(s);if(m)return m}throw new Lr(`Could not parse padding from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"numberArray":{let s;for(const p of this.args){s=p.evaluate(r);const m=ga.parse(s);if(m)return m}throw new Lr(`Could not parse numberArray from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"colorArray":{let s;for(const p of this.args){s=p.evaluate(r);const m=gs.parse(s);if(m)return m}throw new Lr(`Could not parse colorArray from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"variableAnchorOffsetCollection":{let s;for(const p of this.args){s=p.evaluate(r);const m=Wa.parse(s);if(m)return m}throw new Lr(`Could not parse variableAnchorOffsetCollection from value '${typeof s=="string"?s:JSON.stringify(s)}'`)}case"number":{let s=null;for(const p of this.args){if(s=p.evaluate(r),s===null)return 0;const m=Number(s);if(!isNaN(m))return m}throw new Lr(`Could not convert ${JSON.stringify(s)} to number.`)}case"formatted":return ko.fromString(Dh(this.args[0].evaluate(r)));case"resolvedImage":return ws.fromString(Dh(this.args[0].evaluate(r)));case"projectionDefinition":return this.args[0].evaluate(r);default:return Dh(this.args[0].evaluate(r))}}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}};const UC=["Unknown","Point","LineString","Polygon"];let bx=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?UC[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(r){let s=this._parseColorCache.get(r);return s||(s=cr.parse(r),this._parseColorCache.set(r,s)),s}},xx=class wx{constructor(r,s,p=[],m,b=new MC,f=[]){this.registry=r,this.path=p,this.key=p.map(l=>`[${l}]`).join(""),this.scope=b,this.errors=f,this.expectedType=m,this._isConstant=s}parse(r,s,p,m,b={}){return s?this.concat(s,p,m)._parse(r,b):this._parse(r,b)}_parse(r,s){(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number")&&(r=["literal",r]);function p(m,b,f){return f==="assert"?new wo(b,[m]):f==="coerce"?new Uc(b,[m]):m}if(Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=r[0];if(typeof m!="string")return this.error(`Expression name must be a string, but found ${typeof m} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const b=this.registry[m];if(b){let f=b.parse(r,this);if(!f)return null;if(this.expectedType){const l=this.expectedType,C=f.type;if((l.kind==="string"||l.kind==="number"||l.kind==="boolean"||l.kind==="object"||l.kind==="array")&&C.kind==="value")f=p(f,l,s.typeAnnotation||"assert");else if(l.kind==="projectionDefinition"&&["string","array"].includes(C.kind)||["color","formatted","resolvedImage"].includes(l.kind)&&["value","string"].includes(C.kind)||["padding","numberArray"].includes(l.kind)&&["value","number","array"].includes(C.kind)||l.kind==="colorArray"&&["value","string","array"].includes(C.kind)||l.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(C.kind))f=p(f,l,s.typeAnnotation||"coerce");else if(this.checkSubtype(l,C))return null}if(!(f instanceof Kd)&&f.type.kind!=="resolvedImage"&&this._isConstant(f)){const l=new bx;try{f=new Kd(f.type,f.evaluate(l))}catch(C){return this.error(C.message),null}}return f}return this.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof r>"u"?this.error("'undefined' value invalid. Use null instead."):typeof r=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof r} instead.`)}concat(r,s,p){const m=typeof r=="number"?this.path.concat(r):this.path,b=p?this.scope.concat(p):this.scope;return new wx(this.registry,this._isConstant,m,s||null,b,this.errors)}error(r,...s){const p=`${this.key}${s.map(m=>`[${m}]`).join("")}`;this.errors.push(new Va(p,r))}checkSubtype(r,s){const p=qh(r,s);return p&&this.error(p),p}},Tx=class Sx{constructor(r,s){this.type=s.type,this.bindings=[].concat(r),this.result=s}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const s of this.bindings)r(s[1]);r(this.result)}static parse(r,s){if(r.length<4)return s.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const p=[];for(let b=1;b<r.length-1;b+=2){const f=r[b];if(typeof f!="string")return s.error(`Expected string, but found ${typeof f} instead.`,b);if(/[^a-zA-Z0-9_]/.test(f))return s.error("Variable names must contain only alphanumeric characters or '_'.",b);const l=s.parse(r[b+1],b+1);if(!l)return null;p.push([f,l])}const m=s.parse(r[r.length-1],r.length-1,s.expectedType,p);return m?new Sx(p,m):null}outputDefined(){return this.result.outputDefined()}},kx=class Cx{constructor(r,s){this.type=s.type,this.name=r,this.boundExpression=s}static parse(r,s){if(r.length!==2||typeof r[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const p=r[1];return s.scope.has(p)?new Cx(p,s.scope.get(p)):s.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}},VC=class Px{constructor(r,s,p){this.type=r,this.index=s,this.input=p}static parse(r,s){if(r.length!==3)return s.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const p=s.parse(r[1],1,He),m=s.parse(r[2],2,zn(s.expectedType||It));if(!p||!m)return null;const b=m.type;return new Px(b.itemType,p,m)}evaluate(r){const s=this.index.evaluate(r),p=this.input.evaluate(r);if(s<0)throw new Lr(`Array index out of bounds: ${s} < 0.`);if(s>=p.length)throw new Lr(`Array index out of bounds: ${s} > ${p.length-1}.`);if(s!==Math.floor(s))throw new Lr(`Array index must be an integer, but found ${s} instead.`);return p[s]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}},qC=class Mx{constructor(r,s){this.type=Lt,this.needle=r,this.haystack=s}static parse(r,s){if(r.length!==3)return s.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const p=s.parse(r[1],1,It),m=s.parse(r[2],2,It);return!p||!m?null:zy(p.type,[Lt,Nt,He,_f,It])?new Mx(p,m):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ir(p.type)} instead`)}evaluate(r){const s=this.needle.evaluate(r),p=this.haystack.evaluate(r);if(!p)return!1;if(!yl(s,["boolean","string","number","null"]))throw new Lr(`Expected first argument to be of type boolean, string, number or null, but found ${Ir(ii(s))} instead.`);if(!yl(p,["string","array"]))throw new Lr(`Expected second argument to be of type array or string, but found ${Ir(ii(p))} instead.`);return p.indexOf(s)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}},GC=class Qg{constructor(r,s,p){this.type=He,this.needle=r,this.haystack=s,this.fromIndex=p}static parse(r,s){if(r.length<=2||r.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const p=s.parse(r[1],1,It),m=s.parse(r[2],2,It);if(!p||!m)return null;if(!zy(p.type,[Lt,Nt,He,_f,It]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ir(p.type)} instead`);if(r.length===4){const b=s.parse(r[3],3,He);return b?new Qg(p,m,b):null}else return new Qg(p,m)}evaluate(r){const s=this.needle.evaluate(r),p=this.haystack.evaluate(r);if(!yl(s,["boolean","string","number","null"]))throw new Lr(`Expected first argument to be of type boolean, string, number or null, but found ${Ir(ii(s))} instead.`);let m;if(this.fromIndex&&(m=this.fromIndex.evaluate(r)),yl(p,["string"])){const b=p.indexOf(s,m);return b===-1?-1:[...p.slice(0,b)].length}else{if(yl(p,["array"]))return p.indexOf(s,m);throw new Lr(`Expected second argument to be of type array or string, but found ${Ir(ii(p))} instead.`)}}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}},ZC=class Ax{constructor(r,s,p,m,b,f){this.inputType=r,this.type=s,this.input=p,this.cases=m,this.outputs=b,this.otherwise=f}static parse(r,s){if(r.length<5)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!==1)return s.error("Expected an even number of arguments.");let p,m;s.expectedType&&s.expectedType.kind!=="value"&&(m=s.expectedType);const b={},f=[];for(let M=2;M<r.length-1;M+=2){let D=r[M];const O=r[M+1];Array.isArray(D)||(D=[D]);const Z=s.concat(M);if(D.length===0)return Z.error("Expected at least one branch label.");for(const ne of D){if(typeof ne!="number"&&typeof ne!="string")return Z.error("Branch labels must be numbers or strings.");if(typeof ne=="number"&&Math.abs(ne)>Number.MAX_SAFE_INTEGER)return Z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ne=="number"&&Math.floor(ne)!==ne)return Z.error("Numeric branch labels must be integer values.");if(!p)p=ii(ne);else if(Z.checkSubtype(p,ii(ne)))return null;if(typeof b[String(ne)]<"u")return Z.error("Branch labels must be unique.");b[String(ne)]=f.length}const $=s.parse(O,M,m);if(!$)return null;m=m||$.type,f.push($)}const l=s.parse(r[1],1,It);if(!l)return null;const C=s.parse(r[r.length-1],r.length-1,m);return!C||l.type.kind!=="value"&&s.concat(1).checkSubtype(p,l.type)?null:new Ax(p,m,l,b,f,C)}evaluate(r){const s=this.input.evaluate(r);return(ii(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}},WC=class Ix{constructor(r,s,p){this.type=r,this.branches=s,this.otherwise=p}static parse(r,s){if(r.length<4)return s.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!==0)return s.error("Expected an odd number of arguments.");let p;s.expectedType&&s.expectedType.kind!=="value"&&(p=s.expectedType);const m=[];for(let f=1;f<r.length-1;f+=2){const l=s.parse(r[f],f,Lt);if(!l)return null;const C=s.parse(r[f+1],f+1,p);if(!C)return null;m.push([l,C]),p=p||C.type}const b=s.parse(r[r.length-1],r.length-1,p);if(!b)return null;if(!p)throw new Error("Can't infer output type");return new Ix(p,m,b)}evaluate(r){for(const[s,p]of this.branches)if(s.evaluate(r))return p.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[s,p]of this.branches)r(s),r(p);r(this.otherwise)}outputDefined(){return this.branches.every(([r,s])=>s.outputDefined())&&this.otherwise.outputDefined()}},HC=class ey{constructor(r,s,p,m){this.type=r,this.input=s,this.beginIndex=p,this.endIndex=m}static parse(r,s){if(r.length<=2||r.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const p=s.parse(r[1],1,It),m=s.parse(r[2],2,He);if(!p||!m)return null;if(!zy(p.type,[zn(It),Nt,It]))return s.error(`Expected first argument to be of type array or string, but found ${Ir(p.type)} instead`);if(r.length===4){const b=s.parse(r[3],3,He);return b?new ey(p.type,p,m,b):null}else return new ey(p.type,p,m)}evaluate(r){const s=this.input.evaluate(r),p=this.beginIndex.evaluate(r);let m;if(this.endIndex&&(m=this.endIndex.evaluate(r)),yl(s,["string"]))return[...s].slice(p,m).join("");if(yl(s,["array"]))return s.slice(p,m);throw new Lr(`Expected first argument to be of type array or string, but found ${Ir(ii(s))} instead.`)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}};function Ex(i,r){const s=i.length-1;let p=0,m=s,b=0,f,l;for(;p<=m;)if(b=Math.floor((p+m)/2),f=i[b],l=i[b+1],f<=r){if(b===s||r<l)return b;p=b+1}else if(f>r)m=b-1;else throw new Lr("Input is not a number.");return 0}let zx=class Rx{constructor(r,s,p){this.type=r,this.input=s,this.labels=[],this.outputs=[];for(const[m,b]of p)this.labels.push(m),this.outputs.push(b)}static parse(r,s){if(r.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!==0)return s.error("Expected an even number of arguments.");const p=s.parse(r[1],1,He);if(!p)return null;const m=[];let b=null;s.expectedType&&s.expectedType.kind!=="value"&&(b=s.expectedType);for(let f=1;f<r.length;f+=2){const l=f===1?-1/0:r[f],C=r[f+1],M=f,D=f+1;if(typeof l!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(m.length&&m[m.length-1][0]>=l)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const O=s.parse(C,D,b);if(!O)return null;b=b||O.type,m.push([l,O])}return new Rx(b,p,m)}evaluate(r){const s=this.labels,p=this.outputs;if(s.length===1)return p[0].evaluate(r);const m=this.input.evaluate(r);if(m<=s[0])return p[0].evaluate(r);const b=s.length;if(m>=s[b-1])return p[b-1].evaluate(r);const f=Ex(s,m);return p[f].evaluate(r)}eachChild(r){r(this.input);for(const s of this.outputs)r(s)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}};function XC(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var sg,Uv;function KC(){if(Uv)return sg;Uv=1,sg=i;function i(r,s,p,m){this.cx=3*r,this.bx=3*(p-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(m-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=s,this.p2x=p,this.p2y=m}return i.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,s){if(s===void 0&&(s=1e-6),r<0)return 0;if(r>1)return 1;for(var p=r,m=0;m<8;m++){var b=this.sampleCurveX(p)-r;if(Math.abs(b)<s)return p;var f=this.sampleCurveDerivativeX(p);if(Math.abs(f)<1e-6)break;p=p-b/f}var l=0,C=1;for(p=r,m=0;m<20&&(b=this.sampleCurveX(p),!(Math.abs(b-r)<s));m++)r>b?l=p:C=p,p=(C-l)*.5+l;return p},solve:function(r,s){return this.sampleCurveY(this.solveCurveX(r,s))}},sg}var YC=KC(),JC=XC(YC);let vl=class ty{constructor(r,s,p,m,b){this.type=r,this.operator=s,this.interpolation=p,this.input=m,this.labels=[],this.outputs=[];for(const[f,l]of b)this.labels.push(f),this.outputs.push(l)}static interpolationFactor(r,s,p,m){let b=0;if(r.name==="exponential")b=lg(s,r.base,p,m);else if(r.name==="linear")b=lg(s,1,p,m);else if(r.name==="cubic-bezier"){const f=r.controlPoints;b=new JC(f[0],f[1],f[2],f[3]).solve(lg(s,1,p,m))}return b}static parse(r,s){let[p,m,b,...f]=r;if(!Array.isArray(m)||m.length===0)return s.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){const M=m[1];if(typeof M!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:M}}else if(m[0]==="cubic-bezier"){const M=m.slice(1);if(M.length!==4||M.some(D=>typeof D!="number"||D<0||D>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:M}}else return s.error(`Unknown interpolation type ${String(m[0])}`,1,0);if(r.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!==0)return s.error("Expected an even number of arguments.");if(b=s.parse(b,2,He),!b)return null;const l=[];let C=null;(p==="interpolate-hcl"||p==="interpolate-lab")&&s.expectedType!=Vh?C=Za:s.expectedType&&s.expectedType.kind!=="value"&&(C=s.expectedType);for(let M=0;M<f.length;M+=2){const D=f[M],O=f[M+1],Z=M+3,$=M+4;if(typeof D!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Z);if(l.length&&l[l.length-1][0]>=D)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Z);const ne=s.parse(O,$,C);if(!ne)return null;C=C||ne.type,l.push([D,ne])}return!cs(C,He)&&!cs(C,vf)&&!cs(C,Za)&&!cs(C,wf)&&!cs(C,Tf)&&!cs(C,Vh)&&!cs(C,Sf)&&!cs(C,zn(He))?s.error(`Type ${Ir(C)} is not interpolatable.`):new ty(C,p,m,b,l)}evaluate(r){const s=this.labels,p=this.outputs;if(s.length===1)return p[0].evaluate(r);const m=this.input.evaluate(r);if(m<=s[0])return p[0].evaluate(r);const b=s.length;if(m>=s[b-1])return p[b-1].evaluate(r);const f=Ex(s,m),l=s[f],C=s[f+1],M=ty.interpolationFactor(this.interpolation,m,l,C),D=p[f].evaluate(r),O=p[f+1].evaluate(r);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return _l(D,O,M);case"color":return cr.interpolate(D,O,M);case"padding":return ma.interpolate(D,O,M);case"colorArray":return gs.interpolate(D,O,M);case"numberArray":return ga.interpolate(D,O,M);case"variableAnchorOffsetCollection":return Wa.interpolate(D,O,M);case"array":return Gh(D,O,M);case"projectionDefinition":return lp.interpolate(D,O,M)}case"interpolate-hcl":switch(this.type.kind){case"color":return cr.interpolate(D,O,M,"hcl");case"colorArray":return gs.interpolate(D,O,M,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return cr.interpolate(D,O,M,"lab");case"colorArray":return gs.interpolate(D,O,M,"lab")}}}eachChild(r){r(this.input);for(const s of this.outputs)r(s)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}};function lg(i,r,s,p){const m=p-s,b=i-s;return m===0?0:r===1?b/m:(Math.pow(r,b)-1)/(Math.pow(r,m)-1)}let Lx=class ry{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");let p=null;const m=s.expectedType;m&&m.kind!=="value"&&(p=m);const b=[];for(const f of r.slice(1)){const l=s.parse(f,1+b.length,p,void 0,{typeAnnotation:"omit"});if(!l)return null;p=p||l.type,b.push(l)}if(!p)throw new Error("No output type");return m&&b.some(f=>qh(m,f.type))?new ry(It,b):new ry(p,b)}evaluate(r){let s=null,p=0,m;for(const b of this.args)if(p++,s=b.evaluate(r),s&&s instanceof ws&&!s.available&&(m||(m=s.name),s=null,p===this.args.length&&(s=m)),s!==null)break;return s}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}};function Vv(i,r){return i==="=="||i==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function QC(i,r,s){return r===s}function eP(i,r,s){return r!==s}function tP(i,r,s){return r<s}function rP(i,r,s){return r>s}function iP(i,r,s){return r<=s}function nP(i,r,s){return r>=s}function Dx(i,r,s,p){return p.compare(r,s)===0}function aP(i,r,s,p){return!Dx(i,r,s,p)}function oP(i,r,s,p){return p.compare(r,s)<0}function sP(i,r,s,p){return p.compare(r,s)>0}function lP(i,r,s,p){return p.compare(r,s)<=0}function cP(i,r,s,p){return p.compare(r,s)>=0}function nu(i,r,s){const p=i!=="=="&&i!=="!=";return class jx{constructor(b,f,l){this.type=Lt,this.lhs=b,this.rhs=f,this.collator=l,this.hasUntypedArgument=b.type.kind==="value"||f.type.kind==="value"}static parse(b,f){if(b.length!==3&&b.length!==4)return f.error("Expected two or three arguments.");const l=b[0];let C=f.parse(b[1],1,It);if(!C)return null;if(!Vv(l,C.type))return f.concat(1).error(`"${l}" comparisons are not supported for type '${Ir(C.type)}'.`);let M=f.parse(b[2],2,It);if(!M)return null;if(!Vv(l,M.type))return f.concat(2).error(`"${l}" comparisons are not supported for type '${Ir(M.type)}'.`);if(C.type.kind!==M.type.kind&&C.type.kind!=="value"&&M.type.kind!=="value")return f.error(`Cannot compare types '${Ir(C.type)}' and '${Ir(M.type)}'.`);p&&(C.type.kind==="value"&&M.type.kind!=="value"?C=new wo(M.type,[C]):C.type.kind!=="value"&&M.type.kind==="value"&&(M=new wo(C.type,[M])));let D=null;if(b.length===4){if(C.type.kind!=="string"&&M.type.kind!=="string"&&C.type.kind!=="value"&&M.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(D=f.parse(b[3],3,bf),!D)return null}return new jx(C,M,D)}evaluate(b){const f=this.lhs.evaluate(b),l=this.rhs.evaluate(b);if(p&&this.hasUntypedArgument){const C=ii(f),M=ii(l);if(C.kind!==M.kind||!(C.kind==="string"||C.kind==="number"))throw new Lr(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${C.kind}, ${M.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const C=ii(f),M=ii(l);if(C.kind!=="string"||M.kind!=="string")return r(b,f,l)}return this.collator?s(b,f,l,this.collator.evaluate(b)):r(b,f,l)}eachChild(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)}outputDefined(){return!0}}}const uP=nu("==",QC,Dx),hP=nu("!=",eP,aP),pP=nu("<",tP,oP),dP=nu(">",rP,sP),fP=nu("<=",iP,lP),mP=nu(">=",nP,cP);let Fx=class Ox{constructor(r,s,p){this.type=bf,this.locale=p,this.caseSensitive=r,this.diacriticSensitive=s}static parse(r,s){if(r.length!==2)return s.error("Expected one argument.");const p=r[1];if(typeof p!="object"||Array.isArray(p))return s.error("Collator options argument must be an object.");const m=s.parse(p["case-sensitive"]===void 0?!1:p["case-sensitive"],1,Lt);if(!m)return null;const b=s.parse(p["diacritic-sensitive"]===void 0?!1:p["diacritic-sensitive"],1,Lt);if(!b)return null;let f=null;return p.locale&&(f=s.parse(p.locale,1,Nt),!f)?null:new Ox(m,b,f)}evaluate(r){return new Ry(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}},gP=class Bx{constructor(r,s,p,m,b){this.type=Nt,this.number=r,this.locale=s,this.currency=p,this.minFractionDigits=m,this.maxFractionDigits=b}static parse(r,s){if(r.length!==3)return s.error("Expected two arguments.");const p=s.parse(r[1],1,He);if(!p)return null;const m=r[2];if(typeof m!="object"||Array.isArray(m))return s.error("NumberFormat options argument must be an object.");let b=null;if(m.locale&&(b=s.parse(m.locale,1,Nt),!b))return null;let f=null;if(m.currency&&(f=s.parse(m.currency,1,Nt),!f))return null;let l=null;if(m["min-fraction-digits"]&&(l=s.parse(m["min-fraction-digits"],1,He),!l))return null;let C=null;return m["max-fraction-digits"]&&(C=s.parse(m["max-fraction-digits"],1,He),!C)?null:new Bx(p,b,f,l,C)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}},yP=class $x{constructor(r){this.type=xf,this.sections=r}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");const p=r[1];if(!Array.isArray(p)&&typeof p=="object")return s.error("First argument must be an image or text section.");const m=[];let b=!1;for(let f=1;f<=r.length-1;++f){const l=r[f];if(b&&typeof l=="object"&&!Array.isArray(l)){b=!1;let C=null;if(l["font-scale"]&&(C=s.parse(l["font-scale"],1,He),!C))return null;let M=null;if(l["text-font"]&&(M=s.parse(l["text-font"],1,zn(Nt)),!M))return null;let D=null;if(l["text-color"]&&(D=s.parse(l["text-color"],1,Za),!D))return null;let O=null;if(l["vertical-align"]){if(typeof l["vertical-align"]=="string"&&!$C.includes(l["vertical-align"]))return s.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${l["vertical-align"]}' instead.`);if(O=s.parse(l["vertical-align"],1,Nt),!O)return null}const Z=m[m.length-1];Z.scale=C,Z.font=M,Z.textColor=D,Z.verticalAlign=O}else{const C=s.parse(r[f],1,It);if(!C)return null;const M=C.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,m.push({content:C,scale:null,font:null,textColor:null,verticalAlign:null})}}return new $x(m)}evaluate(r){const s=p=>{const m=p.content.evaluate(r);return ii(m)===sp?new Jg("",m,null,null,null,p.verticalAlign?p.verticalAlign.evaluate(r):null):new Jg(Dh(m),null,p.scale?p.scale.evaluate(r):null,p.font?p.font.evaluate(r).join(","):null,p.textColor?p.textColor.evaluate(r):null,p.verticalAlign?p.verticalAlign.evaluate(r):null)};return new ko(this.sections.map(s))}eachChild(r){for(const s of this.sections)r(s.content),s.scale&&r(s.scale),s.font&&r(s.font),s.textColor&&r(s.textColor),s.verticalAlign&&r(s.verticalAlign)}outputDefined(){return!1}},_P=class Nx{constructor(r){this.type=sp,this.input=r}static parse(r,s){if(r.length!==2)return s.error("Expected two arguments.");const p=s.parse(r[1],1,Nt);return p?new Nx(p):s.error("No image name provided.")}evaluate(r){const s=this.input.evaluate(r),p=ws.fromString(s);return p&&r.availableImages&&(p.available=r.availableImages.indexOf(s)>-1),p}eachChild(r){r(this.input)}outputDefined(){return!1}},vP=class Ux{constructor(r){this.type=He,this.input=r}static parse(r,s){if(r.length!==2)return s.error(`Expected 1 argument, but found ${r.length-1} instead.`);const p=s.parse(r[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${Ir(p.type)} instead.`):new Ux(p):null}evaluate(r){const s=this.input.evaluate(r);if(typeof s=="string")return[...s].length;if(Array.isArray(s))return s.length;throw new Lr(`Expected value to be of type string or array, but found ${Ir(ii(s))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}};const Ha=8192;function bP(i,r){const s=xP(i[0]),p=TP(i[1]),m=Math.pow(2,r.z);return[Math.round(s*m*Ha),Math.round(p*m*Ha)]}function Ly(i,r){const s=Math.pow(2,r.z),p=(i[0]/Ha+r.x)/s,m=(i[1]/Ha+r.y)/s;return[wP(p),SP(m)]}function xP(i){return(180+i)/360}function wP(i){return i*360-180}function TP(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function SP(i){return 360/Math.PI*Math.atan(Math.exp((180-i*360)*Math.PI/180))-90}function cp(i,r){i[0]=Math.min(i[0],r[0]),i[1]=Math.min(i[1],r[1]),i[2]=Math.max(i[2],r[0]),i[3]=Math.max(i[3],r[1])}function Wh(i,r){return!(i[0]<=r[0]||i[2]>=r[2]||i[1]<=r[1]||i[3]>=r[3])}function kP(i,r,s){return r[1]>i[1]!=s[1]>i[1]&&i[0]<(s[0]-r[0])*(i[1]-r[1])/(s[1]-r[1])+r[0]}function CP(i,r,s){const p=i[0]-r[0],m=i[1]-r[1],b=i[0]-s[0],f=i[1]-s[1];return p*f-b*m===0&&p*b<=0&&m*f<=0}function kf(i,r,s,p){const m=[r[0]-i[0],r[1]-i[1]],b=[p[0]-s[0],p[1]-s[1]];return IP(b,m)===0?!1:!!(qv(i,r,s,p)&&qv(s,p,i,r))}function PP(i,r,s){for(const p of s)for(let m=0;m<p.length-1;++m)if(kf(i,r,p[m],p[m+1]))return!0;return!1}function au(i,r,s=!1){let p=!1;for(const m of r)for(let b=0;b<m.length-1;b++){if(CP(i,m[b],m[b+1]))return s;kP(i,m[b],m[b+1])&&(p=!p)}return p}function MP(i,r){for(const s of r)if(au(i,s))return!0;return!1}function Vx(i,r){for(const s of i)if(!au(s,r))return!1;for(let s=0;s<i.length-1;++s)if(PP(i[s],i[s+1],r))return!1;return!0}function AP(i,r){for(const s of r)if(Vx(i,s))return!0;return!1}function IP(i,r){return i[0]*r[1]-i[1]*r[0]}function qv(i,r,s,p){const m=i[0]-s[0],b=i[1]-s[1],f=r[0]-s[0],l=r[1]-s[1],C=p[0]-s[0],M=p[1]-s[1],D=m*M-C*b,O=f*M-C*l;return D>0&&O<0||D<0&&O>0}function Dy(i,r,s){const p=[];for(let m=0;m<i.length;m++){const b=[];for(let f=0;f<i[m].length;f++){const l=bP(i[m][f],s);cp(r,l),b.push(l)}p.push(b)}return p}function qx(i,r,s){const p=[];for(let m=0;m<i.length;m++){const b=Dy(i[m],r,s);p.push(b)}return p}function Gx(i,r,s,p){if(i[0]<s[0]||i[0]>s[2]){const m=p*.5;let b=i[0]-s[0]>m?-p:s[0]-i[0]>m?p:0;b===0&&(b=i[0]-s[2]>m?-p:s[2]-i[0]>m?p:0),i[0]+=b}cp(r,i)}function EP(i){i[0]=i[1]=1/0,i[2]=i[3]=-1/0}function Gv(i,r,s,p){const m=Math.pow(2,p.z)*Ha,b=[p.x*Ha,p.y*Ha],f=[];for(const l of i)for(const C of l){const M=[C.x+b[0],C.y+b[1]];Gx(M,r,s,m),f.push(M)}return f}function Zv(i,r,s,p){const m=Math.pow(2,p.z)*Ha,b=[p.x*Ha,p.y*Ha],f=[];for(const l of i){const C=[];for(const M of l){const D=[M.x+b[0],M.y+b[1]];cp(r,D),C.push(D)}f.push(C)}if(r[2]-r[0]<=m/2){EP(r);for(const l of f)for(const C of l)Gx(C,r,s,m)}return f}function zP(i,r){const s=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(r.type==="Polygon"){const b=Dy(r.coordinates,p,m),f=Gv(i.geometry(),s,p,m);if(!Wh(s,p))return!1;for(const l of f)if(!au(l,b))return!1}if(r.type==="MultiPolygon"){const b=qx(r.coordinates,p,m),f=Gv(i.geometry(),s,p,m);if(!Wh(s,p))return!1;for(const l of f)if(!MP(l,b))return!1}return!0}function RP(i,r){const s=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(r.type==="Polygon"){const b=Dy(r.coordinates,p,m),f=Zv(i.geometry(),s,p,m);if(!Wh(s,p))return!1;for(const l of f)if(!Vx(l,b))return!1}if(r.type==="MultiPolygon"){const b=qx(r.coordinates,p,m),f=Zv(i.geometry(),s,p,m);if(!Wh(s,p))return!1;for(const l of f)if(!AP(l,b))return!1}return!0}class bl{constructor(r,s){this.type=Lt,this.geojson=r,this.geometries=s}static parse(r,s){if(r.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(Zh(r[1])){const p=r[1];if(p.type==="FeatureCollection"){const m=[];for(const b of p.features){const{type:f,coordinates:l}=b.geometry;f==="Polygon"&&m.push(l),f==="MultiPolygon"&&m.push(...l)}if(m.length){const b={type:"MultiPolygon",coordinates:m};return new bl(p,b)}}else if(p.type==="Feature"){const m=p.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new bl(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new bl(p,p)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return zP(r,this.geometries);if(r.geometryType()==="LineString")return RP(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Zx=class{constructor(r=[],s=(p,m)=>p<m?-1:p>m?1:0){if(this.data=r,this.length=this.data.length,this.compare=s,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:s,compare:p}=this,m=s[r];for(;r>0;){const b=r-1>>1,f=s[b];if(p(m,f)>=0)break;s[r]=f,r=b}s[r]=m}_down(r){const{data:s,compare:p}=this,m=this.length>>1,b=s[r];for(;r<m;){let f=(r<<1)+1;const l=f+1;if(l<this.length&&p(s[l],s[f])<0&&(f=l),p(s[f],b)>=0)break;s[r]=s[f],r=f}s[r]=b}};function LP(i,r){if(i.length<=1)return[i];const s=[];let p,m;for(const b of i){const f=DP(b);f!==0&&(b.area=Math.abs(f),m===void 0&&(m=f<0),m===f<0?(p&&s.push(p),p=[b]):p.push(b))}return p&&s.push(p),s}function DP(i){let r=0;for(let s=0,p=i.length,m=p-1,b,f;s<p;m=s++)b=i[s],f=i[m],r+=(f.x-b.x)*(b.y+f.y);return r}const jP=6378.137,Wv=1/298.257223563,Hv=Wv*(2-Wv),Xv=Math.PI/180;let jy=class{constructor(r){const s=Xv*jP*1e3,p=Math.cos(r*Xv),m=1/(1-Hv*(1-p*p)),b=Math.sqrt(m);this.kx=s*b*p,this.ky=s*b*m*(1-Hv)}distance(r,s){const p=this.wrap(r[0]-s[0])*this.kx,m=(r[1]-s[1])*this.ky;return Math.sqrt(p*p+m*m)}pointOnLine(r,s){let p=1/0,m,b,f,l;for(let C=0;C<r.length-1;C++){let M=r[C][0],D=r[C][1],O=this.wrap(r[C+1][0]-M)*this.kx,Z=(r[C+1][1]-D)*this.ky,$=0;(O!==0||Z!==0)&&($=(this.wrap(s[0]-M)*this.kx*O+(s[1]-D)*this.ky*Z)/(O*O+Z*Z),$>1?(M=r[C+1][0],D=r[C+1][1]):$>0&&(M+=O/this.kx*$,D+=Z/this.ky*$)),O=this.wrap(s[0]-M)*this.kx,Z=(s[1]-D)*this.ky;const ne=O*O+Z*Z;ne<p&&(p=ne,m=M,b=D,f=C,l=$)}return{point:[m,b],index:f,t:Math.max(0,Math.min(1,l))}}wrap(r){for(;r<-180;)r+=360;for(;r>180;)r-=360;return r}};const iy=100,ny=50;function Wx(i,r){return r[0]-i[0]}function Yd(i){return i[1]-i[0]+1}function Ao(i,r){return i[1]>=i[0]&&i[1]<r}function ay(i,r){if(i[0]>i[1])return[null,null];const s=Yd(i);if(r){if(s===2)return[i,null];const m=Math.floor(s/2);return[[i[0],i[0]+m],[i[0]+m,i[1]]]}if(s===1)return[i,null];const p=Math.floor(s/2)-1;return[[i[0],i[0]+p],[i[0]+p+1,i[1]]]}function oy(i,r){if(!Ao(r,i.length))return[1/0,1/0,-1/0,-1/0];const s=[1/0,1/0,-1/0,-1/0];for(let p=r[0];p<=r[1];++p)cp(s,i[p]);return s}function sy(i){const r=[1/0,1/0,-1/0,-1/0];for(const s of i)for(const p of s)cp(r,p);return r}function Kv(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function Fy(i,r,s){if(!Kv(i)||!Kv(r))return NaN;let p=0,m=0;return i[2]<r[0]&&(p=r[0]-i[2]),i[0]>r[2]&&(p=i[0]-r[2]),i[1]>r[3]&&(m=i[1]-r[3]),i[3]<r[1]&&(m=r[1]-i[3]),s.distance([0,0],[p,m])}function fl(i,r,s){const p=s.pointOnLine(r,i);return s.distance(i,p.point)}function Oy(i,r,s,p,m){const b=Math.min(fl(i,[s,p],m),fl(r,[s,p],m)),f=Math.min(fl(s,[i,r],m),fl(p,[i,r],m));return Math.min(b,f)}function FP(i,r,s,p,m){if(!(Ao(r,i.length)&&Ao(p,s.length)))return 1/0;let b=1/0;for(let f=r[0];f<r[1];++f){const l=i[f],C=i[f+1];for(let M=p[0];M<p[1];++M){const D=s[M],O=s[M+1];if(kf(l,C,D,O))return 0;b=Math.min(b,Oy(l,C,D,O,m))}}return b}function OP(i,r,s,p,m){if(!(Ao(r,i.length)&&Ao(p,s.length)))return NaN;let b=1/0;for(let f=r[0];f<=r[1];++f)for(let l=p[0];l<=p[1];++l)if(b=Math.min(b,m.distance(i[f],s[l])),b===0)return b;return b}function BP(i,r,s){if(au(i,r,!0))return 0;let p=1/0;for(const m of r){const b=m[0],f=m[m.length-1];if(b!==f&&(p=Math.min(p,fl(i,[f,b],s)),p===0))return p;const l=s.pointOnLine(m,i);if(p=Math.min(p,s.distance(i,l.point)),p===0)return p}return p}function $P(i,r,s,p){if(!Ao(r,i.length))return NaN;for(let b=r[0];b<=r[1];++b)if(au(i[b],s,!0))return 0;let m=1/0;for(let b=r[0];b<r[1];++b){const f=i[b],l=i[b+1];for(const C of s)for(let M=0,D=C.length,O=D-1;M<D;O=M++){const Z=C[O],$=C[M];if(kf(f,l,Z,$))return 0;m=Math.min(m,Oy(f,l,Z,$,p))}}return m}function Yv(i,r){for(const s of i)for(const p of s)if(au(p,r,!0))return!0;return!1}function NP(i,r,s,p=1/0){const m=sy(i),b=sy(r);if(p!==1/0&&Fy(m,b,s)>=p)return p;if(Wh(m,b)){if(Yv(i,r))return 0}else if(Yv(r,i))return 0;let f=1/0;for(const l of i)for(let C=0,M=l.length,D=M-1;C<M;D=C++){const O=l[D],Z=l[C];for(const $ of r)for(let ne=0,fe=$.length,Ee=fe-1;ne<fe;Ee=ne++){const _e=$[Ee],Se=$[ne];if(kf(O,Z,_e,Se))return 0;f=Math.min(f,Oy(O,Z,_e,Se,s))}}return f}function Jv(i,r,s,p,m,b){if(!b)return;const f=Fy(oy(p,b),m,s);f<r&&i.push([f,b,[0,0]])}function Ad(i,r,s,p,m,b,f){if(!b||!f)return;const l=Fy(oy(p,b),oy(m,f),s);l<r&&i.push([l,b,f])}function Jd(i,r,s,p,m=1/0){let b=Math.min(p.distance(i[0],s[0][0]),m);if(b===0)return b;const f=new Zx([[0,[0,i.length-1],[0,0]]],Wx),l=sy(s);for(;f.length>0;){const C=f.pop();if(C[0]>=b)continue;const M=C[1],D=r?ny:iy;if(Yd(M)<=D){if(!Ao(M,i.length))return NaN;if(r){const O=$P(i,M,s,p);if(isNaN(O)||O===0)return O;b=Math.min(b,O)}else for(let O=M[0];O<=M[1];++O){const Z=BP(i[O],s,p);if(b=Math.min(b,Z),b===0)return 0}}else{const O=ay(M,r);Jv(f,b,p,i,l,O[0]),Jv(f,b,p,i,l,O[1])}}return b}function Qd(i,r,s,p,m,b=1/0){let f=Math.min(b,m.distance(i[0],s[0]));if(f===0)return f;const l=new Zx([[0,[0,i.length-1],[0,s.length-1]]],Wx);for(;l.length>0;){const C=l.pop();if(C[0]>=f)continue;const M=C[1],D=C[2],O=r?ny:iy,Z=p?ny:iy;if(Yd(M)<=O&&Yd(D)<=Z){if(!Ao(M,i.length)&&Ao(D,s.length))return NaN;let $;if(r&&p)$=FP(i,M,s,D,m),f=Math.min(f,$);else if(r&&!p){const ne=i.slice(M[0],M[1]+1);for(let fe=D[0];fe<=D[1];++fe)if($=fl(s[fe],ne,m),f=Math.min(f,$),f===0)return f}else if(!r&&p){const ne=s.slice(D[0],D[1]+1);for(let fe=M[0];fe<=M[1];++fe)if($=fl(i[fe],ne,m),f=Math.min(f,$),f===0)return f}else $=OP(i,M,s,D,m),f=Math.min(f,$)}else{const $=ay(M,r),ne=ay(D,p);Ad(l,f,m,i,s,$[0],ne[0]),Ad(l,f,m,i,s,$[0],ne[1]),Ad(l,f,m,i,s,$[1],ne[0]),Ad(l,f,m,i,s,$[1],ne[1])}}return f}function UP(i,r){const s=i.geometry(),p=s.flat().map(f=>Ly([f.x,f.y],i.canonical));if(s.length===0)return NaN;const m=new jy(p[0][1]);let b=1/0;for(const f of r){switch(f.type){case"Point":b=Math.min(b,Qd(p,!1,[f.coordinates],!1,m,b));break;case"LineString":b=Math.min(b,Qd(p,!1,f.coordinates,!0,m,b));break;case"Polygon":b=Math.min(b,Jd(p,!1,f.coordinates,m,b));break}if(b===0)return b}return b}function VP(i,r){const s=i.geometry(),p=s.flat().map(f=>Ly([f.x,f.y],i.canonical));if(s.length===0)return NaN;const m=new jy(p[0][1]);let b=1/0;for(const f of r){switch(f.type){case"Point":b=Math.min(b,Qd(p,!0,[f.coordinates],!1,m,b));break;case"LineString":b=Math.min(b,Qd(p,!0,f.coordinates,!0,m,b));break;case"Polygon":b=Math.min(b,Jd(p,!0,f.coordinates,m,b));break}if(b===0)return b}return b}function qP(i,r){const s=i.geometry();if(s.length===0||s[0].length===0)return NaN;const p=LP(s).map(f=>f.map(l=>l.map(C=>Ly([C.x,C.y],i.canonical)))),m=new jy(p[0][0][0][1]);let b=1/0;for(const f of r)for(const l of p){switch(f.type){case"Point":b=Math.min(b,Jd([f.coordinates],!1,l,m,b));break;case"LineString":b=Math.min(b,Jd(f.coordinates,!0,l,m,b));break;case"Polygon":b=Math.min(b,NP(l,f.coordinates,m,b));break}if(b===0)return b}return b}function cg(i){return i.type==="MultiPolygon"?i.coordinates.map(r=>({type:"Polygon",coordinates:r})):i.type==="MultiLineString"?i.coordinates.map(r=>({type:"LineString",coordinates:r})):i.type==="MultiPoint"?i.coordinates.map(r=>({type:"Point",coordinates:r})):[i]}let By=class Dd{constructor(r,s){this.type=He,this.geojson=r,this.geometries=s}static parse(r,s){if(r.length!==2)return s.error(`'distance' expression requires exactly one argument, but found ${r.length-1} instead.`);if(Zh(r[1])){const p=r[1];if(p.type==="FeatureCollection")return new Dd(p,p.features.map(m=>cg(m.geometry)).flat());if(p.type==="Feature")return new Dd(p,cg(p.geometry));if("type"in p&&"coordinates"in p)return new Dd(p,cg(p))}return s.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return UP(r,this.geometries);if(r.geometryType()==="LineString")return VP(r,this.geometries);if(r.geometryType()==="Polygon")return qP(r,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}},$y=class Hx{constructor(r){this.type=It,this.key=r}static parse(r,s){if(r.length!==2)return s.error(`Expected 1 argument, but found ${r.length-1} instead.`);const p=r[1];return p==null?s.error("Global state property must be defined."):typeof p!="string"?s.error(`Global state property must be string, but found ${typeof r[1]} instead.`):new Hx(p)}evaluate(r){var s;const p=(s=r.globals)===null||s===void 0?void 0:s.globalState;return!p||Object.keys(p).length===0?null:Lh(p,this.key)}eachChild(){}outputDefined(){return!1}};const Ny={"==":uP,"!=":hP,">":dP,"<":pP,">=":mP,"<=":fP,array:wo,at:VC,boolean:wo,case:WC,coalesce:Lx,collator:Fx,format:yP,image:_P,in:qC,"index-of":GC,interpolate:vl,"interpolate-hcl":vl,"interpolate-lab":vl,length:vP,let:Tx,literal:Kd,match:ZC,number:wo,"number-format":gP,object:wo,slice:HC,step:zx,string:wo,"to-boolean":Uc,"to-color":Uc,"to-number":Uc,"to-string":Uc,var:kx,within:bl,distance:By,"global-state":$y};class ya{constructor(r,s,p,m){this.name=r,this.type=s,this._evaluate=p,this.args=m}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}static parse(r,s){const p=r[0],m=ya.definitions[p];if(!m)return s.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const b=Array.isArray(m)?m[0]:m.type,f=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,l=f.filter(([M])=>!Array.isArray(M)||M.length===r.length-1);let C=null;for(const[M,D]of l){C=new xx(s.registry,ef,s.path,null,s.scope);const O=[];let Z=!1;for(let $=1;$<r.length;$++){const ne=r[$],fe=Array.isArray(M)?M[$-1]:M.type,Ee=C.parse(ne,1+O.length,fe);if(!Ee){Z=!0;break}O.push(Ee)}if(!Z){if(Array.isArray(M)&&M.length!==O.length){C.error(`Expected ${M.length} arguments, but found ${O.length} instead.`);continue}for(let $=0;$<O.length;$++){const ne=Array.isArray(M)?M[$]:M.type,fe=O[$];C.concat($+1).checkSubtype(ne,fe.type)}if(C.errors.length===0)return new ya(p,b,D,O)}}if(l.length===1)s.errors.push(...C.errors);else{const M=(l.length?l:f).map(([O])=>ZP(O)).join(" | "),D=[];for(let O=1;O<r.length;O++){const Z=s.parse(r[O],1+D.length);if(!Z)return null;D.push(Ir(Z.type))}s.error(`Expected arguments of type ${M}, but found (${D.join(", ")}) instead.`)}return null}static register(r,s){ya.definitions=s;for(const p in s)r[p]=ya}}function Qv(i,[r,s,p,m]){r=r.evaluate(i),s=s.evaluate(i),p=p.evaluate(i);const b=m?m.evaluate(i):1,f=gx(r,s,p,b);if(f)throw new Lr(f);return new cr(r/255,s/255,p/255,b,!1)}function eb(i,r){return i in r}function ug(i,r){const s=r[i];return typeof s>"u"?null:s}function GP(i,r,s,p){for(;s<=p;){const m=s+p>>1;if(r[m]===i)return!0;r[m]>i?p=m-1:s=m+1}return!1}function il(i){return{type:i}}ya.register(Ny,{error:[AC,[Nt],(i,[r])=>{throw new Lr(r.evaluate(i))}],typeof:[Nt,[It],(i,[r])=>Ir(ii(r.evaluate(i)))],"to-rgba":[zn(He,4),[Za],(i,[r])=>{const[s,p,m,b]=r.evaluate(i).rgb;return[s*255,p*255,m*255,b]}],rgb:[Za,[He,He,He],Qv],rgba:[Za,[He,He,He,He],Qv],has:{type:Lt,overloads:[[[Nt],(i,[r])=>eb(r.evaluate(i),i.properties())],[[Nt,gl],(i,[r,s])=>eb(r.evaluate(i),s.evaluate(i))]]},get:{type:It,overloads:[[[Nt],(i,[r])=>ug(r.evaluate(i),i.properties())],[[Nt,gl],(i,[r,s])=>ug(r.evaluate(i),s.evaluate(i))]]},"feature-state":[It,[Nt],(i,[r])=>ug(r.evaluate(i),i.featureState||{})],properties:[gl,[],i=>i.properties()],"geometry-type":[Nt,[],i=>i.geometryType()],id:[It,[],i=>i.id()],zoom:[He,[],i=>i.globals.zoom],"heatmap-density":[He,[],i=>i.globals.heatmapDensity||0],elevation:[He,[],i=>i.globals.elevation||0],"line-progress":[He,[],i=>i.globals.lineProgress||0],accumulated:[It,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[He,il(He),(i,r)=>{let s=0;for(const p of r)s+=p.evaluate(i);return s}],"*":[He,il(He),(i,r)=>{let s=1;for(const p of r)s*=p.evaluate(i);return s}],"-":{type:He,overloads:[[[He,He],(i,[r,s])=>r.evaluate(i)-s.evaluate(i)],[[He],(i,[r])=>-r.evaluate(i)]]},"/":[He,[He,He],(i,[r,s])=>r.evaluate(i)/s.evaluate(i)],"%":[He,[He,He],(i,[r,s])=>r.evaluate(i)%s.evaluate(i)],ln2:[He,[],()=>Math.LN2],pi:[He,[],()=>Math.PI],e:[He,[],()=>Math.E],"^":[He,[He,He],(i,[r,s])=>Math.pow(r.evaluate(i),s.evaluate(i))],sqrt:[He,[He],(i,[r])=>Math.sqrt(r.evaluate(i))],log10:[He,[He],(i,[r])=>Math.log(r.evaluate(i))/Math.LN10],ln:[He,[He],(i,[r])=>Math.log(r.evaluate(i))],log2:[He,[He],(i,[r])=>Math.log(r.evaluate(i))/Math.LN2],sin:[He,[He],(i,[r])=>Math.sin(r.evaluate(i))],cos:[He,[He],(i,[r])=>Math.cos(r.evaluate(i))],tan:[He,[He],(i,[r])=>Math.tan(r.evaluate(i))],asin:[He,[He],(i,[r])=>Math.asin(r.evaluate(i))],acos:[He,[He],(i,[r])=>Math.acos(r.evaluate(i))],atan:[He,[He],(i,[r])=>Math.atan(r.evaluate(i))],min:[He,il(He),(i,r)=>Math.min(...r.map(s=>s.evaluate(i)))],max:[He,il(He),(i,r)=>Math.max(...r.map(s=>s.evaluate(i)))],abs:[He,[He],(i,[r])=>Math.abs(r.evaluate(i))],round:[He,[He],(i,[r])=>{const s=r.evaluate(i);return s<0?-Math.round(-s):Math.round(s)}],floor:[He,[He],(i,[r])=>Math.floor(r.evaluate(i))],ceil:[He,[He],(i,[r])=>Math.ceil(r.evaluate(i))],"filter-==":[Lt,[Nt,It],(i,[r,s])=>i.properties()[r.value]===s.value],"filter-id-==":[Lt,[It],(i,[r])=>i.id()===r.value],"filter-type-==":[Lt,[Nt],(i,[r])=>i.geometryType()===r.value],"filter-<":[Lt,[Nt,It],(i,[r,s])=>{const p=i.properties()[r.value],m=s.value;return typeof p==typeof m&&p<m}],"filter-id-<":[Lt,[It],(i,[r])=>{const s=i.id(),p=r.value;return typeof s==typeof p&&s<p}],"filter->":[Lt,[Nt,It],(i,[r,s])=>{const p=i.properties()[r.value],m=s.value;return typeof p==typeof m&&p>m}],"filter-id->":[Lt,[It],(i,[r])=>{const s=i.id(),p=r.value;return typeof s==typeof p&&s>p}],"filter-<=":[Lt,[Nt,It],(i,[r,s])=>{const p=i.properties()[r.value],m=s.value;return typeof p==typeof m&&p<=m}],"filter-id-<=":[Lt,[It],(i,[r])=>{const s=i.id(),p=r.value;return typeof s==typeof p&&s<=p}],"filter->=":[Lt,[Nt,It],(i,[r,s])=>{const p=i.properties()[r.value],m=s.value;return typeof p==typeof m&&p>=m}],"filter-id->=":[Lt,[It],(i,[r])=>{const s=i.id(),p=r.value;return typeof s==typeof p&&s>=p}],"filter-has":[Lt,[It],(i,[r])=>r.value in i.properties()],"filter-has-id":[Lt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Lt,[zn(Nt)],(i,[r])=>r.value.indexOf(i.geometryType())>=0],"filter-id-in":[Lt,[zn(It)],(i,[r])=>r.value.indexOf(i.id())>=0],"filter-in-small":[Lt,[Nt,zn(It)],(i,[r,s])=>s.value.indexOf(i.properties()[r.value])>=0],"filter-in-large":[Lt,[Nt,zn(It)],(i,[r,s])=>GP(i.properties()[r.value],s.value,0,s.value.length-1)],all:{type:Lt,overloads:[[[Lt,Lt],(i,[r,s])=>r.evaluate(i)&&s.evaluate(i)],[il(Lt),(i,r)=>{for(const s of r)if(!s.evaluate(i))return!1;return!0}]]},any:{type:Lt,overloads:[[[Lt,Lt],(i,[r,s])=>r.evaluate(i)||s.evaluate(i)],[il(Lt),(i,r)=>{for(const s of r)if(s.evaluate(i))return!0;return!1}]]},"!":[Lt,[Lt],(i,[r])=>!r.evaluate(i)],"is-supported-script":[Lt,[Nt],(i,[r])=>{const s=i.globals&&i.globals.isSupportedScript;return s?s(r.evaluate(i)):!0}],upcase:[Nt,[Nt],(i,[r])=>r.evaluate(i).toUpperCase()],downcase:[Nt,[Nt],(i,[r])=>r.evaluate(i).toLowerCase()],concat:[Nt,il(It),(i,r)=>r.map(s=>Dh(s.evaluate(i))).join("")],"resolved-locale":[Nt,[bf],(i,[r])=>r.evaluate(i).resolvedLocale()]});function ZP(i){return Array.isArray(i)?`(${i.map(Ir).join(", ")})`:`(${Ir(i.type)}...)`}function ef(i){if(i instanceof kx)return ef(i.boundExpression);if(i instanceof ya&&i.name==="error"||i instanceof Fx||i instanceof bl||i instanceof By||i instanceof $y)return!1;const r=i instanceof Uc||i instanceof wo;let s=!0;return i.eachChild(p=>{r?s=s&&ef(p):s=s&&p instanceof Kd}),s?Cf(i)&&Pf(i,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"]):!1}function Cf(i){if(i instanceof ya&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof bl||i instanceof By)return!1;let r=!0;return i.eachChild(s=>{r&&!Cf(s)&&(r=!1)}),r}function Hh(i){if(i instanceof ya&&i.name==="feature-state")return!1;let r=!0;return i.eachChild(s=>{r&&!Hh(s)&&(r=!1)}),r}function Pf(i,r){if(i instanceof ya&&r.indexOf(i.name)>=0)return!1;let s=!0;return i.eachChild(p=>{s&&!Pf(p,r)&&(s=!1)}),s}function ly(i){return{result:"success",value:i}}function Oc(i){return{result:"error",value:i}}function tf(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Xx(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Kx(i){return!!i.expression&&i.expression.interpolated}function Wt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Uy(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)&&ii(i)===gl}class WP{constructor(r,s){this.expression=r,this._warningHistory={},this._evaluator=new bx,this._defaultValue=s?KP(s):null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(r,s,p,m,b,f){return this._evaluator.globals=r,this._evaluator.feature=s,this._evaluator.featureState=p,this._evaluator.canonical=m,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=f,this.expression.evaluate(this._evaluator)}evaluate(r,s,p,m,b,f){this._evaluator.globals=r,this._evaluator.feature=s||null,this._evaluator.featureState=p||null,this._evaluator.canonical=m,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=f||null;try{const l=this.expression.evaluate(this._evaluator);if(l==null||typeof l=="number"&&l!==l)return this._defaultValue;if(this._enumValues&&!(l in this._enumValues))throw new Lr(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(l)} instead.`);return l}catch(l){return this._warningHistory[l.message]||(this._warningHistory[l.message]=!0,typeof console<"u"&&console.warn(l.message)),this._defaultValue}}}function Yx(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Ny}function Jx(i,r){const s=new xx(Ny,ef,[],r?XP(r):void 0),p=s.parse(i,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?ly(new WP(p,r)):Oc(s.errors)}let tb=class{constructor(r,s){this.kind=r,this._styleExpression=s,this.isStateDependent=r!=="constant"&&!Hh(s.expression),this.globalStateRefs=Vy(s.expression)}evaluateWithoutErrorHandling(r,s,p,m,b,f){return this._styleExpression.evaluateWithoutErrorHandling(r,s,p,m,b,f)}evaluate(r,s,p,m,b,f){return this._styleExpression.evaluate(r,s,p,m,b,f)}},rb=class{constructor(r,s,p,m){this.kind=r,this.zoomStops=p,this._styleExpression=s,this.isStateDependent=r!=="camera"&&!Hh(s.expression),this.globalStateRefs=Vy(s.expression),this.interpolationType=m}evaluateWithoutErrorHandling(r,s,p,m,b,f){return this._styleExpression.evaluateWithoutErrorHandling(r,s,p,m,b,f)}evaluate(r,s,p,m,b,f){return this._styleExpression.evaluate(r,s,p,m,b,f)}interpolationFactor(r,s,p){return this.interpolationType?vl.interpolationFactor(this.interpolationType,r,s,p):0}};function HP(i,r){const s=Jx(i,r);if(s.result==="error")return s;const p=s.value.expression,m=Cf(p);if(!m&&!tf(r))return Oc([new Va("","data expressions not supported")]);const b=Pf(p,["zoom"]);if(!b&&!Xx(r))return Oc([new Va("","zoom expressions not supported")]);const f=jd(p);if(!f&&!b)return Oc([new Va("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(f instanceof Va)return Oc([f]);if(f instanceof vl&&!Kx(r))return Oc([new Va("",'"interpolate" expressions cannot be used with this property')]);if(!f)return ly(m?new tb("constant",s.value):new tb("source",s.value));const l=f instanceof vl?f.interpolation:void 0;return ly(m?new rb("camera",s.value,f.labels,l):new rb("composite",s.value,f.labels,l))}function jd(i){let r=null;if(i instanceof Tx)r=jd(i.result);else if(i instanceof Lx){for(const s of i.args)if(r=jd(s),r)break}else(i instanceof zx||i instanceof vl)&&i.input instanceof ya&&i.input.name==="zoom"&&(r=i);return r instanceof Va||i.eachChild(s=>{const p=jd(s);p instanceof Va?r=p:!r&&p?r=new Va("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&p&&r!==p&&(r=new Va("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}function Vy(i,r=new Set){return i instanceof $y&&r.add(i.key),i.eachChild(s=>{Vy(s,r)}),r}function XP(i){const r={color:Za,string:Nt,number:He,enum:Nt,boolean:Lt,formatted:xf,padding:wf,numberArray:Tf,colorArray:Vh,projectionDefinition:vf,resolvedImage:sp,variableAnchorOffsetCollection:Sf};return i.type==="array"?zn(r[i.value]||It,i.length):r[i.type]}function KP(i){if(i.type==="color"&&Uy(i.default))return new cr(0,0,0,0);switch(i.type){case"color":return cr.parse(i.default)||null;case"padding":return ma.parse(i.default)||null;case"numberArray":return ga.parse(i.default)||null;case"colorArray":return gs.parse(i.default)||null;case"variableAnchorOffsetCollection":return Wa.parse(i.default)||null;case"projectionDefinition":return lp.parse(i.default)||null;default:return i.default===void 0?null:i.default}}function Qx(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const r of i.slice(1))if(!Qx(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}function ew(i){const r=i.key,s=i.value;return s?[new Ve(r,s,"constants have been deprecated as of v8")]:[]}function Nr(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Sl(i){if(Array.isArray(i))return i.map(Sl);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const r={};for(const s in i)r[s]=Sl(i[s]);return r}return Nr(i)}function Yn(i){const r=i.key,s=i.value,p=i.valueSpec||{},m=i.objectElementValidators||{},b=i.style,f=i.styleSpec,l=i.validateSpec;let C=[];const M=Wt(s);if(M!=="object")return[new Ve(r,s,`object expected, ${M} found`)];for(const D in s){const O=D.split(".")[0],Z=Lh(p,O)||p["*"];let $;if(Lh(m,O))$=m[O];else if(Lh(p,O))$=l;else if(m["*"])$=m["*"];else if(p["*"])$=l;else{C.push(new Ve(r,s[D],`unknown property "${D}"`));continue}C=C.concat($({key:(r&&`${r}.`)+D,value:s[D],valueSpec:Z,style:b,styleSpec:f,object:s,objectKey:D,validateSpec:l},s))}for(const D in p)m[D]||p[D].required&&p[D].default===void 0&&s[D]===void 0&&C.push(new Ve(r,s,`missing required property "${D}"`));return C}function qy(i){const r=i.value,s=i.valueSpec,p=i.validateSpec,m=i.style,b=i.styleSpec,f=i.key,l=i.arrayElementValidator||p;if(Wt(r)!=="array")return[new Ve(f,r,`array expected, ${Wt(r)} found`)];if(s.length&&r.length!==s.length)return[new Ve(f,r,`array length ${s.length} expected, length ${r.length} found`)];if(s["min-length"]&&r.length<s["min-length"])return[new Ve(f,r,`array length at least ${s["min-length"]} expected, length ${r.length} found`)];let C={type:s.value,values:s.values};b.$version<7&&(C.function=s.function),Wt(s.value)==="object"&&(C=s.value);let M=[];for(let D=0;D<r.length;D++)M=M.concat(l({array:r,arrayIndex:D,value:r[D],valueSpec:C,validateSpec:i.validateSpec,style:m,styleSpec:b,key:`${f}[${D}]`}));return M}function Mf(i){const r=i.key,s=i.value,p=i.valueSpec;let m=Wt(s);return m==="number"&&s!==s&&(m="NaN"),m!=="number"?[new Ve(r,s,`number expected, ${m} found`)]:"minimum"in p&&s<p.minimum?[new Ve(r,s,`${s} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&s>p.maximum?[new Ve(r,s,`${s} is greater than the maximum value ${p.maximum}`)]:[]}function tw(i){const r=i.valueSpec,s=Nr(i.value.type);let p,m={},b,f;const l=s!=="categorical"&&i.value.property===void 0,C=!l,M=Wt(i.value.stops)==="array"&&Wt(i.value.stops[0])==="array"&&Wt(i.value.stops[0][0])==="object",D=Yn({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:O,default:ne}});return s==="identity"&&l&&D.push(new Ve(i.key,i.value,'missing required property "property"')),s!=="identity"&&!i.value.stops&&D.push(new Ve(i.key,i.value,'missing required property "stops"')),s==="exponential"&&i.valueSpec.expression&&!Kx(i.valueSpec)&&D.push(new Ve(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(C&&!tf(i.valueSpec)?D.push(new Ve(i.key,i.value,"property functions not supported")):l&&!Xx(i.valueSpec)&&D.push(new Ve(i.key,i.value,"zoom functions not supported"))),(s==="categorical"||M)&&i.value.property===void 0&&D.push(new Ve(i.key,i.value,'"property" property is required')),D;function O(fe){if(s==="identity")return[new Ve(fe.key,fe.value,'identity function may not have a "stops" property')];let Ee=[];const _e=fe.value;return Ee=Ee.concat(qy({key:fe.key,value:_e,valueSpec:fe.valueSpec,validateSpec:fe.validateSpec,style:fe.style,styleSpec:fe.styleSpec,arrayElementValidator:Z})),Wt(_e)==="array"&&_e.length===0&&Ee.push(new Ve(fe.key,_e,"array must have at least one stop")),Ee}function Z(fe){let Ee=[];const _e=fe.value,Se=fe.key;if(Wt(_e)!=="array")return[new Ve(Se,_e,`array expected, ${Wt(_e)} found`)];if(_e.length!==2)return[new Ve(Se,_e,`array length 2 expected, length ${_e.length} found`)];if(M){if(Wt(_e[0])!=="object")return[new Ve(Se,_e,`object expected, ${Wt(_e[0])} found`)];if(_e[0].zoom===void 0)return[new Ve(Se,_e,"object stop key must have zoom")];if(_e[0].value===void 0)return[new Ve(Se,_e,"object stop key must have value")];if(f&&f>Nr(_e[0].zoom))return[new Ve(Se,_e[0].zoom,"stop zoom values must appear in ascending order")];Nr(_e[0].zoom)!==f&&(f=Nr(_e[0].zoom),b=void 0,m={}),Ee=Ee.concat(Yn({key:`${Se}[0]`,value:_e[0],valueSpec:{zoom:{}},validateSpec:fe.validateSpec,style:fe.style,styleSpec:fe.styleSpec,objectElementValidators:{zoom:Mf,value:$}}))}else Ee=Ee.concat($({key:`${Se}[0]`,value:_e[0],validateSpec:fe.validateSpec,style:fe.style,styleSpec:fe.styleSpec},_e));return Yx(Sl(_e[1]))?Ee.concat([new Ve(`${Se}[1]`,_e[1],"expressions are not allowed in function stops.")]):Ee.concat(fe.validateSpec({key:`${Se}[1]`,value:_e[1],valueSpec:r,validateSpec:fe.validateSpec,style:fe.style,styleSpec:fe.styleSpec}))}function $(fe,Ee){const _e=Wt(fe.value),Se=Nr(fe.value),Pe=fe.value!==null?fe.value:Ee;if(!p)p=_e;else if(_e!==p)return[new Ve(fe.key,Pe,`${_e} stop domain type must match previous stop domain type ${p}`)];if(_e!=="number"&&_e!=="string"&&_e!=="boolean")return[new Ve(fe.key,Pe,"stop domain value must be a number, string, or boolean")];if(_e!=="number"&&s!=="categorical"){let ve=`number expected, ${_e} found`;return tf(r)&&s===void 0&&(ve+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ve(fe.key,Pe,ve)]}return s==="categorical"&&_e==="number"&&(!isFinite(Se)||Math.floor(Se)!==Se)?[new Ve(fe.key,Pe,`integer expected, found ${Se}`)]:s!=="categorical"&&_e==="number"&&b!==void 0&&Se<b?[new Ve(fe.key,Pe,"stop domain values must appear in ascending order")]:(b=Se,s==="categorical"&&Se in m?[new Ve(fe.key,Pe,"stop domain values must be unique")]:(m[Se]=!0,[]))}function ne(fe){return fe.validateSpec({key:fe.key,value:fe.value,valueSpec:r,validateSpec:fe.validateSpec,style:fe.style,styleSpec:fe.styleSpec})}}function Qc(i){const r=(i.expressionContext==="property"?HP:Jx)(Sl(i.value),i.valueSpec);if(r.result==="error")return r.value.map(p=>new Ve(`${i.key}${p.key}`,i.value,p.message));const s=r.value.expression||r.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!s.outputDefined())return[new Ve(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!Hh(s))return[new Ve(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!Hh(s))return[new Ve(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Pf(s,["zoom","feature-state"]))return[new Ve(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Cf(s))return[new Ve(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function YP(i){const r=i.value,s=i.key,p=Wt(r);return p!=="boolean"?[new Ve(s,r,`boolean expected, ${p} found`)]:[]}function cy(i){const r=i.key,s=i.value,p=Wt(s);return p!=="string"?[new Ve(r,s,`color expected, ${p} found`)]:cr.parse(String(s))?[]:[new Ve(r,s,`color expected, "${s}" found`)]}function Xh(i){const r=i.key,s=i.value,p=i.valueSpec,m=[];return Array.isArray(p.values)?p.values.indexOf(Nr(s))===-1&&m.push(new Ve(r,s,`expected one of [${p.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(p.values).indexOf(Nr(s))===-1&&m.push(new Ve(r,s,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(s)} found`)),m}function Gy(i){return Qx(Sl(i.value))?Qc(Xd({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):rw(i)}function rw(i){const r=i.value,s=i.key;if(Wt(r)!=="array")return[new Ve(s,r,`array expected, ${Wt(r)} found`)];const p=i.styleSpec;let m,b=[];if(r.length<1)return[new Ve(s,r,"filter array must have at least 1 element")];switch(b=b.concat(Xh({key:`${s}[0]`,value:r[0],valueSpec:p.filter_operator,style:i.style,styleSpec:i.styleSpec})),Nr(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&Nr(r[1])==="$type"&&b.push(new Ve(s,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&b.push(new Ve(s,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(m=Wt(r[1]),m!=="string"&&b.push(new Ve(`${s}[1]`,r[1],`string expected, ${m} found`)));for(let f=2;f<r.length;f++)m=Wt(r[f]),Nr(r[1])==="$type"?b=b.concat(Xh({key:`${s}[${f}]`,value:r[f],valueSpec:p.geometry_type,style:i.style,styleSpec:i.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&b.push(new Ve(`${s}[${f}]`,r[f],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let f=1;f<r.length;f++)b=b.concat(rw({key:`${s}[${f}]`,value:r[f],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":m=Wt(r[1]),r.length!==2?b.push(new Ve(s,r,`filter array for "${r[0]}" operator must have 2 elements`)):m!=="string"&&b.push(new Ve(`${s}[1]`,r[1],`string expected, ${m} found`));break}return b}function iw(i,r){const s=i.key,p=i.validateSpec,m=i.style,b=i.styleSpec,f=i.value,l=i.objectKey,C=b[`${r}_${i.layerType}`];if(!C)return[];const M=l.match(/^(.*)-transition$/);if(r==="paint"&&M&&C[M[1]]&&C[M[1]].transition)return p({key:s,value:f,valueSpec:b.transition,style:m,styleSpec:b});const D=i.valueSpec||C[l];if(!D)return[new Ve(s,f,`unknown property "${l}"`)];let O;if(Wt(f)==="string"&&tf(D)&&!D.tokens&&(O=/^{([^}]+)}$/.exec(f)))return[new Ve(s,f,`"${l}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(O[1])} }\`.`)];const Z=[];return i.layerType==="symbol"&&(l==="text-field"&&m&&!m.glyphs&&Z.push(new Ve(s,f,'use of "text-field" requires a style "glyphs" property')),l==="text-font"&&Uy(Sl(f))&&Nr(f.type)==="identity"&&Z.push(new Ve(s,f,'"text-font" does not support identity functions'))),Z.concat(p({key:i.key,value:f,valueSpec:D,style:m,styleSpec:b,expressionContext:"property",propertyType:r,propertyKey:l}))}function nw(i){return iw(i,"paint")}function aw(i){return iw(i,"layout")}function ow(i){let r=[];const s=i.value,p=i.key,m=i.style,b=i.styleSpec;if(Wt(s)!=="object")return[new Ve(p,s,`object expected, ${Wt(s)} found`)];!s.type&&!s.ref&&r.push(new Ve(p,s,'either "type" or "ref" is required'));let f=Nr(s.type);const l=Nr(s.ref);if(s.id){const C=Nr(s.id);for(let M=0;M<i.arrayIndex;M++){const D=m.layers[M];Nr(D.id)===C&&r.push(new Ve(p,s.id,`duplicate layer id "${s.id}", previously used at line ${D.id.__line__}`))}}if("ref"in s){["type","source","source-layer","filter","layout"].forEach(M=>{M in s&&r.push(new Ve(p,s[M],`"${M}" is prohibited for ref layers`))});let C;m.layers.forEach(M=>{Nr(M.id)===l&&(C=M)}),C?C.ref?r.push(new Ve(p,s.ref,"ref cannot reference another ref layer")):f=Nr(C.type):r.push(new Ve(p,s.ref,`ref layer "${l}" not found`))}else if(f!=="background")if(!s.source)r.push(new Ve(p,s,'missing required property "source"'));else{const C=m.sources&&m.sources[s.source],M=C&&Nr(C.type);C?M==="vector"&&f==="raster"?r.push(new Ve(p,s.source,`layer "${s.id}" requires a raster source`)):M!=="raster-dem"&&f==="hillshade"?r.push(new Ve(p,s.source,`layer "${s.id}" requires a raster-dem source`)):M!=="raster-dem"&&f==="color-relief"?r.push(new Ve(p,s.source,`layer "${s.id}" requires a raster-dem source`)):M==="raster"&&f!=="raster"?r.push(new Ve(p,s.source,`layer "${s.id}" requires a vector source`)):M==="vector"&&!s["source-layer"]?r.push(new Ve(p,s,`layer "${s.id}" must specify a "source-layer"`)):M==="raster-dem"&&f!=="hillshade"&&f!=="color-relief"?r.push(new Ve(p,s.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):f==="line"&&s.paint&&s.paint["line-gradient"]&&(M!=="geojson"||!C.lineMetrics)&&r.push(new Ve(p,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new Ve(p,s.source,`source "${s.source}" not found`))}return r=r.concat(Yn({key:p,value:s,valueSpec:b.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*"(){return[]},type(){return i.validateSpec({key:`${p}.type`,value:s.type,valueSpec:b.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:s,objectKey:"type"})},filter:Gy,layout(C){return Yn({layer:s,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*"(M){return aw(Xd({layerType:f},M))}}})},paint(C){return Yn({layer:s,key:C.key,value:C.value,style:C.style,styleSpec:C.styleSpec,validateSpec:C.validateSpec,objectElementValidators:{"*"(M){return nw(Xd({layerType:f},M))}}})}}})),r}function kl(i){const r=i.value,s=i.key,p=Wt(r);return p!=="string"?[new Ve(s,r,`string expected, ${p} found`)]:[]}function JP(i){var r;const s=(r=i.sourceName)!==null&&r!==void 0?r:"",p=i.value,m=i.styleSpec,b=m.source_raster_dem,f=i.style;let l=[];const C=Wt(p);if(p===void 0)return l;if(C!=="object")return l.push(new Ve("source_raster_dem",p,`object expected, ${C} found`)),l;const M=Nr(p.encoding)==="custom",D=["redFactor","greenFactor","blueFactor","baseShift"],O=i.value.encoding?`"${i.value.encoding}"`:"Default";for(const Z in p)!M&&D.includes(Z)?l.push(new Ve(Z,p[Z],`In "${s}": "${Z}" is only valid when "encoding" is set to "custom". ${O} encoding found`)):b[Z]?l=l.concat(i.validateSpec({key:Z,value:p[Z],valueSpec:b[Z],validateSpec:i.validateSpec,style:f,styleSpec:m})):l.push(new Ve(Z,p[Z],`unknown property "${Z}"`));return l}const ib={promoteId:QP};function sw(i){const r=i.value,s=i.key,p=i.styleSpec,m=i.style,b=i.validateSpec;if(!r.type)return[new Ve(s,r,'"type" is required')];const f=Nr(r.type);let l;switch(f){case"vector":case"raster":return l=Yn({key:s,value:r,valueSpec:p[`source_${f.replace("-","_")}`],style:i.style,styleSpec:p,objectElementValidators:ib,validateSpec:b}),l;case"raster-dem":return l=JP({sourceName:s,value:r,style:i.style,styleSpec:p,validateSpec:b}),l;case"geojson":if(l=Yn({key:s,value:r,valueSpec:p.source_geojson,style:m,styleSpec:p,validateSpec:b,objectElementValidators:ib}),r.cluster)for(const C in r.clusterProperties){const[M,D]=r.clusterProperties[C],O=typeof M=="string"?[M,["accumulated"],["get",C]]:M;l.push(...Qc({key:`${s}.${C}.map`,value:D,expressionContext:"cluster-map"})),l.push(...Qc({key:`${s}.${C}.reduce`,value:O,expressionContext:"cluster-reduce"}))}return l;case"video":return Yn({key:s,value:r,valueSpec:p.source_video,style:m,validateSpec:b,styleSpec:p});case"image":return Yn({key:s,value:r,valueSpec:p.source_image,style:m,validateSpec:b,styleSpec:p});case"canvas":return[new Ve(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Xh({key:`${s}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function QP({key:i,value:r}){if(Wt(r)==="string")return kl({key:i,value:r});{const s=[];for(const p in r)s.push(...kl({key:`${i}.${p}`,value:r[p]}));return s}}function lw(i){const r=i.value,s=i.styleSpec,p=s.light,m=i.style;let b=[];const f=Wt(r);if(r===void 0)return b;if(f!=="object")return b=b.concat([new Ve("light",r,`object expected, ${f} found`)]),b;for(const l in r){const C=l.match(/^(.*)-transition$/);C&&p[C[1]]&&p[C[1]].transition?b=b.concat(i.validateSpec({key:l,value:r[l],valueSpec:s.transition,validateSpec:i.validateSpec,style:m,styleSpec:s})):p[l]?b=b.concat(i.validateSpec({key:l,value:r[l],valueSpec:p[l],validateSpec:i.validateSpec,style:m,styleSpec:s})):b=b.concat([new Ve(l,r[l],`unknown property "${l}"`)])}return b}function cw(i){const r=i.value,s=i.styleSpec,p=s.sky,m=i.style,b=Wt(r);if(r===void 0)return[];if(b!=="object")return[new Ve("sky",r,`object expected, ${b} found`)];let f=[];for(const l in r)p[l]?f=f.concat(i.validateSpec({key:l,value:r[l],valueSpec:p[l],style:m,styleSpec:s})):f=f.concat([new Ve(l,r[l],`unknown property "${l}"`)]);return f}function uw(i){const r=i.value,s=i.styleSpec,p=s.terrain,m=i.style;let b=[];const f=Wt(r);if(r===void 0)return b;if(f!=="object")return b=b.concat([new Ve("terrain",r,`object expected, ${f} found`)]),b;for(const l in r)p[l]?b=b.concat(i.validateSpec({key:l,value:r[l],valueSpec:p[l],validateSpec:i.validateSpec,style:m,styleSpec:s})):b=b.concat([new Ve(l,r[l],`unknown property "${l}"`)]);return b}function eM(i){return kl(i).length===0?[]:Qc(i)}function tM(i){return kl(i).length===0?[]:Qc(i)}function rM(i){const r=i.key,s=i.value;if(Wt(s)==="array"){if(s.length<1||s.length>4)return[new Ve(r,s,`padding requires 1 to 4 values; ${s.length} values found`)];const p={type:"number"};let m=[];for(let b=0;b<s.length;b++)m=m.concat(i.validateSpec({key:`${r}[${b}]`,value:s[b],validateSpec:i.validateSpec,valueSpec:p}));return m}else return Mf({key:r,value:s,valueSpec:{}})}function iM(i){const r=i.key,s=i.value;if(Wt(s)==="array"){const p={type:"number"};if(s.length<1)return[new Ve(r,s,"array length at least 1 expected, length 0 found")];let m=[];for(let b=0;b<s.length;b++)m=m.concat(i.validateSpec({key:`${r}[${b}]`,value:s[b],validateSpec:i.validateSpec,valueSpec:p}));return m}else return Mf({key:r,value:s,valueSpec:{}})}function nM(i){const r=i.key,s=i.value;if(Wt(s)==="array"){if(s.length<1)return[new Ve(r,s,"array length at least 1 expected, length 0 found")];let p=[];for(let m=0;m<s.length;m++)p=p.concat(cy({key:`${r}[${m}]`,value:s[m]}));return p}else return cy({key:r,value:s})}function aM(i){const r=i.key,s=i.value,p=Wt(s),m=i.styleSpec;if(p!=="array"||s.length<1||s.length%2!==0)return[new Ve(r,s,"variableAnchorOffsetCollection requires a non-empty array of even length")];let b=[];for(let f=0;f<s.length;f+=2)b=b.concat(Xh({key:`${r}[${f}]`,value:s[f],valueSpec:m.layout_symbol["text-anchor"]})),b=b.concat(qy({key:`${r}[${f+1}]`,value:s[f+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:m}));return b}function hw(i){let r=[];const s=i.value,p=i.key;if(Array.isArray(s)){const m=[],b=[];for(const f in s){s[f].id&&m.includes(s[f].id)&&r.push(new Ve(p,s,`all the sprites' ids must be unique, but ${s[f].id} is duplicated`)),m.push(s[f].id),s[f].url&&b.includes(s[f].url)&&r.push(new Ve(p,s,`all the sprites' URLs must be unique, but ${s[f].url} is duplicated`)),b.push(s[f].url);const l={id:{type:"string",required:!0},url:{type:"string",required:!0}};r=r.concat(Yn({key:`${p}[${f}]`,value:s[f],valueSpec:l,validateSpec:i.validateSpec}))}return r}else return kl({key:p,value:s})}function oM(i){const r=i.value,s=i.styleSpec,p=s.projection,m=i.style,b=Wt(r);if(r===void 0)return[];if(b!=="object")return[new Ve("projection",r,`object expected, ${b} found`)];let f=[];for(const l in r)p[l]?f=f.concat(i.validateSpec({key:l,value:r[l],valueSpec:p[l],style:m,styleSpec:s})):f=f.concat([new Ve(l,r[l],`unknown property "${l}"`)]);return f}function sM(i){const r=i.key;let s=i.value;s=s instanceof String?s.valueOf():s;const p=Wt(s);return p==="array"&&!cM(s)&&!lM(s)?[new Ve(r,s,`projection expected, invalid array ${JSON.stringify(s)} found`)]:["array","string"].includes(p)?[]:[new Ve(r,s,`projection expected, invalid type "${p}" found`)]}function lM(i){return!!["interpolate","step","literal"].includes(i[0])}function cM(i){return Array.isArray(i)&&i.length===3&&typeof i[0]=="string"&&typeof i[1]=="string"&&typeof i[2]=="number"}function uM(i){return!!i&&i.constructor===Object}function pw(i){return uM(i.value)?[]:[new Ve(i.key,i.value,`object expected, ${Wt(i.value)} found`)]}const nb={"*"(){return[]},array:qy,boolean:YP,number:Mf,color:cy,constants:ew,enum:Xh,filter:Gy,function:tw,layer:ow,object:Yn,source:sw,light:lw,sky:cw,terrain:uw,projection:oM,projectionDefinition:sM,string:kl,formatted:eM,resolvedImage:tM,padding:rM,numberArray:iM,colorArray:nM,variableAnchorOffsetCollection:aM,sprite:hw,state:pw};function rf(i){const r=i.value,s=i.valueSpec,p=i.styleSpec;return i.validateSpec=rf,s.expression&&Uy(Nr(r))?tw(i):s.expression&&Yx(Sl(r))?Qc(i):s.type&&nb[s.type]?nb[s.type](i):Yn(Xd({},i,{valueSpec:s.type?p[s.type]:s}))}function dw(i){const r=i.value,s=i.key,p=kl(i);return p.length||(r.indexOf("{fontstack}")===-1&&p.push(new Ve(s,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&p.push(new Ve(s,r,'"glyphs" url must include a "{range}" token'))),p}function Dn(i,r=PC){let s=[];return s=s.concat(rf({key:"",value:i,valueSpec:r.$root,styleSpec:r,style:i,validateSpec:rf,objectElementValidators:{glyphs:dw,"*"(){return[]}}})),i.constants&&(s=s.concat(ew({key:"constants",value:i.constants}))),fw(s)}Dn.source=ba(va(sw));Dn.sprite=ba(va(hw));Dn.glyphs=ba(va(dw));Dn.light=ba(va(lw));Dn.sky=ba(va(cw));Dn.terrain=ba(va(uw));Dn.state=ba(va(pw));Dn.layer=ba(va(ow));Dn.filter=ba(va(Gy));Dn.paintProperty=ba(va(nw));Dn.layoutProperty=ba(va(aw));function va(i){return function(r){return i({...r,validateSpec:rf})}}function fw(i){return[].concat(i).sort((r,s)=>r.line-s.line)}function ba(i){return function(...r){return fw(i.apply(this,r))}}function ab(i){if(!i)return{style:Rh[zh[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0};if(typeof i=="string"){const r=pM(i);return r.isValidStyle?{style:r.styleObject,requiresUrlMonitoring:!1,isFallback:!1}:r.isValidJSON?{style:Rh[zh[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}:i.startsWith("http")?{style:i,requiresUrlMonitoring:!0,isFallback:!1}:i.toLowerCase().includes(".json")?{style:hM(i),requiresUrlMonitoring:!0,isFallback:!1}:{style:V1(i),requiresUrlMonitoring:!0,isFallback:!1}}return i instanceof q1?{style:i.getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:i instanceof G1?{style:i.getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!1}:Dn(i).length===0?{style:i,requiresUrlMonitoring:!1,isFallback:!1}:{style:Rh[zh[0].referenceStyleID].getDefaultVariant().getExpandedStyleURL(),requiresUrlMonitoring:!1,isFallback:!0}}function hM(i){try{return new URL(i).href}catch{}return new URL(i,location.origin).href}function pM(i){try{const r=JSON.parse(i),s=Dn(r);return{isValidJSON:!0,isValidStyle:s.length===0,styleObject:s.length===0?r:null}}catch{return{isValidJSON:!1,isValidStyle:!1,styleObject:null}}}function Co(i,r,s){const p=window.document.createElement(i);return r!==void 0&&(p.className=r),s&&s.appendChild(p),p}function Kh(i){i.parentNode&&i.parentNode.removeChild(i)}class dM{constructor(){Je(this,"_map"),Je(this,"_container"),Je(this,"_terrainButton"),k5(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(r){return this._map=r,this._container=Co("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Co("button","maplibregl-ctrl-terrain",this._container),Co("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Kh(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){mw(this._map),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.hasTerrain()?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))}}function mw(i){i.hasTerrain()?i.disableTerrain():i.enableTerrain()}class fM extends j5{constructor(r={}){super({showCompass:r.showCompass??!0,showZoom:r.showZoom??!0,visualizePitch:r.visualizePitch??!0}),Je(this,"_rotateCompassArrow",()=>{const s=this._map.getBearing(),p=this._map.getPitch(),m=this.options.visualizePitch?`scale(${Math.min(1.5,1/Math.cos(p*(Math.PI/180))**.5)}) rotateX(${Math.min(70,p)}deg) rotateZ(${-s}deg)`:`rotate(${-s}deg)`;this._compassIcon.style.transform=m}),this._compass&&(this._compass.removeEventListener("click",this._compass.clickFunction),this._compass.addEventListener("click",s=>{this._map.getPitch()===0?this._map.easeTo({pitch:Math.min(this._map.getMaxPitch(),80)}):this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:s}):this._map.resetNorth({},{originalEvent:s})}))}_createButton(r,s){const p=super._createButton(r,s);return p.clickFunction=s,p}}const ob=ct.Marker,sb=ct.LngLat,mM=ct.LngLatBounds;class gM extends F5{constructor(){super(...arguments),Je(this,"lastUpdatedCenter",new sb(0,0)),Je(this,"_updateCamera",r=>{var s;const p=new sb(r.coords.longitude,r.coords.latitude),m=r.coords.accuracy,b={bearing:this._map.getBearing(),...this.options.fitBoundsOptions,linear:!0},f=this._map.getZoom();f>(((s=this.options.fitBoundsOptions)==null?void 0:s.maxZoom)??30)&&(b.zoom=f),this._map.fitBounds(mM.fromLngLat(p,m),b,{geolocateSource:!0});let l=!1;const C=()=>{l=!0};this._map.once("click",C),this._map.once("dblclick",C),this._map.once("dragstart",C),this._map.once("mousedown",C),this._map.once("touchstart",C),this._map.once("wheel",C),this._map.once("moveend",()=>{this._map.off("click",C),this._map.off("dblclick",C),this._map.off("dragstart",C),this._map.off("mousedown",C),this._map.off("touchstart",C),this._map.off("wheel",C),!l&&(this.lastUpdatedCenter=this._map.getCenter())})}),Je(this,"_finishSetupUI",r=>{if(this._map){if(r===!1){const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Co("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new ob({element:this._dotElement}),this._circleElement=Co("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ob({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("move",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("moveend",s=>{const p=s.originalEvent&&s.originalEvent.type==="resize",m=this.lastUpdatedCenter.distanceTo(this._map.getCenter());!s.geolocateSource&&this._watchState==="ACTIVE_LOCK"&&!p&&m>1&&(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new Event("trackuserlocationend")))})}}),Je(this,"_onZoom",()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()})}_updateCircleRadius(){if(this._watchState!=="BACKGROUND"&&this._watchState!=="ACTIVE_LOCK")return;const r=[this._lastKnownPosition.coords.longitude,this._lastKnownPosition.coords.latitude],s=this._map.project(r),p=this._map.unproject([s.x,s.y]),m=this._map.unproject([s.x+20,s.y]),b=p.distanceTo(m)/20,f=Math.ceil(2*this._accuracy/b);this._circleElement.style.width=`${f}px`,this._circleElement.style.height=`${f}px`}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;case"BACKGROUND_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}}var ol,Cn,sl,ll,Th;class yM{constructor(r,s,p){if(on(this,ol),on(this,Cn),on(this,sl),on(this,ll),on(this,Th),typeof r=="string"){const m=document.querySelector(r);if(!m)throw new Error(`No element has been found with selector "${r}" when creating an external control.`);En(this,Cn,m)}else En(this,Cn,r);s&&En(this,sl,m=>{s(ut(this,ol),ut(this,Cn),m)}),p&&En(this,ll,m=>{p(ut(this,ol),ut(this,Cn),m)}),En(this,Th,ut(this,Cn).parentElement)}onAdd(r){return En(this,ol,r),ut(this,sl)&&ut(this,Cn).addEventListener("click",ut(this,sl)),ut(this,ll)&&ut(this,ol).on("render",ut(this,ll)),Kh(ut(this,Cn)),ut(this,Cn)}onRemove(){ut(this,sl)&&ut(this,Cn).removeEventListener("click",ut(this,sl)),ut(this,ll)&&ut(this,ol).off("render",ut(this,ll)),ut(this,Th)?ut(this,Th).appendChild(ut(this,Cn)):Kh(ut(this,Cn))}}ol=new WeakMap,Cn=new WeakMap,sl=new WeakMap,ll=new WeakMap,Th=new WeakMap;class _M{constructor(){Je(this,"map"),Je(this,"container"),Je(this,"projectionButton")}onAdd(r){return this.map=r,this.container=Co("div","maplibregl-ctrl maplibregl-ctrl-group"),this.projectionButton=Co("button","maplibregl-ctrl-projection",this.container),Co("span","maplibregl-ctrl-icon",this.projectionButton).setAttribute("aria-hidden","true"),this.projectionButton.type="button",this.projectionButton.addEventListener("click",this.toggleProjection.bind(this)),r.on("projectiontransition",this.updateProjectionIcon.bind(this)),this.updateProjectionIcon(),this.container}onRemove(){Kh(this.container),this.map.off("projectiontransition",this.updateProjectionIcon),this.map=void 0}toggleProjection(){gw(this.map),this.updateProjectionIcon()}updateProjectionIcon(){this.projectionButton.classList.remove("maplibregl-ctrl-projection-globe"),this.projectionButton.classList.remove("maplibregl-ctrl-projection-mercator"),this.map.isGlobeProjection()?(this.projectionButton.classList.add("maplibregl-ctrl-projection-mercator"),this.projectionButton.title="Enable Mercator projection"):(this.projectionButton.classList.add("maplibregl-ctrl-projection-globe"),this.projectionButton.title="Enable Globe projection")}}function gw(i){i.getProjection()===void 0&&i.setProjection({type:"mercator"}),i.isGlobeProjection()?i.enableMercatorProjection():i.enableGlobeProjection()}const Sh={"zoom-in":i=>i.zoomIn(),"zoom-out":i=>i.zoomOut(),"toggle-projection":gw,"toggle-terrain":mw,"reset-view":i=>{i.getPitch()===0?i.easeTo({pitch:Math.min(i.getMaxPitch(),80)}):i.resetNorthPitch()},"reset-bearing":i=>{i.rotateTo(0)},"reset-pitch":i=>{i.setPitch(0)},"reset-roll":i=>{i.setRoll(0)}};var Fd,kh;let uy=class extends yM{constructor(r,s){if(s&&!(s in Sh))throw new Error(`data-maptiler-control value "${s}" is invalid.`);super(r,s&&Sh[s]),on(this,Fd),on(this,kh,new Map)}onAdd(r){return En(this,Fd,r),super.onAdd(r)}onRemove(){for(const[r,s]of ut(this,kh)){const p=r.deref();p&&p.removeEventListener("click",s)}ut(this,kh).clear(),super.onRemove()}configureGroupItem(r,s){if(!s)return;if(!(s in Sh))throw new Error(`data-maptiler-control value "${s}" is invalid.`);const p=m=>{Sh[s](ut(this,Fd),r,m)};r.addEventListener("click",p),ut(this,kh).set(new WeakRef(r),p)}};Fd=new WeakMap,kh=new WeakMap,Je(uy,"controlCallbacks",Sh);var An,Ua,cl,ul,qn,Od,Xi,yw,Zn,_w;let hg=class{constructor(r,s){on(this,Xi),on(this,An),Je(this,"map"),on(this,Ua),on(this,cl),on(this,ul),on(this,qn,!1),on(this,Od),r.style!==void 0&&En(this,qn,!0),En(this,An,{zoomAdjust:-4,position:"top-right",...s,forceNoAttributionControl:!0,attributionControl:!1,navigationControl:!1,geolocateControl:!1,maptilerLogo:!1,minimap:!1,hash:!1,pitchAdjust:!1,...r,containerStyle:{border:"1px solid #000",width:"400px",height:"300px",...r.containerStyle??{}}}),r.lockZoom!==void 0&&(ut(this,An).minZoom=r.lockZoom,ut(this,An).maxZoom=r.lockZoom)}setStyle(r,s){ut(this,qn)||this.map.setStyle(r,s),Mn(this,Xi,Zn).call(this)}addLayer(r,s){return ut(this,qn)||this.map.addLayer(r,s),Mn(this,Xi,Zn).call(this),this.map}moveLayer(r,s){return ut(this,qn)||this.map.moveLayer(r,s),Mn(this,Xi,Zn).call(this),this.map}removeLayer(r){return ut(this,qn)||this.map.removeLayer(r),Mn(this,Xi,Zn).call(this),this}setLayerZoomRange(r,s,p){return ut(this,qn)||this.map.setLayerZoomRange(r,s,p),Mn(this,Xi,Zn).call(this),this}setFilter(r,s,p){return ut(this,qn)||this.map.setFilter(r,s,p),Mn(this,Xi,Zn).call(this),this}setPaintProperty(r,s,p,m){return ut(this,qn)||this.map.setPaintProperty(r,s,p,m),Mn(this,Xi,Zn).call(this),this}setLayoutProperty(r,s,p,m){return ut(this,qn)||this.map.setLayoutProperty(r,s,p,m),Mn(this,Xi,Zn).call(this),this}setGlyphs(r,s){return ut(this,qn)||this.map.setGlyphs(r,s),Mn(this,Xi,Zn).call(this),this}onAdd(r){En(this,Ua,r),En(this,cl,Co("div","maplibregl-ctrl maplibregl-ctrl-group"));for(const[s,p]of Object.entries(ut(this,An).containerStyle))ut(this,cl).style.setProperty(s,p);return ut(this,An).container=ut(this,cl),ut(this,An).zoom=r.getZoom()+ut(this,An).zoomAdjust,this.map=new ww(ut(this,An)),this.map.once("style.load",()=>{this.map.resize()}),this.map.once("load",()=>{Mn(this,Xi,yw).call(this,ut(this,An).parentRect),En(this,Od,Mn(this,Xi,_w).call(this))}),ut(this,cl)}onRemove(){var r;(r=ut(this,Od))==null||r.call(this),Kh(ut(this,cl))}};An=new WeakMap,Ua=new WeakMap,cl=new WeakMap,ul=new WeakMap,qn=new WeakMap,Od=new WeakMap,Xi=new WeakSet,yw=function(i){i===void 0||i.linePaint===void 0&&i.fillPaint===void 0||(En(this,ul,{type:"Feature",properties:{name:"parentRect"},geometry:{type:"Polygon",coordinates:[[[],[],[],[],[]]]}}),this.map.addSource("parentRect",{type:"geojson",data:ut(this,ul)}),(i.lineLayout!==void 0||i.linePaint!==void 0)&&this.map.addLayer({id:"parentRectOutline",type:"line",source:"parentRect",layout:{...i.lineLayout},paint:{"line-color":"#FFF","line-width":1,"line-opacity":.85,...i.linePaint}}),i.fillPaint!==void 0&&this.map.addLayer({id:"parentRectFill",type:"fill",source:"parentRect",layout:{},paint:{"fill-color":"#08F","fill-opacity":.135,...i.fillPaint}}),Mn(this,Xi,Zn).call(this))},Zn=function(){if(ut(this,ul)===void 0)return;const{devicePixelRatio:i}=window,r=ut(this,Ua).getCanvas(),s=r.width/i,p=r.height/i,m=ut(this,Ua).unproject.bind(ut(this,Ua)),b=m([0,0]),f=m([s,0]),l=m([0,p]),C=m([s,p]);ut(this,ul).geometry.coordinates=[[l.toArray(),C.toArray(),f.toArray(),b.toArray(),l.toArray()]];const M=this.map.getSource("parentRect");M!==void 0&&M.setData(ut(this,ul))},_w=function(){const{pitchAdjust:i}=ut(this,An),r=()=>{b("parent")},s=()=>{b("minimap")},p=()=>{ut(this,Ua).on("move",r),this.map.on("move",s)},m=()=>{ut(this,Ua).off("move",r),this.map.off("move",s)},b=f=>{m();const l=f==="parent"?ut(this,Ua):this.map,C=f==="parent"?this.map:ut(this,Ua),M=l.getCenter(),D=l.getZoom()+ut(this,An).zoomAdjust*(f==="parent"?1:-1),O=l.getBearing(),Z=l.getPitch();C.jumpTo({center:M,zoom:D,bearing:O,pitch:i?Z:0}),Mn(this,Xi,Zn).call(this),p()};return p(),()=>{m()}};class vM{constructor(r,s=2e3){Je(this,"map"),Je(this,"registeredModules",new Set),Je(this,"viewerType"),this.map=r,this.viewerType="Map",setTimeout(async()=>{if(!ci.telemetry)return;const p=this.preparePayload();try{(await fetch(p,{method:"POST"})).ok||console.warn("The metrics could not be sent to MapTiler Cloud")}catch(m){console.warn("The metrics could not be sent to MapTiler Cloud",m)}},Math.max(1e3,s))}registerModule(r,s){this.registeredModules.add(`${r}:${s}`)}registerViewerType(r="Map"){this.viewerType=r}preparePayload(){const r=new URL(Yi.telemetryURL);return r.searchParams.append("sdk",oA()),r.searchParams.append("key",ci.apiKey),r.searchParams.append("mtsid",Ey),r.searchParams.append("session",ci.session?"1":"0"),r.searchParams.append("caching",ci.caching?"1":"0"),r.searchParams.append("lang-updated",this.map.isLanguageUpdated()?"1":"0"),r.searchParams.append("terrain",this.map.getTerrain()?"1":"0"),r.searchParams.append("globe",this.map.isGlobeProjection()?"1":"0"),r.searchParams.append("viewerType",this.viewerType),this.registeredModules.size>0&&r.searchParams.append("modules",Array.from(this.registeredModules).join("|")),r.href}}var Yh=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var i=0,r=arguments.length;r--;)i+=arguments[r]*arguments[r];return Math.sqrt(i)});function jh(){var i=new Yh(16);return Yh!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i}function bM(i,r,s,p,m,b,f,l,C,M,D,O,Z,$,ne,fe,Ee){return i[0]=r,i[1]=s,i[2]=p,i[3]=m,i[4]=b,i[5]=f,i[6]=l,i[7]=C,i[8]=M,i[9]=D,i[10]=O,i[11]=Z,i[12]=$,i[13]=ne,i[14]=fe,i[15]=Ee,i}function xM(i,r,s){var p=r[0],m=r[1],b=r[2],f=r[3],l=r[4],C=r[5],M=r[6],D=r[7],O=r[8],Z=r[9],$=r[10],ne=r[11],fe=r[12],Ee=r[13],_e=r[14],Se=r[15],Pe=s[0],ve=s[1],ye=s[2],Ae=s[3];return i[0]=Pe*p+ve*l+ye*O+Ae*fe,i[1]=Pe*m+ve*C+ye*Z+Ae*Ee,i[2]=Pe*b+ve*M+ye*$+Ae*_e,i[3]=Pe*f+ve*D+ye*ne+Ae*Se,Pe=s[4],ve=s[5],ye=s[6],Ae=s[7],i[4]=Pe*p+ve*l+ye*O+Ae*fe,i[5]=Pe*m+ve*C+ye*Z+Ae*Ee,i[6]=Pe*b+ve*M+ye*$+Ae*_e,i[7]=Pe*f+ve*D+ye*ne+Ae*Se,Pe=s[8],ve=s[9],ye=s[10],Ae=s[11],i[8]=Pe*p+ve*l+ye*O+Ae*fe,i[9]=Pe*m+ve*C+ye*Z+Ae*Ee,i[10]=Pe*b+ve*M+ye*$+Ae*_e,i[11]=Pe*f+ve*D+ye*ne+Ae*Se,Pe=s[12],ve=s[13],ye=s[14],Ae=s[15],i[12]=Pe*p+ve*l+ye*O+Ae*fe,i[13]=Pe*m+ve*C+ye*Z+Ae*Ee,i[14]=Pe*b+ve*M+ye*$+Ae*_e,i[15]=Pe*f+ve*D+ye*ne+Ae*Se,i}function wM(i,r,s){var p=s[0],m=s[1],b=s[2];return i[0]=r[0]*p,i[1]=r[1]*p,i[2]=r[2]*p,i[3]=r[3]*p,i[4]=r[4]*m,i[5]=r[5]*m,i[6]=r[6]*m,i[7]=r[7]*m,i[8]=r[8]*b,i[9]=r[9]*b,i[10]=r[10]*b,i[11]=r[11]*b,i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],i}function lb(i,r,s){var p=Math.sin(s),m=Math.cos(s),b=r[4],f=r[5],l=r[6],C=r[7],M=r[8],D=r[9],O=r[10],Z=r[11];return r!==i&&(i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15]),i[4]=b*m+M*p,i[5]=f*m+D*p,i[6]=l*m+O*p,i[7]=C*m+Z*p,i[8]=M*m-b*p,i[9]=D*m-f*p,i[10]=O*m-l*p,i[11]=Z*m-C*p,i}function TM(i,r,s){var p=Math.sin(s),m=Math.cos(s),b=r[0],f=r[1],l=r[2],C=r[3],M=r[8],D=r[9],O=r[10],Z=r[11];return r!==i&&(i[4]=r[4],i[5]=r[5],i[6]=r[6],i[7]=r[7],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15]),i[0]=b*m-M*p,i[1]=f*m-D*p,i[2]=l*m-O*p,i[3]=C*m-Z*p,i[8]=b*p+M*m,i[9]=f*p+D*m,i[10]=l*p+O*m,i[11]=C*p+Z*m,i}function cb(i,r,s){var p=Math.sin(s),m=Math.cos(s),b=r[0],f=r[1],l=r[2],C=r[3],M=r[4],D=r[5],O=r[6],Z=r[7];return r!==i&&(i[8]=r[8],i[9]=r[9],i[10]=r[10],i[11]=r[11],i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15]),i[0]=b*m+M*p,i[1]=f*m+D*p,i[2]=l*m+O*p,i[3]=C*m+Z*p,i[4]=M*m-b*p,i[5]=D*m-f*p,i[6]=O*m-l*p,i[7]=Z*m-C*p,i}function SM(i,r,s,p,m){var b=1/Math.tan(r/2),f;return i[0]=b/s,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=b,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,m!=null&&m!==1/0?(f=1/(p-m),i[10]=(m+p)*f,i[14]=2*m*p*f):(i[10]=-1,i[14]=-2*p),i}var kM=SM;function Bd(){var i=new Yh(3);return Yh!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function CM(i,r,s){var p=new Yh(3);return p[0]=i,p[1]=r,p[2]=s,p}function pg(i,r){var s=r[0],p=r[1],m=r[2],b=s*s+p*p+m*m;return b>0&&(b=1/Math.sqrt(b)),i[0]=r[0]*b,i[1]=r[1]*b,i[2]=r[2]*b,i}function ub(i,r,s){var p=r[0],m=r[1],b=r[2],f=s[0],l=s[1],C=s[2];return i[0]=m*C-b*l,i[1]=b*f-p*C,i[2]=p*l-m*f,i}(function(){var i=Bd();return function(r,s,p,m,b,f){var l,C;for(s||(s=3),p||(p=0),m?C=Math.min(m*s+p,r.length):C=r.length,l=p;l<C;l+=s)i[0]=r[l],i[1]=r[l+1],i[2]=r[l+2],b(i,i,f),r[l]=i[0],r[l+1]=i[1],r[l+2]=i[2];return r}})();function PM(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var hb,pb;function MM(){return pb||(pb=1,hb={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}),hb}var dg,db;function vw(){if(db)return dg;db=1;const i=MM(),r={};for(const m of Object.keys(i))r[i[m]]=m;const s={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};dg=s;for(const m of Object.keys(s)){if(!("channels"in s[m]))throw new Error("missing channels property: "+m);if(!("labels"in s[m]))throw new Error("missing channel labels property: "+m);if(s[m].labels.length!==s[m].channels)throw new Error("channel and label counts mismatch: "+m);const{channels:b,labels:f}=s[m];delete s[m].channels,delete s[m].labels,Object.defineProperty(s[m],"channels",{value:b}),Object.defineProperty(s[m],"labels",{value:f})}s.rgb.hsl=function(m){const b=m[0]/255,f=m[1]/255,l=m[2]/255,C=Math.min(b,f,l),M=Math.max(b,f,l),D=M-C;let O,Z;M===C?O=0:b===M?O=(f-l)/D:f===M?O=2+(l-b)/D:l===M&&(O=4+(b-f)/D),O=Math.min(O*60,360),O<0&&(O+=360);const $=(C+M)/2;return M===C?Z=0:$<=.5?Z=D/(M+C):Z=D/(2-M-C),[O,Z*100,$*100]},s.rgb.hsv=function(m){let b,f,l,C,M;const D=m[0]/255,O=m[1]/255,Z=m[2]/255,$=Math.max(D,O,Z),ne=$-Math.min(D,O,Z),fe=function(Ee){return($-Ee)/6/ne+1/2};return ne===0?(C=0,M=0):(M=ne/$,b=fe(D),f=fe(O),l=fe(Z),D===$?C=l-f:O===$?C=1/3+b-l:Z===$&&(C=2/3+f-b),C<0?C+=1:C>1&&(C-=1)),[C*360,M*100,$*100]},s.rgb.hwb=function(m){const b=m[0],f=m[1];let l=m[2];const C=s.rgb.hsl(m)[0],M=1/255*Math.min(b,Math.min(f,l));return l=1-1/255*Math.max(b,Math.max(f,l)),[C,M*100,l*100]},s.rgb.cmyk=function(m){const b=m[0]/255,f=m[1]/255,l=m[2]/255,C=Math.min(1-b,1-f,1-l),M=(1-b-C)/(1-C)||0,D=(1-f-C)/(1-C)||0,O=(1-l-C)/(1-C)||0;return[M*100,D*100,O*100,C*100]};function p(m,b){return(m[0]-b[0])**2+(m[1]-b[1])**2+(m[2]-b[2])**2}return s.rgb.keyword=function(m){const b=r[m];if(b)return b;let f=1/0,l;for(const C of Object.keys(i)){const M=i[C],D=p(m,M);D<f&&(f=D,l=C)}return l},s.keyword.rgb=function(m){return i[m]},s.rgb.xyz=function(m){let b=m[0]/255,f=m[1]/255,l=m[2]/255;b=b>.04045?((b+.055)/1.055)**2.4:b/12.92,f=f>.04045?((f+.055)/1.055)**2.4:f/12.92,l=l>.04045?((l+.055)/1.055)**2.4:l/12.92;const C=b*.4124+f*.3576+l*.1805,M=b*.2126+f*.7152+l*.0722,D=b*.0193+f*.1192+l*.9505;return[C*100,M*100,D*100]},s.rgb.lab=function(m){const b=s.rgb.xyz(m);let f=b[0],l=b[1],C=b[2];f/=95.047,l/=100,C/=108.883,f=f>.008856?f**(1/3):7.787*f+16/116,l=l>.008856?l**(1/3):7.787*l+16/116,C=C>.008856?C**(1/3):7.787*C+16/116;const M=116*l-16,D=500*(f-l),O=200*(l-C);return[M,D,O]},s.hsl.rgb=function(m){const b=m[0]/360,f=m[1]/100,l=m[2]/100;let C,M,D;if(f===0)return D=l*255,[D,D,D];l<.5?C=l*(1+f):C=l+f-l*f;const O=2*l-C,Z=[0,0,0];for(let $=0;$<3;$++)M=b+1/3*-($-1),M<0&&M++,M>1&&M--,6*M<1?D=O+(C-O)*6*M:2*M<1?D=C:3*M<2?D=O+(C-O)*(2/3-M)*6:D=O,Z[$]=D*255;return Z},s.hsl.hsv=function(m){const b=m[0];let f=m[1]/100,l=m[2]/100,C=f;const M=Math.max(l,.01);l*=2,f*=l<=1?l:2-l,C*=M<=1?M:2-M;const D=(l+f)/2,O=l===0?2*C/(M+C):2*f/(l+f);return[b,O*100,D*100]},s.hsv.rgb=function(m){const b=m[0]/60,f=m[1]/100;let l=m[2]/100;const C=Math.floor(b)%6,M=b-Math.floor(b),D=255*l*(1-f),O=255*l*(1-f*M),Z=255*l*(1-f*(1-M));switch(l*=255,C){case 0:return[l,Z,D];case 1:return[O,l,D];case 2:return[D,l,Z];case 3:return[D,O,l];case 4:return[Z,D,l];case 5:return[l,D,O]}},s.hsv.hsl=function(m){const b=m[0],f=m[1]/100,l=m[2]/100,C=Math.max(l,.01);let M,D;D=(2-f)*l;const O=(2-f)*C;return M=f*C,M/=O<=1?O:2-O,M=M||0,D/=2,[b,M*100,D*100]},s.hwb.rgb=function(m){const b=m[0]/360;let f=m[1]/100,l=m[2]/100;const C=f+l;let M;C>1&&(f/=C,l/=C);const D=Math.floor(6*b),O=1-l;M=6*b-D,D&1&&(M=1-M);const Z=f+M*(O-f);let $,ne,fe;switch(D){default:case 6:case 0:$=O,ne=Z,fe=f;break;case 1:$=Z,ne=O,fe=f;break;case 2:$=f,ne=O,fe=Z;break;case 3:$=f,ne=Z,fe=O;break;case 4:$=Z,ne=f,fe=O;break;case 5:$=O,ne=f,fe=Z;break}return[$*255,ne*255,fe*255]},s.cmyk.rgb=function(m){const b=m[0]/100,f=m[1]/100,l=m[2]/100,C=m[3]/100,M=1-Math.min(1,b*(1-C)+C),D=1-Math.min(1,f*(1-C)+C),O=1-Math.min(1,l*(1-C)+C);return[M*255,D*255,O*255]},s.xyz.rgb=function(m){const b=m[0]/100,f=m[1]/100,l=m[2]/100;let C,M,D;return C=b*3.2406+f*-1.5372+l*-.4986,M=b*-.9689+f*1.8758+l*.0415,D=b*.0557+f*-.204+l*1.057,C=C>.0031308?1.055*C**(1/2.4)-.055:C*12.92,M=M>.0031308?1.055*M**(1/2.4)-.055:M*12.92,D=D>.0031308?1.055*D**(1/2.4)-.055:D*12.92,C=Math.min(Math.max(0,C),1),M=Math.min(Math.max(0,M),1),D=Math.min(Math.max(0,D),1),[C*255,M*255,D*255]},s.xyz.lab=function(m){let b=m[0],f=m[1],l=m[2];b/=95.047,f/=100,l/=108.883,b=b>.008856?b**(1/3):7.787*b+16/116,f=f>.008856?f**(1/3):7.787*f+16/116,l=l>.008856?l**(1/3):7.787*l+16/116;const C=116*f-16,M=500*(b-f),D=200*(f-l);return[C,M,D]},s.lab.xyz=function(m){const b=m[0],f=m[1],l=m[2];let C,M,D;M=(b+16)/116,C=f/500+M,D=M-l/200;const O=M**3,Z=C**3,$=D**3;return M=O>.008856?O:(M-16/116)/7.787,C=Z>.008856?Z:(C-16/116)/7.787,D=$>.008856?$:(D-16/116)/7.787,C*=95.047,M*=100,D*=108.883,[C,M,D]},s.lab.lch=function(m){const b=m[0],f=m[1],l=m[2];let C;C=Math.atan2(l,f)*360/2/Math.PI,C<0&&(C+=360);const M=Math.sqrt(f*f+l*l);return[b,M,C]},s.lch.lab=function(m){const b=m[0],f=m[1],l=m[2]/360*2*Math.PI,C=f*Math.cos(l),M=f*Math.sin(l);return[b,C,M]},s.rgb.ansi16=function(m,b=null){const[f,l,C]=m;let M=b===null?s.rgb.hsv(m)[2]:b;if(M=Math.round(M/50),M===0)return 30;let D=30+(Math.round(C/255)<<2|Math.round(l/255)<<1|Math.round(f/255));return M===2&&(D+=60),D},s.hsv.ansi16=function(m){return s.rgb.ansi16(s.hsv.rgb(m),m[2])},s.rgb.ansi256=function(m){const b=m[0],f=m[1],l=m[2];return b===f&&f===l?b<8?16:b>248?231:Math.round((b-8)/247*24)+232:16+36*Math.round(b/255*5)+6*Math.round(f/255*5)+Math.round(l/255*5)},s.ansi16.rgb=function(m){let b=m%10;if(b===0||b===7)return m>50&&(b+=3.5),b=b/10.5*255,[b,b,b];const f=(~~(m>50)+1)*.5,l=(b&1)*f*255,C=(b>>1&1)*f*255,M=(b>>2&1)*f*255;return[l,C,M]},s.ansi256.rgb=function(m){if(m>=232){const M=(m-232)*10+8;return[M,M,M]}m-=16;let b;const f=Math.floor(m/36)/5*255,l=Math.floor((b=m%36)/6)/5*255,C=b%6/5*255;return[f,l,C]},s.rgb.hex=function(m){const b=(((Math.round(m[0])&255)<<16)+((Math.round(m[1])&255)<<8)+(Math.round(m[2])&255)).toString(16).toUpperCase();return"000000".substring(b.length)+b},s.hex.rgb=function(m){const b=m.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!b)return[0,0,0];let f=b[0];b[0].length===3&&(f=f.split("").map(O=>O+O).join(""));const l=parseInt(f,16),C=l>>16&255,M=l>>8&255,D=l&255;return[C,M,D]},s.rgb.hcg=function(m){const b=m[0]/255,f=m[1]/255,l=m[2]/255,C=Math.max(Math.max(b,f),l),M=Math.min(Math.min(b,f),l),D=C-M;let O,Z;return D<1?O=M/(1-D):O=0,D<=0?Z=0:C===b?Z=(f-l)/D%6:C===f?Z=2+(l-b)/D:Z=4+(b-f)/D,Z/=6,Z%=1,[Z*360,D*100,O*100]},s.hsl.hcg=function(m){const b=m[1]/100,f=m[2]/100,l=f<.5?2*b*f:2*b*(1-f);let C=0;return l<1&&(C=(f-.5*l)/(1-l)),[m[0],l*100,C*100]},s.hsv.hcg=function(m){const b=m[1]/100,f=m[2]/100,l=b*f;let C=0;return l<1&&(C=(f-l)/(1-l)),[m[0],l*100,C*100]},s.hcg.rgb=function(m){const b=m[0]/360,f=m[1]/100,l=m[2]/100;if(f===0)return[l*255,l*255,l*255];const C=[0,0,0],M=b%1*6,D=M%1,O=1-D;let Z=0;switch(Math.floor(M)){case 0:C[0]=1,C[1]=D,C[2]=0;break;case 1:C[0]=O,C[1]=1,C[2]=0;break;case 2:C[0]=0,C[1]=1,C[2]=D;break;case 3:C[0]=0,C[1]=O,C[2]=1;break;case 4:C[0]=D,C[1]=0,C[2]=1;break;default:C[0]=1,C[1]=0,C[2]=O}return Z=(1-f)*l,[(f*C[0]+Z)*255,(f*C[1]+Z)*255,(f*C[2]+Z)*255]},s.hcg.hsv=function(m){const b=m[1]/100,f=m[2]/100,l=b+f*(1-b);let C=0;return l>0&&(C=b/l),[m[0],C*100,l*100]},s.hcg.hsl=function(m){const b=m[1]/100,f=m[2]/100*(1-b)+.5*b;let l=0;return f>0&&f<.5?l=b/(2*f):f>=.5&&f<1&&(l=b/(2*(1-f))),[m[0],l*100,f*100]},s.hcg.hwb=function(m){const b=m[1]/100,f=m[2]/100,l=b+f*(1-b);return[m[0],(l-b)*100,(1-l)*100]},s.hwb.hcg=function(m){const b=m[1]/100,f=1-m[2]/100,l=f-b;let C=0;return l<1&&(C=(f-l)/(1-l)),[m[0],l*100,C*100]},s.apple.rgb=function(m){return[m[0]/65535*255,m[1]/65535*255,m[2]/65535*255]},s.rgb.apple=function(m){return[m[0]/255*65535,m[1]/255*65535,m[2]/255*65535]},s.gray.rgb=function(m){return[m[0]/100*255,m[0]/100*255,m[0]/100*255]},s.gray.hsl=function(m){return[0,0,m[0]]},s.gray.hsv=s.gray.hsl,s.gray.hwb=function(m){return[0,100,m[0]]},s.gray.cmyk=function(m){return[0,0,0,m[0]]},s.gray.lab=function(m){return[m[0],0,0]},s.gray.hex=function(m){const b=Math.round(m[0]/100*255)&255,f=((b<<16)+(b<<8)+b).toString(16).toUpperCase();return"000000".substring(f.length)+f},s.rgb.gray=function(m){return[(m[0]+m[1]+m[2])/3/255*100]},dg}var fg,fb;function AM(){if(fb)return fg;fb=1;const i=vw();function r(){const b={},f=Object.keys(i);for(let l=f.length,C=0;C<l;C++)b[f[C]]={distance:-1,parent:null};return b}function s(b){const f=r(),l=[b];for(f[b].distance=0;l.length;){const C=l.pop(),M=Object.keys(i[C]);for(let D=M.length,O=0;O<D;O++){const Z=M[O],$=f[Z];$.distance===-1&&($.distance=f[C].distance+1,$.parent=C,l.unshift(Z))}}return f}function p(b,f){return function(l){return f(b(l))}}function m(b,f){const l=[f[b].parent,b];let C=i[f[b].parent][b],M=f[b].parent;for(;f[M].parent;)l.unshift(f[M].parent),C=p(i[f[M].parent][M],C),M=f[M].parent;return C.conversion=l,C}return fg=function(b){const f=s(b),l={},C=Object.keys(f);for(let M=C.length,D=0;D<M;D++){const O=C[D];f[O].parent!==null&&(l[O]=m(O,f))}return l},fg}var mg,mb;function IM(){if(mb)return mg;mb=1;const i=vw(),r=AM(),s={},p=Object.keys(i);function m(f){const l=function(...C){const M=C[0];return M==null?M:(M.length>1&&(C=M),f(C))};return"conversion"in f&&(l.conversion=f.conversion),l}function b(f){const l=function(...C){const M=C[0];if(M==null)return M;M.length>1&&(C=M);const D=f(C);if(typeof D=="object")for(let O=D.length,Z=0;Z<O;Z++)D[Z]=Math.round(D[Z]);return D};return"conversion"in f&&(l.conversion=f.conversion),l}return p.forEach(f=>{s[f]={},Object.defineProperty(s[f],"channels",{value:i[f].channels}),Object.defineProperty(s[f],"labels",{value:i[f].labels});const l=r(f);Object.keys(l).forEach(C=>{const M=l[C];s[f][C]=b(M),s[f][C].raw=m(M)})}),mg=s,mg}var EM=IM();const zM=PM(EM);function gb({gl:i,type:r,source:s}){const p=i.createShader(r);if(p===null)throw new Error("Cannot create shader");if(i.shaderSource(p,s),i.compileShader(p),!i.getShaderParameter(p,i.COMPILE_STATUS))throw console.error("Shader compilation error:",i.getShaderInfoLog(p)),i.deleteShader(p),new Error("Cannot compile shader");return p}function RM({gl:i,vertexShaderSource:r,fragmentShaderSource:s}){const p=gb({gl:i,type:i.VERTEX_SHADER,source:r}),m=gb({gl:i,type:i.FRAGMENT_SHADER,source:s}),b=i.createProgram();if(i.attachShader(b,p),i.attachShader(b,m),i.linkProgram(b),!i.getProgramParameter(b,i.LINK_STATUS))throw console.error("Error: ",i.getProgramInfoLog(b)),new Error("Cannot link shader program");return b}function LM(i,r,s){const p=i.getUniformLocation(r,s);if(p===null)throw new Error(`Cannot get uniform location for ${s}`);return p}function bw({gl:i,vertexShaderSource:r,fragmentShaderSource:s,attributesKeys:p,uniformsKeys:m,vertices:b,indices:f}){const l=RM({gl:i,vertexShaderSource:r,fragmentShaderSource:s}),C=p.reduce(($,ne)=>($[ne]=i.getAttribLocation(l,`a_${ne}`),$),{}),M=m.reduce(($,ne)=>($[ne]=LM(i,l,`u_${ne}`),$),{}),D=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,D),i.bufferData(i.ARRAY_BUFFER,new Float32Array(b),i.STATIC_DRAW);let O,Z;return f!==void 0&&(O=i.createBuffer(),Z=f.length,i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,O),i.bufferData(i.ELEMENT_ARRAY_BUFFER,new Uint16Array(f),i.STATIC_DRAW)),{shaderProgram:l,programInfo:{attributesLocations:C,uniformsLocations:M},positionBuffer:D,indexBuffer:O,indexBufferLength:Z}}function $d(i){if(!i)return[1,1,1,0];if(i==="transparent")return[1,1,1,0];try{const r=DM(i),s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i.exec(r);if(s!=null&&s.length){const m=!!s[4];return[...zM.hex.rgb(r).map(b=>b/255),m?parseInt(s[4],16)/255:1]}const p=r.match(/(\d\.\d(\d+)?|\d{3}|\d{2}|\d{1})/gi)??["0","0","0"];if(r.includes("rgb")){const m=r.includes("rgba"),b=[...p.map(f=>parseFloat(f)).map((f,l)=>l<3?f/255:f)];return m||b.push(1),b}}catch{}return console.warn([`[parseColorStringToVec4]: Color ${i} is either not a valid color or its type is not supported, defaulting to black`]),[0,0,0,1]}let vh;function DM(i){return vh=vh??document.createElement("canvas").getContext("2d"),vh?(vh.fillStyle=i,vh.fillStyle):"#000000"}const Zy=1,Jn=Zy/2,Qn=Zy/2,ea=Zy/2,jM=[-.5,-.5,ea,Jn,-.5,ea,Jn,Qn,ea,-.5,Qn,ea],FM=[-.5,-.5,-.5,-.5,Qn,-.5,Jn,Qn,-.5,Jn,-.5,-.5],OM=[-.5,Qn,-.5,-.5,Qn,ea,Jn,Qn,ea,Jn,Qn,-.5],BM=[-.5,-.5,-.5,Jn,-.5,-.5,Jn,-.5,ea,-.5,-.5,ea],$M=[Jn,-.5,-.5,Jn,Qn,-.5,Jn,Qn,ea,Jn,-.5,ea],NM=[-.5,-.5,-.5,-.5,-.5,ea,-.5,Qn,ea,-.5,Qn,-.5],UM=[...jM,...FM,...OM,...BM,...$M,...NM],VM=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],qM=`attribute vec3 a_vertexPosition;
varying vec3 vTextureCoord;

uniform mat4 u_projectionMatrix;
uniform mat4 u_modelViewMatrix;
  
void main(void) {
  vTextureCoord = vec3(-a_vertexPosition.x, a_vertexPosition.y, a_vertexPosition.z);
  gl_Position = u_projectionMatrix * u_modelViewMatrix * vec4(a_vertexPosition, 1.0);
}
`,yb=`precision mediump float;

varying vec3 vTextureCoord;

%USE_TEXTURE_MACRO_MARKER%

# ifdef USE_TEXTURE
uniform samplerCube u_cubeSampler;
uniform float u_fadeOpacity;
# endif

uniform vec4 u_bgColor;

void main(void) {
  #ifdef USE_TEXTURE
  vec4 texColor = textureCube(u_cubeSampler, vTextureCoord);

    gl_FragColor = mix(
      u_bgColor,
      texColor,
      min(texColor.a, u_fadeOpacity)
    );

    gl_FragColor.a = max(gl_FragColor.a, u_fadeOpacity);

  #else
  gl_FragColor = u_bgColor;
  #endif
}
`,xl={stars:{color:"hsl(233,100%,92%)",preset:"stars"},space:{color:"hsl(210, 100%, 4%)",preset:"space"},milkyway:{color:"hsl(233,100%,92%)",preset:"milkyway"},"milkyway-subtle":{color:"hsl(233,100%,92%)",preset:"milkyway-subtle"},"milkyway-bright":{color:"hsl(233,100%,92%)",preset:"milkyway-bright"},"milkyway-colored":{color:"black",preset:"milkyway-colored"}};var hl=(i=>(i.POSITIVE_X="pX",i.NEGATIVE_X="nX",i.POSITIVE_Y="pY",i.NEGATIVE_Y="nY",i.POSITIVE_Z="pZ",i.NEGATIVE_Z="nZ",i))(hl||{});let Id,_b,vb;function GM({gl:i,faces:r,onReady:s,forceRefresh:p}){Id&&!p&&vb===JSON.stringify(r)&&s(Id,_b),vb=JSON.stringify(r);const m=Id??i.createTexture();if(i.bindTexture(i.TEXTURE_CUBE_MAP,m),!r){console.warn("[CubemapLayer][loadCubemapTexture]: Faces are null");return}const b=Object.keys(r).length;if(b!==6){console.warn(`[CubemapLayer][loadCubemapTexture]: Faces should contain exactly 6 images, but found ${b}`);return}const f=Object.entries(r).map(([l,C])=>new Promise((M,D)=>{const O=l;if(C===void 0){D(new Error(`[CubemapLayer][loadCubemapTexture]: Face ${l} is undefined`));return}const Z=new Image;Z.crossOrigin="anonymous";const $=()=>{M({image:Z,key:O})};Z.src=C,Z.complete&&Z.naturalWidth>0?$():Z.onload=$,Z.onerror=()=>{D(new Error(`[CubemapLayer][loadCubemapTexture]: Error loading image ${C}`))}}));Promise.all(f).then(l=>{for(let M=0;M<l.length;M++){const D=i.RGBA,O=i.RGBA,Z=i.UNSIGNED_BYTE,{image:$,key:ne}=l[M]??{};if(!$||!ne){console.warn("[CubemapLayer][loadCubemapTexture]: Image or key is null");continue}const fe=ZM(i,ne);i.bindTexture(i.TEXTURE_CUBE_MAP,m),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(fe,0,D,O,Z,$)}i.bindTexture(i.TEXTURE_CUBE_MAP,m),i.generateMipmap(i.TEXTURE_CUBE_MAP),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_FILTER,i.LINEAR_MIPMAP_LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAG_FILTER,i.LINEAR);const C=l.map(M=>M.image);s(m,C),_b=C,Id=m}).catch(l=>{console.error("[CubemapLayer][loadCubemapTexture]: Error loading cubemap texture",l)})}function ZM(i,r){if(r===hl.POSITIVE_X)return i.TEXTURE_CUBE_MAP_POSITIVE_X;if(r===hl.NEGATIVE_X)return i.TEXTURE_CUBE_MAP_NEGATIVE_X;if(r===hl.POSITIVE_Y)return i.TEXTURE_CUBE_MAP_POSITIVE_Y;if(r===hl.NEGATIVE_Y)return i.TEXTURE_CUBE_MAP_NEGATIVE_Y;if(r===hl.POSITIVE_Z)return i.TEXTURE_CUBE_MAP_POSITIVE_Z;if(r===hl.NEGATIVE_Z)return i.TEXTURE_CUBE_MAP_NEGATIVE_Z;throw new Error(`[CubemapLayer][loadCubemapTexture]: Invalid key ${r}`)}function WM(i,r,s){return[fs(i[0],r[0],s),fs(i[1],r[1],s),fs(i[2],r[2],s),fs(i[3],r[3],s)]}function fs(i,r,s){return i+(r-i)*s}const zc="https://api.maptiler.com/resources/space",HM=["vertexPosition"],XM=["projectionMatrix","modelViewMatrix","cubeSampler","bgColor","fadeOpacity"],bb="%USE_TEXTURE_MACRO_MARKER%",KM="#define USE_TEXTURE",xb=xl.stars;function YM(i,r){if(!xw(i))return{color:"transparent"};if(i===!0)return r;const s={...i};if(i.faces||i.path)return delete s.preset,s;const p=i.preset;if(p!==void 0&&!(p in xl))throw new Error(`[CubemapLayer]: Invalid preset "${p}". Available presets: ${Object.keys(xl).join(", ")}`);return{...s,color:s.color??xl[p].color??"hsl(233,100%,92%)"}}let gg=class{constructor(r){Je(this,"id","Cubemap Layer"),Je(this,"type","custom"),Je(this,"renderingMode","3d"),Je(this,"map"),Je(this,"faces"),Je(this,"useCubemapTexture",!0),Je(this,"currentFadeOpacity",0),Je(this,"cubeMapNeedsUpdate",!1),Je(this,"bgColor"),Je(this,"previousBgColor",[0,0,0,0]),Je(this,"targetBgColor",[0,0,0,0]),Je(this,"transitionDelta",0),Je(this,"gl"),Je(this,"cubemap"),Je(this,"texture"),Je(this,"currentFacesDefinitionKey",""),Je(this,"options"),Je(this,"animationActive",!0),Je(this,"imageIsAnimating",!1),Je(this,"imageFadeInDelta",0);const s=YM(r,xb);this.options=s,this.currentFacesDefinitionKey=JSON.stringify(s.faces??s.preset??s.path),this.bgColor=[0,0,0,0],this.targetBgColor=$d(s.color),this.faces=wb(s),this.useCubemapTexture=this.faces!==null}updateCubemap({facesNeedUpdate:r}={facesNeedUpdate:!0}){this.useCubemapTexture=this.faces!==null;const s=XM.filter(p=>p==="cubeSampler"||p==="fadeOpacity"?this.useCubemapTexture:!0);this.cubemap=bw({gl:this.gl,vertexShaderSource:qM,fragmentShaderSource:this.useCubemapTexture?yb.replace(bb,KM):yb.replace(bb,""),attributesKeys:HM,uniformsKeys:s,vertices:UM,indices:VM}),this.cubeMapNeedsUpdate=r,this.useCubemapTexture&&this.updateTexture(this.gl,this.faces),this.animateColorChange()}onAdd(r,s){this.map=r,this.gl=s,this.updateCubemap()}onRemove(r,s){this.cubemap&&(s.deleteProgram(this.cubemap.shaderProgram),s.deleteBuffer(this.cubemap.positionBuffer))}updateTexture(r,s){if(this.cubeMapNeedsUpdate===!0&&!this.imageIsAnimating){if(this.cubeMapNeedsUpdate=!1,!this.useCubemapTexture)return;GM({gl:r,faces:s,onReady:p=>{this.texture=p,this.animateIn()}})}}prerender(r,s){this.faces&&this.updateTexture(this.gl,this.faces)}animateColorChange(){const r=()=>{this.transitionDelta<1&&(requestAnimationFrame(r),this.bgColor=WM(this.previousBgColor,this.targetBgColor,this.transitionDelta),this.transitionDelta+=.075,this.map.triggerRepaint())};requestAnimationFrame(r)}async animateIn(){if(!this.imageIsAnimating){if(!this.animationActive){this.currentFadeOpacity=1,this.imageFadeInDelta=1,this.map.triggerRepaint();return}return new Promise(r=>{this.imageIsAnimating=!0;const s=()=>{if(this.imageFadeInDelta=Math.min(this.imageFadeInDelta+.05,1),this.currentFadeOpacity=fs(0,1,this.imageFadeInDelta),this.map.triggerRepaint(),this.imageFadeInDelta<1){requestAnimationFrame(s);return}this.imageIsAnimating=!1,this.imageFadeInDelta=0,r()};requestAnimationFrame(s)})}}async animateOut(){if(!(this.imageIsAnimating||!this.animationActive))return new Promise(r=>{const s=()=>{if(this.imageFadeInDelta=Math.min(this.imageFadeInDelta+.05,1),this.currentFadeOpacity=fs(1,0,this.imageFadeInDelta),this.map.triggerRepaint(),this.imageFadeInDelta>=1){this.imageIsAnimating=!1,this.imageFadeInDelta=0,r();return}requestAnimationFrame(s)};requestAnimationFrame(s)})}setAnimationActive(r){this.animationActive=r}render(r,s){if(!this.map.isGlobeProjection())return;if(this.map===void 0)throw new Error("[CubemapLayer]: Map is undefined");if(this.cubemap===void 0)throw new Error("[CubemapLayer]: Cubemap is undefined");this.texture,r.disable(r.DEPTH_TEST),r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.DST_ALPHA),r.useProgram(this.cubemap.shaderProgram),r.bindBuffer(r.ARRAY_BUFFER,this.cubemap.positionBuffer),r.vertexAttribPointer(this.cubemap.programInfo.attributesLocations.vertexPosition,3,r.FLOAT,!1,0,0),r.enableVertexAttribArray(this.cubemap.programInfo.attributesLocations.vertexPosition);const p=.1,m=1e4,b=r.canvas,f=b.clientWidth/b.clientHeight,l=this.map.transform,C=l.fov*(Math.PI/180),M=jh();kM(M,C,f,p,m),cb(M,M,l.rollInRadians),lb(M,M,-l.pitchInRadians),cb(M,M,l.bearingInRadians);const D=l.center.lat*Math.PI/180,O=l.center.lng*Math.PI/180;lb(M,M,D),TM(M,M,-O),r.uniformMatrix4fv(this.cubemap.programInfo.uniformsLocations.projectionMatrix,!1,M);const Z=jh();if(r.uniformMatrix4fv(this.cubemap.programInfo.uniformsLocations.modelViewMatrix,!1,Z),r.uniform4fv(this.cubemap.programInfo.uniformsLocations.bgColor,new Float32Array(this.bgColor)),r.uniform1f(this.cubemap.programInfo.uniformsLocations.fadeOpacity,this.currentFadeOpacity),this.useCubemapTexture&&this.texture&&(r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_CUBE_MAP,this.texture),r.uniform1i(this.cubemap.programInfo.uniformsLocations.cubeSampler,0)),this.cubemap.indexBuffer===void 0)throw new Error("Index buffer is undefined");if(this.cubemap.indexBufferLength===void 0)throw new Error("Index buffer length is undefined");r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.cubemap.indexBuffer),r.drawElements(r.TRIANGLES,this.cubemap.indexBufferLength,r.UNSIGNED_SHORT,0)}setBgColor(r){this.targetBgColor=r,this.previousBgColor=this.bgColor,this.transitionDelta=0}getConfig(){return this.options}async setCubemapFaces(r){if(await this.animateOut(),!r.faces&&!r.preset&&!r.path){this.faces=null,this.useCubemapTexture=!1,this.currentFacesDefinitionKey="empty",await this.animateIn();return}this.faces=wb(r),this.currentFacesDefinitionKey=JSON.stringify(r.faces??r.preset??r.path)}async setCubemap(r){const s=typeof r=="boolean"?xb:r;this.options=s;const p=JSON.stringify(s.faces??s.preset??s.path),m=this.currentFacesDefinitionKey!==p;m&&(await this.setCubemapFaces(s),this.cubeMapNeedsUpdate=!0);const b=$d(s.color);if(s.color&&this.targetBgColor.toString()!==b.toString())this.setBgColor(b);else if(!s.color&&s.preset&&s.preset in xl){const f=xl[s.preset];this.setBgColor($d(f.color))}this.updateCubemap({facesNeedUpdate:m})}show(){this.map.setLayoutProperty(this.id,"visibility","visible")}hide(){this.map.setLayoutProperty(this.id,"visibility","none")}};function xw(i){return i?typeof i=="boolean"?!0:!(!i.path&&!i.preset&&!i.faces&&!i.color||i.preset&&!(i.preset in xl)||i.faces&&(!i.faces.pX||!i.faces.nX||!i.faces.pY||!i.faces.nY||!i.faces.pZ||!i.faces.nZ)):!1}function wb(i){if(i.faces)return i.faces;if(i.preset)return{pX:`${zc}/${i.preset}/px.webp`,nX:`${zc}/${i.preset}/nx.webp`,pY:`${zc}/${i.preset}/py.webp`,nY:`${zc}/${i.preset}/ny.webp`,pZ:`${zc}/${i.preset}/pz.webp`,nZ:`${zc}/${i.preset}/nz.webp`};if(i.path){const r=i.path.baseUrl,s=i.path.format??"png";return{pX:`${r}/px.${s}`,nX:`${r}/nx.${s}`,pY:`${r}/py.${s}`,nY:`${r}/ny.${s}`,pZ:`${r}/pz.${s}`,nZ:`${r}/nz.${s}`}}return null}const JM=`attribute vec3 a_position;

uniform mat4 u_matrix;
uniform mat4 u_rotationMatrix;

uniform float u_scale;

varying vec2 v_pos;
varying float v_scale;

void main() {
  v_scale = u_scale;
  v_pos = a_position.xy * u_scale;
  gl_Position = u_matrix * u_rotationMatrix * vec4(a_position, 1.0);
}
`,QM=`precision mediump float;
varying vec2 v_pos;
      
uniform int u_stopsNumber;
uniform float u_stops[100];
uniform vec4 u_colors[100];
uniform float u_maxDistance;

varying float v_scale;

const float EPSILON = 0.000001;

vec2 center = vec2(0.0, 0.0);
void main() {
  float rawDistance = distance(center, v_pos);
  float distanceFromGlobeEdge = rawDistance - 1.0;

    vec4 color = u_colors[0];

  // if we're further than the max distance, we should not render anything.
  // This is to always render a circle, otherwise we end up rendering
  // to the corners of the plane.
  if (distance(center, v_pos) > u_maxDistance * v_scale) {
    discard;
  }

  for (int i = 1; i < 100; i++) {
    // if we're past the last stop
    // we should fill to the end with the last stop color
    if (i >= u_stopsNumber) {
      color = u_colors[i - 1];
      break;
    }

    float scaledStopPosition = u_stops[i] * pow(v_scale, 1.6);
    float lastStopValue = u_stops[i - 1];
    float thisStopValue = u_stops[i];

    // this is to avoid blending errors when the stops are the same
    // eg when you would want a sharp edge between two stops.
    // \`numbersAreEqual\` will be 1.0 if the numbers are equal, 0.0 if they are not.
    // We then subtract EPSILON from the last stop making the stop value _almost_ equal
    // to the next stop but not enough to cause blending issues.
    // It's more efficient to do this than an if / else statement.
    float numbersAreEqual = 1.0 - step(EPSILON, abs(lastStopValue - thisStopValue));
    lastStopValue = lastStopValue - numbersAreEqual * EPSILON;

    float lastScaledStopPosition = lastStopValue * pow(v_scale, 1.6);

    if (distanceFromGlobeEdge <= scaledStopPosition) {
      float stopBlendFactor = (distanceFromGlobeEdge - lastScaledStopPosition) / (scaledStopPosition - lastScaledStopPosition);
      color = mix(u_colors[i - 1], u_colors[i], stopBlendFactor);
      break;
    }
  }
  
  // gl_FragColor = color;
  gl_FragColor = vec4(color.rgb * color.a, color.a);
}
`,Ch=2,eA=["position"],tA=["matrix","rotationMatrix","stopsNumber","stops","colors","maxDistance","scale"],rA=[-2,-2,0,Ch,-2,0,-2,Ch,0,Ch,Ch,0],nl={scale:.9,stops:[[0,"rgba(176, 208, 240, 1)"],[.1,"rgba(98, 168, 229, 0.3)"],[.2,"rgba(98, 168, 229, 0.0)"]]},Tb=.06;let yg=class{constructor(r){if(Je(this,"id","Halo Layer"),Je(this,"type","custom"),Je(this,"renderingMode","3d"),Je(this,"gradient"),Je(this,"scale",0),Je(this,"animationDelta",0),Je(this,"map"),Je(this,"plane"),Je(this,"animationActive",!0),typeof r=="boolean"){this.gradient=nl;return}this.gradient={...nl,...r}}onAdd(r,s){this.map=r,this.plane=bw({gl:s,vertexShaderSource:JM,fragmentShaderSource:QM,attributesKeys:eA,uniformsKeys:tA,vertices:rA}),this.animateIn()}getConfig(){return this.gradient}async animateIn(){if(!this.animationActive){this.scale=this.gradient.scale,this.animationDelta=1,this.map.triggerRepaint();return}return new Promise(r=>{this.animationDelta=0;const s=()=>{if(this.animationDelta<1){this.scale=fs(0,this.gradient.scale,this.animationDelta),this.animationDelta+=Tb,this.map.triggerRepaint(),requestAnimationFrame(s);return}r()};requestAnimationFrame(s)})}async animateOut(){if(this.animationActive)return this.animationDelta=0,new Promise(r=>{const s=()=>{if(this.animationDelta<1){this.scale=fs(this.gradient.scale,0,this.animationDelta),this.animationDelta+=Tb,this.map.triggerRepaint(),requestAnimationFrame(s);return}r()};s()})}onRemove(r,s){this.plane!==void 0&&(s.deleteProgram(this.plane.shaderProgram),s.deleteBuffer(this.plane.positionBuffer))}prerender(r,s){}render(r,s){if(this.map===void 0)throw new Error("[RadialGradientLayer]: Map is undefined");if(!this.map.isGlobeProjection())return;if(this.plane===void 0)throw new Error("[RadialGradientLayer]: Plane is undefined");r.disable(r.DEPTH_TEST),r.enable(r.BLEND),r.useProgram(this.plane.shaderProgram),r.bindBuffer(r.ARRAY_BUFFER,this.plane.positionBuffer);const p=this.plane.programInfo.attributesLocations.position;r.enableVertexAttribArray(p),r.vertexAttribPointer(p,3,r.FLOAT,!1,0,0);const m=jh(),b=this.scale;wM(m,m,[b,b,b]);const f=jh();xM(f,s.defaultProjectionData.mainMatrix,m);const l=this.plane.programInfo.uniformsLocations.matrix;r.uniformMatrix4fv(l,!1,f);const C=jh(),M=this.map.transform.cameraPosition,D=pg(Bd(),M),O=CM(0,1,0),Z=Bd();ub(Z,O,D),pg(Z,Z);const $=Bd();ub($,D,Z),pg($,$),bM(C,Z[0],Z[1],Z[2],0,$[0],$[1],$[2],0,D[0],D[1],D[2],0,0,0,0,1);const ne=this.plane.programInfo.uniformsLocations.rotationMatrix;r.uniformMatrix4fv(ne,!1,C);const fe=this.gradient.stops.length,Ee=[],_e=[];for(let Se=0;Se<=fe;Se++)if(Se<fe){Ee[Se]=this.gradient.stops[Se][0];const Pe=$d(this.gradient.stops[Se][1]);_e.push(...Pe)}r.uniform1i(this.plane.programInfo.uniformsLocations.stopsNumber,fe),r.uniform1fv(this.plane.programInfo.uniformsLocations.stops,new Float32Array(Ee)),r.uniform4fv(this.plane.programInfo.uniformsLocations.colors,new Float32Array(_e)),r.uniform1f(this.plane.programInfo.uniformsLocations.maxDistance,Ch),r.uniform1f(this.plane.programInfo.uniformsLocations.scale,b),r.drawArrays(r.TRIANGLE_STRIP,0,4)}async setGradient(r){if(r===!1){await this.animateOut();return}if(await this.animateOut(),!iA(r)){this.gradient.scale=nl.scale,this.gradient.stops=[[0,"transparent"],[1,"transparent"]];return}r===!0?(this.gradient.scale=nl.scale,this.gradient.stops=nl.stops):(this.gradient.scale=r.scale??nl.scale,this.gradient.stops=r.stops??nl.stops),await this.animateIn()}setAnimationActive(r){this.animationActive=r}show(){this.map.setLayoutProperty(this.id,"visibility","visible")}hide(){this.map.setLayoutProperty(this.id,"visibility","none")}};function iA(i){return typeof i=="boolean"?!0:!(typeof i.scale!="number"||!i.stops||i.stops.length===0||i.stops.some(r=>typeof r[0]!="number"||typeof r[1]!="string"))}const nA={POINT:"POINT",COUNTRY:"COUNTRY"};let ww=class Tw extends ct.Map{constructor(r){P5(r.container),r.apiKey&&(ci.apiKey=r.apiKey);const{style:s,requiresUrlMonitoring:p,isFallback:m}=ab(r.style);m&&console.warn("Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style."),ci.apiKey||console.warn("MapTiler Cloud API key is not set. Visit https://maptiler.com and try Cloud for free!");const b=location.hash;let f={compact:!1};r.customAttribution?f.customAttribution=r.customAttribution:r.attributionControl&&typeof r.attributionControl=="object"&&(f={...f,...r.attributionControl});const l={...r,style:s,maplibreLogo:!1,transformRequest:jv(r.transformRequest),attributionControl:r.forceNoAttributionControl===!0?!1:f};delete l.style,super(l),Je(this,"telemetry"),Je(this,"space"),Je(this,"halo"),Je(this,"options"),Je(this,"isTerrainEnabled",!1),Je(this,"terrainExaggeration",1),Je(this,"primaryLanguage"),Je(this,"terrainGrowing",!1),Je(this,"terrainFlattening",!1),Je(this,"minimap"),Je(this,"forceLanguageUpdate"),Je(this,"languageAlwaysBeenStyle"),Je(this,"isReady",!1),Je(this,"terrainAnimationDuration",1e3),Je(this,"monitoredStyleUrls"),Je(this,"styleInProcess",!1),Je(this,"curentProjection"),Je(this,"originalLabelStyle",new window.Map),Je(this,"isStyleLocalized",!1),Je(this,"languageIsUpdated",!1),Je(this,"spaceboxLoadingState",{styleLoadCallbackSet:!1}),this.options=r,this.setStyle(s),p&&this.monitorStyleUrl(s);const C=()=>{let $="The distant style could not be loaded.";this.getStyle()?$+="Leaving the style as is.":(this.setStyle(Rh.STREETS),$+=`Loading default MapTiler Cloud style "${Rh.STREETS.getDefaultVariant().getId()}" as a fallback.`),console.warn($)};if(this.on("style.load",()=>{this.styleInProcess=!1}),this.on("error",$=>{if($.error instanceof ct.AJAXError){const ne=$.error.url,fe=new URL(ne);fe.search="";const Ee=fe.href;this.monitoredStyleUrls&&this.monitoredStyleUrls.has(Ee)&&(this.monitoredStyleUrls.delete(Ee),C());return}if(this.styleInProcess){C();return}}),ci.caching&&!Yg&&console.warn("The cache API is only available in secure contexts. More info at https://developer.mozilla.org/en-US/docs/Web/API/Cache"),ci.caching&&Yg&&T5(),typeof r.language>"u")this.primaryLanguage=ci.primaryLanguage;else{const $=wv(r.language,Yt);this.primaryLanguage=$??ci.primaryLanguage}this.forceLanguageUpdate=!(this.primaryLanguage===Yt.STYLE||this.primaryLanguage===Yt.STYLE_LOCK),this.languageAlwaysBeenStyle=this.primaryLanguage===Yt.STYLE,this.terrainExaggeration=r.terrainExaggeration??this.terrainExaggeration,this.curentProjection=r.projection,this.on("styledata",()=>{this.curentProjection==="mercator"?this.setProjection({type:"mercator"}):this.curentProjection==="globe"&&this.setProjection({type:"globe"})}),this.once("styledata",async()=>{if(!r.geolocate||r.center||r.hash&&b)return;try{if(r.geolocate===nA.COUNTRY){await this.fitToIpBounds();return}}catch(ne){console.warn(ne.message)}let $;try{await this.centerOnIpPoint(r.zoom),$=this.getCameraHash()}catch(ne){console.warn(ne.message)}(await navigator.permissions.query({name:"geolocation"})).state==="granted"&&navigator.geolocation.getCurrentPosition(ne=>{$===this.getCameraHash()&&(this.terrain?this.easeTo({center:[ne.coords.longitude,ne.coords.latitude],zoom:r.zoom||12,duration:2e3}):this.once("terrain",()=>{this.easeTo({center:[ne.coords.longitude,ne.coords.latitude],zoom:r.zoom||12,duration:2e3})}))},null,{maximumAge:24*3600*1e3,timeout:5e3,enableHighAccuracy:!1})}),this.on("styledata",()=>{this.setPrimaryLanguage(this.primaryLanguage)}),this.on("styledata",()=>{this.getTerrain()===null&&this.isTerrainEnabled&&this.enableTerrain(this.terrainExaggeration)}),this.once("load",async()=>{let $={logo:null};try{const ne=Object.keys(this.style.sourceCaches).map(Ee=>this.getSource(Ee)).filter(Ee=>Ee&&"url"in Ee&&typeof Ee.url=="string"&&Ee.url.includes("tiles.json")),fe=new URL(ne[0].url);fe.searchParams.has("key")||fe.searchParams.append("key",ci.apiKey),$=await(await fetch(fe.href)).json()}catch{}if(r.customControls){const ne="[data-maptiler-control-group]",fe="[data-maptiler-control]",Ee=ye=>{let Ae=ye.dataset.maptilerControl;return(Ae==="true"||Ae==="")&&(Ae=void 0),Ae},_e=ye=>ye.dataset.maptilerPosition;let Se=[...this._container.ownerDocument.querySelectorAll(ne)],Pe=[...this._container.ownerDocument.querySelectorAll(fe)].filter(ye=>ye.closest(ne)===null);if(typeof r.customControls=="string"){const ye=r.customControls;Se=Se.filter(Ae=>Ae.matches(ye)||Ae.closest(ye)!==null),Pe=Pe.filter(Ae=>Ae.matches(ye)||Ae.closest(ye)!==null)}for(const ye of Se){const Ae=new uy(ye);this.addControl(Ae,_e(ye));for(const Ne of ye.querySelectorAll(fe))Ae.configureGroupItem(Ne,Ee(Ne))}for(const ye of Pe)this.addControl(new uy(ye,Ee(ye)),_e(ye));const ve=()=>{const{lng:ye,lat:Ae}=this.getCenter();this._container.style.setProperty("--maptiler-center-lng",String(ye)),this._container.style.setProperty("--maptiler-center-lat",String(Ae)),this._container.style.setProperty("--maptiler-zoom",String(this.getZoom())),this._container.style.setProperty("--maptiler-bearing",String(this.getBearing())),this._container.style.setProperty("--maptiler-pitch",String(this.getPitch())),this._container.style.setProperty("--maptiler-roll",String(this.getRoll())),this._container.style.setProperty("--maptiler-is-globe-projection",String(this.isGlobeProjection())),this._container.style.setProperty("--maptiler-has-terrain",String(this.hasTerrain()))};ve(),this.on("render",ve)}if(r.forceNoAttributionControl!==!0)if("logo"in $&&$.logo){const ne=$.logo;this.addControl(new Ov({logoURL:ne}),r.logoPosition)}else r.maptilerLogo&&this.addControl(new Ov,r.logoPosition);if(r.scaleControl){const ne=r.scaleControl===!0||r.scaleControl===void 0?"bottom-right":r.scaleControl,fe=new B5({unit:ci.unit});this.addControl(fe,ne),ci.on("unit",Ee=>{fe.setUnit(Ee)})}if(r.navigationControl!==!1){const ne=r.navigationControl===!0||r.navigationControl===void 0?"top-right":r.navigationControl;this.addControl(new fM,ne)}if(r.geolocateControl!==!1){const ne=r.geolocateControl===!0||r.geolocateControl===void 0?"top-right":r.geolocateControl;this.addControl(new gM({positionOptions:{enableHighAccuracy:!0,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!0,showAccuracyCircle:!0,showUserLocation:!0}),ne)}if(r.terrainControl){const ne=r.terrainControl===!0||r.terrainControl===void 0?"top-right":r.terrainControl;this.addControl(new dM,ne)}if(r.projectionControl){const ne=r.projectionControl===!0||r.projectionControl===void 0?"top-right":r.projectionControl;this.addControl(new _M,ne)}if(r.fullscreenControl){const ne=r.fullscreenControl===!0||r.fullscreenControl===void 0?"top-right":r.fullscreenControl;this.addControl(new $5({}),ne)}this.isReady=!0,this.fire("ready",{target:this})});let M=!1,D=!1,O;this.once("ready",()=>{M=!0,D&&this.fire("loadWithTerrain",O)}),this.once("style.load",()=>{const{minimap:$}=r;if(typeof $=="object"){const{zoom:ne,center:fe,style:Ee,language:_e,apiKey:Se,maptilerLogo:Pe,canvasContextAttributes:ve,refreshExpiredTiles:ye,maxBounds:Ae,scrollZoom:Ne,minZoom:it,maxZoom:gt,boxZoom:nt,locale:Zt,fadeDuration:kt,crossSourceCollisions:ur,clickTolerance:hi,bounds:pi,fitBoundsOptions:zi,pixelRatio:Ri,validateStyle:br}=r;this.minimap=new hg($,{zoom:ne,center:fe,style:Ee,language:_e,apiKey:Se,container:"null",maptilerLogo:Pe,canvasContextAttributes:ve,refreshExpiredTiles:ye,maxBounds:Ae,scrollZoom:Ne,minZoom:it,maxZoom:gt,boxZoom:nt,locale:Zt,fadeDuration:kt,crossSourceCollisions:ur,clickTolerance:hi,bounds:pi,fitBoundsOptions:zi,pixelRatio:Ri,validateStyle:br}),this.addControl(this.minimap,$.position??"bottom-left")}else $===!0?(this.minimap=new hg({},r),this.addControl(this.minimap,"bottom-left")):$!==void 0&&$!==!1&&(this.minimap=new hg({},r),this.addControl(this.minimap,$))});const Z=$=>{$.terrain&&(D=!0,O={type:"loadWithTerrain",target:this,terrain:$.terrain},this.off("terrain",Z),M&&this.fire("loadWithTerrain",O))};this.on("terrain",Z),r.terrain&&this.enableTerrain(r.terrainExaggeration??this.terrainExaggeration),this.once("load",()=>{this.getCanvas().addEventListener("webglcontextlost",ne=>{if(this._removed===!0){console.warn("[webglcontextlost]","WebGL context lost after map removal. This is harmless.");return}console.warn("[webglcontextlost]","Unexpected loss of WebGL context!"),this.fire("webglContextLost",ne)});const $=this.getLayersOrder()[0];r.space&&this.initSpace({options:r,before:$}),r.halo&&this.initHalo({options:r,before:$})}),this.telemetry=new vM(this)}getSpace(){return this.space}setSpace(r){if(r===!1){this.space=void 0;return}if(this.isGlobeProjection()){if(this.space){this.space.setCubemap(r),this.getLayer(this.space.id)||this.addLayer(this.space,this.getLayersOrder()[0]);return}this.space=new gg(r),this.once("load",()=>{const s=this.getLayersOrder()[0];this.space&&this.addLayer(this.space,s)})}}enableSpaceAnimations(){this.setSpaceAnimationActive(!0)}disableSpaceAnimations(){this.setSpaceAnimationActive(!1)}enableHaloAnimations(){this.setHaloAnimationActive(!0)}disableHaloAnimations(){this.setHaloAnimationActive(!1)}setHaloAnimationActive(r){this.halo?this.halo.setAnimationActive(r):this.once("load",()=>{var s;(s=this.halo)==null||s.setAnimationActive(r)})}setSpaceAnimationActive(r){this.space?this.space.setAnimationActive(r):this.once("load",()=>{var s;(s=this.space)==null||s.setAnimationActive(r)})}setSpaceFromStyle({style:r}){var s,p,m;if(this.options.space){this.setSpace(this.options.space);return}const b=(p=(s=r.metadata)==null?void 0:s.maptiler)==null?void 0:p.space;if(!b){this.setSpace({color:"transparent"});return}if(!xw(b)){this.setSpace({color:"transparent"});return}if(JSON.stringify((m=this.space)==null?void 0:m.getConfig())===JSON.stringify(b)){if(this.space&&!this.getLayer(this.space.id)){const f=this.getLayersOrder()[0];this.addLayer(this.space,f)}return}(()=>{if(this.space&&this.isGlobeProjection()){if(!this.getLayer(this.space.id)){const f=this.getLayersOrder()[0];this.addLayer(this.space,f)}this.space.setCubemap(b)}})()}setHaloFromStyle({style:r}){var s,p,m;const b=(s=r.metadata)==null?void 0:s.maptiler;if(JSON.stringify((p=this.halo)==null?void 0:p.getConfig())===JSON.stringify(b?.halo)){if(this.halo&&!this.getLayer(this.halo.id)){const f=this.getLayersOrder().indexOf(((m=this.space)==null?void 0:m.id)??"")+1,l=this.getLayersOrder()[f];this.addLayer(this.halo,l)}return}if(!(b!=null&&b.halo)&&!this.options.halo){this.setHalo({stops:[[0,"transparent"],[1,"transparent"]],scale:1});return}(()=>{var f;if(this.halo){if(!this.getLayer(this.halo.id)){const C=this.getLayersOrder().indexOf(((f=this.space)==null?void 0:f.id)??"")+1,M=this.getLayersOrder()[C];this.addLayer(this.halo,M)}const l=b?.halo??this.options.halo;l&&this.halo.setGradient(l)}})()}initSpace({options:r=this.options,before:s,spec:p}){if(this.space){this.getLayer(this.space.id)||this.addLayer(this.space,s);return}if(r.space===!1)return;const m=p;if(r.space){this.space=new gg(r.space),this.addLayer(this.space,s);return}m&&(this.space=new gg(m),this.addLayer(this.space,s))}initHalo({options:r=this.options,before:s,spec:p}){if(this.halo&&this.getLayer(this.halo.id)||r.halo===!1)return;const m=p;if(r.halo){this.halo=new yg(r.halo),this.addLayer(this.halo,s);return}m&&(this.halo=new yg(m),this.addLayer(this.halo,s))}getHalo(){return this.halo}setHalo(r){if(this.isGlobeProjection()){if(this.halo){this.halo.setGradient(r);return}this.halo=new yg(r),this.once("load",()=>{var s;const p=this.getLayersOrder(),m=p[0],b=p.indexOf(((s=this.space)==null?void 0:s.id)??"")+2,f=p[b];this.halo&&this.addLayer(this.halo,this.space?f:m)})}}recreate(){const r={center:this.getCenter(),zoom:this.getZoom(),bearing:this.getBearing(),pitch:this.getPitch()};this.remove(),Object.assign(this,new Tw({...this.options})),this.once("load",()=>{this.jumpTo(r)})}setTerrainAnimationDuration(r){this.terrainAnimationDuration=Math.max(r,0)}async onLoadAsync(){return new Promise(r=>{if(this.loaded()){r(this);return}this.once("load",()=>{r(this)})})}async onReadyAsync(){return new Promise(r=>{if(this.isReady){r(this);return}this.once("ready",()=>{r(this)})})}async onLoadWithTerrainAsync(){return new Promise(r=>{if(this.isReady&&this.terrain){r(this);return}this.once("loadWithTerrain",()=>{r(this)})})}monitorStyleUrl(r){typeof this.monitoredStyleUrls>"u"&&(this.monitoredStyleUrls=new Set);const s=new URL(r);s.search="",this.monitoredStyleUrls.add(s.href)}setStyle(r,s){var p,m,b,f,l;this.originalLabelStyle.clear(),(p=this.minimap)==null||p.setStyle(r),this.forceLanguageUpdate=!0,this.once("idle",()=>{this.forceLanguageUpdate=!1});const C=ab(r);if(C.requiresUrlMonitoring&&this.monitorStyleUrl(C.style),C.isFallback){if(this.getStyle())return console.warn("[Map.setStyle]: Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Keeping the curent style instead."),this;console.warn("[Map.setStyle]: Invalid style. A style must be a valid URL to a style.json, a JSON string representing a valid StyleSpecification or a valid StyleSpecification object. Fallback to default MapTiler style.")}const M=this.getStyle(),D=C.style;try{super.setStyle(C.style,s),this.styleInProcess=!0}catch($){this.styleInProcess=!1,console.error("[Map.setStyle]: Error while setting style:",$)}const O=()=>{const $=C.style;if(!$.projection||$.projection.type==="mercator"){console.warn("[Map.setStyle]: Neither space nor halo is supported for mercator projection. Ignoring...");return}this.setSpaceFromStyle({style:C.style}),this.setHaloFromStyle({style:C.style})},Z=$=>{var ne,fe,Ee,_e;const Se=$?.target.getStyle()??C.style,Pe=this.getLayersOrder()[0];this.space?this.setSpaceFromStyle({style:Se}):this.initSpace({before:Pe,spec:(fe=(ne=Se.metadata)==null?void 0:ne.maptiler)==null?void 0:fe.space}),this.halo?this.setHaloFromStyle({style:Se}):this.initHalo({before:Pe,spec:(_e=(Ee=Se.metadata)==null?void 0:Ee.maptiler)==null?void 0:_e.halo})};if(typeof C.style=="string"||C.requiresUrlMonitoring)return this.on("styledata",Z),this;if(this.styleInProcess&&!this.spaceboxLoadingState.styleLoadCallbackSet)return this.once("style.load",Z),this.once("styledata",Z),this.spaceboxLoadingState.styleLoadCallbackSet=!0,this;if(((m=M?.terrain)==null?void 0:m.source)!==((b=D?.terrain)==null?void 0:b.source)||((f=M?.terrain)==null?void 0:f.exaggeration)!==((l=D?.terrain)==null?void 0:l.exaggeration))return this.once("terrain",O),this;try{Z()}catch{}return this}addLayer(r,s){var p;return(p=this.minimap)==null||p.addLayer(r,s),super.addLayer(r,s)}moveLayer(r,s){var p;return(p=this.minimap)==null||p.moveLayer(r,s),super.moveLayer(r,s)}removeLayer(r){var s;return(s=this.minimap)==null||s.removeLayer(r),super.removeLayer(r)}setLayerZoomRange(r,s,p){var m;return(m=this.minimap)==null||m.setLayerZoomRange(r,s,p),super.setLayerZoomRange(r,s,p)}setFilter(r,s,p){var m;return(m=this.minimap)==null||m.setFilter(r,s,p),super.setFilter(r,s,p)}setPaintProperty(r,s,p,m){var b;return(b=this.minimap)==null||b.setPaintProperty(r,s,p,m),super.setPaintProperty(r,s,p,m)}setLayoutProperty(r,s,p,m){var b;return(b=this.minimap)==null||b.setLayoutProperty(r,s,p,m),super.setLayoutProperty(r,s,p,m)}setGlyphs(r,s){var p;return(p=this.minimap)==null||p.setGlyphs(r,s),super.setGlyphs(r,s)}getStyleLanguage(){return!this.style||!this.style.stylesheet||!this.style.stylesheet.metadata||typeof this.style.stylesheet.metadata!="object"?null:"maptiler:language"in this.style.stylesheet.metadata&&typeof this.style.stylesheet.metadata["maptiler:language"]=="string"?Zg(this.style.stylesheet.metadata["maptiler:language"]):null}setLanguage(r){var s;(s=this.minimap)==null||s.map.setLanguage(r),this.onStyleReady(()=>{this.setPrimaryLanguage(r)})}setPrimaryLanguage(r){const s=this.getStyleLanguage(),p=wv(r,Yt);if(!p){console.warn(`The language "${p}" is not supported.`);return}if(!(p.flag===Yt.STYLE.flag&&s&&(s.flag===Yt.AUTO.flag||s.flag===Yt.VISITOR.flag))&&(p.flag!==Yt.STYLE.flag&&(this.languageAlwaysBeenStyle=!1),this.languageAlwaysBeenStyle||this.primaryLanguage===p&&!this.forceLanguageUpdate))return;if(this.primaryLanguage.flag===Yt.STYLE_LOCK.flag){console.warn("The language cannot be changed because this map has been instantiated with the STYLE_LOCK language flag.");return}this.primaryLanguage=p;let m=p;if(p.flag===Yt.STYLE.flag){if(!s){console.warn("The style has no default languages or has an invalid one.");return}m=s}let b=Yt.LOCAL.flag,f=["get",b];m.flag===Yt.VISITOR.flag?(b=zv().flag,f=["case",["all",["has",b],["has",Yt.LOCAL.flag]],["case",["==",["get",b],["get",Yt.LOCAL.flag]],["get",Yt.LOCAL.flag],["format",["get",b],{"font-scale":.8},`
`,["get",Yt.LOCAL.flag],{"font-scale":1.1}]],["get",Yt.LOCAL.flag]]):m.flag===Yt.VISITOR_ENGLISH.flag?(b=Yt.ENGLISH.flag,f=["case",["all",["has",b],["has",Yt.LOCAL.flag]],["case",["==",["get",b],["get",Yt.LOCAL.flag]],["get",Yt.LOCAL.flag],["format",["get",b],{"font-scale":.8},`
`,["get",Yt.LOCAL.flag],{"font-scale":1.1}]],["get",Yt.LOCAL.flag]]):m.flag===Yt.AUTO.flag?(b=zv().flag,f=["coalesce",["get",b],["get",Yt.LOCAL.flag]]):m===Yt.LOCAL?(b=Yt.LOCAL.flag,f=["get",b]):(b=m.flag,f=["coalesce",["get",b],["get",Yt.LOCAL.flag]]);const{layers:l}=this.getStyle(),C=this.originalLabelStyle.size===0;if(C){const M=L5(l,this);this.isStyleLocalized=Object.keys(M.localized).length>0}for(const M of l){if(M.type!=="symbol")continue;const D=M,O=this.getSource(D.source);if(!O||!("url"in O&&typeof O.url=="string")||new URL(O.url).host!==Yi.maptilerApiHost)continue;const{id:Z,layout:$}=D;if(!$||!("text-field"in $))continue;let ne;if(C?(ne=this.getLayoutProperty(Z,"text-field"),this.originalLabelStyle.set(Z,ne)):ne=this.originalLabelStyle.get(Z),typeof ne=="string"){const{contains:fe,exactMatch:Ee}=A5(ne,this.isStyleLocalized);if(!fe)continue;if(Ee)this.setLayoutProperty(Z,"text-field",f);else{const _e=I5(ne,f,this.isStyleLocalized);this.setLayoutProperty(Z,"text-field",_e)}}else{const fe=M5(ne,f,this.isStyleLocalized);this.setLayoutProperty(Z,"text-field",fe)}}this.languageIsUpdated=!0}getPrimaryLanguage(){return this.primaryLanguage}getTerrainExaggeration(){return this.terrainExaggeration}hasTerrain(){return this.isTerrainEnabled}growTerrain(r){if(!this.terrain)return;const s=performance.now(),p=this.terrain.exaggeration,m=r-p,b=()=>{if(!this.terrain||this.terrainFlattening)return;const f=(performance.now()-s)/this.terrainAnimationDuration;if(f<.99){const l=1-(1-f)**4,C=p+l*m;this.terrain.exaggeration=C,requestAnimationFrame(b)}else this.terrainGrowing=!1,this.terrainFlattening=!1,this.terrain.exaggeration=r,this.fire("terrainAnimationStop",{terrain:this.terrain});this._elevationFreeze=!1,this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!0,this.terrainFlattening=!1,requestAnimationFrame(b)}enableTerrain(r=this.terrainExaggeration){if(r<0){console.warn("Terrain exaggeration cannot be negative.");return}const s=m=>{!this.terrain||m.type!=="data"||m.dataType!=="source"||!("source"in m)||m.sourceId!=="maptiler-terrain"||m.source.type!=="raster-dem"||m.isSourceLoaded&&(this.off("data",s),this.growTerrain(r))},p=()=>{this.isTerrainEnabled=!0,this.terrainExaggeration=r,this.on("data",s),this.addSource(Yi.terrainSourceId,{type:"raster-dem",url:Yi.terrainSourceURL}),this.setTerrain({source:Yi.terrainSourceId,exaggeration:0})};if(this.getTerrain()){this.isTerrainEnabled=!0,this.growTerrain(r);return}if(this.loaded()||this.isTerrainEnabled)p();else{const m=()=>{this.getTerrain()&&this.getSource(Yi.terrainSourceId)||p()};this.once("load",()=>{m()}),this.once("moveend",()=>{m()})}}disableTerrain(){if(!this.terrain)return;this.isTerrainEnabled=!1;const r=performance.now(),s=this.terrain.exaggeration,p=()=>{if(!this.terrain||this.terrainGrowing)return;const m=(performance.now()-r)/this.terrainAnimationDuration;if(this._elevationFreeze=!1,m<.99){const b=(1-m)**4,f=s*b;this.terrain.exaggeration=f,requestAnimationFrame(p)}else this.terrain.exaggeration=0,this.terrainGrowing=!1,this.terrainFlattening=!1,this.setTerrain(),this.getSource(Yi.terrainSourceId)&&this.removeSource(Yi.terrainSourceId),this.fire("terrainAnimationStop",{terrain:null});this.triggerRepaint()};!this.terrainGrowing&&!this.terrainFlattening&&this.fire("terrainAnimationStart",{terrain:this.terrain}),this.terrainGrowing=!1,this.terrainFlattening=!0,requestAnimationFrame(p)}setTerrainExaggeration(r,s=!0){!s&&this.terrain?(this.terrainExaggeration=r,this.terrain.exaggeration=r,this.triggerRepaint()):this.enableTerrain(r)}onStyleReady(r){this.isStyleLoaded()?r():this.once("styledata",()=>{r()})}async fitToIpBounds(){const r=await Sv.info();this.fitBounds(r.country_bounds,{duration:0,padding:100})}async centerOnIpPoint(r){const s=await Sv.info();this.jumpTo({center:[s.longitude??0,s.latitude??0],zoom:r||11})}getCameraHash(){const r=new Float32Array(5),s=this.getCenter();return r[0]=s.lng,r[1]=s.lat,r[2]=this.getZoom(),r[3]=this.getPitch(),r[4]=this.getBearing(),f5.fromUint8Array(new Uint8Array(r.buffer))}getSdkConfig(){return ci}getMaptilerSessionId(){return Ey}setTransformRequest(r){return super.setTransformRequest(jv(r)),this}isGlobeProjection(){const r=this.getProjection();return r?r.type==="globe":!1}enableGlobeProjection(){this.isGlobeProjection()!==!0&&(this.setProjection({type:"globe"}),this.curentProjection="globe")}enableMercatorProjection(){this.isGlobeProjection()!==!1&&(this.setProjection({type:"mercator"}),this.curentProjection="mercator")}isLanguageUpdated(){return this.languageIsUpdated}};ct.Evented;function Ed(i){const r=i.toString(16);return r.length===1?`0${r}`:r}function aA(i){return`#${Ed(i[0])}${Ed(i[1])}${Ed(i[2])}${i.length===4?Ed(i[3]):""}`}let _t=class Bc extends Array{constructor(r={}){super(),Je(this,"min",0),Je(this,"max",1),"min"in r&&(this.min=r.min),"max"in r&&(this.max=r.max),"stops"in r&&this.setStops(r.stops,{clone:!1})}static fromArrayDefinition(r){return new Bc({stops:r.map(s=>({value:s[0],color:s[1]}))})}setStops(r,s={clone:!0}){const p=s.clone?this.clone():this;p.length=0;let m=Number.POSITIVE_INFINITY,b=Number.NEGATIVE_INFINITY;for(let f=0;f<r.length;f+=1)m=Math.min(m,r[f].value),b=Math.max(b,r[f].value),p.push({value:r[f].value,color:r[f].color.slice()});return p.sort((f,l)=>f.value<l.value?-1:1),this.min=m,this.max=b,p}scale(r,s,p={clone:!0}){const m=p.clone,b=this[0].value,f=this.at(-1).value-b,l=s-r,C=[];for(let M=0;M<this.length;M+=1){const D=(this[M].value-b)/f*l+r;m?C.push({value:D,color:this[M].color.slice()}):this[M].value=D}return m?new Bc({stops:C}):this}at(r){return r<0?this[this.length+r]:this[r]}clone(){return new Bc({stops:this.getRawColorStops()})}getRawColorStops(){const r=[];for(let s=0;s<this.length;s+=1)r.push({value:this[s].value,color:this[s].color});return r}reverse(r={clone:!0}){const s=r.clone?this.clone():this;for(let p=0;p<~~(s.length/2);p+=1){const m=s[p].color;s[p].color=s.at(-(p+1)).color,s.at(-(p+1)).color=m}return s}getBounds(){return{min:this.min,max:this.max}}getColor(r,s={smooth:!0}){if(r<=this[0].value)return this[0].color;if(r>=this.at(-1).value)return this.at(-1).color;for(let p=0;p<this.length-1;p+=1){if(r>this[p+1].value)continue;const m=this[p].color;if(!s.smooth)return m.slice();const b=this[p].value,f=this[p+1].value,l=this[p+1].color,C=(f-r)/(f-b);return m.map((M,D)=>Math.round(M*C+l[D]*(1-C)))}return[0,0,0]}getColorHex(r,s={smooth:!0,withAlpha:!1}){return aA(this.getColor(r,s))}getColorRelative(r,s={smooth:!0}){const p=this.getBounds();return this.getColor(p.min+r*(p.max-p.min),s)}getCanvasStrip(r={horizontal:!0,size:512,smooth:!0}){const s=document.createElement("canvas");s.width=r.horizontal?r.size:1,s.height=r.horizontal?1:r.size;const p=s.getContext("2d");if(!p)throw new Error("Canvs context is missing");const m=p.getImageData(0,0,s.width,s.height),b=m.data,f=r.size,l=this[0].value,C=(this.at(-1).value-l)/f;for(let M=0;M<f;M+=1){const D=this.getColor(l+M*C,{smooth:r.smooth});b[M*4]=D[0],b[M*4+1]=D[1],b[M*4+2]=D[2],b[M*4+3]=D.length>3?D[3]:255}return p.putImageData(m,0,0),s}resample(r,s=15){const p=this.getBounds(),m=this.scale(0,1),b=1/(s-1);let f;if(r==="ease-in-square")f=Array.from({length:s},(l,C)=>{const M=C*b,D=M**2,O=m.getColor(D);return{value:M,color:O}});else if(r==="ease-out-square")f=Array.from({length:s},(l,C)=>{const M=C*b,D=1-(1-M)**2,O=m.getColor(D);return{value:M,color:O}});else if(r==="ease-out-sqrt")f=Array.from({length:s},(l,C)=>{const M=C*b,D=M**.5,O=m.getColor(D);return{value:M,color:O}});else if(r==="ease-in-sqrt")f=Array.from({length:s},(l,C)=>{const M=C*b,D=1-(1-M)**.5,O=m.getColor(D);return{value:M,color:O}});else if(r==="ease-out-exp")f=Array.from({length:s},(l,C)=>{const M=C*b,D=1-2**(-10*M),O=m.getColor(D);return{value:M,color:O}});else if(r==="ease-in-exp")f=Array.from({length:s},(l,C)=>{const M=C*b,D=2**(10*M-10),O=m.getColor(D);return{value:M,color:O}});else throw new Error("Invalid ressampling method.");return new Bc({stops:f}).scale(p.min,p.max)}transparentStart(){const r=this.getRawColorStops();r.unshift({value:r[0].value,color:r[0].color.slice()}),r[1].value+=.001;for(const s of r)s.color.length===3&&s.color.push(255);return r[0].color[3]=0,new Bc({stops:r})}hasTransparentStart(){return this[0].color.length===4&&this[0].color[3]===0}};new _t({stops:[{value:0,color:[0,0,0,0]},{value:1,color:[0,0,0,0]}]}),new _t({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),new _t({stops:[{value:0,color:[0,0,131]},{value:.125,color:[0,60,170]},{value:.375,color:[5,255,255]},{value:.625,color:[255,255,0]},{value:.875,color:[250,0,0]},{value:1,color:[128,0,0]}]}),new _t({stops:[{value:0,color:[255,0,0]},{value:.169,color:[253,255,2]},{value:.173,color:[247,255,2]},{value:.337,color:[0,252,4]},{value:.341,color:[0,252,10]},{value:.506,color:[1,249,255]},{value:.671,color:[2,0,253]},{value:.675,color:[8,0,253]},{value:.839,color:[255,0,251]},{value:.843,color:[255,0,245]},{value:1,color:[255,0,6]}]}),new _t({stops:[{value:0,color:[0,0,0]},{value:.3,color:[230,0,0]},{value:.6,color:[255,210,0]},{value:1,color:[255,255,255]}]}),new _t({stops:[{value:0,color:[255,0,255]},{value:1,color:[255,255,0]}]}),new _t({stops:[{value:0,color:[0,128,102]},{value:1,color:[255,255,102]}]}),new _t({stops:[{value:0,color:[255,0,0]},{value:1,color:[255,255,0]}]}),new _t({stops:[{value:0,color:[0,0,255]},{value:1,color:[0,255,128]}]}),new _t({stops:[{value:0,color:[0,0,0]},{value:.376,color:[84,84,116]},{value:.753,color:[169,200,200]},{value:1,color:[255,255,255]}]}),new _t({stops:[{value:0,color:[0,0,0]},{value:.804,color:[255,160,102]},{value:1,color:[255,199,127]}]}),new _t({stops:[{value:0,color:[0,0,0]},{value:1,color:[255,255,255]}]}),new _t({stops:[{value:0,color:[8,29,88]},{value:.125,color:[37,52,148]},{value:.25,color:[34,94,168]},{value:.375,color:[29,145,192]},{value:.5,color:[65,182,196]},{value:.625,color:[127,205,187]},{value:.75,color:[199,233,180]},{value:.875,color:[237,248,217]},{value:1,color:[255,255,217]}]}),new _t({stops:[{value:0,color:[0,68,27]},{value:.125,color:[0,109,44]},{value:.25,color:[35,139,69]},{value:.375,color:[65,171,93]},{value:.5,color:[116,196,118]},{value:.625,color:[161,217,155]},{value:.75,color:[199,233,192]},{value:.875,color:[229,245,224]},{value:1,color:[247,252,245]}]}),new _t({stops:[{value:0,color:[128,0,38]},{value:.125,color:[189,0,38]},{value:.25,color:[227,26,28]},{value:.375,color:[252,78,42]},{value:.5,color:[253,141,60]},{value:.625,color:[254,178,76]},{value:.75,color:[254,217,118]},{value:.875,color:[255,237,160]},{value:1,color:[255,255,204]}]}),new _t({stops:[{value:0,color:[0,0,255]},{value:1,color:[255,0,0]}]}),new _t({stops:[{value:0,color:[5,10,172]},{value:.35,color:[106,137,247]},{value:.5,color:[190,190,190]},{value:.6,color:[220,170,132]},{value:.7,color:[230,145,90]},{value:1,color:[178,10,28]}]}),new _t({stops:[{value:0,color:[0,0,255]},{value:.1,color:[51,153,255]},{value:.2,color:[102,204,255]},{value:.3,color:[153,204,255]},{value:.4,color:[204,204,255]},{value:.5,color:[255,255,255]},{value:.6,color:[255,204,255]},{value:.7,color:[255,153,255]},{value:.8,color:[255,102,204]},{value:.9,color:[255,102,102]},{value:1,color:[255,0,0]}]}),new _t({stops:[{value:0,color:[150,0,90]},{value:.125,color:[0,0,200]},{value:.25,color:[0,25,255]},{value:.375,color:[0,152,255]},{value:.5,color:[44,255,150]},{value:.625,color:[151,255,0]},{value:.75,color:[255,234,0]},{value:.875,color:[255,111,0]},{value:1,color:[255,0,0]}]}),new _t({stops:[{value:0,color:[12,51,131]},{value:.25,color:[10,136,186]},{value:.5,color:[242,211,56]},{value:.75,color:[242,143,56]},{value:1,color:[217,30,30]}]}),new _t({stops:[{value:0,color:[0,0,0]},{value:.2,color:[230,0,0]},{value:.4,color:[230,210,0]},{value:.7,color:[255,255,255]},{value:1,color:[160,200,255]}]}),new _t({stops:[{value:0,color:[0,0,130]},{value:.1,color:[0,180,180]},{value:.2,color:[40,210,40]},{value:.4,color:[230,230,50]},{value:.6,color:[120,70,20]},{value:1,color:[255,255,255]}]}),new _t({stops:[{value:0,color:[0,0,0]},{value:.15,color:[30,0,100]},{value:.4,color:[120,0,100]},{value:.6,color:[160,90,0]},{value:.8,color:[230,200,0]},{value:1,color:[255,250,220]}]}),new _t({stops:[{value:0,color:[68,1,84]},{value:.13,color:[71,44,122]},{value:.25,color:[59,81,139]},{value:.38,color:[44,113,142]},{value:.5,color:[33,144,141]},{value:.63,color:[39,173,129]},{value:.75,color:[92,200,99]},{value:.88,color:[170,220,50]},{value:1,color:[253,231,37]}]}),new _t({stops:[{value:0,color:[0,0,4]},{value:.13,color:[31,12,72]},{value:.25,color:[85,15,109]},{value:.38,color:[136,34,106]},{value:.5,color:[186,54,85]},{value:.63,color:[227,89,51]},{value:.75,color:[249,140,10]},{value:.88,color:[249,201,50]},{value:1,color:[252,255,164]}]}),new _t({stops:[{value:0,color:[0,0,4]},{value:.13,color:[28,16,68]},{value:.25,color:[79,18,123]},{value:.38,color:[129,37,129]},{value:.5,color:[181,54,122]},{value:.63,color:[229,80,100]},{value:.75,color:[251,135,97]},{value:.88,color:[254,194,135]},{value:1,color:[252,253,191]}]}),new _t({stops:[{value:0,color:[13,8,135]},{value:.13,color:[75,3,161]},{value:.25,color:[125,3,168]},{value:.38,color:[168,34,150]},{value:.5,color:[203,70,121]},{value:.63,color:[229,107,93]},{value:.75,color:[248,148,65]},{value:.88,color:[253,195,40]},{value:1,color:[240,249,33]}]}),new _t({stops:[{value:0,color:[125,0,179]},{value:.13,color:[172,0,187]},{value:.25,color:[219,0,170]},{value:.38,color:[255,0,130]},{value:.5,color:[255,63,74]},{value:.63,color:[255,123,0]},{value:.75,color:[234,176,0]},{value:.88,color:[190,228,0]},{value:1,color:[147,255,0]}]}),new _t({stops:[{value:0,color:[125,0,179]},{value:.13,color:[116,0,218]},{value:.25,color:[98,74,237]},{value:.38,color:[68,146,231]},{value:.5,color:[0,204,197]},{value:.63,color:[0,247,146]},{value:.75,color:[0,255,88]},{value:.88,color:[40,255,8]},{value:1,color:[147,255,0]}]}),new _t({stops:[{value:0,color:[125,0,179]},{value:.1,color:[199,0,180]},{value:.2,color:[255,0,121]},{value:.3,color:[255,108,0]},{value:.4,color:[222,194,0]},{value:.5,color:[150,255,0]},{value:.6,color:[0,255,55]},{value:.7,color:[0,246,150]},{value:.8,color:[50,167,222]},{value:.9,color:[103,51,235]},{value:1,color:[124,0,186]}]}),new _t({stops:[{value:0,color:[40,26,44]},{value:.13,color:[59,49,90]},{value:.25,color:[64,76,139]},{value:.38,color:[63,110,151]},{value:.5,color:[72,142,158]},{value:.63,color:[85,174,163]},{value:.75,color:[120,206,163]},{value:.88,color:[187,230,172]},{value:1,color:[253,254,204]}]}),new _t({stops:[{value:0,color:[47,15,62]},{value:.13,color:[87,23,86]},{value:.25,color:[130,28,99]},{value:.38,color:[171,41,96]},{value:.5,color:[206,67,86]},{value:.63,color:[230,106,84]},{value:.75,color:[242,149,103]},{value:.88,color:[249,193,135]},{value:1,color:[254,237,176]}]}),new _t({stops:[{value:0,color:[18,36,20]},{value:.13,color:[25,63,41]},{value:.25,color:[24,91,59]},{value:.38,color:[13,119,72]},{value:.5,color:[18,148,80]},{value:.63,color:[80,173,89]},{value:.75,color:[132,196,122]},{value:.88,color:[175,221,162]},{value:1,color:[215,249,208]}]}),new _t({stops:[{value:0,color:[54,14,36]},{value:.13,color:[89,23,80]},{value:.25,color:[110,45,132]},{value:.38,color:[120,77,178]},{value:.5,color:[120,113,213]},{value:.63,color:[115,151,228]},{value:.75,color:[134,185,227]},{value:.88,color:[177,214,227]},{value:1,color:[230,241,241]}]}),new _t({stops:[{value:0,color:[30,4,110]},{value:.13,color:[47,14,176]},{value:.25,color:[41,45,236]},{value:.38,color:[25,99,212]},{value:.5,color:[68,131,200]},{value:.63,color:[114,156,197]},{value:.75,color:[157,181,203]},{value:.88,color:[200,208,216]},{value:1,color:[241,237,236]}]}),new _t({stops:[{value:0,color:[60,9,18]},{value:.13,color:[100,17,27]},{value:.25,color:[142,20,29]},{value:.38,color:[177,43,27]},{value:.5,color:[192,87,63]},{value:.63,color:[205,125,105]},{value:.75,color:[216,162,148]},{value:.88,color:[227,199,193]},{value:1,color:[241,237,236]}]}),new _t({stops:[{value:0,color:[64,5,5]},{value:.13,color:[106,6,15]},{value:.25,color:[144,26,7]},{value:.38,color:[168,64,3]},{value:.5,color:[188,100,4]},{value:.63,color:[206,136,11]},{value:.75,color:[220,174,25]},{value:.88,color:[231,215,44]},{value:1,color:[248,254,105]}]}),new _t({stops:[{value:0,color:[51,20,24]},{value:.13,color:[90,32,35]},{value:.25,color:[129,44,34]},{value:.38,color:[159,68,25]},{value:.5,color:[182,99,19]},{value:.63,color:[199,134,22]},{value:.75,color:[212,171,35]},{value:.88,color:[221,210,54]},{value:1,color:[225,253,75]}]}),new _t({stops:[{value:0,color:[145,105,18]},{value:.13,color:[184,71,38]},{value:.25,color:[186,58,115]},{value:.38,color:[160,71,185]},{value:.5,color:[110,97,218]},{value:.63,color:[50,123,164]},{value:.75,color:[31,131,110]},{value:.88,color:[77,129,34]},{value:1,color:[145,105,18]}]}),new _t({stops:[{value:0,color:[42,24,108]},{value:.13,color:[33,50,162]},{value:.25,color:[15,90,145]},{value:.38,color:[40,118,137]},{value:.5,color:[59,146,135]},{value:.63,color:[79,175,126]},{value:.75,color:[120,203,104]},{value:.88,color:[193,221,100]},{value:1,color:[253,239,154]}]}),new _t({stops:[{value:0,color:[4,35,51]},{value:.13,color:[23,51,122]},{value:.25,color:[85,59,157]},{value:.38,color:[129,79,143]},{value:.5,color:[175,95,130]},{value:.63,color:[222,112,101]},{value:.75,color:[249,146,66]},{value:.88,color:[249,196,65]},{value:1,color:[232,250,91]}]}),new _t({stops:[{value:0,color:[34,31,27]},{value:.13,color:[65,50,41]},{value:.25,color:[98,69,52]},{value:.38,color:[131,89,57]},{value:.5,color:[161,112,59]},{value:.63,color:[185,140,66]},{value:.75,color:[202,174,88]},{value:.88,color:[216,209,126]},{value:1,color:[233,246,171]}]}),new _t({stops:[{value:0,color:[17,32,64]},{value:.13,color:[35,52,116]},{value:.25,color:[29,81,156]},{value:.38,color:[31,113,162]},{value:.5,color:[50,144,169]},{value:.63,color:[87,173,176]},{value:.75,color:[149,196,189]},{value:.88,color:[203,221,211]},{value:1,color:[254,251,230]}]}),new _t({stops:[{value:0,color:[23,35,19]},{value:.13,color:[24,64,38]},{value:.25,color:[11,95,45]},{value:.38,color:[39,123,35]},{value:.5,color:[95,146,12]},{value:.63,color:[152,165,18]},{value:.75,color:[201,186,69]},{value:.88,color:[233,216,137]},{value:1,color:[255,253,205]}]}),new _t({stops:[{value:0,color:[0,0,0]},{value:.07,color:[22,5,59]},{value:.13,color:[60,4,105]},{value:.2,color:[109,1,135]},{value:.27,color:[161,0,147]},{value:.33,color:[210,2,142]},{value:.4,color:[251,11,123]},{value:.47,color:[255,29,97]},{value:.53,color:[255,54,69]},{value:.6,color:[255,85,46]},{value:.67,color:[255,120,34]},{value:.73,color:[255,157,37]},{value:.8,color:[241,191,57]},{value:.87,color:[224,220,93]},{value:.93,color:[218,241,142]},{value:1,color:[227,253,198]}]}),new _t({stops:[{value:0,color:[0,32,77,255]},{value:.125,color:[5,54,110,255]},{value:.25,color:[65,77,108,255]},{value:.375,color:[97,100,111,255]},{value:.5,color:[125,124,121,255]},{value:.625,color:[156,149,120,255]},{value:.75,color:[190,175,111,255]},{value:.875,color:[225,204,94,255]},{value:1,color:[255,235,70,255]}]}),new _t({stops:[{value:0,color:[48,18,59,255]},{value:.125,color:[70,107,227,255]},{value:.25,color:[40,187,236,255]},{value:.375,color:[49,242,153,255]},{value:.5,color:[162,252,60,255]},{value:.625,color:[237,208,58,255]},{value:.75,color:[251,128,34,255]},{value:.875,color:[210,49,5,255]},{value:1,color:[122,4,3,255]}]}),new _t({stops:[{value:0,color:[250,235,221,0]},{value:.133,color:[250,235,221,255]},{value:.266,color:[246,170,130,255]},{value:.4,color:[240,96,67,255]},{value:.533,color:[203,27,79,255]},{value:.666,color:[132,30,90,255]},{value:.8,color:[63,27,68,255]},{value:1,color:[3,5,26,255]}]}),new _t({stops:[{value:0,color:[11,4,5,255]},{value:.125,color:[43,28,53,255]},{value:.25,color:[62,53,107,255]},{value:.375,color:[59,86,152,255]},{value:.5,color:[53,123,162,255]},{value:.625,color:[53,158,170,255]},{value:.75,color:[73,193,173,255]},{value:.875,color:[150,221,181,255]},{value:1,color:[222,245,229,255]}]});S5();function oA(){return"3.8.0"}ct.Map;ct.Marker;ct.Popup;ct.Style;ct.CanvasSource;ct.GeoJSONSource;ct.ImageSource;ct.RasterTileSource;ct.RasterDEMTileSource;ct.VectorTileSource;ct.VideoSource;ct.NavigationControl;ct.GeolocateControl;ct.AttributionControl;ct.LogoControl;ct.ScaleControl;ct.FullscreenControl;ct.TerrainControl;ct.BoxZoomHandler;ct.ScrollZoomHandler;ct.CooperativeGesturesHandler;ct.KeyboardHandler;ct.TwoFingersTouchPitchHandler;ct.MapWheelEvent;ct.MapTouchEvent;ct.MapMouseEvent;ct.config;ct.getVersion;const{setRTLTextPlugin:q3,getRTLTextPluginStatus:G3,LngLat:Z3,LngLatBounds:W3,MercatorCoordinate:H3,Evented:X3,AJAXError:K3,prewarm:Y3,clearPrewarmedResources:J3,Hash:Q3,Point:eR,EdgeInsets:tR,DragRotateHandler:rR,DragPanHandler:iR,TwoFingersTouchZoomRotateHandler:nR,DoubleClickZoomHandler:aR,TwoFingersTouchZoomHandler:oR,TwoFingersTouchRotateHandler:sR,getWorkerCount:lR,setWorkerCount:cR,getMaxParallelImageRequests:uR,setMaxParallelImageRequests:hR,getWorkerUrl:pR,setWorkerUrl:dR,addSourceType:fR,importScriptInWorkers:mR,addProtocol:gR,removeProtocol:yR}=ct;var sA=Object.defineProperty,lA=(i,r,s)=>r in i?sA(i,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[r]=s,pa=(i,r,s)=>(lA(i,typeof r!="symbol"?r+"":r,s),s),cA=8,uA={version:{required:!0,type:"enum",values:[8],doc:"Style specification version number. Must be 8.",example:8},name:{type:"string",doc:"A human-readable name for the style.",example:"Bright"},metadata:{type:"*",doc:"Arbitrary properties useful to track with the stylesheet, but do not influence rendering. Properties should be prefixed to avoid collisions, like 'mapbox:'."},center:{type:"array",value:"number",doc:"Default map center in longitude and latitude.  The style center will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:[-73.9749,40.7736]},zoom:{type:"number",doc:"Default zoom level.  The style zoom will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:12.5},bearing:{type:"number",default:0,period:360,units:"degrees",doc:'Default bearing, in degrees. The bearing is the compass direction that is "up"; for example, a bearing of 90 orients the map so that east is up. This value will be used only if the map has not been positioned by other means (e.g. map options or user interaction).',example:29},pitch:{type:"number",default:0,units:"degrees",doc:"Default pitch, in degrees. Zero is perpendicular to the surface, for a look straight down at the map, while a greater value like 60 looks ahead towards the horizon. The style pitch will be used only if the map has not been positioned by other means (e.g. map options or user interaction).",example:50},light:{type:"light",doc:"The global light source.",example:{anchor:"viewport",color:"white",intensity:.4}},terrain:{type:"terrain",doc:"A global modifier that elevates layers and markers based on a DEM data source."},fog:{type:"fog",doc:"A global effect that fades layers and markers based on their distance to the camera. The fog can be used to approximate the effect of atmosphere on distant objects and enhance the depth perception of the map when used with terrain or 3D features. Note: fog is renamed to atmosphere in the Android and iOS SDKs and planned to be changed in GL-JS v.3.0.0."},sources:{required:!0,type:"sources",doc:"Data source specifications.",example:{"mapbox-streets":{type:"vector",url:"mapbox://mapbox.mapbox-streets-v6"}}},sprite:{type:"string",doc:"A base URL for retrieving the sprite image and metadata. The extensions `.png`, `.json` and scale factor `@2x.png` will be automatically appended. This property is required if any layer uses the `background-pattern`, `fill-pattern`, `line-pattern`, `fill-extrusion-pattern`, or `icon-image` properties. The URL must be absolute, containing the [scheme, authority and path components](https://en.wikipedia.org/wiki/URL#Syntax).",example:"mapbox://sprites/mapbox/bright-v8"},glyphs:{type:"string",doc:"A URL template for loading signed-distance-field glyph sets in PBF format. The URL must include `{fontstack}` and `{range}` tokens. This property is required if any layer uses the `text-field` layout property. The URL must be absolute, containing the [scheme, authority and path components](https://en.wikipedia.org/wiki/URL#Syntax).",example:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},transition:{type:"transition",doc:"A global transition definition to use as a default across properties, to be used for timing transitions between one value and the next when no property-specific transition is set. Collision-based symbol fading is controlled independently of the style's `transition` property.",example:{duration:300,delay:0}},projection:{type:"projection",doc:"The projection the map should be rendered in. Supported projections are Mercator, Globe, Albers, Equal Earth, Equirectangular (WGS84), Lambert conformal conic, Natural Earth, and Winkel Tripel. Terrain, sky and fog are supported by only Mercator and globe. CustomLayerInterface is not supported outside of Mercator.",example:{name:"albers",center:[-154,50],parallels:[55,65]}},layers:{required:!0,type:"array",value:"layer",doc:"Layers will be drawn in the order of this array.",example:[{id:"water",source:"mapbox-streets","source-layer":"water",type:"fill",paint:{"fill-color":"#00ffff"}}]}},hA={"*":{type:"source",doc:"Specification of a data source. For vector and raster sources, either TileJSON or a URL to a TileJSON must be provided. For image and video sources, a URL must be provided. For GeoJSON sources, a URL or inline GeoJSON must be provided."}},pA=["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],dA={type:{required:!0,type:"enum",values:{vector:{doc:"A vector tile source."}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},scheme:{type:"enum",values:{xyz:{doc:"Slippy map tilenames scheme."},tms:{doc:"OSGeo spec scheme."}},default:"xyz",doc:"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},promoteId:{type:"promoteId",doc:"A property to use as a feature id (for feature state). Either a property name, or an object of the form `{<sourceLayer>: <propertyName>}`. If specified as a string for a vector tile source, the same property is used across all its source layers. If specified as an object only specified source layers will have id overriden, others will fallback to original feature id"},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},fA={type:{required:!0,type:"enum",values:{raster:{doc:"A raster tile source."}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",default:512,units:"pixels",doc:"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},scheme:{type:"enum",values:{xyz:{doc:"Slippy map tilenames scheme."},tms:{doc:"OSGeo spec scheme."}},default:"xyz",doc:"Influences the y direction of the tile coordinates. The global-mercator (aka Spherical Mercator) profile is assumed."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},mA={type:{required:!0,type:"enum",values:{"raster-dem":{doc:"A RGB-encoded raster DEM source"}},doc:"The type of the source."},url:{type:"string",doc:"A URL to a TileJSON resource. Supported protocols are `http:`, `https:`, and `mapbox://<Tileset ID>`."},tiles:{type:"array",value:"string",doc:"An array of one or more tile source URLs, as in the TileJSON spec."},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129],doc:"An array containing the longitude and latitude of the southwest and northeast corners of the source's bounding box in the following order: `[sw.lng, sw.lat, ne.lng, ne.lat]`. When this property is included in a source, no tiles outside of the given bounds are requested by Mapbox GL."},minzoom:{type:"number",default:0,doc:"Minimum zoom level for which tiles are available, as in the TileJSON spec."},maxzoom:{type:"number",default:22,doc:"Maximum zoom level for which tiles are available, as in the TileJSON spec. Data from tiles at the maxzoom are used when displaying the map at higher zoom levels."},tileSize:{type:"number",default:512,units:"pixels",doc:"The minimum visual size to display tiles for this layer. Only configurable for raster layers."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},encoding:{type:"enum",values:{terrarium:{doc:"Terrarium format PNG tiles. See https://aws.amazon.com/es/public-datasets/terrain/ for more info."},mapbox:{doc:"Mapbox Terrain RGB tiles. See https://www.mapbox.com/help/access-elevation-data/#mapbox-terrain-rgb for more info."}},default:"mapbox",doc:"The encoding used by this source. Mapbox Terrain RGB is used by default"},volatile:{type:"boolean",default:!1,doc:"A setting to determine whether a source's tiles are cached locally.","sdk-support":{"basic functionality":{android:"9.3.0",ios:"5.10.0"}}},"*":{type:"*",doc:"Other keys to configure the data source."}},gA={type:{required:!0,type:"enum",values:{geojson:{doc:"A GeoJSON data source."}},doc:"The data type of the GeoJSON source."},data:{type:"*",doc:"A URL to a GeoJSON file, or inline GeoJSON."},maxzoom:{type:"number",default:18,doc:"Maximum zoom level at which to create vector tiles (higher means greater detail at high zoom levels)."},attribution:{type:"string",doc:"Contains an attribution to be displayed when the map is shown to a user."},buffer:{type:"number",default:128,maximum:512,minimum:0,doc:"Size of the tile buffer on each side. A value of 0 produces no buffer. A value of 512 produces a buffer as wide as the tile itself. Larger values produce fewer rendering artifacts near tile edges and slower performance."},filter:{type:"*",doc:"An expression for filtering features prior to processing them for rendering."},tolerance:{type:"number",default:.375,doc:"Douglas-Peucker simplification tolerance (higher means simpler geometries and faster performance)."},cluster:{type:"boolean",default:!1,doc:"If the data is a collection of point features, setting this to true clusters the points by radius into groups. Cluster groups become new `Point` features in the source with additional properties:\n * `cluster` Is `true` if the point is a cluster \n * `cluster_id` A unqiue id for the cluster to be used in conjunction with the [cluster inspection methods](https://www.mapbox.com/mapbox-gl-js/api/#geojsonsource#getclusterexpansionzoom)\n * `point_count` Number of original points grouped into this cluster\n * `point_count_abbreviated` An abbreviated point count"},clusterRadius:{type:"number",default:50,minimum:0,doc:"Radius of each cluster if clustering is enabled. A value of 512 indicates a radius equal to the width of a tile."},clusterMaxZoom:{type:"number",doc:"Max zoom on which to cluster points if clustering is enabled. Defaults to one zoom less than maxzoom (so that last zoom features are not clustered). Clusters are re-evaluated at integer zoom levels so setting clusterMaxZoom to 14 means the clusters will be displayed until z15."},clusterMinPoints:{type:"number",doc:"Minimum number of points necessary to form a cluster if clustering is enabled. Defaults to `2`."},clusterProperties:{type:"*",doc:'An object defining custom properties on the generated clusters if clustering is enabled, aggregating values from clustered points. Has the form `{"property_name": [operator, map_expression]}`. `operator` is any expression function that accepts at least 2 operands (e.g. `"+"` or `"max"`)  it accumulates the property value from clusters/points the cluster contains; `map_expression` produces the value of a single point.\n\nExample: `{"sum": ["+", ["get", "scalerank"]]}`.\n\nFor more advanced use cases, in place of `operator`, you can use a custom reduce expression that references a special `["accumulated"]` value, e.g.:\n`{"sum": [["+", ["accumulated"], ["get", "sum"]], ["get", "scalerank"]]}`'},lineMetrics:{type:"boolean",default:!1,doc:"Whether to calculate line distance metrics. This is required for line layers that specify `line-gradient` values."},generateId:{type:"boolean",default:!1,doc:"Whether to generate ids for the geojson features. When enabled, the `feature.id` property will be auto assigned based on its index in the `features` array, over-writing any previous values."},promoteId:{type:"promoteId",doc:"A property to use as a feature id (for feature state). Either a property name, or an object of the form `{<sourceLayer>: <propertyName>}`."}},yA={type:{required:!0,type:"enum",values:{video:{doc:"A video data source."}},doc:"The data type of the video source."},urls:{required:!0,type:"array",value:"string",doc:"URLs to video content in order of preferred format."},coordinates:{required:!0,doc:"Corners of video specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number",doc:"A single longitude, latitude pair."}}},_A={type:{required:!0,type:"enum",values:{image:{doc:"An image data source."}},doc:"The data type of the image source."},url:{required:!0,type:"string",doc:"URL that points to an image."},coordinates:{required:!0,doc:"Corners of image specified in longitude, latitude pairs.",type:"array",length:4,value:{type:"array",length:2,value:"number",doc:"A single longitude, latitude pair."}}},vA={id:{type:"string",doc:"Unique layer name.",required:!0},type:{type:"enum",values:{fill:{doc:"A filled polygon with an optional stroked border.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},line:{doc:"A stroked line.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},symbol:{doc:"An icon or a text label.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},circle:{doc:"A filled circle.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},heatmap:{doc:"A heatmap.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"fill-extrusion":{doc:"An extruded (3D) polygon.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},raster:{doc:"Raster map textures such as satellite imagery.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},hillshade:{doc:"Client-side hillshading visualization based on DEM data. Currently, the implementation only supports Mapbox Terrain RGB and Mapzen Terrarium tiles.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},background:{doc:"The background color or pattern of the map.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}}},sky:{doc:"A spherical dome around the map that is always rendered behind all other layers.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}}},doc:"Rendering type of this layer.",required:!0},metadata:{type:"*",doc:"Arbitrary properties useful to track with the layer, but do not influence rendering. Properties should be prefixed to avoid collisions, like 'mapbox:'."},source:{type:"string",doc:"Name of a source description to be used for this layer. Required for all layer types except `background`."},"source-layer":{type:"string",doc:"Layer to use from a vector tile source. Required for vector tile sources; prohibited for all other source types, including GeoJSON sources."},minzoom:{type:"number",minimum:0,maximum:24,doc:"The minimum zoom level for the layer. At zoom levels less than the minzoom, the layer will be hidden."},maxzoom:{type:"number",minimum:0,maximum:24,doc:"The maximum zoom level for the layer. At zoom levels equal to or greater than the maxzoom, the layer will be hidden."},filter:{type:"filter",doc:'An expression specifying conditions on source features. Only features that match the filter are displayed. Zoom expressions in filters are only evaluated at integer zoom levels. The `["feature-state", ...]` expression is not supported in filter expressions.  The `["pitch"]` and `["distance-from-center"]` expressions are supported only for filter expressions on the symbol layer.'},layout:{type:"layout",doc:"Layout properties for the layer."},paint:{type:"paint",doc:"Default paint properties for this layer."}},bA=["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],xA={visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},wA={visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"constant"}},TA={"fill-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"},"data-driven styling":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},SA={"circle-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.2.0",ios:"5.9.0",macos:"0.16.0"},"data-driven styling":{js:"1.2.0",android:"9.2.0",ios:"5.9.0",macos:"0.16.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},kA={visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},"property-type":"constant"}},CA={"line-cap":{type:"enum",values:{butt:{doc:"A cap with a squared-off end which is drawn to the exact endpoint of the line."},round:{doc:"A cap with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},square:{doc:"A cap with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."}},default:"butt",doc:"The display of line endings.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{doc:"A join with a squared-off end which is drawn beyond the endpoint of the line at a distance of one-half of the line's width."},round:{doc:"A join with a rounded end which is drawn beyond the endpoint of the line at a radius of one-half of the line's width and centered on the endpoint of the line."},miter:{doc:"A join with a sharp, angled corner which is drawn with the outer sides beyond the endpoint of the path until they meet."}},default:"miter",doc:"The display of lines when joining.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,doc:"Used to automatically convert miter joins to bevel joins for sharp angles.",requires:[{"line-join":"miter"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,doc:"Used to automatically convert round joins to miter joins for shallow angles.",requires:[{"line-join":"round"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with a higher sort key will appear above features with a lower sort key.","sdk-support":{"basic functionality":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"},"data-driven styling":{js:"1.2.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},PA={"symbol-placement":{type:"enum",values:{point:{doc:"The label is placed at the point where the geometry is located."},line:{doc:"The label is placed along the line of the geometry. Can only be used on `LineString` and `Polygon` geometries."},"line-center":{doc:"The label is placed at the center of the line of the geometry. Can only be used on `LineString` and `Polygon` geometries. Note that a single feature in a vector tile may contain multiple line geometries."}},default:"point",doc:"Label placement relative to its geometry.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`line-center` value":{js:"0.47.0",android:"6.4.0",ios:"4.3.0",macos:"0.10.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",doc:"Distance between two symbol anchors.",requires:[{"symbol-placement":"line"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,doc:"If true, the symbols will not cross tile edges to avoid mutual collisions. Recommended in layers that don't have enough padding in the vector tile to prevent collisions, or if it is a point symbol layer placed after a line symbol layer. When using a client that supports global collision detection, like Mapbox GL JS version 0.42.0 or greater, enabling this property is not needed to prevent clipped labels at tile boundaries.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",doc:"Sorts features in ascending order based on this value. Features with lower sort keys are drawn and placed first.  When `icon-allow-overlap` or `text-allow-overlap` is `false`, features with a lower sort key will have priority during placement. When `icon-allow-overlap` or `text-allow-overlap` is set to `true`, features with a higher sort key will overlap over features with a lower sort key.","sdk-support":{"basic functionality":{js:"0.53.0",android:"7.4.0",ios:"4.11.0",macos:"0.14.0"},"data-driven styling":{js:"0.53.0",android:"7.4.0",ios:"4.11.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{doc:"Sorts symbols by `symbol-sort-key` if set. Otherwise, sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},"viewport-y":{doc:"Sorts symbols by their y-position relative to the viewport if `icon-allow-overlap` or `text-allow-overlap` is set to `true` or `icon-ignore-placement` or `text-ignore-placement` is `false`."},source:{doc:"Sorts symbols by `symbol-sort-key` if set. Otherwise, no sorting is applied; symbols are rendered in the same order as the source data."}},default:"auto",doc:"Determines whether overlapping symbols in the same layer are rendered in the order that they appear in the data source or by their y-position relative to the viewport. To control the order and prioritization of symbols otherwise, use `symbol-sort-key`.","sdk-support":{"basic functionality":{js:"0.49.0",android:"6.6.0",ios:"4.5.0",macos:"0.12.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,doc:"If true, the icon will be visible even if it collides with other previously drawn symbols.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,doc:"If true, other symbols can be visible even if they collide with the icon.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,doc:"If true, text will display without their corresponding icons when the icon collides with other symbols and the text does not.",requires:["icon-image","text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{doc:"When `symbol-placement` is set to `point`, aligns icons east-west. When `symbol-placement` is set to `line` or `line-center`, aligns icon x-axes with the line."},viewport:{doc:"Produces icons whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{doc:"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto",doc:"In combination with `symbol-placement`, determines the rotation behavior of icons.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",doc:"Scales the original size of the icon by the provided factor. The new pixel size of the image will be the original pixel size multiplied by `icon-size`. 1 is the original size; 3 triples the size of the image.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{doc:"The icon is displayed at its intrinsic aspect ratio."},width:{doc:"The icon is scaled in the x-dimension to fit the width of the text."},height:{doc:"The icon is scaled in the y-dimension to fit the height of the text."},both:{doc:"The icon is scaled in both x- and y-dimensions."}},default:"none",doc:"Scales the icon to fit around the associated text.",requires:["icon-image","text-field"],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"},"stretchable icons":{js:"1.6.0",android:"9.2.0",ios:"5.8.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",doc:"Size of the additional area added to dimensions determined by `icon-text-fit`, in clockwise order: top, right, bottom, left.",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",doc:"Name of image in sprite to use for drawing an image background.",tokens:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",doc:"Rotates the icon clockwise.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.21.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",doc:"Size of the additional area around the icon bounding box used for detecting symbol collisions.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,doc:"If true, the icon may be flipped to prevent it from being rendered upside-down.",requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],doc:"Offset distance of icon from its anchor. Positive values indicate right and down, while negative values indicate left and up. Each component is multiplied by the value of `icon-size` to obtain the final offset in pixels. When combined with `icon-rotate` the offset will be as if the rotated direction was up.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{doc:"The center of the icon is placed closest to the anchor."},left:{doc:"The left side of the icon is placed closest to the anchor."},right:{doc:"The right side of the icon is placed closest to the anchor."},top:{doc:"The top of the icon is placed closest to the anchor."},bottom:{doc:"The bottom of the icon is placed closest to the anchor."},"top-left":{doc:"The top left corner of the icon is placed closest to the anchor."},"top-right":{doc:"The top right corner of the icon is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the icon is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the icon is placed closest to the anchor."}},default:"center",doc:"Part of the icon placed closest to the anchor.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{doc:"The icon is aligned to the plane of the map."},viewport:{doc:"The icon is aligned to the plane of the viewport."},auto:{doc:"Automatically matches the value of `icon-rotation-alignment`."}},default:"auto",doc:"Orientation of icon when map is pitched.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{doc:"The text is aligned to the plane of the map."},viewport:{doc:"The text is aligned to the plane of the viewport."},auto:{doc:"Automatically matches the value of `text-rotation-alignment`."}},default:"auto",doc:"Orientation of text when map is pitched.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{doc:"When `symbol-placement` is set to `point`, aligns text east-west. When `symbol-placement` is set to `line` or `line-center`, aligns text x-axes with the line."},viewport:{doc:"Produces glyphs whose x-axes are aligned with the x-axis of the viewport, regardless of the value of `symbol-placement`."},auto:{doc:"When `symbol-placement` is set to `point`, this is equivalent to `viewport`. When `symbol-placement` is set to `line` or `line-center`, this is equivalent to `map`."}},default:"auto",doc:"In combination with `symbol-placement`, determines the rotation behavior of the individual glyphs forming the text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"`auto` value":{js:"0.25.0",android:"4.2.0",ios:"3.4.0",macos:"0.3.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,doc:"Value to use for a text label. If a plain `string` is provided, it will be treated as a `formatted` with default/inherited formatting options. SDF images are not supported in formatted text and will be ignored.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],doc:"Font stack to use for displaying text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",doc:"Font size.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",doc:"The maximum line width for text wrapping.",requires:["text-field",{"symbol-placement":["point"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",doc:"Text leading value for multi-line text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0",android:"10.0.0",ios:"10.0.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",doc:"Text tracking amount.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.40.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{doc:"The text is aligned towards the anchor position."},left:{doc:"The text is aligned to the left."},center:{doc:"The text is centered."},right:{doc:"The text is aligned to the right."}},default:"center",doc:"Text justification options.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"},auto:{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,doc:"Radial offset of text, in the direction of the symbol's anchor. Useful in combination with `text-variable-anchor`, which defaults to using the two-dimensional `text-offset` if present.","sdk-support":{"basic functionality":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"},"data-driven styling":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{doc:"The center of the text is placed closest to the anchor."},left:{doc:"The left side of the text is placed closest to the anchor."},right:{doc:"The right side of the text is placed closest to the anchor."},top:{doc:"The top of the text is placed closest to the anchor."},bottom:{doc:"The bottom of the text is placed closest to the anchor."},"top-left":{doc:"The top left corner of the text is placed closest to the anchor."},"top-right":{doc:"The top right corner of the text is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the text is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the text is placed closest to the anchor."}},requires:["text-field",{"symbol-placement":["point"]}],doc:"To increase the chance of placing high-priority labels on the map, you can provide an array of `text-anchor` locations: the renderer will attempt to place the label at each location, in order, before moving onto the next label. Use `text-justify: auto` to choose justification based on anchor position. To apply an offset, use the `text-radial-offset` or the two-dimensional `text-offset`.","sdk-support":{"basic functionality":{js:"0.54.0",android:"7.4.0",ios:"4.10.0",macos:"0.14.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{doc:"The center of the text is placed closest to the anchor."},left:{doc:"The left side of the text is placed closest to the anchor."},right:{doc:"The right side of the text is placed closest to the anchor."},top:{doc:"The top of the text is placed closest to the anchor."},bottom:{doc:"The bottom of the text is placed closest to the anchor."},"top-left":{doc:"The top left corner of the text is placed closest to the anchor."},"top-right":{doc:"The top right corner of the text is placed closest to the anchor."},"bottom-left":{doc:"The bottom left corner of the text is placed closest to the anchor."},"bottom-right":{doc:"The bottom right corner of the text is placed closest to the anchor."}},default:"center",doc:"Part of the text placed closest to the anchor.",requires:["text-field",{"!":"text-variable-anchor"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",doc:"Maximum angle change between adjacent characters.",requires:["text-field",{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{doc:"If a text's language supports horizontal writing mode, symbols would be laid out horizontally."},vertical:{doc:"If a text's language supports vertical writing mode, symbols would be laid out vertically."}},doc:"The property allows control over a symbol's orientation. Note that the property values act as a hint, so that a symbol whose language doesnt support the provided orientation will be laid out in its natural orientation. Example: English point symbol will be rendered horizontally even if array value contains single 'vertical' enum value. For symbol with point placement, the order of elements in an array define priority order for the placement of an orientation variant. For symbol with line placement, the default text writing mode is either ['horizontal', 'vertical'] or ['vertical', 'horizontal'], the order doesn't affect the placement.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"1.3.0",android:"8.3.0",ios:"5.3.0",macos:"0.15.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",doc:"Rotates the text clockwise.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",doc:"Size of the additional area around the text bounding box used for detecting symbol collisions.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,doc:"If true, the text may be flipped vertically to prevent it from being rendered upside-down.",requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{doc:"The text is not altered."},uppercase:{doc:"Forces all letters to be displayed in uppercase."},lowercase:{doc:"Forces all letters to be displayed in lowercase."}},default:"none",doc:"Specifies how to capitalize text, similar to the CSS `text-transform` property.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",doc:"Offset distance of text from its anchor. Positive values indicate right and down, while negative values indicate left and up. If used with text-variable-anchor, input values will be taken as absolute values. Offsets along the x- and y-axis will be applied automatically based on the anchor position.",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.35.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,doc:"If true, the text will be visible even if it collides with other previously drawn symbols.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,doc:"If true, other symbols can be visible even if they collide with the text.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,doc:"If true, icons will display without their corresponding text when the text collides with other symbols and the icon does not.",requires:["text-field","icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},MA={visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},"property-type":"constant"}},AA={visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},"property-type":"constant"}},IA={type:"array",value:"*",doc:"A filter selects specific features from a layer."},EA={type:"boolean",doc:'Expression which determines whether or not to display a symbol. Symbols support dynamic filtering, meaning this expression can use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature","pitch","distance-from-center"]}},zA={type:"boolean",doc:'Expression which determines whether or not to display a polygon. Fill layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},RA={type:"boolean",doc:'Expression which determines whether or not to display a Polygon or LineString. Line layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},LA={type:"boolean",doc:'Expression which determines whether or not to display a circle. Circle layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},DA={type:"boolean",doc:'Expression used to determine whether a point is being displayed or not. Heatmap layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},jA={type:"enum",values:{"==":{doc:'`["==", key, value]` equality: `feature[key] = value`'},"!=":{doc:'`["!=", key, value]` inequality: `feature[key]  value`'},">":{doc:'`[">", key, value]` greater than: `feature[key] > value`'},">=":{doc:'`[">=", key, value]` greater than or equal: `feature[key]  value`'},"<":{doc:'`["<", key, value]` less than: `feature[key] < value`'},"<=":{doc:'`["<=", key, value]` less than or equal: `feature[key]  value`'},in:{doc:'`["in", key, v0, ..., vn]` set inclusion: `feature[key]  {v0, ..., vn}`'},"!in":{doc:'`["!in", key, v0, ..., vn]` set exclusion: `feature[key]  {v0, ..., vn}`'},all:{doc:'`["all", f0, ..., fn]` logical `AND`: `f0  ...  fn`'},any:{doc:'`["any", f0, ..., fn]` logical `OR`: `f0  ...  fn`'},none:{doc:'`["none", f0, ..., fn]` logical `NOR`: `f0  ...  fn`'},has:{doc:'`["has", key]` `feature[key]` exists'},"!has":{doc:'`["!has", key]` `feature[key]` does not exist'},within:{doc:'`["within", object]` feature geometry is within object geometry'}},doc:"The filter operator."},FA={type:"enum",values:{Point:{doc:"Filter to point geometries."},LineString:{doc:"Filter to line geometries."},Polygon:{doc:"Filter to polygon geometries."}},doc:"The geometry type for the filter to select."},OA={type:"array",minimum:0,maximum:24,value:["number","color"],length:2,doc:"Zoom level and value pair."},BA={type:"array",value:"*",minimum:1,doc:"An expression defines a function that can be used for data-driven style properties or feature filters."},$A={doc:"",type:"enum",values:{let:{doc:'Binds expressions to named variables, which can then be referenced in the result expression using ["var", "variable_name"].',group:"Variable binding","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},var:{doc:'References variable bound using "let".',group:"Variable binding","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},literal:{doc:"Provides a literal array or object value.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},array:{doc:"Asserts that the input is an array (optionally with a specific item type and length).  If, when the input expression is evaluated, it is not of the asserted type, then this assertion will cause the whole expression to be aborted.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},at:{doc:"Retrieves an item from an array.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},in:{doc:"Determines whether an item exists in an array or a substring exists in a string. In the specific case when the second and third arguments are string literals, you must wrap at least one of them in a [`literal`](#types-literal) expression to hint correct interpretation to the [type system](#type-system).",group:"Lookup","sdk-support":{"basic functionality":{js:"1.6.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}}},"index-of":{doc:"Returns the first position at which an item can be found in an array or a substring can be found in a string, or `-1` if the input cannot be found. Accepts an optional index from where to begin the search.",group:"Lookup","sdk-support":{"basic functionality":{js:"1.10.0",android:"10.0.0",ios:"10.0.0"}}},slice:{doc:"Returns an item from an array or a substring from a string from a specified start index, or between a start index and an end index if set. The return value is inclusive of the start index but not of the end index.",group:"Lookup","sdk-support":{"basic functionality":{js:"1.10.0",android:"10.0.0",ios:"10.0.0"}}},case:{doc:"Selects the first output whose corresponding test condition evaluates to true, or the fallback value otherwise.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},match:{doc:'Selects the output for which the label value matches the input value, or the fallback value if no match is found. The input can be any expression (for example, `["get", "building_type"]`). Each label must be unique, and must be either:\n - a single literal value; or\n - an array of literal values, the values of which must be all strings or all numbers (for example `[100, 101]` or `["c", "b"]`).\n\nThe input matches if any of the values in the array matches using strict equality, similar to the `"in"` operator.\nIf the input type does not match the type of the labels, the result will be the fallback value.',group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},coalesce:{doc:"Evaluates each expression in turn until the first valid value is obtained. Invalid values are `null` and [`'image'`](#types-image) expressions that are unavailable in the style. If all values are invalid, `coalesce` returns the first value listed.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},step:{doc:'Produces discrete, stepped results by evaluating a piecewise-constant function defined by pairs of input and output values ("stops"). The `input` may be any numeric expression (e.g., `["get", "population"]`). Stop inputs must be numeric literals in strictly ascending order. Returns the output value of the stop just less than the input, or the first output if the input is less than the first stop.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},interpolate:{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). The `input` may be any numeric expression (e.g., `["get", "population"]`). Stop inputs must be numeric literals in strictly ascending order. The output type must be `number`, `array<number>`, or `color`.\n\nInterpolation types:\n- `["linear"]`: Interpolates linearly between the pair of stops just less than and just greater than the input.\n- `["exponential", base]`: Interpolates exponentially between the stops just less than and just greater than the input. `base` controls the rate at which the output increases: higher values make the output increase more towards the high end of the range. With values close to 1 the output increases linearly.\n- `["cubic-bezier", x1, y1, x2, y2]`: Interpolates using the cubic bezier curve defined by the given control points.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"interpolate-hcl":{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). Works like `interpolate`, but the output type must be `color`, and the interpolation is performed in the Hue-Chroma-Luminance color space.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.49.0"}}},"interpolate-lab":{doc:'Produces continuous, smooth results by interpolating between pairs of input and output values ("stops"). Works like `interpolate`, but the output type must be `color`, and the interpolation is performed in the CIELAB color space.',group:"Ramps, scales, curves","sdk-support":{"basic functionality":{js:"0.49.0"}}},ln2:{doc:"Returns mathematical constant ln(2).",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},pi:{doc:"Returns the mathematical constant pi.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},e:{doc:"Returns the mathematical constant e.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},typeof:{doc:"Returns a string describing the type of the given value.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},string:{doc:"Asserts that the input value is a string. If multiple values are provided, each one is evaluated in order until a string is obtained. If none of the inputs are strings, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},number:{doc:"Asserts that the input value is a number. If multiple values are provided, each one is evaluated in order until a number is obtained. If none of the inputs are numbers, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},boolean:{doc:"Asserts that the input value is a boolean. If multiple values are provided, each one is evaluated in order until a boolean is obtained. If none of the inputs are booleans, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},object:{doc:"Asserts that the input value is an object. If multiple values are provided, each one is evaluated in order until an object is obtained. If none of the inputs are objects, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},collator:{doc:"Returns a `collator` for use in locale-dependent comparison operations. The `case-sensitive` and `diacritic-sensitive` options default to `false`. The `locale` argument specifies the IETF language tag of the locale to use. If none is provided, the default locale is used. If the requested locale is not available, the `collator` will use a system-defined fallback locale. Use `resolved-locale` to test the results of locale fallback behavior.",group:"Types","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},format:{doc:'Returns a `formatted` string for displaying mixed-format text in the `text-field` property. The input may contain a string literal or expression, including an [`\'image\'`](#types-image) expression. Strings may be followed by a style override object that supports the following properties:\n- `"text-font"`: Overrides the font stack specified by the root layout property.\n- `"text-color"`: Overrides the color specified by the root paint property.\n- `"font-scale"`: Applies a scaling factor on `text-size` as specified by the root layout property.',group:"Types","sdk-support":{"basic functionality":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"text-font":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"font-scale":{js:"0.48.0",android:"6.7.0",ios:"4.6.0",macos:"0.12.0"},"text-color":{js:"1.3.0",android:"7.3.0",ios:"4.10.0",macos:"0.14.0"},image:{js:"1.6.0",android:"8.6.0",ios:"5.7.0",macos:"0.15.0"}}},image:{doc:"Returns a [`ResolvedImage`](/mapbox-gl-js/style-spec/types/#resolvedimage) for use in [`icon-image`](/mapbox-gl-js/style-spec/layers/#layout-symbol-icon-image), `*-pattern` entries, and as a section in the [`'format'`](#types-format) expression. A [`'coalesce'`](#coalesce) expression containing `image` expressions will evaluate to the first listed image that is currently in the style. This validation process is synchronous and requires the image to have been added to the style before requesting it in the `'image'` argument.",group:"Types","sdk-support":{"basic functionality":{js:"1.4.0",android:"8.6.0",ios:"5.7.0",macos:"0.15.0"}}},"number-format":{doc:"Converts the input number into a string representation using the providing formatting rules. If set, the `locale` argument specifies the locale to use, as a BCP 47 language tag. If set, the `currency` argument specifies an ISO 4217 code to use for currency-style formatting. If set, the `unit` argument specifies a [simple ECMAScript unit](https://tc39.es/proposal-unified-intl-numberformat/section6/locales-currencies-tz_proposed_out.html#sec-issanctionedsimpleunitidentifier) to use for unit-style formatting. If set, the `min-fraction-digits` and `max-fraction-digits` arguments specify the minimum and maximum number of fractional digits to include.",group:"Types","sdk-support":{"basic functionality":{js:"0.54.0",android:"8.4.0",ios:"5.4.0",macos:"0.15.0"}}},"to-string":{doc:'Converts the input value to a string. If the input is `null`, the result is `""`. If the input is a [`boolean`](#types-boolean), the result is `"true"` or `"false"`. If the input is a number, it is converted to a string as specified by the ["NumberToString" algorithm](https://tc39.github.io/ecma262/#sec-tostring-applied-to-the-number-type) of the ECMAScript Language Specification. If the input is a [`color`](#color), it is converted to a string of the form `"rgba(r,g,b,a)"`, where `r`, `g`, and `b` are numerals ranging from 0 to 255, and `a` ranges from 0 to 1. If the input is an [`\'image\'`](#types-image) expression, `\'to-string\'` returns the image name. Otherwise, the input is converted to a string in the format specified by the [`JSON.stringify`](https://tc39.github.io/ecma262/#sec-json.stringify) function of the ECMAScript Language Specification.',group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-number":{doc:'Converts the input value to a number, if possible. If the input is `null` or `false`, the result is 0. If the input is `true`, the result is 1. If the input is a string, it is converted to a number as specified by the ["ToNumber Applied to the String Type" algorithm](https://tc39.github.io/ecma262/#sec-tonumber-applied-to-the-string-type) of the ECMAScript Language Specification. If multiple values are provided, each one is evaluated in order until the first successful conversion is obtained. If none of the inputs can be converted, the expression is an error.',group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-boolean":{doc:"Converts the input value to a boolean. The result is `false` when then input is an empty string, 0, `false`, `null`, or `NaN`; otherwise it is `true`.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-rgba":{doc:"Returns a four-element array containing the input color's red, green, blue, and alpha components, in that order.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"to-color":{doc:"Converts the input value to a color. If multiple values are provided, each one is evaluated in order until the first successful conversion is obtained. If none of the inputs can be converted, the expression is an error.",group:"Types","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},rgb:{doc:"Creates a color value from red, green, and blue components, which must range between 0 and 255, and an alpha component of 1. If any component is out of range, the expression is an error.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},rgba:{doc:"Creates a color value from red, green, blue components, which must range between 0 and 255, and an alpha component which must range between 0 and 1. If any component is out of range, the expression is an error.",group:"Color","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},get:{doc:"Retrieves a property value from the current feature's properties, or from another object if a second argument is provided. Returns `null` if the requested property is missing.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},has:{doc:"Tests for the presence of an property value in the current feature's properties, or from another object if a second argument is provided.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},length:{doc:"Returns the length of an array or string.",group:"Lookup","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},properties:{doc:'Returns the feature properties object.  Note that in some cases, it may be more efficient to use `["get", "property_name"]` directly.',group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"feature-state":{doc:"Retrieves a property value from the current feature's state. Returns `null` if the requested property is not present on the feature's state. A feature's state is not part of the GeoJSON or vector tile data, and must be set programmatically on each feature. Features are identified by their `id` attribute, which must be an integer or a string that can be cast to an integer. Note that [\"feature-state\"] can only be used with paint properties that support data-driven styling.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.46.0",android:"10.0.0",ios:"10.0.0"}}},"geometry-type":{doc:"Returns the feature's geometry type: `Point`, `LineString` or `Polygon`. `Multi*` feature types return the singular forms.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},id:{doc:"Returns the feature's id, if it has one.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},zoom:{doc:'Returns the current zoom level.  Note that in style layout and paint properties, ["zoom"] may only appear as the input to a top-level "step" or "interpolate" expression.',group:"Camera","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},pitch:{doc:'Returns the current pitch in degrees. `["pitch"]` may only be used in the `filter` expression for a `symbol` layer.',group:"Camera","sdk-support":{"basic functionality":{js:"2.6.0",android:"10.9.0",ios:"10.9.0"}}},"distance-from-center":{doc:'Returns the distance of a `symbol` instance from the center of the map. The distance is measured in pixels divided by the height of the map container. It measures 0 at the center, decreases towards the camera and increase away from the camera. For example, if the height of the map is 1000px, a value of -1 means 1000px away from the center towards the camera, and a value of 1 means a distance of 1000px away from the camera from the center. `["distance-from-center"]` may only be used in the `filter` expression for a `symbol` layer.',group:"Camera","sdk-support":{"basic functionality":{js:"2.6.0",android:"10.9.0",ios:"10.9.0"}}},"heatmap-density":{doc:"Returns the kernel density estimation of a pixel in a heatmap layer, which is a relative measure of how many data points are crowded around a particular pixel. Can only be used in the `heatmap-color` property.",group:"Heatmap","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"line-progress":{doc:"Returns the progress along a gradient line. Can only be used in the `line-gradient` property.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.6.0",macos:"0.12.0"}}},"sky-radial-progress":{doc:"Returns the distance of a point on the sky from the sun position. Returns 0 at sun position and 1 when the distance reaches `sky-gradient-radius`. Can only be used in the `sky-gradient` property.",group:"sky","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}},accumulated:{doc:"Returns the value of a cluster property accumulated so far. Can only be used in the `clusterProperties` option of a clustered GeoJSON source.",group:"Feature data","sdk-support":{"basic functionality":{js:"0.53.0",android:"8.4.0",ios:"5.5.0",macos:"0.15.0"}}},"+":{doc:"Returns the sum of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"*":{doc:"Returns the product of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"-":{doc:"For two inputs, returns the result of subtracting the second input from the first. For a single input, returns the result of subtracting it from 0.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"/":{doc:"Returns the result of floating point division of the first input by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"%":{doc:"Returns the remainder after integer division of the first input by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"^":{doc:"Returns the result of raising the first input to the power specified by the second.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},sqrt:{doc:"Returns the square root of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.42.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},log10:{doc:"Returns the base-ten logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},ln:{doc:"Returns the natural logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},log2:{doc:"Returns the base-two logarithm of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},sin:{doc:"Returns the sine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},cos:{doc:"Returns the cosine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},tan:{doc:"Returns the tangent of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},asin:{doc:"Returns the arcsine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},acos:{doc:"Returns the arccosine of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},atan:{doc:"Returns the arctangent of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},min:{doc:"Returns the minimum value of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},max:{doc:"Returns the maximum value of the inputs.",group:"Math","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},round:{doc:'Rounds the input to the nearest integer. Halfway values are rounded away from zero. For example, `["round", -1.5]` evaluates to -2.',group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},abs:{doc:"Returns the absolute value of the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},ceil:{doc:"Returns the smallest integer that is greater than or equal to the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},floor:{doc:"Returns the largest integer that is less than or equal to the input.",group:"Math","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},distance:{doc:"Returns the shortest distance in meters between the evaluated feature and the input geometry. The input value can be a valid GeoJSON of type `Point`, `MultiPoint`, `LineString`, `MultiLineString`, `Polygon`, `MultiPolygon`, `Feature`, or `FeatureCollection`. Distance values returned may vary in precision due to loss in precision from encoding geometries, particularly below zoom level 13.",group:"Math","sdk-support":{"basic functionality":{android:"9.2.0",ios:"5.9.0",macos:"0.16.0"}}},"==":{doc:"Returns `true` if the input values are equal, `false` otherwise. The comparison is strictly typed: values of different runtime types are always considered unequal. Cases where the types are known to be different at parse time are considered invalid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"!=":{doc:"Returns `true` if the input values are not equal, `false` otherwise. The comparison is strictly typed: values of different runtime types are always considered unequal. Cases where the types are known to be different at parse time are considered invalid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},">":{doc:"Returns `true` if the first input is strictly greater than the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"<":{doc:"Returns `true` if the first input is strictly less than the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},">=":{doc:"Returns `true` if the first input is greater than or equal to the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},"<=":{doc:"Returns `true` if the first input is less than or equal to the second, `false` otherwise. The arguments are required to be either both strings or both numbers; if during evaluation they are not, expression evaluation produces an error. Cases where this constraint is known not to hold at parse time are considered in valid and will produce a parse error. Accepts an optional `collator` argument to control locale-dependent string comparisons.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},collator:{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}},all:{doc:"Returns `true` if all the inputs are `true`, `false` otherwise. The inputs are evaluated in order, and evaluation is short-circuiting: once an input expression evaluates to `false`, the result is `false` and no further input expressions are evaluated.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},any:{doc:"Returns `true` if any of the inputs are `true`, `false` otherwise. The inputs are evaluated in order, and evaluation is short-circuiting: once an input expression evaluates to `true`, the result is `true` and no further input expressions are evaluated.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"!":{doc:"Logical negation. Returns `true` if the input is `false`, and `false` if the input is `true`.",group:"Decision","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},within:{doc:"Returns `true` if the evaluated feature is fully contained inside a boundary of the input geometry, `false` otherwise. The input value can be a valid GeoJSON of type `Polygon`, `MultiPolygon`, `Feature`, or `FeatureCollection`. Supported features for evaluation:\n- `Point`: Returns `false` if a point is on the boundary or falls outside the boundary.\n- `LineString`: Returns `false` if any part of a line falls outside the boundary, the line intersects the boundary, or a line's endpoint is on the boundary.",group:"Decision","sdk-support":{"basic functionality":{js:"1.9.0",android:"9.1.0",ios:"5.8.0",macos:"0.15.0"}}},"is-supported-script":{doc:"Returns `true` if the input string is expected to render legibly. Returns `false` if the input string contains sections that cannot be rendered without potential loss of meaning (e.g. Indic scripts that require complex text shaping, or right-to-left scripts if the the `mapbox-gl-rtl-text` plugin is not in use in Mapbox GL JS).",group:"String","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.6.0",ios:"4.1.0",macos:"0.8.0"}}},upcase:{doc:"Returns the input string converted to uppercase. Follows the Unicode Default Case Conversion algorithm and the locale-insensitive case mappings in the Unicode Character Database.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},downcase:{doc:"Returns the input string converted to lowercase. Follows the Unicode Default Case Conversion algorithm and the locale-insensitive case mappings in the Unicode Character Database.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},concat:{doc:"Returns a `string` consisting of the concatenation of the inputs. Each input is converted to a string as if by `to-string`.",group:"String","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}}},"resolved-locale":{doc:"Returns the IETF language tag of the locale being used by the provided `collator`. This can be used to determine the default system locale, or to determine if a requested locale was successfully loaded.",group:"String","sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.2.0",macos:"0.9.0"}}}}},NA={range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},doc:"The start and end distance range in which fog fades from fully transparent to fully opaque. The distance to the point at the center of the map is defined as zero, so that negative range values are closer to the camera, and positive values are farther away.",example:[.5,10],"sdk-support":{"basic functionality":{js:"2.3.0",android:"10.6.0",ios:"10.6.0"}}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"The color of the atmosphere region immediately below the horizon and within the `range` and above the horizon and within `horizon-blend`. Using opacity is recommended only for smoothly transitioning fog on/off as anything less than 100% opacity results in more tiles loaded and drawn.","sdk-support":{"basic functionality":{js:"2.3.0",android:"10.6.0",ios:"10.6.0"}}},"high-color":{type:"color","property-type":"data-constant",default:"#245cdf",expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"The color of the atmosphere region above the horizon, `high-color` extends further above the horizon than the `color` property and its spread can be controlled with `horizon-blend`. The opacity can be set to `0` to remove the high atmosphere color contribution.","sdk-support":{"basic functionality":{js:"2.9.0",android:"10.6.0",ios:"10.6.0"}}},"space-color":{type:"color","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"The color of the region above the horizon and after the end of the `horizon-blend` contribution. The opacity can be set to `0` to have a transparent background.","sdk-support":{"basic functionality":{js:"2.9.0",android:"10.6.0",ios:"10.6.0"}}},"horizon-blend":{type:"number","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],4,.2,7,.1],minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Horizon blend applies a smooth fade from the color of the atmosphere to the color of space. A value of zero leaves a sharp transition from atmosphere to space. Increasing the value blends the color of atmosphere into increasingly high angles of the sky.","sdk-support":{"basic functionality":{js:"2.3.0",android:"10.6.0",ios:"10.6.0"}}},"star-intensity":{type:"number","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],5,.35,6,0],minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"A value controlling the star intensity where `0` will show no stars and `1` will show stars at their maximum intensity.","sdk-support":{"basic functionality":{js:"2.9.0",android:"10.6.0",ios:"10.6.0"}}}},UA={anchor:{type:"enum",default:"viewport",values:{map:{doc:"The position of the light source is aligned to the rotation of the map."},viewport:{doc:"The position of the light source is aligned to the rotation of the viewport."}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]},doc:"Whether extruded geometries are lit relative to the map or viewport.",example:"map","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},doc:"Position of the light source relative to lit (extruded) geometries, in [r radial coordinate, a azimuthal angle, p polar angle] where r indicates the distance from the center of the base of an object to its light, a indicates the position of the light relative to 0 (0 when `light.anchor` is set to `viewport` corresponds to the top of the viewport, or 0 when `light.anchor` is set to `map` corresponds to due north, and degrees proceed clockwise), and p indicates the height of the light (from 0, directly above, to 180, directly below).",example:[1.5,90,80],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Color tint for lighting extruded geometries.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Intensity of lighting (on a scale from 0 to 1). Higher numbers will present as more extreme contrast.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}}}},VA={name:{type:"enum",values:{albers:{doc:"An Albers equal-area projection centered on the continental United States. You can configure the projection for a different region by setting `center` and `parallels` properties. You may want to set max bounds to constrain the map to the relevant region."},equalEarth:{doc:"An Equal Earth projection."},equirectangular:{doc:"An Equirectangular projection. This projection is very similar to the Plate Carre projection."},lambertConformalConic:{doc:"A Lambert conformal conic projection. You can configure the projection for a region by setting `center` and `parallels` properties. You may want to set max bounds to constrain the map to the relevant region."},mercator:{doc:"The Mercator projection is the default projection."},naturalEarth:{doc:"A Natural Earth projection."},winkelTripel:{doc:"A Winkel Tripel projection."},globe:{doc:"A globe projection."}},default:"mercator",doc:"The name of the projection to be used for rendering the map.",required:!0,"sdk-support":{"basic functionality":{js:"2.6.0"}}},center:{type:"array",length:2,value:"number","property-type":"data-constant",minimum:[-180,-90],maximum:[180,90],transition:!1,doc:"The reference longitude and latitude of the projection. `center` takes the form of [lng, lat]. This property is only configurable for conic projections (Albers and Lambert Conformal Conic). All other projections are centered on [0, 0].",example:[-96,37.5],requires:[{name:["albers","lambertConformalConic"]}],"sdk-support":{"basic functionality":{js:"2.6.0"}}},parallels:{type:"array",length:2,value:"number","property-type":"data-constant",minimum:[-90,-90],maximum:[90,90],transition:!1,doc:"The standard parallels of the projection, denoting the desired latitude range with minimal distortion. `parallels` takes the form of [lat0, lat1]. This property is only configurable for conic projections (Albers and Lambert Conformal Conic).",example:[29.5,45.5],requires:[{name:["albers","lambertConformalConic"]}],"sdk-support":{"basic functionality":{js:"2.6.0"}}}},qA={source:{type:"string",doc:"Name of a source of `raster_dem` type to be used for terrain elevation.",required:!0,"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Exaggerates the elevation of the terrain by multiplying the data from the DEM with this value.",requires:["source"],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}}}},GA=["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],ZA={"fill-antialias":{type:"boolean",default:!0,doc:"Whether or not the fill should be antialiased.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire fill layer. In contrast to the `fill-color`, this value will also affect the 1px stroke around the fill, if the stroke is used.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.21.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",doc:"The color of the filled part of this layer. This color can be specified as `rgba` with an alpha component and the color's opacity will not affect the opacity of the 1px stroke, if it is used.",transition:!0,requires:[{"!":"fill-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.19.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",doc:"The outline color of the fill. Matches the value of `fill-color` if unspecified.",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.19.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{doc:"The fill is translated relative to the map."},viewport:{doc:"The fill is translated relative to the viewport."}},doc:"Controls the frame of reference for `fill-translate`.",default:"map",requires:["fill-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!1,doc:"Name of image in sprite to use for drawing image fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"}},WA={"line-opacity":{type:"number",doc:"The opacity at which the line will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",doc:"The color with which the line will be drawn.",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.23.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{doc:"The line is translated relative to the map."},viewport:{doc:"The line is translated relative to the viewport."}},doc:"Controls the frame of reference for `line-translate`.",default:"map",requires:["line-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",doc:"Stroke thickness.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,doc:"Draws a line casing outside of a line's actual path. Value indicates the width of the inner gap.",transition:!0,units:"pixels","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,doc:"The line's offset. For linear features, a positive value offsets the line to the right, relative to the direction of the line, and a negative value to the left. For polygon features, a positive value results in an inset, and a negative value results in an outset.",transition:!0,units:"pixels","sdk-support":{"basic functionality":{js:"0.12.1",android:"3.0.0",ios:"3.1.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Blur applied to the line, in pixels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",doc:"Specifies the lengths of the alternating dashes and gaps that form the dash pattern. The lengths are later scaled by the line width. To convert a dash length to pixels, multiply the length by the current line width. Note that GeoJSON sources with `lineMetrics: true` specified won't render dashed lines to the expected scale. Also note that zoom-dependent expressions will be evaluated only at integer zoom levels.",minimum:0,transition:!1,units:"line widths",requires:[{"!":"line-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"2.3.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{type:"resolvedImage",transition:!1,doc:"Name of image in sprite to use for drawing image lines. For seamless patterns, image width must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{type:"color",doc:'Defines a gradient with which to color a line feature. Can only be used with GeoJSON sources that specify `"lineMetrics": true`.',transition:!1,requires:[{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],"sdk-support":{"basic functionality":{js:"0.45.0",android:"6.5.0",ios:"4.4.0",macos:"0.11.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{type:"array",value:"number",doc:"The line part between [trim-start, trim-end] will be marked as transparent to make a route vanishing effect. The line trim-off offset is based on the whole line range [0.0, 1.0].",length:2,default:[0,0],minimum:[0,0],maximum:[1,1],transition:!1,requires:[{source:"geojson",has:{lineMetrics:!0}}],"sdk-support":{"basic functionality":{js:"2.9.0",android:"10.5.0",ios:"10.5.0",macos:"10.5.0"}},"property-type":"constant"}},HA={"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",doc:"Circle radius.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.18.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",doc:"The fill color of the circle.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.18.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,doc:"Amount to blur the circle. 1 blurs the circle such that only the centerpoint is full opacity.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.20.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",doc:"The opacity at which the circle will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.20.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up, respectively.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{doc:"The circle is translated relative to the map."},viewport:{doc:"The circle is translated relative to the viewport."}},doc:"Controls the frame of reference for `circle-translate`.",default:"map",requires:["circle-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{doc:"Circles are scaled according to their apparent distance to the camera."},viewport:{doc:"Circles are not scaled."}},default:"map",doc:"Controls the scaling behavior of the circle when the map is pitched.","sdk-support":{"basic functionality":{js:"0.21.0",android:"4.2.0",ios:"3.4.0",macos:"0.2.1"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{doc:"The circle is aligned to the plane of the map."},viewport:{doc:"The circle is aligned to the plane of the viewport."}},default:"viewport",doc:"Orientation of circle when map is pitched.","sdk-support":{"basic functionality":{js:"0.39.0",android:"5.2.0",ios:"3.7.0",macos:"0.6.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"The width of the circle's stroke. Strokes are placed outside of the `circle-radius`.","sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",doc:"The stroke color of the circle.",transition:!0,"sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",doc:"The opacity of the circle's stroke.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"},"data-driven styling":{js:"0.29.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},XA={"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",doc:"Radius of influence of one heatmap point in pixels. Increasing the value makes the heatmap smoother, but less detailed. `queryRenderedFeatures` on heatmap layers will return points within this radius.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,doc:"A measure of how much an individual point contributes to the heatmap. A value of 10 would be equivalent to having 10 points of weight 1 in the same spot. Especially useful when combined with clustering.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,doc:"Similar to `heatmap-weight` but controls the intensity of the heatmap globally. Primarily used for adjusting the heatmap based on zoom level.","sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],doc:'Defines the color of each pixel based on its density value in a heatmap.  Should be an expression that uses `["heatmap-density"]` as input.',transition:!1,"sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",doc:"The global opacity at which the heatmap layer will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.41.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},KA={"icon-opacity":{doc:"The opacity at which the icon will be drawn.",type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,doc:"The color of the icon. This can only be used with [SDF icons](/help/troubleshooting/using-recolorable-images-in-mapbox-maps/).",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,doc:"The color of the icon's halo. Icon halos can only be used with [SDF icons](/help/troubleshooting/using-recolorable-images-in-mapbox-maps/).",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Distance of halo to the icon outline.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Fade out the halo towards the outside.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"Distance that the icon's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["icon-image"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{doc:"Icons are translated relative to the map."},viewport:{doc:"Icons are translated relative to the viewport."}},doc:"Controls the frame of reference for `icon-translate`.",default:"map",requires:["icon-image","icon-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",doc:"The opacity at which the text will be drawn.",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",doc:"The color with which the text will be drawn.",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,doc:"The color of the text's halo, which helps it stand out from backgrounds.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"Distance of halo to the font outline. Max text halo width is 1/4 of the font-size.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",doc:"The halo's fadeout distance towards the outside.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"},"data-driven styling":{js:"0.33.0",android:"5.0.0",ios:"3.5.0",macos:"0.4.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"Distance that the text's anchor is moved from its original placement. Positive values indicate right and down, while negative values indicate left and up.",requires:["text-field"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{doc:"The text is translated relative to the map."},viewport:{doc:"The text is translated relative to the viewport."}},doc:"Controls the frame of reference for `text-translate`.",default:"map",requires:["text-field","text-translate"],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},YA={"raster-opacity":{type:"number",doc:"The opacity at which the image will be drawn.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",doc:"Rotates hues around the color wheel.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",doc:"Increase or reduce the brightness of the image. The value is the minimum brightness.",default:0,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",doc:"Increase or reduce the brightness of the image. The value is the maximum brightness.",default:1,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",doc:"Increase or reduce the saturation of the image.",default:0,minimum:-1,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",doc:"Increase or reduce the contrast of the image.",default:0,minimum:-1,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",doc:"The resampling/interpolation method to use for overscaling, also known as texture magnification filter",values:{linear:{doc:"(Bi)linear filtering interpolates pixel values using the weighted average of the four closest original source pixels creating a smooth but blurry look when overscaled"},nearest:{doc:"Nearest neighbor filtering interpolates pixel values using the nearest original source pixel creating a sharp but pixelated look when overscaled"}},default:"linear","sdk-support":{"basic functionality":{js:"0.47.0",android:"6.3.0",ios:"4.2.0",macos:"0.9.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",doc:"Fade duration when a new tile is added.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},JA={"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,doc:"The direction of the light source used to generate the hillshading with 0 as the top of the viewport if `hillshade-illumination-anchor` is set to `viewport` and due north if `hillshade-illumination-anchor` is set to `map`.",transition:!1,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{doc:"The hillshade illumination is relative to the north direction."},viewport:{doc:"The hillshade illumination is relative to the top of the viewport."}},default:"viewport",doc:"Direction of light source when map is rotated.","sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",doc:"Intensity of the hillshade",default:.5,minimum:0,maximum:1,transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",doc:"The shading color of areas that face away from the light source.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",doc:"The shading color of areas that faces towards the light source.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",doc:"The shading color used to accentuate rugged terrain like sharp cliffs and gorges.",transition:!0,"sdk-support":{"basic functionality":{js:"0.43.0",android:"6.0.0",ios:"4.0.0",macos:"0.7.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},QA={"background-color":{type:"color",default:"#000000",doc:"The color with which the background will be drawn.",transition:!0,requires:[{"!":"background-pattern"}],"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!1,doc:"Name of image in sprite to use for drawing an image background. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity at which the background will be drawn.",transition:!0,"sdk-support":{"basic functionality":{js:"0.10.0",android:"2.0.1",ios:"2.0.0",macos:"0.1.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},eI={"sky-type":{type:"enum",values:{gradient:{doc:"Renders the sky with a gradient that can be configured with `sky-gradient-radius` and `sky-gradient`."},atmosphere:{doc:"Renders the sky with a simulated atmospheric scattering algorithm, the sun direction can be attached to the light position or explicitly set through `sky-atmosphere-sun`."}},default:"atmosphere",doc:"The type of the sky","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,doc:"Position of the sun center [a azimuthal angle, p polar angle]. The azimuthal angle indicates the position of the sun relative to 0 north, where degrees proceed clockwise. The polar angle indicates the height of the sun, where 0 is directly above, at zenith, and 90 at the horizon. When this property is ommitted, the sun center is directly inherited from the light position.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,doc:"Intensity of the sun as a light source in the atmosphere (on a scale from 0 to a 100). Setting higher values will brighten up the sky.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,doc:"Position of the gradient center [a azimuthal angle, p polar angle]. The azimuthal angle indicates the position of the gradient center relative to 0 north, where degrees proceed clockwise. The polar angle indicates the height of the gradient center, where 0 is directly above, at zenith, and 90 at the horizon.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,doc:"The angular distance (measured in degrees) from `sky-gradient-center` up to which the gradient extends. A value of 180 causes the gradient to wrap around to the opposite direction from `sky-gradient-center`.","sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],doc:"Defines a radial color gradient with which to color the sky. The color values can be interpolated with an expression using `sky-radial-progress`. The range [0, 1] for the interpolant covers a radial distance (in degrees) of [0, `sky-gradient-radius`] centered at the position specified by `sky-gradient-center`.",transition:!1,requires:[{"sky-type":"gradient"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"},"data-driven styling":{}},expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",doc:"A color applied to the atmosphere sun halo. The alpha channel describes how strongly the sun halo is represented in an atmosphere sky layer.",transition:!1,requires:[{"sky-type":"atmosphere"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",doc:"A color used to tweak the main atmospheric scattering coefficients. Using white applies the default coefficients giving the natural blue color to the atmosphere. This color affects how heavily the corresponding wavelength is represented during scattering. The alpha channel describes the density of the atmosphere, with 1 maximum density and 0 no density.",transition:!1,requires:[{"sky-type":"atmosphere"}],"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire sky layer.",transition:!0,"sdk-support":{"basic functionality":{js:"2.0.0",ios:"10.0.0",android:"10.0.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},tI={duration:{type:"number",default:300,minimum:0,units:"milliseconds",doc:"Time allotted for transitions to complete."},delay:{type:"number",default:0,minimum:0,units:"milliseconds",doc:"Length of time before a transition begins."}},rI={"*":{type:"string",doc:"A name of a feature property to use as ID for feature state."}},iI={$version:cA,$root:uA,sources:hA,source:pA,source_vector:dA,source_raster:fA,source_raster_dem:mA,source_geojson:gA,source_video:yA,source_image:_A,layer:vA,layout:bA,layout_background:xA,layout_sky:wA,layout_fill:TA,layout_circle:SA,layout_heatmap:kA,"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{doc:"The layer is shown."},none:{doc:"The layer is not shown."}},default:"visible",doc:"Whether this layer is displayed.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},"property-type":"constant"},"fill-extrusion-edge-radius":{type:"number",private:!0,default:0,minimum:0,maximum:1,doc:"Radius of a fill extrusion edge in meters. If not zero, rounds extrusion edges for a smoother appearance.","sdk-support":{"basic functionality":{js:"v2.10.0",android:"10.7.0",ios:"10.7.0"}},"property-type":"constant"}},layout_line:CA,layout_symbol:PA,layout_raster:MA,layout_hillshade:AA,filter:IA,filter_symbol:EA,filter_fill:zA,filter_line:RA,filter_circle:LA,"filter_fill-extrusion":{type:"boolean",doc:'Expression which determines whether or not to display a Polygon. Fill-extrusion layer does NOT support dynamic filtering, meaning this expression can NOT use the `["pitch"]` and `["distance-from-center"]` expressions to reference the current state of the view.',default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_heatmap:DA,filter_operator:jA,geometry_type:FA,function:{expression:{type:"expression",doc:"An expression."},stops:{type:"array",doc:"An array of stops.",value:"function_stop"},base:{type:"number",default:1,minimum:0,doc:"The exponential base of the interpolation curve. It controls the rate at which the result increases. Higher values make the result increase more towards the high end of the range. With `1` the stops are interpolated linearly."},property:{type:"string",doc:"The name of a feature property to use as the function input.",default:"$zoom"},type:{type:"enum",values:{identity:{doc:"Return the input value as the output value."},exponential:{doc:"Generate an output by interpolating between stops just less than and just greater than the function input."},interval:{doc:"Return the output value of the stop just less than the function input."},categorical:{doc:"Return the output value of the stop equal to the function input."}},doc:"The interpolation strategy to use in function evaluation.",default:"exponential"},colorSpace:{type:"enum",values:{rgb:{doc:"Use the RGB color space to interpolate color values"},lab:{doc:"Use the LAB color space to interpolate color values."},hcl:{doc:"Use the HCL color space to interpolate color values, interpolating the Hue, Chroma, and Luminance channels individually."}},doc:"The color space in which colors interpolated. Interpolating colors in perceptual color spaces like LAB and HCL tend to produce color ramps that look more consistent and produce colors that can be differentiated more easily than those interpolated in RGB space.",default:"rgb"},default:{type:"*",required:!1,doc:`A value to serve as a fallback function result when a value isn't otherwise available. It is used in the following circumstances:
* In categorical functions, when the feature value does not match any of the stop domain values.
* In property and zoom-and-property functions, when a feature does not contain a value for the specified property.
* In identity functions, when the feature value is not valid for the style property (for example, if the function is being used for a \`circle-color\` property but the feature property value is not a string or not a valid color).
* In interval or exponential property and zoom-and-property functions, when the feature value is not numeric.
If no default is provided, the style property's default is used in these circumstances.`}},function_stop:OA,expression:BA,expression_name:$A,fog:NA,light:UA,projection:VA,terrain:qA,paint:GA,paint_fill:ZA,"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,doc:"The opacity of the entire fill extrusion layer. This is rendered on a per-layer, not per-feature, basis, and data-driven styling is not available.",transition:!0,"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",doc:"The base color of the extruded fill. The extrusion's surfaces will be shaded differently based on this color in combination with the root `light` settings. If this color is specified as `rgba` with an alpha component, the alpha component will be ignored; use `fill-extrusion-opacity` to set layer opacity.",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",doc:"The geometry's offset. Values are [x, y] where negatives indicate left and up (on the flat plane), respectively.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{doc:"The fill extrusion is translated relative to the map."},viewport:{doc:"The fill extrusion is translated relative to the viewport."}},doc:"Controls the frame of reference for `fill-extrusion-translate`.",default:"map",requires:["fill-extrusion-translate"],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!1,doc:"Name of image in sprite to use for drawing images on extruded fills. For seamless patterns, image width and height must be a factor of two (2, 4, 8, ..., 512). Note that zoom-dependent expressions will be evaluated only at integer zoom levels.","sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.49.0",android:"6.5.0",macos:"0.11.0",ios:"4.4.0"}},expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",doc:"The height with which to extrude this layer.",transition:!0,"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",doc:"The height with which to extrude the base of this layer. Must be less than or equal to `fill-extrusion-height`.",transition:!0,requires:["fill-extrusion-height"],"sdk-support":{"basic functionality":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"},"data-driven styling":{js:"0.27.0",android:"5.1.0",ios:"3.6.0",macos:"0.5.0"}},expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,doc:"Whether to apply a vertical gradient to the sides of a fill-extrusion layer. If true, sides will be shaded slightly darker farther down.",transition:!1,"sdk-support":{"basic functionality":{js:"0.50.0",android:"7.0.0",ios:"4.7.0",macos:"0.13.0"}},expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant",type:"number",private:!0,default:0,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Controls the intensity of shading near ground and concave angles between walls. Default value 0.0 disables ambient occlusion and values around 0.3 provide the most plausible results for buildings.","sdk-support":{"basic functionality":{js:"2.10.0",android:"10.7.0",ios:"10.7.0"}}},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant",type:"number",private:!0,default:3,minimum:0,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,doc:"Shades area near ground and concave angles between walls where the radius defines only vertical impact. Default value 3.0 corresponds to height of one floor and brings the most plausible results for buildings.",requires:["fill-extrusion-edge-radius"],"sdk-support":{"basic functionality":{js:"2.10.0",android:"10.7.0",ios:"10.7.0"}}}},paint_line:WA,paint_circle:HA,paint_heatmap:XA,paint_symbol:KA,paint_raster:YA,paint_hillshade:JA,paint_background:QA,paint_sky:eI,transition:tI,"property-type":{"data-driven":{type:"property-type",doc:"Property is interpolable and can be represented using a property expression."},"color-ramp":{type:"property-type",doc:"Property should be specified using a color ramp from which the output color can be sampled based on a property calculation."},"data-constant":{type:"property-type",doc:"Property is interpolable but cannot be represented using a property expression."},constant:{type:"property-type",doc:"Property is constant across all zoom levels and property values."}},promoteId:rI},_g=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},hy={exports:{}};/*! https://mths.be/punycode v1.3.2 by @mathias */(function(i,r){(function(s){var p=r&&!r.nodeType&&r,m=i&&!i.nodeType&&i,b=typeof _g=="object"&&_g;(b.global===b||b.window===b||b.self===b)&&(s=b);var f,l=2147483647,C=36,M=1,D=26,O=38,Z=700,$=72,ne=128,fe="-",Ee=/^xn--/,_e=/[^\x20-\x7E]/,Se=/[\x2E\u3002\uFF0E\uFF61]/g,Pe={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},ve=C-M,ye=Math.floor,Ae=String.fromCharCode,Ne;function it(Ye){throw RangeError(Pe[Ye])}function gt(Ye,st){for(var vt=Ye.length,Ot=[];vt--;)Ot[vt]=st(Ye[vt]);return Ot}function nt(Ye,st){var vt=Ye.split("@"),Ot="";vt.length>1&&(Ot=vt[0]+"@",Ye=vt[1]),Ye=Ye.replace(Se,".");var Et=Ye.split("."),pr=gt(Et,st).join(".");return Ot+pr}function Zt(Ye){for(var st=[],vt=0,Ot=Ye.length,Et,pr;vt<Ot;)Et=Ye.charCodeAt(vt++),Et>=55296&&Et<=56319&&vt<Ot?(pr=Ye.charCodeAt(vt++),(pr&64512)==56320?st.push(((Et&1023)<<10)+(pr&1023)+65536):(st.push(Et),vt--)):st.push(Et);return st}function kt(Ye){return gt(Ye,function(st){var vt="";return st>65535&&(st-=65536,vt+=Ae(st>>>10&1023|55296),st=56320|st&1023),vt+=Ae(st),vt}).join("")}function ur(Ye){return Ye-48<10?Ye-22:Ye-65<26?Ye-65:Ye-97<26?Ye-97:C}function hi(Ye,st){return Ye+22+75*(Ye<26)-((st!=0)<<5)}function pi(Ye,st,vt){var Ot=0;for(Ye=vt?ye(Ye/Z):Ye>>1,Ye+=ye(Ye/st);Ye>ve*D>>1;Ot+=C)Ye=ye(Ye/ve);return ye(Ot+(ve+1)*Ye/(Ye+O))}function zi(Ye){var st=[],vt=Ye.length,Ot,Et=0,pr=ne,Vt=$,yr,Qt,Cr,di,xr,dr,Ht,tr,Ur;for(yr=Ye.lastIndexOf(fe),yr<0&&(yr=0),Qt=0;Qt<yr;++Qt)Ye.charCodeAt(Qt)>=128&&it("not-basic"),st.push(Ye.charCodeAt(Qt));for(Cr=yr>0?yr+1:0;Cr<vt;){for(di=Et,xr=1,dr=C;Cr>=vt&&it("invalid-input"),Ht=ur(Ye.charCodeAt(Cr++)),(Ht>=C||Ht>ye((l-Et)/xr))&&it("overflow"),Et+=Ht*xr,tr=dr<=Vt?M:dr>=Vt+D?D:dr-Vt,!(Ht<tr);dr+=C)Ur=C-tr,xr>ye(l/Ur)&&it("overflow"),xr*=Ur;Ot=st.length+1,Vt=pi(Et-di,Ot,di==0),ye(Et/Ot)>l-pr&&it("overflow"),pr+=ye(Et/Ot),Et%=Ot,st.splice(Et++,0,pr)}return kt(st)}function Ri(Ye){var st,vt,Ot,Et,pr,Vt,yr,Qt,Cr,di,xr,dr=[],Ht,tr,Ur,Li;for(Ye=Zt(Ye),Ht=Ye.length,st=ne,vt=0,pr=$,Vt=0;Vt<Ht;++Vt)xr=Ye[Vt],xr<128&&dr.push(Ae(xr));for(Ot=Et=dr.length,Et&&dr.push(fe);Ot<Ht;){for(yr=l,Vt=0;Vt<Ht;++Vt)xr=Ye[Vt],xr>=st&&xr<yr&&(yr=xr);for(tr=Ot+1,yr-st>ye((l-vt)/tr)&&it("overflow"),vt+=(yr-st)*tr,st=yr,Vt=0;Vt<Ht;++Vt)if(xr=Ye[Vt],xr<st&&++vt>l&&it("overflow"),xr==st){for(Qt=vt,Cr=C;di=Cr<=pr?M:Cr>=pr+D?D:Cr-pr,!(Qt<di);Cr+=C)Li=Qt-di,Ur=C-di,dr.push(Ae(hi(di+Li%Ur,0))),Qt=ye(Li/Ur);dr.push(Ae(hi(Qt,0))),pr=pi(vt,tr,Ot==Et),vt=0,++Ot}++vt,++st}return dr.join("")}function br(Ye){return nt(Ye,function(st){return Ee.test(st)?zi(st.slice(4).toLowerCase()):st})}function Ft(Ye){return nt(Ye,function(st){return _e.test(st)?"xn--"+Ri(st):st})}if(f={version:"1.3.2",ucs2:{decode:Zt,encode:kt},decode:zi,encode:Ri,toASCII:Ft,toUnicode:br},p&&m)if(i.exports==p)m.exports=f;else for(Ne in f)f.hasOwnProperty(Ne)&&(p[Ne]=f[Ne]);else s.punycode=f})(_g)})(hy,hy.exports);hy.exports;function Sw(i,...r){for(const s of r)for(const p in s)i[p]=s[p];return i}class nI extends Error{constructor(r,s){super(s),this.message=s,this.key=r}}var qa=nI;class Wy{constructor(r,s=[]){this.parent=r,this.bindings={};for(const[p,m]of s)this.bindings[p]=m}concat(r){return new Wy(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return this.bindings[r]?!0:this.parent?this.parent.has(r):!1}}var aI=Wy;const Af={kind:"null"},Xe={kind:"number"},Ut={kind:"string"},Dt={kind:"boolean"},Po={kind:"color"},Kc={kind:"object"},jt={kind:"value"},oI={kind:"error"},If={kind:"collator"},Ef={kind:"formatted"},up={kind:"resolvedImage"};function Hn(i,r){return{kind:"array",itemType:i,N:r}}function Er(i){if(i.kind==="array"){const r=Er(i.itemType);return typeof i.N=="number"?`array<${r}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${r}>`}else return i.kind}const sI=[Af,Xe,Ut,Dt,Po,Ef,Kc,Hn(jt),up];function Jh(i,r){if(r.kind==="error")return null;if(i.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!Jh(i.itemType,r.itemType))&&(typeof i.N!="number"||i.N===r.N))return null}else{if(i.kind===r.kind)return null;if(i.kind==="value"){for(const s of sI)if(!Jh(s,r))return null}}return`Expected ${Er(i)} but found ${Er(r)} instead.`}function Hy(i,r){return r.some(s=>s.kind===i.kind)}function Qh(i,r){return r.some(s=>s==="null"?i===null:s==="array"?Array.isArray(i):s==="object"?i&&!Array.isArray(i)&&typeof i=="object":s===typeof i)}var lI={},kw,Sb={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Fh(i){return i=Math.round(i),i<0?0:i>255?255:i}function kb(i){return i<0?0:i>1?1:i}function vg(i){return i[i.length-1]==="%"?Fh(parseFloat(i)/100*255):Fh(parseInt(i))}function zd(i){return i[i.length-1]==="%"?kb(parseFloat(i)/100):kb(parseFloat(i))}function bg(i,r,s){return s<0?s+=1:s>1&&(s-=1),s*6<1?i+(r-i)*s*6:s*2<1?r:s*3<2?i+(r-i)*(2/3-s)*6:i}function cI(i){var r=i.replace(/ /g,"").toLowerCase();if(r in Sb)return Sb[r].slice();if(r[0]==="#"){if(r.length===4){var s=parseInt(r.substr(1),16);return s>=0&&s<=4095?[(s&3840)>>4|(s&3840)>>8,s&240|(s&240)>>4,s&15|(s&15)<<4,1]:null}else if(r.length===7){var s=parseInt(r.substr(1),16);return s>=0&&s<=16777215?[(s&16711680)>>16,(s&65280)>>8,s&255,1]:null}return null}var p=r.indexOf("("),m=r.indexOf(")");if(p!==-1&&m+1===r.length){var b=r.substr(0,p),f=r.substr(p+1,m-(p+1)).split(","),l=1;switch(b){case"rgba":if(f.length!==4)return null;l=zd(f.pop());case"rgb":return f.length!==3?null:[vg(f[0]),vg(f[1]),vg(f[2]),l];case"hsla":if(f.length!==4)return null;l=zd(f.pop());case"hsl":if(f.length!==3)return null;var C=(parseFloat(f[0])%360+360)%360/360,M=zd(f[1]),D=zd(f[2]),O=D<=.5?D*(M+1):D+M-D*M,Z=D*2-O;return[Fh(bg(Z,O,C+1/3)*255),Fh(bg(Z,O,C)*255),Fh(bg(Z,O,C-1/3)*255),l];default:return null}}return null}try{kw=lI.parseCSSColor=cI}catch{}class ln{constructor(r,s,p,m=1){this.r=r,this.g=s,this.b=p,this.a=m}static parse(r){if(!r)return;if(r instanceof ln)return r;if(typeof r!="string")return;const s=kw(r);if(s)return new ln(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3])}toString(){const[r,s,p,m]=this.toArray();return`rgba(${Math.round(r)},${Math.round(s)},${Math.round(p)},${m})`}toArray(){const{r,g:s,b:p,a:m}=this;return m===0?[0,0,0,0]:[r*255/m,s*255/m,p*255/m,m]}toArray01(){const{r,g:s,b:p,a:m}=this;return m===0?[0,0,0,0]:[r/m,s/m,p/m,m]}toArray01PremultipliedAlpha(){const{r,g:s,b:p,a:m}=this;return[r,s,p,m]}}ln.black=new ln(0,0,0,1);ln.white=new ln(1,1,1,1);ln.transparent=new ln(0,0,0,0);ln.red=new ln(1,0,0,1);ln.blue=new ln(0,0,1,1);var Ai=ln;class Xy{constructor(r,s,p){r?this.sensitivity=s?"variant":"case":this.sensitivity=s?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,s){return this.collator.compare(r,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class py{constructor(r,s,p,m,b){this.text=r.normalize?r.normalize():r,this.image=s,this.scale=p,this.fontStack=m,this.textColor=b}}class _a{constructor(r){this.sections=r}static fromString(r){return new _a([new py(r,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(r=>r.text.length!==0||r.image&&r.image.name.length!==0)}static factory(r){return r instanceof _a?r:_a.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map(r=>r.text).join("")}serialize(){const r=["format"];for(const s of this.sections){if(s.image){r.push(["image",s.image.name]);continue}r.push(s.text);const p={};s.fontStack&&(p["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(p["font-scale"]=s.scale),s.textColor&&(p["text-color"]=["rgba"].concat(s.textColor.toArray())),r.push(p)}return r}}class Eo{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new Eo({name:r,available:!1}):null}serialize(){return["image",this.name]}}function Cw(i,r,s,p){return typeof i=="number"&&i>=0&&i<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof s=="number"&&s>=0&&s<=255?typeof p>"u"||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[i,r,s,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[i,r,s,p]:[i,r,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function nf(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Ai||i instanceof Xy||i instanceof _a||i instanceof Eo)return!0;if(Array.isArray(i)){for(const r of i)if(!nf(r))return!1;return!0}else if(typeof i=="object"){for(const r in i)if(!nf(i[r]))return!1;return!0}else return!1}function ui(i){if(i===null)return Af;if(typeof i=="string")return Ut;if(typeof i=="boolean")return Dt;if(typeof i=="number")return Xe;if(i instanceof Ai)return Po;if(i instanceof Xy)return If;if(i instanceof _a)return Ef;if(i instanceof Eo)return up;if(Array.isArray(i)){const r=i.length;let s;for(const p of i){const m=ui(p);if(!s)s=m;else{if(s===m)continue;s=jt;break}}return Hn(s||jt,r)}else return Kc}function Oh(i){const r=typeof i;return i===null?"":r==="string"||r==="number"||r==="boolean"?String(i):i instanceof Ai||i instanceof _a||i instanceof Eo?i.toString():JSON.stringify(i)}class Ky{constructor(r,s){this.type=r,this.value=s}static parse(r,s){if(r.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!nf(r[1]))return s.error("invalid value");const p=r[1];let m=ui(p);const b=s.expectedType;return m.kind==="array"&&m.N===0&&b&&b.kind==="array"&&(typeof b.N!="number"||b.N===0)&&(m=b),new Ky(m,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ai?["rgba"].concat(this.value.toArray()):this.value instanceof _a?this.value.serialize():this.value}}var af=Ky;class uI{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}var Ii=uI;const xg={string:Ut,number:Xe,boolean:Dt,object:Kc};class Yy{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");let p=1,m;const b=r[0];if(b==="array"){let l;if(r.length>2){const M=r[1];if(typeof M!="string"||!(M in xg)||M==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);l=xg[M],p++}else l=jt;let C;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return s.error('The length argument to "array" must be a positive integer literal',2);C=r[2],p++}m=Hn(l,C)}else m=xg[b];const f=[];for(;p<r.length;p++){const l=s.parse(r[p],p,jt);if(!l)return null;f.push(l)}return new Yy(m,f)}evaluate(r){for(let s=0;s<this.args.length;s++){const p=this.args[s].evaluate(r);if(Jh(this.type,ui(p))){if(s===this.args.length-1)throw new Ii(`Expected value to be of type ${Er(this.type)}, but found ${Er(ui(p))} instead.`)}else return p}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=this.type,s=[r.kind];if(r.kind==="array"){const p=r.itemType;if(p.kind==="string"||p.kind==="number"||p.kind==="boolean"){s.push(p.kind);const m=r.N;(typeof m=="number"||this.args.length>1)&&s.push(m)}}return s.concat(this.args.map(p=>p.serialize()))}}var To=Yy;class zf{constructor(r){this.type=Ef,this.sections=r}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");const p=r[1];if(!Array.isArray(p)&&typeof p=="object")return s.error("First argument must be an image or text section.");const m=[];let b=!1;for(let f=1;f<=r.length-1;++f){const l=r[f];if(b&&typeof l=="object"&&!Array.isArray(l)){b=!1;let C=null;if(l["font-scale"]&&(C=s.parse(l["font-scale"],1,Xe),!C))return null;let M=null;if(l["text-font"]&&(M=s.parse(l["text-font"],1,Hn(Ut)),!M))return null;let D=null;if(l["text-color"]&&(D=s.parse(l["text-color"],1,Po),!D))return null;const O=m[m.length-1];O.scale=C,O.font=M,O.textColor=D}else{const C=s.parse(r[f],1,jt);if(!C)return null;const M=C.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,m.push({content:C,scale:null,font:null,textColor:null})}}return new zf(m)}evaluate(r){const s=p=>{const m=p.content.evaluate(r);return ui(m)===up?new py("",m,null,null,null):new py(Oh(m),null,p.scale?p.scale.evaluate(r):null,p.font?p.font.evaluate(r).join(","):null,p.textColor?p.textColor.evaluate(r):null)};return new _a(this.sections.map(s))}eachChild(r){for(const s of this.sections)r(s.content),s.scale&&r(s.scale),s.font&&r(s.font),s.textColor&&r(s.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const s of this.sections){r.push(s.content.serialize());const p={};s.scale&&(p["font-scale"]=s.scale.serialize()),s.font&&(p["text-font"]=s.font.serialize()),s.textColor&&(p["text-color"]=s.textColor.serialize()),r.push(p)}return r}}class Rf{constructor(r){this.type=up,this.input=r}static parse(r,s){if(r.length!==2)return s.error("Expected two arguments.");const p=s.parse(r[1],1,Ut);return p?new Rf(p):s.error("No image name provided.")}evaluate(r){const s=this.input.evaluate(r),p=Eo.fromString(s);return p&&r.availableImages&&(p.available=r.availableImages.indexOf(s)>-1),p}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const hI={"to-boolean":Dt,"to-color":Po,"to-number":Xe,"to-string":Ut};class Jy{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expected at least one argument.");const p=r[0];if((p==="to-boolean"||p==="to-string")&&r.length!==2)return s.error("Expected one argument.");const m=hI[p],b=[];for(let f=1;f<r.length;f++){const l=s.parse(r[f],f,jt);if(!l)return null;b.push(l)}return new Jy(m,b)}evaluate(r){if(this.type.kind==="boolean")return!!this.args[0].evaluate(r);if(this.type.kind==="color"){let s,p;for(const m of this.args){if(s=m.evaluate(r),p=null,s instanceof Ai)return s;if(typeof s=="string"){const b=r.parseColor(s);if(b)return b}else if(Array.isArray(s)&&(s.length<3||s.length>4?p=`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:p=Cw(s[0],s[1],s[2],s[3]),!p))return new Ai(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Ii(p||`Could not parse color from value '${typeof s=="string"?s:String(JSON.stringify(s))}'`)}else if(this.type.kind==="number"){let s=null;for(const p of this.args){if(s=p.evaluate(r),s===null)return 0;const m=Number(s);if(!isNaN(m))return m}throw new Ii(`Could not convert ${JSON.stringify(s)} to number.`)}else return this.type.kind==="formatted"?_a.fromString(Oh(this.args[0].evaluate(r))):this.type.kind==="resolvedImage"?Eo.fromString(Oh(this.args[0].evaluate(r))):Oh(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){if(this.type.kind==="formatted")return new zf([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Rf(this.args[0]).serialize();const r=[`to-${this.type.kind}`];return this.eachChild(s=>{r.push(s.serialize())}),r}}var Vc=Jy;const pI=["Unknown","Point","LineString","Polygon"];class dI{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?pI[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const r=this.featureDistanceData.center,s=this.featureDistanceData.scale,{x:p,y:m}=this.featureTileCoord,b=p*s-r[0],f=m*s-r[1],l=this.featureDistanceData.bearing[0],C=this.featureDistanceData.bearing[1];return l*b+C*f}return 0}parseColor(r){let s=this._parseColorCache[r];return s||(s=this._parseColorCache[r]=Ai.parse(r)),s}}var Pw=dI;class qc{constructor(r,s,p,m){this.name=r,this.type=s,this._evaluate=p,this.args=m}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(r=>r.serialize()))}static parse(r,s){const p=r[0],m=qc.definitions[p];if(!m)return s.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const b=Array.isArray(m)?m[0]:m.type,f=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,l=f.filter(([M])=>!Array.isArray(M)||M.length===r.length-1);let C=null;for(const[M,D]of l){C=new zw(s.registry,s.path,null,s.scope);const O=[];let Z=!1;for(let $=1;$<r.length;$++){const ne=r[$],fe=Array.isArray(M)?M[$-1]:M.type,Ee=C.parse(ne,1+O.length,fe);if(!Ee){Z=!0;break}O.push(Ee)}if(!Z){if(Array.isArray(M)&&M.length!==O.length){C.error(`Expected ${M.length} arguments, but found ${O.length} instead.`);continue}for(let $=0;$<O.length;$++){const ne=Array.isArray(M)?M[$]:M.type,fe=O[$];C.concat($+1).checkSubtype(ne,fe.type)}if(C.errors.length===0)return new qc(p,b,D,O)}}if(l.length===1)s.errors.push(...C.errors);else{const M=(l.length?l:f).map(([O])=>fI(O)).join(" | "),D=[];for(let O=1;O<r.length;O++){const Z=s.parse(r[O],1+D.length);if(!Z)return null;D.push(Er(Z.type))}s.error(`Expected arguments of type ${M}, but found (${D.join(", ")}) instead.`)}return null}static register(r,s){qc.definitions=s;for(const p in s)r[p]=qc}}function fI(i){return Array.isArray(i)?`(${i.map(Er).join(", ")})`:`(${Er(i.type)}...)`}var ou=qc;class Lf{constructor(r,s,p){this.type=If,this.locale=p,this.caseSensitive=r,this.diacriticSensitive=s}static parse(r,s){if(r.length!==2)return s.error("Expected one argument.");const p=r[1];if(typeof p!="object"||Array.isArray(p))return s.error("Collator options argument must be an object.");const m=s.parse(p["case-sensitive"]===void 0?!1:p["case-sensitive"],1,Dt);if(!m)return null;const b=s.parse(p["diacritic-sensitive"]===void 0?!1:p["diacritic-sensitive"],1,Dt);if(!b)return null;let f=null;return p.locale&&(f=s.parse(p.locale,1,Ut),!f)?null:new Lf(m,b,f)}evaluate(r){return new Xy(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}const ys=8192;function Qy(i,r){i[0]=Math.min(i[0],r[0]),i[1]=Math.min(i[1],r[1]),i[2]=Math.max(i[2],r[0]),i[3]=Math.max(i[3],r[1])}function mI(i){return(180+i)/360}function gI(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function of(i,r){return!(i[0]<=r[0]||i[2]>=r[2]||i[1]<=r[1]||i[3]>=r[3])}function yI(i,r){const s=mI(i[0]),p=gI(i[1]),m=Math.pow(2,r.z);return[Math.round(s*m*ys),Math.round(p*m*ys)]}function _I(i,r,s){const p=i[0]-r[0],m=i[1]-r[1],b=i[0]-s[0],f=i[1]-s[1];return p*f-b*m===0&&p*b<=0&&m*f<=0}function vI(i,r,s){return r[1]>i[1]!=s[1]>i[1]&&i[0]<(s[0]-r[0])*(i[1]-r[1])/(s[1]-r[1])+r[0]}function e0(i,r){let s=!1;for(let p=0,m=r.length;p<m;p++){const b=r[p];for(let f=0,l=b.length;f<l-1;f++){if(_I(i,b[f],b[f+1]))return!1;vI(i,b[f],b[f+1])&&(s=!s)}}return s}function bI(i,r){for(let s=0;s<r.length;s++)if(e0(i,r[s]))return!0;return!1}function xI(i,r){return i[0]*r[1]-i[1]*r[0]}function Cb(i,r,s,p){const m=i[0]-s[0],b=i[1]-s[1],f=r[0]-s[0],l=r[1]-s[1],C=p[0]-s[0],M=p[1]-s[1],D=m*M-C*b,O=f*M-C*l;return D>0&&O<0||D<0&&O>0}function wI(i,r,s,p){const m=[r[0]-i[0],r[1]-i[1]],b=[p[0]-s[0],p[1]-s[1]];return xI(b,m)===0?!1:!!(Cb(i,r,s,p)&&Cb(s,p,i,r))}function TI(i,r,s){for(const p of s)for(let m=0;m<p.length-1;++m)if(wI(i,r,p[m],p[m+1]))return!0;return!1}function Mw(i,r){for(let s=0;s<i.length;++s)if(!e0(i[s],r))return!1;for(let s=0;s<i.length-1;++s)if(TI(i[s],i[s+1],r))return!1;return!0}function SI(i,r){for(let s=0;s<r.length;s++)if(Mw(i,r[s]))return!0;return!1}function t0(i,r,s){const p=[];for(let m=0;m<i.length;m++){const b=[];for(let f=0;f<i[m].length;f++){const l=yI(i[m][f],s);Qy(r,l),b.push(l)}p.push(b)}return p}function Aw(i,r,s){const p=[];for(let m=0;m<i.length;m++){const b=t0(i[m],r,s);p.push(b)}return p}function Iw(i,r,s,p){if(i[0]<s[0]||i[0]>s[2]){const m=p*.5;let b=i[0]-s[0]>m?-p:s[0]-i[0]>m?p:0;b===0&&(b=i[0]-s[2]>m?-p:s[2]-i[0]>m?p:0),i[0]+=b}Qy(r,i)}function kI(i){i[0]=i[1]=1/0,i[2]=i[3]=-1/0}function Pb(i,r,s,p){const m=Math.pow(2,p.z)*ys,b=[p.x*ys,p.y*ys],f=[];if(!i)return f;for(const l of i)for(const C of l){const M=[C.x+b[0],C.y+b[1]];Iw(M,r,s,m),f.push(M)}return f}function Mb(i,r,s,p){const m=Math.pow(2,p.z)*ys,b=[p.x*ys,p.y*ys],f=[];if(!i)return f;for(const l of i){const C=[];for(const M of l){const D=[M.x+b[0],M.y+b[1]];Qy(r,D),C.push(D)}f.push(C)}if(r[2]-r[0]<=m/2){kI(r);for(const l of f)for(const C of l)Iw(C,r,s,m)}return f}function CI(i,r){const s=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(!m)return!1;if(r.type==="Polygon"){const b=t0(r.coordinates,p,m),f=Pb(i.geometry(),s,p,m);if(!of(s,p))return!1;for(const l of f)if(!e0(l,b))return!1}if(r.type==="MultiPolygon"){const b=Aw(r.coordinates,p,m),f=Pb(i.geometry(),s,p,m);if(!of(s,p))return!1;for(const l of f)if(!bI(l,b))return!1}return!0}function PI(i,r){const s=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(!m)return!1;if(r.type==="Polygon"){const b=t0(r.coordinates,p,m),f=Mb(i.geometry(),s,p,m);if(!of(s,p))return!1;for(const l of f)if(!Mw(l,b))return!1}if(r.type==="MultiPolygon"){const b=Aw(r.coordinates,p,m),f=Mb(i.geometry(),s,p,m);if(!of(s,p))return!1;for(const l of f)if(!SI(l,b))return!1}return!0}class Bh{constructor(r,s){this.type=Dt,this.geojson=r,this.geometries=s}static parse(r,s){if(r.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(nf(r[1])){const p=r[1];if(p.type==="FeatureCollection")for(let m=0;m<p.features.length;++m){const b=p.features[m].geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new Bh(p,p.features[m].geometry)}else if(p.type==="Feature"){const m=p.geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new Bh(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new Bh(p,p)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return CI(r,this.geometries);if(r.geometryType()==="LineString")return PI(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var r0=Bh;function i0(i){if(i instanceof ou&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof r0)return!1;let r=!0;return i.eachChild(s=>{r&&!i0(s)&&(r=!1)}),r}function n0(i){if(i instanceof ou&&i.name==="feature-state")return!1;let r=!0;return i.eachChild(s=>{r&&!n0(s)&&(r=!1)}),r}function a0(i,r){if(i instanceof ou&&r.indexOf(i.name)>=0)return!1;let s=!0;return i.eachChild(p=>{s&&!a0(p,r)&&(s=!1)}),s}class o0{constructor(r,s){this.type=s.type,this.name=r,this.boundExpression=s}static parse(r,s){if(r.length!==2||typeof r[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const p=r[1];return s.scope.has(p)?new o0(p,s.scope.get(p)):s.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Ew=o0;class s0{constructor(r,s=[],p,m=new aI,b=[]){this.registry=r,this.path=s,this.key=s.map(f=>`[${f}]`).join(""),this.scope=m,this.errors=b,this.expectedType=p}parse(r,s,p,m,b={}){return s?this.concat(s,p,m)._parse(r,b):this._parse(r,b)}_parse(r,s){(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number")&&(r=["literal",r]);function p(m,b,f){return f==="assert"?new To(b,[m]):f==="coerce"?new Vc(b,[m]):m}if(Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=r[0];if(typeof m!="string")return this.error(`Expression name must be a string, but found ${typeof m} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const b=this.registry[m];if(b){let f=b.parse(r,this);if(!f)return null;if(this.expectedType){const l=this.expectedType,C=f.type;if((l.kind==="string"||l.kind==="number"||l.kind==="boolean"||l.kind==="object"||l.kind==="array")&&C.kind==="value")f=p(f,l,s.typeAnnotation||"assert");else if((l.kind==="color"||l.kind==="formatted"||l.kind==="resolvedImage")&&(C.kind==="value"||C.kind==="string"))f=p(f,l,s.typeAnnotation||"coerce");else if(this.checkSubtype(l,C))return null}if(!(f instanceof af)&&f.type.kind!=="resolvedImage"&&dy(f)){const l=new Pw;try{f=new af(f.type,f.evaluate(l))}catch(C){return this.error(C.message),null}}return f}return this.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof r>"u"?this.error("'undefined' value invalid. Use null instead."):typeof r=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof r} instead.`)}concat(r,s,p){const m=typeof r=="number"?this.path.concat(r):this.path,b=p?this.scope.concat(p):this.scope;return new s0(this.registry,m,s||null,b,this.errors)}error(r,...s){const p=`${this.key}${s.map(m=>`[${m}]`).join("")}`;this.errors.push(new qa(p,r))}checkSubtype(r,s){const p=Jh(r,s);return p&&this.error(p),p}}var zw=s0;function dy(i){if(i instanceof Ew)return dy(i.boundExpression);if(i instanceof ou&&i.name==="error"||i instanceof Lf||i instanceof r0)return!1;const r=i instanceof Vc||i instanceof To;let s=!0;return i.eachChild(p=>{r?s=s&&dy(p):s=s&&p instanceof af}),s?i0(i)&&a0(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"]):!1}function Df(i,r){const s=i.length-1;let p=0,m=s,b=0,f,l;for(;p<=m;)if(b=Math.floor((p+m)/2),f=i[b],l=i[b+1],f<=r){if(b===s||r<l)return b;p=b+1}else if(f>r)m=b-1;else throw new Ii("Input is not a number.");return 0}class l0{constructor(r,s,p){this.type=r,this.input=s,this.labels=[],this.outputs=[];for(const[m,b]of p)this.labels.push(m),this.outputs.push(b)}static parse(r,s){if(r.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!==0)return s.error("Expected an even number of arguments.");const p=s.parse(r[1],1,Xe);if(!p)return null;const m=[];let b=null;s.expectedType&&s.expectedType.kind!=="value"&&(b=s.expectedType);for(let f=1;f<r.length;f+=2){const l=f===1?-1/0:r[f],C=r[f+1],M=f,D=f+1;if(typeof l!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(m.length&&m[m.length-1][0]>=l)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const O=s.parse(C,D,b);if(!O)return null;b=b||O.type,m.push([l,O])}return new l0(b,p,m)}evaluate(r){const s=this.labels,p=this.outputs;if(s.length===1)return p[0].evaluate(r);const m=this.input.evaluate(r);if(m<=s[0])return p[0].evaluate(r);const b=s.length;if(m>=s[b-1])return p[b-1].evaluate(r);const f=Df(s,m);return p[f].evaluate(r)}eachChild(r){r(this.input);for(const s of this.outputs)r(s)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){const r=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&r.push(this.labels[s]),r.push(this.outputs[s].serialize());return r}}var Rw=l0,MI=Lw;function Lw(i,r,s,p){this.cx=3*i,this.bx=3*(s-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(p-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=r,this.p2x=s,this.p2y=p}Lw.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,r){if(r===void 0&&(r=1e-6),i<0)return 0;if(i>1)return 1;for(var s=i,p=0;p<8;p++){var m=this.sampleCurveX(s)-i;if(Math.abs(m)<r)return s;var b=this.sampleCurveDerivativeX(s);if(Math.abs(b)<1e-6)break;s=s-m/b}var f=0,l=1;for(s=i,p=0;p<20&&(m=this.sampleCurveX(s),!(Math.abs(m-i)<r));p++)i>m?f=s:l=s,s=(l-f)*.5+f;return s},solve:function(i,r){return this.sampleCurveY(this.solveCurveX(i,r))}};function Rn(i,r,s){return i*(1-s)+r*s}function AI(i,r,s){return new Ai(Rn(i.r,r.r,s),Rn(i.g,r.g,s),Rn(i.b,r.b,s),Rn(i.a,r.a,s))}function II(i,r,s){return i.map((p,m)=>Rn(p,r[m],s))}var Dw=Object.freeze({__proto__:null,number:Rn,color:AI,array:II});const jw=.95047,Fw=1,Ow=1.08883,Bw=4/29,Yc=6/29,$w=3*Yc*Yc,EI=Yc*Yc*Yc,zI=Math.PI/180,RI=180/Math.PI;function wg(i){return i>EI?Math.pow(i,1/3):i/$w+Bw}function Tg(i){return i>Yc?i*i*i:$w*(i-Bw)}function Sg(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function kg(i){return i/=255,i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Nw(i){const r=kg(i.r),s=kg(i.g),p=kg(i.b),m=wg((.4124564*r+.3575761*s+.1804375*p)/jw),b=wg((.2126729*r+.7151522*s+.072175*p)/Fw),f=wg((.0193339*r+.119192*s+.9503041*p)/Ow);return{l:116*b-16,a:500*(m-b),b:200*(b-f),alpha:i.a}}function Uw(i){let r=(i.l+16)/116,s=isNaN(i.a)?r:r+i.a/500,p=isNaN(i.b)?r:r-i.b/200;return r=Fw*Tg(r),s=jw*Tg(s),p=Ow*Tg(p),new Ai(Sg(3.2404542*s-1.5371385*r-.4985314*p),Sg(-.969266*s+1.8760108*r+.041556*p),Sg(.0556434*s-.2040259*r+1.0572252*p),i.alpha)}function LI(i,r,s){return{l:Rn(i.l,r.l,s),a:Rn(i.a,r.a,s),b:Rn(i.b,r.b,s),alpha:Rn(i.alpha,r.alpha,s)}}function DI(i){const{l:r,a:s,b:p}=Nw(i),m=Math.atan2(p,s)*RI;return{h:m<0?m+360:m,c:Math.sqrt(s*s+p*p),l:r,alpha:i.a}}function jI(i){const r=i.h*zI,s=i.c,p=i.l;return Uw({l:p,a:Math.cos(r)*s,b:Math.sin(r)*s,alpha:i.alpha})}function FI(i,r,s){const p=r-i;return i+s*(p>180||p<-180?p-360*Math.round(p/360):p)}function OI(i,r,s){return{h:FI(i.h,r.h,s),c:Rn(i.c,r.c,s),l:Rn(i.l,r.l,s),alpha:Rn(i.alpha,r.alpha,s)}}const Ph={forward:Nw,reverse:Uw,interpolate:LI},Mh={forward:DI,reverse:jI,interpolate:OI};var Vw=Object.freeze({__proto__:null,lab:Ph,hcl:Mh});class sf{constructor(r,s,p,m,b){this.type=r,this.operator=s,this.interpolation=p,this.input=m,this.labels=[],this.outputs=[];for(const[f,l]of b)this.labels.push(f),this.outputs.push(l)}static interpolationFactor(r,s,p,m){let b=0;if(r.name==="exponential")b=Cg(s,r.base,p,m);else if(r.name==="linear")b=Cg(s,1,p,m);else if(r.name==="cubic-bezier"){const f=r.controlPoints;b=new MI(f[0],f[1],f[2],f[3]).solve(Cg(s,1,p,m))}return b}static parse(r,s){let[p,m,b,...f]=r;if(!Array.isArray(m)||m.length===0)return s.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){const M=m[1];if(typeof M!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:M}}else if(m[0]==="cubic-bezier"){const M=m.slice(1);if(M.length!==4||M.some(D=>typeof D!="number"||D<0||D>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:M}}else return s.error(`Unknown interpolation type ${String(m[0])}`,1,0);if(r.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!==0)return s.error("Expected an even number of arguments.");if(b=s.parse(b,2,Xe),!b)return null;const l=[];let C=null;p==="interpolate-hcl"||p==="interpolate-lab"?C=Po:s.expectedType&&s.expectedType.kind!=="value"&&(C=s.expectedType);for(let M=0;M<f.length;M+=2){const D=f[M],O=f[M+1],Z=M+3,$=M+4;if(typeof D!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Z);if(l.length&&l[l.length-1][0]>=D)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Z);const ne=s.parse(O,$,C);if(!ne)return null;C=C||ne.type,l.push([D,ne])}return C.kind!=="number"&&C.kind!=="color"&&!(C.kind==="array"&&C.itemType.kind==="number"&&typeof C.N=="number")?s.error(`Type ${Er(C)} is not interpolatable.`):new sf(C,p,m,b,l)}evaluate(r){const s=this.labels,p=this.outputs;if(s.length===1)return p[0].evaluate(r);const m=this.input.evaluate(r);if(m<=s[0])return p[0].evaluate(r);const b=s.length;if(m>=s[b-1])return p[b-1].evaluate(r);const f=Df(s,m),l=s[f],C=s[f+1],M=sf.interpolationFactor(this.interpolation,m,l,C),D=p[f].evaluate(r),O=p[f+1].evaluate(r);return this.operator==="interpolate"?Dw[this.type.kind.toLowerCase()](D,O,M):this.operator==="interpolate-hcl"?Mh.reverse(Mh.interpolate(Mh.forward(D),Mh.forward(O),M)):Ph.reverse(Ph.interpolate(Ph.forward(D),Ph.forward(O),M))}eachChild(r){r(this.input);for(const s of this.outputs)r(s)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){let r;this.interpolation.name==="linear"?r=["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?r=["linear"]:r=["exponential",this.interpolation.base]:r=["cubic-bezier"].concat(this.interpolation.controlPoints);const s=[this.operator,r,this.input.serialize()];for(let p=0;p<this.labels.length;p++)s.push(this.labels[p],this.outputs[p].serialize());return s}}function Cg(i,r,s,p){const m=p-s,b=i-s;return m===0?0:r===1?b/m:(Math.pow(r,b)-1)/(Math.pow(r,m)-1)}var Mo=sf;class lf{constructor(r,s){this.type=r,this.args=s}static parse(r,s){if(r.length<2)return s.error("Expectected at least one argument.");let p=null;const m=s.expectedType;m&&m.kind!=="value"&&(p=m);const b=[];for(const f of r.slice(1)){const l=s.parse(f,1+b.length,p,void 0,{typeAnnotation:"omit"});if(!l)return null;p=p||l.type,b.push(l)}return m&&b.some(f=>Jh(m,f.type))?new lf(jt,b):new lf(p,b)}evaluate(r){let s=null,p=0,m;for(const b of this.args){if(p++,s=b.evaluate(r),s&&s instanceof Eo&&!s.available&&(m||(m=s),s=null,p===this.args.length))return m;if(s!==null)break}return s}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=["coalesce"];return this.eachChild(s=>{r.push(s.serialize())}),r}}var qw=lf;class c0{constructor(r,s){this.type=s.type,this.bindings=[].concat(r),this.result=s}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const s of this.bindings)r(s[1]);r(this.result)}static parse(r,s){if(r.length<4)return s.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const p=[];for(let b=1;b<r.length-1;b+=2){const f=r[b];if(typeof f!="string")return s.error(`Expected string, but found ${typeof f} instead.`,b);if(/[^a-zA-Z0-9_]/.test(f))return s.error("Variable names must contain only alphanumeric characters or '_'.",b);const l=s.parse(r[b+1],b+1);if(!l)return null;p.push([f,l])}const m=s.parse(r[r.length-1],r.length-1,s.expectedType,p);return m?new c0(p,m):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[s,p]of this.bindings)r.push(s,p.serialize());return r.push(this.result.serialize()),r}}var Gw=c0;class u0{constructor(r,s,p){this.type=r,this.index=s,this.input=p}static parse(r,s){if(r.length!==3)return s.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const p=s.parse(r[1],1,Xe),m=s.parse(r[2],2,Hn(s.expectedType||jt));if(!p||!m)return null;const b=m.type;return new u0(b.itemType,p,m)}evaluate(r){const s=this.index.evaluate(r),p=this.input.evaluate(r);if(s<0)throw new Ii(`Array index out of bounds: ${s} < 0.`);if(s>=p.length)throw new Ii(`Array index out of bounds: ${s} > ${p.length-1}.`);if(s!==Math.floor(s))throw new Ii(`Array index must be an integer, but found ${s} instead.`);return p[s]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var BI=u0;class h0{constructor(r,s){this.type=Dt,this.needle=r,this.haystack=s}static parse(r,s){if(r.length!==3)return s.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const p=s.parse(r[1],1,jt),m=s.parse(r[2],2,jt);return!p||!m?null:Hy(p.type,[Dt,Ut,Xe,Af,jt])?new h0(p,m):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Er(p.type)} instead`)}evaluate(r){const s=this.needle.evaluate(r),p=this.haystack.evaluate(r);if(p==null)return!1;if(!Qh(s,["boolean","string","number","null"]))throw new Ii(`Expected first argument to be of type boolean, string, number or null, but found ${Er(ui(s))} instead.`);if(!Qh(p,["string","array"]))throw new Ii(`Expected second argument to be of type array or string, but found ${Er(ui(p))} instead.`);return p.indexOf(s)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var $I=h0;class cf{constructor(r,s,p){this.type=Xe,this.needle=r,this.haystack=s,this.fromIndex=p}static parse(r,s){if(r.length<=2||r.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const p=s.parse(r[1],1,jt),m=s.parse(r[2],2,jt);if(!p||!m)return null;if(!Hy(p.type,[Dt,Ut,Xe,Af,jt]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Er(p.type)} instead`);if(r.length===4){const b=s.parse(r[3],3,Xe);return b?new cf(p,m,b):null}else return new cf(p,m)}evaluate(r){const s=this.needle.evaluate(r),p=this.haystack.evaluate(r);if(!Qh(s,["boolean","string","number","null"]))throw new Ii(`Expected first argument to be of type boolean, string, number or null, but found ${Er(ui(s))} instead.`);if(!Qh(p,["string","array"]))throw new Ii(`Expected second argument to be of type array or string, but found ${Er(ui(p))} instead.`);if(this.fromIndex){const m=this.fromIndex.evaluate(r);return p.indexOf(s,m)}return p.indexOf(s)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var NI=cf;class p0{constructor(r,s,p,m,b,f){this.inputType=r,this.type=s,this.input=p,this.cases=m,this.outputs=b,this.otherwise=f}static parse(r,s){if(r.length<5)return s.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!==1)return s.error("Expected an even number of arguments.");let p,m;s.expectedType&&s.expectedType.kind!=="value"&&(m=s.expectedType);const b={},f=[];for(let M=2;M<r.length-1;M+=2){let D=r[M];const O=r[M+1];Array.isArray(D)||(D=[D]);const Z=s.concat(M);if(D.length===0)return Z.error("Expected at least one branch label.");for(const ne of D){if(typeof ne!="number"&&typeof ne!="string")return Z.error("Branch labels must be numbers or strings.");if(typeof ne=="number"&&Math.abs(ne)>Number.MAX_SAFE_INTEGER)return Z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ne=="number"&&Math.floor(ne)!==ne)return Z.error("Numeric branch labels must be integer values.");if(!p)p=ui(ne);else if(Z.checkSubtype(p,ui(ne)))return null;if(typeof b[String(ne)]<"u")return Z.error("Branch labels must be unique.");b[String(ne)]=f.length}const $=s.parse(O,M,m);if(!$)return null;m=m||$.type,f.push($)}const l=s.parse(r[1],1,jt);if(!l)return null;const C=s.parse(r[r.length-1],r.length-1,m);return!C||l.type.kind!=="value"&&s.concat(1).checkSubtype(p,l.type)?null:new p0(p,m,l,b,f,C)}evaluate(r){const s=this.input.evaluate(r);return(ui(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),p=[],m={};for(const f of s){const l=m[this.cases[f]];l===void 0?(m[this.cases[f]]=p.length,p.push([this.cases[f],[f]])):p[l][1].push(f)}const b=f=>this.inputType.kind==="number"?Number(f):f;for(const[f,l]of p)l.length===1?r.push(b(l[0])):r.push(l.map(b)),r.push(this.outputs[f].serialize());return r.push(this.otherwise.serialize()),r}}var UI=p0;class d0{constructor(r,s,p){this.type=r,this.branches=s,this.otherwise=p}static parse(r,s){if(r.length<4)return s.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!==0)return s.error("Expected an odd number of arguments.");let p;s.expectedType&&s.expectedType.kind!=="value"&&(p=s.expectedType);const m=[];for(let f=1;f<r.length-1;f+=2){const l=s.parse(r[f],f,Dt);if(!l)return null;const C=s.parse(r[f+1],f+1,p);if(!C)return null;m.push([l,C]),p=p||C.type}const b=s.parse(r[r.length-1],r.length-1,p);return b?new d0(p,m,b):null}evaluate(r){for(const[s,p]of this.branches)if(s.evaluate(r))return p.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[s,p]of this.branches)r(s),r(p);r(this.otherwise)}outputDefined(){return this.branches.every(([r,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild(s=>{r.push(s.serialize())}),r}}var VI=d0;class uf{constructor(r,s,p,m){this.type=r,this.input=s,this.beginIndex=p,this.endIndex=m}static parse(r,s){if(r.length<=2||r.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const p=s.parse(r[1],1,jt),m=s.parse(r[2],2,Xe);if(!p||!m)return null;if(!Hy(p.type,[Hn(jt),Ut,jt]))return s.error(`Expected first argument to be of type array or string, but found ${Er(p.type)} instead`);if(r.length===4){const b=s.parse(r[3],3,Xe);return b?new uf(p.type,p,m,b):null}else return new uf(p.type,p,m)}evaluate(r){const s=this.input.evaluate(r),p=this.beginIndex.evaluate(r);if(!Qh(s,["string","array"]))throw new Ii(`Expected first argument to be of type array or string, but found ${Er(ui(s))} instead.`);if(this.endIndex){const m=this.endIndex.evaluate(r);return s.slice(p,m)}return s.slice(p)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var qI=uf;function Ab(i,r){return i==="=="||i==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function GI(i,r,s){return r===s}function ZI(i,r,s){return r!==s}function WI(i,r,s){return r<s}function HI(i,r,s){return r>s}function XI(i,r,s){return r<=s}function KI(i,r,s){return r>=s}function Zw(i,r,s,p){return p.compare(r,s)===0}function YI(i,r,s,p){return!Zw(i,r,s,p)}function JI(i,r,s,p){return p.compare(r,s)<0}function QI(i,r,s,p){return p.compare(r,s)>0}function eE(i,r,s,p){return p.compare(r,s)<=0}function tE(i,r,s,p){return p.compare(r,s)>=0}function su(i,r,s){const p=i!=="=="&&i!=="!=";return class Ww{constructor(b,f,l){this.type=Dt,this.lhs=b,this.rhs=f,this.collator=l,this.hasUntypedArgument=b.type.kind==="value"||f.type.kind==="value"}static parse(b,f){if(b.length!==3&&b.length!==4)return f.error("Expected two or three arguments.");const l=b[0];let C=f.parse(b[1],1,jt);if(!C)return null;if(!Ab(l,C.type))return f.concat(1).error(`"${l}" comparisons are not supported for type '${Er(C.type)}'.`);let M=f.parse(b[2],2,jt);if(!M)return null;if(!Ab(l,M.type))return f.concat(2).error(`"${l}" comparisons are not supported for type '${Er(M.type)}'.`);if(C.type.kind!==M.type.kind&&C.type.kind!=="value"&&M.type.kind!=="value")return f.error(`Cannot compare types '${Er(C.type)}' and '${Er(M.type)}'.`);p&&(C.type.kind==="value"&&M.type.kind!=="value"?C=new To(M.type,[C]):C.type.kind!=="value"&&M.type.kind==="value"&&(M=new To(C.type,[M])));let D=null;if(b.length===4){if(C.type.kind!=="string"&&M.type.kind!=="string"&&C.type.kind!=="value"&&M.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(D=f.parse(b[3],3,If),!D)return null}return new Ww(C,M,D)}evaluate(b){const f=this.lhs.evaluate(b),l=this.rhs.evaluate(b);if(p&&this.hasUntypedArgument){const C=ui(f),M=ui(l);if(C.kind!==M.kind||!(C.kind==="string"||C.kind==="number"))throw new Ii(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${C.kind}, ${M.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const C=ui(f),M=ui(l);if(C.kind!=="string"||M.kind!=="string")return r(b,f,l)}return this.collator?s(b,f,l,this.collator.evaluate(b)):r(b,f,l)}eachChild(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)}outputDefined(){return!0}serialize(){const b=[i];return this.eachChild(f=>{b.push(f.serialize())}),b}}}const rE=su("==",GI,Zw),iE=su("!=",ZI,YI),nE=su("<",WI,JI),aE=su(">",HI,QI),oE=su("<=",XI,eE),sE=su(">=",KI,tE);class f0{constructor(r,s,p,m,b,f){this.type=Ut,this.number=r,this.locale=s,this.currency=p,this.unit=m,this.minFractionDigits=b,this.maxFractionDigits=f}static parse(r,s){if(r.length!==3)return s.error("Expected two arguments.");const p=s.parse(r[1],1,Xe);if(!p)return null;const m=r[2];if(typeof m!="object"||Array.isArray(m))return s.error("NumberFormat options argument must be an object.");let b=null;if(m.locale&&(b=s.parse(m.locale,1,Ut),!b))return null;let f=null;if(m.currency&&(f=s.parse(m.currency,1,Ut),!f))return null;let l=null;if(m.unit&&(l=s.parse(m.unit,1,Ut),!l))return null;let C=null;if(m["min-fraction-digits"]&&(C=s.parse(m["min-fraction-digits"],1,Xe),!C))return null;let M=null;return m["max-fraction-digits"]&&(M=s.parse(m["max-fraction-digits"],1,Xe),!M)?null:new f0(p,b,f,l,C,M)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency&&"currency"||this.unit&&"unit"||"decimal",currency:this.currency?this.currency.evaluate(r):void 0,unit:this.unit?this.unit.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.unit&&r(this.unit),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.unit&&(r.unit=this.unit.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class m0{constructor(r){this.type=Xe,this.input=r}static parse(r,s){if(r.length!==2)return s.error(`Expected 1 argument, but found ${r.length-1} instead.`);const p=s.parse(r[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${Er(p.type)} instead.`):new m0(p):null}evaluate(r){const s=this.input.evaluate(r);if(typeof s=="string"||Array.isArray(s))return s.length;throw new Ii(`Expected value to be of type string or array, but found ${Er(ui(s))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild(s=>{r.push(s.serialize())}),r}}var lE=m0;const Hw={"==":rE,"!=":iE,">":aE,"<":nE,">=":sE,"<=":oE,array:To,at:BI,boolean:To,case:VI,coalesce:qw,collator:Lf,format:zf,image:Rf,in:$I,"index-of":NI,interpolate:Mo,"interpolate-hcl":Mo,"interpolate-lab":Mo,length:lE,let:Gw,literal:af,match:UI,number:To,"number-format":f0,object:To,slice:qI,step:Rw,string:To,"to-boolean":Vc,"to-color":Vc,"to-number":Vc,"to-string":Vc,var:Ew,within:r0};function Ib(i,[r,s,p,m]){r=r.evaluate(i),s=s.evaluate(i),p=p.evaluate(i);const b=m?m.evaluate(i):1,f=Cw(r,s,p,b);if(f)throw new Ii(f);return new Ai(r/255*b,s/255*b,p/255*b,b)}function Eb(i,r){return i in r}function Pg(i,r){const s=r[i];return typeof s>"u"?null:s}function cE(i,r,s,p){for(;s<=p;){const m=s+p>>1;if(r[m]===i)return!0;r[m]>i?p=m-1:s=m+1}return!1}function al(i){return{type:i}}ou.register(Hw,{error:[oI,[Ut],(i,[r])=>{throw new Ii(r.evaluate(i))}],typeof:[Ut,[jt],(i,[r])=>Er(ui(r.evaluate(i)))],"to-rgba":[Hn(Xe,4),[Po],(i,[r])=>r.evaluate(i).toArray()],rgb:[Po,[Xe,Xe,Xe],Ib],rgba:[Po,[Xe,Xe,Xe,Xe],Ib],has:{type:Dt,overloads:[[[Ut],(i,[r])=>Eb(r.evaluate(i),i.properties())],[[Ut,Kc],(i,[r,s])=>Eb(r.evaluate(i),s.evaluate(i))]]},get:{type:jt,overloads:[[[Ut],(i,[r])=>Pg(r.evaluate(i),i.properties())],[[Ut,Kc],(i,[r,s])=>Pg(r.evaluate(i),s.evaluate(i))]]},"feature-state":[jt,[Ut],(i,[r])=>Pg(r.evaluate(i),i.featureState||{})],properties:[Kc,[],i=>i.properties()],"geometry-type":[Ut,[],i=>i.geometryType()],id:[jt,[],i=>i.id()],zoom:[Xe,[],i=>i.globals.zoom],pitch:[Xe,[],i=>i.globals.pitch||0],"distance-from-center":[Xe,[],i=>i.distanceFromCenter()],"heatmap-density":[Xe,[],i=>i.globals.heatmapDensity||0],"line-progress":[Xe,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[Xe,[],i=>i.globals.skyRadialProgress||0],accumulated:[jt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Xe,al(Xe),(i,r)=>{let s=0;for(const p of r)s+=p.evaluate(i);return s}],"*":[Xe,al(Xe),(i,r)=>{let s=1;for(const p of r)s*=p.evaluate(i);return s}],"-":{type:Xe,overloads:[[[Xe,Xe],(i,[r,s])=>r.evaluate(i)-s.evaluate(i)],[[Xe],(i,[r])=>-r.evaluate(i)]]},"/":[Xe,[Xe,Xe],(i,[r,s])=>r.evaluate(i)/s.evaluate(i)],"%":[Xe,[Xe,Xe],(i,[r,s])=>r.evaluate(i)%s.evaluate(i)],ln2:[Xe,[],()=>Math.LN2],pi:[Xe,[],()=>Math.PI],e:[Xe,[],()=>Math.E],"^":[Xe,[Xe,Xe],(i,[r,s])=>Math.pow(r.evaluate(i),s.evaluate(i))],sqrt:[Xe,[Xe],(i,[r])=>Math.sqrt(r.evaluate(i))],log10:[Xe,[Xe],(i,[r])=>Math.log(r.evaluate(i))/Math.LN10],ln:[Xe,[Xe],(i,[r])=>Math.log(r.evaluate(i))],log2:[Xe,[Xe],(i,[r])=>Math.log(r.evaluate(i))/Math.LN2],sin:[Xe,[Xe],(i,[r])=>Math.sin(r.evaluate(i))],cos:[Xe,[Xe],(i,[r])=>Math.cos(r.evaluate(i))],tan:[Xe,[Xe],(i,[r])=>Math.tan(r.evaluate(i))],asin:[Xe,[Xe],(i,[r])=>Math.asin(r.evaluate(i))],acos:[Xe,[Xe],(i,[r])=>Math.acos(r.evaluate(i))],atan:[Xe,[Xe],(i,[r])=>Math.atan(r.evaluate(i))],min:[Xe,al(Xe),(i,r)=>Math.min(...r.map(s=>s.evaluate(i)))],max:[Xe,al(Xe),(i,r)=>Math.max(...r.map(s=>s.evaluate(i)))],abs:[Xe,[Xe],(i,[r])=>Math.abs(r.evaluate(i))],round:[Xe,[Xe],(i,[r])=>{const s=r.evaluate(i);return s<0?-Math.round(-s):Math.round(s)}],floor:[Xe,[Xe],(i,[r])=>Math.floor(r.evaluate(i))],ceil:[Xe,[Xe],(i,[r])=>Math.ceil(r.evaluate(i))],"filter-==":[Dt,[Ut,jt],(i,[r,s])=>i.properties()[r.value]===s.value],"filter-id-==":[Dt,[jt],(i,[r])=>i.id()===r.value],"filter-type-==":[Dt,[Ut],(i,[r])=>i.geometryType()===r.value],"filter-<":[Dt,[Ut,jt],(i,[r,s])=>{const p=i.properties()[r.value],m=s.value;return typeof p==typeof m&&p<m}],"filter-id-<":[Dt,[jt],(i,[r])=>{const s=i.id(),p=r.value;return typeof s==typeof p&&s<p}],"filter->":[Dt,[Ut,jt],(i,[r,s])=>{const p=i.properties()[r.value],m=s.value;return typeof p==typeof m&&p>m}],"filter-id->":[Dt,[jt],(i,[r])=>{const s=i.id(),p=r.value;return typeof s==typeof p&&s>p}],"filter-<=":[Dt,[Ut,jt],(i,[r,s])=>{const p=i.properties()[r.value],m=s.value;return typeof p==typeof m&&p<=m}],"filter-id-<=":[Dt,[jt],(i,[r])=>{const s=i.id(),p=r.value;return typeof s==typeof p&&s<=p}],"filter->=":[Dt,[Ut,jt],(i,[r,s])=>{const p=i.properties()[r.value],m=s.value;return typeof p==typeof m&&p>=m}],"filter-id->=":[Dt,[jt],(i,[r])=>{const s=i.id(),p=r.value;return typeof s==typeof p&&s>=p}],"filter-has":[Dt,[jt],(i,[r])=>r.value in i.properties()],"filter-has-id":[Dt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Dt,[Hn(Ut)],(i,[r])=>r.value.indexOf(i.geometryType())>=0],"filter-id-in":[Dt,[Hn(jt)],(i,[r])=>r.value.indexOf(i.id())>=0],"filter-in-small":[Dt,[Ut,Hn(jt)],(i,[r,s])=>s.value.indexOf(i.properties()[r.value])>=0],"filter-in-large":[Dt,[Ut,Hn(jt)],(i,[r,s])=>cE(i.properties()[r.value],s.value,0,s.value.length-1)],all:{type:Dt,overloads:[[[Dt,Dt],(i,[r,s])=>r.evaluate(i)&&s.evaluate(i)],[al(Dt),(i,r)=>{for(const s of r)if(!s.evaluate(i))return!1;return!0}]]},any:{type:Dt,overloads:[[[Dt,Dt],(i,[r,s])=>r.evaluate(i)||s.evaluate(i)],[al(Dt),(i,r)=>{for(const s of r)if(s.evaluate(i))return!0;return!1}]]},"!":[Dt,[Dt],(i,[r])=>!r.evaluate(i)],"is-supported-script":[Dt,[Ut],(i,[r])=>{const s=i.globals&&i.globals.isSupportedScript;return s?s(r.evaluate(i)):!0}],upcase:[Ut,[Ut],(i,[r])=>r.evaluate(i).toUpperCase()],downcase:[Ut,[Ut],(i,[r])=>r.evaluate(i).toLowerCase()],concat:[Ut,al(jt),(i,r)=>r.map(s=>Oh(s.evaluate(i))).join("")],"resolved-locale":[Ut,[If],(i,[r])=>r.evaluate(i).resolvedLocale()]});var Xw=Hw;function fy(i){return{result:"success",value:i}}function $c(i){return{result:"error",value:i}}function uE(i){return i["property-type"]==="data-driven"}function hE(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Kw(i){return!!i.expression&&i.expression.interpolated}function g0(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function y0(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function pE(i){return i}function _0(i,r){const s=r.type==="color",p=i.stops&&typeof i.stops[0][0]=="object",m=p||i.property!==void 0,b=p||!m,f=i.type||(Kw(r)?"exponential":"interval");if(s&&(i=Sw({},i),i.stops&&(i.stops=i.stops.map(D=>[D[0],Ai.parse(D[1])])),i.default?i.default=Ai.parse(i.default):i.default=Ai.parse(r.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!Vw[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let l,C,M;if(f==="exponential")l=zb;else if(f==="interval")l=fE;else if(f==="categorical"){l=dE,C=Object.create(null);for(const D of i.stops)C[D[0]]=D[1];M=typeof i.stops[0][0]}else if(f==="identity")l=mE;else throw new Error(`Unknown function type "${f}"`);if(p){const D={},O=[];for(let ne=0;ne<i.stops.length;ne++){const fe=i.stops[ne],Ee=fe[0].zoom;D[Ee]===void 0&&(D[Ee]={zoom:Ee,type:i.type,property:i.property,default:i.default,stops:[]},O.push(Ee)),D[Ee].stops.push([fe[0].value,fe[1]])}const Z=[];for(const ne of O)Z.push([D[ne].zoom,_0(D[ne],r)]);const $={name:"linear"};return{kind:"composite",interpolationType:$,interpolationFactor:Mo.interpolationFactor.bind(void 0,$),zoomStops:Z.map(ne=>ne[0]),evaluate({zoom:ne},fe){return zb({stops:Z,base:i.base},r,ne).evaluate(ne,fe)}}}else if(b){const D=f==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:Mo.interpolationFactor.bind(void 0,D),zoomStops:i.stops.map(O=>O[0]),evaluate:({zoom:O})=>l(i,r,O,C,M)}}else return{kind:"source",evaluate(D,O){const Z=O&&O.properties?O.properties[i.property]:void 0;return Z===void 0?hp(i.default,r.default):l(i,r,Z,C,M)}}}function hp(i,r,s){if(i!==void 0)return i;if(r!==void 0)return r;if(s!==void 0)return s}function dE(i,r,s,p,m){const b=typeof s===m?p[s]:void 0;return hp(b,i.default,r.default)}function fE(i,r,s){if(g0(s)!=="number")return hp(i.default,r.default);const p=i.stops.length;if(p===1||s<=i.stops[0][0])return i.stops[0][1];if(s>=i.stops[p-1][0])return i.stops[p-1][1];const m=Df(i.stops.map(b=>b[0]),s);return i.stops[m][1]}function zb(i,r,s){const p=i.base!==void 0?i.base:1;if(g0(s)!=="number")return hp(i.default,r.default);const m=i.stops.length;if(m===1||s<=i.stops[0][0])return i.stops[0][1];if(s>=i.stops[m-1][0])return i.stops[m-1][1];const b=Df(i.stops.map(D=>D[0]),s),f=gE(s,p,i.stops[b][0],i.stops[b+1][0]),l=i.stops[b][1],C=i.stops[b+1][1];let M=Dw[r.type]||pE;if(i.colorSpace&&i.colorSpace!=="rgb"){const D=Vw[i.colorSpace];M=(O,Z)=>D.reverse(D.interpolate(D.forward(O),D.forward(Z),f))}return typeof l.evaluate=="function"?{evaluate(...D){const O=l.evaluate.apply(void 0,D),Z=C.evaluate.apply(void 0,D);if(!(O===void 0||Z===void 0))return M(O,Z,f)}}:M(l,C,f)}function mE(i,r,s){return r.type==="color"?s=Ai.parse(s):r.type==="formatted"?s=_a.fromString(s.toString()):r.type==="resolvedImage"?s=Eo.fromString(s.toString()):g0(s)!==r.type&&(r.type!=="enum"||!r.values[s])&&(s=void 0),hp(s,i.default,r.default)}function gE(i,r,s,p){const m=p-s,b=i-s;return m===0?0:r===1?b/m:(Math.pow(r,b)-1)/(Math.pow(r,m)-1)}class Yw{constructor(r,s){this.expression=r,this._warningHistory={},this._evaluator=new Pw,this._defaultValue=s?vE(s):null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(r,s,p,m,b,f,l,C){return this._evaluator.globals=r,this._evaluator.feature=s,this._evaluator.featureState=p,this._evaluator.canonical=m||null,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=f,this._evaluator.featureTileCoord=l||null,this._evaluator.featureDistanceData=C||null,this.expression.evaluate(this._evaluator)}evaluate(r,s,p,m,b,f,l,C){this._evaluator.globals=r,this._evaluator.feature=s||null,this._evaluator.featureState=p||null,this._evaluator.canonical=m||null,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=f||null,this._evaluator.featureTileCoord=l||null,this._evaluator.featureDistanceData=C||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!==M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new Ii(`Expected value to be one of ${Object.keys(this._enumValues).map(D=>JSON.stringify(D)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(M.message)),this._defaultValue}}}function Jw(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Xw}function Qw(i,r){const s=new zw(Xw,[],r?_E(r):void 0),p=s.parse(i,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?fy(new Yw(p,r)):$c(s.errors)}class my{constructor(r,s){this.kind=r,this._styleExpression=s,this.isStateDependent=r!=="constant"&&!n0(s.expression)}evaluateWithoutErrorHandling(r,s,p,m,b,f){return this._styleExpression.evaluateWithoutErrorHandling(r,s,p,m,b,f)}evaluate(r,s,p,m,b,f){return this._styleExpression.evaluate(r,s,p,m,b,f)}}class gy{constructor(r,s,p,m){this.kind=r,this.zoomStops=p,this._styleExpression=s,this.isStateDependent=r!=="camera"&&!n0(s.expression),this.interpolationType=m}evaluateWithoutErrorHandling(r,s,p,m,b,f){return this._styleExpression.evaluateWithoutErrorHandling(r,s,p,m,b,f)}evaluate(r,s,p,m,b,f){return this._styleExpression.evaluate(r,s,p,m,b,f)}interpolationFactor(r,s,p){return this.interpolationType?Mo.interpolationFactor(this.interpolationType,r,s,p):0}}function e2(i,r){if(i=Qw(i,r),i.result==="error")return i;const s=i.value.expression,p=i0(s);if(!p&&!uE(r))return $c([new qa("","data expressions not supported")]);const m=a0(s,["zoom","pitch","distance-from-center"]);if(!m&&!hE(r))return $c([new qa("","zoom expressions not supported")]);const b=Nd(s);if(!b&&!m)return $c([new qa("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(b instanceof qa)return $c([b]);if(b instanceof Mo&&!Kw(r))return $c([new qa("",'"interpolate" expressions cannot be used with this property')]);if(!b)return fy(p?new my("constant",i.value):new my("source",i.value));const f=b instanceof Mo?b.interpolation:void 0;return fy(p?new gy("camera",i.value,b.labels,f):new gy("composite",i.value,b.labels,f))}class jf{constructor(r,s){this._parameters=r,this._specification=s,Sw(this,_0(this._parameters,this._specification))}static deserialize(r){return new jf(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function yE(i,r){if(y0(i))return new jf(i,r);if(Jw(i)){const s=e2(i,r);if(s.result==="error")throw new Error(s.value.map(p=>`${p.key}: ${p.message}`).join(", "));return s.value}else{let s=i;return typeof i=="string"&&r.type==="color"&&(s=Ai.parse(i)),{kind:"constant",evaluate:()=>s}}}function Nd(i){let r=null;if(i instanceof Gw)r=Nd(i.result);else if(i instanceof qw){for(const s of i.args)if(r=Nd(s),r)break}else(i instanceof Rw||i instanceof Mo)&&i.input instanceof ou&&i.input.name==="zoom"&&(r=i);return r instanceof qa||i.eachChild(s=>{const p=Nd(s);p instanceof qa?r=p:!r&&p?r=new qa("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&p&&r!==p&&(r=new qa("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}function _E(i){const r={color:Po,string:Ut,number:Xe,enum:Ut,boolean:Dt,formatted:Ef,resolvedImage:up};return i.type==="array"?Hn(r[i.value]||jt,i.length):r[i.type]}function vE(i){return i.type==="color"&&(y0(i.default)||Array.isArray(i.default))?new Ai(0,0,0,0):i.type==="color"?Ai.parse(i.default)||null:i.default===void 0?null:i.default}function ep(i){return typeof i=="object"?["literal",i]:i}function bE(i,r){let s=i.stops;if(!s)return xE(i,r);const p=s&&typeof s[0][0]=="object",m=p||i.property!==void 0,b=p||!m;return s=s.map(f=>!m&&r.tokens&&typeof f[1]=="string"?[f[0],kE(f[1])]:[f[0],ep(f[1])]),p?wE(i,r,s):b?SE(i,r,s):yy(i,r,s)}function xE(i,r){const s=["get",i.property];if(i.default===void 0)return r.type==="string"?["string",s]:s;if(r.type==="enum")return["match",s,Object.keys(r.values),s,i.default];{const p=[r.type==="color"?"to-color":r.type,s,ep(i.default)];return r.type==="array"&&p.splice(1,0,r.value,r.length||null),p}}function v0(i){switch(i.colorSpace){case"hcl":return"interpolate-hcl";case"lab":return"interpolate-lab";default:return"interpolate"}}function wE(i,r,s){const p={},m={},b=[];for(let f=0;f<s.length;f++){const l=s[f],C=l[0].zoom;p[C]===void 0&&(p[C]={zoom:C,type:i.type,property:i.property,default:i.default},m[C]=[],b.push(C)),m[C].push([l[0].value,l[1]])}if(x0({},r)==="exponential"){const f=[v0(i),["linear"],["zoom"]];for(const l of b){const C=yy(p[l],r,m[l]);Jc(f,l,C,!1)}return f}else{const f=["step",["zoom"]];for(const l of b){const C=yy(p[l],r,m[l]);Jc(f,l,C,!0)}return b0(f),f}}function TE(i,r){if(i!==void 0)return i;if(r!==void 0)return r}function Rb(i,r){const s=ep(TE(i.default,r.default));return s===void 0&&r.type==="resolvedImage"?"":s}function yy(i,r,s){const p=x0(i,r),m=["get",i.property];if(p==="categorical"&&typeof s[0][0]=="boolean"){const b=["case"];for(const f of s)b.push(["==",m,f[0]],f[1]);return b.push(Rb(i,r)),b}else if(p==="categorical"){const b=["match",m];for(const f of s)Jc(b,f[0],f[1],!1);return b.push(Rb(i,r)),b}else if(p==="interval"){const b=["step",["number",m]];for(const f of s)Jc(b,f[0],f[1],!0);return b0(b),i.default===void 0?b:["case",["==",["typeof",m],"number"],b,ep(i.default)]}else if(p==="exponential"){const b=i.base!==void 0?i.base:1,f=[v0(i),b===1?["linear"]:["exponential",b],["number",m]];for(const l of s)Jc(f,l[0],l[1],!1);return i.default===void 0?f:["case",["==",["typeof",m],"number"],f,ep(i.default)]}else throw new Error(`Unknown property function type ${p}`)}function SE(i,r,s,p=["zoom"]){const m=x0(i,r);let b,f=!1;if(m==="interval")b=["step",p],f=!0;else if(m==="exponential"){const l=i.base!==void 0?i.base:1;b=[v0(i),l===1?["linear"]:["exponential",l],p]}else throw new Error(`Unknown zoom function type "${m}"`);for(const l of s)Jc(b,l[0],l[1],f);return b0(b),b}function b0(i){i[0]==="step"&&i.length===3&&(i.push(0),i.push(i[3]))}function Jc(i,r,s,p){i.length>3&&r===i[i.length-2]||(p&&i.length===2||i.push(r),i.push(s))}function x0(i,r){return i.type?i.type:r.expression.interpolated?"exponential":"interval"}function kE(i){const r=["concat"],s=/{([^{}]+)}/g;let p=0;for(let m=s.exec(i);m!==null;m=s.exec(i)){const b=i.slice(p,s.lastIndex-m[0].length);p=s.lastIndex,b.length>0&&r.push(b),r.push(["get",m[1]])}if(r.length===1)return i;if(p<i.length)r.push(i.slice(p));else if(r.length===2)return["to-string",r[1]];return r}function t2(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const r of i.slice(1))if(!t2(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}function CE(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var PE={};(function(i){var r=(function(){var s=function(Ee,_e,Se,Pe){for(Se=Se||{},Pe=Ee.length;Pe--;Se[Ee[Pe]]=_e);return Se},p=[1,12],m=[1,13],b=[1,9],f=[1,10],l=[1,11],C=[1,14],M=[1,15],D=[14,18,22,24],O=[18,22],Z=[22,24],$={trace:function(){},yy:{},symbols_:{error:2,JSONString:3,STRING:4,JSONNumber:5,NUMBER:6,JSONNullLiteral:7,NULL:8,JSONBooleanLiteral:9,TRUE:10,FALSE:11,JSONText:12,JSONValue:13,EOF:14,JSONObject:15,JSONArray:16,"{":17,"}":18,JSONMemberList:19,JSONMember:20,":":21,",":22,"[":23,"]":24,JSONElementList:25,$accept:0,$end:1},terminals_:{2:"error",4:"STRING",6:"NUMBER",8:"NULL",10:"TRUE",11:"FALSE",14:"EOF",17:"{",18:"}",21:":",22:",",23:"[",24:"]"},productions_:[0,[3,1],[5,1],[7,1],[9,1],[9,1],[12,2],[13,1],[13,1],[13,1],[13,1],[13,1],[13,1],[15,2],[15,3],[20,3],[19,1],[19,3],[16,2],[16,3],[25,1],[25,3]],performAction:function(Ee,_e,Se,Pe,ve,ye,Ae){var Ne=ye.length-1;switch(ve){case 1:this.$=new String(Ee.replace(/\\(\\|")/g,"$1").replace(/\\n/g,`
`).replace(/\\r/g,"\r").replace(/\\t/g,"	").replace(/\\v/g,"\v").replace(/\\f/g,"\f").replace(/\\b/g,"\b")),this.$.__line__=this._$.first_line;break;case 2:this.$=new Number(Ee),this.$.__line__=this._$.first_line;break;case 3:this.$=null;break;case 4:this.$=new Boolean(!0),this.$.__line__=this._$.first_line;break;case 5:this.$=new Boolean(!1),this.$.__line__=this._$.first_line;break;case 6:return this.$=ye[Ne-1];case 13:this.$={},Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 14:case 19:this.$=ye[Ne-1],Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 15:this.$=[ye[Ne-2],ye[Ne]];break;case 16:this.$={},this.$[ye[Ne][0]]=ye[Ne][1];break;case 17:this.$=ye[Ne-2],ye[Ne-2][ye[Ne][0]]=ye[Ne][1];break;case 18:this.$=[],Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 20:this.$=[ye[Ne]];break;case 21:this.$=ye[Ne-2],ye[Ne-2].push(ye[Ne]);break}},table:[{3:5,4:p,5:6,6:m,7:3,8:b,9:4,10:f,11:l,12:1,13:2,15:7,16:8,17:C,23:M},{1:[3]},{14:[1,16]},s(D,[2,7]),s(D,[2,8]),s(D,[2,9]),s(D,[2,10]),s(D,[2,11]),s(D,[2,12]),s(D,[2,3]),s(D,[2,4]),s(D,[2,5]),s([14,18,21,22,24],[2,1]),s(D,[2,2]),{3:20,4:p,18:[1,17],19:18,20:19},{3:5,4:p,5:6,6:m,7:3,8:b,9:4,10:f,11:l,13:23,15:7,16:8,17:C,23:M,24:[1,21],25:22},{1:[2,6]},s(D,[2,13]),{18:[1,24],22:[1,25]},s(O,[2,16]),{21:[1,26]},s(D,[2,18]),{22:[1,28],24:[1,27]},s(Z,[2,20]),s(D,[2,14]),{3:20,4:p,20:29},{3:5,4:p,5:6,6:m,7:3,8:b,9:4,10:f,11:l,13:30,15:7,16:8,17:C,23:M},s(D,[2,19]),{3:5,4:p,5:6,6:m,7:3,8:b,9:4,10:f,11:l,13:31,15:7,16:8,17:C,23:M},s(O,[2,17]),s(O,[2,15]),s(Z,[2,21])],defaultActions:{16:[2,6]},parseError:function(Ee,_e){if(_e.recoverable)this.trace(Ee);else throw new Error(Ee)},parse:function(Ee){var _e=this,Se=[0],Pe=[null],ve=[],ye=this.table,Ae="",Ne=0,it=0,gt=2,nt=1,Zt=ve.slice.call(arguments,1),kt=Object.create(this.lexer),ur={yy:{}};for(var hi in this.yy)Object.prototype.hasOwnProperty.call(this.yy,hi)&&(ur.yy[hi]=this.yy[hi]);kt.setInput(Ee,ur.yy),ur.yy.lexer=kt,ur.yy.parser=this,typeof kt.yylloc>"u"&&(kt.yylloc={});var pi=kt.yylloc;ve.push(pi);var zi=kt.options&&kt.options.ranges;typeof ur.yy.parseError=="function"?this.parseError=ur.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;function Ri(){var Qt;return Qt=kt.lex()||nt,typeof Qt!="number"&&(Qt=_e.symbols_[Qt]||Qt),Qt}for(var br,Ft,Ye,st,vt={},Ot,Et,pr,Vt;;){if(Ft=Se[Se.length-1],this.defaultActions[Ft]?Ye=this.defaultActions[Ft]:((br===null||typeof br>"u")&&(br=Ri()),Ye=ye[Ft]&&ye[Ft][br]),typeof Ye>"u"||!Ye.length||!Ye[0]){var yr="";Vt=[];for(Ot in ye[Ft])this.terminals_[Ot]&&Ot>gt&&Vt.push("'"+this.terminals_[Ot]+"'");kt.showPosition?yr="Parse error on line "+(Ne+1)+`:
`+kt.showPosition()+`
Expecting `+Vt.join(", ")+", got '"+(this.terminals_[br]||br)+"'":yr="Parse error on line "+(Ne+1)+": Unexpected "+(br==nt?"end of input":"'"+(this.terminals_[br]||br)+"'"),this.parseError(yr,{text:kt.match,token:this.terminals_[br]||br,line:kt.yylineno,loc:pi,expected:Vt})}if(Ye[0]instanceof Array&&Ye.length>1)throw new Error("Parse Error: multiple actions possible at state: "+Ft+", token: "+br);switch(Ye[0]){case 1:Se.push(br),Pe.push(kt.yytext),ve.push(kt.yylloc),Se.push(Ye[1]),br=null,it=kt.yyleng,Ae=kt.yytext,Ne=kt.yylineno,pi=kt.yylloc;break;case 2:if(Et=this.productions_[Ye[1]][1],vt.$=Pe[Pe.length-Et],vt._$={first_line:ve[ve.length-(Et||1)].first_line,last_line:ve[ve.length-1].last_line,first_column:ve[ve.length-(Et||1)].first_column,last_column:ve[ve.length-1].last_column},zi&&(vt._$.range=[ve[ve.length-(Et||1)].range[0],ve[ve.length-1].range[1]]),st=this.performAction.apply(vt,[Ae,it,Ne,ur.yy,Ye[1],Pe,ve].concat(Zt)),typeof st<"u")return st;Et&&(Se=Se.slice(0,-1*Et*2),Pe=Pe.slice(0,-1*Et),ve=ve.slice(0,-1*Et)),Se.push(this.productions_[Ye[1]][0]),Pe.push(vt.$),ve.push(vt._$),pr=ye[Se[Se.length-2]][Se[Se.length-1]],Se.push(pr);break;case 3:return!0}}return!0}},ne=(function(){var Ee={EOF:1,parseError:function(_e,Se){if(this.yy.parser)this.yy.parser.parseError(_e,Se);else throw new Error(_e)},setInput:function(_e,Se){return this.yy=Se||this.yy||{},this._input=_e,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var _e=this._input[0];this.yytext+=_e,this.yyleng++,this.offset++,this.match+=_e,this.matched+=_e;var Se=_e.match(/(?:\r\n?|\n).*/g);return Se?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),_e},unput:function(_e){var Se=_e.length,Pe=_e.split(/(?:\r\n?|\n)/g);this._input=_e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-Se),this.offset-=Se;var ve=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),Pe.length-1&&(this.yylineno-=Pe.length-1);var ye=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:Pe?(Pe.length===ve.length?this.yylloc.first_column:0)+ve[ve.length-Pe.length].length-Pe[0].length:this.yylloc.first_column-Se},this.options.ranges&&(this.yylloc.range=[ye[0],ye[0]+this.yyleng-Se]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+`. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).
`+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(_e){this.unput(this.match.slice(_e))},pastInput:function(){var _e=this.matched.substr(0,this.matched.length-this.match.length);return(_e.length>20?"...":"")+_e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var _e=this.match;return _e.length<20&&(_e+=this._input.substr(0,20-_e.length)),(_e.substr(0,20)+(_e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var _e=this.pastInput(),Se=new Array(_e.length+1).join("-");return _e+this.upcomingInput()+`
`+Se+"^"},test_match:function(_e,Se){var Pe,ve,ye;if(this.options.backtrack_lexer&&(ye={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(ye.yylloc.range=this.yylloc.range.slice(0))),ve=_e[0].match(/(?:\r\n?|\n).*/g),ve&&(this.yylineno+=ve.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:ve?ve[ve.length-1].length-ve[ve.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+_e[0].length},this.yytext+=_e[0],this.match+=_e[0],this.matches=_e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(_e[0].length),this.matched+=_e[0],Pe=this.performAction.call(this,this.yy,this,Se,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),Pe)return Pe;if(this._backtrack){for(var Ae in ye)this[Ae]=ye[Ae];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var _e,Se,Pe,ve;this._more||(this.yytext="",this.match="");for(var ye=this._currentRules(),Ae=0;Ae<ye.length;Ae++)if(Pe=this._input.match(this.rules[ye[Ae]]),Pe&&(!Se||Pe[0].length>Se[0].length)){if(Se=Pe,ve=Ae,this.options.backtrack_lexer){if(_e=this.test_match(Pe,ye[Ae]),_e!==!1)return _e;if(this._backtrack){Se=!1;continue}else return!1}else if(!this.options.flex)break}return Se?(_e=this.test_match(Se,ye[ve]),_e!==!1?_e:!1):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var _e=this.next();return _e||this.lex()},begin:function(_e){this.conditionStack.push(_e)},popState:function(){var _e=this.conditionStack.length-1;return _e>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(_e){return _e=this.conditionStack.length-1-Math.abs(_e||0),_e>=0?this.conditionStack[_e]:"INITIAL"},pushState:function(_e){this.begin(_e)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(_e,Se,Pe,ve){switch(Pe){case 0:break;case 1:return 6;case 2:return Se.yytext=Se.yytext.substr(1,Se.yyleng-2),4;case 3:return 17;case 4:return 18;case 5:return 23;case 6:return 24;case 7:return 22;case 8:return 21;case 9:return 10;case 10:return 11;case 11:return 8;case 12:return 14;case 13:return"INVALID"}},rules:[/^(?:\s+)/,/^(?:(-?([0-9]|[1-9][0-9]+))(\.[0-9]+)?([eE][-+]?[0-9]+)?\b)/,/^(?:"(?:\\[\\"bfnrt/]|\\u[a-fA-F0-9]{4}|[^\\\0-\x09\x0a-\x1f"])*")/,/^(?:\{)/,/^(?:\})/,/^(?:\[)/,/^(?:\])/,/^(?:,)/,/^(?::)/,/^(?:true\b)/,/^(?:false\b)/,/^(?:null\b)/,/^(?:$)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],inclusive:!0}}};return Ee})();$.lexer=ne;function fe(){this.yy={}}return fe.prototype=$,$.Parser=fe,new fe})();typeof CE<"u"&&(i.parser=r,i.Parser=r.Parser,i.parse=function(){return r.parse.apply(r,arguments)})})(PE);const ME={StyleExpression:Yw,isExpression:Jw,isExpressionFilter:t2,createExpression:Qw,createPropertyExpression:e2,normalizePropertyExpression:yE,ZoomConstantExpression:my,ZoomDependentExpression:gy,StylePropertyFunction:jf},AE={convertFunction:bE,createFunction:_0,isFunction:y0};function IE(i){var r=i.expr,s=i.layer,p=Math.min(r(s,"paint","circle-radius"),8),m=Math.min(r(s,"paint","circle-stroke-width"),4),b=r(s,"paint","circle-color"),f=r(s,"paint","circle-opacity"),l=r(s,"paint","circle-stroke-color"),C=r(s,"paint","circle-stroke-opacity"),M=p-m/2;return{element:"svg",attributes:{viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",style:{filter:"blur("+r(s,"paint","circle-blur")*M+"px)"}},children:[{element:"circle",attributes:{key:"l1",cx:10,cy:10,fill:b,opacity:f,r:M}},{element:"circle",attributes:{key:"l2",cx:10,cy:10,fill:"transparent",opacity:C,r:p,"stroke-width":m,stroke:l}}]}}function EE(i){var r=i.expr,s=i.layer;return{element:"div",attributes:{style:{width:"100%",height:"100%",backgroundImage:"url("+(0,i.image)(r(s,"paint","fill-pattern"))+")",backgroundColor:r(s,"paint","fill-color"),opacity:r(s,"paint","fill-opacity"),backgroundSize:"66% 66%",backgroundPosition:"center"}}}}function zE(i){var r=i.layer,s=i.expr,p=(0,i.image)(s(r,"paint","line-pattern")),m={stroke:p?"url(#img1)":s(r,"paint","line-color"),strokeWidth:Math.max(2,Math.min(s(r,"paint","line-width"),8)),strokeOpacity:s(r,"paint","line-opacity"),strokeDasharray:s(r,"paint","line-dasharray")},b=m.strokeWidth,f="stroke: "+m.stroke+";";return m.strokeOpacity&&(f+="stroke-opacity: "+m.strokeOpacity+";"),m.strokeDasharray&&(f+="stroke-dasharray: "+m.strokeDasharray+";"),{element:"svg",attributes:{viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},children:[{element:"defs",attributes:{key:"defs"},children:[{element:"pattern",attributes:{key:"pattern",id:"img1",x:0,y:0,width:m.strokeWidth,height:m.strokeWidth,patternUnits:"userSpaceOnUse",patternTransform:"translate("+-b/2+" "+-b/2+") rotate(45)"},children:[{element:"image",attributes:{key:"img",xlinkHref:p,x:0,y:0,width:m.strokeWidth,height:m.strokeWidth}}]}]},{element:"path",attributes:{key:"path",style:f,d:"M0 20 L 20 0"}}]}}function RE(i){return(function(l){var C=l.image,M=(0,l.expr)(l.layer,"layout","icon-image");if(!M)return null;var D=C(M);return D?{element:"div",attributes:{style:{backgroundImage:"url("+D+")",backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat",width:"100%",height:"100%"}}}:null})(i)||(m=(s=(r=i).expr)(p=r.layer,"paint","text-color"),b=s(p,"paint","text-opacity"),{element:"svg",attributes:{viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},children:[{element:"path",attributes:{key:"l1",d:f="M 4,4 L 16,4 L 16,7 L 11.5 7 L 11.5 16 L 8.5 16 L 8.5 7 L 4 7 Z",stroke:s(p,"paint","text-halo-color"),"stroke-width":2*s(p,"paint","text-halo-width"),fill:"transparent","stroke-linejoin":"round"}},{element:"path",attributes:{key:"l2",d:f,fill:"white"}},{element:"path",attributes:{key:"l3",d:f,fill:m,opacity:b}}]});var r,s,p,m,b,f}var LE=[["background"],["circle"],["fill-extrusion"],["fill"],["heatmap"],["hillshade"],["line"],["raster"],["icon","symbol"],["text","symbol"]];function DE(i){var r,s=i.sprite,p=i.layer,m={circle:IE,symbol:RE,line:zE,fill:EE}[p.type],b=(r=i.zoom,function(f,l,C){var M=(function(ne){var fe=LE.find(function(Ee){return ne.startsWith(Ee[0])});return fe?fe[1]||fe[0]:null})(C),D=iI[l+"_"+M][C];if(!f[l])return D.default;var O=f[l][C];if(O===void 0)return D.default;if(typeof O=="object"){var Z;if(Array.isArray(O)){if(D.type==="array")return O;Z=ME.createExpression(O).value}else Z=AE.createFunction(O,D);if(!Z.evaluate)return null;var $=Z.evaluate({zoom:r},{});return $?$.name||$:null}return O});return m?m({layer:p,expr:b,image:function(f){if(s&&s.json){var l=s.json[f];if(l)return C=s.image,D=(M=l).x,O=M.y,Z=M.width,$=M.height,(ne=document.createElement("canvas")).width=2*Z,ne.height=2*$,ne.getContext("2d").drawImage(C,2*D,2*O,2*Z,2*$,0,0,2*Z,2*$),ne.toDataURL()}var C,M,D,O,Z,$,ne;return null}}):null}function jE(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var w0={exports:{}},r2=function(i,r){return function(){for(var s=new Array(arguments.length),p=0;p<s.length;p++)s[p]=arguments[p];return i.apply(r,s)}},FE=r2,T0=Object.prototype.toString,S0=(function(i){return function(r){var s=T0.call(r);return i[s]||(i[s]=s.slice(8,-1).toLowerCase())}})(Object.create(null));function Al(i){return i=i.toLowerCase(),function(r){return S0(r)===i}}function k0(i){return Array.isArray(i)}function hf(i){return typeof i>"u"}function OE(i){return i!==null&&!hf(i)&&i.constructor!==null&&!hf(i.constructor)&&typeof i.constructor.isBuffer=="function"&&i.constructor.isBuffer(i)}var i2=Al("ArrayBuffer");function BE(i){var r;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?r=ArrayBuffer.isView(i):r=i&&i.buffer&&i2(i.buffer),r}function $E(i){return typeof i=="string"}function NE(i){return typeof i=="number"}function n2(i){return i!==null&&typeof i=="object"}function Ud(i){if(S0(i)!=="object")return!1;var r=Object.getPrototypeOf(i);return r===null||r===Object.prototype}var UE=Al("Date"),VE=Al("File"),qE=Al("Blob"),GE=Al("FileList");function C0(i){return T0.call(i)==="[object Function]"}function ZE(i){return n2(i)&&C0(i.pipe)}function WE(i){var r="[object FormData]";return i&&(typeof FormData=="function"&&i instanceof FormData||T0.call(i)===r||C0(i.toString)&&i.toString()===r)}var HE=Al("URLSearchParams");function XE(i){return i.trim?i.trim():i.replace(/^\s+|\s+$/g,"")}function KE(){return typeof navigator<"u"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window<"u"&&typeof document<"u"}function P0(i,r){if(!(i===null||typeof i>"u"))if(typeof i!="object"&&(i=[i]),k0(i))for(var s=0,p=i.length;s<p;s++)r.call(null,i[s],s,i);else for(var m in i)Object.prototype.hasOwnProperty.call(i,m)&&r.call(null,i[m],m,i)}function _y(){var i={};function r(m,b){Ud(i[b])&&Ud(m)?i[b]=_y(i[b],m):Ud(m)?i[b]=_y({},m):k0(m)?i[b]=m.slice():i[b]=m}for(var s=0,p=arguments.length;s<p;s++)P0(arguments[s],r);return i}function YE(i,r,s){return P0(r,function(p,m){s&&typeof p=="function"?i[m]=FE(p,s):i[m]=p}),i}function JE(i){return i.charCodeAt(0)===65279&&(i=i.slice(1)),i}function QE(i,r,s,p){i.prototype=Object.create(r.prototype,p),i.prototype.constructor=i,s&&Object.assign(i.prototype,s)}function ez(i,r,s){var p,m,b,f={};r=r||{};do{for(p=Object.getOwnPropertyNames(i),m=p.length;m-- >0;)b=p[m],f[b]||(r[b]=i[b],f[b]=!0);i=Object.getPrototypeOf(i)}while(i&&(!s||s(i,r))&&i!==Object.prototype);return r}function tz(i,r,s){i=String(i),(s===void 0||s>i.length)&&(s=i.length),s-=r.length;var p=i.indexOf(r,s);return p!==-1&&p===s}function rz(i){if(!i)return null;var r=i.length;if(hf(r))return null;for(var s=new Array(r);r-- >0;)s[r]=i[r];return s}var iz=(function(i){return function(r){return i&&r instanceof i}})(typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array)),Ei={isArray:k0,isArrayBuffer:i2,isBuffer:OE,isFormData:WE,isArrayBufferView:BE,isString:$E,isNumber:NE,isObject:n2,isPlainObject:Ud,isUndefined:hf,isDate:UE,isFile:VE,isBlob:qE,isFunction:C0,isStream:ZE,isURLSearchParams:HE,isStandardBrowserEnv:KE,forEach:P0,merge:_y,extend:YE,trim:XE,stripBOM:JE,inherits:QE,toFlatObject:ez,kindOf:S0,kindOfTest:Al,endsWith:tz,toArray:rz,isTypedArray:iz,isFileList:GE},Rc=Ei;function Lb(i){return encodeURIComponent(i).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var a2=function(i,r,s){if(!r)return i;var p;if(s)p=s(r);else if(Rc.isURLSearchParams(r))p=r.toString();else{var m=[];Rc.forEach(r,function(f,l){f===null||typeof f>"u"||(Rc.isArray(f)?l=l+"[]":f=[f],Rc.forEach(f,function(C){Rc.isDate(C)?C=C.toISOString():Rc.isObject(C)&&(C=JSON.stringify(C)),m.push(Lb(l)+"="+Lb(C))}))}),p=m.join("&")}if(p){var b=i.indexOf("#");b!==-1&&(i=i.slice(0,b)),i+=(i.indexOf("?")===-1?"?":"&")+p}return i},nz=Ei;function Ff(){this.handlers=[]}Ff.prototype.use=function(i,r,s){return this.handlers.push({fulfilled:i,rejected:r,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1};Ff.prototype.eject=function(i){this.handlers[i]&&(this.handlers[i]=null)};Ff.prototype.forEach=function(i){nz.forEach(this.handlers,function(r){r!==null&&i(r)})};var az=Ff,oz=Ei,sz=function(i,r){oz.forEach(i,function(s,p){p!==r&&p.toUpperCase()===r.toUpperCase()&&(i[r]=s,delete i[p])})},o2=Ei;function eu(i,r,s,p,m){Error.call(this),this.message=i,this.name="AxiosError",r&&(this.code=r),s&&(this.config=s),p&&(this.request=p),m&&(this.response=m)}o2.inherits(eu,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var s2=eu.prototype,l2={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(i){l2[i]={value:i}});Object.defineProperties(eu,l2);Object.defineProperty(s2,"isAxiosError",{value:!0});eu.from=function(i,r,s,p,m,b){var f=Object.create(s2);return o2.toFlatObject(i,f,function(l){return l!==Error.prototype}),eu.call(f,i.message,r,s,p,m),f.name=i.name,b&&Object.assign(f,b),f};var lu=eu,c2={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},da=Ei;function lz(i,r){r=r||new FormData;var s=[];function p(b){return b===null?"":da.isDate(b)?b.toISOString():da.isArrayBuffer(b)||da.isTypedArray(b)?typeof Blob=="function"?new Blob([b]):Buffer.from(b):b}function m(b,f){if(da.isPlainObject(b)||da.isArray(b)){if(s.indexOf(b)!==-1)throw Error("Circular reference detected in "+f);s.push(b),da.forEach(b,function(l,C){if(!da.isUndefined(l)){var M=f?f+"."+C:C,D;if(l&&!f&&typeof l=="object"){if(da.endsWith(C,"{}"))l=JSON.stringify(l);else if(da.endsWith(C,"[]")&&(D=da.toArray(l))){D.forEach(function(O){!da.isUndefined(O)&&r.append(M,p(O))});return}}m(l,M)}}),s.pop()}else r.append(f,p(b))}return m(i),r}var u2=lz,Mg,Db;function cz(){if(Db)return Mg;Db=1;var i=lu;return Mg=function(r,s,p){var m=p.config.validateStatus;!p.status||!m||m(p.status)?r(p):s(new i("Request failed with status code "+p.status,[i.ERR_BAD_REQUEST,i.ERR_BAD_RESPONSE][Math.floor(p.status/100)-4],p.config,p.request,p))},Mg}var Ag,jb;function uz(){if(jb)return Ag;jb=1;var i=Ei;return Ag=i.isStandardBrowserEnv()?(function(){return{write:function(r,s,p,m,b,f){var l=[];l.push(r+"="+encodeURIComponent(s)),i.isNumber(p)&&l.push("expires="+new Date(p).toGMTString()),i.isString(m)&&l.push("path="+m),i.isString(b)&&l.push("domain="+b),f===!0&&l.push("secure"),document.cookie=l.join("; ")},read:function(r){var s=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return s?decodeURIComponent(s[3]):null},remove:function(r){this.write(r,"",Date.now()-864e5)}}})():(function(){return{write:function(){},read:function(){return null},remove:function(){}}})(),Ag}var hz=function(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)},pz=function(i,r){return r?i.replace(/\/+$/,"")+"/"+r.replace(/^\/+/,""):i},dz=hz,fz=pz,h2=function(i,r){return i&&!dz(r)?fz(i,r):r},Ig,Fb;function mz(){if(Fb)return Ig;Fb=1;var i=Ei,r=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return Ig=function(s){var p={},m,b,f;return s&&i.forEach(s.split(`
`),function(l){if(f=l.indexOf(":"),m=i.trim(l.substr(0,f)).toLowerCase(),b=i.trim(l.substr(f+1)),m){if(p[m]&&r.indexOf(m)>=0)return;m==="set-cookie"?p[m]=(p[m]?p[m]:[]).concat([b]):p[m]=p[m]?p[m]+", "+b:b}}),p},Ig}var Eg,Ob;function gz(){if(Ob)return Eg;Ob=1;var i=Ei;return Eg=i.isStandardBrowserEnv()?(function(){var r=/(msie|trident)/i.test(navigator.userAgent),s=document.createElement("a"),p;function m(b){var f=b;return r&&(s.setAttribute("href",f),f=s.href),s.setAttribute("href",f),{href:s.href,protocol:s.protocol?s.protocol.replace(/:$/,""):"",host:s.host,search:s.search?s.search.replace(/^\?/,""):"",hash:s.hash?s.hash.replace(/^#/,""):"",hostname:s.hostname,port:s.port,pathname:s.pathname.charAt(0)==="/"?s.pathname:"/"+s.pathname}}return p=m(window.location.href),function(b){var f=i.isString(b)?m(b):b;return f.protocol===p.protocol&&f.host===p.host}})():(function(){return function(){return!0}})(),Eg}var zg,Bb;function Of(){if(Bb)return zg;Bb=1;var i=lu,r=Ei;function s(p){i.call(this,p??"canceled",i.ERR_CANCELED),this.name="CanceledError"}return r.inherits(s,i,{__CANCEL__:!0}),zg=s,zg}var $b,Nb;function yz(){return Nb||(Nb=1,$b=function(i){var r=/^([-+\w]{1,25})(:?\/\/|:)/.exec(i);return r&&r[1]||""}),$b}var Rg,Ub;function _z(){if(Ub)return Rg;Ub=1;var i=Ei,r=cz(),s=uz(),p=a2,m=h2,b=mz(),f=gz(),l=c2,C=lu,M=Of(),D=yz();return Rg=function(O){return new Promise(function(Z,$){var ne=O.data,fe=O.headers,Ee=O.responseType,_e;function Se(){O.cancelToken&&O.cancelToken.unsubscribe(_e),O.signal&&O.signal.removeEventListener("abort",_e)}i.isFormData(ne)&&i.isStandardBrowserEnv()&&delete fe["Content-Type"];var Pe=new XMLHttpRequest;if(O.auth){var ve=O.auth.username||"",ye=O.auth.password?unescape(encodeURIComponent(O.auth.password)):"";fe.Authorization="Basic "+btoa(ve+":"+ye)}var Ae=m(O.baseURL,O.url);Pe.open(O.method.toUpperCase(),p(Ae,O.params,O.paramsSerializer),!0),Pe.timeout=O.timeout;function Ne(){if(Pe){var nt="getAllResponseHeaders"in Pe?b(Pe.getAllResponseHeaders()):null,Zt=!Ee||Ee==="text"||Ee==="json"?Pe.responseText:Pe.response,kt={data:Zt,status:Pe.status,statusText:Pe.statusText,headers:nt,config:O,request:Pe};r(function(ur){Z(ur),Se()},function(ur){$(ur),Se()},kt),Pe=null}}if("onloadend"in Pe?Pe.onloadend=Ne:Pe.onreadystatechange=function(){!Pe||Pe.readyState!==4||Pe.status===0&&!(Pe.responseURL&&Pe.responseURL.indexOf("file:")===0)||setTimeout(Ne)},Pe.onabort=function(){Pe&&($(new C("Request aborted",C.ECONNABORTED,O,Pe)),Pe=null)},Pe.onerror=function(){$(new C("Network Error",C.ERR_NETWORK,O,Pe,Pe)),Pe=null},Pe.ontimeout=function(){var nt=O.timeout?"timeout of "+O.timeout+"ms exceeded":"timeout exceeded",Zt=O.transitional||l;O.timeoutErrorMessage&&(nt=O.timeoutErrorMessage),$(new C(nt,Zt.clarifyTimeoutError?C.ETIMEDOUT:C.ECONNABORTED,O,Pe)),Pe=null},i.isStandardBrowserEnv()){var it=(O.withCredentials||f(Ae))&&O.xsrfCookieName?s.read(O.xsrfCookieName):void 0;it&&(fe[O.xsrfHeaderName]=it)}"setRequestHeader"in Pe&&i.forEach(fe,function(nt,Zt){typeof ne>"u"&&Zt.toLowerCase()==="content-type"?delete fe[Zt]:Pe.setRequestHeader(Zt,nt)}),i.isUndefined(O.withCredentials)||(Pe.withCredentials=!!O.withCredentials),Ee&&Ee!=="json"&&(Pe.responseType=O.responseType),typeof O.onDownloadProgress=="function"&&Pe.addEventListener("progress",O.onDownloadProgress),typeof O.onUploadProgress=="function"&&Pe.upload&&Pe.upload.addEventListener("progress",O.onUploadProgress),(O.cancelToken||O.signal)&&(_e=function(nt){Pe&&($(!nt||nt&&nt.type?new M:nt),Pe.abort(),Pe=null)},O.cancelToken&&O.cancelToken.subscribe(_e),O.signal&&(O.signal.aborted?_e():O.signal.addEventListener("abort",_e))),ne||(ne=null);var gt=D(Ae);if(gt&&["http","https","file"].indexOf(gt)===-1){$(new C("Unsupported protocol "+gt+":",C.ERR_BAD_REQUEST,O));return}Pe.send(ne)})},Rg}var Vb,qb;function vz(){return qb||(qb=1,Vb=null),Vb}var vi=Ei,Gb=sz,Zb=lu,bz=c2,xz=u2,wz={"Content-Type":"application/x-www-form-urlencoded"};function Wb(i,r){!vi.isUndefined(i)&&vi.isUndefined(i["Content-Type"])&&(i["Content-Type"]=r)}function Tz(){var i;return(typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(i=_z()),i}function Sz(i,r,s){if(vi.isString(i))try{return(r||JSON.parse)(i),vi.trim(i)}catch(p){if(p.name!=="SyntaxError")throw p}return(s||JSON.stringify)(i)}var Bf={transitional:bz,adapter:Tz(),transformRequest:[function(i,r){if(Gb(r,"Accept"),Gb(r,"Content-Type"),vi.isFormData(i)||vi.isArrayBuffer(i)||vi.isBuffer(i)||vi.isStream(i)||vi.isFile(i)||vi.isBlob(i))return i;if(vi.isArrayBufferView(i))return i.buffer;if(vi.isURLSearchParams(i))return Wb(r,"application/x-www-form-urlencoded;charset=utf-8"),i.toString();var s=vi.isObject(i),p=r&&r["Content-Type"],m;if((m=vi.isFileList(i))||s&&p==="multipart/form-data"){var b=this.env&&this.env.FormData;return xz(m?{"files[]":i}:i,b&&new b)}else if(s||p==="application/json")return Wb(r,"application/json"),Sz(i);return i}],transformResponse:[function(i){var r=this.transitional||Bf.transitional,s=r&&r.silentJSONParsing,p=r&&r.forcedJSONParsing,m=!s&&this.responseType==="json";if(m||p&&vi.isString(i)&&i.length)try{return JSON.parse(i)}catch(b){if(m)throw b.name==="SyntaxError"?Zb.from(b,Zb.ERR_BAD_RESPONSE,this,null,this.response):b}return i}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:vz()},validateStatus:function(i){return i>=200&&i<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};vi.forEach(["delete","get","head"],function(i){Bf.headers[i]={}});vi.forEach(["post","put","patch"],function(i){Bf.headers[i]=vi.merge(wz)});var M0=Bf,kz=Ei,Cz=M0,Pz=function(i,r,s){var p=this||Cz;return kz.forEach(s,function(m){i=m.call(p,i,r)}),i},Hb,Xb;function p2(){return Xb||(Xb=1,Hb=function(i){return!!(i&&i.__CANCEL__)}),Hb}var Kb=Ei,Lg=Pz,Mz=p2(),Az=M0,Iz=Of();function Dg(i){if(i.cancelToken&&i.cancelToken.throwIfRequested(),i.signal&&i.signal.aborted)throw new Iz}var Ez=function(i){Dg(i),i.headers=i.headers||{},i.data=Lg.call(i,i.data,i.headers,i.transformRequest),i.headers=Kb.merge(i.headers.common||{},i.headers[i.method]||{},i.headers),Kb.forEach(["delete","get","head","post","put","patch","common"],function(s){delete i.headers[s]});var r=i.adapter||Az.adapter;return r(i).then(function(s){return Dg(i),s.data=Lg.call(i,s.data,s.headers,i.transformResponse),s},function(s){return Mz(s)||(Dg(i),s&&s.response&&(s.response.data=Lg.call(i,s.response.data,s.response.headers,i.transformResponse))),Promise.reject(s)})},kn=Ei,d2=function(i,r){r=r||{};var s={};function p(M,D){return kn.isPlainObject(M)&&kn.isPlainObject(D)?kn.merge(M,D):kn.isPlainObject(D)?kn.merge({},D):kn.isArray(D)?D.slice():D}function m(M){if(kn.isUndefined(r[M])){if(!kn.isUndefined(i[M]))return p(void 0,i[M])}else return p(i[M],r[M])}function b(M){if(!kn.isUndefined(r[M]))return p(void 0,r[M])}function f(M){if(kn.isUndefined(r[M])){if(!kn.isUndefined(i[M]))return p(void 0,i[M])}else return p(void 0,r[M])}function l(M){if(M in r)return p(i[M],r[M]);if(M in i)return p(void 0,i[M])}var C={url:b,method:b,data:b,baseURL:f,transformRequest:f,transformResponse:f,paramsSerializer:f,timeout:f,timeoutMessage:f,withCredentials:f,adapter:f,responseType:f,xsrfCookieName:f,xsrfHeaderName:f,onUploadProgress:f,onDownloadProgress:f,decompress:f,maxContentLength:f,maxBodyLength:f,beforeRedirect:f,transport:f,httpAgent:f,httpsAgent:f,cancelToken:f,socketPath:f,responseEncoding:f,validateStatus:l};return kn.forEach(Object.keys(i).concat(Object.keys(r)),function(M){var D=C[M]||m,O=D(M);kn.isUndefined(O)&&D!==l||(s[M]=O)}),s},Yb,Jb;function f2(){return Jb||(Jb=1,Yb={version:"0.27.2"}),Yb}var zz=f2().version,us=lu,A0={};["object","boolean","number","function","string","symbol"].forEach(function(i,r){A0[i]=function(s){return typeof s===i||"a"+(r<1?"n ":" ")+i}});var Qb={};A0.transitional=function(i,r,s){function p(m,b){return"[Axios v"+zz+"] Transitional option '"+m+"'"+b+(s?". "+s:"")}return function(m,b,f){if(i===!1)throw new us(p(b," has been removed"+(r?" in "+r:"")),us.ERR_DEPRECATED);return r&&!Qb[b]&&(Qb[b]=!0,console.warn(p(b," has been deprecated since v"+r+" and will be removed in the near future"))),i?i(m,b,f):!0}};function Rz(i,r,s){if(typeof i!="object")throw new us("options must be an object",us.ERR_BAD_OPTION_VALUE);for(var p=Object.keys(i),m=p.length;m-- >0;){var b=p[m],f=r[b];if(f){var l=i[b],C=l===void 0||f(l,b,i);if(C!==!0)throw new us("option "+b+" must be "+C,us.ERR_BAD_OPTION_VALUE);continue}if(s!==!0)throw new us("Unknown option "+b,us.ERR_BAD_OPTION)}}var Lz={assertOptions:Rz,validators:A0},m2=Ei,Dz=a2,e1=az,t1=Ez,$f=d2,jz=h2,g2=Lz,Lc=g2.validators;function tu(i){this.defaults=i,this.interceptors={request:new e1,response:new e1}}tu.prototype.request=function(i,r){typeof i=="string"?(r=r||{},r.url=i):r=i||{},r=$f(this.defaults,r),r.method?r.method=r.method.toLowerCase():this.defaults.method?r.method=this.defaults.method.toLowerCase():r.method="get";var s=r.transitional;s!==void 0&&g2.assertOptions(s,{silentJSONParsing:Lc.transitional(Lc.boolean),forcedJSONParsing:Lc.transitional(Lc.boolean),clarifyTimeoutError:Lc.transitional(Lc.boolean)},!1);var p=[],m=!0;this.interceptors.request.forEach(function(O){typeof O.runWhen=="function"&&O.runWhen(r)===!1||(m=m&&O.synchronous,p.unshift(O.fulfilled,O.rejected))});var b=[];this.interceptors.response.forEach(function(O){b.push(O.fulfilled,O.rejected)});var f;if(!m){var l=[t1,void 0];for(Array.prototype.unshift.apply(l,p),l=l.concat(b),f=Promise.resolve(r);l.length;)f=f.then(l.shift(),l.shift());return f}for(var C=r;p.length;){var M=p.shift(),D=p.shift();try{C=M(C)}catch(O){D(O);break}}try{f=t1(C)}catch(O){return Promise.reject(O)}for(;b.length;)f=f.then(b.shift(),b.shift());return f};tu.prototype.getUri=function(i){i=$f(this.defaults,i);var r=jz(i.baseURL,i.url);return Dz(r,i.params,i.paramsSerializer)};m2.forEach(["delete","get","head","options"],function(i){tu.prototype[i]=function(r,s){return this.request($f(s||{},{method:i,url:r,data:(s||{}).data}))}});m2.forEach(["post","put","patch"],function(i){function r(s){return function(p,m,b){return this.request($f(b||{},{method:i,headers:s?{"Content-Type":"multipart/form-data"}:{},url:p,data:m}))}}tu.prototype[i]=r(),tu.prototype[i+"Form"]=r(!0)});var Fz=tu,jg,r1;function Oz(){if(r1)return jg;r1=1;var i=Of();function r(s){if(typeof s!="function")throw new TypeError("executor must be a function.");var p;this.promise=new Promise(function(b){p=b});var m=this;this.promise.then(function(b){if(m._listeners){var f,l=m._listeners.length;for(f=0;f<l;f++)m._listeners[f](b);m._listeners=null}}),this.promise.then=function(b){var f,l=new Promise(function(C){m.subscribe(C),f=C}).then(b);return l.cancel=function(){m.unsubscribe(f)},l},s(function(b){m.reason||(m.reason=new i(b),p(m.reason))})}return r.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},r.prototype.subscribe=function(s){if(this.reason){s(this.reason);return}this._listeners?this._listeners.push(s):this._listeners=[s]},r.prototype.unsubscribe=function(s){if(this._listeners){var p=this._listeners.indexOf(s);p!==-1&&this._listeners.splice(p,1)}},r.source=function(){var s,p=new r(function(m){s=m});return{token:p,cancel:s}},jg=r,jg}var i1,n1;function Bz(){return n1||(n1=1,i1=function(i){return function(r){return i.apply(null,r)}}),i1}var Fg,a1;function $z(){if(a1)return Fg;a1=1;var i=Ei;return Fg=function(r){return i.isObject(r)&&r.isAxiosError===!0},Fg}var o1=Ei,Nz=r2,Vd=Fz,Uz=d2,Vz=M0;function y2(i){var r=new Vd(i),s=Nz(Vd.prototype.request,r);return o1.extend(s,Vd.prototype,r),o1.extend(s,r),s.create=function(p){return y2(Uz(i,p))},s}var cn=y2(Vz);cn.Axios=Vd;cn.CanceledError=Of();cn.CancelToken=Oz();cn.isCancel=p2();cn.VERSION=f2().version;cn.toFormData=u2;cn.AxiosError=lu;cn.Cancel=cn.CanceledError;cn.all=function(i){return Promise.all(i)};cn.spread=Bz();cn.isAxiosError=$z();w0.exports=cn;w0.exports.default=cn;var qz=w0.exports,Gz=qz;const Zz=jE(Gz);class Wz{constructor(r,s){pa(this,"controlContainer"),pa(this,"map"),pa(this,"legendContainer"),pa(this,"legendButton"),pa(this,"closeButton"),pa(this,"legendTable"),pa(this,"targets"),pa(this,"uncheckedLayers",{}),pa(this,"onlyRendered"),pa(this,"options",{showDefault:!0,showCheckbox:!0,reverseOrder:!0,onlyRendered:!0,title:void 0}),pa(this,"sprite",{image:HTMLImageElement,json:JSON}),this.targets=r,s&&(this.options=Object.assign(this.options,s)),this.onlyRendered=this.options.onlyRendered,this.onDocumentClick=this.onDocumentClick.bind(this)}getDefaultPosition(){return"top-right"}createLayerCheckbox(r){var s;if(!this.options.showCheckbox)return;const p=(l,C)=>{var M,D;C?(this.uncheckedLayers[l]&&delete this.uncheckedLayers[l],(M=this.map)==null||M.setLayoutProperty(l,"visibility","visible")):(this.uncheckedLayers[l]=l,(D=this.map)==null||D.setLayoutProperty(l,"visibility","none"));const O=document.getElementsByName(l);for(const Z in O)typeof O[Z]!="number"&&(O[Z].checked=C)},m=document.createElement("TD");m.className="legend-table-td";const b=document.createElement("input");b.setAttribute("type","checkbox"),b.setAttribute("name",r.id),b.setAttribute("value",r.id);const f=(s=this.map)==null?void 0:s.getLayoutProperty(r.id,"visibility");if(!f)b.checked=!0;else{let l=!0;switch(f){case"none":l=!1;break;case"visible":l=!0,b.checked=!0;break}p(r.id,l)}return b.addEventListener("click",function(l){var C,M;const D=(C=l.target)==null?void 0:C.value,O=(M=l.target)==null?void 0:M.checked;p(D,O)}),m.appendChild(b),m}getLayerLegend(r){const s=this.map,p=s?.getZoom(),m=this.sprite,b=DE({sprite:m,zoom:p,layer:r}),f=document.createElement("TR"),l=this.createLayerCheckbox(r);l&&f.appendChild(l);const C=document.createElement("TD");if(C.className="legend-table-td",b)if(b.element==="div"){if(b.attributes.style.backgroundImage&&!["url(undefined)","url(null)"].includes(b.attributes.style.backgroundImage)){const O=document.createElement("img");O.src=b.attributes.style.backgroundImage.replace("url(","").replace(")",""),O.alt=r.id,O.style.cssText="height: 17px;",C.appendChild(O)}C.style.backgroundColor=b.attributes.style.backgroundColor,C.style.backgroundPosition=b.attributes.style.backgroundPosition,C.style.backgroundSize=b.attributes.style.backgroundSize,C.style.backgroundRepeat=b.attributes.style.backgroundRepeat,C.style.opacity=b.attributes.style.opacity}else if(b.element==="svg"){const O=document.createElementNS("http://www.w3.org/2000/svg","svg");O.style.cssText="height: 17px;",O.setAttributeNS(null,"version","1.1"),Object.keys(b.attributes).forEach($=>{O.setAttribute($,b.attributes[$]);const ne=document.createElementNS("http://www.w3.org/2000/svg","g");b.children.forEach(fe=>{const Ee=document.createElementNS("http://www.w3.org/2000/svg",fe.element);Object.keys(fe.attributes).forEach(_e=>{Ee.setAttributeNS(null,_e,fe.attributes[_e])}),ne.appendChild(Ee)}),O.appendChild(ne)});const Z=document.createElement("label");Z.textContent=this.targets&&this.targets[r.id]?this.targets[r.id]:r.id,C.appendChild(O)}else return;else{const O=document.createElementNS("http://www.w3.org/2000/svg","svg"),Z=document.createElementNS("http://www.w3.org/2000/svg","path"),$=document.createElementNS("http://www.w3.org/2000/svg","path");O.setAttribute("fill","none"),O.setAttribute("viewBox","0 0 24 24"),O.setAttribute("stroke","black"),O.classList.add("post-icon"),Z.setAttribute("d","M21,0H3A3,3,0,0,0,0,3V21a3,3,0,0,0,3,3H21a3,3,0,0,0,3-3V3A3,3,0,0,0,21,0ZM3,2H21a1,1,0,0,1,1,1V15.86L14.18,9.35a5.06,5.06,0,0,0-6.39-.06L2,13.92V3A1,1,0,0,1,3,2ZM21,22H3a1,1,0,0,1-1-1V16.48l7-5.63a3.06,3.06,0,0,1,3.86,0L22,18.47V21A1,1,0,0,1,21,22Z"),Z.setAttribute("stroke-linecap","round"),Z.setAttribute("stroke-linejoin","round"),Z.setAttribute("stroke-width","2"),$.setAttribute("d","M18,9a3,3,0,1,0-3-3A3,3,0,0,0,18,9Zm0-4a1,1,0,1,1-1,1A1,1,0,0,1,18,5Z"),$.setAttribute("stroke-linecap","round"),$.setAttribute("stroke-linejoin","round"),$.setAttribute("stroke-width","2"),O.appendChild(Z),O.appendChild($);const ne=document.createElement("label");ne.textContent=this.targets&&this.targets[r.id]?this.targets[r.id]:r.id,C.appendChild(O)}const M=document.createElement("TD");M.className="legend-table-td";const D=document.createElement("label");return D.textContent=this.targets&&this.targets[r.id]?this.targets[r.id]:r.id,M.appendChild(D),f.appendChild(C),f.appendChild(M),f}updateLegendControl(){const r=this.map,s={};if(r){const m=r.queryRenderedFeatures();for(const b of m)s[b.layer.id]=b.layer}let p=r?.getStyle().layers;if(p){for(this.legendTable||(this.legendTable=document.createElement("TABLE"),this.legendTable.className="legend-table",this.legendContainer.appendChild(this.legendTable));this.legendTable.firstChild;)this.legendTable.removeChild(this.legendTable.firstChild);this.options.reverseOrder&&(p=p.reverse()),p.forEach(m=>{if(s[m.id]&&this.uncheckedLayers[m.id]?delete this.uncheckedLayers[m.id]:this.uncheckedLayers[m.id]&&(s[m.id]=m),this.targets===void 0||this.targets&&Object.keys(this.targets).length===0||this.targets&&Object.keys(this.targets).map(b=>b).includes(m.id)){if(this.onlyRendered&&!s[m.id])return;const b=this.getLayerLegend(m);if(!b)return;this.legendTable.appendChild(b)}else return})}}onAdd(r){this.map=r,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("maplibregl-ctrl"),this.controlContainer.classList.add("maplibregl-ctrl-group"),this.legendContainer=document.createElement("div"),this.legendContainer.classList.add("maplibregl-legend-list"),this.legendButton=document.createElement("button"),this.legendButton.classList.add("maplibregl-ctrl-icon"),this.legendButton.classList.add("maplibregl-legend-switcher"),this.legendButton.addEventListener("click",()=>{this.legendButton.style.display="none",this.legendContainer.style.display="block"}),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.legendButton),this.controlContainer.appendChild(this.legendContainer),this.closeButton=document.createElement("button"),this.closeButton.textContent="x",this.closeButton.classList.add("maplibregl-legend-close-button"),this.closeButton.addEventListener("click",()=>{this.legendButton.style.display="block",this.legendContainer.style.display="none"}),this.legendContainer.appendChild(this.closeButton);const s=document.createElement("label");s.classList.add("maplibregl-legend-title-label"),s.textContent=this.options.title||"Legend",this.legendContainer.appendChild(s),this.legendContainer.appendChild(document.createElement("br"));const p=document.createElement("input");p.setAttribute("type","checkbox");const m=`maplibregl-legend-onlyrendered-checkbox-${Math.random()*100}`;p.setAttribute("id",m),p.classList.add("maplibregl-legend-onlyRendered-checkbox"),p.checked=this.onlyRendered,p.addEventListener("click",this.handleClickOnlyRendered.bind(this)),this.legendContainer.appendChild(p);const b=document.createElement("label");b.classList.add("maplibregl-legend-onlyRendered-label"),b.textContent="Only rendered",b.htmlFor=m,this.legendContainer.appendChild(b),this.legendContainer.appendChild(document.createElement("br")),this.map.on("moveend",()=>{this.updateLegendControl()}),this.map.on("styledata",()=>{this.updateLegendControl()});const f=async()=>{if(r.loaded()){const l=r.getStyle().sprite;l&&await Promise.all([this.loadImage(`${l}@2x.png`),this.loadJson(`${l}.json`)]).then(([C,M])=>{this.setSprite(C,M)}).catch(C=>console.error(C)),this.updateLegendControl(),r.off("idle",f)}};return this.map.on("idle",f),this.options&&this.options.showDefault==!0&&(this.legendContainer.style.display="block",this.legendButton.style.display="none"),this.controlContainer}onRemove(){!this.controlContainer||!this.controlContainer.parentNode||!this.map||!this.legendButton||(this.legendButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.map=void 0)}redraw(){this.updateLegendControl()}onDocumentClick(r){this.controlContainer&&!this.controlContainer.contains(r.target)&&this.legendContainer&&this.legendButton&&this.options&&this.options.showDefault!==!0&&(this.legendContainer.style.display="none",this.legendButton.style.display="block")}handleClickOnlyRendered(r){var s;const p=(s=r.target)==null?void 0:s.checked;this.onlyRendered=!!p,this.updateLegendControl()}setSprite(r,s){this.sprite={image:r,json:s}}loadImage(r){let s=!1;const p=new Promise((m,b)=>{const f=new Image;f.crossOrigin="Anonymous",f.onload=()=>{s||m(f)},f.onerror=l=>{s||b(l)},f.src=r});return p.cancel=()=>{s=!0},p}loadJson(r){return Zz.get(r,{responseType:"json"}).then(s=>s.data)}}function Hz(i,r){df(r,!0),Py(()=>{if(!r.map)return;const s={"1710-1890":"17101889","1890-1900":"1890-1899","1900-1905":"1900-1904","1905-1910":"1905-1909","1910-1920":"1910-1919","1920-1930":"1920-1929","1930-1950":"1930-1949","1950-1975":"1950-1974","1975-2019":"1975-2019",null:"Unknown"},p={showDefault:!0,onlyRendered:!1,showCheckbox:!0,reverseOrder:!0,title:"Buildings by year built"},m=new Wz(s,p);r.map.addControl(m,"bottom-left");const b=document.querySelector(".maplibregl-legend-title-label"),f=document.createElement("div"),l=document.createElement("span"),C=document.createElement("a");l.className="legend-subtext",f.className="subtitleHolder",l.textContent="The gray slashes indicate buildings where the year built is uncertain. ",C.textContent="Read more about our methodology.",b.insertAdjacentElement("afterend",f),f.appendChild(l),f.appendChild(C),C.href="https://leventhalmap.org/articles/dating-every-building-in-boston",f.parentNode.removeChild(f.nextSibling),S1(()=>{if(document.querySelectorAll(".legend-table-td.highlight").forEach(D=>D.classList.remove("highlight")),!r.legendArrow)return;function M(D){const O=D.replace("#",""),Z=parseInt(O,16),$=Z>>16&255,ne=Z>>8&255,fe=Z&255;return`rgb(${$}, ${ne}, ${fe})`}document.querySelectorAll(".legend-table-td[style]").forEach(D=>{const O=D.style.backgroundColor.trim().toLowerCase(),Z=r.legendArrow.trim().toLowerCase(),$=M(Z);O===$&&D.classList.add("highlight")})})}),ff()}const Wn=dl({long:null,lat:null,zoom:null});var Xz=ap('<div class="map-wrap"><div class="map"><!></div></div>');function Kz(i,r){df(r,!0);let s=In(void 0),p,m=In(void 0),b=In(!1);setTimeout(()=>{Ji(b,!0)},500);const f=[{range:{start:1975,end:2019},color:"#3288BD"},{range:{start:1950,end:1975},color:"#66C2A5"},{range:{start:1930,end:1950},color:"#ABDDA4"},{range:{start:1920,end:1930},color:"#E6F598"},{range:{start:1910,end:1920},color:"#FFFFBF"},{range:{start:1905,end:1910},color:"#FEE08B"},{range:{start:1900,end:1905},color:"#FDAE61"},{range:{start:1890,end:1900},color:"#F46D43"},{range:{start:1710,end:1890},color:"#D53E4F"},{range:{start:0,end:0},color:"#2E2E2E"}];function l(Z){if(Z==null||isNaN(Z))return"#2E2E2E";const $=f.find(({range:ne})=>Z>=ne.start&&Z<ne.end);return $?$.color:"#2E2E2E"}Py(()=>{ci.apiKey="YAlgbo83caczbP46lxYj";const Z={lng:Wn.long,lat:Wn.lat,zoom:Wn.zoom};Ji(s,new ww({container:p,style:"https://api.maptiler.com/maps/0199a53b-d07e-7d68-afa6-afd2e23ef02c/style.json?key=YAlgbo83caczbP46lxYj",center:[Z.lng,Z.lat],zoom:Z.zoom,minZoom:11}),!0),lr(s).on("load",()=>{lr(s).addSource("buildings",{type:"vector",tiles:["https://api.maptiler.com/tiles/0199c972-a1bc-7fba-a054-bcb64c5c21f9/{z}/{x}/{y}.pbf?key=YAlgbo83caczbP46lxYj"],minzoom:11,maxzoom:20}),lr(s).addLayer({id:"buildings-layer",type:"fill",source:"buildings","source-layer":"all_buildings",paint:{"fill-opacity":0}}),lr(s).on("mousemove","buildings-layer",ne=>{const fe=ne.features?.[0];if(fe){const Ee=Number(fe.properties.yr_built);Ji(m,l(Ee),!0),lr(s).getCanvas().style.cursor="pointer"}else Ji(m,null),lr(s).getCanvas().style.cursor="grab"}),lr(s).on("mouseleave","buildings-layer",()=>{lr(s).getCanvas().style.cursor="",Ji(m,null)}),lr(s).on("click","buildings-layer",ne=>{const fe=ne.features[0];new D5().setLngLat(ne.lngLat).setHTML(`<div class="text-md">Year Built: <strong>${fe.properties.yr_built||"Unknown"}</strong></div>`).addTo(lr(s))});function $(){const ne=lr(s).getCenter(),fe=lr(s).getZoom().toFixed(1),Ee={lng:ne.lng.toFixed(4),lat:ne.lat.toFixed(4)};Wn.long=Ee.lng,Wn.lat=Ee.lat,Wn.zoom=fe,window.location.hash=`/zoom:${Wn.zoom}$long:${Wn.long}$lat:${Wn.lat}`}lr(s).on("dragend",()=>{$()}),lr(s).on("zoomend",()=>{$()})})});var C=Xz(),M=ps(C),D=ps(M);{var O=Z=>{Hz(Z,{get map(){return lr(s)},get legendArrow(){return lr(m)}})};Cy(D,Z=>{lr(s)&&lr(b)&&Z(O)})}Ek(M,Z=>p=Z,()=>p),Uh(i,C),ff()}$S();var Yz=ap('<div class="absolute top-5 right-3"><button class="bg-white rounded-full w-6 text-center select-none hover:cursor-pointer">?</button></div>');function Jz(i,r){let s=Rk(r,"show",12);var p=Yz(),m=ps(p);_k("click",m,()=>s(!s())),Uh(i,p)}function Qz(i){const r=i-1;return r*r*r+1}function e3(i,{delay:r=0,duration:s=400,easing:p=Qz,axis:m="y"}={}){const b=getComputedStyle(i),f=+b.opacity,l=m==="y"?"height":"width",C=parseFloat(b[l]),M=m==="y"?["top","bottom"]:["left","right"],D=M.map(_e=>`${_e[0].toUpperCase()}${_e.slice(1)}`),O=parseFloat(b[`padding${D[0]}`]),Z=parseFloat(b[`padding${D[1]}`]),$=parseFloat(b[`margin${D[0]}`]),ne=parseFloat(b[`margin${D[1]}`]),fe=parseFloat(b[`border${D[0]}Width`]),Ee=parseFloat(b[`border${D[1]}Width`]);return{delay:r,duration:s,easing:p,css:_e=>`overflow: hidden;opacity: ${Math.min(_e*20,1)*f};${l}: ${_e*C}px;padding-${M[0]}: ${_e*O}px;padding-${M[1]}: ${_e*Z}px;margin-${M[0]}: ${_e*$}px;margin-${M[1]}: ${_e*ne}px;border-${M[0]}-width: ${_e*fe}px;border-${M[1]}-width: ${_e*Ee}px;min-${l}: 0`}}var t3=ap(`<div class="absolute z-100 text-white text-sm md:text-md mx-16 bg-black/90 rounded-b-xl border-t border-white shadow-xl"><div class="py-2 px-4 md:px-12 md:py-4"><p>This map shows the year of construction for all buildings in
            Boston as of 2024. The year built data comes from the city's
            comprehensive <a href="https://data.boston.gov/dataset/boston-buildings-inventory">building inventory dataset</a>, which pulls from tax assessor records. Building shapes and
            locations were obtained from a <a href="https://www.mass.gov/info-details/massgis-data-building-structures-2-d#production">MassGIS dataset</a>. The map is useful for identifying citywide patterns in building
            ages, though individual records may contain inaccuracies since the
            data was originally collected for a variety of purposes. Read more
            about the project <a href="https://leventhalmap.org/articles/dating-every-building-in-boston">here</a>.</p> <p class="mt-2">Source code on <a href="https://github.com/bplmaps/boston-buildings">Github</a>. Made with Maptiler, MapLibre, and Svelte 5. Inspired by Bert Spaan's Waag Society <a class="underline text-blue-300" href="https://code.waag.org/buildings/#52.3589,4.894,15">map of the Netherlands</a> and Thomas Rhiel's BKLYNR <a class="underline text-blue-300" href="https://www.bklynr.com/block-by-block-brooklyns-past-and-present/">map of Brooklyn</a>.</p></div></div>`),r3=ap('<nav class="bg-black font-sans border-b border-white"><div class="max-w-7xl px-4 sm:px-6 lg:px-8"><div><div class="flex items-center space-x-2"><div class="mr-10"><a class="inline font-black text-red-400 hover:underline" href="https://leventhalmap.org" target="_blank">LMEC</a> <p class="inline text-white"></p> <p class="inline font-bold text-blue-400">Digital Projects</p> <p class="inline text-white"></p> <p class="inline italic font-bold text-white">Boston Buildings</p></div></div> <div class="h-16"><!></div></div> <!></div></nav>');function i3(i){let r=In(!1);var s=r3(),p=ps(s),m=ps(p);kk(m,1,"flex h-16 items-center justify-between");var b=Ug(ps(m),2),f=ps(b);Jz(f,{get show(){return lr(r)},set show(M){Ji(r,M,!0)}});var l=Ug(m,2);{var C=M=>{var D=t3();Ik(3,D,()=>e3),Uh(M,D)};Cy(l,M=>{lr(r)&&M(C)})}Uh(i,s)}var n3=ap("<main><!> <!></main>");function a3(i,r){df(r,!0);let s=In(!1);const p={long:-71.06,lat:42.36,zoom:14};function m(M){let D={};return M.split("$").map(O=>{const Z=O.indexOf(":"),$=O.slice(0,Z),ne=O.slice(Z+1);D[$]=ne}),{...p,...D}}Py(()=>{const M=m(window.location.hash.substring(2).split("#")[0]);Wn.long=M.long,Wn.lat=M.lat,Wn.zoom=M.zoom,Ji(s,!0)});var b=n3(),f=ps(b);i3(f);var l=Ug(f,2);{var C=M=>{Kz(M,{})};Cy(l,M=>{lr(s)&&M(C)})}Uh(i,b),ff()}xk(a3,{target:document.getElementById("app")});
